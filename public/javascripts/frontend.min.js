/*!
 * ZeroClipboard
 * The ZeroClipboard library provides an easy way to copy text to the clipboard using an invisible Adobe Flash movie and a JavaScript interface.
 * Copyright (c) 2009-2015 Jon Rohan, James M. Greene
 * Licensed MIT
 * http://zeroclipboard.org/
 * v2.3.0-beta.1
 */
!function(a,b){"use strict";var c,d,e,f=a,g=f.document,h=f.navigator,i=f.setTimeout,j=f.clearTimeout,k=f.setInterval,l=f.clearInterval,m=f.getComputedStyle,n=f.encodeURIComponent,o=f.ActiveXObject,p=f.Error,q=f.Number.parseInt||f.parseInt,r=f.Number.parseFloat||f.parseFloat,s=f.Number.isNaN||f.isNaN,t=f.Date.now,u=f.Object.keys,v=f.Object.defineProperty,w=f.Object.prototype.hasOwnProperty,x=f.Array.prototype.slice,y=function(){var a=function(a){return a};if("function"==typeof f.wrap&&"function"==typeof f.unwrap)try{var b=g.createElement("div"),c=f.unwrap(b);1===b.nodeType&&c&&1===c.nodeType&&(a=f.unwrap)}catch(d){}return a}(),z=function(a){return x.call(a,0)},A=function(){var a,c,d,e,f,g,h=z(arguments),i=h[0]||{};for(a=1,c=h.length;c>a;a++)if(null!=(d=h[a]))for(e in d)w.call(d,e)&&(f=i[e],g=d[e],i!==g&&g!==b&&(i[e]=g));return i},B=function(a){var b,c,d,e;if("object"!=typeof a||null==a||"number"==typeof a.nodeType)b=a;else if("number"==typeof a.length)for(b=[],c=0,d=a.length;d>c;c++)w.call(a,c)&&(b[c]=B(a[c]));else{b={};for(e in a)w.call(a,e)&&(b[e]=B(a[e]))}return b},C=function(a,b){for(var c={},d=0,e=b.length;e>d;d++)b[d]in a&&(c[b[d]]=a[b[d]]);return c},D=function(a,b){var c={};for(var d in a)-1===b.indexOf(d)&&(c[d]=a[d]);return c},E=function(a){if(a)for(var b in a)w.call(a,b)&&delete a[b];return a},F=function(a,b){if(a&&1===a.nodeType&&a.ownerDocument&&b&&(1===b.nodeType&&b.ownerDocument&&b.ownerDocument===a.ownerDocument||9===b.nodeType&&!b.ownerDocument&&b===a.ownerDocument))do{if(a===b)return!0;a=a.parentNode}while(a);return!1},G=function(a){var b;return"string"==typeof a&&a&&(b=a.split("#")[0].split("?")[0],b=a.slice(0,a.lastIndexOf("/")+1)),b},H=function(a){var b,c;return"string"==typeof a&&a&&(c=a.match(/^(?:|[^:@]*@|.+\)@(?=http[s]?|file)|.+?\s+(?: at |@)(?:[^:\(]+ )*[\(]?)((?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/),c&&c[1]?b=c[1]:(c=a.match(/\)@((?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/),c&&c[1]&&(b=c[1]))),b},I=function(){var a,b;try{throw new p}catch(c){b=c}return b&&(a=b.sourceURL||b.fileName||H(b.stack)),a},J=function(){var a,c,d;if(g.currentScript&&(a=g.currentScript.src))return a;if(c=g.getElementsByTagName("script"),1===c.length)return c[0].src||b;if("readyState"in c[0])for(d=c.length;d--;)if("interactive"===c[d].readyState&&(a=c[d].src))return a;return"loading"===g.readyState&&(a=c[c.length-1].src)?a:(a=I())?a:b},K=function(){var a,c,d,e=g.getElementsByTagName("script");for(a=e.length;a--;){if(!(d=e[a].src)){c=null;break}if(d=G(d),null==c)c=d;else if(c!==d){c=null;break}}return c||b},L=function(){var a=G(J())||K()||"";return a+"ZeroClipboard.swf"},M=function(){var a=/win(dows|[\s]?(nt|me|ce|xp|vista|[\d]+))/i;return!!h&&(a.test(h.appVersion||"")||a.test(h.platform||"")||-1!==(h.userAgent||"").indexOf("Windows"))},N=function(){return null==a.opener&&(!!a.top&&a!=a.top||!!a.parent&&a!=a.parent)}(),O={bridge:null,version:"0.0.0",pluginType:"unknown",disabled:null,outdated:null,sandboxed:null,unavailable:null,degraded:null,deactivated:null,overdue:null,ready:null},P="11.0.0",Q={},R={},S=null,T=0,U=0,V={ready:"Flash communication is established",error:{"flash-disabled":"Flash is disabled or not installed. May also be attempting to run Flash in a sandboxed iframe, which is impossible.","flash-outdated":"Flash is too outdated to support ZeroClipboard","flash-sandboxed":"Attempting to run Flash in a sandboxed iframe, which is impossible","flash-unavailable":"Flash is unable to communicate bidirectionally with JavaScript","flash-degraded":"Flash is unable to preserve data fidelity when communicating with JavaScript","flash-deactivated":"Flash is too outdated for your browser and/or is configured as click-to-activate.\nThis may also mean that the ZeroClipboard SWF object could not be loaded, so please check your `swfPath` configuration and/or network connectivity.\nMay also be attempting to run Flash in a sandboxed iframe, which is impossible.","flash-overdue":"Flash communication was established but NOT within the acceptable time limit","version-mismatch":"ZeroClipboard JS version number does not match ZeroClipboard SWF version number","clipboard-error":"At least one error was thrown while ZeroClipboard was attempting to inject your data into the clipboard","config-mismatch":"ZeroClipboard configuration does not match Flash's reality","swf-not-found":"The ZeroClipboard SWF object could not be loaded, so please check your `swfPath` configuration and/or network connectivity"}},W=["flash-unavailable","flash-degraded","flash-overdue","version-mismatch","config-mismatch","clipboard-error"],X=["flash-disabled","flash-outdated","flash-sandboxed","flash-unavailable","flash-degraded","flash-deactivated","flash-overdue"],Y=new RegExp("^flash-("+X.map(function(a){return a.replace(/^flash-/,"")}).join("|")+")$"),Z=new RegExp("^flash-("+X.slice(1).map(function(a){return a.replace(/^flash-/,"")}).join("|")+")$"),$={swfPath:L(),trustedDomains:a.location.host?[a.location.host]:[],cacheBust:!0,forceEnhancedClipboard:!1,flashLoadTimeout:3e4,autoActivate:!0,bubbleEvents:!0,fixLineEndings:!0,containerId:"global-zeroclipboard-html-bridge",containerClass:"global-zeroclipboard-container",swfObjectId:"global-zeroclipboard-flash-bridge",hoverClass:"zeroclipboard-is-hover",activeClass:"zeroclipboard-is-active",forceHandCursor:!1,title:null,zIndex:999999999},_=function(a){if("object"==typeof a&&null!==a)for(var b in a)if(w.call(a,b))if(/^(?:forceHandCursor|title|zIndex|bubbleEvents|fixLineEndings)$/.test(b))$[b]=a[b];else if(null==O.bridge)if("containerId"===b||"swfObjectId"===b){if(!oa(a[b]))throw new Error("The specified `"+b+"` value is not valid as an HTML4 Element ID");$[b]=a[b]}else $[b]=a[b];{if("string"!=typeof a||!a)return B($);if(w.call($,a))return $[a]}},aa=function(){return Va(),{browser:C(h,["userAgent","platform","appName","appVersion"]),flash:D(O,["bridge"]),zeroclipboard:{version:Xa.version,config:Xa.config()}}},ba=function(){return!!(O.disabled||O.outdated||O.sandboxed||O.unavailable||O.degraded||O.deactivated)},ca=function(a,d){var e,f,g,h={};if("string"==typeof a&&a)g=a.toLowerCase().split(/\s+/);else if("object"==typeof a&&a&&"undefined"==typeof d)for(e in a)w.call(a,e)&&"string"==typeof e&&e&&"function"==typeof a[e]&&Xa.on(e,a[e]);if(g&&g.length){for(e=0,f=g.length;f>e;e++)a=g[e].replace(/^on/,""),h[a]=!0,Q[a]||(Q[a]=[]),Q[a].push(d);if(h.ready&&O.ready&&Xa.emit({type:"ready"}),h.error){for(e=0,f=X.length;f>e;e++)if(O[X[e].replace(/^flash-/,"")]===!0){Xa.emit({type:"error",name:X[e]});break}c!==b&&Xa.version!==c&&Xa.emit({type:"error",name:"version-mismatch",jsVersion:Xa.version,swfVersion:c})}}return Xa},da=function(a,b){var c,d,e,f,g;if(0===arguments.length)f=u(Q);else if("string"==typeof a&&a)f=a.split(/\s+/);else if("object"==typeof a&&a&&"undefined"==typeof b)for(c in a)w.call(a,c)&&"string"==typeof c&&c&&"function"==typeof a[c]&&Xa.off(c,a[c]);if(f&&f.length)for(c=0,d=f.length;d>c;c++)if(a=f[c].toLowerCase().replace(/^on/,""),g=Q[a],g&&g.length)if(b)for(e=g.indexOf(b);-1!==e;)g.splice(e,1),e=g.indexOf(b,e);else g.length=0;return Xa},ea=function(a){var b;return b="string"==typeof a&&a?B(Q[a])||null:B(Q)},fa=function(a){var b,c,d;return a=pa(a),a&&!wa(a)?"ready"===a.type&&O.overdue===!0?Xa.emit({type:"error",name:"flash-overdue"}):(b=A({},a),ua.call(this,b),"copy"===a.type&&(d=Ea(R),c=d.data,S=d.formatMap),c):void 0},ga=function(){var a=O.sandboxed;if(Va(),"boolean"!=typeof O.ready&&(O.ready=!1),O.sandboxed!==a&&O.sandboxed===!0)O.ready=!1,Xa.emit({type:"error",name:"flash-sandboxed"});else if(!Xa.isFlashUnusable()&&null===O.bridge){var b=$.flashLoadTimeout;"number"==typeof b&&b>=0&&(T=i(function(){"boolean"!=typeof O.deactivated&&(O.deactivated=!0),O.deactivated===!0&&Xa.emit({type:"error",name:"flash-deactivated"})},b)),O.overdue=!1,Ca()}},ha=function(){Xa.clearData(),Xa.blur(),Xa.emit("destroy"),Da(),Xa.off()},ia=function(a,b){var c;if("object"==typeof a&&a&&"undefined"==typeof b)c=a,Xa.clearData();else{if("string"!=typeof a||!a)return;c={},c[a]=b}for(var d in c)"string"==typeof d&&d&&w.call(c,d)&&"string"==typeof c[d]&&c[d]&&(R[d]=Ua(c[d]))},ja=function(a){"undefined"==typeof a?(E(R),S=null):"string"==typeof a&&w.call(R,a)&&delete R[a]},ka=function(a){return"undefined"==typeof a?B(R):"string"==typeof a&&w.call(R,a)?R[a]:void 0},la=function(a){if(a&&1===a.nodeType){d&&(Ma(d,$.activeClass),d!==a&&Ma(d,$.hoverClass)),d=a,La(a,$.hoverClass);var b=a.getAttribute("title")||$.title;if("string"==typeof b&&b){var c=Ba(O.bridge);c&&c.setAttribute("title",b)}var e=$.forceHandCursor===!0||"pointer"===Na(a,"cursor");Sa(e),Ra()}},ma=function(){var a=Ba(O.bridge);a&&(a.removeAttribute("title"),a.style.left="0px",a.style.top="-9999px",a.style.width="1px",a.style.height="1px"),d&&(Ma(d,$.hoverClass),Ma(d,$.activeClass),d=null)},na=function(){return d||null},oa=function(a){return"string"==typeof a&&a&&/^[A-Za-z][A-Za-z0-9_:\-\.]*$/.test(a)},pa=function(a){var b;if("string"==typeof a&&a?(b=a,a={}):"object"==typeof a&&a&&"string"==typeof a.type&&a.type&&(b=a.type),b){b=b.toLowerCase(),!a.target&&(/^(copy|aftercopy|_click)$/.test(b)||"error"===b&&"clipboard-error"===a.name)&&(a.target=e),A(a,{type:b,target:a.target||d||null,relatedTarget:a.relatedTarget||null,currentTarget:O&&O.bridge||null,timeStamp:a.timeStamp||t()||null});var c=V[a.type];return"error"===a.type&&a.name&&c&&(c=c[a.name]),c&&(a.message=c),"ready"===a.type&&A(a,{target:null,version:O.version}),"error"===a.type&&(Y.test(a.name)&&A(a,{target:null,minimumVersion:P}),Z.test(a.name)&&A(a,{version:O.version})),"copy"===a.type&&(a.clipboardData={setData:Xa.setData,clearData:Xa.clearData}),"aftercopy"===a.type&&(a=Fa(a,S)),a.target&&!a.relatedTarget&&(a.relatedTarget=qa(a.target)),ra(a)}},qa=function(a){var b=a&&a.getAttribute&&a.getAttribute("data-clipboard-target");return b?g.getElementById(b):null},ra=function(a){if(a&&/^_(?:click|mouse(?:over|out|down|up|move))$/.test(a.type)){var c=a.target,d="_mouseover"===a.type&&a.relatedTarget?a.relatedTarget:b,e="_mouseout"===a.type&&a.relatedTarget?a.relatedTarget:b,h=Oa(c),i=f.screenLeft||f.screenX||0,j=f.screenTop||f.screenY||0,k=g.body.scrollLeft+g.documentElement.scrollLeft,l=g.body.scrollTop+g.documentElement.scrollTop,m=h.left+("number"==typeof a._stageX?a._stageX:0),n=h.top+("number"==typeof a._stageY?a._stageY:0),o=m-k,p=n-l,q=i+o,r=j+p,s="number"==typeof a.movementX?a.movementX:0,t="number"==typeof a.movementY?a.movementY:0;delete a._stageX,delete a._stageY,A(a,{srcElement:c,fromElement:d,toElement:e,screenX:q,screenY:r,pageX:m,pageY:n,clientX:o,clientY:p,x:o,y:p,movementX:s,movementY:t,offsetX:0,offsetY:0,layerX:0,layerY:0})}return a},sa=function(a){var b=a&&"string"==typeof a.type&&a.type||"";return!/^(?:(?:before)?copy|destroy)$/.test(b)},ta=function(a,b,c,d){d?i(function(){a.apply(b,c)},0):a.apply(b,c)},ua=function(a){if("object"==typeof a&&a&&a.type){var b=sa(a),c=Q["*"]||[],d=Q[a.type]||[],e=c.concat(d);if(e&&e.length){var g,h,i,j,k,l=this;for(g=0,h=e.length;h>g;g++)i=e[g],j=l,"string"==typeof i&&"function"==typeof f[i]&&(i=f[i]),"object"==typeof i&&i&&"function"==typeof i.handleEvent&&(j=i,i=i.handleEvent),"function"==typeof i&&(k=A({},a),ta(i,j,[k],b))}return this}},va=function(a){var b=null;return(N===!1||a&&"error"===a.type&&a.name&&-1!==W.indexOf(a.name))&&(b=!1),b},wa=function(a){var b=a.target||d||null,f="swf"===a._source;switch(delete a._source,a.type){case"error":var g="flash-sandboxed"===a.name||va(a);"boolean"==typeof g&&(O.sandboxed=g),-1!==X.indexOf(a.name)?A(O,{disabled:"flash-disabled"===a.name,outdated:"flash-outdated"===a.name,unavailable:"flash-unavailable"===a.name,degraded:"flash-degraded"===a.name,deactivated:"flash-deactivated"===a.name,overdue:"flash-overdue"===a.name,ready:!1}):"version-mismatch"===a.name&&(c=a.swfVersion,A(O,{disabled:!1,outdated:!1,unavailable:!1,degraded:!1,deactivated:!1,overdue:!1,ready:!1})),Qa();break;case"ready":c=a.swfVersion;var h=O.deactivated===!0;A(O,{disabled:!1,outdated:!1,sandboxed:!1,unavailable:!1,degraded:!1,deactivated:!1,overdue:h,ready:!h}),Qa();break;case"beforecopy":e=b;break;case"copy":var i,j,k=a.relatedTarget;!R["text/html"]&&!R["text/plain"]&&k&&(j=k.value||k.outerHTML||k.innerHTML)&&(i=k.value||k.textContent||k.innerText)?(a.clipboardData.clearData(),a.clipboardData.setData("text/plain",i),j!==i&&a.clipboardData.setData("text/html",j)):!R["text/plain"]&&a.target&&(i=a.target.getAttribute("data-clipboard-text"))&&(a.clipboardData.clearData(),a.clipboardData.setData("text/plain",i));break;case"aftercopy":xa(a),Xa.clearData(),b&&b!==Ka()&&b.focus&&b.focus();break;case"_mouseover":Xa.focus(b),$.bubbleEvents===!0&&f&&(b&&b!==a.relatedTarget&&!F(a.relatedTarget,b)&&ya(A({},a,{type:"mouseenter",bubbles:!1,cancelable:!1})),ya(A({},a,{type:"mouseover"})));break;case"_mouseout":Xa.blur(),$.bubbleEvents===!0&&f&&(b&&b!==a.relatedTarget&&!F(a.relatedTarget,b)&&ya(A({},a,{type:"mouseleave",bubbles:!1,cancelable:!1})),ya(A({},a,{type:"mouseout"})));break;case"_mousedown":La(b,$.activeClass),$.bubbleEvents===!0&&f&&ya(A({},a,{type:a.type.slice(1)}));break;case"_mouseup":Ma(b,$.activeClass),$.bubbleEvents===!0&&f&&ya(A({},a,{type:a.type.slice(1)}));break;case"_click":e=null,$.bubbleEvents===!0&&f&&ya(A({},a,{type:a.type.slice(1)}));break;case"_mousemove":$.bubbleEvents===!0&&f&&ya(A({},a,{type:a.type.slice(1)}))}return/^_(?:click|mouse(?:over|out|down|up|move))$/.test(a.type)?!0:void 0},xa=function(a){if(a.errors&&a.errors.length>0){var b=B(a);A(b,{type:"error",name:"clipboard-error"}),delete b.success,i(function(){Xa.emit(b)},0)}},ya=function(a){if(a&&"string"==typeof a.type&&a){var b,c=a.target||null,d=c&&c.ownerDocument||g,e={view:d.defaultView||f,canBubble:!0,cancelable:!0,detail:"click"===a.type?1:0,button:"number"==typeof a.which?a.which-1:"number"==typeof a.button?a.button:d.createEvent?0:1},h=A(e,a);c&&d.createEvent&&c.dispatchEvent&&(h=[h.type,h.canBubble,h.cancelable,h.view,h.detail,h.screenX,h.screenY,h.clientX,h.clientY,h.ctrlKey,h.altKey,h.shiftKey,h.metaKey,h.button,h.relatedTarget],b=d.createEvent("MouseEvents"),b.initMouseEvent&&(b.initMouseEvent.apply(b,h),b._source="js",c.dispatchEvent(b)))}},za=function(){var a=$.flashLoadTimeout;if("number"==typeof a&&a>=0){var b=Math.min(1e3,a/10),c=$.swfObjectId+"_fallbackContent";U=k(function(){var a=g.getElementById(c);Pa(a)&&(Qa(),O.deactivated=null,Xa.emit({type:"error",name:"swf-not-found"}))},b)}},Aa=function(){var a=g.createElement("div");return a.id=$.containerId,a.className=$.containerClass,a.style.position="absolute",a.style.left="0px",a.style.top="-9999px",a.style.width="1px",a.style.height="1px",a.style.zIndex=""+Ta($.zIndex),a},Ba=function(a){for(var b=a&&a.parentNode;b&&"OBJECT"===b.nodeName&&b.parentNode;)b=b.parentNode;return b||null},Ca=function(){var a,b=O.bridge,c=Ba(b);if(!b){var d=Ja(f.location.host,$),e="never"===d?"none":"all",h=Ha(A({jsVersion:Xa.version},$)),i=$.swfPath+Ga($.swfPath,$);c=Aa();var j=g.createElement("div");c.appendChild(j),g.body.appendChild(c);var k=g.createElement("div"),l="activex"===O.pluginType;k.innerHTML='<object id="'+$.swfObjectId+'" name="'+$.swfObjectId+'" width="100%" height="100%" '+(l?'classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"':'type="application/x-shockwave-flash" data="'+i+'"')+">"+(l?'<param name="movie" value="'+i+'"/>':"")+'<param name="allowScriptAccess" value="'+d+'"/><param name="allowNetworking" value="'+e+'"/><param name="menu" value="false"/><param name="wmode" value="transparent"/><param name="flashvars" value="'+h+'"/><div id="'+$.swfObjectId+'_fallbackContent">&nbsp;</div></object>',b=k.firstChild,k=null,y(b).ZeroClipboard=Xa,c.replaceChild(b,j),za()}return b||(b=g[$.swfObjectId],b&&(a=b.length)&&(b=b[a-1]),!b&&c&&(b=c.firstChild)),O.bridge=b||null,b},Da=function(){var a=O.bridge;if(a){var d=Ba(a);d&&("activex"===O.pluginType&&"readyState"in a?(a.style.display="none",function e(){if(4===a.readyState){for(var b in a)"function"==typeof a[b]&&(a[b]=null);a.parentNode&&a.parentNode.removeChild(a),d.parentNode&&d.parentNode.removeChild(d)}else i(e,10)}()):(a.parentNode&&a.parentNode.removeChild(a),d.parentNode&&d.parentNode.removeChild(d))),Qa(),O.ready=null,O.bridge=null,O.deactivated=null,c=b}},Ea=function(a){var b={},c={};if("object"==typeof a&&a){for(var d in a)if(d&&w.call(a,d)&&"string"==typeof a[d]&&a[d])switch(d.toLowerCase()){case"text/plain":case"text":case"air:text":case"flash:text":b.text=a[d],c.text=d;break;case"text/html":case"html":case"air:html":case"flash:html":b.html=a[d],c.html=d;break;case"application/rtf":case"text/rtf":case"rtf":case"richtext":case"air:rtf":case"flash:rtf":b.rtf=a[d],c.rtf=d}return{data:b,formatMap:c}}},Fa=function(a,b){if("object"!=typeof a||!a||"object"!=typeof b||!b)return a;var c={};for(var d in a)if(w.call(a,d))if("errors"===d){c[d]=a[d]?a[d].slice():[];for(var e=0,f=c[d].length;f>e;e++)c[d][e].format=b[c[d][e].format]}else if("success"!==d&&"data"!==d)c[d]=a[d];else{c[d]={};var g=a[d];for(var h in g)h&&w.call(g,h)&&w.call(b,h)&&(c[d][b[h]]=g[h])}return c},Ga=function(a,b){var c=null==b||b&&b.cacheBust===!0;return c?(-1===a.indexOf("?")?"?":"&")+"noCache="+t():""},Ha=function(a){var b,c,d,e,g="",h=[];if(a.trustedDomains&&("string"==typeof a.trustedDomains?e=[a.trustedDomains]:"object"==typeof a.trustedDomains&&"length"in a.trustedDomains&&(e=a.trustedDomains)),e&&e.length)for(b=0,c=e.length;c>b;b++)if(w.call(e,b)&&e[b]&&"string"==typeof e[b]){if(d=Ia(e[b]),!d)continue;if("*"===d){h.length=0,h.push(d);break}h.push.apply(h,[d,"//"+d,f.location.protocol+"//"+d])}return h.length&&(g+="trustedOrigins="+n(h.join(","))),a.forceEnhancedClipboard===!0&&(g+=(g?"&":"")+"forceEnhancedClipboard=true"),"string"==typeof a.swfObjectId&&a.swfObjectId&&(g+=(g?"&":"")+"swfObjectId="+n(a.swfObjectId)),"string"==typeof a.jsVersion&&a.jsVersion&&(g+=(g?"&":"")+"jsVersion="+n(a.jsVersion)),g},Ia=function(a){if(null==a||""===a)return null;if(a=a.replace(/^\s+|\s+$/g,""),""===a)return null;var b=a.indexOf("//");a=-1===b?a:a.slice(b+2);var c=a.indexOf("/");return a=-1===c?a:-1===b||0===c?null:a.slice(0,c),a&&".swf"===a.slice(-4).toLowerCase()?null:a||null},Ja=function(){var a=function(a){var b,c,d,e=[];if("string"==typeof a&&(a=[a]),"object"!=typeof a||!a||"number"!=typeof a.length)return e;for(b=0,c=a.length;c>b;b++)if(w.call(a,b)&&(d=Ia(a[b]))){if("*"===d){e.length=0,e.push("*");break}-1===e.indexOf(d)&&e.push(d)}return e};return function(b,c){var d=Ia(c.swfPath);null===d&&(d=b);var e=a(c.trustedDomains),f=e.length;if(f>0){if(1===f&&"*"===e[0])return"always";if(-1!==e.indexOf(b))return 1===f&&b===d?"sameDomain":"always"}return"never"}}(),Ka=function(){try{return g.activeElement}catch(a){return null}},La=function(a,b){var c,d,e,f=[];if("string"==typeof b&&b&&(f=b.split(/\s+/)),a&&1===a.nodeType&&f.length>0){for(e=(" "+(a.className||"")+" ").replace(/[\t\r\n\f]/g," "),c=0,d=f.length;d>c;c++)-1===e.indexOf(" "+f[c]+" ")&&(e+=f[c]+" ");e=e.replace(/^\s+|\s+$/g,""),e!==a.className&&(a.className=e)}return a},Ma=function(a,b){var c,d,e,f=[];if("string"==typeof b&&b&&(f=b.split(/\s+/)),a&&1===a.nodeType&&f.length>0&&a.className){for(e=(" "+a.className+" ").replace(/[\t\r\n\f]/g," "),c=0,d=f.length;d>c;c++)e=e.replace(" "+f[c]+" "," ");e=e.replace(/^\s+|\s+$/g,""),e!==a.className&&(a.className=e)}return a},Na=function(a,b){var c=m(a,null).getPropertyValue(b);return"cursor"!==b||c&&"auto"!==c||"A"!==a.nodeName?c:"pointer"},Oa=function(a){var b={left:0,top:0,width:0,height:0};if(a.getBoundingClientRect){var c=a.getBoundingClientRect(),d=f.pageXOffset,e=f.pageYOffset,h=g.documentElement.clientLeft||0,i=g.documentElement.clientTop||0,j=0,k=0;if("relative"===Na(g.body,"position")){var l=g.body.getBoundingClientRect(),m=g.documentElement.getBoundingClientRect();j=l.left-m.left||0,k=l.top-m.top||0}b.left=c.left+d-h-j,b.top=c.top+e-i-k,b.width="width"in c?c.width:c.right-c.left,b.height="height"in c?c.height:c.bottom-c.top}return b},Pa=function(a){if(!a)return!1;var b=m(a,null);if(!b)return!1;var c=r(b.height)>0,d=r(b.width)>0,e=r(b.top)>=0,f=r(b.left)>=0,g=c&&d&&e&&f,h=g?null:Oa(a),i="none"!==b.display&&"collapse"!==b.visibility&&(g||!!h&&(c||h.height>0)&&(d||h.width>0)&&(e||h.top>=0)&&(f||h.left>=0));return i},Qa=function(){j(T),T=0,l(U),U=0},Ra=function(){var a;if(d&&(a=Ba(O.bridge))){var b=Oa(d);A(a.style,{width:b.width+"px",height:b.height+"px",top:b.top+"px",left:b.left+"px",zIndex:""+Ta($.zIndex)})}},Sa=function(a){O.ready===!0&&(O.bridge&&"function"==typeof O.bridge.setHandCursor?O.bridge.setHandCursor(a):O.ready=!1)},Ta=function(a){if(/^(?:auto|inherit)$/.test(a))return a;var b;return"number"!=typeof a||s(a)?"string"==typeof a&&(b=Ta(q(a,10))):b=a,"number"==typeof b?b:"auto"},Ua=function(a){var b=/(\r\n|\r|\n)/g;return"string"==typeof a&&$.fixLineEndings===!0&&(M()?/((^|[^\r])\n|\r([^\n]|$))/.test(a)&&(a=a.replace(b,"\r\n")):/\r/.test(a)&&(a=a.replace(b,"\n"))),a},Va=function(b){var c,d,e,f=O.sandboxed,g=null;if(b=b===!0,N===!1)g=!1;else{try{d=a.frameElement||null}catch(h){e={name:h.name,message:h.message}}if(d&&1===d.nodeType&&"IFRAME"===d.nodeName)try{g=d.hasAttribute("sandbox")}catch(h){g=null}else{try{c=document.domain||null}catch(h){c=null}(null===c||e&&"SecurityError"===e.name&&/(^|[\s\(\[@])sandbox(es|ed|ing|[\s\.,!\)\]@]|$)/.test(e.message.toLowerCase()))&&(g=!0)}}return O.sandboxed=g,f===g||b||Wa(o),g},Wa=function(a){function b(a){var b=a.match(/[\d]+/g);return b.length=3,b.join(".")}function c(a){return!!a&&(a=a.toLowerCase())&&(/^(pepflashplayer\.dll|libpepflashplayer\.so|pepperflashplayer\.plugin)$/.test(a)||"chrome.plugin"===a.slice(-13))}function d(a){a&&(i=!0,a.version&&(l=b(a.version)),!l&&a.description&&(l=b(a.description)),a.filename&&(k=c(a.filename)))}var e,f,g,i=!1,j=!1,k=!1,l="";if(h.plugins&&h.plugins.length)e=h.plugins["Shockwave Flash"],d(e),h.plugins["Shockwave Flash 2.0"]&&(i=!0,l="2.0.0.11");else if(h.mimeTypes&&h.mimeTypes.length)g=h.mimeTypes["application/x-shockwave-flash"],e=g&&g.enabledPlugin,d(e);else if("undefined"!=typeof a){j=!0;try{f=new a("ShockwaveFlash.ShockwaveFlash.7"),i=!0,l=b(f.GetVariable("$version"))}catch(m){try{f=new a("ShockwaveFlash.ShockwaveFlash.6"),i=!0,l="6.0.21"}catch(n){try{f=new a("ShockwaveFlash.ShockwaveFlash"),i=!0,l=b(f.GetVariable("$version"))}catch(o){j=!1}}}}O.disabled=i!==!0,O.outdated=l&&r(l)<r(P),O.version=l||"0.0.0",O.pluginType=k?"pepper":j?"activex":i?"netscape":"unknown"};Wa(o),Va(!0);var Xa=function(){return this instanceof Xa?void("function"==typeof Xa._createClient&&Xa._createClient.apply(this,z(arguments))):new Xa};v(Xa,"version",{value:"2.3.0-beta.1",writable:!1,configurable:!0,enumerable:!0}),Xa.config=function(){return _.apply(this,z(arguments))},Xa.state=function(){return aa.apply(this,z(arguments))},Xa.isFlashUnusable=function(){return ba.apply(this,z(arguments))},Xa.on=function(){return ca.apply(this,z(arguments))},Xa.off=function(){return da.apply(this,z(arguments))},Xa.handlers=function(){return ea.apply(this,z(arguments))},Xa.emit=function(){return fa.apply(this,z(arguments))},Xa.create=function(){return ga.apply(this,z(arguments))},Xa.destroy=function(){return ha.apply(this,z(arguments))},Xa.setData=function(){return ia.apply(this,z(arguments))},Xa.clearData=function(){return ja.apply(this,z(arguments))},Xa.getData=function(){return ka.apply(this,z(arguments))},Xa.focus=Xa.activate=function(){return la.apply(this,z(arguments))},Xa.blur=Xa.deactivate=function(){return ma.apply(this,z(arguments))},Xa.activeElement=function(){return na.apply(this,z(arguments))};var Ya=0,Za={},$a=0,_a={},ab={};A($,{autoActivate:!0});var bb=function(a){var b=this;b.id=""+Ya++,Za[b.id]={instance:b,elements:[],handlers:{}},a&&b.clip(a),Xa.on("*",function(a){return b.emit(a)}),Xa.on("destroy",function(){b.destroy()}),Xa.create()},cb=function(a,d){var e,f,g,h={},i=Za[this.id],j=i&&i.handlers;if(!i)throw new Error("Attempted to add new listener(s) to a destroyed ZeroClipboard client instance");if("string"==typeof a&&a)g=a.toLowerCase().split(/\s+/);else if("object"==typeof a&&a&&"undefined"==typeof d)for(e in a)w.call(a,e)&&"string"==typeof e&&e&&"function"==typeof a[e]&&this.on(e,a[e]);if(g&&g.length){for(e=0,f=g.length;f>e;e++)a=g[e].replace(/^on/,""),h[a]=!0,j[a]||(j[a]=[]),j[a].push(d);if(h.ready&&O.ready&&this.emit({type:"ready",client:this}),h.error){for(e=0,f=X.length;f>e;e++)if(O[X[e].replace(/^flash-/,"")]){this.emit({type:"error",name:X[e],client:this});break}c!==b&&Xa.version!==c&&this.emit({type:"error",name:"version-mismatch",jsVersion:Xa.version,swfVersion:c})}}return this},db=function(a,b){var c,d,e,f,g,h=Za[this.id],i=h&&h.handlers;if(!i)return this;if(0===arguments.length)f=u(i);else if("string"==typeof a&&a)f=a.split(/\s+/);else if("object"==typeof a&&a&&"undefined"==typeof b)for(c in a)w.call(a,c)&&"string"==typeof c&&c&&"function"==typeof a[c]&&this.off(c,a[c]);if(f&&f.length)for(c=0,d=f.length;d>c;c++)if(a=f[c].toLowerCase().replace(/^on/,""),g=i[a],g&&g.length)if(b)for(e=g.indexOf(b);-1!==e;)g.splice(e,1),e=g.indexOf(b,e);else g.length=0;return this},eb=function(a){var b=null,c=Za[this.id]&&Za[this.id].handlers;return c&&(b="string"==typeof a&&a?c[a]?c[a].slice(0):[]:B(c)),b},fb=function(a){if(kb.call(this,a)){"object"==typeof a&&a&&"string"==typeof a.type&&a.type&&(a=A({},a));var b=A({},pa(a),{client:this});lb.call(this,b)}return this},gb=function(a){if(!Za[this.id])throw new Error("Attempted to clip element(s) to a destroyed ZeroClipboard client instance");a=mb(a);for(var b=0;b<a.length;b++)if(w.call(a,b)&&a[b]&&1===a[b].nodeType){a[b].zcClippingId?-1===_a[a[b].zcClippingId].indexOf(this.id)&&_a[a[b].zcClippingId].push(this.id):(a[b].zcClippingId="zcClippingId_"+$a++,_a[a[b].zcClippingId]=[this.id],$.autoActivate===!0&&nb(a[b]));var c=Za[this.id]&&Za[this.id].elements;-1===c.indexOf(a[b])&&c.push(a[b])}return this},hb=function(a){var b=Za[this.id];if(!b)return this;var c,d=b.elements;a="undefined"==typeof a?d.slice(0):mb(a);for(var e=a.length;e--;)if(w.call(a,e)&&a[e]&&1===a[e].nodeType){for(c=0;-1!==(c=d.indexOf(a[e],c));)d.splice(c,1);var f=_a[a[e].zcClippingId];if(f){for(c=0;-1!==(c=f.indexOf(this.id,c));)f.splice(c,1);0===f.length&&($.autoActivate===!0&&ob(a[e]),delete a[e].zcClippingId)}}return this},ib=function(){var a=Za[this.id];return a&&a.elements?a.elements.slice(0):[]},jb=function(){Za[this.id]&&(this.unclip(),this.off(),delete Za[this.id])},kb=function(a){if(!a||!a.type)return!1;if(a.client&&a.client!==this)return!1;var b=Za[this.id],c=b&&b.elements,d=!!c&&c.length>0,e=!a.target||d&&-1!==c.indexOf(a.target),f=a.relatedTarget&&d&&-1!==c.indexOf(a.relatedTarget),g=a.client&&a.client===this;return b&&(e||f||g)?!0:!1},lb=function(a){var b=Za[this.id];if("object"==typeof a&&a&&a.type&&b){var c=sa(a),d=b&&b.handlers["*"]||[],e=b&&b.handlers[a.type]||[],g=d.concat(e);if(g&&g.length){var h,i,j,k,l,m=this;for(h=0,i=g.length;i>h;h++)j=g[h],k=m,"string"==typeof j&&"function"==typeof f[j]&&(j=f[j]),"object"==typeof j&&j&&"function"==typeof j.handleEvent&&(k=j,j=j.handleEvent),"function"==typeof j&&(l=A({},a),ta(j,k,[l],c))}}},mb=function(a){return"string"==typeof a&&(a=[]),"number"!=typeof a.length?[a]:a},nb=function(a){if(a&&1===a.nodeType){var b=function(a){(a||(a=f.event))&&("js"!==a._source&&(a.stopImmediatePropagation(),a.preventDefault()),delete a._source)},c=function(c){(c||(c=f.event))&&(b(c),Xa.focus(a))};a.addEventListener("mouseover",c,!1),a.addEventListener("mouseout",b,!1),a.addEventListener("mouseenter",b,!1),a.addEventListener("mouseleave",b,!1),a.addEventListener("mousemove",b,!1),ab[a.zcClippingId]={mouseover:c,mouseout:b,mouseenter:b,mouseleave:b,mousemove:b}}},ob=function(a){if(a&&1===a.nodeType){var b=ab[a.zcClippingId];if("object"==typeof b&&b){for(var c,d,e=["move","leave","enter","out","over"],f=0,g=e.length;g>f;f++)c="mouse"+e[f],d=b[c],"function"==typeof d&&a.removeEventListener(c,d,!1);delete ab[a.zcClippingId]}}};Xa._createClient=function(){bb.apply(this,z(arguments))},Xa.prototype.on=function(){return cb.apply(this,z(arguments))},Xa.prototype.off=function(){return db.apply(this,z(arguments))},Xa.prototype.handlers=function(){return eb.apply(this,z(arguments))},Xa.prototype.emit=function(){return fb.apply(this,z(arguments))},Xa.prototype.clip=function(){return gb.apply(this,z(arguments))},Xa.prototype.unclip=function(){return hb.apply(this,z(arguments))},Xa.prototype.elements=function(){return ib.apply(this,z(arguments))},Xa.prototype.destroy=function(){return jb.apply(this,z(arguments))},Xa.prototype.setText=function(a){if(!Za[this.id])throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");return Xa.setData("text/plain",a),this},Xa.prototype.setHtml=function(a){if(!Za[this.id])throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");return Xa.setData("text/html",a),this},Xa.prototype.setRichText=function(a){if(!Za[this.id])throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");return Xa.setData("application/rtf",a),this},Xa.prototype.setData=function(){if(!Za[this.id])throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");return Xa.setData.apply(this,z(arguments)),this},Xa.prototype.clearData=function(){if(!Za[this.id])throw new Error("Attempted to clear pending clipboard data from a destroyed ZeroClipboard client instance");return Xa.clearData.apply(this,z(arguments)),this},Xa.prototype.getData=function(){if(!Za[this.id])throw new Error("Attempted to get pending clipboard data from a destroyed ZeroClipboard client instance");return Xa.getData.apply(this,z(arguments))},"function"==typeof define&&define.amd?define(function(){return Xa}):"object"==typeof module&&module&&"object"==typeof module.exports&&module.exports?module.exports=Xa:a.ZeroClipboard=Xa}(function(){return this||window}());
//# sourceMappingURL=ZeroClipboard.min.map
/* ========================================================================
 * Bootstrap: affix.js v3.2.0
 * http://getbootstrap.com/javascript/#affix
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+ function($) {
	'use strict';
	// AFFIX CLASS DEFINITION
	// ======================

	var Affix = function(element, options) {
		this.options = $.extend({}, Affix.DEFAULTS, options)

		this.$target = $(this.options.target)
			.on('scroll.bs.affix.data-api', $.proxy(this.checkPosition, this))
			.on('click.bs.affix.data-api', $.proxy(this.checkPositionWithEventLoop, this))

		this.$element = $(element)
		this.affixed =
			this.unpin =
			this.pinnedOffset = null

		this.checkPosition()
	}

	Affix.VERSION = '3.2.0'

	Affix.RESET = 'affix affix-top affix-bottom'

	Affix.DEFAULTS = {
		offset: 0,
		target: window
	}

	Affix.prototype.getPinnedOffset = function() {
		if (this.pinnedOffset) return this.pinnedOffset
		this.$element.removeClass(Affix.RESET).addClass('affix')
		var scrollTop = this.$target.scrollTop()
		var position = this.$element.offset()
		return (this.pinnedOffset = position.top - scrollTop)
	}

	Affix.prototype.checkPositionWithEventLoop = function() {
		setTimeout($.proxy(this.checkPosition, this), 1)
	}

	Affix.prototype.checkPosition = function() {
		if (!this.$element.is(':visible')) return

		var scrollHeight = $(document).height()
		var scrollTop = this.$target.scrollTop()
		var position = this.$element.offset()
		var offset = this.options.offset
		var offsetTop = offset.top
		var offsetBottom = offset.bottom

		if (typeof offset != 'object') offsetBottom = offsetTop = offset
		if (typeof offsetTop == 'function') offsetTop = offset.top(this.$element)
		if (typeof offsetBottom == 'function') offsetBottom = offset.bottom(this.$element)

		var affix = this.unpin != null && (scrollTop + this.unpin <= position.top) ? false :
			offsetBottom != null && (position.top + this.$element.height() >= scrollHeight - offsetBottom) ? 'bottom' :
			offsetTop != null && (scrollTop <= offsetTop) ? 'top' : false

		if (this.affixed === affix) return
		if (this.unpin != null) this.$element.css('top', '')

		var affixType = 'affix' + (affix ? '-' + affix : '')
		var e = $.Event(affixType + '.bs.affix')

		this.$element.trigger(e)

		if (e.isDefaultPrevented()) return

		this.affixed = affix
		this.unpin = affix == 'bottom' ? this.getPinnedOffset() : null

		this.$element
			.removeClass(Affix.RESET)
			.addClass(affixType)
			.trigger($.Event(affixType.replace('affix', 'affixed')))

		if (affix == 'bottom') {
			this.$element.offset({
				top: scrollHeight - this.$element.height() - offsetBottom
			})
		}
	}


	// AFFIX PLUGIN DEFINITION
	// =======================

	function Plugin(option) {
		return this.each(function() {
			var $this = $(this)
			var data = $this.data('bs.affix')
			var options = typeof option == 'object' && option

			if (!data) $this.data('bs.affix', (data = new Affix(this, options)))
			if (typeof option == 'string') data[option]()
		})
	}

	var old = $.fn.affix

	$.fn.affix = Plugin
	$.fn.affix.Constructor = Affix


	// AFFIX NO CONFLICT
	// =================

	$.fn.affix.noConflict = function() {
		$.fn.affix = old
		return this
	}


	// AFFIX DATA-API
	// ==============

	$(window).on('load', function() {
		$('[data-spy="affix"]').each(function() {
			var $spy = $(this)
			var data = $spy.data()

			data.offset = data.offset || {}

			if (data.offsetBottom) data.offset.bottom = data.offsetBottom
			if (data.offsetTop) data.offset.top = data.offsetTop

			Plugin.call($spy, data)
		})
	})

}(jQuery);

/* ========================================================================
 * Bootstrap: alert.js v3.2.0
 * http://getbootstrap.com/javascript/#alerts
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+ function($) {
	'use strict';

	// ALERT CLASS DEFINITION
	// ======================

	var dismiss = '[data-dismiss="alert"]'
	var Alert = function(el) {
		$(el).on('click', dismiss, this.close)
	}

	Alert.VERSION = '3.2.0'

	Alert.prototype.close = function(e) {
		var $this = $(this)
		var selector = $this.attr('data-target')

		if (!selector) {
			selector = $this.attr('href')
			selector = selector && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
		}

		var $parent = $(selector)

		if (e) e.preventDefault()

		if (!$parent.length) {
			$parent = $this.hasClass('alert') ? $this : $this.parent()
		}

		$parent.trigger(e = $.Event('close.bs.alert'))

		if (e.isDefaultPrevented()) return

		$parent.removeClass('in')

		function removeElement() {
			// detach from parent, fire event then clean up data
			$parent.detach().trigger('closed.bs.alert').remove()
		}

		$.support.transition && $parent.hasClass('fade') ?
			$parent
			.one('bsTransitionEnd', removeElement)
			.emulateTransitionEnd(150) :
			removeElement()
	}


	// ALERT PLUGIN DEFINITION
	// =======================

	function Plugin(option) {
		return this.each(function() {
			var $this = $(this)
			var data = $this.data('bs.alert')

			if (!data) $this.data('bs.alert', (data = new Alert(this)))
			if (typeof option == 'string') data[option].call($this)
		})
	}

	var old = $.fn.alert

	$.fn.alert = Plugin
	$.fn.alert.Constructor = Alert


	// ALERT NO CONFLICT
	// =================

	$.fn.alert.noConflict = function() {
		$.fn.alert = old
		return this
	}


	// ALERT DATA-API
	// ==============

	$(document).on('click.bs.alert.data-api', dismiss, Alert.prototype.close)

}(jQuery);

/* ========================================================================
 * Bootstrap: button.js v3.2.0
 * http://getbootstrap.com/javascript/#buttons
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+ function($) {
	'use strict';

	// BUTTON PUBLIC CLASS DEFINITION
	// ==============================

	var Button = function(element, options) {
		this.$element = $(element)
		this.options = $.extend({}, Button.DEFAULTS, options)
		this.isLoading = false
	}

	Button.VERSION = '3.2.0'

	Button.DEFAULTS = {
		loadingText: 'loading...'
	}

	Button.prototype.setState = function(state) {
		var d = 'disabled'
		var $el = this.$element
		var val = $el.is('input') ? 'val' : 'html'
		var data = $el.data()

		state = state + 'Text'

		if (data.resetText == null) $el.data('resetText', $el[val]())

		$el[val](data[state] == null ? this.options[state] : data[state])

		// push to event loop to allow forms to submit
		setTimeout($.proxy(function() {
			if (state == 'loadingText') {
				this.isLoading = true
				$el.addClass(d).attr(d, d)
			} else if (this.isLoading) {
				this.isLoading = false
				$el.removeClass(d).removeAttr(d)
			}
		}, this), 0)
	}

	Button.prototype.toggle = function() {
		var changed = true
		var $parent = this.$element.closest('[data-toggle="buttons"]')

		if ($parent.length) {
			var $input = this.$element.find('input')
			if ($input.prop('type') == 'radio') {
				if ($input.prop('checked') && this.$element.hasClass('active')) changed = false
				else $parent.find('.active').removeClass('active')
			}
			if (changed) $input.prop('checked', !this.$element.hasClass('active')).trigger('change')
		}

		if (changed) this.$element.toggleClass('active')
	}


	// BUTTON PLUGIN DEFINITION
	// ========================

	function Plugin(option) {
		return this.each(function() {
			var $this = $(this)
			var data = $this.data('bs.button')
			var options = typeof option == 'object' && option

			if (!data) $this.data('bs.button', (data = new Button(this, options)))

			if (option == 'toggle') data.toggle()
			else if (option) data.setState(option)
		})
	}

	var old = $.fn.button

	$.fn.button = Plugin
	$.fn.button.Constructor = Button


	// BUTTON NO CONFLICT
	// ==================

	$.fn.button.noConflict = function() {
		$.fn.button = old
		return this
	}


	// BUTTON DATA-API
	// ===============

	$(document).on('click.bs.button.data-api', '[data-toggle^="button"]', function(e) {
		var $btn = $(e.target)
		if (!$btn.hasClass('btn')) $btn = $btn.closest('.btn')
		Plugin.call($btn, 'toggle')
		e.preventDefault()
	})

}(jQuery);

/* ========================================================================
 * Bootstrap: carousel.js v3.2.0
 * http://getbootstrap.com/javascript/#carousel
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+ function($) {
	'use strict';

	// CAROUSEL CLASS DEFINITION
	// =========================

	var Carousel = function(element, options) {
		this.$element = $(element).on('keydown.bs.carousel', $.proxy(this.keydown, this))
		this.$indicators = this.$element.find('.carousel-indicators')
		this.options = options
		this.paused =
			this.sliding =
			this.interval =
			this.$active =
			this.$items = null

		this.options.pause == 'hover' && this.$element
			.on('mouseenter.bs.carousel', $.proxy(this.pause, this))
			.on('mouseleave.bs.carousel', $.proxy(this.cycle, this))
	}

	Carousel.VERSION = '3.2.0'

	Carousel.DEFAULTS = {
		interval: 5000,
		pause: 'hover',
		wrap: true
	}

	Carousel.prototype.keydown = function(e) {
		switch (e.which) {
			case 37:
				this.prev();
				break
			case 39:
				this.next();
				break
			default:
				return
		}

		e.preventDefault()
	}

	Carousel.prototype.cycle = function(e) {
		e || (this.paused = false)

		this.interval && clearInterval(this.interval)

		this.options.interval && !this.paused && (this.interval = setInterval($.proxy(this.next, this), this.options.interval))

		return this
	}

	Carousel.prototype.getItemIndex = function(item) {
		this.$items = item.parent().children('.item')
		return this.$items.index(item || this.$active)
	}

	Carousel.prototype.to = function(pos) {
		var that = this
		var activeIndex = this.getItemIndex(this.$active = this.$element.find('.item.active'))

		if (pos > (this.$items.length - 1) || pos < 0) return

		if (this.sliding) return this.$element.one('slid.bs.carousel', function() {
				that.to(pos)
			}) // yes, "slid"
		if (activeIndex == pos) return this.pause().cycle()

		return this.slide(pos > activeIndex ? 'next' : 'prev', $(this.$items[pos]))
	}

	Carousel.prototype.pause = function(e) {
		e || (this.paused = true)

		if (this.$element.find('.next, .prev').length && $.support.transition) {
			this.$element.trigger($.support.transition.end)
			this.cycle(true)
		}

		this.interval = clearInterval(this.interval)

		return this
	}

	Carousel.prototype.next = function() {
		if (this.sliding) return
		return this.slide('next')
	}

	Carousel.prototype.prev = function() {
		if (this.sliding) return
		return this.slide('prev')
	}

	Carousel.prototype.slide = function(type, next) {
		var $active = this.$element.find('.item.active')
		var $next = next || $active[type]()
		var isCycling = this.interval
		var direction = type == 'next' ? 'left' : 'right'
		var fallback = type == 'next' ? 'first' : 'last'
		var that = this

		if (!$next.length) {
			if (!this.options.wrap) return
			$next = this.$element.find('.item')[fallback]()
		}

		if ($next.hasClass('active')) return (this.sliding = false)

		var relatedTarget = $next[0]
		var slideEvent = $.Event('slide.bs.carousel', {
			relatedTarget: relatedTarget,
			direction: direction
		})
		this.$element.trigger(slideEvent)
		if (slideEvent.isDefaultPrevented()) return

		this.sliding = true

		isCycling && this.pause()

		if (this.$indicators.length) {
			this.$indicators.find('.active').removeClass('active')
			var $nextIndicator = $(this.$indicators.children()[this.getItemIndex($next)])
			$nextIndicator && $nextIndicator.addClass('active')
		}

		var slidEvent = $.Event('slid.bs.carousel', {
				relatedTarget: relatedTarget,
				direction: direction
			}) // yes, "slid"
		if ($.support.transition && this.$element.hasClass('slide')) {
			$next.addClass(type)
			$next[0].offsetWidth // force reflow
			$active.addClass(direction)
			$next.addClass(direction)
			$active
				.one('bsTransitionEnd', function() {
					$next.removeClass([type, direction].join(' ')).addClass('active')
					$active.removeClass(['active', direction].join(' '))
					that.sliding = false
					setTimeout(function() {
						that.$element.trigger(slidEvent)
					}, 0)
				})
				.emulateTransitionEnd($active.css('transition-duration').slice(0, -1) * 1000)
		} else {
			$active.removeClass('active')
			$next.addClass('active')
			this.sliding = false
			this.$element.trigger(slidEvent)
		}

		isCycling && this.cycle()

		return this
	}


	// CAROUSEL PLUGIN DEFINITION
	// ==========================

	function Plugin(option) {
		return this.each(function() {
			var $this = $(this)
			var data = $this.data('bs.carousel')
			var options = $.extend({}, Carousel.DEFAULTS, $this.data(), typeof option == 'object' && option)
			var action = typeof option == 'string' ? option : options.slide

			if (!data) $this.data('bs.carousel', (data = new Carousel(this, options)))
			if (typeof option == 'number') data.to(option)
			else if (action) data[action]()
			else if (options.interval) data.pause().cycle()
		})
	}

	var old = $.fn.carousel

	$.fn.carousel = Plugin
	$.fn.carousel.Constructor = Carousel


	// CAROUSEL NO CONFLICT
	// ====================

	$.fn.carousel.noConflict = function() {
		$.fn.carousel = old
		return this
	}


	// CAROUSEL DATA-API
	// =================

	$(document).on('click.bs.carousel.data-api', '[data-slide], [data-slide-to]', function(e) {
		var href
		var $this = $(this)
		var $target = $($this.attr('data-target') || (href = $this.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '')) // strip for ie7
		if (!$target.hasClass('carousel')) return
		var options = $.extend({}, $target.data(), $this.data())
		var slideIndex = $this.attr('data-slide-to')
		if (slideIndex) options.interval = false

		Plugin.call($target, options)

		if (slideIndex) {
			$target.data('bs.carousel').to(slideIndex)
		}

		e.preventDefault()
	})

	$(window).on('load', function() {
		$('[data-ride="carousel"]').each(function() {
			var $carousel = $(this)
			Plugin.call($carousel, $carousel.data())
		})
	})

}(jQuery);

/* ========================================================================
 * Bootstrap: collapse.js v3.2.0
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+ function($) {
	'use strict';

	// COLLAPSE PUBLIC CLASS DEFINITION
	// ================================

	var Collapse = function(element, options) {
		this.$element = $(element)
		this.options = $.extend({}, Collapse.DEFAULTS, options)
		this.transitioning = null

		if (this.options.parent) this.$parent = $(this.options.parent)
		if (this.options.toggle) this.toggle()
	}

	Collapse.VERSION = '3.2.0'

	Collapse.DEFAULTS = {
		toggle: true
	}

	Collapse.prototype.dimension = function() {
		var hasWidth = this.$element.hasClass('width')
		return hasWidth ? 'width' : 'height'
	}

	Collapse.prototype.show = function() {
		if (this.transitioning || this.$element.hasClass('in')) return

		var startEvent = $.Event('show.bs.collapse')
		this.$element.trigger(startEvent)
		if (startEvent.isDefaultPrevented()) return

		var actives = this.$parent && this.$parent.find('> .panel > .in')

		if (actives && actives.length) {
			var hasData = actives.data('bs.collapse')
			if (hasData && hasData.transitioning) return
			Plugin.call(actives, 'hide')
			hasData || actives.data('bs.collapse', null)
		}

		var dimension = this.dimension()

		this.$element
			.removeClass('collapse')
			.addClass('collapsing')[dimension](0)

		this.transitioning = 1

		var complete = function() {
			this.$element
				.removeClass('collapsing')
				.addClass('collapse in')[dimension]('')
			this.transitioning = 0
			this.$element
				.trigger('shown.bs.collapse')
		}

		if (!$.support.transition) return complete.call(this)

		var scrollSize = $.camelCase(['scroll', dimension].join('-'))

		this.$element
			.one('bsTransitionEnd', $.proxy(complete, this))
			.emulateTransitionEnd(350)[dimension](this.$element[0][scrollSize])
	}

	Collapse.prototype.hide = function() {
		if (this.transitioning || !this.$element.hasClass('in')) return

		var startEvent = $.Event('hide.bs.collapse')
		this.$element.trigger(startEvent)
		if (startEvent.isDefaultPrevented()) return

		var dimension = this.dimension()

		this.$element[dimension](this.$element[dimension]())[0].offsetHeight

		this.$element
			.addClass('collapsing')
			.removeClass('collapse')
			.removeClass('in')

		this.transitioning = 1

		var complete = function() {
			this.transitioning = 0
			this.$element
				.trigger('hidden.bs.collapse')
				.removeClass('collapsing')
				.addClass('collapse')
		}

		if (!$.support.transition) return complete.call(this)

		this.$element[dimension](0)
			.one('bsTransitionEnd', $.proxy(complete, this))
			.emulateTransitionEnd(350)
	}

	Collapse.prototype.toggle = function() {
		this[this.$element.hasClass('in') ? 'hide' : 'show']()
	}


	// COLLAPSE PLUGIN DEFINITION
	// ==========================

	function Plugin(option) {
		return this.each(function() {
			var $this = $(this)
			var data = $this.data('bs.collapse')
			var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

			if (!data && options.toggle && option == 'show') option = !option
			if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
			if (typeof option == 'string') data[option]()
		})
	}

	var old = $.fn.collapse

	$.fn.collapse = Plugin
	$.fn.collapse.Constructor = Collapse


	// COLLAPSE NO CONFLICT
	// ====================

	$.fn.collapse.noConflict = function() {
		$.fn.collapse = old
		return this
	}


	// COLLAPSE DATA-API
	// =================

	$(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function(e) {
		var href
		var $this = $(this)
		var target = $this.attr('data-target') || e.preventDefault() || (href = $this.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7
		var $target = $(target)
		var data = $target.data('bs.collapse')
		var option = data ? 'toggle' : $this.data()
		var parent = $this.attr('data-parent')
		var $parent = parent && $(parent)

		if (!data || !data.transitioning) {
			if ($parent) $parent.find('[data-toggle="collapse"][data-parent="' + parent + '"]').not($this).addClass('collapsed')
			$this[$target.hasClass('in') ? 'addClass' : 'removeClass']('collapsed')
		}

		Plugin.call($target, option)
	})

}(jQuery);

/* ========================================================================
 * Bootstrap: dropdown.js v3.2.0
 * http://getbootstrap.com/javascript/#dropdowns
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+ function($) {
	'use strict';

	// DROPDOWN CLASS DEFINITION
	// =========================

	var backdrop = '.dropdown-backdrop'
	var toggle = '[data-toggle="dropdown"]'
	var Dropdown = function(element) {
		$(element).on('click.bs.dropdown', this.toggle)
	}

	Dropdown.VERSION = '3.2.0'

	Dropdown.prototype.toggle = function(e) {
		var $this = $(this)

		if ($this.is('.disabled, :disabled')) return

		var $parent = getParent($this)
		var isActive = $parent.hasClass('open')

		clearMenus()

		if (!isActive) {
			if ('ontouchstart' in document.documentElement && !$parent.closest('.navbar-nav').length) {
				// if mobile we use a backdrop because click events don't delegate
				$('<div class="dropdown-backdrop"/>').insertAfter($(this)).on('click', clearMenus)
			}

			var relatedTarget = {
				relatedTarget: this
			}
			$parent.trigger(e = $.Event('show.bs.dropdown', relatedTarget))

			if (e.isDefaultPrevented()) return

			$this.trigger('focus')

			$parent
				.toggleClass('open')
				.trigger('shown.bs.dropdown', relatedTarget)
		}

		return false
	}

	Dropdown.prototype.keydown = function(e) {
		if (!/(38|40|27)/.test(e.keyCode)) return

		var $this = $(this)

		e.preventDefault()
		e.stopPropagation()

		if ($this.is('.disabled, :disabled')) return

		var $parent = getParent($this)
		var isActive = $parent.hasClass('open')

		if (!isActive || (isActive && e.keyCode == 27)) {
			if (e.which == 27) $parent.find(toggle).trigger('focus')
			return $this.trigger('click')
		}

		var desc = ' li:not(.divider):visible a'
		var $items = $parent.find('[role="menu"]' + desc + ', [role="listbox"]' + desc)

		if (!$items.length) return

		var index = $items.index($items.filter(':focus'))

		if (e.keyCode == 38 && index > 0) index-- // up
			if (e.keyCode == 40 && index < $items.length - 1) index++ // down
				if (!~index) index = 0

		$items.eq(index).trigger('focus')
	}

	function clearMenus(e) {
		if (e && e.which === 3) return
		$(backdrop).remove()
		$(toggle).each(function() {
			var $parent = getParent($(this))
			var relatedTarget = {
				relatedTarget: this
			}
			if (!$parent.hasClass('open')) return
			$parent.trigger(e = $.Event('hide.bs.dropdown', relatedTarget))
			if (e.isDefaultPrevented()) return
			$parent.removeClass('open').trigger('hidden.bs.dropdown', relatedTarget)
		})
	}

	function getParent($this) {
		var selector = $this.attr('data-target')

		if (!selector) {
			selector = $this.attr('href')
			selector = selector && /#[A-Za-z]/.test(selector) && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
		}

		var $parent = selector && $(selector)

		return $parent && $parent.length ? $parent : $this.parent()
	}


	// DROPDOWN PLUGIN DEFINITION
	// ==========================

	function Plugin(option) {
		return this.each(function() {
			var $this = $(this)
			var data = $this.data('bs.dropdown')

			if (!data) $this.data('bs.dropdown', (data = new Dropdown(this)))
			if (typeof option == 'string') data[option].call($this)
		})
	}

	var old = $.fn.dropdown

	$.fn.dropdown = Plugin
	$.fn.dropdown.Constructor = Dropdown


	// DROPDOWN NO CONFLICT
	// ====================

	$.fn.dropdown.noConflict = function() {
		$.fn.dropdown = old
		return this
	}


	// APPLY TO STANDARD DROPDOWN ELEMENTS
	// ===================================

	$(document)
		.on('click.bs.dropdown.data-api', clearMenus)
		.on('click.bs.dropdown.data-api', '.dropdown form', function(e) {
			e.stopPropagation()
		})
		.on('click.bs.dropdown.data-api', toggle, Dropdown.prototype.toggle)
		.on('keydown.bs.dropdown.data-api', toggle + ', [role="menu"], [role="listbox"]', Dropdown.prototype.keydown)

}(jQuery);

/* ========================================================================
 * Bootstrap: tab.js v3.2.0
 * http://getbootstrap.com/javascript/#tabs
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+ function($) {
	'use strict';

	// TAB CLASS DEFINITION
	// ====================

	var Tab = function(element) {
		this.element = $(element)
	}

	Tab.VERSION = '3.2.0'

	Tab.prototype.show = function() {
		var $this = this.element
		var $ul = $this.closest('ul:not(.dropdown-menu)')
		var selector = $this.data('target')

		if (!selector) {
			selector = $this.attr('href')
			selector = selector && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
		}

		if ($this.parent('li').hasClass('active')) return

		var previous = $ul.find('.active:last a')[0]
		var e = $.Event('show.bs.tab', {
			relatedTarget: previous
		})

		$this.trigger(e)

		if (e.isDefaultPrevented()) return

		var $target = $(selector)

		this.activate($this.closest('li'), $ul)
		this.activate($target, $target.parent(), function() {
			$this.trigger({
				type: 'shown.bs.tab',
				relatedTarget: previous
			})
		})
	}

	Tab.prototype.activate = function(element, container, callback) {
		var $active = container.find('> .active')
		var transition = callback && $.support.transition && $active.hasClass('fade')

		function next() {
			$active
				.removeClass('active')
				.find('> .dropdown-menu > .active')
				.removeClass('active')

			element.addClass('active')

			if (transition) {
				element[0].offsetWidth // reflow for transition
				element.addClass('in')
			} else {
				element.removeClass('fade')
			}

			if (element.parent('.dropdown-menu')) {
				element.closest('li.dropdown').addClass('active')
			}

			callback && callback()
		}

		transition ?
			$active
			.one('bsTransitionEnd', next)
			.emulateTransitionEnd(150) :
			next()

		$active.removeClass('in')
	}


	// TAB PLUGIN DEFINITION
	// =====================

	function Plugin(option) {
		return this.each(function() {
			var $this = $(this)
			var data = $this.data('bs.tab')

			if (!data) $this.data('bs.tab', (data = new Tab(this)))
			if (typeof option == 'string') data[option]()
		})
	}

	var old = $.fn.tab

	$.fn.tab = Plugin
	$.fn.tab.Constructor = Tab


	// TAB NO CONFLICT
	// ===============

	$.fn.tab.noConflict = function() {
		$.fn.tab = old
		return this
	}


	// TAB DATA-API
	// ============

	$(document).on('click.bs.tab.data-api', '[data-toggle="tab"], [data-toggle="pill"]', function(e) {
		e.preventDefault()
		Plugin.call($(this), 'show')
	})

}(jQuery);

/* ========================================================================
 * Bootstrap: transition.js v3.2.0
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+ function($) {
	'use strict';

	// CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
	// ============================================================

	function transitionEnd() {
		var el = document.createElement('bootstrap')

		var transEndEventNames = {
			WebkitTransition: 'webkitTransitionEnd',
			MozTransition: 'transitionend',
			OTransition: 'oTransitionEnd otransitionend',
			transition: 'transitionend'
		}

		for (var name in transEndEventNames) {
			if (el.style[name] !== undefined) {
				return {
					end: transEndEventNames[name]
				}
			}
		}

		return false // explicit for ie8 (  ._.)
	}

	// http://blog.alexmaccaw.com/css-transitions
	$.fn.emulateTransitionEnd = function(duration) {
		var called = false
		var $el = this
		$(this).one('bsTransitionEnd', function() {
			called = true
		})
		var callback = function() {
			if (!called) $($el).trigger($.support.transition.end)
		}
		setTimeout(callback, duration)
		return this
	}

	$(function() {
		$.support.transition = transitionEnd()

		if (!$.support.transition) return

		$.event.special.bsTransitionEnd = {
			bindType: $.support.transition.end,
			delegateType: $.support.transition.end,
			handle: function(e) {
				if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
			}
		}
	})

}(jQuery);

/* ========================================================================
 * Bootstrap: scrollspy.js v3.2.0
 * http://getbootstrap.com/javascript/#scrollspy
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+ function($) {
	'use strict';

	// SCROLLSPY CLASS DEFINITION
	// ==========================

	function ScrollSpy(element, options) {
		var process = $.proxy(this.process, this)

		this.$body = $('body')
		this.$scrollElement = $(element).is('body') ? $(window) : $(element)
		this.options = $.extend({}, ScrollSpy.DEFAULTS, options)
		this.selector = (this.options.target || '') + ' .nav li > a'
		this.offsets = []
		this.targets = []
		this.activeTarget = null
		this.scrollHeight = 0

		this.$scrollElement.on('scroll.bs.scrollspy', process)
		this.refresh()
		this.process()
	}

	ScrollSpy.VERSION = '3.2.0'

	ScrollSpy.DEFAULTS = {
		offset: 10
	}

	ScrollSpy.prototype.getScrollHeight = function() {
		return this.$scrollElement[0].scrollHeight || Math.max(this.$body[0].scrollHeight, document.documentElement.scrollHeight)
	}

	ScrollSpy.prototype.refresh = function() {
		var offsetMethod = 'offset'
		var offsetBase = 0

		if (!$.isWindow(this.$scrollElement[0])) {
			offsetMethod = 'position'
			offsetBase = this.$scrollElement.scrollTop()
		}

		this.offsets = []
		this.targets = []
		this.scrollHeight = this.getScrollHeight()

		var self = this

		this.$body
			.find(this.selector)
			.map(function() {
				var $el = $(this)
				var href = $el.data('target') || $el.attr('href')
				var $href = /^#./.test(href) && $(href)

				return ($href && $href.length && $href.is(':visible') && [
					[$href[offsetMethod]().top + offsetBase, href]
				]) || null
			})
			.sort(function(a, b) {
				return a[0] - b[0]
			})
			.each(function() {
				self.offsets.push(this[0])
				self.targets.push(this[1])
			})
	}

	ScrollSpy.prototype.process = function() {
		var scrollTop = this.$scrollElement.scrollTop() + this.options.offset
		var scrollHeight = this.getScrollHeight()
		var maxScroll = this.options.offset + scrollHeight - this.$scrollElement.height()
		var offsets = this.offsets
		var targets = this.targets
		var activeTarget = this.activeTarget
		var i

		if (this.scrollHeight != scrollHeight) {
			this.refresh()
		}

		if (scrollTop >= maxScroll) {
			return activeTarget != (i = targets[targets.length - 1]) && this.activate(i)
		}

		if (activeTarget && scrollTop <= offsets[0]) {
			return activeTarget != (i = targets[0]) && this.activate(i)
		}

		for (i = offsets.length; i--;) {
			activeTarget != targets[i] && scrollTop >= offsets[i] && (!offsets[i + 1] || scrollTop <= offsets[i + 1]) && this.activate(targets[i])
		}
	}

	ScrollSpy.prototype.activate = function(target) {
		this.activeTarget = target

		$(this.selector)
			.parentsUntil(this.options.target, '.active')
			.removeClass('active')

		var selector = this.selector +
			'[data-target="' + target + '"],' +
			this.selector + '[href="' + target + '"]'

		var active = $(selector)
			.parents('li')
			.addClass('active')

		if (active.parent('.dropdown-menu').length) {
			active = active
				.closest('li.dropdown')
				.addClass('active')
		}

		active.trigger('activate.bs.scrollspy')
	}


	// SCROLLSPY PLUGIN DEFINITION
	// ===========================

	function Plugin(option) {
		return this.each(function() {
			var $this = $(this)
			var data = $this.data('bs.scrollspy')
			var options = typeof option == 'object' && option

			if (!data) $this.data('bs.scrollspy', (data = new ScrollSpy(this, options)))
			if (typeof option == 'string') data[option]()
		})
	}

	var old = $.fn.scrollspy

	$.fn.scrollspy = Plugin
	$.fn.scrollspy.Constructor = ScrollSpy


	// SCROLLSPY NO CONFLICT
	// =====================

	$.fn.scrollspy.noConflict = function() {
		$.fn.scrollspy = old
		return this
	}


	// SCROLLSPY DATA-API
	// ==================

	$(window).on('load.bs.scrollspy.data-api', function() {
		$('[data-spy="scroll"]').each(function() {
			var $spy = $(this)
			Plugin.call($spy, $spy.data())
		})
	})

}(jQuery);

/* ========================================================================
 * Bootstrap: modal.js v3.2.0
 * http://getbootstrap.com/javascript/#modals
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+ function($) {
	'use strict';

	// MODAL CLASS DEFINITION
	// ======================

	var Modal = function(element, options) {
		this.options = options
		this.$body = $(document.body)
		this.$element = $(element)
		this.$backdrop =
			this.isShown = null
		this.scrollbarWidth = 0

		if (this.options.remote) {
			this.$element
				.find('.modal-content')
				.load(this.options.remote, $.proxy(function() {
					this.$element.trigger('loaded.bs.modal')
				}, this))
		}
	}

	Modal.VERSION = '3.2.0'

	Modal.DEFAULTS = {
		backdrop: true,
		keyboard: true,
		show: true
	}

	Modal.prototype.toggle = function(_relatedTarget) {
		return this.isShown ? this.hide() : this.show(_relatedTarget)
	}

	Modal.prototype.show = function(_relatedTarget) {
		var that = this
		var e = $.Event('show.bs.modal', {
			relatedTarget: _relatedTarget
		})

		this.$element.trigger(e)

		if (this.isShown || e.isDefaultPrevented()) return

		this.isShown = true

		this.checkScrollbar()
		this.$body.addClass('modal-open')

		this.setScrollbar()
		this.escape()

		this.$element.on('click.dismiss.bs.modal', '[data-dismiss="modal"]', $.proxy(this.hide, this))

		this.backdrop(function() {
			var transition = $.support.transition && that.$element.hasClass('fade')

			if (!that.$element.parent().length) {
				that.$element.appendTo(that.$body) // don't move modals dom position
			}

			that.$element
				.show()
				.scrollTop(0)

			if (transition) {
				that.$element[0].offsetWidth // force reflow
			}

			that.$element
				.addClass('in')
				.attr('aria-hidden', false)

			that.enforceFocus()

			var e = $.Event('shown.bs.modal', {
				relatedTarget: _relatedTarget
			})

			transition ?
				that.$element.find('.modal-dialog') // wait for modal to slide in
			.one('bsTransitionEnd', function() {
				that.$element.trigger('focus').trigger(e)
			})
				.emulateTransitionEnd(300) :
				that.$element.trigger('focus').trigger(e)
		})
	}

	Modal.prototype.hide = function(e) {
		if (e) e.preventDefault()

		e = $.Event('hide.bs.modal')

		this.$element.trigger(e)

		if (!this.isShown || e.isDefaultPrevented()) return

		this.isShown = false

		this.$body.removeClass('modal-open')

		this.resetScrollbar()
		this.escape()

		$(document).off('focusin.bs.modal')

		this.$element
			.removeClass('in')
			.attr('aria-hidden', true)
			.off('click.dismiss.bs.modal')

		$.support.transition && this.$element.hasClass('fade') ?
			this.$element
			.one('bsTransitionEnd', $.proxy(this.hideModal, this))
			.emulateTransitionEnd(300) :
			this.hideModal()
	}

	Modal.prototype.enforceFocus = function() {
		$(document)
			.off('focusin.bs.modal') // guard against infinite focus loop
		.on('focusin.bs.modal', $.proxy(function(e) {
			if (this.$element[0] !== e.target && !this.$element.has(e.target).length) {
				this.$element.trigger('focus')
			}
		}, this))
	}

	Modal.prototype.escape = function() {
		if (this.isShown && this.options.keyboard) {
			this.$element.on('keyup.dismiss.bs.modal', $.proxy(function(e) {
				e.which == 27 && this.hide()
			}, this))
		} else if (!this.isShown) {
			this.$element.off('keyup.dismiss.bs.modal')
		}
	}

	Modal.prototype.hideModal = function() {
		var that = this
		this.$element.hide()
		this.backdrop(function() {
			that.$element.trigger('hidden.bs.modal')
		})
	}

	Modal.prototype.removeBackdrop = function() {
		this.$backdrop && this.$backdrop.remove()
		this.$backdrop = null
	}

	Modal.prototype.backdrop = function(callback) {
		var that = this
		var animate = this.$element.hasClass('fade') ? 'fade' : ''

		if (this.isShown && this.options.backdrop) {
			var doAnimate = $.support.transition && animate

			this.$backdrop = $('<div class="modal-backdrop ' + animate + '" />')
				.appendTo(this.$body)

			this.$element.on('click.dismiss.bs.modal', $.proxy(function(e) {
				if (e.target !== e.currentTarget) return
				this.options.backdrop == 'static' ? this.$element[0].focus.call(this.$element[0]) : this.hide.call(this)
			}, this))

			if (doAnimate) this.$backdrop[0].offsetWidth // force reflow

			this.$backdrop.addClass('in')

			if (!callback) return

			doAnimate ?
				this.$backdrop
				.one('bsTransitionEnd', callback)
				.emulateTransitionEnd(150) :
				callback()

		} else if (!this.isShown && this.$backdrop) {
			this.$backdrop.removeClass('in')

			var callbackRemove = function() {
				that.removeBackdrop()
				callback && callback()
			}
			$.support.transition && this.$element.hasClass('fade') ?
				this.$backdrop
				.one('bsTransitionEnd', callbackRemove)
				.emulateTransitionEnd(150) :
				callbackRemove()

		} else if (callback) {
			callback()
		}
	}

	Modal.prototype.checkScrollbar = function() {
		if (document.body.clientWidth >= window.innerWidth) return
		this.scrollbarWidth = this.scrollbarWidth || this.measureScrollbar()
	}

	Modal.prototype.setScrollbar = function() {
		var bodyPad = parseInt((this.$body.css('padding-right') || 0), 10)
		if (this.scrollbarWidth) this.$body.css('padding-right', bodyPad + this.scrollbarWidth)
	}

	Modal.prototype.resetScrollbar = function() {
		this.$body.css('padding-right', '')
	}

	Modal.prototype.measureScrollbar = function() { // thx walsh
		var scrollDiv = document.createElement('div')
		scrollDiv.className = 'modal-scrollbar-measure'
		this.$body.append(scrollDiv)
		var scrollbarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth
		this.$body[0].removeChild(scrollDiv)
		return scrollbarWidth
	}


	// MODAL PLUGIN DEFINITION
	// =======================

	function Plugin(option, _relatedTarget) {
		return this.each(function() {
			var $this = $(this)
			var data = $this.data('bs.modal')
			var options = $.extend({}, Modal.DEFAULTS, $this.data(), typeof option == 'object' && option)

			if (!data) $this.data('bs.modal', (data = new Modal(this, options)))
			if (typeof option == 'string') data[option](_relatedTarget)
			else if (options.show) data.show(_relatedTarget)
		})
	}

	var old = $.fn.modal

	$.fn.modal = Plugin
	$.fn.modal.Constructor = Modal


	// MODAL NO CONFLICT
	// =================

	$.fn.modal.noConflict = function() {
		$.fn.modal = old
		return this
	}


	// MODAL DATA-API
	// ==============

	$(document).on('click.bs.modal.data-api', '[data-toggle="modal"]', function(e) {
		var $this = $(this)
		var href = $this.attr('href')
		var $target = $($this.attr('data-target') || (href && href.replace(/.*(?=#[^\s]+$)/, ''))) // strip for ie7
		var option = $target.data('bs.modal') ? 'toggle' : $.extend({
			remote: !/#/.test(href) && href
		}, $target.data(), $this.data())

		if ($this.is('a')) e.preventDefault()

		$target.one('show.bs.modal', function(showEvent) {
			if (showEvent.isDefaultPrevented()) return // only register focus restorer if modal will actually get shown
			$target.one('hidden.bs.modal', function() {
				$this.is(':visible') && $this.trigger('focus')
			})
		})
		Plugin.call($target, option, this)
	})

}(jQuery);

/* ========================================================================
 * Bootstrap: tooltip.js v3.2.0
 * http://getbootstrap.com/javascript/#tooltip
 * Inspired by the original jQuery.tipsy by Jason Frame
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+ function($) {
	'use strict';

	// TOOLTIP PUBLIC CLASS DEFINITION
	// ===============================

	var Tooltip = function(element, options) {
		this.type =
			this.options =
			this.enabled =
			this.timeout =
			this.hoverState =
			this.$element = null

		this.init('tooltip', element, options)
	}

	Tooltip.VERSION = '3.2.0'

	Tooltip.DEFAULTS = {
		animation: true,
		placement: 'top',
		selector: false,
		template: '<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',
		trigger: 'hover focus',
		title: '',
		delay: 0,
		html: false,
		container: false,
		viewport: {
			selector: 'body',
			padding: 0
		}
	}

	Tooltip.prototype.init = function(type, element, options) {
		this.enabled = true
		this.type = type
		this.$element = $(element)
		this.options = this.getOptions(options)
		this.$viewport = this.options.viewport && $(this.options.viewport.selector || this.options.viewport)

		var triggers = this.options.trigger.split(' ')

		for (var i = triggers.length; i--;) {
			var trigger = triggers[i]

			if (trigger == 'click') {
				this.$element.on('click.' + this.type, this.options.selector, $.proxy(this.toggle, this))
			} else if (trigger != 'manual') {
				var eventIn = trigger == 'hover' ? 'mouseenter' : 'focusin'
				var eventOut = trigger == 'hover' ? 'mouseleave' : 'focusout'

				this.$element.on(eventIn + '.' + this.type, this.options.selector, $.proxy(this.enter, this))
				this.$element.on(eventOut + '.' + this.type, this.options.selector, $.proxy(this.leave, this))
			}
		}

		this.options.selector ?
			(this._options = $.extend({}, this.options, {
			trigger: 'manual',
			selector: ''
		})) :
			this.fixTitle()
	}

	Tooltip.prototype.getDefaults = function() {
		return Tooltip.DEFAULTS
	}

	Tooltip.prototype.getOptions = function(options) {
		options = $.extend({}, this.getDefaults(), this.$element.data(), options)

		if (options.delay && typeof options.delay == 'number') {
			options.delay = {
				show: options.delay,
				hide: options.delay
			}
		}

		return options
	}

	Tooltip.prototype.getDelegateOptions = function() {
		var options = {}
		var defaults = this.getDefaults()

		this._options && $.each(this._options, function(key, value) {
			if (defaults[key] != value) options[key] = value
		})

		return options
	}

	Tooltip.prototype.enter = function(obj) {
		var self = obj instanceof this.constructor ?
			obj : $(obj.currentTarget).data('bs.' + this.type)

		if (!self) {
			self = new this.constructor(obj.currentTarget, this.getDelegateOptions())
			$(obj.currentTarget).data('bs.' + this.type, self)
		}

		clearTimeout(self.timeout)

		self.hoverState = 'in'

		if (!self.options.delay || !self.options.delay.show) return self.show()

		self.timeout = setTimeout(function() {
			if (self.hoverState == 'in') self.show()
		}, self.options.delay.show)
	}

	Tooltip.prototype.leave = function(obj) {
		var self = obj instanceof this.constructor ?
			obj : $(obj.currentTarget).data('bs.' + this.type)

		if (!self) {
			self = new this.constructor(obj.currentTarget, this.getDelegateOptions())
			$(obj.currentTarget).data('bs.' + this.type, self)
		}

		clearTimeout(self.timeout)

		self.hoverState = 'out'

		if (!self.options.delay || !self.options.delay.hide) return self.hide()

		self.timeout = setTimeout(function() {
			if (self.hoverState == 'out') self.hide()
		}, self.options.delay.hide)
	}

	Tooltip.prototype.show = function() {
		var e = $.Event('show.bs.' + this.type)

		if (this.hasContent() && this.enabled) {
			this.$element.trigger(e)

			var inDom = $.contains(document.documentElement, this.$element[0])
			if (e.isDefaultPrevented() || !inDom) return
			var that = this

			var $tip = this.tip()

			var tipId = this.getUID(this.type)

			this.setContent()
			$tip.attr('id', tipId)
			this.$element.attr('aria-describedby', tipId)

			if (this.options.animation) $tip.addClass('fade')

			var placement = typeof this.options.placement == 'function' ?
				this.options.placement.call(this, $tip[0], this.$element[0]) :
				this.options.placement

			var autoToken = /\s?auto?\s?/i
			var autoPlace = autoToken.test(placement)
			if (autoPlace) placement = placement.replace(autoToken, '') || 'top'

			$tip
				.detach()
				.css({
					top: 0,
					left: 0,
					display: 'block'
				})
				.addClass(placement)
				.data('bs.' + this.type, this)

			this.options.container ? $tip.appendTo(this.options.container) : $tip.insertAfter(this.$element)

			var pos = this.getPosition()
			var actualWidth = $tip[0].offsetWidth
			var actualHeight = $tip[0].offsetHeight

			if (autoPlace) {
				var orgPlacement = placement
				var $parent = this.$element.parent()
				var parentDim = this.getPosition($parent)

				placement = placement == 'bottom' && pos.top + pos.height + actualHeight - parentDim.scroll > parentDim.height ? 'top' :
					placement == 'top' && pos.top - parentDim.scroll - actualHeight < 0 ? 'bottom' :
					placement == 'right' && pos.right + actualWidth > parentDim.width ? 'left' :
					placement == 'left' && pos.left - actualWidth < parentDim.left ? 'right' :
					placement

				$tip
					.removeClass(orgPlacement)
					.addClass(placement)
			}

			var calculatedOffset = this.getCalculatedOffset(placement, pos, actualWidth, actualHeight)

			this.applyPlacement(calculatedOffset, placement)

			var complete = function() {
				that.$element.trigger('shown.bs.' + that.type)
				that.hoverState = null
			}

			$.support.transition && this.$tip.hasClass('fade') ?
				$tip
				.one('bsTransitionEnd', complete)
				.emulateTransitionEnd(150) :
				complete()
		}
	}

	Tooltip.prototype.applyPlacement = function(offset, placement) {
		var $tip = this.tip()
		var width = $tip[0].offsetWidth
		var height = $tip[0].offsetHeight

		// manually read margins because getBoundingClientRect includes difference
		var marginTop = parseInt($tip.css('margin-top'), 10)
		var marginLeft = parseInt($tip.css('margin-left'), 10)

		// we must check for NaN for ie 8/9
		if (isNaN(marginTop)) marginTop = 0
		if (isNaN(marginLeft)) marginLeft = 0

		offset.top = offset.top + marginTop
		offset.left = offset.left + marginLeft

		// $.fn.offset doesn't round pixel values
		// so we use setOffset directly with our own function B-0
		$.offset.setOffset($tip[0], $.extend({
			using: function(props) {
				$tip.css({
					top: Math.round(props.top),
					left: Math.round(props.left)
				})
			}
		}, offset), 0)

		$tip.addClass('in')

		// check to see if placing tip in new offset caused the tip to resize itself
		var actualWidth = $tip[0].offsetWidth
		var actualHeight = $tip[0].offsetHeight

		if (placement == 'top' && actualHeight != height) {
			offset.top = offset.top + height - actualHeight
		}

		var delta = this.getViewportAdjustedDelta(placement, offset, actualWidth, actualHeight)

		if (delta.left) offset.left += delta.left
		else offset.top += delta.top

		var arrowDelta = delta.left ? delta.left * 2 - width + actualWidth : delta.top * 2 - height + actualHeight
		var arrowPosition = delta.left ? 'left' : 'top'
		var arrowOffsetPosition = delta.left ? 'offsetWidth' : 'offsetHeight'

		$tip.offset(offset)
		this.replaceArrow(arrowDelta, $tip[0][arrowOffsetPosition], arrowPosition)
	}

	Tooltip.prototype.replaceArrow = function(delta, dimension, position) {
		this.arrow().css(position, delta ? (50 * (1 - delta / dimension) + '%') : '')
	}

	Tooltip.prototype.setContent = function() {
		var $tip = this.tip()
		var title = this.getTitle()

		$tip.find('.tooltip-inner')[this.options.html ? 'html' : 'text'](title)
		$tip.removeClass('fade in top bottom left right')
	}

	Tooltip.prototype.hide = function() {
		var that = this
		var $tip = this.tip()
		var e = $.Event('hide.bs.' + this.type)

		this.$element.removeAttr('aria-describedby')

		function complete() {
			if (that.hoverState != 'in') $tip.detach()
			that.$element.trigger('hidden.bs.' + that.type)
		}

		this.$element.trigger(e)

		if (e.isDefaultPrevented()) return

		$tip.removeClass('in')

		$.support.transition && this.$tip.hasClass('fade') ?
			$tip
			.one('bsTransitionEnd', complete)
			.emulateTransitionEnd(150) :
			complete()

		this.hoverState = null

		return this
	}

	Tooltip.prototype.fixTitle = function() {
		var $e = this.$element
		if ($e.attr('title') || typeof($e.attr('data-original-title')) != 'string') {
			$e.attr('data-original-title', $e.attr('title') || '').attr('title', '')
		}
	}

	Tooltip.prototype.hasContent = function() {
		return this.getTitle()
	}

	Tooltip.prototype.getPosition = function($element) {
		$element = $element || this.$element
		var el = $element[0]
		var isBody = el.tagName == 'BODY'
		return $.extend({}, (typeof el.getBoundingClientRect == 'function') ? el.getBoundingClientRect() : null, {
			scroll: isBody ? document.documentElement.scrollTop || document.body.scrollTop : $element.scrollTop(),
			width: isBody ? $(window).width() : $element.outerWidth(),
			height: isBody ? $(window).height() : $element.outerHeight()
		}, isBody ? {
			top: 0,
			left: 0
		} : $element.offset())
	}

	Tooltip.prototype.getCalculatedOffset = function(placement, pos, actualWidth, actualHeight) {
		return placement == 'bottom' ? {
				top: pos.top + pos.height,
				left: pos.left + pos.width / 2 - actualWidth / 2
			} :
			placement == 'top' ? {
				top: pos.top - actualHeight,
				left: pos.left + pos.width / 2 - actualWidth / 2
			} :
			placement == 'left' ? {
				top: pos.top + pos.height / 2 - actualHeight / 2,
				left: pos.left - actualWidth
			} :
			/* placement == 'right' */
			{
				top: pos.top + pos.height / 2 - actualHeight / 2,
				left: pos.left + pos.width
			}

	}

	Tooltip.prototype.getViewportAdjustedDelta = function(placement, pos, actualWidth, actualHeight) {
		var delta = {
			top: 0,
			left: 0
		}
		if (!this.$viewport) return delta

		var viewportPadding = this.options.viewport && this.options.viewport.padding || 0
		var viewportDimensions = this.getPosition(this.$viewport)

		if (/right|left/.test(placement)) {
			var topEdgeOffset = pos.top - viewportPadding - viewportDimensions.scroll
			var bottomEdgeOffset = pos.top + viewportPadding - viewportDimensions.scroll + actualHeight
			if (topEdgeOffset < viewportDimensions.top) { // top overflow
				delta.top = viewportDimensions.top - topEdgeOffset
			} else if (bottomEdgeOffset > viewportDimensions.top + viewportDimensions.height) { // bottom overflow
				delta.top = viewportDimensions.top + viewportDimensions.height - bottomEdgeOffset
			}
		} else {
			var leftEdgeOffset = pos.left - viewportPadding
			var rightEdgeOffset = pos.left + viewportPadding + actualWidth
			if (leftEdgeOffset < viewportDimensions.left) { // left overflow
				delta.left = viewportDimensions.left - leftEdgeOffset
			} else if (rightEdgeOffset > viewportDimensions.width) { // right overflow
				delta.left = viewportDimensions.left + viewportDimensions.width - rightEdgeOffset
			}
		}

		return delta
	}

	Tooltip.prototype.getTitle = function() {
		var title
		var $e = this.$element
		var o = this.options

		title = $e.attr('data-original-title') || (typeof o.title == 'function' ? o.title.call($e[0]) : o.title)

		return title
	}

	Tooltip.prototype.getUID = function(prefix) {
		do prefix += ~~(Math.random() * 1000000)
		while (document.getElementById(prefix))
		return prefix
	}

	Tooltip.prototype.tip = function() {
		return (this.$tip = this.$tip || $(this.options.template))
	}

	Tooltip.prototype.arrow = function() {
		return (this.$arrow = this.$arrow || this.tip().find('.tooltip-arrow'))
	}

	Tooltip.prototype.validate = function() {
		if (!this.$element[0].parentNode) {
			this.hide()
			this.$element = null
			this.options = null
		}
	}

	Tooltip.prototype.enable = function() {
		this.enabled = true
	}

	Tooltip.prototype.disable = function() {
		this.enabled = false
	}

	Tooltip.prototype.toggleEnabled = function() {
		this.enabled = !this.enabled
	}

	Tooltip.prototype.toggle = function(e) {
		var self = this
		if (e) {
			self = $(e.currentTarget).data('bs.' + this.type)
			if (!self) {
				self = new this.constructor(e.currentTarget, this.getDelegateOptions())
				$(e.currentTarget).data('bs.' + this.type, self)
			}
		}

		self.tip().hasClass('in') ? self.leave(self) : self.enter(self)
	}

	Tooltip.prototype.destroy = function() {
		clearTimeout(this.timeout)
		this.hide().$element.off('.' + this.type).removeData('bs.' + this.type)
	}


	// TOOLTIP PLUGIN DEFINITION
	// =========================

	function Plugin(option) {
		return this.each(function() {
			var $this = $(this)
			var data = $this.data('bs.tooltip')
			var options = typeof option == 'object' && option

			if (!data && option == 'destroy') return
			if (!data) $this.data('bs.tooltip', (data = new Tooltip(this, options)))
			if (typeof option == 'string') data[option]()
		})
	}

	var old = $.fn.tooltip

	$.fn.tooltip = Plugin
	$.fn.tooltip.Constructor = Tooltip


	// TOOLTIP NO CONFLICT
	// ===================

	$.fn.tooltip.noConflict = function() {
		$.fn.tooltip = old
		return this
	}

}(jQuery);

/* ========================================================================
 * Bootstrap: popover.js v3.2.0
 * http://getbootstrap.com/javascript/#popovers
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+ function($) {
	'use strict';

	// POPOVER PUBLIC CLASS DEFINITION
	// ===============================

	var Popover = function(element, options) {
		this.init('popover', element, options)
	}

	if (!$.fn.tooltip) throw new Error('Popover requires tooltip.js')

	Popover.VERSION = '3.2.0'

	Popover.DEFAULTS = $.extend({}, $.fn.tooltip.Constructor.DEFAULTS, {
		placement: 'right',
		trigger: 'click',
		content: '',
		template: '<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'
	})


	// NOTE: POPOVER EXTENDS tooltip.js
	// ================================

	Popover.prototype = $.extend({}, $.fn.tooltip.Constructor.prototype)

	Popover.prototype.constructor = Popover

	Popover.prototype.getDefaults = function() {
		return Popover.DEFAULTS
	}

	Popover.prototype.setContent = function() {
		var $tip = this.tip()
		var title = this.getTitle()
		var content = this.getContent()

		$tip.find('.popover-title')[this.options.html ? 'html' : 'text'](title)
		$tip.find('.popover-content').empty()[ // we use append for html objects to maintain js events
			this.options.html ? (typeof content == 'string' ? 'html' : 'append') : 'text'
		](content)

		$tip.removeClass('fade top bottom left right in')

		// IE8 doesn't accept hiding via the `:empty` pseudo selector, we have to do
		// this manually by checking the contents.
		if (!$tip.find('.popover-title').html()) $tip.find('.popover-title').hide()
	}

	Popover.prototype.hasContent = function() {
		return this.getTitle() || this.getContent()
	}

	Popover.prototype.getContent = function() {
		var $e = this.$element
		var o = this.options

		return $e.attr('data-content') || (typeof o.content == 'function' ?
			o.content.call($e[0]) :
			o.content)
	}

	Popover.prototype.arrow = function() {
		return (this.$arrow = this.$arrow || this.tip().find('.arrow'))
	}

	Popover.prototype.tip = function() {
		if (!this.$tip) this.$tip = $(this.options.template)
		return this.$tip
	}


	// POPOVER PLUGIN DEFINITION
	// =========================

	function Plugin(option) {
		return this.each(function() {
			var $this = $(this)
			var data = $this.data('bs.popover')
			var options = typeof option == 'object' && option

			if (!data && option == 'destroy') return
			if (!data) $this.data('bs.popover', (data = new Popover(this, options)))
			if (typeof option == 'string') data[option]()
		})
	}

	var old = $.fn.popover

	$.fn.popover = Plugin
	$.fn.popover.Constructor = Popover


	// POPOVER NO CONFLICT
	// ===================

	$.fn.popover.noConflict = function() {
		$.fn.popover = old
		return this
	}

}(jQuery);

/*************************************************************************************************************!
 * Bootstrap-select v1.6.2 (http://silviomoreto.github.io/bootstrap-select/)
 *
 * Copyright 2013-2014 bootstrap-select
 * Licensed under MIT (https://github.com/silviomoreto/bootstrap-select/blob/master/LICENSE)
 */
(function($) {
	'use strict';

	// Case insensitive search
	$.expr[':'].icontains = function(obj, index, meta) {
		return icontains($(obj).text(), meta[3]);
	};

	// Case and accent insensitive search
	$.expr[':'].aicontains = function(obj, index, meta) {
		return icontains($(obj).data('normalizedText') || $(obj).text(), meta[3]);
	};

	/**
	 * Actual implementation of the case insensitive search.
	 * @access private
	 * @param {String} haystack
	 * @param {String} needle
	 * @returns {boolean}
	 */
	function icontains(haystack, needle) {
		return haystack.toUpperCase().indexOf(needle.toUpperCase()) > -1;
	}

	/**
	 * Remove all diatrics from the given text.
	 * @access private
	 * @param {String} text
	 * @returns {String}
	 */
	function normalizeToBase(text) {
		var rExps = [{
			re: /[\xC0-\xC6]/g,
			ch: "A"
		}, {
			re: /[\xE0-\xE6]/g,
			ch: "a"
		}, {
			re: /[\xC8-\xCB]/g,
			ch: "E"
		}, {
			re: /[\xE8-\xEB]/g,
			ch: "e"
		}, {
			re: /[\xCC-\xCF]/g,
			ch: "I"
		}, {
			re: /[\xEC-\xEF]/g,
			ch: "i"
		}, {
			re: /[\xD2-\xD6]/g,
			ch: "O"
		}, {
			re: /[\xF2-\xF6]/g,
			ch: "o"
		}, {
			re: /[\xD9-\xDC]/g,
			ch: "U"
		}, {
			re: /[\xF9-\xFC]/g,
			ch: "u"
		}, {
			re: /[\xC7-\xE7]/g,
			ch: "c"
		}, {
			re: /[\xD1]/g,
			ch: "N"
		}, {
			re: /[\xF1]/g,
			ch: "n"
		}];
		$.each(rExps, function() {
			text = text.replace(this.re, this.ch);
		});
		return text;
	}

	var Selectpicker = function(element, options, e) {
		if (e) {
			e.stopPropagation();
			e.preventDefault();
		}

		this.$element = $(element);
		this.$newElement = null;
		this.$button = null;
		this.$menu = null;
		this.$lis = null;
		this.options = options;

		// If we have no title yet, try to pull it from the html title attribute (jQuery doesnt' pick it up as it's not a
		// data-attribute)
		if (this.options.title === null) {
			this.options.title = this.$element.attr('title');
		}

		//Expose public methods
		this.val = Selectpicker.prototype.val;
		this.render = Selectpicker.prototype.render;
		this.refresh = Selectpicker.prototype.refresh;
		this.setStyle = Selectpicker.prototype.setStyle;
		this.selectAll = Selectpicker.prototype.selectAll;
		this.deselectAll = Selectpicker.prototype.deselectAll;
		this.destroy = Selectpicker.prototype.remove;
		this.remove = Selectpicker.prototype.remove;
		this.show = Selectpicker.prototype.show;
		this.hide = Selectpicker.prototype.hide;

		this.init();
	};

	Selectpicker.VERSION = '1.6.2';

	// part of this is duplicated in i18n/defaults-en_US.js. Make sure to update both.
	Selectpicker.DEFAULTS = {
		noneSelectedText: 'Nothing selected',
		noneResultsText: 'No results match',
		countSelectedText: function(numSelected, numTotal) {
			return (numSelected == 1) ? "{0} item selected" : "{0} items selected";
		},
		maxOptionsText: function(numAll, numGroup) {
			var arr = [];

			arr[0] = (numAll == 1) ? 'Limit reached ({n} item max)' : 'Limit reached ({n} items max)';
			arr[1] = (numGroup == 1) ? 'Group limit reached ({n} item max)' : 'Group limit reached ({n} items max)';

			return arr;
		},
		selectAllText: 'Select All',
		deselectAllText: 'Deselect All',
		multipleSeparator: ', ',
		style: 'btn-select',
		size: 'auto',
		title: 'string',
		selectedTextFormat: 'values',
		width: false,
		container: false,
		hideDisabled: false,
		showSubtext: false,
		showIcon: true,
		showContent: true,
		dropupAuto: true,
		header: false,
		liveSearch: false,
		actionsBox: false,
		iconBase: 'glyphicon',
		tickIcon: 'glyphicon-ok',
		maxOptions: false,
		mobile: false,
		selectOnTab: false,
		dropdownAlignRight: false,
		searchAccentInsensitive: false
	};

	Selectpicker.prototype = {

		constructor: Selectpicker,

		init: function() {
			var that = this,
				id = this.$element.attr('id');

			this.$element.hide();
			this.multiple = this.$element.prop('multiple');
			this.autofocus = this.$element.prop('autofocus');
			this.$newElement = this.createView();
			this.$element.after(this.$newElement);
			this.$menu = this.$newElement.find('> .dropdown-menu');
			this.$button = this.$newElement.find('> button');
			this.$searchbox = this.$newElement.find('input');

			if (this.options.dropdownAlignRight)
				this.$menu.addClass('dropdown-menu-right');

			if (typeof id !== 'undefined') {
				this.$button.attr('data-id', id);
				$('label[for="' + id + '"]').click(function(e) {
					e.preventDefault();
					that.$button.focus();
				});
			}

			this.checkDisabled();
			this.clickListener();
			if (this.options.liveSearch) this.liveSearchListener();
			this.render();
			this.liHeight();
			this.setStyle();
			this.setWidth();
			if (this.options.container) this.selectPosition();
			this.$menu.data('this', this);
			this.$newElement.data('this', this);
			if (this.options.mobile) this.mobile();
		},

		createDropdown: function() {
			// Options
			// If we are multiple, then add the show-tick class by default
			var multiple = this.multiple ? ' show-tick' : '',
				inputGroup = this.$element.parent().hasClass('input-group') ? ' input-group-btn' : '',
				autofocus = this.autofocus ? ' autofocus' : '',
				btnSize = this.$element.parents().hasClass('form-group-lg') ? ' btn-lg' : (this.$element.parents().hasClass('form-group-sm') ? ' btn-sm' : '');
			// Elements
			var header = this.options.header ? '<div class="popover-title"><button type="button" class="close" aria-hidden="true">&times;</button>' + this.options.header + '</div>' : '';
			var searchbox = this.options.liveSearch ? '<div class="bs-searchbox"><input type="text" class="input-block-level form-control" autocomplete="off" /></div>' : '';
			var actionsbox = this.options.actionsBox ? '<div class="bs-actionsbox">' +
				'<div class="btn-group btn-block">' +
				'<button class="actions-btn bs-select-all btn btn-sm btn-default">' +
				this.options.selectAllText +
				'</button>' +
				'<button class="actions-btn bs-deselect-all btn btn-sm btn-default">' +
				this.options.deselectAllText +
				'</button>' +
				'</div>' +
				'</div>' : '';
			var drop =
				'<div class="btn-group bootstrap-select' + multiple + inputGroup + '">' +
				'<button type="button" class="btn dropdown-toggle selectpicker' + btnSize + '" data-toggle="dropdown"' + autofocus + '>' +
				'<span class="filter-option pull-left"></span>&nbsp;' +
				'<span class="caret"></span>' +
				'</button>' +
				'<div class="dropdown-menu open">' +
				header +
				searchbox +
				actionsbox +
				'<ul class="dropdown-menu inner selectpicker" role="menu">' +
				'</ul>' +
				'</div>' +
				'</div>';

			return $(drop);
		},

		createView: function() {
			var $drop = this.createDropdown();
			var $li = this.createLi();
			$drop.find('ul').append($li);
			return $drop;
		},

		reloadLi: function() {
			//Remove all children.
			this.destroyLi();
			//Re build
			var $li = this.createLi();
			this.$menu.find('ul').append($li);
		},

		destroyLi: function() {
			this.$menu.find('li').remove();
		},

		createLi: function() {
			var that = this,
				_li = [],
				optID = 0;

			// Helper functions
			/**
			 * @param content
			 * @param [index]
			 * @param [classes]
			 * @returns {string}
			 */
			var generateLI = function(content, index, classes) {
				return '<li' +
					(typeof classes !== 'undefined' ? ' class="' + classes + '"' : '') +
					(typeof index !== 'undefined' | null === index ? ' data-original-index="' + index + '"' : '') +
					'>' + content + '</li>';
			};

			/**
			 * @param text
			 * @param [classes]
			 * @param [inline]
			 * @param [optgroup]
			 * @returns {string}
			 */
			var generateA = function(text, classes, inline, optgroup) {
				var normText = normalizeToBase($.trim($("<div/>").html(text).text()).replace(/\s\s+/g, ' '));
				return '<a tabindex="0"' +
					(typeof classes !== 'undefined' ? ' class="' + classes + '"' : '') +
					(typeof inline !== 'undefined' ? ' style="' + inline + '"' : '') +
					(typeof optgroup !== 'undefined' ? 'data-optgroup="' + optgroup + '"' : '') +
					' data-normalized-text="' + normText + '"' +
					'>' + text +
					'<span class="' + that.options.iconBase + ' ' + that.options.tickIcon + ' check-mark"></span>' +
					'</a>';
			};

			this.$element.find('option').each(function() {
				var $this = $(this);

				// Get the class and text for the option
				var optionClass = $this.attr('class') || '',
					inline = $this.attr('style'),
					text = $this.data('content') ? $this.data('content') : $this.html(),
					subtext = typeof $this.data('subtext') !== 'undefined' ? '<small class="muted text-muted">' + $this.data('subtext') + '</small>' : '',
					icon = typeof $this.data('icon') !== 'undefined' ? '<span class="' + that.options.iconBase + ' ' + $this.data('icon') + '"></span> ' : '',
					isDisabled = $this.is(':disabled') || $this.parent().is(':disabled'),
					index = $this[0].index;
				if (icon !== '' && isDisabled) {
					icon = '<span>' + icon + '</span>';
				}

				if (!$this.data('content')) {
					// Prepend any icon and append any subtext to the main text.
					text = icon + '<span class="text">' + text + subtext + '</span>';
				}

				if (that.options.hideDisabled && isDisabled) {
					return;
				}

				if ($this.parent().is('optgroup') && $this.data('divider') !== true) {
					if ($this.index() === 0) { // Is it the first option of the optgroup?
						optID += 1;

						// Get the opt group label
						var label = $this.parent().attr('label');
						var labelSubtext = typeof $this.parent().data('subtext') !== 'undefined' ? '<small class="muted text-muted">' + $this.parent().data('subtext') + '</small>' : '';
						var labelIcon = $this.parent().data('icon') ? '<span class="' + that.options.iconBase + ' ' + $this.parent().data('icon') + '"></span> ' : '';
						label = labelIcon + '<span class="text">' + label + labelSubtext + '</span>';

						if (index !== 0 && _li.length > 0) { // Is it NOT the first option of the select && are there elements in the dropdown?
							_li.push(generateLI('', null, 'divider'));
						}

						_li.push(generateLI(label, null, 'dropdown-header'));
					}

					_li.push(generateLI(generateA(text, 'opt ' + optionClass, inline, optID), index));
				} else if ($this.data('divider') === true) {
					_li.push(generateLI('', index, 'divider'));
				} else if ($this.data('hidden') === true) {
					_li.push(generateLI(generateA(text, optionClass, inline), index, 'hide is-hidden'));
				} else {
					_li.push(generateLI(generateA(text, optionClass, inline), index));
				}
			});

			//If we are not multiple, we don't have a selected item, and we don't have a title, select the first element so something is set in the button
			if (!this.multiple && this.$element.find('option:selected').length === 0 && !this.options.title) {
				this.$element.find('option').eq(0).prop('selected', true).attr('selected', 'selected');
			}

			return $(_li.join(''));
		},

		findLis: function() {
			if (this.$lis == null) this.$lis = this.$menu.find('li');
			return this.$lis;
		},

		/**
		 * @param [updateLi] defaults to true
		 */
		render: function(updateLi) {
			var that = this;

			//Update the LI to match the SELECT
			if (updateLi !== false) {
				this.$element.find('option').each(function(index) {
					that.setDisabled(index, $(this).is(':disabled') || $(this).parent().is(':disabled'));
					that.setSelected(index, $(this).is(':selected'));
				});
			}

			this.tabIndex();
			var notDisabled = this.options.hideDisabled ? ':not([disabled])' : '';
			var selectedItems = this.$element.find('option:selected' + notDisabled).map(function() {
				var $this = $(this);
				var icon = $this.data('icon') && that.options.showIcon ? '<i class="' + that.options.iconBase + ' ' + $this.data('icon') + '"></i> ' : '';
				var subtext;
				if (that.options.showSubtext && $this.attr('data-subtext') && !that.multiple) {
					subtext = ' <small class="muted text-muted">' + $this.data('subtext') + '</small>';
				} else {
					subtext = '';
				}
				if ($this.data('content') && that.options.showContent) {
					return $this.data('content');
				} else if (typeof $this.attr('title') !== 'undefined') {
					return $this.attr('title');
				} else {
					return icon + $this.html() + subtext;
				}
			}).toArray();

			//Fixes issue in IE10 occurring when no default option is selected and at least one option is disabled
			//Convert all the values into a comma delimited string
			var title = !this.multiple ? selectedItems[0] : selectedItems.join(this.options.multipleSeparator);

			//If this is multi select, and the selectText type is count, the show 1 of 2 selected etc..
			if (this.multiple && this.options.selectedTextFormat.indexOf('count') > -1) {
				var max = this.options.selectedTextFormat.split('>');
				if ((max.length > 1 && selectedItems.length > max[1]) || (max.length == 1 && selectedItems.length >= 2)) {
					notDisabled = this.options.hideDisabled ? ', [disabled]' : '';
					var totalCount = this.$element.find('option').not('[data-divider="true"], [data-hidden="true"]' + notDisabled).length,
						tr8nText = (typeof this.options.countSelectedText === 'function') ? this.options.countSelectedText(selectedItems.length, totalCount) : this.options.countSelectedText;
					title = tr8nText.replace('{0}', selectedItems.length.toString()).replace('{1}', totalCount.toString());
				}
			}

			this.options.title = this.$element.attr('title');

			if (this.options.selectedTextFormat == 'static') {
				title = this.options.title;
			}

			//If we dont have a title, then use the default, or if nothing is set at all, use the not selected text
			if (!title) {
				title = typeof this.options.title !== 'undefined' ? this.options.title : this.options.noneSelectedText;
			}

			this.$button.attr('title', $.trim($("<div/>").html(title).text()).replace(/\s\s+/g, ' '));
			this.$newElement.find('.filter-option').html(title);
		},

		/**
		 * @param [style]
		 * @param [status]
		 */
		setStyle: function(style, status) {
			if (this.$element.attr('class')) {
				this.$newElement.addClass(this.$element.attr('class').replace(/selectpicker|mobile-device|validate\[.*\]/gi, ''));
			}

			var buttonClass = style ? style : this.options.style;

			if (status == 'add') {
				this.$button.addClass(buttonClass);
			} else if (status == 'remove') {
				this.$button.removeClass(buttonClass);
			} else {
				this.$button.removeClass(this.options.style);
				this.$button.addClass(buttonClass);
			}
		},

		liHeight: function() {
			if (this.options.size === false) return;

			var $selectClone = this.$menu.parent().clone().find('> .dropdown-toggle').prop('autofocus', false).end().appendTo('body'),
				$menuClone = $selectClone.addClass('open').find('> .dropdown-menu'),
				liHeight = $menuClone.find('li').not('.divider').not('.dropdown-header').filter(':visible').children('a').outerHeight(),
				headerHeight = this.options.header ? $menuClone.find('.popover-title').outerHeight() : 0,
				searchHeight = this.options.liveSearch ? $menuClone.find('.bs-searchbox').outerHeight() : 0,
				actionsHeight = this.options.actionsBox ? $menuClone.find('.bs-actionsbox').outerHeight() : 0;

			$selectClone.remove();

			this.$newElement
				.data('liHeight', liHeight)
				.data('headerHeight', headerHeight)
				.data('searchHeight', searchHeight)
				.data('actionsHeight', actionsHeight);
		},

		setSize: function() {
			this.findLis();
			var that = this,
				menu = this.$menu,
				menuInner = menu.find('.inner'),
				selectHeight = this.$newElement.outerHeight(),
				liHeight = this.$newElement.data('liHeight'),
				headerHeight = this.$newElement.data('headerHeight'),
				searchHeight = this.$newElement.data('searchHeight'),
				actionsHeight = this.$newElement.data('actionsHeight'),
				divHeight = this.$lis.filter('.divider').outerHeight(true),
				menuPadding = parseInt(menu.css('padding-top')) +
				parseInt(menu.css('padding-bottom')) +
				parseInt(menu.css('border-top-width')) +
				parseInt(menu.css('border-bottom-width')),
				notDisabled = this.options.hideDisabled ? ', .disabled' : '',
				$window = $(window),
				menuExtras = menuPadding + parseInt(menu.css('margin-top')) + parseInt(menu.css('margin-bottom')) + 2,
				menuHeight,
				selectOffsetTop,
				selectOffsetBot,
				posVert = function() {
					// JQuery defines a scrollTop function, but in pure JS it's a property
					//noinspection JSValidateTypes
					selectOffsetTop = that.$newElement.offset().top - $window.scrollTop();
					selectOffsetBot = $window.height() - selectOffsetTop - selectHeight;
				};
			posVert();
			if (this.options.header) menu.css('padding-top', 0);

			if (this.options.size == 'auto') {
				var getSize = function() {
					var minHeight,
						lisVis = that.$lis.not('.hide');

					posVert();
					menuHeight = selectOffsetBot - menuExtras;

					if (that.options.dropupAuto) {
						that.$newElement.toggleClass('dropup', (selectOffsetTop > selectOffsetBot) && ((menuHeight - menuExtras) < menu.height()));
					}
					if (that.$newElement.hasClass('dropup')) {
						menuHeight = selectOffsetTop - menuExtras;
					}

					if ((lisVis.length + lisVis.filter('.dropdown-header').length) > 3) {
						minHeight = liHeight * 3 + menuExtras - 2;
					} else {
						minHeight = 0;
					}

					menu.css({
						'max-height': menuHeight + 'px',
						'overflow': 'hidden',
						'min-height': minHeight + headerHeight + searchHeight + actionsHeight + 'px'
					});
					menuInner.css({
						'max-height': menuHeight - headerHeight - searchHeight - actionsHeight - menuPadding + 'px',
						'overflow-y': 'auto',
						'min-height': Math.max(minHeight - menuPadding, 0) + 'px'
					});
				};
				getSize();
				this.$searchbox.off('input.getSize propertychange.getSize').on('input.getSize propertychange.getSize', getSize);
				$(window).off('resize.getSize').on('resize.getSize', getSize);
				$(window).off('scroll.getSize').on('scroll.getSize', getSize);
			} else if (this.options.size && this.options.size != 'auto' && menu.find('li' + notDisabled).length > this.options.size) {
				var optIndex = this.$lis.not('.divider' + notDisabled).find(' > *').slice(0, this.options.size).last().parent().index();
				var divLength = this.$lis.slice(0, optIndex + 1).filter('.divider').length;
				menuHeight = liHeight * this.options.size + divLength * divHeight + menuPadding;
				if (that.options.dropupAuto) {
					//noinspection JSUnusedAssignment
					this.$newElement.toggleClass('dropup', (selectOffsetTop > selectOffsetBot) && (menuHeight < menu.height()));
				}
				menu.css({
					'max-height': menuHeight + headerHeight + searchHeight + actionsHeight + 'px',
					'overflow': 'hidden'
				});
				menuInner.css({
					'max-height': menuHeight - menuPadding + 'px',
					'overflow-y': 'auto'
				});
			}
		},

		setWidth: function() {
			if (this.options.width == 'auto') {
				this.$menu.css('min-width', '0');

				// Get correct width if element hidden
				var selectClone = this.$newElement.clone().appendTo('body');
				var ulWidth = selectClone.find('> .dropdown-menu').css('width');
				var btnWidth = selectClone.css('width', 'auto').find('> button').css('width');
				selectClone.remove();

				// Set width to whatever's larger, button title or longest option
				this.$newElement.css('width', Math.max(parseInt(ulWidth), parseInt(btnWidth)) + 'px');
			} else if (this.options.width == 'fit') {
				// Remove inline min-width so width can be changed from 'auto'
				this.$menu.css('min-width', '');
				this.$newElement.css('width', '').addClass('fit-width');
			} else if (this.options.width) {
				// Remove inline min-width so width can be changed from 'auto'
				this.$menu.css('min-width', '');
				this.$newElement.css('width', this.options.width);
			} else {
				// Remove inline min-width/width so width can be changed
				this.$menu.css('min-width', '');
				this.$newElement.css('width', '');
			}
			// Remove fit-width class if width is changed programmatically
			if (this.$newElement.hasClass('fit-width') && this.options.width !== 'fit') {
				this.$newElement.removeClass('fit-width');
			}
		},

		selectPosition: function() {
			var that = this,
				drop = '<div />',
				$drop = $(drop),
				pos,
				actualHeight,
				getPlacement = function($element) {
					$drop.addClass($element.attr('class').replace(/form-control/gi, '')).toggleClass('dropup', $element.hasClass('dropup'));
					pos = $element.offset();
					actualHeight = $element.hasClass('dropup') ? 0 : $element[0].offsetHeight;
					$drop.css({
						'top': pos.top + actualHeight,
						'left': pos.left,
						'width': $element[0].offsetWidth,
						'position': 'absolute'
					});
				};
			this.$newElement.on('click', function() {
				if (that.isDisabled()) {
					return;
				}
				getPlacement($(this));
				$drop.appendTo(that.options.container);
				$drop.toggleClass('open', !$(this).hasClass('open'));
				$drop.append(that.$menu);
			});
			$(window).resize(function() {
				getPlacement(that.$newElement);
			});
			$(window).on('scroll', function() {
				getPlacement(that.$newElement);
			});
			$('html').on('click', function(e) {
				if ($(e.target).closest(that.$newElement).length < 1) {
					$drop.removeClass('open');
				}
			});
		},

		setSelected: function(index, selected) {
			this.findLis();
			this.$lis.filter('[data-original-index="' + index + '"]').toggleClass('selected', selected);
		},

		setDisabled: function(index, disabled) {
			this.findLis();
			if (disabled) {
				this.$lis.filter('[data-original-index="' + index + '"]').addClass('disabled').find('a').attr('href', '#').attr('tabindex', -1);
			} else {
				this.$lis.filter('[data-original-index="' + index + '"]').removeClass('disabled').find('a').removeAttr('href').attr('tabindex', 0);
			}
		},

		isDisabled: function() {
			return this.$element.is(':disabled');
		},

		checkDisabled: function() {
			var that = this;

			if (this.isDisabled()) {
				this.$button.addClass('disabled').attr('tabindex', -1);
			} else {
				if (this.$button.hasClass('disabled')) {
					this.$button.removeClass('disabled');
				}

				if (this.$button.attr('tabindex') == -1) {
					if (!this.$element.data('tabindex')) this.$button.removeAttr('tabindex');
				}
			}

			this.$button.click(function() {
				return !that.isDisabled();
			});
		},

		tabIndex: function() {
			if (this.$element.is('[tabindex]')) {
				this.$element.data('tabindex', this.$element.attr('tabindex'));
				this.$button.attr('tabindex', this.$element.data('tabindex'));
			}
		},

		clickListener: function() {
			var that = this;

			this.$newElement.on('touchstart.dropdown', '.dropdown-menu', function(e) {
				e.stopPropagation();
			});

			this.$newElement.on('click', function() {
				that.setSize();
				if (!that.options.liveSearch && !that.multiple) {
					setTimeout(function() {
						that.$menu.find('.selected a').focus();
					}, 10);
				}
			});

			this.$menu.on('click', 'li a', function(e) {
				var $this = $(this),
					clickedIndex = $this.parent().data('originalIndex'),
					prevValue = that.$element.val(),
					prevIndex = that.$element.prop('selectedIndex');

				// Don't close on multi choice menu
				if (that.multiple) {
					e.stopPropagation();
				}

				e.preventDefault();

				//Don't run if we have been disabled
				if (!that.isDisabled() && !$this.parent().hasClass('disabled')) {
					var $options = that.$element.find('option'),
						$option = $options.eq(clickedIndex),
						state = $option.prop('selected'),
						$optgroup = $option.parent('optgroup'),
						maxOptions = that.options.maxOptions,
						maxOptionsGrp = $optgroup.data('maxOptions') || false;

					if (!that.multiple) { // Deselect all others if not multi select box
						$options.prop('selected', false);
						$option.prop('selected', true);
						that.$menu.find('.selected').removeClass('selected');
						that.setSelected(clickedIndex, true);
					} else { // Toggle the one we have chosen if we are multi select.
						$option.prop('selected', !state);
						that.setSelected(clickedIndex, !state);
						$this.blur();

						if ((maxOptions !== false) || (maxOptionsGrp !== false)) {
							var maxReached = maxOptions < $options.filter(':selected').length,
								maxReachedGrp = maxOptionsGrp < $optgroup.find('option:selected').length;

							if ((maxOptions && maxReached) || (maxOptionsGrp && maxReachedGrp)) {
								if (maxOptions && maxOptions == 1) {
									$options.prop('selected', false);
									$option.prop('selected', true);
									that.$menu.find('.selected').removeClass('selected');
									that.setSelected(clickedIndex, true);
								} else if (maxOptionsGrp && maxOptionsGrp == 1) {
									$optgroup.find('option:selected').prop('selected', false);
									$option.prop('selected', true);
									var optgroupID = $this.data('optgroup');

									that.$menu.find('.selected').has('a[data-optgroup="' + optgroupID + '"]').removeClass('selected');

									that.setSelected(clickedIndex, true);
								} else {
									var maxOptionsArr = (typeof that.options.maxOptionsText === 'function') ?
										that.options.maxOptionsText(maxOptions, maxOptionsGrp) : that.options.maxOptionsText,
										maxTxt = maxOptionsArr[0].replace('{n}', maxOptions),
										maxTxtGrp = maxOptionsArr[1].replace('{n}', maxOptionsGrp),
										$notify = $('<div class="notify"></div>');
									// If {var} is set in array, replace it
									/** @deprecated */
									if (maxOptionsArr[2]) {
										maxTxt = maxTxt.replace('{var}', maxOptionsArr[2][maxOptions > 1 ? 0 : 1]);
										maxTxtGrp = maxTxtGrp.replace('{var}', maxOptionsArr[2][maxOptionsGrp > 1 ? 0 : 1]);
									}

									$option.prop('selected', false);

									that.$menu.append($notify);

									if (maxOptions && maxReached) {
										$notify.append($('<div>' + maxTxt + '</div>'));
										that.$element.trigger('maxReached.bs.select');
									}

									if (maxOptionsGrp && maxReachedGrp) {
										$notify.append($('<div>' + maxTxtGrp + '</div>'));
										that.$element.trigger('maxReachedGrp.bs.select');
									}

									setTimeout(function() {
										that.setSelected(clickedIndex, false);
									}, 10);

									$notify.delay(750).fadeOut(300, function() {
										$(this).remove();
									});
								}
							}
						}
					}

					if (!that.multiple) {
						that.$button.focus();
					} else if (that.options.liveSearch) {
						that.$searchbox.focus();
					}

					// Trigger select 'change'
					if ((prevValue != that.$element.val() && that.multiple) || (prevIndex != that.$element.prop('selectedIndex') && !that.multiple)) {
						that.$element.change();
					}
				}
			});

			this.$menu.on('click', 'li.disabled a, .popover-title, .popover-title :not(.close)', function(e) {
				if (e.target == this) {
					e.preventDefault();
					e.stopPropagation();
					if (!that.options.liveSearch) {
						that.$button.focus();
					} else {
						that.$searchbox.focus();
					}
				}
			});

			this.$menu.on('click', 'li.divider, li.dropdown-header', function(e) {
				e.preventDefault();
				e.stopPropagation();
				if (!that.options.liveSearch) {
					that.$button.focus();
				} else {
					that.$searchbox.focus();
				}
			});

			this.$menu.on('click', '.popover-title .close', function() {
				that.$button.focus();
			});

			this.$searchbox.on('click', function(e) {
				e.stopPropagation();
			});


			this.$menu.on('click', '.actions-btn', function(e) {
				if (that.options.liveSearch) {
					that.$searchbox.focus();
				} else {
					that.$button.focus();
				}

				e.preventDefault();
				e.stopPropagation();

				if ($(this).is('.bs-select-all')) {
					that.selectAll();
				} else {
					that.deselectAll();
				}
				that.$element.change();
			});

			this.$element.change(function() {
				that.render(false);
			});
		},

		liveSearchListener: function() {
			var that = this,
				no_results = $('<li class="no-results"></li>');

			this.$newElement.on('click.dropdown.data-api', function() {
				that.$menu.find('.active').removeClass('active');
				if (!!that.$searchbox.val()) {
					that.$searchbox.val('');
					that.$lis.not('.is-hidden').removeClass('hide');
					if (!!no_results.parent().length) no_results.remove();
				}
				if (!that.multiple) that.$menu.find('.selected').addClass('active');
				setTimeout(function() {
					that.$searchbox.focus();
				}, 10);
			});

			this.$searchbox.on('input propertychange', function() {
				if (that.$searchbox.val()) {

					if (that.options.searchAccentInsensitive) {
						that.$lis.not('.is-hidden').removeClass('hide').find('a').not(':aicontains(' + normalizeToBase(that.$searchbox.val()) + ')').parent().addClass('hide');
					} else {
						that.$lis.not('.is-hidden').removeClass('hide').find('a').not(':icontains(' + that.$searchbox.val() + ')').parent().addClass('hide');
					}

					if (!that.$menu.find('li').filter(':visible:not(.no-results)').length) {
						if (!!no_results.parent().length) no_results.remove();
						no_results.html(that.options.noneResultsText + ' "' + that.$searchbox.val() + '"').show();
						that.$menu.find('li').last().after(no_results);
					} else if (!!no_results.parent().length) {
						no_results.remove();
					}

				} else {
					that.$lis.not('.is-hidden').removeClass('hide');
					if (!!no_results.parent().length) no_results.remove();
				}

				that.$menu.find('li.active').removeClass('active');
				that.$menu.find('li').filter(':visible:not(.divider)').eq(0).addClass('active').find('a').focus();
				$(this).focus();
			});
		},

		val: function(value) {
			if (typeof value !== 'undefined') {
				this.$element.val(value);
				this.render();

				return this.$element;
			} else {
				return this.$element.val();
			}
		},

		selectAll: function() {
			this.findLis();
			this.$lis.not('.divider').not('.disabled').not('.selected').filter(':visible').find('a').click();
		},

		deselectAll: function() {
			this.findLis();
			this.$lis.not('.divider').not('.disabled').filter('.selected').filter(':visible').find('a').click();
		},

		keydown: function(e) {
			var $this = $(this),
				$parent = ($this.is('input')) ? $this.parent().parent() : $this.parent(),
				$items,
				that = $parent.data('this'),
				index,
				next,
				first,
				last,
				prev,
				nextPrev,
				prevIndex,
				isActive,
				keyCodeMap = {
					32: ' ',
					48: '0',
					49: '1',
					50: '2',
					51: '3',
					52: '4',
					53: '5',
					54: '6',
					55: '7',
					56: '8',
					57: '9',
					59: ';',
					65: 'a',
					66: 'b',
					67: 'c',
					68: 'd',
					69: 'e',
					70: 'f',
					71: 'g',
					72: 'h',
					73: 'i',
					74: 'j',
					75: 'k',
					76: 'l',
					77: 'm',
					78: 'n',
					79: 'o',
					80: 'p',
					81: 'q',
					82: 'r',
					83: 's',
					84: 't',
					85: 'u',
					86: 'v',
					87: 'w',
					88: 'x',
					89: 'y',
					90: 'z',
					96: '0',
					97: '1',
					98: '2',
					99: '3',
					100: '4',
					101: '5',
					102: '6',
					103: '7',
					104: '8',
					105: '9'
				};

			if (that.options.liveSearch) $parent = $this.parent().parent();

			if (that.options.container) $parent = that.$menu;

			$items = $('[role=menu] li a', $parent);

			isActive = that.$menu.parent().hasClass('open');

			if (!isActive && /([0-9]|[A-z])/.test(String.fromCharCode(e.keyCode))) {
				if (!that.options.container) {
					that.setSize();
					that.$menu.parent().addClass('open');
					isActive = true;
				} else {
					that.$newElement.trigger('click');
				}
				that.$searchbox.focus();
			}

			if (that.options.liveSearch) {
				if (/(^9$|27)/.test(e.keyCode.toString(10)) && isActive && that.$menu.find('.active').length === 0) {
					e.preventDefault();
					that.$menu.parent().removeClass('open');
					that.$button.focus();
				}
				$items = $('[role=menu] li:not(.divider):not(.dropdown-header):visible', $parent);
				if (!$this.val() && !/(38|40)/.test(e.keyCode.toString(10))) {
					if ($items.filter('.active').length === 0) {
						if (that.options.searchAccentInsensitive) {
							$items = that.$newElement.find('li').filter(':aicontains(' + normalizeToBase(keyCodeMap[e.keyCode]) + ')');
						} else {
							$items = that.$newElement.find('li').filter(':icontains(' + keyCodeMap[e.keyCode] + ')');
						}
					}
				}
			}

			if (!$items.length) return;

			if (/(38|40)/.test(e.keyCode.toString(10))) {
				index = $items.index($items.filter(':focus'));
				first = $items.parent(':not(.disabled):visible').first().index();
				last = $items.parent(':not(.disabled):visible').last().index();
				next = $items.eq(index).parent().nextAll(':not(.disabled):visible').eq(0).index();
				prev = $items.eq(index).parent().prevAll(':not(.disabled):visible').eq(0).index();
				nextPrev = $items.eq(next).parent().prevAll(':not(.disabled):visible').eq(0).index();

				if (that.options.liveSearch) {
					$items.each(function(i) {
						if ($(this).is(':not(.disabled)')) {
							$(this).data('index', i);
						}
					});
					index = $items.index($items.filter('.active'));
					first = $items.filter(':not(.disabled):visible').first().data('index');
					last = $items.filter(':not(.disabled):visible').last().data('index');
					next = $items.eq(index).nextAll(':not(.disabled):visible').eq(0).data('index');
					prev = $items.eq(index).prevAll(':not(.disabled):visible').eq(0).data('index');
					nextPrev = $items.eq(next).prevAll(':not(.disabled):visible').eq(0).data('index');
				}

				prevIndex = $this.data('prevIndex');

				if (e.keyCode == 38) {
					if (that.options.liveSearch) index -= 1;
					if (index != nextPrev && index > prev) index = prev;
					if (index < first) index = first;
					if (index == prevIndex) index = last;
				}

				if (e.keyCode == 40) {
					if (that.options.liveSearch) index += 1;
					if (index == -1) index = 0;
					if (index != nextPrev && index < next) index = next;
					if (index > last) index = last;
					if (index == prevIndex) index = first;
				}

				$this.data('prevIndex', index);

				if (!that.options.liveSearch) {
					$items.eq(index).focus();
				} else {
					e.preventDefault();
					if (!$this.is('.dropdown-toggle')) {
						$items.removeClass('active');
						$items.eq(index).addClass('active').find('a').focus();
						$this.focus();
					}
				}

			} else if (!$this.is('input')) {
				var keyIndex = [],
					count,
					prevKey;

				$items.each(function() {
					if ($(this).parent().is(':not(.disabled)')) {
						if ($.trim($(this).text().toLowerCase()).substring(0, 1) == keyCodeMap[e.keyCode]) {
							keyIndex.push($(this).parent().index());
						}
					}
				});

				count = $(document).data('keycount');
				count++;
				$(document).data('keycount', count);

				prevKey = $.trim($(':focus').text().toLowerCase()).substring(0, 1);

				if (prevKey != keyCodeMap[e.keyCode]) {
					count = 1;
					$(document).data('keycount', count);
				} else if (count >= keyIndex.length) {
					$(document).data('keycount', 0);
					if (count > keyIndex.length) count = 1;
				}

				$items.eq(keyIndex[count - 1]).focus();
			}

			// Select focused option if "Enter", "Spacebar" or "Tab" (when selectOnTab is true) are pressed inside the menu.
			if ((/(13|32)/.test(e.keyCode.toString(10)) || (/(^9$)/.test(e.keyCode.toString(10)) && that.options.selectOnTab)) && isActive) {
				if (!/(32)/.test(e.keyCode.toString(10))) e.preventDefault();
				if (!that.options.liveSearch) {
					$(':focus').click();
				} else if (!/(32)/.test(e.keyCode.toString(10))) {
					that.$menu.find('.active a').click();
					$this.focus();
				}
				$(document).data('keycount', 0);
			}

			if ((/(^9$|27)/.test(e.keyCode.toString(10)) && isActive && (that.multiple || that.options.liveSearch)) || (/(27)/.test(e.keyCode.toString(10)) && !isActive)) {
				that.$menu.parent().removeClass('open');
				that.$button.focus();
			}
		},

		mobile: function() {
			this.$element.addClass('mobile-device').appendTo(this.$newElement);
			if (this.options.container) this.$menu.hide();
		},

		refresh: function() {
			this.$lis = null;
			this.reloadLi();
			this.render();
			this.setWidth();
			this.setStyle();
			this.checkDisabled();
			this.liHeight();
		},

		update: function() {
			this.reloadLi();
			this.setWidth();
			this.setStyle();
			this.checkDisabled();
			this.liHeight();
		},

		hide: function() {
			this.$newElement.hide();
		},

		show: function() {
			this.$newElement.show();
		},

		remove: function() {
			this.$newElement.remove();
			this.$element.remove();
		}
	};

	// SELECTPICKER PLUGIN DEFINITION
	// ==============================
	function Plugin(option, event) {
		// get the args of the outer function..
		var args = arguments;
		// The arguments of the function are explicitly re-defined from the argument list, because the shift causes them
		// to get lost
		//noinspection JSDuplicatedDeclaration
		var _option = option,
			option = args[0],
			event = args[1];
		[].shift.apply(args);

		// This fixes a bug in the js implementation on android 2.3 #715
		if (typeof option == 'undefined') {
			option = _option;
		}

		var value;
		var chain = this.each(function() {
			var $this = $(this);
			if ($this.is('select')) {
				var data = $this.data('selectpicker'),
					options = typeof option == 'object' && option;

				if (!data) {
					var config = $.extend({}, Selectpicker.DEFAULTS, $.fn.selectpicker.defaults || {}, $this.data(), options);
					$this.data('selectpicker', (data = new Selectpicker(this, config, event)));
				} else if (options) {
					for (var i in options) {
						if (options.hasOwnProperty(i)) {
							data.options[i] = options[i];
						}
					}
				}

				if (typeof option == 'string') {
					if (data[option] instanceof Function) {
						value = data[option].apply(data, args);
					} else {
						value = data.options[option];
					}
				}
			}
		});

		if (typeof value !== 'undefined') {
			//noinspection JSUnusedAssignment
			return value;
		} else {
			return chain;
		}
	}

	var old = $.fn.selectpicker;
	$.fn.selectpicker = Plugin;
	$.fn.selectpicker.Constructor = Selectpicker;

	// SELECTPICKER NO CONFLICT
	// ========================
	$.fn.selectpicker.noConflict = function() {
		$.fn.selectpicker = old;
		return this;
	};

	$(document)
		.data('keycount', 0)
		.on('keydown', '.bootstrap-select [data-toggle=dropdown], .bootstrap-select [role=menu], .bs-searchbox input', Selectpicker.prototype.keydown)
		.on('focusin.modal', '.bootstrap-select [data-toggle=dropdown], .bootstrap-select [role=menu], .bs-searchbox input', function(e) {
			e.stopPropagation();
		});

	// SELECTPICKER DATA-API
	// =====================
	$(window).on('load.bs.select.data-api', function() {
		$('.selectpicker').each(function() {
			var $selectpicker = $(this);
			Plugin.call($selectpicker, $selectpicker.data());
		})
	});

})(jQuery);

function detectIE() {
    var ua = window.navigator.userAgent;

    var msie = ua.indexOf('MSIE ');
    if (msie > 0) {
        // IE 10 or older => return version number
        return parseInt(ua.substring(msie + 5, ua.indexOf('.', msie)), 10);
    }

    var trident = ua.indexOf('Trident/');
    if (trident > 0) {
        // IE 11 => return version number
        var rv = ua.indexOf('rv:');
        return parseInt(ua.substring(rv + 3, ua.indexOf('.', rv)), 10);
    }

    var edge = ua.indexOf('Edge/');
    if (edge > 0) {
       // IE 12 => return version number
       return parseInt(ua.substring(edge + 5, ua.indexOf('.', edge)), 10);
    }

    // other browser
    return false;
}

(function($){
    $(function(){

        //var $copy = $('div.SPA_printcontact').clone();
        var $body = $('body');

        //$copy.insertAfter('#printdate');

        if($.browser.msie || detectIE()) {
            $body.addClass('msie ie'+detectIE());
            //var userAgent = userAgent.substring(0,userAgent.indexOf('.'));
            //var version = userAgent;
            //$body.addClass('msie ie' + version);
            
            //alert('IE');
        } else if($.browser.webkit) {
            $body.addClass('webkit');
        } else if($.browser.mozilla) {
            $body.addClass('mozilla');
        }

    });
}(jQuery));


/*!
* Detectizr v@VERSION
* http://barisaydinoglu.github.com/Detectizr/
*
* Written by Baris Aydinoglu (http://baris.aydinoglu.info) - Copyright 2012
* Released under the MIT license
*
* Date: @DATE
*/

//$(function() {
//    
//	$('._forward_pricing').on("click",function(){
//            _ga_generated( $(this) );   
//            // redirect store
//            document.location = domain + '/store.html';	
//	});
//        
//        $('.ga-click').on('click', function(event) {
//            //event.preventDefault();
//            _ga_generated( $(this) );
//            //return true;
//        });
//
//});
//
//function _ga_generated( $(this) ) {
//    var _ga_label_button = false,
//        _ga_type_button = false,
//        _ga_event = false;
//
//    _ga_event = ($(this).attr('ga-event')) ? $(this).attr('ga-event') : false;
//    _ga_type_button = ($(this).attr('ga-type-button')) ? $(this).attr('ga-type-button') : 'buy button';
//    _ga_label_button = ($(this).attr('ga-label-button')) ? $.trim( $(this).attr('ga-label-button').toLowerCase() ).replace(/\s/g,'-') : false;
//
//    if(_ga_event && _ga_type_button && _ga_label_button) {
//        ga('send', 'event', _ga_type_button, _ga_event, _ga_label_button);
//    } 
//}

function google_analitycs_click( category, action, label ) {
    if(action && category && label) {
        ga('send', 'event', category, action, label);
    }
}

function TrackEventGA(Category, Action, Label, Value) {
    "use strict";
    if (typeof (_gaq) !== "undefined") {
        _gaq.push(['_trackEvent', Category, Action, Label, Value]);
    } else if (typeof (ga) !== "undefined") {
        ga('send', 'event', Category, Action, Label, Value);
    }
}

$(function() {
    $('.ga-action-click').on('click', function() {
           var _ga_action = ($(this).attr('ga-action')) ? $(this).attr('ga-action') : false,
               _ga_category = ($(this).attr('ga-category')) ? $(this).attr('ga-category') : false,
               _ga_label = ($(this).attr('ga-label')) ? $.trim( $(this).attr('ga-label').toLowerCase() ).replace(/\s/g,'-') : false;
        
        if(_ga_action && _ga_category && _ga_label) {
            // ga('send', 'event', _ga_category, _ga_action, _ga_label);
            TrackEventGA(_ga_category, _ga_action, _ga_label);
        }
        
    });
    
    $('.ga-action-submit').on('click', function() { // closest('form'). submit
        var _b = $(this), _form = $(this).closest('form');  // .find('.ga-action-submit')
        var _ga_action = (_b.attr('ga-action')) ? _b.attr('ga-action') : false,
           _ga_category = (_b.attr('ga-category')) ? _b.attr('ga-category') : false,
           _ga_page = (_b.attr('ga-page')) ? _b.attr('ga-page') : '',
           _ga_label = (_b.attr('ga-label')) ? $.trim( _b.attr('ga-label').toLowerCase() ).replace(/\s/g,'-') : false;
        
        if(_ga_action && _ga_category && _ga_label) {
            ga('send', 'page', _ga_page);
            ga('send', 'pageview', _ga_page);
            // ga('set', 'referrer', 'http://pumpic.com');
            ga('send', 'event', _ga_category, _ga_action, _ga_label, {
                'page': _ga_page,
                '_trackPageview': _ga_page, 
                'hitCallback': function() {
                    _form.submit();
                }
            });

            return !(ga.hasOwnProperty('loaded') && ga.loaded === true);
        } else {
            return true;
        }
    });
    
});


currencyHandler = {
  afterLoad: function(rates){
    $.each($('input.data-price'), function(i, priceTag){
      var usdPrice = $(priceTag).data('price-usd');
      
      if (typeof usdPrice !== 'undefined') {
        $.each(['gbp', 'eur', 'cad', 'aud'], function(i, currency){
          
          if(rates[currency.toUpperCase()]){
            var priceInCurrency = Number((1 / rates[currency.toUpperCase()]) * usdPrice).toFixed(2);
            $(priceTag).attr('data-price-' + currency, priceInCurrency);
            
          }
          
        });
      }
      
      var doublePrice = $(priceTag).data('data-offer-price-usd');
      
      if (typeof doublePrice !== 'undefined') {
        $.each(['gbp', 'eur', 'cad', 'aud'], function(i, currency){
          
          if(rates[currency.toUpperCase()]){
            var priceInCurrency = Number((1 / rates[currency.toUpperCase()]) * doublePrice).toFixed(2);
            $(priceTag).attr('data-offer-price-' + currency, priceInCurrency);
            
          }
          
        });
      }
    });
    $('input.data-price:checked').change();
  },
  onChange: function(currentCurrency){
    $('input.data-price')
        .attr('data-cur', currentCurrency)
        .filter(':checked')
        .change();
  }
};

(function( $ ){
  // var _dataObj = ($("body").hasClass("ie8")) ? document.body : window;
  var $this = {}, $rates = {}, $_html = "";
  
  var $_settings = {
    'debug': false,
    'api_key': '', // app_id=
    // 'host': '/currency.html',
    'currBase': 'USD',
    'currCode': { 'usd' : '$',
      'eur' :'',
      'gbp' : '',
      'cad' : '$',
      'aud' : '$'},
    'filter': {
      'iso': ['USD','EUR','GBP','CAD','AUD']
    },
    'rates': {}, // list currance rates
    'convert': {
      'from': false,
      'to': false,
    },
    'ajax': {
      'dataType': 'json',
      'type': 'POST',
      'crossDomain': true,
      'data': {
      }
    },
    'onOpen': false,
  }
  
  // detected method
  var methods = {
    init : function( options ) {
      methods._die('Load init! *Curr');
      
      $this = $(this);
      // set filters
      methods.setSettings( options );
      
      // set rates
      methods.setRates();
      
      methods._die('Rates ...');
      methods._die( $_settings.rates );
      
      // init money
      var rates = methods._initMoney();
      
      methods.triggerCall($_settings.onOpen, rates);
      return $(this);
    }, // set init
    
    setSettings: function(options) {
      if(typeof options !== "undefined") {
        $_settings = $.extend( $_settings, options || {});
      }
    },
    
    setRates: function( $_obj ) {
      if(typeof $_obj !== "undefined" ) {
        $_settings.rates = $_obj;
      } else if($rates = methods._json()) {
        $_settings.rates = $rates;
      }
    },
    
    triggerCall: function(func, arg) {
      $.isFunction(func) && func.call(this, arg);
    },
    
    _die: function(msg) {
      if($_settings.debug)
        console.log( msg );
    },
    
    /* ==== init cookie ====== */
    _clearCookie: function( key ) {
      if($.cookie( key )) {
        $.removeCookie( key, { path: '/' });
      }
    },
    
    setCookie: function(key, value) {
      $.cookie(key, value, { expires: 7, path: '/' });
    },
    
    getCookie: function( key ) {
      if($.cookie(key)) {
        return $.cookie(key);
      } else
        return false;
    },
    
    /* ==== init data cahce ====== */
    _clearCach: function(key) {
//            if( $("body").hasClass("ie8") ) {
//                if(key) {
//                    jQuery.data( document.body, key, false);
//                } else {
//                    jQuery.data( document.body, '_result', false);
//                }
//            } else {
      if(key) {
        jQuery.data( window, key, false);
      } else {
        jQuery.data( window, '_result', false);
      }
//            }
    },
    setCach: function(key, params) {
      key = (!key) ? "_result" : key;
      
      if(params) {
//                if( $("body").hasClass("ie8") ) {
//                    return jQuery.data( document.body, key, params );
//                } else {
        return jQuery.data( window, key, params);
//                }
      } else {
//                if( $("body").hasClass("ie8") ) {
//                    return jQuery.data( document.body, key);
//                } else {
        return jQuery.data( window, key);
//                }
      }
      
    }, // set cahce
    
    getCach: function(key) {
//            if( $("body").hasClass("ie8") ) {
//                if(jQuery.data( document.body, key))
//                    return jQuery.data( document.body, key);
//                else
//                    return false;
//            } else {
      if(jQuery.data( window, key))
        return jQuery.data( window, key);
      else
        return false;
//            }
    },
    
    /* ajax */
    _json: function(_data) {
      methods._die('Load json curr..');
      var _url = '', result = {};



//            _data = (_data) ? _data : {
//                '_base': $_settings.currBase, // set Base currance
//                '_filter': $_settings.filter // set filter in iso
//            };
//
//            if( $("body").hasClass("ie8") || $("body").hasClass("ie9") ) {
//                methods._die('Load ie8 or ie9 ...');
//                // fix for ie8
//                var responce = $.ajax({
//                   type: $_settings.ajax.type,
//                   url: $_settings.host,
//                   processData: true,
//                   async: false,
//                   cache: false,
//                   data: $.extend(_data, $_settings.ajax.data),
//                   dataType: "json",
//                   success: function () {
//                   }
//                }).responseText;
//                responce = eval('['+responce+']');
//                methods.setCach('_ajax', responce[0]); // .responseJSON
//
//            } else {
//                $.ajax({
//                    type: $_settings.ajax.type,
//                    async: false,
//                    cache: false,
//                    url: $_settings.host,
//                    data: $.extend(_data, $_settings.ajax.data),
//                    dataType: $_settings.ajax.dataType,
//                    crossDomain: $_settings.ajax.crossDomain
//                }).done(function(responce) {
//                    methods._die( 'Responce..' );
//                    methods._die( responce );
//                    if(responce) {
//
//                         methods._die( responce );
//                        methods.setCach('_ajax', responce); // .responseJSON
//                    }
//                });
//            }
      
      if(isset($rand) && !methods.getCach('_ajax')) methods.setCach('_ajax', $rand);
      
      methods._die( 'getCache...' );
      methods._die( methods.getCach('_ajax') );
      return result = methods.getCach('_ajax');
      
    },
    
    // money math
    _initMoney: function( data ) {
      var _rates = {};
      if($_settings.rates) {
        $.each($_settings.rates, function(key, val) {
          if(val.iso)
            _rates[ val.iso.toUpperCase() ] = parseFloat( val.rates );
        });
      }
      
      methods._die(  _rates   );
      
      // init money
      fx.rates = (_rates) ? _rates : data.rates;
      fx.base = ($_settings.currBase) ? $_settings.currBase : data.base;
      return _rates;
    },
    
    _convert: function( pricing, from, to ) {
      if(!pricing) return null;
      
      var _settings = {
        from: (from) ? from.toUpperCase() : false,
        to: (to) ? to.toUpperCase() : false,
      };
      
      return fx.convert(pricing, _settings);
    },
    
    bindEvent: function() {
      // click
      if($this.find('.store-flags, .store-link-currancy-flag').length)
        $this.find('.store-flags, .store-link-currancy-flag').on('click', function(event) {
          event.preventDefault();
          var curr_convert = $(this).attr('attr-rates-iso');
          
          
          if(methods.getCach('currISO') && curr_convert) {
            if(methods.getCach('currISO') != curr_convert) {
              methods.setCach('currISO', curr_convert);
            }
          } else {
            methods.setCach('currISO', curr_convert);
          }
          
          // status
          $this.find('.store-flags, .store-link-currancy-flag').each(function() {
            if($(this).hasClass('active')) {
              $(this).removeClass('active');
            }
          });
          
          $(this).addClass('active');
          
          // event
          methods.afterEvent();
          // alert( methods._convert(100, $_settings.currBase, curr_convert || $_settings.currBase) ); // 'USD', 'EUR'
          return false;
        });
    },
    
    unbindEvent: function() {
      $this.find('.store-flags, .store-link-currancy-flag').off('click');
    },
    
    // show create html list rates
    show: function() {
      var status = [];
      methods._die( $_settings.rates );
      
      if($_settings.rates) {
        $_html += '<span>Currency:</span>';
        //$_html += '<ul class="clearfix">';
        $.each($_settings.rates, function(key, val) {
          status[ key ] = (val.iso.toUpperCase() == $_settings.currBase) ? 'active' : '';
          //$_html += '<li><span class="store-flags flag-'+val.iso+' '+status[ key ]+'" attr-rates-iso="'+val.iso+'" attr-rates-id="'+val.id+'"></span></li>'; // '+val.iso.toUpperCase()+'
          $_html += '<a class="store-link-currancy-flag '+status[ key ]+'" attr-rates-iso="'+val.iso+'" attr-rates-id="'+val.id+'" href="#"><i class="ico-flag-'+val.iso+'"></i><span>'+val.iso.toUpperCase()+'</span></a>';
        });
        //$_html += '</ul>';
        
        $this.html( $_html );
        
        methods.beforeEvent(); // setup default
        methods.bindEvent();
      }
      
    },
    
    // beforeEvent
    beforeEvent: function() {
      $('.box-currence').each(function() {
        var _symbol = $(this).find('div.symbol'),
            _iso = _symbol.attr('attr-iso');
        if(!_iso.length) _symbol.attr('attr-iso', $_settings.currBase);
        if(!_symbol.length) _symbol.text( $_settings.currCode[ $_settings.currBase.toLowerCase() ] );
      });
    },
    
    // afterEvent
    afterEvent: function() {
      currencyHandler.onChange(methods.getCach('currISO'));
      
      $.each($('.box-currence'), function(i, boxCurr) {
        
        methods._die(  $(boxCurr)   );
        
        var _symbol = $( boxCurr ).find('div.symbol'),
            _price = $( boxCurr ).find('div.curr'),
            symbol = (_symbol) ? _symbol.text() : false,
            price = (_price) ? _price.text() : false,
            iso = (_price) ? _symbol.attr('attr-iso') : false;
        
        methods._die(  'afterEvent...'   );
        methods._die(  symbol   );
        methods._die(  price   );
        methods._die(  iso   );
        
        if(price) {
          _price.html( methods._convert( parseFloat(price),
              methods.getCach('currISO') || $_settings.currBase,
              iso
          ).toFixed(2)  ); // ).toFixed(2)
          _symbol.attr('attr-iso', methods.getCach('currISO'));
          _symbol.text( $_settings.currCode[ methods.getCach('currISO').toLowerCase() ] )
        }
        
        
      });
      
    },
    
    run : function( params ) {
      methods._die( params );
      methods._die( 'Rates init' );
      methods._die( $_settings.rates );
    },
  };
  
  // constructor
  $.fn.currancy = function( method, type ) {
    
    //   
    if ( methods[method] ) {
      return methods[ method ].apply( this, Array.prototype.slice.call( arguments, 1 ));
    } else if ( typeof method === 'object' || ! method ) {
      methods.init.apply( this, arguments );
      if(typeof type !== "undefined" && methods[type]) {
        return methods[type].apply( this, Array.prototype.slice.call( arguments, 1 ));
      }
//          else {
//              return methods.init.apply( this, arguments );
//          }
    } else {
      $.error( '   ' +  method + '    jQuery.tooltip' );
    }
    
    
  };
  
})( jQuery );
 
// $(document).ready(function(){
//
//   if($('.list-currencies').length) {
//     $('.list-currencies').currancy({
//       onOpen: function(rates) {
//         currencyHandler.afterLoad(rates);
//       }
//     },'show');
//   }
//
// });

/*
 * 	Easy Tooltip 1.0 - jQuery plugin
 *	written by Alen Grakalic	
 *	http://cssglobe.com/post/4380/easy-tooltip--jquery-plugin
 *
 *	Copyright (c) 2009 Alen Grakalic (http://cssglobe.com)
 *	Dual licensed under the MIT (MIT-LICENSE.txt)
 *	and GPL (GPL-LICENSE.txt) licenses.
 *
 *	Built for jQuery library
 *	http://jquery.com
 *
 */
 
(function($) {

	$.fn.easyTooltip = function(options){
	  
		// default configuration properties
		var defaults = {	
			xOffset: 10,
			yOffset: 25,
			tooltipId: "easyTooltip",
			clickRemove: false,
			content: "",
			useElement: ""
		}; 
			
		var options = $.extend(defaults, options);  
		var content;
				
		this.each(function() {  				
			var title = $(this).attr("title");				
			$(this).hover(function(e){											 							   
				content = (options.content != "") ? options.content : title;
				content = (options.useElement != "") ? $("#" + options.useElement).html() : content;
				$(this).attr("title","");									  				
				if (content != "" && content != undefined){			
					$("body").append("<div id='"+ options.tooltipId +"'>"+ content +"</div>");		
					$("#" + options.tooltipId)
						.css("position","absolute")
						.css("top",(e.pageY - options.yOffset) + "px")
						.css("left",(e.pageX + options.xOffset) + "px")						
						.css("display","none")
						.fadeIn("fast")
				}
			},
			function(){	
				$("#" + options.tooltipId).remove();
				$(this).attr("title",title);
			});	
			$(this).mousemove(function(e){
				$("#" + options.tooltipId)
					.css("top",(e.pageY - options.yOffset) + "px")
					.css("left",(e.pageX + options.xOffset) + "px")					
			});	
			if(options.clickRemove){
				$(this).mousedown(function(e){
					$("#" + options.tooltipId).remove();
					$(this).attr("title",title);
				});				
			}
		});
	  
	};

})(jQuery);

var d = document;
var safari = (navigator.userAgent.toLowerCase().indexOf('safari') != -1) ? true : false;
var gebtn = function(parEl,child) { return parEl.getElementsByTagName(child); };
onload = function() {
	
	var body = gebtn(d,'body')[0];
	body.className = body.className && body.className != '' ? body.className + ' has-js' : 'has-js';
	
	if (!d.getElementById || !d.createTextNode) return;
	var ls = gebtn(d,'label');
	for (var i = 0; i < ls.length; i++) {
		var l = ls[i];
		if (l.className.indexOf('label_') == -1) continue;
		var inp = gebtn(l,'input')[0];
		if (l.className == 'label_check') {
			l.className = (safari && inp.checked == true || inp.checked) ? 'label_check c_on' : 'label_check c_off';
			l.onclick = check_it;
		};
		if (l.className == 'label_radio') {
			l.className = (safari && inp.checked == true || inp.checked) ? 'label_radio r_on' : 'label_radio r_off';
			l.onclick = turn_radio;
		};
	};
};
var check_it = function() {
	var inp = gebtn(this,'input')[0];
	if (this.className == 'label_check c_off' || (!safari && inp.checked)) {
		this.className = 'label_check c_on';
		if (safari) inp.click();
	} else {
		this.className = 'label_check c_off';
		if (safari) inp.click();
	};
};
var turn_radio = function() {
	var inp = gebtn(this,'input')[0];
	if (this.className == 'label_radio r_off' || inp.checked) {
		var ls = gebtn(this.parentNode,'label');
		for (var i = 0; i < ls.length; i++) {
			var l = ls[i];
			if (l.className.indexOf('label_radio') == -1)  continue;
			l.className = 'label_radio r_off';
		};
		this.className = 'label_radio r_on';
		if (safari) inp.click();
	} else {
		this.className = 'label_radio r_off';
		if (safari) inp.click();
	};
};
$(document).ready(function(){ 

    // create cookie
    if(typeof $.cookie('fly_features') == "undefined") {
        $.cookie('fly_features', 0, {  
            expires: 1 //     
        });
    }
    
    
    $(window).scroll(function() {
            if ($(this).scrollTop() > 100 && 
                    typeof $.cookie('fly_features') !== "undefined" &&
                    !parseInt( $.cookie('fly_features') ) ) {
                    $('#fly_features').fadeIn();
            } else {
                    $('#fly_features').fadeOut();
            }
    });
    
//    if(typeof $.cookie('fly_features') !== "undefined" 
//                && !parseInt( $.cookie('fly_features') )) {
//            $('#fly_features').css({'display': 'inline-block'});
//    }
    
    if($('.fly_close').length) {
        $('.fly_close').on('click', function() {
            $(this).parent().hide();
            if(typeof $.cookie('fly_features') !== "undefined" 
                && !parseInt( $.cookie('fly_features') )) {
                $.cookie('fly_features', 1);
            }
            
            return false;
        });
    }
});


// fix ie8 - 10
var alertFallback = false;
if (typeof console === "undefined" || typeof console.log === "undefined") {
    console = {};
    if (alertFallback) {
        console.log = function (msg) {
            alert(msg);
        };
    } else {
        console.log = function () {
        };
    }
}

(function ($) {
	
	var $_result = {
        '_plans': false,
        '_mobile': false
    };
    var $this = {};

    var _settings = {
        'plan': false,
        'mobile': false
    }

    // detected method
    var methods = {
        init: function (options) {

            // set filters
            if (typeof options.filters !== "undefined") {
                _settings.plans = (options.filters.plans) ? options.filters.plans : null;
                _settings.mobile = (options.filters.mobile) ? options.filters.mobile : null;
            }

            return $(this);
        }, // set init

        _clearCach: function (key) {
            if (key) {
                jQuery.data(window, key, false);
            } else {
                jQuery.data(window, '_result', false);
                jQuery.data(window, '_plans', false);
                jQuery.data(window, '_mobile', false);
            }

        },
        _cach: function (params, key) {
            key = (!key) ? "_result" : key;
            if (params) {
                return jQuery.data(window, key, params);
            } else {
                return jQuery.data(window, key);
            }
        }, // set cahce

        _plans: function ( ) {
            if (_settings.plans) {
                var _res = [];
                $.each($this, function (key, item_obj) {
                    var $_item = $(item_obj);
                    var $use_plans = $_item.attr('attr-use-plan').split('|');

                    if ($.inArray(_settings.plans, $use_plans) != -1) {
                        _res[$_item.index()] = $_item.index();
                    }
                });

                methods._cach(_res, "_plans");
            } else {
                methods._clearCach('_plans');
                console.log('Not enter filters Plans (*settings)!');
            }


        }, // set plans filters

        _mobile: function () {
            if (_settings.mobile) {
                var _res = [];
                if (!$_result._plans) {
                    $.each(_settings.mobile, function (_type, _status) {
                        if (_status == true) {
                            $.each($this, function (key, item_obj) {
                                var $_item = $(item_obj);
                                if ($_item.find('.box-filter-mobile i.icon-' + _type + '').is('.supported')) {
                                    _res[ $_item.index() ] = $_item.index();
                                }

                            });
                        }
                    });
                } else {
                    $.each($this, function (key, item_obj) {
                        var $_item = $(item_obj);
                        if ($.inArray($_item.index(), $_result._plans) != -1) {
                            $.each(_settings.mobile, function (_type, _status) {
                                if (_status == true) {
                                    if ($_item.find('.box-filter-mobile i.icon-' + _type + '').is('.supported'))
                                        _res[ $_item.index() ] = $_item.index();
                                }
                            });
                        }
                    });
                }

                methods._cach(_res, "_mobile");
            } else {
                methods._clearCach('_mobile');
                console.log('Not enter filters mobile (*settings)!');
            }

        }, // set mobile filters
        _run: function (obj) {
            if (!obj.length) {
                console.log('Not detected Objects!');
                return;
            }

            $this = obj;

            methods._plans(); // detected plans
            $_result._plans = methods._cach(false, "_plans"); // get params plans in cache

            if (typeof $_result._plans === "undefined")
                console.log('Not enter plans filters!');
            methods._mobile(); // detected filters mobile
            $_result._mobile = methods._cach(false, "_mobile"); // get params mobile in cache
            if (typeof $_result._mobile === "undefined")
                console.log('Not enter mobile filter!');
            methods._visible($_result); // show/hide elements
        },
        _visible: function (arr_index) {
            if ($this.length > 0) {
                if (typeof arr_index._plans !== "undefined" && arr_index._plans.length > 0) {
                    $.each($this, function (key, item_obj) {
                        var $_item = $(item_obj);
                        if (arr_index._plans.length > 0) {
                            // set plans
                            if ($.inArray($_item.index(), arr_index._plans) != -1) {
                                if ($_item.hasClass('hide'))
                                    $_item.removeClass('hide');
                                $_item.addClass('show');
                            } else {
                                if ($_item.hasClass('show'))
                                    $_item.removeClass('show')
                                $_item.addClass('hide');
                            }
                        }

                    }); // show/hide elements plans

                    // filter mobile in plans
                    if (arr_index._mobile.length > 0 && typeof arr_index._mobile !== "undefined") {
                        $.each($this, function (key, item_obj) {
                            var $_item = $(item_obj);
                            if ($.inArray($_item.index(), arr_index._mobile) != -1) {
                                if ($_item.hasClass('hide'))
                                    $_item.removeClass('hide');
                                $_item.addClass('show');
                            } else {
                                if ($_item.hasClass('show'))
                                    $_item.removeClass('show')
                                $_item.addClass('hide');
                            }
                        });
                    } // show/hide mobile in plans


                } // filters plans

                else if (!arr_index._plans.length
                        && typeof arr_index._mobile !== "undefined"
                        && arr_index._mobile.length > 0) {

                    $.each($this, function (key, item_obj) {
                        var $_item = $(item_obj);
                        if ($.inArray($_item.index(), arr_index._mobile) != -1) {
                            if ($_item.hasClass('hide'))
                                $_item.removeClass('hide');
                            $_item.addClass('show');
                        } else {
                            if ($_item.hasClass('show'))
                                $_item.removeClass('show')
                            $_item.addClass('hide');
                        }
                    });
                } // all mobile filters
                else {

                    $.each($this, function (key, item_obj) {
                        var $_item = $(item_obj);
                        if ($_item.hasClass('hide'))
                            $_item.removeClass('hide');
                        $_item.addClass('show');
                    });
                }

            }
        },
        show: function () {
            return methods._run($(this));
        },
        update: function (content) {
            // !!!
        }
    };

    // constructor
    $.fn.tabPumpic = function (method) {

        //   
        if (methods[method]) {
            return methods[ method ].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('   ' + method + '    jQuery.tooltip');
        }


    };

})(jQuery);

// globa variable
$data_hash = [];

var _htmlPopUp = {
    'boxStatusAuth': '<div id="box-status-auth" class="popUp"><div><label class="title gold">Hello!<i class="close small"></i></label></div>'
            + '<p class="info">You have just logged into Pumpic.com, enjoy your time with us or go straight to your <a class="a-default" href="https://cp.pumpic.com">account</a>.</p>'
            + '</div>',
    'boxStatusRegistration': '<div id="box-status-registration" class="popUp">'
            + '<div><label class="title gold">Hello!<i class="close small"></i></label></div>'
            + '<p class="info">You have just registered in Pumpic.com, enjoy your time with us or go straight to your <a class="a-default" href="https://cp.pumpic.com">account</a>.</p>'
            + '</div>',
    'boxStatusFreeTrialRegistration': '<div id="box-status-free-trial-registration" class="popUp">'
            + '<div><label class="title gold">Thank you for signing up!<i class="close small"></i></label></div>'
            + '<p class="info">The email with registration details was sent to ' + UserLogin + '.<br /> You can go straight to your <a class="a-default" href="https://cp.pumpic.com">Personal Account</a> now.</p>'
            + '</div>',
    'email_success': '<div id="box-email-success" class="popUp">'
            + '<div><label class="title gold"> Thank you! <i class="close small"></i></label></div>'
            + '<div class="info text-center"> Your discount code will be sent to you soon.'
            + '<form><div><a href="#" class="button-red btn-default block-popUp-close">Close</a></div></form>'
            + '</div></div>',
    'box_email': '<div id="box-email" class="popUp">'
            + '<div><label class="title gold"> <b>10%</b> off<i class="close small"></i></label></div>'
            + '<div class="info text-center">Want to get <a class="a-default" href="#">10% discount</a> right now?<br />Subscribe to our specail promo!'
            + '<form class="block-popup-form text-center">'
            + '<div><input id="email" class="required" type="email" name="email" value="" placeholder="email" />'
            + '<div id="email-error" class="error"></div></div><div><button class="button-red btn-default">Save 10% today</button></div>'
            + '</form></div></div>',
};

// anchor
jQuery(function () {
    jQuery(window).hashchange(function () {
        if (document.location.hash == '')
            return;
        var hash = location.hash.split('#');
        if (hash.length > 1) {
            $data_hash = hash[1];
            hashchange_onLoadInit();

            // if($('.box-anchor #'+hash[1]).length)
            //if(typeof $('.box-anchor #'+hash[1]) == "object")
            //    $('html, body').animate({scrollTop: $('.box-anchor #'+hash[1]).offset().top}, 800);
        }

    });
    jQuery(window).hashchange();
});

// init cookies
function cookie_init() {
//    if(!getCookie('popUp')) {
//        $.cookie('popUp', false, {
//                        expires: 7,
//                        path: '/'
//                    });
//    }

    // save cookie screen window
    if (!getCookie('_screen')) {
        $.cookie('_screen', $(window).width() + 'x' + $(window).height(), {expires: 7, path: '/', domain: '.pumpic.com'});
    }

}

function copy_to_clipboard_init() {
    var client = new ZeroClipboard($(".copy-to-clipboard"));

    client.on("copy", function (event) {
        var clipboard = event.clipboardData;
        clipboard.setData("text/plain", $('.copy-this').val());
    });

    client.on('aftercopy', function (event) {
        $('.copy-done').show().fadeOut(1500);
    });

}

function cookie_clear() {
    if ($.cookie('popUp')) {
        $.removeCookie('popUp', {path: '/'});
    }
}

function setCookie(name, value) {
    $.cookie(name, value, {expires: 7, path: '/'});
}

function getCookie(name) {
    if ($.cookie(name)) {
        return $.cookie(name);
    } else
        return false;
}

// init hashchange ( init bPopUp )
function hashchange_onLoadInit() {

}

function hashchange_AfterInit() {
    var _data = _parceHash($data_hash);
    var $_popUp = $('.box-popUp'),
            $auth = $_popUp.find('#box-status-auth'),
            $registration = $_popUp.find('#box-status-registration'),
            $trial_registration = $_popUp.find('#box-status-free-trial-registration');
    // init bPopUp
    if (isset(_data['popUp']) && _hasUser == 'true') {

        if (_data['popUp'] == "auth") { // && !getCookie('popUp')
            // google analitycs
            ga('send', 'event', 'form', 'submit', 'login-success');

            if (!$auth.length) {
                $auth = $_popUp
                        .append(_htmlPopUp.boxStatusAuth)
                        .find('#box-status-auth');
            }

            // login status ok
            if (isset($auth)) {
                var title = $auth.find('.title')
                        , content = $auth.find('.info');
                $auth.bPopup({
                    modalClose: true,
                    opacity: 0.6,
                    follow: [false, false],
                    positionStyle: 'fixed', //'fixed' or 'absolute'
                    onOpen: function () {
                        //content.html('TEST POPUP element!');
                    },
                    closeClass: 'close',
                    onClose: function () {
                        // setCookie('popUp', true);
                        //content.empty();
                    },
                });
            }
        }

        if (_data['popUp'] == "registration") { // && !getCookie('popUp')
            // google analitycs
            ga('send', 'event', 'form', 'submit', 'registration-success');

            if (!$registration.length) {
                $registration = $_popUp
                        .append(_htmlPopUp.boxStatusRegistration)
                        .find('#box-status-registration');
            }

            // login status ok
            if (isset($registration)) {
                var title = $registration.find('.title')
                        , content = $registration.find('.info');
                $registration.bPopup({
                    modalClose: true,
                    opacity: 0.6,
                    follow: [false, false],
                    positionStyle: 'fixed', //'fixed' or 'absolute'
                    onOpen: function () {
                        //content.html('TEST POPUP element!');
                    },
                    closeClass: 'close',
                    onClose: function () {
                        // setCookie('popUp', true);
                        //content.empty();
                    },
                });
            }
        }

        //free-trial-registration
        if (_data['popUp'] == "free-trial-registration") { // && !getCookie('popUp')
            if (!$trial_registration.length) {
                $trial_registration = $_popUp
                        .append(_htmlPopUp.boxStatusFreeTrialRegistration)
                        .find('#box-status-free-trial-registration');
            }
            // login status ok
            if (isset($trial_registration)) {
                var title = $trial_registration.find('.title')
                        , content = $trial_registration.find('.info');

                $trial_registration.bPopup({
                    modalClose: true,
                    opacity: 0.6,
                    follow: [false, false],
                    positionStyle: 'fixed',
                    onOpen: function () {

                        // google analitycs
                        ga('send', 'event', 'trial', 'popup', 'free-trial-registration-success');

                    },
                    closeClass: 'close',
                    onClose: function () {
                    },
                });
            }
        }

    }
}

function _parceHash(hash) {
    var _data = {};
    if (hash.length) {
        var pair = (hash).split('&');
        for (var i = 0; i < pair.length; i++) {
            var param = pair[i].split('=');
            _data[param[0]] = param[1];
        }
    }
    return _data;
}


function isset(element) {
    if (typeof element != 'undefined') {
        return element.length > 0;
    } else
        return false;
}

// toggleClicked
jQuery.fn.clickToggle = function (a, b) {
    var ab = [b, a];
    function cb() {
        ab[this._tog ^= 1].call(this);
        return false;
    }
    return this.on("click", cb);
};

/*
 (function($) {
 $.fn.clickToggle = function(func1, func2) {
 var funcs = [func1, func2];
 this.data('toggleclicked', 0);
 this.click(function(event) {
 event.preventDefault();
 var data = $(this).data();
 var tc = data.toggleclicked;
 $.proxy(funcs[tc], this)();
 data.toggleclicked = (tc + 1) % 2;
 return false;
 });
 return this;
 };
 }(jQuery));
 */

/*
 * parce url
 **/
function parseUrlQuery() {
    var data = {};
    if (location.search) {
        var pair = (location.search.substr(1)).split('&');
        for (var i = 0; i < pair.length; i++) {
            var param = pair[i].split('=');
            data[param[0]] = param[1];
        }
    }
    return data;
}


function clickActive(obj, _this) {
    if ($(obj).length > 0) {
        $.each($(obj), function (key, val) {
            if ($(val).hasClass('active'))
                $(val).removeClass('active');
        }); // clear all active
        _this.addClass('active');
    }
}

/*
 * parce string serilize
 **/
function parseQuery(str) {
    var data = {};
    if (typeof str == 'string') {
        var pair = (str).split('&');
        for (var i = 0; i < pair.length; i++) {
            var param = pair[i].split('=');
            data[param[0]] = param[1];
        }
    } else if (typeof str == 'object') {
        $.each(str, function (_k, _val) {
            if (_val.name)
                data[ _val.name ] = (_val.value) ? _val.value : null;
        });
    }
    return data;
}


/*
 * Ajax function.
 * return json result
 **/
function getAjaxForm(path, params, options) {

    if (!options)
        options = {};

    var settings = $.extend({
        'dataType': 'json',
        'async': false,
        'crossDomain': false,
        'type': 'POST',
        'cache': true
    }, options || {});


    if (!path) {
        return null;
    }
    var res = $.ajax({
        url: path,
        dataType: settings.dataType,
        async: settings.async,
        crossDomain: settings.crossDomain,
        type: settings.type,
        cache: settings.cache,
        success: function () {

        },
        complete: function () {
        },
        data: {
            params: params
        }
    }).responseText;

    console.log(res);

    res = eval('[' + res + ']');
    var obj = res[0];
    return obj;
}

/*
 * JSONP
 *
 */
function _getAJAX(path, params, options) {
    if (!options)
        options = {};

    var settings = $.extend({
        'dataType': 'jsonp',
        'jsonp': "callback",
        'async': false,
        'crossDomain': false,
        'type': 'POST',
        'cache': true
    }, options || {});

    console.log(settings);

    if (!path) {
        console.log('enter url AJAX!');
        return null;
    }

    return $.ajax({
        type: settings.type,
        async: settings.async,
        url: path,
        data: {
            params: params
        },
        dataType: settings.dataType,
        jsonp: settings.jsonp,
        crossDomain: settings.crossDomain,
        cache: settings.cache,
    });
}

/*
 *
 * @param {type} $_msg
 * @returns {undefined}
 */
function getJsonp(_data) {
    if (typeof _data != 'object') {
        die('Data not object!');
        return;
    }
    var baseUrl = "http://a.pumpic.dev/index.php";
    return $.ajax({
        type: "GET",
        async: false,
        url: baseUrl,
        data: _data,
        dataType: "jsonp",
        jsonp: "callback",
        crossDomain: true
    });

}


/*
 *
 * @param {type} $_msg
 * @returns {undefined}
 */
function reloadCaptcha(obj, error) {
    if (!obj.length)
        return false;
    var _form = obj.parents('form');
    var _src = '/captcha.html?' + Math.random();
    if ($(obj).attr('attr-width') && $(obj).attr('attr-height')) {
        _src = '/captcha.html?width=' + $(obj).attr('attr-width') + '&height=' + $(obj).attr('attr-height') + '&' + Math.random();
    }
    $('.box-captcha').find('#img-captcha').attr('src', _src);

    if (error)
        _form.find('input[name="captcha"]').focus();
}

/*
 * Display error massenge
 * @param {type} $_msg
 * @returns {undefined}
 */
function die($_msg) {
    console.log($_msg);
}

$(document).ready(function () {

    $rs_width = false;
    $(window).resize(function () {
        $rs_width = $(window).width()
    });

    if (!$rs_width) {
        $rs_width = $(window).width();
    }

    cookie_init();

    copy_to_clipboard_init();

    $.data(window, "filters", false); // init clear cache

    var filters = {
        'plans': false,
        'mobile': {
            'apple': false,
            'android': false,
            'blackberry': false
        }
    }; // init settings

    // activate tab
    if (window.location.hash.length) {
        var hash = window.location.hash,
                $button = $('a[href="' + hash + '"]');
        if ($button.length && $(hash).length) {
            $button.attr('data-toggled', 'on');
            $button.parent().addClass('active');
            $('.box_category>ul>li').hide();
            $(hash).show();
        }
    }

    // faceboock share

//    $.ajaxSetup({ cache: true });
//    $.getScript('//connect.facebook.net/en_US/sdk.js', function(){
//        FB.init({
//            // appId: '{your-app-id}',
//            version: 'v2.4' // or v2.0, v2.1, v2.2, v2.3
//        });
//        //$('#loginbutton,#feedbutton').removeAttr('disabled');
//        // FB.getLoginStatus(updateStatusCallback);
//    });

    function fb_share() {
        // facebook share dialog
        FB.ui({
            method: 'feed',
            name: "Your Page Title",
            link: "https://www.webniraj.com/link-to-page/",
            picture: "https://stackexchange.com/users/flair/557969.png",
            caption: "Some description here"
        }, function (response) {
            // do nothing
        });

    }



    $('.share_list a').click(function (e) {
        e.preventDefault();

        // facebook
//        if($(this).hasClass('share-facebook')) {
//           window.open("http://www.facebook.com/sharer/sharer.php?s=100&p[url]="+encodeURIComponent(window.location)+"&p[images][0]=http://pumpic.com/images/socials/social-icon.jpg&p[title]=Mobile Phone Security Measures&p[summary]=How to protect children from online predators, cyberbullies, 18+ content, and identity theft. Pumpic gathered essential information on mobile phone safety practice. Learn more to keep kids safe.",
//           'Share',
//           'height=300,width=500');
//           // fb_share();
//        } else {

//        console.log( $(this).data('location') + encodeURIComponent(window.location) );
        if (isset($(this).data('location')) && $(this).data('location').length) {

            var media = '';
            if (isset($(this).data('media')) && $(this).data('media').length)
                media = '&media=' + $(this).data('media');

            window.open($(this).data('location') + encodeURIComponent(window.location) + media, 'Share', 'height=300,width=500');
        }

        //}
        return false
    });

    $('.box-plans, .box-phone').on('click', function (event) {
        event.preventDefault();
        filters = (!$.data(window, "filters")) ? filters : $.data(window, "filters");
        var _rel = $(this).attr('rel');

        if ($(this).hasClass('active')) {
            $(this).removeClass('active');

            if ($(this).is('.box-plans')) {
                filters.plans = false;
            } else if ($(this).is('.box-phone')) {
                for (key in filters.mobile) {
                    filters.mobile[key] = false;
                }
            }

        } else {
            if ($(this).is('.box-plans')) {
                clickActive('.box-plans', $(this));
                filters.plans = _rel;
            } else if ($(this).is('.box-phone')) {
                clickActive('.box-phone', $(this));
                // clear all params (after click in mobile)
                for (key in filters.mobile) {
                    filters.mobile[key] = false;
                }

                if (typeof filters.mobile[_rel] !== "undefined")
                    filters.mobile[_rel] = true;
            }
        }

        console.log('save cashe filter...');
        $.data(window, "filters", filters); // save in result locale cache
        console.log('end...');

        console.log('init Plugins Tabs...');
        $('.box-body-filters').tabPumpic({
            'filters': filters
        }).tabPumpic('show');
        console.log('end...');

        return false;
    });

    if ($('#item-stickybar').length) {
        // $("#item-stickybar").trigger("sticky_kit:detach");
        // $("#item-stickybar").stick_in_parent();


        $('.list_category > li').each(function (key, val) {
            $('#item-stickybar.stickybar-' + key).stick_in_parent();
            console.log('key = ' + key);
        });


//        $("#item-stickybar").each(function(key, val) {
//            console.log(key);
//            $(this).stick_in_parent();
//        });

//        $("#item-stickybar").stick_in_parent({
//        parent: "#items-stickybar",
//        spacer: "#item-stickybar"
//      });
    }

    if ($('#block-stickybar').length) {
        $('#block-stickybar').stick_in_parent();
    }

    if ($('.list_category > li > a[data-toggled="on"]').length) {
        $.each($('.list_category > li > a[data-toggled="on"]'), function () {
            $('.box_category > ul > li').hide();
            if ($(this).parent().hasClass('active')) {
                var _hash = $(this).attr('href').split('#');
                console.log(_hash[1]);
                if (_hash.length) {
                    $('.box_category > ul > li').find('#' + _hash[1]).closest('li').show();
                }
            }
        });
    }


    //check if link is with hash
    var currUrl = window.location.hash;
    if(currUrl) {
      $('.list_category > li:first-child').removeClass('active')
    }
    function offsetAnchor() {
        if(location.hash.length !== 0) {
            window.scrollTo(window.scrollX, window.scrollY - 90);
        }
    }

    // This will capture hash changes while on the page
    $(window).on("hashchange",offsetAnchor);

    // This is here so that when you enter the page with a hash,
    // it can provide the offset in that case too. Having a timeout
    // seems necessary to allow the browser to jump to the anchor first.
    window.setTimeout(offsetAnchor, 1);
    // choose categoey
    //$('.list_category > li:first-child').addClass('active');
    $('.list_category > li > a').on('click', function (event) {
        //event.preventDefault();
        var _hash = $(this).attr('href').split('#'),
                _index = $(this).closest('li').index(),
                $holder = $(this).parent().parent();

        // console.log('index = '+_index);

        var store_history = $holder.attr('save-state');

        if (typeof store_history !== typeof undefined && store_history !== false) {
            window.location.hash = $(this).attr('href');
        }

        // clear all active
        $.each($('.list_category > li').not(":eq(" + _index + ")"), function () {
            if ($(this).hasClass('active'))
                $(this).removeClass('active');

            if ($(this).children('a').attr('data-toggled') == 'on') {
                $(this).children('a').attr('data-toggled', 'off');
            }
        }); // clear active

        // all add attr off

        if (!$(this).attr('data-toggled') || $(this).attr('data-toggled') == 'off') {
            $(this).attr('data-toggled', 'on');

            $(".list_category").each(function (key, value) {
                if ($(this).find("li:eq(" + _index + ")").length)
                    $(this).find("li:eq(" + _index + ")").addClass('active');
            });

            $('.box_category > ul > li').hide();

            if (_hash.length > 1) {
                if (_hash[1] == 'all') {
                    $('.box_category > ul > li').show();
                } else {
                    $('.box_category > ul > li').find('#' + _hash[1]).closest('li').show();
                }

                if ($('.box_category > ul > li').find('#' + _hash[1]).length) {
                    // $('html, body').animate({
                    //     scrollTop: Math.ceil($('.box_category > ul > li').find('#' + _hash[1]).offset().top) // Math.ceil((target_top * $(window).outerHeight(true)) / $('html, body').height())
                    // }, 'linear');
                }

            }

        }
        else if ($(this).attr('data-toggled') == 'on') {
            $(this).attr('data-toggled', 'off');

            $(".list_category").each(function (key, value) {
                if ($(this).find("li:eq(" + _index + ")").hasClass('active'))
                    $(this).find("li:eq(" + _index + ")").removeClass('active');
            });

            $('.box_category > ul > li').show();
        }

        // $('#item-stickybar').trigger("sticky_kit:recalc");

        return false;
    });

//
//     $('.list_category > li > a').on('click', function(event) {
//         event.preventDefault();
//         var _hash = $(this).attr('href').split('#');
//
//         $.each($('.list_category > li'), function() {
//            if($(this).hasClass('active'))
//                $(this).removeClass('active');
//         }); // clear active
//
//         if($(this).parent().hasClass('active')) {
//             $(this).parent().removeClass('active');
//             $('.box_category > ul > li').show();
//         } else {
//             $(this).parent().addClass('active');
//             $('.box_category > ul > li').hide();
//             if(_hash.length > 1) {
//                if(_hash[1] == 'all') {
//                    $('.box_category > ul > li').show();
//                } else {
//                    $('.box_category > ul > li').find('#'+_hash[1]).closest('li').show();
//                }
//
//
//             }
//         }
//
//         return false;
//     });

    // 
    $('a.anchor').on("click", function (e) {
        e.preventDefault();
        var anchor = $(this).attr('href').split('#');
        if (anchor.length > 1) {
            $('html, body').stop().animate({
                scrollTop: $('.box-anchor #' + anchor[1]).offset().top
            }, 1000);
        }


        return false;
    });


//   $('.search-category').on('click', function(e) {
//       e.preventDefault();
//       var _os = $(this).attr('attr_os');
//       if( _os) {
//           $.fn.PumpicList('search', {
//               'search_method': 'getPhonesByOS',
//               '_method': 'getCountOS',
//               '_query': _os
//           });
//       }
//
//       return false;
//   });

    // compatibility tooltip in device
    if ($('.mobile_tooltip').length) {
        $('.mobile_tooltip').easyTooltip();
    }

    // focus
    if ($('.form-discount').length) {
        var elements = $(".form-discount input[type!='submit'], .form-discount textarea, .form-discount select");
        elements.focus(function () {
            $(this).addClass('highlight');
        });
        elements.blur(function () {
            $(this).removeClass('highlight');
        });
    }

    if ($('.box-form').length) {
        var elements = $(".box-form input[type!='submit'], .box-form textarea, .box-form select");
        elements.focus(function () {
            $(this).addClass('highlight');
        });
        elements.blur(function () {
            $(this).removeClass('highlight');
        });
    }


    // compatibility_form
    var validator_send_find_phone = $('form[name="send_find_phone"]').validate({
        onfocusout: false,
        onkeyup: false,
        onclick: true,
        onsubmit: true,
        focusInvalid: false,
        focusCleanup: false,
        debug: false,
        'device-model': {
            required: true
        },
        'captcha': {
            required: true
        },
        email: {
            required: true,
            email: true
        },
        name: {
            required: true
        },
        messages: {
            'captcha': "Invalid CAPTCHA.", // The CAPTCHA field is empty.
            name: "The Name field is empty",
            'device-model': "The Device Model field is empty",
            email: {
                required: "The Email field is empty",
                email: "Invalid email format"
            }
        },
        errorClass: "invalid",
        validClass: "success",
        invalidHandler: function (event, validator) {
            if ($('form[name="send_find_phone"] span.info').length)
                $('form[name="send_find_phone"] span.info').html(" ").hide();

            if ($('form[name="send_find_phone"] .fatal-error').length)
                $('form[name="send_find_phone"] .fatal-error').html(" ").hide();

            if ($('form[name="send_find_phone"] label.error, form[name="send_find_phone"] label.invalid').length)
                $('form[name="send_find_phone"] label.error, form[name="send_find_phone"] label.invalid').remove();
        },
        //  
        showErrors: function (errorMap, errorList) {
            var _form = $('form[name="send_find_phone"]');
            var msg = null;

            $.each(errorList, function (key, value) {
                if (value.element) {
                    var name = _form.find(value.element).attr('name');
                    // console.log( name );
                    _form.find(value.element).after('<label id="' + name + '-error" for="' + name + '" class="invalid">' + value.message + '</label>');
                    _form.find(value.element).next().show();
                }
            });
        },
        submitHandler: function (form) {
            if ($('form[name="send_find_phone"] span.info').length)
                $('form[name="send_find_phone"] span.info').html(" ").hide();

            if ($('form[name="send_find_phone"] .fatal-error').length)
                $('form[name="send_find_phone"] .fatal-error').html(" ").hide();

            if ($('form[name="send_find_phone"] label.error, form[name="send_find_phone"] label.invalid').length)
                $('form[name="send_find_phone"] label.error, form[name="send_find_phone"] label.invalid').remove();

            var $form = $(form);
            var _params = parseQuery($form.serializeArray());

            var _response = getAjaxForm('/compatibility_send.html', _params);
            if (_response.result) {
                var _res = _response.result;
                if (_res.error) {

                    if (typeof _res.error === 'object') {
                        $.each(_res.error, function (name, text) {
                            var _obj = $form.find('input[name="' + name + '"]');

                            if (_obj.length) {

                                if (_obj.next('label').length) {
                                    _obj.next().html(text).show();
                                } else {
                                    $('<label id="' + name + '-error" for="' + name + '" class="invalid">' + text + '</label>').insertAfter(_obj);
                                }
                            }
                        });
                    } else {
                        $('form[name="send_find_phone"] .fatal-error').html(_res.error);
                    }

                    reloadCaptcha($form.find('.box-captcha > img'), true); // reload captcha
                    return false;
                } else if (_res.success) {
                    $('form[name="send_find_phone"] span.info').html(_res.success).css({'display': 'inline-block'});

                    // scrollTo block info
                    var target_top = $('form[name="send_find_phone"] span.info').offset().top;
                    $('html, body').animate({
                        scrollTop: Math.ceil(target_top) // Math.ceil((target_top * $(window).outerHeight(true)) / $('html, body').height())
                    }, 'linear');

                    console.log(target_top, Math.ceil((target_top * $(window).outerHeight(true)) / $('html, body').height()));

                    // google analitycs
                    ga('send', 'event', 'form', 'submit', 'compatibility-request-success');

                } else {
                    $('form[name="send_find_phone"] .fatal-error').html('Your email was not sent');
                    reloadCaptcha($form.find('.box-captcha > img'), true); // reload captcha
                    return false;
                }

            } else {
                $('form[name="send_find_phone"] .fatal-error').html('Your email was not sent');
                reloadCaptcha($form.find('.box-captcha > img'), true); // reload captcha
                return false;
            }

            reloadCaptcha($form.find('.box-captcha > img'), false); // reload captcha
            $form.trigger("reset");

            // return false;
        }
    });

    // clear info in focus
    $('form[name="send_find_phone"] input, form[name="send_find_phone"] textarea').focus(function () {
        //if($('form[name="send_find_phone"] span.info').length)
        //    $('form[name="send_find_phone"] span.info').html( " " ).hide();
        //if($('form[name="send_find_phone"] .fatal-error').length)
        //    $('form[name="send_find_phone"] .fatal-error').html( " " ).hide();
        //if($('form[name="send_find_phone"] label.error, form[name="send_find_phone"] label.invalid').length)
        //    $('form[name="send_find_phone"] label.error, form[name="send_find_phone"] label.invalid').remove();
    });

    // compatibility_form
    var validator_send_mobile_operators_find_phone = $('form[name="send_mobile_operators_find_phone"]').validate({
        onfocusout: false,
        onkeyup: false,
        onclick: true,
        onsubmit: true,
        focusInvalid: false,
        focusCleanup: false,
        debug: false,
        'carrier': {
            required: true
        },
        'captcha': {
            required: true
        },
        email: {
            required: true,
            email: true
        },
        messages: {
            'captcha': "Invalid CAPTCHA.", // The CAPTCHA field is empty.
            name: "The Device Model field is empty",
            email: {
                required: "The Email field is empty",
                email: "Invalid email format"
            }
        },
        errorClass: "invalid",
        validClass: "success",
        invalidHandler: function (event, validator) {
            if ($('form[name="send_mobile_operators_find_phone"] span.info').length)
                $('form[name="send_mobile_operators_find_phone"] span.info').html(" ").hide();

            if ($('form[name="send_mobile_operators_find_phone"] .fatal-error').length)
                $('form[name="send_mobile_operators_find_phone"] .fatal-error').html(" ").hide();

            if ($('form[name="send_mobile_operators_find_phone"] label.error, form[name="send_mobile_operators_find_phone"] label.invalid').length)
                $('form[name="send_mobile_operators_find_phone"] label.error, form[name="send_mobile_operators_find_phone"] label.invalid').remove();
        },
        //  
        showErrors: function (errorMap, errorList) {
            var _form = $('form[name="send_mobile_operators_find_phone"]');
            var msg = null;

            $.each(errorList, function (key, value) {
                if (value.element) {
                    var name = _form.find(value.element).attr('name');
                    // console.log( name );
                    _form.find(value.element).after('<label id="' + name + '-error" for="' + name + '" class="invalid">' + value.message + '</label>');
                    _form.find(value.element).next().show();
                }
            });
        },
        submitHandler: function (form) {
            if ($('form[name="send_mobile_operators_find_phone"] span.info').length)
                $('form[name="send_mobile_operators_find_phone"] span.info').html(" ").hide();

            if ($('form[name="send_mobile_operators_find_phone"] .fatal-error').length)
                $('form[name="send_mobile_operators_find_phone"] .fatal-error').html(" ").hide();

            if ($('form[name="send_mobile_operators_find_phone"] label.error, form[name="send_mobile_operators_find_phone"] label.invalid').length)
                $('form[name="send_mobile_operators_find_phone"] label.error, form[name="send_mobile_operators_find_phone"] label.invalid').remove();

            var $form = $(form);
            var _params = parseQuery($form.serializeArray());

            var _response = getAjaxForm('/gps-wireless-tracking-phone.html', _params);
            if (_response.result) {
                var _res = _response.result;
                if (_res.error) {

                    if (typeof _res.error === 'object') {
                        $.each(_res.error, function (name, text) {
                            var _obj = $form.find('input[name="' + name + '"]');

                            if (_obj.length) {

                                if (_obj.next('label').length) {
                                    _obj.next().html(text).show();
                                } else {
                                    $('<label id="' + name + '-error" for="' + name + '" class="invalid">' + text + '</label>').insertAfter(_obj);
                                }
                            }
                        });
                    } else {
                        $('form[name="send_mobile_operators_find_phone"] .fatal-error').html(_res.error);
                    }

                    reloadCaptcha($form.find('.box-captcha > img'), true); // reload captcha
                    return false;
                } else if (_res.success) {
                    $('form[name="send_mobile_operators_find_phone"] span.info').html(_res.success).css({'display': 'inline-block'});

                    // scrollTo block info
                    var target_top = $('form[name="send_mobile_operators_find_phone"] span.info').offset().top;
                    $('html, body').animate({
                        scrollTop: Math.ceil(target_top) // Math.ceil((target_top * $(window).outerHeight(true)) / $('html, body').height())
                    }, 'linear');

                    // console.log( target_top, Math.ceil((target_top * $(window).outerHeight(true)) / $('html, body').height()) );

                    // google analitycs
                    ga('send', 'event', 'form', 'submit', 'mobile-operators-request-success');

                } else {
                    $('form[name="send_mobile_operators_find_phone"] .fatal-error').html('Your email was not sent');
                    reloadCaptcha($form.find('.box-captcha > img'), true); // reload captcha
                    return false;
                }

            } else {
                $('form[name="send_mobile_operators_find_phone"] .fatal-error').html('Your email was not sent');
                reloadCaptcha($form.find('.box-captcha > img'), true); // reload captcha
                return false;
            }

            reloadCaptcha($form.find('.box-captcha > img'), false); // reload captcha
            $form.trigger("reset");

            // return false;
        }
    });

    // clear info in focus
    $('form[name="send_mobile_operators_find_phone"] input, form[name="send_mobile_operators_find_phone"] textarea').focus(function () {
        //if($('form[name="send_mobile_operators_find_phone"] span.info').length)
        //    $('form[name="send_mobile_operators_find_phone"] span.info').html( " " ).hide();
        //if($('form[name="send_mobile_operators_find_phone"] .fatal-error').length)
        //    $('form[name="send_mobile_operators_find_phone"] .fatal-error').html( " " ).hide();
        //if($('form[name="send_mobile_operators_find_phone"] label.error, form[name="send_mobile_operators_find_phone"] label.invalid').length)
        //    $('form[name="send_mobile_operators_find_phone"] label.error, form[name="send_mobile_operators_find_phone"] label.invalid').remove();
    });


    // validator faq (form-faq-send)
    var validator_form_faq = $('form.form-faq-send').validate({
        onfocusout: false,
        focusInvalid: false,
        'name': {
            required: true
        },
        'question': {
            required: true
        },
        email: {
            required: true,
            email: true
        },
        messages: {
            name: "The Name field is empty",
            question: 'The Question field is empty',
            email: {
                required: "The Email field is empty",
                email: "Invalid email format"
            },
        },
        errorClass: "invalid",
        validClass: "success",
        invalidHandler: function (event, validator) {
            if ($('form.form-faq-send span.info').length)
                $('form.form-faq-send span.info').html(" ").hide();

            if ($('form.form-faq-send .fatal-error').length)
                $('form.form-faq-send .fatal-error').html(" ").hide();
        },
        submitHandler: function (form) {
            if ($('form.form-faq-send span.info').length)
                $('form.form-faq-send span.info').html(" ").hide();

            if ($('form.form-faq-send .fatal-error').length)
                $('form.form-faq-send .fatal-error').html(" ").hide();

            var $form = $(form);
            var _params = parseQuery($form.serializeArray());

            var _response = getAjaxForm('/faq_send.html', _params);
            if (_response.result) {
                var _res = _response.result;
                if (_res.error) {
                    if (typeof _res.error === 'object') {
                        $.each(_res.error, function (name, text) {
                            var _obj = $form.find('input[name="' + name + '"]');
                            if (_obj.length) {
                                if (_obj.next('label').length)
                                    _obj.next().html(text).show();
                                else
                                    $('<label id="' + name + '-error" for="' + name + '" class="invalid">' + text + '</label>').insertAfter(_obj);
                            }
                        });
                    } else {
                        $('form.form-faq-send .fatal-error').html(_res.error);
                    }


                    return false;
                } else if (_res.success) {
                    $('form.form-faq-send span.info').html(_res.success).css({'display': 'inline-block'});

                    // google analitycs
                    ga('send', 'event', 'form', 'submit', 'faq-request-success');

                } else {
                    $('form.form-faq-send .fatal-error').html('Your email was not sent');
                    console.log('System error!');
                    return false;
                }

            } else {
                $('form.form-faq-send .fatal-error').html('Your email was not sent');
                console.log('Can not get params in ajax!');
                return false;
            }


            $form.trigger("reset");
        }
    });

    // clear info in focus
    $('form.form-faq-send input, form.form-faq-send textarea').focus(function () {
//        if($('form.form-faq-send span.info').length)
//            $('form.form-faq-send span.info').html( " " ).hide();
//        if($('form.form-faq-send .fatal-error').length)
//            $('form.form-faq-send .fatal-error').html( " " ).hide();
//        if($('form.form-faq-send label.error, form.form-faq-send label.invalid').length)
//            $('form.form-faq-send label.error, form.form-faq-send label.invalid').remove();
    });



    /* validate contact us */
    $('form.form-contact-us select')
            .change(function () {
                var _selected = false;
                $('form.form-contact-us #wos').val('');
                $(this).find("option:selected").each(function () {
                    _selected = $(this).val();
                });

                if (_selected && _selected != '0') {
                    $('form.form-contact-us #wos').val(_selected).valid();
                }
                // $(this).selectpicker('hide');
            })
            .change();


    var validator_contact_us = $('form.form-contact-us').validate({
        onfocusout: false,
        onkeyup: false,
        onclick: true,
        onsubmit: true,
        focusInvalid: false,
        focusCleanup: false,
        debug: false,
        ignore: "not:hidden",
        'name': {
            required: true
        },
        'description': {
            required: true
        },
        wos: {
            required: true
        },
        email: {
            required: true,
            email: true
        },
        'captcha': {
            required: true,
        },
        messages: {
            'captcha': "Invalid CAPTCHA.", // The CAPTCHA field is empty.
            name: "The Name field is empty",
            description: 'The Question field is empty',
            wos: 'The field Choose your OS is empty',
            email: {
                required: "The Email field is empty",
                email: "Invalid email format"
            },
        },
        errorClass: "invalid",
        validClass: "success",
        invalidHandler: function (event, validator) {
            if ($('form.form-contact-us span.info').length)
                $('form.form-contact-us span.info').html(" ").hide();

            if ($('form.form-contact-us .fatal-error').length)
                $('form.form-contact-us .fatal-error').html(" ").hide();

            if ($('form.form-contact-us label.error, form.form-contact-us label.invalid').length)
                $('form.form-contact-us label.error, form.form-contact-us label.invalid').remove();
        },
        //  
        showErrors: function (errorMap, errorList) {
            var _form = $('form.form-contact-us');
            var msg = null;

            $.each(errorList, function (key, value) {
                if (value.element) {
                    var name = _form.find(value.element).attr('name');
                    // console.log( name );
                    _form.find(value.element).after('<label id="' + name + '-error" for="' + name + '" class="invalid">' + value.message + '</label>');
                    _form.find(value.element).next().show();
                }
            });
        },
        submitHandler: function (form) {
            if ($('form.form-contact-us span.info').length)
                $('form.form-contact-us span.info').html(" ").hide();

            if ($('form.form-contact-us .fatal-error').length)
                $('form.form-contact-us .fatal-error').html(" ").hide();

            if ($('form.form-contact-us label.error, form.form-contact-us label.invalid').length)
                $('form.form-contact-us label.error, form.form-contact-us label.invalid').remove();

            var $form = $(form);
            var _params = parseQuery($form.serializeArray());


            var _response = getAjaxForm('/contact_us_send.html', _params);
            if (_response.result) {

                var _res = _response.result;
                if (_res.error) {

                    if (typeof _res.error === 'object') {
                        $.each(_res.error, function (name, text) {
                            var _obj = $form.find('input[name="' + name + '"]');
                            if (_obj.length) {
                                if (_obj.next('label').length)
                                    _obj.next().html(text).show();
                                else
                                    $('<label id="' + name + '-error" for="' + name + '" class="invalid">' + text + '</label>').insertAfter(_obj);
                            }
                        });
                    } else {
                        $('form.form-contact-us .fatal-error').html(_res.error);
                    }

                    reloadCaptcha($form.find('.box-captcha > img'), true); // reload captcha
                    return false;
                } else if (_res.success) {

                    $('form.form-contact-us span.info')
                            .html(_res.success)
                            .css({'display': 'inline-block'});

                    // scrollTo block info
                    var target_top = $('form.form-contact-us span.info').offset().top;
                    $('html, body').animate({
                        scrollTop: Math.ceil((target_top * $(window).outerHeight(true)) / $('html, body').height())
                    }, 'linear');

                    // google analitycs
                    ga('send', 'event', 'form', 'submit', 'contact-request-success');

                } else {
                    $('form.form-contact-us .fatal-error').html('Your email was not sent');
                    reloadCaptcha($form.find('.box-captcha > img'), true); // reload captcha
                    return false;
                }

            } else {
                $('form.form-contact-us .fatal-error').html('Your email was not sent');
                reloadCaptcha($form.find('.box-captcha > img'), true); // reload captcha
                return false;
            }

            reloadCaptcha($form.find('.box-captcha > img')); // reload captcha
            $form.trigger("reset");
        }
    });

//    $('form.form-contact-us"]').on('submit', function() {
//       alert('ok!');
//        return false;
//    });

    $('form.form-contact-us input, form.form-contact-us textarea').focus(function () {
//        if($('form.form-contact-us span.info').length)
//            $('form.form-contact-us span.info').html( " " ).hide();
//        if($('form.form-contact-us .fatal-error').length)
//            $('form.form-contact-us .fatal-error').html( " " ).hide();
//        if($('form.form-contact-us label.error, form.form-contact-us label.invalid').length)
//            $('form.form-contact-us label.error, form.form-contact-us label.invalid').remove();
    });

    /* validate faq form */
    $('form.form-faq select')
            .change(function () {
                var _selected = false;
                $('form.form-faq #wos').val('');
                $(this).find("option:selected").each(function () {
                    _selected = $(this).val();
                });

                if (_selected && _selected != '0') {
                    $('form.form-faq #wos').val(_selected).valid();
                }
                // $(this).selectpicker('hide');
            })
            .change();


    var validator_contact_us = $('form.form-faq').validate({
        onfocusout: false,
        onkeyup: false,
        onclick: true,
        onsubmit: true,
        focusInvalid: false,
        focusCleanup: false,
        debug: false,
        ignore: "not:hidden",
        'name': {
            required: true
        },
        'description': {
            required: true
        },
        wos: {
            required: true
        },
        email: {
            required: true,
            email: true
        },
        'captcha': {
            required: true,
        },
        messages: {
            'captcha': "Invalid CAPTCHA.", // The CAPTCHA field is empty.
            name: "The Name field is empty",
            description: 'The Question field is empty',
            wos: 'The field Choose your OS is empty',
            email: {
                required: "The Email field is empty",
                email: "Invalid email format"
            },
        },
        errorClass: "invalid",
        validClass: "success",
        invalidHandler: function (event, validator) {
            if ($('form.form-faq span.info').length)
                $('form.form-faq span.info').html(" ").hide();

            if ($('form.form-faq .fatal-error').length)
                $('form.form-faq .fatal-error').html(" ").hide();

            if ($('form.form-faq label.error, form.form-faq label.invalid').length)
                $('form.form-faq label.error, form.form-faq label.invalid').remove();
        },
        //  
        showErrors: function (errorMap, errorList) {
            var _form = $('form.form-faq');
            var msg = null;

            $.each(errorList, function (key, value) {
                if (value.element) {
                    var name = _form.find(value.element).attr('name');
                    // console.log( name );
                    _form.find(value.element).after('<label id="' + name + '-error" for="' + name + '" class="invalid">' + value.message + '</label>');
                    _form.find(value.element).next().show();
                }
            });
        },
        submitHandler: function (form) {
            if ($('form.form-faq span.info').length)
                $('form.form-faq span.info').html(" ").hide();

            if ($('form.form-faq .fatal-error').length)
                $('form.form-faq .fatal-error').html(" ").hide();

            if ($('form.form-faq label.error, form.form-faq label.invalid').length)
                $('form.form-faq label.error, form.form-faq label.invalid').remove();

            var $form = $(form);
            var _params = parseQuery($form.serializeArray());


            var _response = getAjaxForm('/faq.html', _params);
            if (_response.result) {

                var _res = _response.result;
                if (_res.error) {

                    if (typeof _res.error === 'object') {
                        $.each(_res.error, function (name, text) {
                            var _obj = $form.find('input[name="' + name + '"]');
                            if (_obj.length) {
                                if (_obj.next('label').length)
                                    _obj.next().html(text).show();
                                else
                                    $('<label id="' + name + '-error" for="' + name + '" class="invalid">' + text + '</label>').insertAfter(_obj);
                            }
                        });
                    } else {
                        $('form.form-faq .fatal-error').html(_res.error);
                    }

                    reloadCaptcha($form.find('.box-captcha > img'), true); // reload captcha
                    return false;
                } else if (_res.success) {

                    $('form.form-faq span.info')
                            .html(_res.success)
                            .css({'display': 'inline-block'});

                    // scrollTo block info
                    var target_top = $('form.form-faq span.info').offset().top;
                    $('html, body').animate({
                        scrollTop: Math.ceil((target_top * $(window).outerHeight(true)) / $('html, body').height())
                    }, 'linear');

                    // google analitycs
                    ga('send', 'event', 'form', 'submit', 'contact-request-success');

                } else {
                    $('form.form-faq .fatal-error').html('Your email was not sent');
                    reloadCaptcha($form.find('.box-captcha > img'), true); // reload captcha
                    return false;
                }

            } else {
                $('form.form-faq .fatal-error').html('Your email was not sent');
                reloadCaptcha($form.find('.box-captcha > img'), true); // reload captcha
                return false;
            }

            reloadCaptcha($form.find('.box-captcha > img')); // reload captcha
            $form.trigger("reset");
        }
    });


    // validate form
    //if($(".box-form").length) {
    //    $(".box-form").validate();
    // }
    /* ------- form login ------ */
    if ($('form[name="form-login"]').length) {
        $('form[name="form-login"]').validate({
            onfocusout: false,
            onkeyup: false,
            onclick: true,
            onsubmit: true,
            focusInvalid: false,
            focusCleanup: false,
            messages: {
                'password': "The Password field is empty.",
                'email': {
                    required: "The Email field is empty.",
                    email: "Invalid email format."
                },
                errorClass: "error",
            },
            invalidHandler: function (event, validator) {
                if ($('form[name="form-login"] label.error').length)
                    $('form[name="form-login"] label.error').remove();

                if ($('form[name="form-login"] div.box-error')) {
                    $('form[name="form-login"] div.box-error').addClass('hide');
                }
            },
            //  
            showErrors: function (errorMap, errorList) {
                var _form = $('form[name="form-login"]');
                var msg = null;

                $.each(errorList, function (key, value) {
                    if (value.element) {
                        _form.find(value.element).after('<label class="error">' + value.message + '</label>');
                        _form.find(value.element).next().show();
                    }
                });
            },
        });
    }

    /* ------- form-registration ------ */
    if ($('form[name="form-registration"]').length) {
        $('form[name="form-registration"]').validate({
            onfocusout: false,
            onkeyup: false,
            onclick: true,
            onsubmit: true,
            focusInvalid: false,
            focusCleanup: false,
            messages: {
                'captcha': "Invalid CAPTCHA.", // The CAPTCHA field is empty.
                'email': {
                    required: "The Email field is empty.",
                    email: "Invalid email format."
                },
                errorClass: "error",
            },
            invalidHandler: function (event, validator) {
                if ($('form[name="form-registration"] label.error').length)
                    $('form[name="form-registration"] label.error').remove();

                if ($('form[name="form-registration"] div.box-error')) {
                    $('form[name="form-registration"] div.box-error').addClass('hide');
                }
            },
            //  
            showErrors: function (errorMap, errorList) {
                var _form = $('form[name="form-registration"]');
                var msg = null;

                $.each(errorList, function (key, value) {
                    if (value.element) {
                        _form.find(value.element).after('<label class="error">' + value.message + '</label>');
                        _form.find(value.element).next().show();
                    }
                });
            },
        });
    }

    /* ------- form-free-trial-registration ------ */
    if ($('form[name="free_trial_registration"]').length) {
        $('form[name="free_trial_registration"]').validate({
            onfocusout: false,
            onkeyup: false,
            onclick: true,
            onsubmit: true,
            focusInvalid: false,
            focusCleanup: false,
            messages: {
                'captcha': "Invalid CAPTCHA.", // The CAPTCHA field is empty.
                'name': {
                    required: "The Name field is empty.",
                },
                'email': {
                    required: "The Email field is empty.",
                    email: "Invalid email format."
                },
                errorClass: "error",
            },
            invalidHandler: function (event, validator) {
                if ($('form[name="free_trial_registration"] #block-fields label.error').length)
                    $('form[name="free_trial_registration"] #block-fields label.error').remove();

                if ($('form[name="free_trial_registration"] div.box-error')) {
                    $('form[name="free_trial_registration"] div.box-error').addClass('hide');
                }
            },
            //  
            showErrors: function (errorMap, errorList) {
                var fileds = $('form[name="free_trial_registration"] #block-fields');
                var msg = null;

                $.each(errorList, function (key, value) {
                    // console.log(key, value);
                    if (value.element) {
                        fileds.find(value.element).after('<label class="error">' + value.message + '</label>').show();
                    }
                });
            },
        });
    }

    /* ------- form-restore ------ */
    if ($('form[name="form-restore"]').length) {
        $('form[name="form-restore"]').validate({
            onfocusout: false,
            onkeyup: false,
            onclick: true,
            onsubmit: true,
            focusInvalid: false,
            focusCleanup: false,
            debug: false,
            messages: {
                'email': {
                    required: "The Email field is empty.",
                    email: "Invalid email format."
                },
                errorClass: "error",
            },
            invalidHandler: function (event, validator) {
                if ($('form[name="form-restore"] label.error').length)
                    $('form[name="form-restore"] label.error').remove();

                if ($('form[name="form-restore"] div.box-error')) {
                    $('form[name="form-restore"] div.box-error').addClass('hide');
                }
            },
            //  
            showErrors: function (errorMap, errorList) {
                var _form = $('form[name="form-restore"]');
                var msg = null;

                $.each(errorList, function (key, value) {
                    if (value.element) {
                        _form.find(value.element).after('<label class="error">' + value.message + '</label>');
                        _form.find(value.element).next().show();
                    }
                });
            },
        });
    }

    /* ----- form discount ----- */
    if ($('#form-discount').length) {
        $('#form-discount').validate({
            onfocusout: false,
            onkeyup: false,
            onclick: true,
            onsubmit: true,
            focusInvalid: false,
            focusCleanup: false,
            messages: {
                'captcha': "Invalid CAPTCHA.", // The CAPTCHA field is empty.
                'discount[name]': "The Name field is empty.",
                'discount[email]': {
                    required: "The Password field is empty.",
                    email: "Invalid email format."
                },
                errorClass: "error",
            },
            invalidHandler: function (event, validator) {
                if ($('#form-discount label.error').length)
                    $('#form-discount label.error').remove();

                if ($('#form-discount div.box-error')) {
                    $('#form-discount div.box-error').addClass('hide');
                }
            },
            //  
            showErrors: function (errorMap, errorList) {
                var _form = $('#form-discount');
                var msg = null;

                $.each(errorList, function (key, value) {
                    if (value.element) {
                        _form.find(value.element).after('<label class="error">' + value.message + '</label>');
                        _form.find(value.element).next().show();
                    }
                });
            },
        });
    }

    /**
     * CAPACHA
     */
    if ($('.box-captcha').length) {
        $('.update-captcha, .a-update-captcha').on('click', function (event) {
            event.preventDefault();
            reloadCaptcha($(this), true);
//           var _src = '/captcha.html?'+Math.random();
//           if($(this).attr('attr-width') && $(this).attr('attr-height')) {
//               _src = '/captcha.html?width='+$(this).attr('attr-width')+'&height='+$(this).attr('attr-height')+'&'+Math.random();
//           }
//
//           $('.box-captcha').find('#img-captcha').attr('src', _src);
//           $('form[name="form-registration"], form[name="free_trial_registration"]').find('input[name="captcha"]').focus();
            return false;
        });
    }

    //scroll to target
    function scrollTo(selector,speed) {
        $('html,body').animate({scrollTop: $(selector).offset().top -50 }, speed);
    }
	
		// switch features iOS
    $('.show_premium_features._icloud-f').on('tap', function(e) {
        if(e.handled !== true) {
            $('.premium_fe._icloud-f').css("margin-top", "10px");
            $('.premium_fe._icloud-f').slideToggle();
            $('.show-f._icloud-f').toggle()
            if($('.hide-f._icloud-f').is(':visible')) {
                scrollTo('.prod-icloud', 'fast');
            }
            $('.hide-f._icloud-f').toggle()
            $('.prod-icloud.prod-2').toggle()
            e.handled = true;
        }
    });
    
    // switch features Android basic
    $('.show_basic_features._android-f').on('tap', function(e) {
        if(e.handled !== true) {
            $('.basic_fe._android-f').css("margin-top", "10px");
            $('.basic_fe._android-f').slideToggle();
            $('.basic_wr .show-f._android-f').toggle()
            if($('.hide-f._android-f').is(':visible')) {
                scrollTo('.basic_h', 'fast');
            }
            $('.basic_wr .hide-f._android-f').toggle();
            e.handled = true;
        }
    });
    // switch features Android premium
    $('.show_premium_features._android-f').on('tap', function(e) {
        if(e.handled !== true) {
            $('.premium_fe._android-f').css("margin-top", "10px");
            $('.premium_fe._android-f').slideToggle();
            $('.premium_wr .show-f._android-f').toggle()
            if($('.hide-f._android-f').is(':visible')) {
                scrollTo('#prem-header', 'fast');
            }
            $('.premium_wr .hide-f._android-f').toggle();
            e.handled = true;
        }
    });
    
		// switch features Jailbreak
    $('.show_premium_features._jailbreak-f').on('tap', function(e) {
        if(e.handled !== true) {
            $('.premium_fe._jailbreak-f').css("margin-top", "10px");
            $('.premium_fe._jailbreak-f').slideToggle();
            $('.show-f._jailbreak-f').toggle()
            if($('.hide-f._jailbreak-f').is(':visible')) {
                scrollTo('div[data-info-block=ios-jb]', 'fast');
            }
            $('.hide-f._jailbreak-f').toggle()
            $('.prod-icloud.prod-2.jailbreak-f').toggle()
            e.handled = true;
        }
    });
    $("input[name='optionsRadios']").each(function () {
        if (this.getAttribute("checked")) {

            $(this).parent('.label_radio').addClass('r_on');
            $(this).parent('.label_radio').removeClass('r_off');
            $(this).parents('form').children('.product_price').val($(this).val());
        }
    });
    
    /*$("input[name='optionsRadios']").filter(':checked').each(function(){

     var curr  = $(this);



     curr.parent('.label_radio').removeClass('r_off');
     curr.parent('.label_radio').addClass('r_on');

     curr.parents('form').children('.product_price').val(curr.val());

     });   */
    /* hashchange_AfterInit */

    hashchange_AfterInit();

    /* fix features desine chrome */
    if ($('#viber-whatsapp-skype').length) {
        if ($.browser.webkit) {
            $('#viber-whatsapp-skype').removeClass('w30p').addClass('w16p');
            // alert( "This is WebKit!" );
        } else
            $('#viber-whatsapp-skype').removeClass('w16p').addClass('w30p');
    }

// ga click
// faq
    $('form[name="form-faq"] button.event-submit').click(function () {
        ga('send', 'event', 'form', 'submit', 'faq-request');
    });

// login
    $('form[name="form-login"] .button-sumbit button').click(function () {
        ga('send', 'event', 'form', 'submit', 'login');
    });

// restore
    $('form[name="form-restore"] .button-sumbit button').click(function () {
        ga('send', 'event', 'form', 'submit', 'restore');
    });

// registration
    $('form[name="form-registration"] .button-sumbit button').click(function () {
        ga('send', 'event', 'form', 'submit', 'registration');
    });

// contact-us
    $('form[name="send-mail-contact-us"] button.event-submit').click(function () {
        ga('send', 'event', 'form', 'submit', 'contact-request');
    });

// compatibility
    $('form[name="send_find_phone"] button.event-submit').click(function () {
        ga('send', 'event', 'form', 'submit', 'compatibility-request');
    });



    // scroll (fly-box)
    if ($('.fly-box').length) {
        $('.fly-box').scrollPumpic({
            'start': 1000,
            'stop': 0,
            'animate': {
                'type': 'visible', // fade, visible, blinking
                'timeShow': 50,
                'timeHide': 50
            }
        }); //"coeff":1.15
    }

    // fly block
    if ($('.fly-box-buttons').length) {
        $(window).on('load resize', function () {
            var $offcetTop = Math.round($('.fly-position').offset().top);
            if (typeof $.data(document, '_scrollButtons_' + $(this).width()) == "undefined"
                    || $.data(document, '_scrollButtons_' + $(this).width()) != $offcetTop) {
                $.data(document, '_scrollButtons_' + $(this).width(), $offcetTop);
            }

            // console.log( $offcetTop, $.data(document, '_scrollButtons_'+$(this).width()) );

            if ($.data(document, '_scrollButtons_' + $(this).width())) {
                $('.fly-box-buttons').scrollPumpic({
                    '_objFly': '.block-fly',
                    'start': $.data(document, '_scrollButtons_' + $(this).width()),
                    'stop': 0,
                    'right': 300,
                    '_settings': {
                        '_responce': false,
                        '_validate': false
                    },
                    'animate': {
                        'type': 'blinking', // fade, visible, blinking
                        'timeShow': 30,
                        'timeHide': 50
                    }
                }); //"coeff":1.15
            }

        });
    }

    // tabs compatibility
    $('#temp-1 .bc-tabs .item-tab a, #temp-1 .bc-tabs .item-tab span, #temp-2 > ul > li > a, #temp-2 > ul > li > span').on('click', function () {
        // clear all active
        var _itab = $(this).parent(),
                _this = $(this),
                _data_cat_id = _itab.attr('data-cat-id');
        $.each($('#temp-1 .bc-tabs .item-tab, #temp-2 > ul > li, #temp-1 #tab-content > div'), function (key, val) {
            if ($(val).hasClass('active'))
                $(val).removeClass('active');
        });

        if (!_itab.hasClass('active')) {
            $('#temp-1 .bc-tabs section > div[data-cat-id="' + _data_cat_id + '"], #temp-2 > ul > li[data-cat-id="' + _data_cat_id + '"]').addClass('active');
            $('#temp-1 #tab-content > div[data-cat-id="' + _data_cat_id + '"]').addClass('active');
        }

        // clear all items
//            $.each($('#temp-2 > ul > li ul'), function(key, value) {
//                $(value).slideUp();
//            });

//      if($('#temp-2 > ul > li ul').is(':visible')) {
//          $('#temp-2 > ul > li ul').slideUp('slow');
//      }

        if (_itab.children('ul').is(':not(visible)')) {
            _itab.children('ul').slideDown('slow', function () {

                $.each($('#temp-2 > ul > li').not(':eq(' + $(this).parent().index() + ')').children('ul'), function (key, value) {
                    $(value).slideUp();
                });

                // scroll to active
                $('html, body').stop().animate({
                    scrollTop: _this.offset().top
                }, 1000);
            });
        }



    });


    // mobile operators
    if ($('.toggle-mobile-operators').length) {
        $('.toggle-mobile-operators').on('click', function (event) {
            event.preventDefault();
            $.each($('#mobile-operators .item-operators'), function (key, value) {
                if ($(value).hasClass('hide')) {
                    $(value).removeClass('hide').addClass('show');
                }
            });
            $(this).parent().hide();
            return false;
        });
    }



    // hovers
    $('.box-video-constructors .block-video-button > .box-hover').hover(
            function () {
                // console.log( $rs_width );
                if ($rs_width > 992) // !$rs_width ||
                    $(this).find('.hover-video-buttons').show();
            }, function () {
        if ($rs_width > 992) // !$rs_width ||
            $(this).find('.hover-video-buttons').hide();
    }
    );


    // bootstrap clic popUp
    if ($(".youtube").length) {
        $(".youtube").YouTubeModal({
            autoplay: 1,
            autohide: 1,
            width: 820,
            height: 520,
            theme: 'darck'
        });
    }

    // sticky
    if ($('.sticky').length) {

        $(window).on('scroll', function () {
            var windowTop = $(window).scrollTop();
            if (windowTop > 68) {
                $('.sticky').addClass('fixed');
            } else {
                $('.sticky').removeClass('fixed');
            }
        });


//        var sticky = document.querySelector('.sticky');
//        var origOffsetY = (!sticky.offsetTop) ? 68 : sticky.offsetTop;
//
//        function onScroll(e) {
//            window.scrollY >= origOffsetY ? sticky.classList.add('fixed') :
//                                          sticky.classList.remove('fixed');
//
//            console.log(window.scrollY+' = '+ origOffsetY);
//        }
//
//        document.addEventListener('scroll', onScroll);
    }
    /*$(".blocks-sticky").autofix_anything({
     customOffset: false, // You can define custom offset for when you want the container to be fixed. This option takes the number of pixels from the top of the page. The default value is false which the plugin will automatically fix the container when the it is in the viewport
     manual: false, // Toggle this to true if you wish to manually fix containers with the public method. Default value is false
     onlyInContainer: true // Set this to false if you don't want the fixed container to limit itself to the parent's container.
     });
     */

    /*
     if($(".phone-sticky").length) {

     if($(".phone-sticky").is(':visible')) {

     $(window).on('scroll', function() {
     var windowTop = $(window).scrollTop();
     if(windowTop > 68) {
     $(".phone-sticky").css({'position': 'fixed'});
     } else {
     $(".phone-sticky").css({'position': 'static'});
     }
     });

     }

     }
     */

    /*
     $('a#openBtnVideo').click(function(e){
     e.preventDefault();
     var src = $(this).attr('data-src');
     var height = $(this).attr('data-height') || 520;
     var width = $(this).attr('data-width') || 820;

     var p_w = parseInt( width ) + 15;
     var p_h = parseInt( height ) + 25;

     // $("#myModal .modal-dialog").css({'max-width': p_w+'px'}); // 'height': p_h+'px'
     $("#myModal .modal-body").css({'max-width': width+'px', 'height': height+'px'});

     $("#myModal iframe").attr({ 'height': height,
     'width': width});

     $('#myModal').on('shown.bs.modal', function (e) {
     $("#myModal iframe").attr({'src':src});
     });

     $('#myModal').on('hidden.bs.modal', function (e) {
     $("#myModal iframe").attr({'src': '#'});
     });

     $('#myModal').modal({show:true});
     return false;
     });

     $('#myModal').on('shown.bs.modal', function (e) {
     });
     $('#myModal').on('hidden.bs.modal', function (e) {
     });
     */


//    $('a#openBtnVideo').on('click', function(e) {
//        var src = $(this).attr('data-src');
//        var height = $(this).attr('data-height') || 520;
//        var width = $(this).attr('data-width') || 820;
//
//        var p_w = parseInt( width ) + 15;
//        var p_h = parseInt( height ) + 25;
//
//        $("#myModal .modal-dialog").css({'width': p_w+'px', 'height': p_h+'px'});
//        $("#myModal .modal-body").css({'width': width+'px', 'height': height+'px'});
//        $("#myModal iframe").attr({'src':src,
//                               'height': height,
//                               'width': width});
//    });



//    $(window).on('load resize', function() {
//         console.log($(this).width());
//    });


    // countries
    $("#c-features .row-list > li, .b-how-it-work h3.weight-normal, #block-compatibility-table .table-body > div > p").matchHeight();

    if ($('.match-height').length)
        $('.match-height').matchHeight();

//    if($('#b-recommended-by .main-block > .b-item').length)
//        $('#b-recommended-by .main-block > .b-item').matchHeight();

    $.fn.matchHeight._beforeUpdate = function (event, groups) {

        // do something before any updates are applied
    }

    $.fn.matchHeight._afterUpdate = function (event, groups) {
        /*
         if($('#b-recommended-by .main-block > .b-item').length)
         $('#b-recommended-by .main-block > .b-item').find('lable.title').css({'line-height': $('#b-recommended-by .main-block > .b-item').height()+'px'});
         */
        // do something after all updates are applied
    }

    if ($('.box_category .minus, .box_category .plus').length) {
        $('.box_category .minus, .box_category .plus').on('click', function () {
            $(this).parent('div').find('.collapse').collapse('toggle');
        });
    }

    $('.collapse').on('shown.bs.collapse', function (e) {
        console.log('Show');
        if ($(this).parent('div').find('i.plus')) {
            $(this).parent('div').find('i.plus').removeClass('plus').addClass('minus');
        }
    });
    $('.collapse').on('hidden.bs.collapse', function (e) {
        if ($(this).parent('div').find('i.minus')) {
            $(this).parent('div').find('i.minus').removeClass('minus').addClass('plus');
        }
    });

//    $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function(e) {
//       var _class = $(this).parent().attr('class');
//       if(_class == 'plus') {
//           $(this).parent('div.plus').attr('class', 'minus'); // removeClass('plus').addClass('minus');
//       } else if(_class == 'minus') {
//           $(this).parent('div.minus').attr('class', 'plus'); //.removeClass('minus').addClass('plus');
//       }
//
//    });

    if ($('.block-child-location-tracking .feature').length) {
        $(window).on("load resize orientationchange", function (a) {
            if ($(this).width() > 992) {
                $('.block-child-location-tracking .feature').each(function (key, item) {
                    $(item).css({"display": "inline-block", 'width': 'auto'});
                    $(item).css({"width": ($(item).width() + 81) + "px"});
                    $(item).css({"display": "block", 'margin': '0 auto'});
                });
            } else {
                $('.block-child-location-tracking .feature').each(function (key, item) {
                    $(item).css({"display": "block", 'margin': '0 auto', 'width': 'auto'});
                });
            }
        });
    }


    //    
    $('a.anchor-menu-fly').on("click", function (e) {
        e.preventDefault();
        var anchor = $(this).attr('href').split('#');
        if (anchor.length > 1) {
            var _top = $('#' + anchor[1]).offset().top - $('#block-stickybar').height();
            $('html, body').stop().animate({
                scrollTop: _top + 'px'
            }, 1000);
        }

        return false;
    });

    if ($('.buy-form-with-offer').size()) {
        var symbols = {usd: '$', eur: '', gbp: '', cad: '$', aud: '$'};

        var updateRadio = function (input) {
            var $form = $(input).closest('form');

            var data = $(input).data();
            
            //old store
            //var offerEnabled = $form.find('input[type=checkbox][name=android-40off][data-group=' + data.group + ']').is(':checked');
            var offerEnabled = $form.find('input[type=checkbox][data-group=' + data.group + ']').is(':checked');
            var $options = $('.buy-form-with-offer').find('input[type=radio][data-group=' + data.group + '][data-period=' + data.period + ']');

            $options.each(function () {
                var optionData = $(this).data();

                $productField = $(this).closest('form').find('input.product_price');

                if (offerEnabled) {
                    $productField.val(optionData.offerProduct);
                } else {
                    $productField.val(optionData.product);
                }

                $(this).closest('ul').find('label')
                        .removeClass('r_on')
                        .addClass('r_off');

                $(this).closest('label')
                        .addClass('r_on')
                        .removeClass('r_off');
            });

            if (typeof data.target != 'undefined') {

                var currentValue = $(input).attr('data-price-' + data.cur) / Number(data.period);

                if (offerEnabled) {
                    currentValue = $(input).attr('data-offer-price-' + data.cur) / Number(data.period);
                }

                var displayValue = (Math.floor(currentValue * 100) / 100).toFixed(2);

                $(data.target).html(displayValue)
                        .prev('div.symbol')
                        .html(symbols[data.cur] ? symbols[data.cur] : '');
            }
        };

        var updateCheckbox = function (input) {
            var data = $(input).data();

            var offerEnabled = $(input).is(":checked");

            var $checkboxes = $('.buy-form-with-offer').find('input[type=checkbox][data-group=' + data.group + ']');

            $checkboxes.each(function () {
                var $form = $(this).closest('form');

                if (offerEnabled) {
                    if (!$(this).is(":checked")) {
                        $(this).prop('checked', offerEnabled);
                    }
                    //old store
                    // $('.wr_pack_' + data.group).hide();
                    // $('.wr_pack_double_' + data.group).show();
                    // $form.find('.offer_old_price').show();
                    // $form.find('.package_price').hide();
                    // $form.find('.package_offer_price').show();
                    $('._single-pack-' + data.group).hide();
                    $('._double-pack-' + data.group).show();
                    $form.find('.offer_old_price').show();
                    $form.find('.package_price').hide();
                    $form.find('.package_offer_price').show();
                    
                } else {
                    if ($(this).is(":checked")) {
                        $(this).prop('checked', offerEnabled);
                    }
                    
                    //old store
                    // $('.wr_pack_double_' + data.group).hide();
                    // $('.wr_pack_' + data.group).show();
                    // $form.find('.offer_old_price').hide();
                    // $form.find('.package_offer_price').hide();
                    // $form.find('.package_price').show();
                    $('._double-pack-' + data.group).hide();
                    $('._single-pack-' + data.group).show();
                    $form.find('.offer_old_price').hide();
                    $form.find('.package_offer_price').hide();
                    $form.find('.package_price').show();
                }
            });

            $(input).closest('form').find('input[type=radio]:checked').each(function () {
                updateRadio(this);
            });
        };

        $('.buy-form-with-offer input[type=radio]:checked').each(function () {
            updateRadio(this);
        });

        $('.buy-form-with-offer label').has('input[type=radio]').click(function (e) {
            if (e.target.tagName != 'INPUT') {
                return;
            }

            $input = $(this).find('input:first');
            updateRadio($input);
        });

        $('.buy-form-with-offer input[type=checkbox]').change(function(){
            updateCheckbox(this);
        });
    } else if ($('.buy-form').size()) {
        var symbols = {usd: '$', eur: '', gbp: '', cad: '$', aud: '$'};

        var updateRadio = function (input) {
            var data = $(input).data();

            var $inputs = $('.buy-form').find('input[data-period=' + data.period + '][data-group=' + data.group + ']');

            $inputs.each(function () {
                $productField = $(this).closest('form').find('input.product_price');

                $productField.val($(this).val());

                $(this).closest('ul').find('label')
                        .removeClass('r_on')
                        .addClass('r_off');

                $(this).closest('label')
                        .addClass('r_on')
                        .removeClass('r_off');
            });

            if (typeof data.target != 'undefined') {
                var currentValue = $(input).attr('data-price-' + data.cur) / Number(data.period);

                currentValue = (Math.floor(currentValue * 100) / 100).toFixed(2);

                $(data.target).html(currentValue)
                        .prev('div.symbol')
                        .html(symbols[data.cur] ? symbols[data.cur] : '');
            }
        };

        $('.buy-form input:checked').each(function () {
            updateRadio(this);
        });

        $('.buy-form label').click(function (e) {
            if (e.target.tagName != 'INPUT') {
                return;
            }

            updateRadio($(this).find('input:first'));
        });
    }
    function updateCheckboxes(attrVal) {
        $("input[data-checkboxes="+attrVal+"]").change(function(){
            var $inputs = $("input[name="+attrVal+"]")
            $inputs.attr('checked', this.checked);
            $.each($inputs, function() {updateCheckbox(this)})
        });
    }
    updateCheckboxes('jailbreak-40off');
    updateCheckboxes('android-40off');
    updateCheckboxes('icloud-40off');
    
    if($('input[name=get-40off]')) {
     updateCheckboxes('get-40off');
    }
    
});

/*
 * jQuery hashchange event - v1.3 - 7/21/2010
 * http://benalman.com/projects/jquery-hashchange-plugin/
 * 
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
(function($,e,b){var c="hashchange",h=document,f,g=$.event.special,i=h.documentMode,d="on"+c in e&&(i===b||i>7);function a(j){j=j||location.href;return"#"+j.replace(/^[^#]*#?(.*)$/,"$1")}$.fn[c]=function(j){return j?this.bind(c,j):this.trigger(c)};$.fn[c].delay=50;g[c]=$.extend(g[c],{setup:function(){if(d){return false}$(f.start)},teardown:function(){if(d){return false}$(f.stop)}});f=(function(){var j={},p,m=a(),k=function(q){return q},l=k,o=k;j.start=function(){p||n()};j.stop=function(){p&&clearTimeout(p);p=b};function n(){var r=a(),q=o(m);if(r!==m){l(m=r,q);$(e).trigger(c)}else{if(q!==m){location.href=location.href.replace(/#.*/,"")+q}}p=setTimeout(n,$.fn[c].delay)}$.support.msie&&!d&&(function(){var q,r;j.start=function(){if(!q){r=$.fn[c].src;r=r&&r+a();q=$('<iframe tabindex="-1" title="empty"/>').hide().one("load",function(){r||l(a());n()}).attr("src",r||"javascript:0").insertAfter("body")[0].contentWindow;h.onpropertychange=function(){try{if(event.propertyName==="title"){q.document.title=h.title}}catch(s){}}}};j.stop=k;o=function(){return a(q.location.href)};l=function(v,s){var u=q.document,t=$.fn[c].domain;if(v!==s){u.title=h.title;u.open();t&&u.write('<script>document.domain="'+t+'"<\/script>');u.close();q.location.hash=v}}})();return j})()})(jQuery,this);
/*!
 * jQuery Cookie Plugin v1.3.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */
(function (factory) {
	if (typeof define === 'function' && define.amd) {
		// AMD. Register as anonymous module.
		define(['jquery'], factory);
	} else {
		// Browser globals.
		factory(jQuery);
	}
}(function ($) {

	var pluses = /\+/g;

	function raw(s) {
		return s;
	}

	function decoded(s) {
		return decodeURIComponent(s.replace(pluses, ' '));
	}

	function converted(s) {
		if (s.indexOf('"') === 0) {
			// This is a quoted cookie as according to RFC2068, unescape
			s = s.slice(1, -1).replace(/\\"/g, '"').replace(/\\\\/g, '\\');
		}
		try {
			return config.json ? JSON.parse(s) : s;
		} catch(er) {}
	}

	var config = $.cookie = function (key, value, options) {

		// write
		if (value !== undefined) {
			options = $.extend({}, config.defaults, options);

			if (typeof options.expires === 'number') {
				var days = options.expires, t = options.expires = new Date();
				t.setDate(t.getDate() + days);
			}

			value = config.json ? JSON.stringify(value) : String(value);

			return (document.cookie = [
				config.raw ? key : encodeURIComponent(key),
				'=',
				config.raw ? value : encodeURIComponent(value),
				options.expires ? '; expires=' + options.expires.toUTCString() : '', // use expires attribute, max-age is not supported by IE
				options.path    ? '; path=' + options.path : '',
				options.domain  ? '; domain=' + options.domain : '',
				options.secure  ? '; secure' : ''
			].join(''));
		}

		// read
		var decode = config.raw ? raw : decoded;
		var cookies = document.cookie.split('; ');
		var result = key ? undefined : {};
		for (var i = 0, l = cookies.length; i < l; i++) {
			var parts = cookies[i].split('=');
			var name = decode(parts.shift());
			var cookie = decode(parts.join('='));

			if (key && key === name) {
				result = converted(cookie);
				break;
			}

			if (!key) {
				result[name] = converted(cookie);
			}
		}

		return result;
	};

	config.defaults = {};

	$.removeCookie = function (key, options) {
		if ($.cookie(key) !== undefined) {
			// Must not alter options, thus extending a fresh object...
			$.cookie(key, '', $.extend({}, options, { expires: -1 }));
			return true;
		}
		return false;
	};

}));

//http://stackoverflow.com/questions/12214654/jquery-1-8-find-event-handlers
//http://james.padolsey.com/javascript/debug-jquery-events-with-listhandlers/
// $('*').listHandlers('*');
// $('a').listHandlers('onclick');
$(document).ready(function(){
    $.fn.listHandlers = function(events) {
        this.each(function(i){
            var elem = this,
            // dEvents = $(this).data('events');
            dEvents = $._data($(this).get(0), "events");
            if (!dEvents) {return;}
            $.each(dEvents, function(name, handler){
                if((new RegExp('^(' + (events === '*' ? '.+' : events.replace(',','|').replace(/^on/i,'')) + ')$' ,'i')).test(name)) {
                    $.each(handler,
                        function(i,handler){
                        //console.info(elem);
                        console.info(elem, '\n' + i + ': [' + name + '] : ' + handler.handler );
                    });
                }
            });
        });
    };
    
    $.fn.hasHandlers = function(events,selector) {
        var result=false;
        this.each(function(i){
            var elem = this;
            dEvents = $._data($(this).get(0), "events");
            if (!dEvents) {return false;}
            $.each(dEvents, function(name, handler){
                if((new RegExp('^(' + (events === '*' ? '.+' : events.replace(',','|').replace(/^on/i,'')) + ')$' ,'i')).test(name)) {
                $.each(handler,
                    function(i,handler){
                        if (handler.selector===selector)
                        result=true;
                });
            }
            });
        });
        return result;
    };
}); 
/**
* jquery.matchHeight-min.js master
* http://brm.io/jquery-match-height/
* License: MIT
*/
(function(c){var n=-1,f=-1,g=function(a){return parseFloat(a)||0},r=function(a){var b=null,d=[];c(a).each(function(){var a=c(this),k=a.offset().top-g(a.css("margin-top")),l=0<d.length?d[d.length-1]:null;null===l?d.push(a):1>=Math.floor(Math.abs(b-k))?d[d.length-1]=l.add(a):d.push(a);b=k});return d},p=function(a){var b={byRow:!0,property:"height",target:null,remove:!1};if("object"===typeof a)return c.extend(b,a);"boolean"===typeof a?b.byRow=a:"remove"===a&&(b.remove=!0);return b},b=c.fn.matchHeight=
function(a){a=p(a);if(a.remove){var e=this;this.css(a.property,"");c.each(b._groups,function(a,b){b.elements=b.elements.not(e)});return this}if(1>=this.length&&!a.target)return this;b._groups.push({elements:this,options:a});b._apply(this,a);return this};b._groups=[];b._throttle=80;b._maintainScroll=!1;b._beforeUpdate=null;b._afterUpdate=null;b._apply=function(a,e){var d=p(e),h=c(a),k=[h],l=c(window).scrollTop(),f=c("html").outerHeight(!0),m=h.parents().filter(":hidden");m.each(function(){var a=c(this);
a.data("style-cache",a.attr("style"))});m.css("display","block");d.byRow&&!d.target&&(h.each(function(){var a=c(this),b=a.css("display");"inline-block"!==b&&"inline-flex"!==b&&(b="block");a.data("style-cache",a.attr("style"));a.css({display:b,"padding-top":"0","padding-bottom":"0","margin-top":"0","margin-bottom":"0","border-top-width":"0","border-bottom-width":"0",height:"100px"})}),k=r(h),h.each(function(){var a=c(this);a.attr("style",a.data("style-cache")||"")}));c.each(k,function(a,b){var e=c(b),
f=0;if(d.target)f=d.target.outerHeight(!1);else{if(d.byRow&&1>=e.length){e.css(d.property,"");return}e.each(function(){var a=c(this),b=a.css("display");"inline-block"!==b&&"inline-flex"!==b&&(b="block");b={display:b};b[d.property]="";a.css(b);a.outerHeight(!1)>f&&(f=a.outerHeight(!1));a.css("display","")})}e.each(function(){var a=c(this),b=0;d.target&&a.is(d.target)||("border-box"!==a.css("box-sizing")&&(b+=g(a.css("border-top-width"))+g(a.css("border-bottom-width")),b+=g(a.css("padding-top"))+g(a.css("padding-bottom"))),
a.css(d.property,f-b+"px"))})});m.each(function(){var a=c(this);a.attr("style",a.data("style-cache")||null)});b._maintainScroll&&c(window).scrollTop(l/f*c("html").outerHeight(!0));return this};b._applyDataApi=function(){var a={};c("[data-match-height], [data-mh]").each(function(){var b=c(this),d=b.attr("data-mh")||b.attr("data-match-height");a[d]=d in a?a[d].add(b):b});c.each(a,function(){this.matchHeight(!0)})};var q=function(a){b._beforeUpdate&&b._beforeUpdate(a,b._groups);c.each(b._groups,function(){b._apply(this.elements,
this.options)});b._afterUpdate&&b._afterUpdate(a,b._groups)};b._update=function(a,e){if(e&&"resize"===e.type){var d=c(window).width();if(d===n)return;n=d}a?-1===f&&(f=setTimeout(function(){q(e);f=-1},b._throttle)):q(e)};c(b._applyDataApi);c(window).bind("load",function(a){b._update(!1,a)});c(window).bind("resize orientationchange",function(a){b._update(!0,a)})})(jQuery);
/**
* simplePagination.js v1.6
* A simple jQuery pagination plugin.
* http://flaviusmatis.github.com/simplePagination.js/
*
* Copyright 2012, Flavius Matis
* Released under the MIT license.
* http://flaviusmatis.github.com/license.html
*/

(function($){

	var methods = {
		init: function(options) {
			var o = $.extend({
				items: 1,
				itemsOnPage: 1,
				pages: 0,
				displayedPages: 5,
				edges: 2,
				currentPage: 0,
				hrefTextPrefix: '#page=',
				hrefTextSuffix: '',
				prevText: 'Prev',
				nextText: 'Next',
				ellipseText: '&hellip;',
				cssStyle: 'light-theme',
				labelMap: [],
				selectOnClick: true,
				nextAtFront: false,
				invertPageOrder: false,
				useStartEdge : true,
				useEndEdge : true,
				onPageClick: function(pageNumber, event) {
					// Callback triggered when a page is clicked
					// Page number is given as an optional parameter
				},
				onInit: function() {
					// Callback triggered immediately after initialization
				}
			}, options || {});

			var self = this;

			o.pages = o.pages ? o.pages : Math.ceil(o.items / o.itemsOnPage) ? Math.ceil(o.items / o.itemsOnPage) : 1;
			if (o.currentPage)
				o.currentPage = o.currentPage - 1;
			else
				o.currentPage = !o.invertPageOrder ? 0 : o.pages - 1;
			o.halfDisplayed = o.displayedPages / 2;

			this.each(function() {
				self.addClass(o.cssStyle + ' simple-pagination').data('pagination', o);
				methods._draw.call(self);
			});

			o.onInit();

			return this;
		},

		selectPage: function(page) {
			methods._selectPage.call(this, page - 1);
			return this;
		},

		prevPage: function() {
			var o = this.data('pagination');
			if (!o.invertPageOrder) {
				if (o.currentPage > 0) {
					methods._selectPage.call(this, o.currentPage - 1);
				}
			} else {
				if (o.currentPage < o.pages - 1) {
					methods._selectPage.call(this, o.currentPage + 1);
				}
			}
			return this;
		},

		nextPage: function() {
			var o = this.data('pagination');
			if (!o.invertPageOrder) {
				if (o.currentPage < o.pages - 1) {
					methods._selectPage.call(this, o.currentPage + 1);
				}
			} else {
				if (o.currentPage > 0) {
					methods._selectPage.call(this, o.currentPage - 1);
				}
			}
			return this;
		},

		getPagesCount: function() {
			return this.data('pagination').pages;
		},

		getCurrentPage: function () {
			return this.data('pagination').currentPage + 1;
		},

		destroy: function(){
			this.empty();
			return this;
		},

		drawPage: function (page) {
			var o = this.data('pagination');
			o.currentPage = page - 1;
			this.data('pagination', o);
			methods._draw.call(this);
			return this;
		},

		redraw: function(){
			methods._draw.call(this);
			return this;
		},

		disable: function(){
			var o = this.data('pagination');
			o.disabled = true;
			this.data('pagination', o);
			methods._draw.call(this);
			return this;
		},

		enable: function(){
			var o = this.data('pagination');
			o.disabled = false;
			this.data('pagination', o);
			methods._draw.call(this);
			return this;
		},

		updateItems: function (newItems) {
			var o = this.data('pagination');
			o.items = newItems;
			o.pages = methods._getPages(o);
			this.data('pagination', o);
			methods._draw.call(this);
		},

		updateItemsOnPage: function (itemsOnPage) {
			var o = this.data('pagination');
			o.itemsOnPage = itemsOnPage;
			o.pages = methods._getPages(o);
			this.data('pagination', o);
			methods._selectPage.call(this, 0);
			return this;
		},

		_draw: function() {
			var	o = this.data('pagination'),
				interval = methods._getInterval(o),
				i,
				tagName;

			methods.destroy.call(this);
			
			tagName = (typeof this.prop === 'function') ? this.prop('tagName') : this.attr('tagName');

			var $panel = tagName === 'UL' ? this : $('<ul class="pagination"></ul>').appendTo(this);

			// Generate Prev link
			if (o.prevText) {
				methods._appendItem.call(this, !o.invertPageOrder ? o.currentPage - 1 : o.currentPage + 1, {text: o.prevText, classes: 'prev'});
			}

			// Generate Next link (if option set for at front)
			if (o.nextText && o.nextAtFront) {
				methods._appendItem.call(this, !o.invertPageOrder ? o.currentPage + 1 : o.currentPage - 1, {text: o.nextText, classes: 'next'});
			}

			// Generate start edges
			if (!o.invertPageOrder) {
				if (interval.start > 0 && o.edges > 0) {
					if(o.useStartEdge) {
						var end = Math.min(o.edges, interval.start);
						for (i = 0; i < end; i++) {
							methods._appendItem.call(this, i);
						}
					}
					if (o.edges < interval.start && (interval.start - o.edges != 1)) {
						$panel.append('<li class="disabled"><span class="ellipse">' + o.ellipseText + '</span></li>');
					} else if (interval.start - o.edges == 1) {
						methods._appendItem.call(this, o.edges);
					}
				}
			} else {
				if (interval.end < o.pages && o.edges > 0) {
					if(o.useStartEdge) {
						var begin = Math.max(o.pages - o.edges, interval.end);
						for (i = o.pages - 1; i >= begin; i--) {
							methods._appendItem.call(this, i);
						}
					}

					if (o.pages - o.edges > interval.end && (o.pages - o.edges - interval.end != 1)) {
						$panel.append('<li class="disabled"><span class="ellipse">' + o.ellipseText + '</span></li>');
					} else if (o.pages - o.edges - interval.end == 1) {
						methods._appendItem.call(this, interval.end);
					}
				}
			}

			// Generate interval links
			if (!o.invertPageOrder) {
				for (i = interval.start; i < interval.end; i++) {
					methods._appendItem.call(this, i);
				}
			} else {
				for (i = interval.end - 1; i >= interval.start; i--) {
					methods._appendItem.call(this, i);
				}
			}

			// Generate end edges
			if (!o.invertPageOrder) {
				if (interval.end < o.pages && o.edges > 0) {
					if (o.pages - o.edges > interval.end && (o.pages - o.edges - interval.end != 1)) {
						$panel.append('<li class="disabled"><span class="ellipse">' + o.ellipseText + '</span></li>');
					} else if (o.pages - o.edges - interval.end == 1) {
						methods._appendItem.call(this, interval.end);
					}
					if(o.useEndEdge) {
						var begin = Math.max(o.pages - o.edges, interval.end);
						for (i = begin; i < o.pages; i++) {
							methods._appendItem.call(this, i);
						}
					}
				}
			} else {
				if (interval.start > 0 && o.edges > 0) {
					if (o.edges < interval.start && (interval.start - o.edges != 1)) {
						$panel.append('<li class="disabled"><span class="ellipse">' + o.ellipseText + '</span></li>');
					} else if (interval.start - o.edges == 1) {
						methods._appendItem.call(this, o.edges);
					}

					if(o.useEndEdge) {
						var end = Math.min(o.edges, interval.start);
						for (i = end - 1; i >= 0; i--) {
							methods._appendItem.call(this, i);
						}
					}
				}
			}

			// Generate Next link (unless option is set for at front)
			if (o.nextText && !o.nextAtFront) {
				methods._appendItem.call(this, !o.invertPageOrder ? o.currentPage + 1 : o.currentPage - 1, {text: o.nextText, classes: 'next'});
			}
		},

		_getPages: function(o) {
			var pages = Math.ceil(o.items / o.itemsOnPage);
			return pages || 1;
		},

		_getInterval: function(o) {
			return {
				start: Math.ceil(o.currentPage > o.halfDisplayed ? Math.max(Math.min(o.currentPage - o.halfDisplayed, (o.pages - o.displayedPages)), 0) : 0),
				end: Math.ceil(o.currentPage > o.halfDisplayed ? Math.min(o.currentPage + o.halfDisplayed, o.pages) : Math.min(o.displayedPages, o.pages))
			};
		},

		_appendItem: function(pageIndex, opts) {
			var self = this, options, $link, o = self.data('pagination'), $linkWrapper = $('<li></li>'), $ul = self.find('ul');

			pageIndex = pageIndex < 0 ? 0 : (pageIndex < o.pages ? pageIndex : o.pages - 1);

			options = {
				text: pageIndex + 1,
				classes: ''
			};

			if (o.labelMap.length && o.labelMap[pageIndex]) {
				options.text = o.labelMap[pageIndex];
			}

			options = $.extend(options, opts || {});

			if (pageIndex == o.currentPage || o.disabled) {
				if (o.disabled) {
					$linkWrapper.addClass('disabled');
				} else {
					$linkWrapper.addClass('active');
				}
				$link = $('<span class="current">' + (options.text) + '</span>');
			} else {
				$link = $('<a href="' + o.hrefTextPrefix + (pageIndex + 1) + o.hrefTextSuffix + '" class="page-link">' + (options.text) + '</a>');
				$link.click(function(event){
					return methods._selectPage.call(self, pageIndex, event);
				});
			}

			if (options.classes) {
				$link.addClass(options.classes);
			}

			$linkWrapper.append($link);

			if ($ul.length) {
				$ul.append($linkWrapper);
			} else {
				self.append($linkWrapper);
			}
		},

		_selectPage: function(pageIndex, event) {
			var o = this.data('pagination');
			o.currentPage = pageIndex;
			if (o.selectOnClick) {
				methods._draw.call(this);
			}
			return o.onPageClick(pageIndex + 1, event);
		}

	};

	$.fn.pagination = function(method) {

		// Method calling logic
		if (methods[method] && method.charAt(0) != '_') {
			return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
		} else if (typeof method === 'object' || !method) {
			return methods.init.apply(this, arguments);
		} else {
			$.error('Method ' +  method + ' does not exist on jQuery.pagination');
		}

	};

})(jQuery);

(function($, specialEventName) {
  'use strict';

  /**
   * Native event names for creating custom one.
   *
   * @type {Object}
   */
  var nativeEvent = Object.create(null);
  /**
   * Get current time.
   *
   * @return {Number}
   */
  var getTime = function() {
    return new Date().getTime();
  };

  nativeEvent.original = 'click';

  if ('ontouchstart' in document) {
    nativeEvent.start = 'touchstart';
    nativeEvent.end = 'touchend';
  } else {
    nativeEvent.start = 'mousedown';
    nativeEvent.end = 'mouseup';
  }

  $.event.special[specialEventName] = {
    setup: function(data, namespaces, eventHandle) {
      var $element = $(this);
      var eventData = {};

      $element
        // Remove all handlers that were set for an original event.
        .off(nativeEvent.original)
        // Prevent default actions.
        .on(nativeEvent.original, false)
        // Split original event by two different and collect an information
        // on every phase.
        .on(nativeEvent.start + ' ' + nativeEvent.end, function(event) {
          // Handle the event system of touchscreen devices.
          eventData.event = event.originalEvent.changedTouches ? event.originalEvent.changedTouches[0] : event;
        })
        .on(nativeEvent.start, function(event) {
          // Stop execution if an event is simulated.
          if (event.which && event.which !== 1) {
            return;
          }

          eventData.target = event.target;
          eventData.pageX = eventData.event.pageX;
          eventData.pageY = eventData.event.pageY;
          eventData.time = getTime();
        })
        .on(nativeEvent.end, function(event) {
          // Compare properties from two phases.
          if (
            // The target should be the same.
            eventData.target === event.target &&
            // Time between first and last phases should be less than 750 ms.
            getTime() - eventData.time < 750 &&
            // Coordinates, when event ends, should be the same as they were
            // on start.
            (
              eventData.pageX === eventData.event.pageX &&
              eventData.pageY === eventData.event.pageY
            )
          ) {
            event.type = specialEventName;
            event.pageX = eventData.event.pageX;
            event.pageY = eventData.event.pageY;

            eventHandle.call(this, event);

            // If an event wasn't prevented then execute original actions.
            if (!event.isDefaultPrevented()) {
              $element
                // Remove prevention of default actions.
                .off(nativeEvent.original)
                // Bring the action.
                .trigger(nativeEvent.original);
            }
          }
        });
    },

    remove: function() {
      $(this).off(nativeEvent.start + ' ' + nativeEvent.end);
    }
  };

  $.fn[specialEventName] = function(fn) {
    return this[fn ? 'on' : 'trigger'](specialEventName, fn);
  };
})(jQuery, 'tap');

/*
 * TotalStorage
 *
 * Copyright (c) 2012 Jared Novack & Upstatement (upstatement.com)
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 * Total Storage is the conceptual the love child of jStorage by Andris Reinman, 
 * and Cookie by Klaus Hartl -- though this is not connected to either project.
 *
 * @name $.totalStorage
 * @cat Plugins/Cookie
 * @author Jared Novack/jared@upstatement.com
 * @version 1.1.2
 * @url http://upstatement.com/blog/2012/01/jquery-local-storage-done-right-and-easy/
 */

(function(c){var e=window.localStorage,f;f="undefined"==typeof e||"undefined"==typeof window.JSON?!1:!0;c.totalStorage=function(b,a){return c.totalStorage.impl.init(b,a)};c.totalStorage.setItem=function(b,a){return c.totalStorage.impl.setItem(b,a)};c.totalStorage.getItem=function(b){return c.totalStorage.impl.getItem(b)};c.totalStorage.getAll=function(){return c.totalStorage.impl.getAll()};c.totalStorage.deleteItem=function(b){return c.totalStorage.impl.deleteItem(b)};c.totalStorage.impl={init:function(b, a){return"undefined"!=typeof a?this.setItem(b,a):this.getItem(b)},setItem:function(b,a){if(!f)try{return c.cookie(b,a),a}catch(d){console.log("Local Storage not supported by this browser. Install the cookie plugin on your site to take advantage of the same functionality. You can get it at https://github.com/carhartl/jquery-cookie")}var g=JSON.stringify(a);e.setItem(b,g);return this.parseResult(g)},getItem:function(b){if(!f)try{return this.parseResult(c.cookie(b))}catch(a){return null}return this.parseResult(e.getItem(b))}, deleteItem:function(b){if(!f)try{return c.cookie(b,null),!0}catch(a){return!1}e.removeItem(b);return!0},getAll:function(){var b=[];if(f)for(d in e)d.length&&b.push({key:d,value:this.parseResult(e.getItem(d))});else try{for(var a=document.cookie.split(";"),d=0;d<a.length;d++){var g=a[d].split("=")[0];b.push({key:g,value:this.parseResult(c.cookie(g))})}}catch(h){return null}return b},parseResult:function(b){var a;try{a=JSON.parse(b),"true"==a&&(a=!0),"false"==a&&(a=!1),parseFloat(a)==a&&"object"!=typeof a&& (a=parseFloat(a))}catch(c){}return a}}})(jQuery);
/*!
 * jQuery Validation Plugin v1.13.1
 *
 * http://jqueryvalidation.org/
 *
 * Copyright (c) 2014 Jrn Zaefferer
 * Released under the MIT license
 */
(function( factory ) {
	if ( typeof define === "function" && define.amd ) {
		define( ["jquery"], factory );
	} else {
		factory( jQuery );
	}
}(function( $ ) {

$.extend($.fn, {
	// http://jqueryvalidation.org/validate/
	validate: function( options ) {

		// if nothing is selected, return nothing; can't chain anyway
		if ( !this.length ) {
			if ( options && options.debug && window.console ) {
				console.warn( "Nothing selected, can't validate, returning nothing." );
			}
			return;
		}

		// check if a validator for this form was already created
		var validator = $.data( this[ 0 ], "validator" );
		if ( validator ) {
			return validator;
		}

		// Add novalidate tag if HTML5.
		this.attr( "novalidate", "novalidate" );

		validator = new $.validator( options, this[ 0 ] );
		$.data( this[ 0 ], "validator", validator );

		if ( validator.settings.onsubmit ) {

			this.validateDelegate( ":submit", "click", function( event ) {
				if ( validator.settings.submitHandler ) {
					validator.submitButton = event.target;
				}
				// allow suppressing validation by adding a cancel class to the submit button
				if ( $( event.target ).hasClass( "cancel" ) ) {
					validator.cancelSubmit = true;
				}

				// allow suppressing validation by adding the html5 formnovalidate attribute to the submit button
				if ( $( event.target ).attr( "formnovalidate" ) !== undefined ) {
					validator.cancelSubmit = true;
				}
			});

			// validate the form on submit
			this.submit( function( event ) {
				if ( validator.settings.debug ) {
					// prevent form submit to be able to see console output
					event.preventDefault();
				}
				function handle() {
					var hidden, result;
					if ( validator.settings.submitHandler ) {
						if ( validator.submitButton ) {
							// insert a hidden input as a replacement for the missing submit button
							hidden = $( "<input type='hidden'/>" )
								.attr( "name", validator.submitButton.name )
								.val( $( validator.submitButton ).val() )
								.appendTo( validator.currentForm );
						}
						result = validator.settings.submitHandler.call( validator, validator.currentForm, event );
						if ( validator.submitButton ) {
							// and clean up afterwards; thanks to no-block-scope, hidden can be referenced
							hidden.remove();
						}
						if ( result !== undefined ) {
							return result;
						}
						return false;
					}
					return true;
				}

				// prevent submit for invalid forms or custom submit handlers
				if ( validator.cancelSubmit ) {
					validator.cancelSubmit = false;
					return handle();
				}
				if ( validator.form() ) {
					if ( validator.pendingRequest ) {
						validator.formSubmitted = true;
						return false;
					}
					return handle();
				} else {
					validator.focusInvalid();
					return false;
				}
			});
		}

		return validator;
	},
	// http://jqueryvalidation.org/valid/
	valid: function() {
		var valid, validator;

		if ( $( this[ 0 ] ).is( "form" ) ) {
			valid = this.validate().form();
		} else {
			valid = true;
			validator = $( this[ 0 ].form ).validate();
			this.each( function() {
				valid = validator.element( this ) && valid;
			});
		}
		return valid;
	},
	// attributes: space separated list of attributes to retrieve and remove
	removeAttrs: function( attributes ) {
		var result = {},
			$element = this;
		$.each( attributes.split( /\s/ ), function( index, value ) {
			result[ value ] = $element.attr( value );
			$element.removeAttr( value );
		});
		return result;
	},
	// http://jqueryvalidation.org/rules/
	rules: function( command, argument ) {
		var element = this[ 0 ],
			settings, staticRules, existingRules, data, param, filtered;

		if ( command ) {
			settings = $.data( element.form, "validator" ).settings;
			staticRules = settings.rules;
			existingRules = $.validator.staticRules( element );
			switch ( command ) {
			case "add":
				$.extend( existingRules, $.validator.normalizeRule( argument ) );
				// remove messages from rules, but allow them to be set separately
				delete existingRules.messages;
				staticRules[ element.name ] = existingRules;
				if ( argument.messages ) {
					settings.messages[ element.name ] = $.extend( settings.messages[ element.name ], argument.messages );
				}
				break;
			case "remove":
				if ( !argument ) {
					delete staticRules[ element.name ];
					return existingRules;
				}
				filtered = {};
				$.each( argument.split( /\s/ ), function( index, method ) {
					filtered[ method ] = existingRules[ method ];
					delete existingRules[ method ];
					if ( method === "required" ) {
						$( element ).removeAttr( "aria-required" );
					}
				});
				return filtered;
			}
		}

		data = $.validator.normalizeRules(
		$.extend(
			{},
			$.validator.classRules( element ),
			$.validator.attributeRules( element ),
			$.validator.dataRules( element ),
			$.validator.staticRules( element )
		), element );

		// make sure required is at front
		if ( data.required ) {
			param = data.required;
			delete data.required;
			data = $.extend( { required: param }, data );
			$( element ).attr( "aria-required", "true" );
		}

		// make sure remote is at back
		if ( data.remote ) {
			param = data.remote;
			delete data.remote;
			data = $.extend( data, { remote: param });
		}

		return data;
	}
});

// Custom selectors
$.extend( $.expr[ ":" ], {
	// http://jqueryvalidation.org/blank-selector/
	blank: function( a ) {
		return !$.trim( "" + $( a ).val() );
	},
	// http://jqueryvalidation.org/filled-selector/
	filled: function( a ) {
		return !!$.trim( "" + $( a ).val() );
	},
	// http://jqueryvalidation.org/unchecked-selector/
	unchecked: function( a ) {
		return !$( a ).prop( "checked" );
	}
});

// constructor for validator
$.validator = function( options, form ) {
	this.settings = $.extend( true, {}, $.validator.defaults, options );
	this.currentForm = form;
	this.init();
};

// http://jqueryvalidation.org/jQuery.validator.format/
$.validator.format = function( source, params ) {
	if ( arguments.length === 1 ) {
		return function() {
			var args = $.makeArray( arguments );
			args.unshift( source );
			return $.validator.format.apply( this, args );
		};
	}
	if ( arguments.length > 2 && params.constructor !== Array  ) {
		params = $.makeArray( arguments ).slice( 1 );
	}
	if ( params.constructor !== Array ) {
		params = [ params ];
	}
	$.each( params, function( i, n ) {
		source = source.replace( new RegExp( "\\{" + i + "\\}", "g" ), function() {
			return n;
		});
	});
	return source;
};

$.extend( $.validator, {

	defaults: {
		messages: {},
		groups: {},
		rules: {},
		errorClass: "error",
		validClass: "valid",
		errorElement: "label",
		focusCleanup: false,
		focusInvalid: true,
		errorContainer: $( [] ),
		errorLabelContainer: $( [] ),
		onsubmit: true,
		ignore: ":hidden",
		ignoreTitle: false,
		onfocusin: function( element ) {
			this.lastActive = element;

			// Hide error label and remove error class on focus if enabled
			if ( this.settings.focusCleanup ) {
				if ( this.settings.unhighlight ) {
					this.settings.unhighlight.call( this, element, this.settings.errorClass, this.settings.validClass );
				}
				this.hideThese( this.errorsFor( element ) );
			}
		},
		onfocusout: function( element ) {
			if ( !this.checkable( element ) && ( element.name in this.submitted || !this.optional( element ) ) ) {
				this.element( element );
			}
		},
		onkeyup: function( element, event ) {
			if ( event.which === 9 && this.elementValue( element ) === "" ) {
				return;
			} else if ( element.name in this.submitted || element === this.lastElement ) {
				this.element( element );
			}
		},
		onclick: function( element ) {
			// click on selects, radiobuttons and checkboxes
			if ( element.name in this.submitted ) {
				this.element( element );

			// or option elements, check parent select in that case
			} else if ( element.parentNode.name in this.submitted ) {
				this.element( element.parentNode );
			}
		},
		highlight: function( element, errorClass, validClass ) {
			if ( element.type === "radio" ) {
				this.findByName( element.name ).addClass( errorClass ).removeClass( validClass );
			} else {
				$( element ).addClass( errorClass ).removeClass( validClass );
			}
		},
		unhighlight: function( element, errorClass, validClass ) {
			if ( element.type === "radio" ) {
				this.findByName( element.name ).removeClass( errorClass ).addClass( validClass );
			} else {
				$( element ).removeClass( errorClass ).addClass( validClass );
			}
		}
	},

	// http://jqueryvalidation.org/jQuery.validator.setDefaults/
	setDefaults: function( settings ) {
		$.extend( $.validator.defaults, settings );
	},

	messages: {
		required: "This field is required.",
		remote: "Please fix this field.",
		email: "Please enter a valid email address.",
		url: "Please enter a valid URL.",
		date: "Please enter a valid date.",
		dateISO: "Please enter a valid date ( ISO ).",
		number: "Please enter a valid number.",
		digits: "Please enter only digits.",
		creditcard: "Please enter a valid credit card number.",
		equalTo: "Please enter the same value again.",
		maxlength: $.validator.format( "Please enter no more than {0} characters." ),
		minlength: $.validator.format( "Please enter at least {0} characters." ),
		rangelength: $.validator.format( "Please enter a value between {0} and {1} characters long." ),
		range: $.validator.format( "Please enter a value between {0} and {1}." ),
		max: $.validator.format( "Please enter a value less than or equal to {0}." ),
		min: $.validator.format( "Please enter a value greater than or equal to {0}." )
	},

	autoCreateRanges: false,

	prototype: {

		init: function() {
			this.labelContainer = $( this.settings.errorLabelContainer );
			this.errorContext = this.labelContainer.length && this.labelContainer || $( this.currentForm );
			this.containers = $( this.settings.errorContainer ).add( this.settings.errorLabelContainer );
			this.submitted = {};
			this.valueCache = {};
			this.pendingRequest = 0;
			this.pending = {};
			this.invalid = {};
			this.reset();

			var groups = ( this.groups = {} ),
				rules;
			$.each( this.settings.groups, function( key, value ) {
				if ( typeof value === "string" ) {
					value = value.split( /\s/ );
				}
				$.each( value, function( index, name ) {
					groups[ name ] = key;
				});
			});
			rules = this.settings.rules;
			$.each( rules, function( key, value ) {
				rules[ key ] = $.validator.normalizeRule( value );
			});

			function delegate( event ) {
				var validator = $.data( this[ 0 ].form, "validator" ),
					eventType = "on" + event.type.replace( /^validate/, "" ),
					settings = validator.settings;
				if ( settings[ eventType ] && !this.is( settings.ignore ) ) {
					settings[ eventType ].call( validator, this[ 0 ], event );
				}
			}
			$( this.currentForm )
				.validateDelegate( ":text, [type='password'], [type='file'], select, textarea, " +
					"[type='number'], [type='search'] ,[type='tel'], [type='url'], " +
					"[type='email'], [type='datetime'], [type='date'], [type='month'], " +
					"[type='week'], [type='time'], [type='datetime-local'], " +
					"[type='range'], [type='color'], [type='radio'], [type='checkbox']",
					"focusin focusout keyup", delegate)
				// Support: Chrome, oldIE
				// "select" is provided as event.target when clicking a option
				.validateDelegate("select, option, [type='radio'], [type='checkbox']", "click", delegate);

			if ( this.settings.invalidHandler ) {
				$( this.currentForm ).bind( "invalid-form.validate", this.settings.invalidHandler );
			}

			// Add aria-required to any Static/Data/Class required fields before first validation
			// Screen readers require this attribute to be present before the initial submission http://www.w3.org/TR/WCAG-TECHS/ARIA2.html
			$( this.currentForm ).find( "[required], [data-rule-required], .required" ).attr( "aria-required", "true" );
		},

		// http://jqueryvalidation.org/Validator.form/
		form: function() {
			this.checkForm();
			$.extend( this.submitted, this.errorMap );
			this.invalid = $.extend({}, this.errorMap );
			if ( !this.valid() ) {
				$( this.currentForm ).triggerHandler( "invalid-form", [ this ]);
			}
			this.showErrors();
			return this.valid();
		},

		checkForm: function() {
			this.prepareForm();
			for ( var i = 0, elements = ( this.currentElements = this.elements() ); elements[ i ]; i++ ) {
				this.check( elements[ i ] );
			}
			return this.valid();
		},

		// http://jqueryvalidation.org/Validator.element/
		element: function( element ) {
			var cleanElement = this.clean( element ),
				checkElement = this.validationTargetFor( cleanElement ),
				result = true;

			this.lastElement = checkElement;

			if ( checkElement === undefined ) {
				delete this.invalid[ cleanElement.name ];
			} else {
				this.prepareElement( checkElement );
				this.currentElements = $( checkElement );

				result = this.check( checkElement ) !== false;
				if ( result ) {
					delete this.invalid[ checkElement.name ];
				} else {
					this.invalid[ checkElement.name ] = true;
				}
			}
			// Add aria-invalid status for screen readers
			$( element ).attr( "aria-invalid", !result );

			if ( !this.numberOfInvalids() ) {
				// Hide error containers on last error
				this.toHide = this.toHide.add( this.containers );
			}
			this.showErrors();
			return result;
		},

		// http://jqueryvalidation.org/Validator.showErrors/
		showErrors: function( errors ) {
			if ( errors ) {
				// add items to error list and map
				$.extend( this.errorMap, errors );
				this.errorList = [];
				for ( var name in errors ) {
					this.errorList.push({
						message: errors[ name ],
						element: this.findByName( name )[ 0 ]
					});
				}
				// remove items from success list
				this.successList = $.grep( this.successList, function( element ) {
					return !( element.name in errors );
				});
			}
			if ( this.settings.showErrors ) {
				this.settings.showErrors.call( this, this.errorMap, this.errorList );
			} else {
				this.defaultShowErrors();
			}
		},

		// http://jqueryvalidation.org/Validator.resetForm/
		resetForm: function() {
			if ( $.fn.resetForm ) {
				$( this.currentForm ).resetForm();
			}
			this.submitted = {};
			this.lastElement = null;
			this.prepareForm();
			this.hideErrors();
			this.elements()
					.removeClass( this.settings.errorClass )
					.removeData( "previousValue" )
					.removeAttr( "aria-invalid" );
		},

		numberOfInvalids: function() {
			return this.objectLength( this.invalid );
		},

		objectLength: function( obj ) {
			/* jshint unused: false */
			var count = 0,
				i;
			for ( i in obj ) {
				count++;
			}
			return count;
		},

		hideErrors: function() {
			this.hideThese( this.toHide );
		},

		hideThese: function( errors ) {
			errors.not( this.containers ).text( "" );
			this.addWrapper( errors ).hide();
		},

		valid: function() {
			return this.size() === 0;
		},

		size: function() {
			return this.errorList.length;
		},

		focusInvalid: function() {
			if ( this.settings.focusInvalid ) {
				try {
					$( this.findLastActive() || this.errorList.length && this.errorList[ 0 ].element || [])
					.filter( ":visible" )
					.focus()
					// manually trigger focusin event; without it, focusin handler isn't called, findLastActive won't have anything to find
					.trigger( "focusin" );
				} catch ( e ) {
					// ignore IE throwing errors when focusing hidden elements
				}
			}
		},

		findLastActive: function() {
			var lastActive = this.lastActive;
			return lastActive && $.grep( this.errorList, function( n ) {
				return n.element.name === lastActive.name;
			}).length === 1 && lastActive;
		},

		elements: function() {
			var validator = this,
				rulesCache = {};

			// select all valid inputs inside the form (no submit or reset buttons)
			return $( this.currentForm )
			.find( "input, select, textarea" )
			.not( ":submit, :reset, :image, [disabled], [readonly]" )
			.not( this.settings.ignore )
			.filter( function() {
				if ( !this.name && validator.settings.debug && window.console ) {
					console.error( "%o has no name assigned", this );
				}

				// select only the first element for each name, and only those with rules specified
				if ( this.name in rulesCache || !validator.objectLength( $( this ).rules() ) ) {
					return false;
				}

				rulesCache[ this.name ] = true;
				return true;
			});
		},

		clean: function( selector ) {
			return $( selector )[ 0 ];
		},

		errors: function() {
			var errorClass = this.settings.errorClass.split( " " ).join( "." );
			return $( this.settings.errorElement + "." + errorClass, this.errorContext );
		},

		reset: function() {
			this.successList = [];
			this.errorList = [];
			this.errorMap = {};
			this.toShow = $( [] );
			this.toHide = $( [] );
			this.currentElements = $( [] );
		},

		prepareForm: function() {
			this.reset();
			this.toHide = this.errors().add( this.containers );
		},

		prepareElement: function( element ) {
			this.reset();
			this.toHide = this.errorsFor( element );
		},

		elementValue: function( element ) {
			var val,
				$element = $( element ),
				type = element.type;

			if ( type === "radio" || type === "checkbox" ) {
				return $( "input[name='" + element.name + "']:checked" ).val();
			} else if ( type === "number" && typeof element.validity !== "undefined" ) {
				return element.validity.badInput ? false : $element.val();
			}

			val = $element.val();
			if ( typeof val === "string" ) {
				return val.replace(/\r/g, "" );
			}
			return val;
		},

		check: function( element ) {
			element = this.validationTargetFor( this.clean( element ) );

			var rules = $( element ).rules(),
				rulesCount = $.map( rules, function( n, i ) {
					return i;
				}).length,
				dependencyMismatch = false,
				val = this.elementValue( element ),
				result, method, rule;

			for ( method in rules ) {
				rule = { method: method, parameters: rules[ method ] };
				try {

					result = $.validator.methods[ method ].call( this, val, element, rule.parameters );

					// if a method indicates that the field is optional and therefore valid,
					// don't mark it as valid when there are no other rules
					if ( result === "dependency-mismatch" && rulesCount === 1 ) {
						dependencyMismatch = true;
						continue;
					}
					dependencyMismatch = false;

					if ( result === "pending" ) {
						this.toHide = this.toHide.not( this.errorsFor( element ) );
						return;
					}

					if ( !result ) {
						this.formatAndAdd( element, rule );
						return false;
					}
				} catch ( e ) {
					if ( this.settings.debug && window.console ) {
						console.log( "Exception occurred when checking element " + element.id + ", check the '" + rule.method + "' method.", e );
					}
					throw e;
				}
			}
			if ( dependencyMismatch ) {
				return;
			}
			if ( this.objectLength( rules ) ) {
				this.successList.push( element );
			}
			return true;
		},

		// return the custom message for the given element and validation method
		// specified in the element's HTML5 data attribute
		// return the generic message if present and no method specific message is present
		customDataMessage: function( element, method ) {
			return $( element ).data( "msg" + method.charAt( 0 ).toUpperCase() +
				method.substring( 1 ).toLowerCase() ) || $( element ).data( "msg" );
		},

		// return the custom message for the given element name and validation method
		customMessage: function( name, method ) {
			var m = this.settings.messages[ name ];
			return m && ( m.constructor === String ? m : m[ method ]);
		},

		// return the first defined argument, allowing empty strings
		findDefined: function() {
			for ( var i = 0; i < arguments.length; i++) {
				if ( arguments[ i ] !== undefined ) {
					return arguments[ i ];
				}
			}
			return undefined;
		},

		defaultMessage: function( element, method ) {
			return this.findDefined(
				this.customMessage( element.name, method ),
				this.customDataMessage( element, method ),
				// title is never undefined, so handle empty string as undefined
				!this.settings.ignoreTitle && element.title || undefined,
				$.validator.messages[ method ],
				"<strong>Warning: No message defined for " + element.name + "</strong>"
			);
		},

		formatAndAdd: function( element, rule ) {
			var message = this.defaultMessage( element, rule.method ),
				theregex = /\$?\{(\d+)\}/g;
			if ( typeof message === "function" ) {
				message = message.call( this, rule.parameters, element );
			} else if ( theregex.test( message ) ) {
				message = $.validator.format( message.replace( theregex, "{$1}" ), rule.parameters );
			}
			this.errorList.push({
				message: message,
				element: element,
				method: rule.method
			});

			this.errorMap[ element.name ] = message;
			this.submitted[ element.name ] = message;
		},

		addWrapper: function( toToggle ) {
			if ( this.settings.wrapper ) {
				toToggle = toToggle.add( toToggle.parent( this.settings.wrapper ) );
			}
			return toToggle;
		},

		defaultShowErrors: function() {
			var i, elements, error;
			for ( i = 0; this.errorList[ i ]; i++ ) {
				error = this.errorList[ i ];
				if ( this.settings.highlight ) {
					this.settings.highlight.call( this, error.element, this.settings.errorClass, this.settings.validClass );
				}
				this.showLabel( error.element, error.message );
			}
			if ( this.errorList.length ) {
				this.toShow = this.toShow.add( this.containers );
			}
			if ( this.settings.success ) {
				for ( i = 0; this.successList[ i ]; i++ ) {
					this.showLabel( this.successList[ i ] );
				}
			}
			if ( this.settings.unhighlight ) {
				for ( i = 0, elements = this.validElements(); elements[ i ]; i++ ) {
					this.settings.unhighlight.call( this, elements[ i ], this.settings.errorClass, this.settings.validClass );
				}
			}
			this.toHide = this.toHide.not( this.toShow );
			this.hideErrors();
			this.addWrapper( this.toShow ).show();
		},

		validElements: function() {
			return this.currentElements.not( this.invalidElements() );
		},

		invalidElements: function() {
			return $( this.errorList ).map(function() {
				return this.element;
			});
		},

		showLabel: function( element, message ) {
			var place, group, errorID,
				error = this.errorsFor( element ),
				elementID = this.idOrName( element ),
				describedBy = $( element ).attr( "aria-describedby" );
			if ( error.length ) {
				// refresh error/success class
				error.removeClass( this.settings.validClass ).addClass( this.settings.errorClass );
				// replace message on existing label
				error.html( message );
			} else {
				// create error element
				error = $( "<" + this.settings.errorElement + ">" )
					.attr( "id", elementID + "-error" )
					.addClass( this.settings.errorClass )
					.html( message || "" );

				// Maintain reference to the element to be placed into the DOM
				place = error;
				if ( this.settings.wrapper ) {
					// make sure the element is visible, even in IE
					// actually showing the wrapped element is handled elsewhere
					place = error.hide().show().wrap( "<" + this.settings.wrapper + "/>" ).parent();
				}
				if ( this.labelContainer.length ) {
					this.labelContainer.append( place );
				} else if ( this.settings.errorPlacement ) {
					this.settings.errorPlacement( place, $( element ) );
				} else {
					place.insertAfter( element );
				}

				// Link error back to the element
				if ( error.is( "label" ) ) {
					// If the error is a label, then associate using 'for'
					error.attr( "for", elementID );
				} else if ( error.parents( "label[for='" + elementID + "']" ).length === 0 ) {
					// If the element is not a child of an associated label, then it's necessary
					// to explicitly apply aria-describedby

					errorID = error.attr( "id" ).replace( /(:|\.|\[|\])/g, "\\$1");
					// Respect existing non-error aria-describedby
					if ( !describedBy ) {
						describedBy = errorID;
					} else if ( !describedBy.match( new RegExp( "\\b" + errorID + "\\b" ) ) ) {
						// Add to end of list if not already present
						describedBy += " " + errorID;
					}
					$( element ).attr( "aria-describedby", describedBy );

					// If this element is grouped, then assign to all elements in the same group
					group = this.groups[ element.name ];
					if ( group ) {
						$.each( this.groups, function( name, testgroup ) {
							if ( testgroup === group ) {
								$( "[name='" + name + "']", this.currentForm )
									.attr( "aria-describedby", error.attr( "id" ) );
							}
						});
					}
				}
			}
			if ( !message && this.settings.success ) {
				error.text( "" );
				if ( typeof this.settings.success === "string" ) {
					error.addClass( this.settings.success );
				} else {
					this.settings.success( error, element );
				}
			}
			this.toShow = this.toShow.add( error );
		},

		errorsFor: function( element ) {
			var name = this.idOrName( element ),
				describer = $( element ).attr( "aria-describedby" ),
				selector = "label[for='" + name + "'], label[for='" + name + "'] *";

			// aria-describedby should directly reference the error element
			if ( describer ) {
				selector = selector + ", #" + describer.replace( /\s+/g, ", #" );
			}
			return this
				.errors()
				.filter( selector );
		},

		idOrName: function( element ) {
			return this.groups[ element.name ] || ( this.checkable( element ) ? element.name : element.id || element.name );
		},

		validationTargetFor: function( element ) {

			// If radio/checkbox, validate first element in group instead
			if ( this.checkable( element ) ) {
				element = this.findByName( element.name );
			}

			// Always apply ignore filter
			return $( element ).not( this.settings.ignore )[ 0 ];
		},

		checkable: function( element ) {
			return ( /radio|checkbox/i ).test( element.type );
		},

		findByName: function( name ) {
			return $( this.currentForm ).find( "[name='" + name + "']" );
		},

		getLength: function( value, element ) {
			switch ( element.nodeName.toLowerCase() ) {
			case "select":
				return $( "option:selected", element ).length;
			case "input":
				if ( this.checkable( element ) ) {
					return this.findByName( element.name ).filter( ":checked" ).length;
				}
			}
			return value.length;
		},

		depend: function( param, element ) {
			return this.dependTypes[typeof param] ? this.dependTypes[typeof param]( param, element ) : true;
		},

		dependTypes: {
			"boolean": function( param ) {
				return param;
			},
			"string": function( param, element ) {
				return !!$( param, element.form ).length;
			},
			"function": function( param, element ) {
				return param( element );
			}
		},

		optional: function( element ) {
			var val = this.elementValue( element );
			return !$.validator.methods.required.call( this, val, element ) && "dependency-mismatch";
		},

		startRequest: function( element ) {
			if ( !this.pending[ element.name ] ) {
				this.pendingRequest++;
				this.pending[ element.name ] = true;
			}
		},

		stopRequest: function( element, valid ) {
			this.pendingRequest--;
			// sometimes synchronization fails, make sure pendingRequest is never < 0
			if ( this.pendingRequest < 0 ) {
				this.pendingRequest = 0;
			}
			delete this.pending[ element.name ];
			if ( valid && this.pendingRequest === 0 && this.formSubmitted && this.form() ) {
				$( this.currentForm ).submit();
				this.formSubmitted = false;
			} else if (!valid && this.pendingRequest === 0 && this.formSubmitted ) {
				$( this.currentForm ).triggerHandler( "invalid-form", [ this ]);
				this.formSubmitted = false;
			}
		},

		previousValue: function( element ) {
			return $.data( element, "previousValue" ) || $.data( element, "previousValue", {
				old: null,
				valid: true,
				message: this.defaultMessage( element, "remote" )
			});
		}

	},

	classRuleSettings: {
		required: { required: true },
		email: { email: true },
		url: { url: true },
		date: { date: true },
		dateISO: { dateISO: true },
		number: { number: true },
		digits: { digits: true },
		creditcard: { creditcard: true }
	},

	addClassRules: function( className, rules ) {
		if ( className.constructor === String ) {
			this.classRuleSettings[ className ] = rules;
		} else {
			$.extend( this.classRuleSettings, className );
		}
	},

	classRules: function( element ) {
		var rules = {},
			classes = $( element ).attr( "class" );

		if ( classes ) {
			$.each( classes.split( " " ), function() {
				if ( this in $.validator.classRuleSettings ) {
					$.extend( rules, $.validator.classRuleSettings[ this ]);
				}
			});
		}
		return rules;
	},

	attributeRules: function( element ) {
		var rules = {},
			$element = $( element ),
			type = element.getAttribute( "type" ),
			method, value;

		for ( method in $.validator.methods ) {

			// support for <input required> in both html5 and older browsers
			if ( method === "required" ) {
				value = element.getAttribute( method );
				// Some browsers return an empty string for the required attribute
				// and non-HTML5 browsers might have required="" markup
				if ( value === "" ) {
					value = true;
				}
				// force non-HTML5 browsers to return bool
				value = !!value;
			} else {
				value = $element.attr( method );
			}

			// convert the value to a number for number inputs, and for text for backwards compability
			// allows type="date" and others to be compared as strings
			if ( /min|max/.test( method ) && ( type === null || /number|range|text/.test( type ) ) ) {
				value = Number( value );
			}

			if ( value || value === 0 ) {
				rules[ method ] = value;
			} else if ( type === method && type !== "range" ) {
				// exception: the jquery validate 'range' method
				// does not test for the html5 'range' type
				rules[ method ] = true;
			}
		}

		// maxlength may be returned as -1, 2147483647 ( IE ) and 524288 ( safari ) for text inputs
		if ( rules.maxlength && /-1|2147483647|524288/.test( rules.maxlength ) ) {
			delete rules.maxlength;
		}

		return rules;
	},

	dataRules: function( element ) {
		var method, value,
			rules = {}, $element = $( element );
		for ( method in $.validator.methods ) {
			value = $element.data( "rule" + method.charAt( 0 ).toUpperCase() + method.substring( 1 ).toLowerCase() );
			if ( value !== undefined ) {
				rules[ method ] = value;
			}
		}
		return rules;
	},

	staticRules: function( element ) {
		var rules = {},
			validator = $.data( element.form, "validator" );

		if ( validator.settings.rules ) {
			rules = $.validator.normalizeRule( validator.settings.rules[ element.name ] ) || {};
		}
		return rules;
	},

	normalizeRules: function( rules, element ) {
		// handle dependency check
		$.each( rules, function( prop, val ) {
			// ignore rule when param is explicitly false, eg. required:false
			if ( val === false ) {
				delete rules[ prop ];
				return;
			}
			if ( val.param || val.depends ) {
				var keepRule = true;
				switch ( typeof val.depends ) {
				case "string":
					keepRule = !!$( val.depends, element.form ).length;
					break;
				case "function":
					keepRule = val.depends.call( element, element );
					break;
				}
				if ( keepRule ) {
					rules[ prop ] = val.param !== undefined ? val.param : true;
				} else {
					delete rules[ prop ];
				}
			}
		});

		// evaluate parameters
		$.each( rules, function( rule, parameter ) {
			rules[ rule ] = $.isFunction( parameter ) ? parameter( element ) : parameter;
		});

		// clean number parameters
		$.each([ "minlength", "maxlength" ], function() {
			if ( rules[ this ] ) {
				rules[ this ] = Number( rules[ this ] );
			}
		});
		$.each([ "rangelength", "range" ], function() {
			var parts;
			if ( rules[ this ] ) {
				if ( $.isArray( rules[ this ] ) ) {
					rules[ this ] = [ Number( rules[ this ][ 0 ]), Number( rules[ this ][ 1 ] ) ];
				} else if ( typeof rules[ this ] === "string" ) {
					parts = rules[ this ].replace(/[\[\]]/g, "" ).split( /[\s,]+/ );
					rules[ this ] = [ Number( parts[ 0 ]), Number( parts[ 1 ] ) ];
				}
			}
		});

		if ( $.validator.autoCreateRanges ) {
			// auto-create ranges
			if ( rules.min != null && rules.max != null ) {
				rules.range = [ rules.min, rules.max ];
				delete rules.min;
				delete rules.max;
			}
			if ( rules.minlength != null && rules.maxlength != null ) {
				rules.rangelength = [ rules.minlength, rules.maxlength ];
				delete rules.minlength;
				delete rules.maxlength;
			}
		}

		return rules;
	},

	// Converts a simple string to a {string: true} rule, e.g., "required" to {required:true}
	normalizeRule: function( data ) {
		if ( typeof data === "string" ) {
			var transformed = {};
			$.each( data.split( /\s/ ), function() {
				transformed[ this ] = true;
			});
			data = transformed;
		}
		return data;
	},

	// http://jqueryvalidation.org/jQuery.validator.addMethod/
	addMethod: function( name, method, message ) {
		$.validator.methods[ name ] = method;
		$.validator.messages[ name ] = message !== undefined ? message : $.validator.messages[ name ];
		if ( method.length < 3 ) {
			$.validator.addClassRules( name, $.validator.normalizeRule( name ) );
		}
	},

	methods: {

		// http://jqueryvalidation.org/required-method/
		required: function( value, element, param ) {
			// check if dependency is met
			if ( !this.depend( param, element ) ) {
				return "dependency-mismatch";
			}
			if ( element.nodeName.toLowerCase() === "select" ) {
				// could be an array for select-multiple or a string, both are fine this way
				var val = $( element ).val();
				return val && val.length > 0;
			}
			if ( this.checkable( element ) ) {
				return this.getLength( value, element ) > 0;
			}
			return $.trim( value ).length > 0;
		},

		// http://jqueryvalidation.org/email-method/
		email: function( value, element ) {
			// From http://www.whatwg.org/specs/web-apps/current-work/multipage/states-of-the-type-attribute.html#e-mail-state-%28type=email%29
			// Retrieved 2014-01-14
			// If you have a problem with this implementation, report a bug against the above spec
			// Or use custom methods to implement your own email validation
			return this.optional( element ) || /^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test( value );
		},

		// http://jqueryvalidation.org/url-method/
		url: function( value, element ) {
			// contributed by Scott Gonzalez: http://projects.scottsplayground.com/iri/
			return this.optional( element ) || /^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test( value );
		},

		// http://jqueryvalidation.org/date-method/
		date: function( value, element ) {
			return this.optional( element ) || !/Invalid|NaN/.test( new Date( value ).toString() );
		},

		// http://jqueryvalidation.org/dateISO-method/
		dateISO: function( value, element ) {
			return this.optional( element ) || /^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/.test( value );
		},

		// http://jqueryvalidation.org/number-method/
		number: function( value, element ) {
			return this.optional( element ) || /^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test( value );
		},

		// http://jqueryvalidation.org/digits-method/
		digits: function( value, element ) {
			return this.optional( element ) || /^\d+$/.test( value );
		},

		// http://jqueryvalidation.org/creditcard-method/
		// based on http://en.wikipedia.org/wiki/Luhn/
		creditcard: function( value, element ) {
			if ( this.optional( element ) ) {
				return "dependency-mismatch";
			}
			// accept only spaces, digits and dashes
			if ( /[^0-9 \-]+/.test( value ) ) {
				return false;
			}
			var nCheck = 0,
				nDigit = 0,
				bEven = false,
				n, cDigit;

			value = value.replace( /\D/g, "" );

			// Basing min and max length on
			// http://developer.ean.com/general_info/Valid_Credit_Card_Types
			if ( value.length < 13 || value.length > 19 ) {
				return false;
			}

			for ( n = value.length - 1; n >= 0; n--) {
				cDigit = value.charAt( n );
				nDigit = parseInt( cDigit, 10 );
				if ( bEven ) {
					if ( ( nDigit *= 2 ) > 9 ) {
						nDigit -= 9;
					}
				}
				nCheck += nDigit;
				bEven = !bEven;
			}

			return ( nCheck % 10 ) === 0;
		},

		// http://jqueryvalidation.org/minlength-method/
		minlength: function( value, element, param ) {
			var length = $.isArray( value ) ? value.length : this.getLength( value, element );
			return this.optional( element ) || length >= param;
		},

		// http://jqueryvalidation.org/maxlength-method/
		maxlength: function( value, element, param ) {
			var length = $.isArray( value ) ? value.length : this.getLength( value, element );
			return this.optional( element ) || length <= param;
		},

		// http://jqueryvalidation.org/rangelength-method/
		rangelength: function( value, element, param ) {
			var length = $.isArray( value ) ? value.length : this.getLength( value, element );
			return this.optional( element ) || ( length >= param[ 0 ] && length <= param[ 1 ] );
		},

		// http://jqueryvalidation.org/min-method/
		min: function( value, element, param ) {
			return this.optional( element ) || value >= param;
		},

		// http://jqueryvalidation.org/max-method/
		max: function( value, element, param ) {
			return this.optional( element ) || value <= param;
		},

		// http://jqueryvalidation.org/range-method/
		range: function( value, element, param ) {
			return this.optional( element ) || ( value >= param[ 0 ] && value <= param[ 1 ] );
		},

		// http://jqueryvalidation.org/equalTo-method/
		equalTo: function( value, element, param ) {
			// bind to the blur event of the target in order to revalidate whenever the target field is updated
			// TODO find a way to bind the event just once, avoiding the unbind-rebind overhead
			var target = $( param );
			if ( this.settings.onfocusout ) {
				target.unbind( ".validate-equalTo" ).bind( "blur.validate-equalTo", function() {
					$( element ).valid();
				});
			}
			return value === target.val();
		},

		// http://jqueryvalidation.org/remote-method/
		remote: function( value, element, param ) {
			if ( this.optional( element ) ) {
				return "dependency-mismatch";
			}

			var previous = this.previousValue( element ),
				validator, data;

			if (!this.settings.messages[ element.name ] ) {
				this.settings.messages[ element.name ] = {};
			}
			previous.originalMessage = this.settings.messages[ element.name ].remote;
			this.settings.messages[ element.name ].remote = previous.message;

			param = typeof param === "string" && { url: param } || param;

			if ( previous.old === value ) {
				return previous.valid;
			}

			previous.old = value;
			validator = this;
			this.startRequest( element );
			data = {};
			data[ element.name ] = value;
			$.ajax( $.extend( true, {
				url: param,
				mode: "abort",
				port: "validate" + element.name,
				dataType: "json",
				data: data,
				context: validator.currentForm,
				success: function( response ) {
					var valid = response === true || response === "true",
						errors, message, submitted;

					validator.settings.messages[ element.name ].remote = previous.originalMessage;
					if ( valid ) {
						submitted = validator.formSubmitted;
						validator.prepareElement( element );
						validator.formSubmitted = submitted;
						validator.successList.push( element );
						delete validator.invalid[ element.name ];
						validator.showErrors();
					} else {
						errors = {};
						message = response || validator.defaultMessage( element, "remote" );
						errors[ element.name ] = previous.message = $.isFunction( message ) ? message( value ) : message;
						validator.invalid[ element.name ] = true;
						validator.showErrors( errors );
					}
					previous.valid = valid;
					validator.stopRequest( element, valid );
				}
			}, param ) );
			return "pending";
		}

	}

});

$.format = function deprecated() {
	throw "$.format has been deprecated. Please use $.validator.format instead.";
};

// ajax mode: abort
// usage: $.ajax({ mode: "abort"[, port: "uniqueport"]});
// if mode:"abort" is used, the previous request on that port (port can be undefined) is aborted via XMLHttpRequest.abort()

var pendingRequests = {},
	ajax;
// Use a prefilter if available (1.5+)
if ( $.ajaxPrefilter ) {
	$.ajaxPrefilter(function( settings, _, xhr ) {
		var port = settings.port;
		if ( settings.mode === "abort" ) {
			if ( pendingRequests[port] ) {
				pendingRequests[port].abort();
			}
			pendingRequests[port] = xhr;
		}
	});
} else {
	// Proxy ajax
	ajax = $.ajax;
	$.ajax = function( settings ) {
		var mode = ( "mode" in settings ? settings : $.ajaxSettings ).mode,
			port = ( "port" in settings ? settings : $.ajaxSettings ).port;
		if ( mode === "abort" ) {
			if ( pendingRequests[port] ) {
				pendingRequests[port].abort();
			}
			pendingRequests[port] = ajax.apply(this, arguments);
			return pendingRequests[port];
		}
		return ajax.apply(this, arguments);
	};
}

// provides delegate(type: String, delegate: Selector, handler: Callback) plugin for easier event delegation
// handler is only called when $(event.target).is(delegate), in the scope of the jquery-object for event.target

$.extend($.fn, {
	validateDelegate: function( delegate, type, handler ) {
		return this.bind(type, function( event ) {
			var target = $(event.target);
			if ( target.is(delegate) ) {
				return handler.apply(target, arguments);
			}
		});
	}
});

}));
/*
// - .
var LC_API = LC_API || {};


function _LC_OPEN() {
    LC_API.open_chat_window();
}

// LC_API.on_after_load = function()
LC_API.on_before_load = function()
{

    var custom_variables = [
       { name: 'visit', value: '1' }
    ];
    LC_API.set_custom_variables(custom_variables);

//    console.log('LC_API:BEFORE');
//    if(!LC_API.chat_window_maximized()) {
//        setTimeout( _LC_OPEN, 1000*60*10); // 1000 - 1c.
//    }

//	if(LC_API.chat_window_maximized()) {
//            // LC_API.hide_chat_window();
//            LC_API.minimize_chat_window();
//        }
};

LC_API.on_after_load = function() {
//    console.log('LC_API:AFTER');

    if(LC_API.chat_window_maximized()) {
//            // LC_API.hide_chat_window();
        LC_API.minimize_chat_window();
    }

     setTimeout( _LC_OPEN, 1000*60*10); // 1000 - 1c.
}
*/

$(function() {
        $('.select_inverse, .select').selectpicker();

	$('.dbody > .row > div:first-child').on('click', function(ev) {
		var $this = $(this);
		if ($(ev.target).closest('.popover').length) return;
		if ($this.hasClass('active')) {
			$this.removeClass('active');
		} else {
			$('.dbody > .row > div').removeClass('active');
			$this.addClass('active');
		}
	});

	$(window).scroll(function() {
		if ($(this).scrollTop() > 100) {
			$('.go_up').fadeIn();
		} else {
			$('.go_up').fadeOut();
		}
	});
	// scroll body to 0px on click
	$('.go_up').on("click", function() {
		$('body,html').animate({
			scrollTop: 0
		}, 800);
		return false;
	});


    $('.learn-about-link').click(function(event) {
        event.preventDefault();
        var href=$(this).attr('href');
        var target=$(href);
        var top=target.offset().top;
        $('html,body').animate({
            scrollTop: top
        }, 800);
    });

        // scroll body on click
        if($('.go_block_scroll').length) {
           $('.go_block_scroll').on('click', function() {
                var id = ($(this).attr('data-go-block')) ? '#'.$(this).attr('data-go-block') : ($(this).attr('href')) ? $(this).attr('href') : false;
                if(id && $( id ).length) {
                    $('html, body').animate( {
                        scrollTop: Math.ceil( $( id ).offset().top ) // Math.ceil((target_top * $(window).outerHeight(true)) / $('html, body').height())
                    },'linear');
                    return false;
                }
           });
        }

        // ga form
        //  1
//        ga(function(tracker) {
//          var linkerParam = tracker.get('linkerParam');
//          console.log( linkerParam );
//        });

       if($('form[name="price_premium_bottom"], form[name="price_basic_bottom"], form[name="price_premium"], form[name="price_basic"]').length) {
        $('form[name="price_premium_bottom"], form[name="price_basic_bottom"], form[name="price_premium"], form[name="price_basic"]').submit(function(){
            ga('linker:decorate', this);
        });
       }
});

$(document).ready(function(){ 

    // create cookie
    if(typeof $.cookie('popUp_email') == "undefined") {
        $.cookie('popUp_email', 0, {  
            expires: 1 //     
        });
    }
    
    /*
    $('html').mouseleave(function(){
        // console.log( 'Out windows! ', $.cookie('popUp_email'), typeof($.cookie('popUp_email')) );
        if(typeof $.cookie('popUp_email') !== "undefined" 
                && !parseInt( $.cookie('popUp_email') )) {
            
            var $_popUp = $('.box-popUp'),
                $box_email = $_popUp.find('#box-email');

            if(!$box_email.length) { 
                $box_email = $_popUp
                        .append( _htmlPopUp.box_email )
                        .find('#box-email'); 
            } 
            
            $box_email.bPopup({
                    modalClose: true,
                    appending: false,
                    opacity: 0.6,
                    follow: [false, false], 
                    positionStyle: 'fixed', //'fixed' or 'absolute'
                    onOpen: function() {
                        popUpValidate();
                    },
                    closeClass: 'close',
                    onClose: function() {
                    },

            });
            
            $.cookie('popUp_email', 1); // popUp inout put one.
        }
        
    });
    */
    
    // form popUp
    $('.block-popUp-close').on('click', function() {
        var _popUp = $(this).parents('.popUp'), $this = $(this);
        _popUp.bPopup().close();
    });

});

function popUpValidate() {
    
    $('form.block-popup-form').validate({
        onfocusout: false,
        onkeyup: false,
        onclick: true,
        onsubmit: true,
        focusInvalid: false,
        focusCleanup: false,
        email: {
            required: true,
            email: true
        },
        messages: {
            email: {
                required: "The Email field is empty",
                email: "Please enter correct email"
            }
        },
       
        errorClass: "error",
        validClass: "success",
        invalidHandler: function(event, validator) {
            if($('form.block-popup-form div.error').length)
                $('form.block-popup-form div.error').html( " " ).hide();
        },
        //  
        showErrors: function(errorMap, errorList) {
            var msg = null;
            $.each(errorList, function(){
                 msg = this.message + '<br />'; });
             
            if(msg !== null) 
                $("form.block-popup-form div.error").html(msg).show();
        },

        submitHandler: function( form ) { // submitHandler
            var $form = $(form), _params = parseQuery($form.serializeArray());
            
            if($('form.block-popup-form div.error').length)
                $('form.block-popup-form div.error').html( " " ).hide();
            
            // disabled button
            $form.find('button').prop( "disabled", true );
            
            
            var jqXHR = _getAJAX( 
                'http://pumpic.com/popup_email_send.html', 
                _params, {
                    'dataType': 'jsonp',
                    'crossDomain': true,
                } 
            );
    
            if(typeof jqXHR == 'object') {
                jqXHR
                .done(function(data, textStatus, jqXHR) {
                    if(textStatus == 'success') {
                        console.log( data );
                
                        if(data.error) { 
                    
                            if(typeof data.error === 'object') {
                                $.each(data.error, function(name, text) {
                                    var _obj = $form.find('input[name="'+name+'"]');
                                    if(_obj.length) {
                                        if(_obj.next('label').length)
                                            _obj.next().html( text ).show();
                                        else
                                            $('form.block-popup-form div.error').html( text ).show();
                                            //$('<label id="'+name+'-error" for="'+name+'" class="error">'+text+'</label>').insertAfter(_obj); 
                                    }
                                  });
                            } else {
                                $('form.block-popup-form div.error').html( data.error ).show();
                            }

                            // disabled button
                            $form.find('button').prop( "disabled", false );
                            return false;
                        } else if(data.success) {
                            // google analitycs
                            // ga('send', 'event', 'form', 'submit', 'compatibility-request-success');
                            var $_popUp = $('.box-popUp'),
                                $email_success = $_popUp.find('#box-email-success');
                                
                            if(!$email_success.length) { 
                                $email_success = $_popUp
                                        .append( _htmlPopUp.email_success )
                                        .find('#box-email-success'); 
                            }
                            
                            // close popUp
                            if($('.box-popUp > .popUp').is(':visible')) {
                                $('.box-popUp > .popUp').bPopup({
                                    transition: 'fadeOut'
                                }).close();
                            }

                            $email_success.bPopup({
                                    modalClose: true,
                                    appending: false,
                                    opacity: 0.6,
                                    follow: [false, false], 
                                    positionStyle: 'fixed', //'fixed' or 'absolute'
                                    onOpen: function() {
                                    },
                                    closeClass: 'close',
                                    onClose: function() {
                                    },
                            });
                        }
                        
                    } else {
                        $('form.block-popup-form div.error').html('Your email was not sent').show();
                        console.log('System error '+ textStatus +'!');
                        // disabled button
                        $form.find('button').prop( "disabled", false );
                         return false;
                        }
                })
                .fail  (function(jqXHR, textStatus, errorThrown) { 
                    $('form.block-popup-form div.error').html('Your email was not sent').show();
                     console.log('System error (JSOP:REQUEST)!');
                    // disabled button
                    $form.find('button').prop( "disabled", false );
                    return false;
                });
            } else {
                $('form.block-popup-form div.error').html('Your email was not sent').show();
                 console.log('System error (CREATE:OBJECT)!');
                // disabled button
                $form.find('button').prop( "disabled", false );
                return false;
            }
            
            /* json
            var _res = getAjaxForm('http://pumpic.com/popup_email_send.html', _params, {
                'dataType': 'json',
                'crossDomain': true,
            });
            if(typeof _res === 'object') {
                if(_res.error) { 
                    
                    if(typeof _res.error === 'object') {
                        $.each(_res.error, function(name, text) {
                            var _obj = $form.find('input[name="'+name+'"]');
                            if(_obj.length) {
                                if(_obj.next('label').length)
                                    _obj.next().html( text ).show();
                                else
                                    $('form.block-popup-form div.error').html( text ).show();
                                    //$('<label id="'+name+'-error" for="'+name+'" class="error">'+text+'</label>').insertAfter(_obj); 
                            }
                          });
                    } else {
                        $('form.block-popup-form div.error').html( _res.error ).show();
                    }
                    
                    // disabled button
                    $form.find('button').prop( "disabled", false );
                    return false;
                } else if(_res.success) {
                    // google analitycs
                    // ga('send', 'event', 'form', 'submit', 'compatibility-request-success');

                    

                    // close popUp
                    if($('.box-popUp > .popUp').is(':visible')) {
                        $('.box-popUp > #box-email').bPopup({
                            transition: 'fadeOut'
                        }).close();
                    }        

                    $('.box-popUp > #box-email-success').bPopup({
                            modalClose: true,
                            appending: false,
                            opacity: 0.6,
                            follow: [false, false], 
                            positionStyle: 'fixed', //'fixed' or 'absolute'
                            onOpen: function() {
                            },
                            closeClass: 'close',
                            onClose: function() {
                            },
                    });
                } else {
                    $('form.block-popup-form div.error').html('Your email was not sent').show();
                    console.log('System error!');
                    
                    // disabled button
                    $form.find('button').prop( "disabled", false );
                     return false;
                }
            } else {
                $('form.block-popup-form div.error').html('Your email was not sent').show();
                
                // disabled button
                $form.find('button').prop( "disabled", false );
                return false;
            }
            */
            $form.trigger("reset"); 
        }
    });
    
}
// detected image onload
;(function ($) {
    $.fn.bindImageLoad = function (callback) {
        function isImageLoaded(img) {
            //    load IE    
            //      complete.
            //   Gecko-based .
            if (!img.complete) {
                return false;
            }
            //   ,       : naturalWidth  naturalHeight.
            //     .     ,
            //      .
            if (typeof img.naturalWidth !== "undefined" && img.naturalWidth === 0) {
                return false;
            }
            //  .
            return true;
        }

        return this.each(function () {
            var ele = $(this);
            if (ele.is("img") && $.isFunction(callback)) {
                ele.one("load", callback);
                if (isImageLoaded(this)) {
                    ele.trigger("load");
                }
            }
        });
    };
})(jQuery);

$(document).ready(function(){ 
    /* capcha resize */
  if($('form .box-captcha > img').length) { 
      $('form .box-captcha > img').bindImageLoad(function() { 
            var _bcaptcha = $(this).parents('.box-captcha'), _bcw = _bcaptcha.width(),
            _width = $(this).width(), width = $(this).outerWidth(true),
            _update = _bcaptcha.find('.update-captcha');
            $(this).css({'width': (_bcw - 54)+'px'});
            _update.attr('attr-width', _bcw - 54);
      });
  }  
    
    /* images mobile */
  if($('#box-content-post img, #block-content img').length) {
      
      
      //$('#box-content-post img').each(function() {
      $('#box-content-post img, #block-content img').bindImageLoad(function() {    
          
          var width = $(this).attr('width'),
              parent = $(this).closest('.wp-caption'), 
              _caption_text = parent.find('.wp-caption-text'),
                _src = $(this).attr('src'),
                height = $(this).attr('height'),
                outer_width = $(this).outerWidth(true),
                parent_outer_width = parent.outerWidth(true);
          
          $(this).attr('attr-width', width).removeAttr('width');
          $(this).attr('attr-height', height).removeAttr('height');
          //$(this).attr('src', '');
          
          // console.log(width, height);
          
          $(this).css({
              //'background': 'url( "'+_src+'" ) no-repeat',
              'background-size': 'contain',
              //'max-width': width+'px', 
              'height' : 'auto',
              'width': 'auto',
              'max-height': height+'px',
          });
          
          if(parent.length)
              parent.css({
                  'clear': 'both',
                  'width': 'auto',
              });
          
          //console.log(' ---- Start width -------- ');
          //console.log(parent_outer_width, outer_width);
          //console.log( '-------- end ---------' );
          
          if(_caption_text.length) {
              if(parent_outer_width > 0) {
                _caption_text.css({
                  'width': '100%',  
                  'max-width': parent_outer_width+'px',
                });
              } else if(outer_width > 0) {
                 _caption_text.css({
                     'width': '100%',
                    'max-width': outer_width+'px',
                }); 
              }
          }
        
          
      });
      
      
  }
});

// .wp-caption
$( window ).resize(function() {
    var $_wW = $(window).width();
    
    // form.send_find_phone .box-captcha img
    if($('form .box-captcha > img').length) {
        $('form .box-captcha > img').each(function() {
            var _bcaptcha = $(this).parents('.box-captcha'), _bcw = _bcaptcha.width(),
            _width = $(this).width(), width = $(this).outerWidth(true),
            _update = _bcaptcha.find('.update-captcha');
            $(this).css({'width': (_bcw - 54)+'px'});
            _update.attr('attr-width', _bcw - 54);
            
        });
    }
    
    
    // box-content-post
    if($('#box-content-post img, #block-content img').length) {
      $('#box-content-post img, #block-content img').each(function() {
          var _caption = $(this).parents('.wp-caption'), 
                width = $(this).outerWidth(true),
                _attachmentW = $(this).closest('#attachment').outerWidth(true),
                _width = $(this).width(),
                _attrW = $(this).attr('attr-width');

          if(_caption.find('.wp-caption-text').length)
            _caption.find('.wp-caption-text').css({
                'width': width+'px',
            });
            
      });
    }  
});
$(document).ready(function(){ 
//    var $bth = $("#block-technological-header .box-hedaer-body"),
//        _biW = $bth.find('.block-images').width(true),
//        _biH = $bth.find('.block-images').height(true);
//        
//    if($("#box-img-lines").is(':visible'))    
//        $("#box-img-lines img").css({'width': _biW +'px', 'margin-left': '-'+(_biW / 2 )+'px'});

});

//// .wp-caption
$( window ).resize(function() {
//    var $_wW = $(window).width(),
//        $_hH = $(window).height(),
//        $bth = $("#block-technological-header .box-hedaer-body"),
//        _biW = $bth.find('.block-images').outerWidth(true),
//        _biH = $bth.find('.block-images').outerHeight(true),
//        
//        _biIW = false, _biIH = false,
//        
//        _ml = (42 / _biW) * 100,
//        _mt = (16 / _biH) * 100;
//    
//        if($("#box-img-lines").is(':visible'))
//            $("#box-img-lines img").css({'width': (_biW - 30) +'px', 'margin-left': '-'+(_biW / 2 )+'px'});
    
//    console.log( 'Ww = '+$_wW+' hH = '+ $_hH +' _biW = '+ _biW + ' _biH = '+ _biH +' _biIW = '+ _biIW + ' _biIH = '+ _biIH );
//    
//    if($bth.find('#box-image-element .box-img-middle').is(':visible')) {
//      _biIW = $bth.find('#box-image-element .box-img-middle img').outerWidth(true);
//      _biIH = $bth.find('#box-image-element .box-img-middle img').outerHeight(true);
//      
//      $bth.find('#box-image-element .box-img-middle img').css({
//          'margin-left': _ml+'%',
//          'margin-top': _mt+'%'
//      });
//      
//    } else if($bth.find('#box-image-element .box-img-big').is(':visible')) {
//      _biIW = $bth.find('#box-image-element .box-img-big img').outerWidth(true); 
//      _biIH = $bth.find('#box-image-element .box-img-big img').outerHeight(true);
//    } 
    
    
    
    
});
// The plugin code
(function($){
    $.fn.scrollPumpic = function(options){
        var $this = $(this);
            offset = $this.offset();
        var _stop = false, 
            _objFly = false, 
            dedug = false; // debuging code
        
        var defaults = {
            "start": 0,
            "stop": offset.top + $this.height(),
            "_objFly": '.box-fly-discount',
            "right": 0,
            "_show": true,
            "_settings" : {
                '_responce': true,
                '_validate': true,
                '_validateObj': "#form-discount-fly"
            },
            "animate": {
                'type': '', // fade, visible, blinking
                'timeShow': 200,
                'timeHide': 100
            }
            //"coeff": 0.95
        };
        
        if(dedug)
            console.log( '---------------------------- // INIT PLUGIN SCROLL ----------------------------' );
        
        var opts = $.extend(defaults, options);
            _objFly = (opts._objFly) ? opts._objFly : false;
        
//        $(window).on('resize', function() { 
//           if($(this).width() > 800) {
//                $this.find( _objFly ).css({'margin-right': opts.right+'px'});
//            } else {
//                $this.find( _objFly ).css({'margin-right': '0px'});
//            }
//        }); 

        if(dedug) {
            console.log( 'SCROLL SETTINGS: ', opts );
            console.log( 'start = '+opts.start, 'stop = '+opts.stop );
        }
        
        
        var _animate = {
            init: function( show ) {
                if(show) {
                    $this.find( _objFly ).addClass('fixed');
                } else {
                    $this.find( _objFly ).removeClass('fixed');
                }
                
                switch ( opts.animate.type ) {
                    // fadeIn/Out
                    case  "fade":
                        if(dedug)
                            console.log( show );
                        
                        if(show && $this.not(':visible')) {
                            $this.stop(true).queue('fx', function(){
                                $(this).fadeIn( opts.animate.timeShow ).dequeue('fx');

                                 if(opts._settings._validate)
                                    $( opts._settings._validateObj ).validate(); // init validate
                            });
                        } else if(!show && $this.is(':visible')) {
                            $this.stop(true).queue('fx', function(){
                                $(this).fadeOut( opts.animate.timeHide ).dequeue('fx');
                            });
                        }
                    break;
                    
                    // show/hide
                    case  "visible":
                        
                        if(dedug)
                            console.log( show );
                        
                        if(show && $this.not(':visible')) {
                            $this.stop(true).queue('fx', function(){
                                $(this).show( opts.animate.timeShow ).dequeue('fx');

                                 if(opts._settings._validate)
                                    $( opts._settings._validateObj ).validate(); // init validate
                            });
                        } else if(!show && $this.is(':visible')) {
                            $this.stop(true).queue('fx', function(){
                                $(this).hide( opts.animate.timeHide ).dequeue('fx');
                            });
                        }
                        
                    break;
                    
                    // opacity
                    case  "blinking":
                        if(dedug)
                            console.log( show );
                        
                        if(show && $this.not(':visible')) {
                            $this.stop(true).queue('fx', function(){
                                $(this).animate({opacity: 1}, opts.animate.timeShow ).dequeue('fx');

                                 if(opts._settings._validate)
                                    $( opts._settings._validateObj ).validate(); // init validate
                            });
                        } else if(!show && $this.is(':visible')) {
                            $this.stop(true).queue('fx', function(){
                                $(this).animate({opacity: 0}, opts.animate.timeHide ).dequeue('fx');
                            });
                        }
                        
                        
                    break;
                    
                    default:
                        
                        if(dedug)
                            console.log( show );
                        
                        if(show && $this.not(':visible')) {
                            $this.stop(true).queue('fx', function(){
                                $(this).animate({opacity: 1}, opts.animate.timeShow ).dequeue('fx');

                                 if(opts._settings._validate)
                                    $( opts._settings._validateObj ).validate(); // init validate
                            });
                        } else if(!show && $this.is(':visible')) {
                            $this.stop(true).queue('fx', function(){
                                $(this).animate({opacity: 0}, opts.animate.timeHide ).dequeue('fx');
                            });
                        }
                        
                    break;    
                }
            }
        };
        
        // clear cache
        if($(window).hasHandlers('scroll')) 
            $(window).off('scroll');
        
        $(window).on('scroll', function() {
            windowTop = $(window).scrollTop();
            _stop = (opts.stop) ? (windowTop <= opts.stop) ? true : false : false;
            
            if(dedug)
                console.log('windowTop = '+ windowTop, '_stop = '+_stop+' opts.start = '+opts.start);
            
             if((windowTop >= opts.start) && !_stop) {
                 //newCoord = windowTop * opts.coeff;
                 // box right
                if(opts.right > 0) {
                    if($(window).width() > 800) {
                        $this.find( _objFly ).css({'margin-right': opts.right+'px'});
                    } else {
                        $this.find( _objFly ).css({'margin-right': '0px'});
                    }
                }
               
                // run animate
                opts._show = true;
                
             } else if((windowTop < opts.start) || _stop) { 
                 // run animate
                 opts._show = false;   
             }
             
             _animate.init( opts._show ); // animate
            
        });
        
        
        /*
        return this.each(function(){
            
            $(window).on('scroll', function() {
                
                // console.log( opts.start );
                if(opts._settings._responce) {
                    if($(window).width() <= 480)  {
                        $this.find( _objFly ).removeClass('fixed');
                        $this.hide(500);
                        return;
                    }
                }
                
                windowTop = $(window).scrollTop();
                _stop = (opts.stop) ? (windowTop <= opts.stop) ? true : false : false; 
                
                if((windowTop >= opts.start) && !_stop) {
                    //newCoord = windowTop * opts.coeff;
                    
                    // box right
                    if(opts.right > 0) {
                        
                        if($(window).width() > 800) {
                            $this.find( _objFly ).css({'margin-right': opts.right+'px'});
                        } else {
                            $this.find( _objFly ).css({'margin-right': '0px'});
                        }
                    }
                    
                    if(opts._show) {
                        if(dedug)
                            console.log( opts._show );
                        $this.find( _objFly ).addClass('fixed');
                        $this.stop(true).queue('fx', function(){
                            $(this).animate({opacity: 1}, 200 ).dequeue('fx');
                             if(opts._settings._validate)
                                $( opts._settings._validateObj ).validate(); // init validate
                        });
                      opts._show = false;  
                    }
                    
                } else if((windowTop < opts.start) || _stop) {
                    if(!opts._show) {
                        if(dedug)
                            console.log( opts._show );
                        $this.find( _objFly ).removeClass('fixed');
                        $this.stop(true).queue('fx', function(){
                            $(this).animate({opacity: 0}, 100 ).dequeue('fx');
                        });
                        opts._show = true;
                    }
                    
                }
                
                if(dedug)
                    console.log( 'widow_width = '+$(window).width()+' windowTop ='+ windowTop+' start = '+opts.start );
                
                
                
                    
            });
        });
        
        */
        
        
    };
})(jQuery);

$(document).ready(function() {
	var prods = { ios: 'ios', android: 'android', iosJb: 'ios-jb'},
			$iosBtn = $('#filter-' + prods.ios),
			$andrBtn = $('#filter-' + prods.android),
			$iosJbBtn = $('#filter-' + prods.iosJb);
	var prodList = {
		ios: '#prod-list-' + prods.ios,
		android: '#prod-list-' + prods.android,
		iosJb: '#prod-list-' + prods.iosJb
	};
	
	function toggleProdList(prodList) {
		var $prodList = $(prodList)
		$prodList.siblings().fadeOut(120).promise().done(function () {
			$prodList.fadeIn(120)
		})
	}
	
	$('.filter_list').on('click', 'li', function() {
		$('.filter_list li.filter-active').removeClass('filter-active');
		$(this).addClass('filter-active');
		// $('input[type=checkbox][name=android-40off]').prop('checked', false)
	});
	
	$iosBtn.click(function() {
		var iosBlock = $('th').find('[data-info-block='+ prods.ios +']')
		if (!$(this).hasClass('filter-active')) {
			toggleProdList(prodList.ios);
			toggleProdList(iosBlock);
		}
	});
	
	$iosJbBtn.click(function() {
		var iosJbBlock = $('th').find('[data-info-block='+ prods.iosJb +']')
		if (!$(this).hasClass('filter-active')) {
			toggleProdList(prodList.iosJb);
			toggleProdList(iosJbBlock);
		}
	});
	
	$andrBtn.click(function() {
		var androidBlock = $('th').find('[data-info-block='+ prods.android +']')
		if (!$(this).hasClass('filter-active')) {
			toggleProdList(prodList.android);
			toggleProdList(androidBlock);
		}
	});
	
	//storeRouter
	// 	//parse URL params
	// 	$.urlParam = function(name) {
	// 		var results = new RegExp('[\?&]' + name + '=([^&#]*)').exec(window.location.href);
	// 		if(results!== null) {
	// 			return results[1] || 0;
	// 		}
	// 	}
	var toggleStorePages = function() {
	var hash = window.location.hash;
		if(hash) {
			$('.filter_list li.filter-active').removeClass('filter-active');
			if(hash === '#jailbreak') {
				$iosJbBtn.addClass('filter-active');
				var iosJbBlock = $('th').find('[data-info-block='+ prods.iosJb +']')
				toggleProdList(prodList.iosJb);
				toggleProdList(iosJbBlock);
			}
			if(hash === '#android') {
				$andrBtn.addClass('filter-active');
				var androidBlock = $('th').find('[data-info-block='+ prods.android +']')
				toggleProdList(prodList.android);
				toggleProdList(androidBlock);
			}
		}
	}();
	});

$(function () {
	var $filterBtns = $('._filter-btn'),
			featuresList = $('._filter-feature'),
			thumbnail = $('.thumbnail');
	// var featuresIos = featuresList.filter(function () {
	// 	return $(this).data('filter') === 'icloud'
	// });
	var featuresJb = featuresList.filter(function () {
		return $(this).data('filter') === 'jailbreak'
	});
	var jbInThumbnails = thumbnail.find('[data-filter=jailbreak]');
	var iosInThumbnails = thumbnail.find('[data-filter=icloud]');
	function changeHref() {
		var buyBtn = $('#buy-btn'),
				demoBtn = $('#demo-btn'),
				domain = window.location.hostname;
		buyBtn.attr('href', function (i, origValue) {
			var result;
			origValue == '/store.html' ? result='/store.html#jailbreak' : result='/store.html';
			return result;
		});
		demoBtn.attr('href', function(i, origValue) {
			var result;
			this.pathname == '/setDevice/126' ? result='http://demo.'+domain+'/setDevice/125?redirect_url=cp/calls' : result='http://demo.'+domain+'/setDevice/126?redirect_url=cp/calls';
			return origValue.pathname = result;
		});
	}
		featuresJb.hide();
		jbInThumbnails.hide();
		$filterBtns.on('click', function () {
			if(!$(this).hasClass('filter-active')) {
				changeHref();
				featuresJb.toggle();
				jbInThumbnails.toggle();
				iosInThumbnails.toggle();
		}
	});
});
var mobile_slider = "<div class=\"slide\">";
        mobile_slider += "<div class=\"col-sm-12 col-md-4 col-lg-4 col-xs-12\">";
        mobile_slider +=    "<img src=\"{img_src}\" class=\"testimonial-photo\">";
        mobile_slider +=    "<div class=\"testimonial-text\">{text}</div>";
        mobile_slider += "</div>";
    mobile_slider += "</div>";
    
var objSliderMobile = $('.bxSliderMobile');
var bxSliders = false;
var bxSlidersMobile = false;
var bxSlidersPC = false;
    
$(document).ready(function(){ 
    // .replace
    
    
    
    if($('.bxSliders').length) {
    
//        if($('.bxSliders').not('.only-mobile, .only-pc')) {
//            bxSliders = runSliders( $('.bxSliders').not('.only-mobile, .only-pc') );
//        }
//
//        if($('.bxSliders.only-mobile').length)
//            bxSlidersMobile = runSliders( $('.bxSliders.only-mobile') ); // :visible
        
        if(!bxSlidersPC && $('.bxSliders.only-pc').length)
            bxSlidersPC = runSliders( $('.bxSliders.only-pc') ); // :visible

        $(window).on('load resize', function() {
            
            if($(this).width() < 992) {

                if(!bxSlidersMobile && !$('.bxSliderMobile').find('.slide').length) {
                    sliderMobileInit(objSliderMobile, $('.bxSliders.only-pc'));
                    bxSlidersMobile = runSliders( $('.bxSliderMobile') );
                }

//                if(bxSlidersMobile && $('.bxSliders.only-mobile').length) // .is(':visible')
//                   bxSlidersMobile.reloadSlider();

//                if(bxSlidersPC && $('.bxSliders.only-pc').length) // .not(':visible')
//                   bxSlidersPC.destroySlider();

                if(bxSlidersPC) {
                   bxSlidersPC.destroySlider();
                   bxSlidersPC = false;
               }   

            } else {

                 if(bxSlidersMobile && $('.bxSliderMobile').length && $('.bxSliderMobile').find('.slide').length) {
                     bxSlidersMobile.destroySlider();
                     clearSliderMobile( objSliderMobile );
                     bxSlidersMobile = false
                 }    
                 
                    

//               if(bxSlidersMobile && $('.bxSliders.only-mobile').length) //.not(':visible') 
//                   bxSlidersMobile.destroySlider();

//                if(bxSlidersPC && $('.bxSliders.only-pc').length) // .is(':visible')
//                   bxSlidersPC.reloadSlider();

                if(!bxSlidersPC) {
                   bxSlidersPC = runSliders( $('.bxSliders.only-pc') );
               }   

           }   
        });
    
    }
    
    if($('.slider-ipad').length) {
        $('.slider-ipad').bxSlider({
            slideWidth: 385,
            minSlides: 1,
            controls: true,
            // moveSlides: 1,
            // startSlide: 2,
            // maxSlides: 10,
            // slideMargin: 10
            nextSelector: '#slider-next',
            prevSelector: '#slider-prev',
            nextText: '',
            prevText: '',
            
//            buildPager: null,
//            pagerCustom: true,
        }); 
    }
});

function sliderMobileInit( obj, getElemts ) {
    var _html = '', $res = new Array;
    if(isset(obj) && isset(getElemts)) {
        getElemts.find('.slide').each(function(k, val) {
            var _item = $(val).find('.bxItem');
            if(isset(_item)) {
                _item.each(function(ik, ival) {
                    
                   $res.push({
                       'src': $(ival).find('.testimonial-photo').attr('src'),
                       'text': $(ival).find('.testimonial-text').html()
                    }); 
                    
                });
            }
        });
    }
    
    if($res.length > 0) {
        $.each($res, function(key, item) {
            if(item.src && item.text) {
                var _hItem = '';
                _hItem += mobile_slider.replace('{img_src}', item.src);
                _html += _hItem.replace('{text}', item.text);
            }
        });
        obj.html( _html );
    }
    
}

function clearSliderMobile(obj) {
    if(isset(obj)) obj.empty(); 
}

function runSliders( obj ) {
    return obj.bxSlider({
        slideWidth: 1170,
        minSlides: 1,
        controls: false,
        
        infiniteLoop: false,
        responsive: true,
        
        wrapperClass: 'bx-wrapper-testimonials',
        onSliderLoad: function(){
            // alert( $('.bx-controls .bx-pager > .bx-pager-item').length );
            if($('.bx-controls > .bx-pager > .bx-pager-item').length < 2) $('.bx-controls > .bx-pager > .bx-pager-item').hide(); 
        },
        onSlideBefore: function() {

        },
        onSlideAfter: function(){

        },
    }); 
   
}
/***
 * BxSlider v4.2.3 - Fully loaded, responsive content slider
 * http://bxslider.com
 *
 * Copyright 2014, Steven Wanderski - http://stevenwanderski.com - http://bxcreative.com
 * Written while drinking Belgian ales and listening to jazz
 *
 * Released under the MIT license - http://opensource.org/licenses/MIT
 ***/

;(function($){

	var defaults = {

		// GENERAL
		mode: 'horizontal',
		slideSelector: '',
		infiniteLoop: true,
		hideControlOnEnd: false,
		speed: 500,
		easing: null,
		slideMargin: 0,
		startSlide: 0,
		randomStart: false,
		captions: false,
		ticker: false,
		tickerHover: false,
		adaptiveHeight: false,
		adaptiveHeightSpeed: 500,
		video: false,
		useCSS: true,
		preloadImages: 'visible',
		responsive: true,
		slideZIndex: 50,
		wrapperClass: 'bx-wrapper',

		// TOUCH
		touchEnabled: true,
		swipeThreshold: 50,
		oneToOneTouch: true,
		preventDefaultSwipeX: true,
		preventDefaultSwipeY: false,

		// KEYBOARD
		keyboardEnabled: false,

		// PAGER
		pager: true,
		pagerType: 'full',
		pagerShortSeparator: ' / ',
		pagerSelector: null,
		buildPager: null,
		pagerCustom: null,

		// CONTROLS
		controls: true,
		nextText: 'Next',
		prevText: 'Prev',
		nextSelector: null,
		prevSelector: null,
		autoControls: false,
		startText: 'Start',
		stopText: 'Stop',
		autoControlsCombine: false,
		autoControlsSelector: null,

		// AUTO
		auto: false,
		pause: 4000,
		autoStart: true,
		autoDirection: 'next',
		autoHover: false,
		autoDelay: 0,
		autoSlideForOnePage: false,

		// CAROUSEL
		minSlides: 1,
		maxSlides: 1,
		moveSlides: 0,
		slideWidth: 0,

		// CALLBACKS
		onSliderLoad: function(){ return true },
		onSlideBefore: function(){ return true },
		onSlideAfter: function(){ return true },
		onSlideNext: function(){ return true },
		onSlidePrev: function(){ return true },
		onSliderResize: function(){ return true }
	};

	$.fn.bxSlider = function(options){

		if(this.length === 0){
			return this;
		} 

		// support multiple elements
		if(this.length > 1){
			this.each(function(){
				$(this).bxSlider(options);
			});
			return this;
		}

		// create a namespace to be used throughout the plugin
		var slider = {};
		// set a reference to our slider element
		var el = this;

		/**
		 * Makes slideshow responsive
		 */
		// first get the original window dimens (thanks a lot IE)
		var windowWidth = $(window).width();
		var windowHeight = $(window).height();



		/**
		 * ===================================================================================
		 * = PRIVATE FUNCTIONS
		 * ===================================================================================
		 */

		/**
		 * Initializes namespace settings to be used throughout plugin
		 */
		var init = function(){
			// merge user-supplied options with the defaults
			slider.settings = $.extend({}, defaults, options);
			// parse slideWidth setting
			slider.settings.slideWidth = parseInt(slider.settings.slideWidth);
			// store the original children
			slider.children = el.children(slider.settings.slideSelector);
			// check if actual number of slides is less than minSlides / maxSlides
			if(slider.children.length < slider.settings.minSlides){ slider.settings.minSlides = slider.children.length; } 
			if(slider.children.length < slider.settings.maxSlides){ slider.settings.maxSlides = slider.children.length; }
			// if random start, set the startSlide setting to random number
			if(slider.settings.randomStart){ slider.settings.startSlide = Math.floor(Math.random() * slider.children.length); }
			// store active slide information
			slider.active = { index: slider.settings.startSlide };
			// store if the slider is in carousel mode (displaying / moving multiple slides)
			slider.carousel = slider.settings.minSlides > 1 || slider.settings.maxSlides > 1 ? true : false;
			// if carousel, force preloadImages = 'all'
			if(slider.carousel){ slider.settings.preloadImages = 'all'; }
			// calculate the min / max width thresholds based on min / max number of slides
			// used to setup and update carousel slides dimensions
			slider.minThreshold = (slider.settings.minSlides * slider.settings.slideWidth) + ((slider.settings.minSlides - 1) * slider.settings.slideMargin);
			slider.maxThreshold = (slider.settings.maxSlides * slider.settings.slideWidth) + ((slider.settings.maxSlides - 1) * slider.settings.slideMargin);
			// store the current state of the slider (if currently animating, working is true)
			slider.working = false;
			// initialize the controls object
			slider.controls = {};
			// initialize an auto interval
			slider.interval = null;
			// determine which property to use for transitions
			slider.animProp = slider.settings.mode === 'vertical' ? 'top' : 'left';
			// determine if hardware acceleration can be used
			slider.usingCSS = slider.settings.useCSS && slider.settings.mode !== 'fade' && (function(){
				// create our test div element
				var div = document.createElement('div');
				// css transition properties
				var props = ['WebkitPerspective', 'MozPerspective', 'OPerspective', 'msPerspective'];
				// test for each property
				for(var i in props){
					if(div.style[props[i]] !== undefined){
						slider.cssPrefix = props[i].replace('Perspective', '').toLowerCase();
						slider.animProp = '-' + slider.cssPrefix + '-transform';
						return true;
					}
				}
				return false;
			}());
			// if vertical mode always make maxSlides and minSlides equal
			if(slider.settings.mode === 'vertical'){ slider.settings.maxSlides = slider.settings.minSlides; }
			// save original style data
			el.data("origStyle", el.attr("style"));
			el.children(slider.settings.slideSelector).each(function(){
			  $(this).data("origStyle", $(this).attr("style"));
			});
			// perform all DOM / CSS modifications
			setup();
		};

		/**
		 * Performs all DOM and CSS modifications
		 */
		var setup = function(){
			// wrap el in a wrapper
			el.wrap('<div class="' + slider.settings.wrapperClass + '"><div class="bx-viewport"></div></div>');
			// store a namespace reference to .bx-viewport
			slider.viewport = el.parent();
			// add a loading div to display while images are loading
			slider.loader = $('<div class="bx-loading" />');
			slider.viewport.prepend(slider.loader);
			// set el to a massive width, to hold any needed slides
			// also strip any margin and padding from el
			el.css({
				width: slider.settings.mode === 'horizontal' ? (slider.children.length * 1000 + 215) + '%' : 'auto',
				position: 'absolute'
			});
			// if using CSS, add the easing property
			if(slider.usingCSS && slider.settings.easing){
				el.css('-' + slider.cssPrefix + '-transition-timing-function', slider.settings.easing);
			// if not using CSS and no easing value was supplied, use the default JS animation easing (swing)
			}else if(!slider.settings.easing){
				slider.settings.easing = 'swing';
			}
			var slidesShowing = getNumberSlidesShowing();
			// make modifications to the viewport (.bx-viewport)
			slider.viewport.css({
				width: '100%',
				overflow: 'hidden',
				position: 'relative'
			});
			slider.viewport.parent().css({
				maxWidth: getViewportMaxWidth()
			});
			// make modification to the wrapper (.bx-wrapper)
			if(!slider.settings.pager && !slider.settings.controls){
				slider.viewport.parent().css({
					margin: '0 auto 0px'
				});
			}
			// apply css to all slider children
			slider.children.css({
				'float': slider.settings.mode === 'horizontal' ? 'left' : 'none',
				listStyle: 'none',
				position: 'relative'
			});
			// apply the calculated width after the float is applied to prevent scrollbar interference
			slider.children.css('width', getSlideWidth());
			// if slideMargin is supplied, add the css
			if(slider.settings.mode === 'horizontal' && slider.settings.slideMargin > 0){ slider.children.css('marginRight', slider.settings.slideMargin); }
			if(slider.settings.mode === 'vertical' && slider.settings.slideMargin > 0){ slider.children.css('marginBottom', slider.settings.slideMargin); }
			// if "fade" mode, add positioning and z-index CSS
			if(slider.settings.mode === 'fade'){
				slider.children.css({
					position: 'absolute',
					zIndex: 0,
					display: 'none'
				});
				// prepare the z-index on the showing element
				slider.children.eq(slider.settings.startSlide).css({zIndex: slider.settings.slideZIndex, display: 'block'});
			}
			// create an element to contain all slider controls (pager, start / stop, etc)
			slider.controls.el = $('<div class="bx-controls" />');
			// if captions are requested, add them
			if(slider.settings.captions){ appendCaptions(); }
			// check if startSlide is last slide
			slider.active.last = slider.settings.startSlide === getPagerQty() - 1;
			// if video is true, set up the fitVids plugin
			if(slider.settings.video){ el.fitVids(); }
			// set the default preload selector (visible)
			var preloadSelector = slider.children.eq(slider.settings.startSlide);
			if(slider.settings.preloadImages === "all" || slider.settings.ticker){ preloadSelector = slider.children; }
			// only check for control addition if not in "ticker" mode
			if(!slider.settings.ticker){
				// if controls are requested, add them
				if(slider.settings.controls){ appendControls(); }
				// if auto is true, and auto controls are requested, add them
				if(slider.settings.auto && slider.settings.autoControls){ appendControlsAuto(); }
				// if pager is requested, add it
				if(slider.settings.pager){ appendPager(); }
				// if any control option is requested, add the controls wrapper
				if(slider.settings.controls || slider.settings.autoControls || slider.settings.pager){ slider.viewport.after(slider.controls.el); }
			// if ticker mode, do not allow a pager
			} else {
				slider.settings.pager = false;
			}
			loadElements(preloadSelector, start);
		};

		var loadElements = function(selector, callback){
			var total = selector.find('img:not([src=""]), iframe').length;
			if(total === 0){
				callback();
				return;
			}
			var count = 0;
			selector.find('img:not([src=""]), iframe').each(function(){
				$(this).one('load error', function(){
				  if(++count === total){ callback(); }
				}).each(function(){
				  if(this.complete){ $(this).load(); }
				});
			});
		};

		/**
		 * Start the slider
		 */
		var start = function(){
			// if infinite loop, prepare additional slides
			if(slider.settings.infiniteLoop && slider.settings.mode !== 'fade' && !slider.settings.ticker){
				var slice = slider.settings.mode === 'vertical' ? slider.settings.minSlides : slider.settings.maxSlides;
				var sliceAppend = slider.children.slice(0, slice).clone(true).addClass('bx-clone');
				var slicePrepend = slider.children.slice(-slice).clone(true).addClass('bx-clone');
				el.append(sliceAppend).prepend(slicePrepend);
			}
			// remove the loading DOM element
			slider.loader.remove();
			// set the left / top position of "el"
			setSlidePosition();
			// if "vertical" mode, always use adaptiveHeight to prevent odd behavior
			if(slider.settings.mode === 'vertical'){ slider.settings.adaptiveHeight = true; }
			// set the viewport height
			slider.viewport.height(getViewportHeight());
			// make sure everything is positioned just right (same as a window resize)
			el.redrawSlider();
			// onSliderLoad callback
			slider.settings.onSliderLoad(slider,slider.active.index);
			// slider has been fully initialized
			slider.initialized = true;
			// bind the resize call to the window
			if(slider.settings.responsive){ $(window).bind('resize', resizeWindow); }
			// if auto is true and has more than 1 page, start the show
			if(slider.settings.auto && slider.settings.autoStart && (getPagerQty() > 1 || slider.settings.autoSlideForOnePage)){ initAuto(); }
			// if ticker is true, start the ticker
			if(slider.settings.ticker){ initTicker(); }
			// if pager is requested, make the appropriate pager link active
			if(slider.settings.pager){ updatePagerActive(slider.settings.startSlide); }
			// check for any updates to the controls (like hideControlOnEnd updates)
			if(slider.settings.controls){ updateDirectionControls(); }
			// if touchEnabled is true, setup the touch events
			if(slider.settings.touchEnabled && !slider.settings.ticker){ initTouch(); }
			// if keyboardEnabled is true, setup the keyboard events
			if (slider.settings.keyboardEnabled && !slider.settings.ticker) { 
				$(document).keydown(keyPress);
			}
		};

		/**
		 * Returns the calculated height of the viewport, used to determine either adaptiveHeight or the maxHeight value
		 */
		var getViewportHeight = function(){
			var height = 0;
			// first determine which children (slides) should be used in our height calculation
			var children = $();
			// if mode is not "vertical" and adaptiveHeight is false, include all children
			if(slider.settings.mode !== 'vertical' && !slider.settings.adaptiveHeight){
				children = slider.children;
			}else{
				// if not carousel, return the single active child
				if(!slider.carousel){
					children = slider.children.eq(slider.active.index);
				// if carousel, return a slice of children
				}else{
					// get the individual slide index
					var currentIndex = slider.settings.moveSlides === 1 ? slider.active.index : slider.active.index * getMoveBy();
					// add the current slide to the children
					children = slider.children.eq(currentIndex);
					// cycle through the remaining "showing" slides
					for (i = 1; i <= slider.settings.maxSlides - 1; i++){
						// if looped back to the start
						if(currentIndex + i >= slider.children.length){
							children = children.add(slider.children.eq(i - 1));
						}else{
							children = children.add(slider.children.eq(currentIndex + i));
						}
					}
				}
			}
			// if "vertical" mode, calculate the sum of the heights of the children
			if(slider.settings.mode === 'vertical'){
				children.each(function(index){
				  height += $(this).outerHeight();
				});
				// add user-supplied margins
				if(slider.settings.slideMargin > 0){
					height += slider.settings.slideMargin * (slider.settings.minSlides - 1);
				}
			// if not "vertical" mode, calculate the max height of the children
			}else{
				height = Math.max.apply(Math, children.map(function(){
					return $(this).outerHeight(false);
				}).get());
			}

			if(slider.viewport.css('box-sizing') === 'border-box'){
				height +=	parseFloat(slider.viewport.css('padding-top')) + parseFloat(slider.viewport.css('padding-bottom')) +
							parseFloat(slider.viewport.css('border-top-width')) + parseFloat(slider.viewport.css('border-bottom-width'));
			}else if(slider.viewport.css('box-sizing') === 'padding-box'){
				height +=	parseFloat(slider.viewport.css('padding-top')) + parseFloat(slider.viewport.css('padding-bottom'));
			}

			return height;
		};

		/**
		 * Returns the calculated width to be used for the outer wrapper / viewport
		 */
		var getViewportMaxWidth = function(){
			var width = '100%';
			if(slider.settings.slideWidth > 0){
				if(slider.settings.mode === 'horizontal'){
					width = (slider.settings.maxSlides * slider.settings.slideWidth) + ((slider.settings.maxSlides - 1) * slider.settings.slideMargin);
				}else{
					width = slider.settings.slideWidth;
				}
			}
			return width;
		};

		/**
		 * Returns the calculated width to be applied to each slide
		 */
		var getSlideWidth = function(){
			// start with any user-supplied slide width
			var newElWidth = slider.settings.slideWidth;
			// get the current viewport width
			var wrapWidth = slider.viewport.width();
			// if slide width was not supplied, or is larger than the viewport use the viewport width
			if(slider.settings.slideWidth === 0 ||
				(slider.settings.slideWidth > wrapWidth && !slider.carousel) ||
				slider.settings.mode === 'vertical'){
				newElWidth = wrapWidth;
			// if carousel, use the thresholds to determine the width
			}else if(slider.settings.maxSlides > 1 && slider.settings.mode === 'horizontal'){
				if(wrapWidth > slider.maxThreshold){
					// newElWidth = (wrapWidth - (slider.settings.slideMargin * (slider.settings.maxSlides - 1))) / slider.settings.maxSlides;
				}else if(wrapWidth < slider.minThreshold){
					newElWidth = (wrapWidth - (slider.settings.slideMargin * (slider.settings.minSlides - 1))) / slider.settings.minSlides;
				}
			}
			return newElWidth;
		};

		/**
		 * Returns the number of slides currently visible in the viewport (includes partially visible slides)
		 */
		var getNumberSlidesShowing = function(){
			var slidesShowing = 1;
			if(slider.settings.mode === 'horizontal' && slider.settings.slideWidth > 0){
				// if viewport is smaller than minThreshold, return minSlides
				if(slider.viewport.width() < slider.minThreshold){
					slidesShowing = slider.settings.minSlides;
				// if viewport is larger than maxThreshold, return maxSlides
				}else if(slider.viewport.width() > slider.maxThreshold){
					slidesShowing = slider.settings.maxSlides;
				// if viewport is between min / max thresholds, divide viewport width by first child width
				}else{
					var childWidth = slider.children.first().width() + slider.settings.slideMargin;
					slidesShowing = Math.floor((slider.viewport.width() +
						slider.settings.slideMargin) / childWidth);
				}
			// if "vertical" mode, slides showing will always be minSlides
			}else if(slider.settings.mode === 'vertical'){
				slidesShowing = slider.settings.minSlides;
			}
			return slidesShowing;
		};

		/**
		 * Returns the number of pages (one full viewport of slides is one "page")
		 */
		var getPagerQty = function(){
			var pagerQty = 0;
			// if moveSlides is specified by the user
			if(slider.settings.moveSlides > 0){
				if(slider.settings.infiniteLoop){
					pagerQty = Math.ceil(slider.children.length / getMoveBy());
				}else{
					// use a while loop to determine pages
					var breakPoint = 0;
					var counter = 0;
					// when breakpoint goes above children length, counter is the number of pages
					while (breakPoint < slider.children.length){
						++pagerQty;
						breakPoint = counter + getNumberSlidesShowing();
						counter += slider.settings.moveSlides <= getNumberSlidesShowing() ? slider.settings.moveSlides : getNumberSlidesShowing();
					}
				}
			// if moveSlides is 0 (auto) divide children length by sides showing, then round up
			}else{
				pagerQty = Math.ceil(slider.children.length / getNumberSlidesShowing());
			}
			return pagerQty;
		};

		/**
		 * Returns the number of individual slides by which to shift the slider
		 */
		var getMoveBy = function(){
			// if moveSlides was set by the user and moveSlides is less than number of slides showing
			if(slider.settings.moveSlides > 0 && slider.settings.moveSlides <= getNumberSlidesShowing()){
				return slider.settings.moveSlides;
			}
			// if moveSlides is 0 (auto)
			return getNumberSlidesShowing();
		};

		/**
		 * Sets the slider's (el) left or top position
		 */
		var setSlidePosition = function(){
			var position;
			// if last slide, not infinite loop, and number of children is larger than specified maxSlides
			if(slider.children.length > slider.settings.maxSlides && slider.active.last && !slider.settings.infiniteLoop){
				if(slider.settings.mode === 'horizontal'){
					// get the last child's position
					var lastChild = slider.children.last();
					position = lastChild.position();
					// set the left position
					setPositionProperty(-(position.left - (slider.viewport.width() - lastChild.outerWidth())), 'reset', 0);
				}else if(slider.settings.mode === 'vertical'){
					// get the last showing index's position
					var lastShowingIndex = slider.children.length - slider.settings.minSlides;
					position = slider.children.eq(lastShowingIndex).position();
					// set the top position
					setPositionProperty(-position.top, 'reset', 0);
				}
			// if not last slide
			}else{
				// get the position of the first showing slide
				position = slider.children.eq(slider.active.index * getMoveBy()).position();
				// check for last slide
				if(slider.active.index === getPagerQty() - 1){ slider.active.last = true; }
				// set the respective position
				if(position !== undefined){
					if(slider.settings.mode === 'horizontal'){ setPositionProperty(-position.left, 'reset', 0); }
					else if(slider.settings.mode === 'vertical'){ setPositionProperty(-position.top, 'reset', 0); }
				}
			}
		};

		/**
		 * Sets the el's animating property position (which in turn will sometimes animate el).
		 * If using CSS, sets the transform property. If not using CSS, sets the top / left property.
		 *
		 * @param value (int)
		 *  - the animating property's value
		 *
		 * @param type (string) 'slide', 'reset', 'ticker'
		 *  - the type of instance for which the function is being
		 *
		 * @param duration (int)
		 *  - the amount of time (in ms) the transition should occupy
		 *
		 * @param params (array) optional
		 *  - an optional parameter containing any variables that need to be passed in
		 */
		var setPositionProperty = function(value, type, duration, params){
			// use CSS transform
			if(slider.usingCSS){
				// determine the translate3d value
				var propValue = slider.settings.mode === 'vertical' ? 'translate3d(0, ' + value + 'px, 0)' : 'translate3d(' + value + 'px, 0, 0)';
				// add the CSS transition-duration
				el.css('-' + slider.cssPrefix + '-transition-duration', duration / 1000 + 's');
				if(type === 'slide'){
					setTimeout(function() {
						// set the property value
						el.css(slider.animProp, propValue);
						// if value 0, just update
						if(value === 0) {
							updateAfterSlideTransition();
						} else {
							// bind a callback method - executes when CSS transition completes
							el.bind('transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd', function(){
								// unbind the callback
								el.unbind('transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd');
								updateAfterSlideTransition();
							});
						}
					}, 0);
				}else if(type === 'reset'){
					el.css(slider.animProp, propValue);
				}else if(type === 'ticker'){
					// make the transition use 'linear'
					el.css('-' + slider.cssPrefix + '-transition-timing-function', 'linear');
					el.css(slider.animProp, propValue);
					// bind a callback method - executes when CSS transition completes
					el.bind('transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd', function(){
						// unbind the callback
						el.unbind('transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd');
						// reset the position
						setPositionProperty(params.resetValue, 'reset', 0);
						// start the loop again
						tickerLoop();
					});
				}
			// use JS animate
			}else{
				var animateObj = {};
				animateObj[slider.animProp] = value;
				if(type === 'slide'){
					el.animate(animateObj, duration, slider.settings.easing, function(){
						updateAfterSlideTransition();
					});
				}else if(type === 'reset'){
					el.css(slider.animProp, value);
				}else if(type === 'ticker'){
					el.animate(animateObj, speed, 'linear', function(){
						setPositionProperty(params.resetValue, 'reset', 0);
						// run the recursive loop after animation
						tickerLoop();
					});
				}
			}
		};

		/**
		 * Populates the pager with proper amount of pages
		 */
		var populatePager = function(){
			var pagerHtml = '';
			var pagerQty = getPagerQty();
                        // console.log('pagerQty = '+ pagerQty);
			// loop through each pager item
			for(var i=0; i < pagerQty; i++){
				var linkContent = '';
				// if a buildPager function is supplied, use it to get pager link value, else use index + 1
				if(slider.settings.buildPager && $.isFunction(slider.settings.buildPager) || slider.settings.pagerCustom){
					linkContent = slider.settings.buildPager(i);
					slider.pagerEl.addClass('bx-custom-pager');
				}else{
					linkContent = i + 1;
					slider.pagerEl.addClass('bx-default-pager');
				}
				// var linkContent = slider.settings.buildPager && $.isFunction(slider.settings.buildPager) ? slider.settings.buildPager(i) : i + 1;
				// add the markup to the string
				pagerHtml += '<div class="bx-pager-item"><a href="" data-slide-index="' + i + '" class="bx-pager-link">' + linkContent + '</a></div>';
			}
			// populate the pager element with pager links
                        if(pagerQty > 1)
                            slider.pagerEl.html(pagerHtml);
		};

		/**
		 * Appends the pager to the controls element
		 */
		var appendPager = function(){
			if(!slider.settings.pagerCustom){
				// create the pager DOM element
				slider.pagerEl = $('<div class="bx-pager" />');
				// if a pager selector was supplied, populate it with the pager
				if(slider.settings.pagerSelector){
					$(slider.settings.pagerSelector).html(slider.pagerEl);
				// if no pager selector was supplied, add it after the wrapper
				}else{
					slider.controls.el.addClass('bx-has-pager').append(slider.pagerEl);
				}
				// populate the pager
				populatePager();
			}else{
				slider.pagerEl = $(slider.settings.pagerCustom);
			}
			// assign the pager click binding
			slider.pagerEl.on('click touchend', 'a', clickPagerBind);
		};

		/**
		 * Appends prev / next controls to the controls element
		 */
		var appendControls = function(){
			slider.controls.next = $('<a class="bx-next" href="">' + slider.settings.nextText + '</a>');
			slider.controls.prev = $('<a class="bx-prev" href="">' + slider.settings.prevText + '</a>');
			// bind click actions to the controls
			slider.controls.next.bind('click touchend', clickNextBind);
			slider.controls.prev.bind('click touchend', clickPrevBind);
			// if nextSelector was supplied, populate it
			if(slider.settings.nextSelector){
				$(slider.settings.nextSelector).append(slider.controls.next);
			}
			// if prevSelector was supplied, populate it
			if(slider.settings.prevSelector){
				$(slider.settings.prevSelector).append(slider.controls.prev);
			}
			// if no custom selectors were supplied
			if(!slider.settings.nextSelector && !slider.settings.prevSelector){
				// add the controls to the DOM
				slider.controls.directionEl = $('<div class="bx-controls-direction" />');
				// add the control elements to the directionEl
				slider.controls.directionEl.append(slider.controls.prev).append(slider.controls.next);
				// slider.viewport.append(slider.controls.directionEl);
				slider.controls.el.addClass('bx-has-controls-direction').append(slider.controls.directionEl);
			}
		};

		/**
		 * Appends start / stop auto controls to the controls element
		 */
		var appendControlsAuto = function(){
			slider.controls.start = $('<div class="bx-controls-auto-item"><a class="bx-start" href="">' + slider.settings.startText + '</a></div>');
			slider.controls.stop = $('<div class="bx-controls-auto-item"><a class="bx-stop" href="">' + slider.settings.stopText + '</a></div>');
			// add the controls to the DOM
			slider.controls.autoEl = $('<div class="bx-controls-auto" />');
			// bind click actions to the controls
			slider.controls.autoEl.on('click', '.bx-start', clickStartBind);
			slider.controls.autoEl.on('click', '.bx-stop', clickStopBind);
			// if autoControlsCombine, insert only the "start" control
			if(slider.settings.autoControlsCombine){
				slider.controls.autoEl.append(slider.controls.start);
			// if autoControlsCombine is false, insert both controls
			}else{
				slider.controls.autoEl.append(slider.controls.start).append(slider.controls.stop);
			}
			// if auto controls selector was supplied, populate it with the controls
			if(slider.settings.autoControlsSelector){
				$(slider.settings.autoControlsSelector).html(slider.controls.autoEl);
			// if auto controls selector was not supplied, add it after the wrapper
			}else{
				slider.controls.el.addClass('bx-has-controls-auto').append(slider.controls.autoEl);
			}
			// update the auto controls
			updateAutoControls(slider.settings.autoStart ? 'stop' : 'start');
		};

		/**
		 * Appends image captions to the DOM
		 */
		var appendCaptions = function(){
			// cycle through each child
			slider.children.each(function(index){
				// get the image title attribute
				var title = $(this).find('img:first').attr('title');
				// append the caption
				if(title !== undefined && ('' + title).length){
					$(this).append('<div class="bx-caption"><span>' + title + '</span></div>');
				}
			});
		};

		/**
		 * Click next binding
		 *
		 * @param e (event)
		 *  - DOM event object
		 */
		var clickNextBind = function(e){
			e.preventDefault();
			if (slider.controls.el.hasClass('disabled')) {
				return;
			}
			// if auto show is running, stop it
			if(slider.settings.auto){ el.stopAuto(); }
			el.goToNextSlide();
		};

		/**
		 * Click prev binding
		 *
		 * @param e (event)
		 *  - DOM event object
		 */
		var clickPrevBind = function(e){
			e.preventDefault();
			if (slider.controls.el.hasClass('disabled')) {
				return;
			}
			// if auto show is running, stop it
			if(slider.settings.auto){ el.stopAuto(); }
			el.goToPrevSlide();
		};

		/**
		 * Click start binding
		 *
		 * @param e (event)
		 *  - DOM event object
		 */
		var clickStartBind = function(e){
			el.startAuto();
			e.preventDefault();
		};

		/**
		 * Click stop binding
		 *
		 * @param e (event)
		 *  - DOM event object
		 */
		var clickStopBind = function(e){
			el.stopAuto();
			e.preventDefault();
		};

		/**
		 * Click pager binding
		 *
		 * @param e (event)
		 *  - DOM event object
		 */
		var clickPagerBind = function(e){
			e.preventDefault();
			if (slider.controls.el.hasClass('disabled')) {
				return;
			}
			// if auto show is running, stop it
			if(slider.settings.auto){ el.stopAuto(); }
			var pagerLink = $(e.currentTarget);
			if(pagerLink.attr('data-slide-index') !== undefined){
				var pagerIndex = parseInt(pagerLink.attr('data-slide-index'));
				// if clicked pager link is not active, continue with the goToSlide call
				if(pagerIndex !== slider.active.index){ el.goToSlide(pagerIndex); }
			}
		};

		/**
		 * Updates the pager links with an active class
		 *
		 * @param slideIndex (int)
		 *  - index of slide to make active
		 */
		var updatePagerActive = function(slideIndex){
			// if "short" pager type
			var len = slider.children.length; // nb of children
			if(slider.settings.pagerType === 'short'){
				if(slider.settings.maxSlides > 1){
					len = Math.ceil(slider.children.length/slider.settings.maxSlides);
				}
				slider.pagerEl.html( (slideIndex + 1) + slider.settings.pagerShortSeparator + len);
				return;
			}
			// remove all pager active classes
			slider.pagerEl.find('a').removeClass('active');
			// apply the active class for all pagers
			slider.pagerEl.each(function(i, el){ $(el).find('a').eq(slideIndex).addClass('active'); });
		};

		/**
		 * Performs needed actions after a slide transition
		 */
		var updateAfterSlideTransition = function(){
			// if infinite loop is true
			if(slider.settings.infiniteLoop){
				var position = '';
				// first slide
				if(slider.active.index === 0){
					// set the new position
					position = slider.children.eq(0).position();
				// carousel, last slide
				}else if(slider.active.index === getPagerQty() - 1 && slider.carousel){
					position = slider.children.eq((getPagerQty() - 1) * getMoveBy()).position();
				// last slide
				}else if(slider.active.index === slider.children.length - 1){
					position = slider.children.eq(slider.children.length - 1).position();
				}
				if(position){
					if(slider.settings.mode === 'horizontal'){ setPositionProperty(-position.left, 'reset', 0); }
					else if(slider.settings.mode === 'vertical'){ setPositionProperty(-position.top, 'reset', 0); }
				}
			}
			// declare that the transition is complete
			slider.working = false;
			// onSlideAfter callback
			slider.settings.onSlideAfter(slider.children.eq(slider.active.index), slider.oldIndex, slider.active.index);
		};

		/**
		 * Updates the auto controls state (either active, or combined switch)
		 *
		 * @param state (string) "start", "stop"
		 *  - the new state of the auto show
		 */
		var updateAutoControls = function(state){
			// if autoControlsCombine is true, replace the current control with the new state
			if(slider.settings.autoControlsCombine){
				slider.controls.autoEl.html(slider.controls[state]);
			// if autoControlsCombine is false, apply the "active" class to the appropriate control
			}else{
				slider.controls.autoEl.find('a').removeClass('active');
				slider.controls.autoEl.find('a:not(.bx-' + state + ')').addClass('active');
			}
		};

		/**
		 * Updates the direction controls (checks if either should be hidden)
		 */
		var updateDirectionControls = function(){
			if(getPagerQty() === 1){
				slider.controls.prev.addClass('disabled');
				slider.controls.next.addClass('disabled');
			}else if(!slider.settings.infiniteLoop && slider.settings.hideControlOnEnd){
				// if first slide
				if(slider.active.index === 0){
					slider.controls.prev.addClass('disabled');
					slider.controls.next.removeClass('disabled');
				// if last slide
				}else if(slider.active.index === getPagerQty() - 1){
					slider.controls.next.addClass('disabled');
					slider.controls.prev.removeClass('disabled');
				// if any slide in the middle
				}else{
					slider.controls.prev.removeClass('disabled');
					slider.controls.next.removeClass('disabled');
				}
			}
		};

		/**
		 * Initializes the auto process
		 */
		var initAuto = function(){
			// if autoDelay was supplied, launch the auto show using a setTimeout() call
			if(slider.settings.autoDelay > 0){
				var timeout = setTimeout(el.startAuto, slider.settings.autoDelay);
			// if autoDelay was not supplied, start the auto show normally
			}else{
				el.startAuto();

				//add focus and blur events to ensure its running if timeout gets paused
				$(window).focus(function() {
					el.startAuto();
				}).blur(function() {
					el.stopAuto();
				});
				

			}
			// if autoHover is requested
			if(slider.settings.autoHover){
				// on el hover
				el.hover(function(){
					// if the auto show is currently playing (has an active interval)
					if(slider.interval){
						// stop the auto show and pass true argument which will prevent control update
						el.stopAuto(true);
						// create a new autoPaused value which will be used by the relative "mouseout" event
						slider.autoPaused = true;
					}
				}, function(){
					// if the autoPaused value was created be the prior "mouseover" event
					if(slider.autoPaused){
						// start the auto show and pass true argument which will prevent control update
						el.startAuto(true);
						// reset the autoPaused value
						slider.autoPaused = null;
					}
				});
			}
		};

		/**
		 * Initializes the ticker process
		 */
		var initTicker = function(){
			var startPosition = 0;
			// if autoDirection is "next", append a clone of the entire slider
			if(slider.settings.autoDirection === 'next'){
				el.append(slider.children.clone().addClass('bx-clone'));
			// if autoDirection is "prev", prepend a clone of the entire slider, and set the left position
			}else{
				el.prepend(slider.children.clone().addClass('bx-clone'));
				var position = slider.children.first().position();
				startPosition = slider.settings.mode === 'horizontal' ? -position.left : -position.top;
			}
			setPositionProperty(startPosition, 'reset', 0);
			// do not allow controls in ticker mode
			slider.settings.pager = false;
			slider.settings.controls = false;
			slider.settings.autoControls = false;
			// if autoHover is requested
			if(slider.settings.tickerHover){
				if(slider.usingCSS){
					var value;
					var idx = slider.settings.mode == 'horizontal' ? 4 : 5;
					slider.viewport.hover(function(){
						var transform = el.css('-' + slider.cssPrefix + '-transform');
						value = parseFloat(transform.split(',')[idx]);
						setPositionProperty(value, 'reset', 0);
					}, function(){
						var totalDimens = 0;
						slider.children.each(function(index){
						  totalDimens += slider.settings.mode == 'horizontal' ? $(this).outerWidth(true) : $(this).outerHeight(true);
						});
						// calculate the speed ratio (used to determine the new speed to finish the paused animation)
						var ratio = slider.settings.speed / totalDimens;
						// determine which property to use
						var property = slider.settings.mode == 'horizontal' ? 'left' : 'top';
						// calculate the new speed
						var newSpeed = ratio * (totalDimens - (Math.abs(parseInt(value))));
						tickerLoop(newSpeed);
					});
				} else {
					// on el hover
					slider.viewport.hover(function(){
						el.stop();
					}, function(){
						// calculate the total width of children (used to calculate the speed ratio)
						var totalDimens = 0;
						slider.children.each(function(index){
						  totalDimens += slider.settings.mode == 'horizontal' ? $(this).outerWidth(true) : $(this).outerHeight(true);
						});
						// calculate the speed ratio (used to determine the new speed to finish the paused animation)
						var ratio = slider.settings.speed / totalDimens;
						// determine which property to use
						var property = slider.settings.mode == 'horizontal' ? 'left' : 'top';
						// calculate the new speed
						var newSpeed = ratio * (totalDimens - (Math.abs(parseInt(el.css(property)))));
						tickerLoop(newSpeed);
					});
				}
			}
			// start the ticker loop
			tickerLoop();
		};

		/**
		 * Runs a continuous loop, news ticker-style
		 */
		var tickerLoop = function(resumeSpeed){
			speed = resumeSpeed ? resumeSpeed : slider.settings.speed;
			var position = {left: 0, top: 0};
			var reset = {left: 0, top: 0};
			// if "next" animate left position to last child, then reset left to 0
			if(slider.settings.autoDirection === 'next'){
				position = el.find('.bx-clone').first().position();
			// if "prev" animate left position to 0, then reset left to first non-clone child
			}else{
				reset = slider.children.first().position();
			}
			var animateProperty = slider.settings.mode === 'horizontal' ? -position.left : -position.top;
			var resetValue = slider.settings.mode === 'horizontal' ? -reset.left : -reset.top;
			var params = {resetValue: resetValue};
			setPositionProperty(animateProperty, 'ticker', speed, params);
		};

		/**
		 * Check if el is on screen
		 */
		var isOnScreen = function(el){
			var win = $(window);
			var viewport = {
				top : win.scrollTop(),
				left : win.scrollLeft()
			};
			viewport.right = viewport.left + win.width();
			viewport.bottom = viewport.top + win.height();

			var bounds = el.offset();
			bounds.right = bounds.left + el.outerWidth();
			bounds.bottom = bounds.top + el.outerHeight();

			return (!(viewport.right < bounds.left || viewport.left > bounds.right || viewport.bottom < bounds.top || viewport.top > bounds.bottom));
		};

		/**
		 * Initializes keyboard events
		 */
		var keyPress = function(e){
			var activeElementTag = document.activeElement.tagName.toLowerCase();
			var tagFilters='input|textarea';
			var p = new RegExp(activeElementTag,["i"]);
			var result = p.exec(tagFilters);
			if (result == null && isOnScreen(el)) {
				if (e.keyCode == 39) {
					clickNextBind(e);
					return false;
				}
				else if (e.keyCode == 37) {
					clickPrevBind(e);
					return false;
				}
			}
		};

		/**
		 * Initializes touch events
		 */
		var initTouch = function(){
			// initialize object to contain all touch values
			slider.touch = {
				start: {x: 0, y: 0},
				end: {x: 0, y: 0}
			};
			slider.viewport.bind('touchstart MSPointerDown pointerdown', onTouchStart);
			
			//for browsers that have implemented pointer events and fire a click after
			//every pointerup regardless of whether pointerup is on same screen location as pointerdown or not
			slider.viewport.on('click', '.bxslider a', function(e) {
				if (slider.viewport.hasClass('click-disabled')) {
					e.preventDefault();
					slider.viewport.removeClass('click-disabled');
				}
			});
		};

		/**
		 * Event handler for "touchstart"
		 *
		 * @param e (event)
		 *  - DOM event object
		 */
		var onTouchStart = function(e){
			//disable slider controls while user is interacting with slides to avoid slider freeze that happens on touch devices when a slide swipe happens immediately after interacting with slider controls
			slider.controls.el.addClass('disabled');

			if(slider.working){
				e.preventDefault();
				slider.controls.el.removeClass('disabled');
			}else{
				// record the original position when touch starts
				slider.touch.originalPos = el.position();
				var orig = e.originalEvent;
				var touchPoints = (typeof orig.changedTouches != 'undefined') ? orig.changedTouches : [orig];
				// record the starting touch x, y coordinates
				slider.touch.start.x = touchPoints[0].pageX;
				slider.touch.start.y = touchPoints[0].pageY;

				if (slider.viewport.get(0).setPointerCapture) {
					slider.pointerId = orig.pointerId;
					slider.viewport.get(0).setPointerCapture(slider.pointerId);
				}
				// bind a "touchmove" event to the viewport
				slider.viewport.bind('touchmove MSPointerMove pointermove', onTouchMove);
				// bind a "touchend" event to the viewport
				slider.viewport.bind('touchend MSPointerUp pointerup', onTouchEnd);
				slider.viewport.bind('MSPointerCancel pointercancel', onPointerCancel);
			}
		};

		/**
		 * Cancel Pointer for Windows Phone
		 *
		 * @param e (event)
		 *  - DOM event object
		 */
		var onPointerCancel = function(e) {
		/* onPointerCancel handler is needed to deal with situations when a touchend
		doesn't fire after a touchstart (this happens on windows phones only) */
			setPositionProperty(slider.touch.originalPos.left, 'reset', 0);

			//remove handlers
			slider.controls.el.removeClass('disabled');
			slider.viewport.unbind('MSPointerCancel pointercancel', onPointerCancel);
			slider.viewport.unbind('touchmove MSPointerMove pointermove', onTouchMove);
			slider.viewport.unbind('touchend MSPointerUp pointerup', onTouchEnd);
			if (slider.viewport.get(0).releasePointerCapture) {
				slider.viewport.get(0).releasePointerCapture(slider.pointerId);
 			}
		}

		/**
		 * Event handler for "touchmove"
		 *
		 * @param e (event)
		 *  - DOM event object
		 */
		var onTouchMove = function(e){
			var orig = e.originalEvent;
			var touchPoints = (typeof orig.changedTouches != 'undefined') ? orig.changedTouches : [orig];
			// if scrolling on y axis, do not prevent default
			var xMovement = Math.abs(touchPoints[0].pageX - slider.touch.start.x);
			var yMovement = Math.abs(touchPoints[0].pageY - slider.touch.start.y);
			// x axis swipe
			if((xMovement * 3) > yMovement && slider.settings.preventDefaultSwipeX){
				e.preventDefault();
			// y axis swipe
			}else if((yMovement * 3) > xMovement && slider.settings.preventDefaultSwipeY){
				e.preventDefault();
			}
			if(slider.settings.mode !== 'fade' && slider.settings.oneToOneTouch){
				var value = 0, change = 0;
				// if horizontal, drag along x axis
				if(slider.settings.mode === 'horizontal'){
					change = touchPoints[0].pageX - slider.touch.start.x;
					value = slider.touch.originalPos.left + change;
				// if vertical, drag along y axis
				}else{
					change = touchPoints[0].pageY - slider.touch.start.y;
					value = slider.touch.originalPos.top + change;
				}
				setPositionProperty(value, 'reset', 0);
			}
		};

		/**
		 * Event handler for "touchend"
		 *
		 * @param e (event)
		 *  - DOM event object
		 */
		var onTouchEnd = function(e){
			slider.viewport.unbind('touchmove MSPointerMove pointermove', onTouchMove);
			//enable slider controls as soon as user stops interacing with slides
			slider.controls.el.removeClass('disabled');
			var orig = e.originalEvent;
			var touchPoints = (typeof orig.changedTouches != 'undefined') ? orig.changedTouches : [orig];
			var value = 0;
			var distance = 0;
			// record end x, y positions
			slider.touch.end.x = touchPoints[0].pageX;
			slider.touch.end.y = touchPoints[0].pageY;
			// if fade mode, check if absolute x distance clears the threshold
			if(slider.settings.mode === 'fade'){
				distance = Math.abs(slider.touch.start.x - slider.touch.end.x);
				if(distance >= slider.settings.swipeThreshold){
					if(slider.touch.start.x > slider.touch.end.x){
						el.goToNextSlide();
					} else {
						el.goToPrevSlide();
					} 
					el.stopAuto();
				}
			// not fade mode
			}else{
				// calculate distance and el's animate property
				if(slider.settings.mode === 'horizontal'){
					distance = slider.touch.end.x - slider.touch.start.x;
					value = slider.touch.originalPos.left;
				}else{
					distance = slider.touch.end.y - slider.touch.start.y;
					value = slider.touch.originalPos.top;
				}
				// if not infinite loop and first / last slide, do not attempt a slide transition
				if(!slider.settings.infiniteLoop && ((slider.active.index === 0 && distance > 0) || (slider.active.last && distance < 0))){
					setPositionProperty(value, 'reset', 200);
				}else{
					// check if distance clears threshold
					if(Math.abs(distance) >= slider.settings.swipeThreshold){
						if(distance < 0){
							el.goToNextSlide();
						} else {
							el.goToPrevSlide();
						} 
						el.stopAuto();
					}else{
						// el.animate(property, 200);
						setPositionProperty(value, 'reset', 200);
					}
				}
			}
			slider.viewport.unbind('touchend MSPointerUp pointerup', onTouchEnd);
			if (slider.viewport.get(0).releasePointerCapture) {
				slider.viewport.get(0).releasePointerCapture(slider.pointerId);
			}
		};

		/**
		 * Window resize event callback
		 */
		var resizeWindow = function(e){
			// don't do anything if slider isn't initialized.
			if(!slider.initialized){ return; }
			// Delay if slider working.
			if (slider.working) {
				window.setTimeout(resizeWindow, 10);
			} else {
				// get the new window dimens (again, thank you IE)
				var windowWidthNew = $(window).width();
				var windowHeightNew = $(window).height();
				// make sure that it is a true window resize
				// *we must check this because our dinosaur friend IE fires a window resize event when certain DOM elements
				// are resized. Can you just die already?*
				if(windowWidth !== windowWidthNew || windowHeight !== windowHeightNew){
					// set the new window dimens
					windowWidth = windowWidthNew;
					windowHeight = windowHeightNew;
					// update all dynamic elements
					el.redrawSlider();
					// Call user resize handler
					slider.settings.onSliderResize.call(el, slider.active.index);
				}
			}
		};

		/**
		 * ===================================================================================
		 * = PUBLIC FUNCTIONS
		 * ===================================================================================
		 */

		/**
		 * Performs slide transition to the specified slide
		 *
		 * @param slideIndex (int)
		 *  - the destination slide's index (zero-based)
		 *
		 * @param direction (string)
		 *  - INTERNAL USE ONLY - the direction of travel ("prev" / "next")
		 */
		el.goToSlide = function(slideIndex, direction){
			// if plugin is currently in motion, ignore request
			if(slider.working || slider.active.index === slideIndex){ return; }
			// declare that plugin is in motion
			slider.working = true;
			// store the old index
			slider.oldIndex = slider.active.index;
			// if slideIndex is less than zero, set active index to last child (this happens during infinite loop)
			if(slideIndex < 0){
				slider.active.index = getPagerQty() - 1;
			// if slideIndex is greater than children length, set active index to 0 (this happens during infinite loop)
			}else if(slideIndex >= getPagerQty()){
				slider.active.index = 0;
			// set active index to requested slide
			}else{
				slider.active.index = slideIndex;
			}
			// onSlideBefore, onSlideNext, onSlidePrev callbacks
			// Allow transition canceling based on returned value
			var performTransition = true;

			performTransition = slider.settings.onSlideBefore(slider.children.eq(slider.active.index), slider.oldIndex, slider.active.index);
			
			if ( typeof(performTransition) !== "undefined" && !performTransition ) {
				slider.active.index = slider.oldIndex; // restore old index
				slider.working = false; // is not in motion
				return;	
			}
			if(direction === 'next'){
				// Prevent canceling in future functions or lack there-of from negating previous commands to cancel
				if(!slider.settings.onSlideNext(slider.children.eq(slider.active.index), slider.oldIndex, slider.active.index)){
					performTransition = false;
				}
			}else if(direction === 'prev'){
				// Prevent canceling in future functions or lack there-of from negating previous commands to cancel
				if(!slider.settings.onSlidePrev(slider.children.eq(slider.active.index), slider.oldIndex, slider.active.index)){
					performTransition = false;
				}
			}

			// If transitions canceled, reset and return
			if ( typeof(performTransition) !== "undefined" && !performTransition ) {
				slider.active.index = slider.oldIndex; // restore old index
				slider.working = false; // is not in motion
				return;	
			}

			// check if last slide
			slider.active.last = slider.active.index >= getPagerQty() - 1;
			// update the pager with active class
			if(slider.settings.pager || slider.settings.pagerCustom){ updatePagerActive(slider.active.index); }
			// // check for direction control update
			if(slider.settings.controls){ updateDirectionControls(); }
			// if slider is set to mode: "fade"
			if(slider.settings.mode === 'fade'){
				// if adaptiveHeight is true and next height is different from current height, animate to the new height
				if(slider.settings.adaptiveHeight && slider.viewport.height() !== getViewportHeight()){
					slider.viewport.animate({height: getViewportHeight()}, slider.settings.adaptiveHeightSpeed);
				}
				// fade out the visible child and reset its z-index value
				slider.children.filter(':visible').fadeOut(slider.settings.speed).css({zIndex: 0});
				// fade in the newly requested slide
				slider.children.eq(slider.active.index).css('zIndex', slider.settings.slideZIndex+1).fadeIn(slider.settings.speed, function(){
					$(this).css('zIndex', slider.settings.slideZIndex);
					updateAfterSlideTransition();
				});
			// slider mode is not "fade"
			}else{
				// if adaptiveHeight is true and next height is different from current height, animate to the new height
				if(slider.settings.adaptiveHeight && slider.viewport.height() !== getViewportHeight()){
					slider.viewport.animate({height: getViewportHeight()}, slider.settings.adaptiveHeightSpeed);
				}
				var moveBy = 0;
				var position = {left: 0, top: 0};
				var lastChild = null;
				// if carousel and not infinite loop
				if(!slider.settings.infiniteLoop && slider.carousel && slider.active.last){
					if(slider.settings.mode === 'horizontal'){
						// get the last child position
						lastChild = slider.children.eq(slider.children.length - 1);
						position = lastChild.position();
						// calculate the position of the last slide
						moveBy = slider.viewport.width() - lastChild.outerWidth();
					}else{
						// get last showing index position
						var lastShowingIndex = slider.children.length - slider.settings.minSlides;
						position = slider.children.eq(lastShowingIndex).position();
					}
					// horizontal carousel, going previous while on first slide (infiniteLoop mode)
				}else if(slider.carousel && slider.active.last && direction === 'prev'){
					// get the last child position
					var eq = slider.settings.moveSlides === 1 ? slider.settings.maxSlides - getMoveBy() : ((getPagerQty() - 1) * getMoveBy()) - (slider.children.length - slider.settings.maxSlides);
					lastChild = el.children('.bx-clone').eq(eq);
					position = lastChild.position();
				// if infinite loop and "Next" is clicked on the last slide
				}else if(direction === 'next' && slider.active.index === 0){
					// get the last clone position
					position = el.find('> .bx-clone').eq(slider.settings.maxSlides).position();
					slider.active.last = false;
				// normal non-zero requests
				}else if(slideIndex >= 0){
					var requestEl = slideIndex * getMoveBy();
					position = slider.children.eq(requestEl).position();
				}

				
				/* If the position doesn't exist
				 * (e.g. if you destroy the slider on a next click),
				 * it doesn't throw an error.
				 */
				if("undefined" !== typeof(position)){
					var value = slider.settings.mode === 'horizontal' ? -(position.left - moveBy) : -position.top;
					// plugin values to be animated
					setPositionProperty(value, 'slide', slider.settings.speed);
				}
			}
		};

		/**
		 * Transitions to the next slide in the show
		 */
		el.goToNextSlide = function(){
			// if infiniteLoop is false and last page is showing, disregard call
			if(!slider.settings.infiniteLoop && slider.active.last){ return; }
			var pagerIndex = parseInt(slider.active.index) + 1;
			el.goToSlide(pagerIndex, 'next');
		};

		/**
		 * Transitions to the prev slide in the show
		 */
		el.goToPrevSlide = function(){
			// if infiniteLoop is false and last page is showing, disregard call
			if(!slider.settings.infiniteLoop && slider.active.index === 0){ return; }
			var pagerIndex = parseInt(slider.active.index) - 1;
			el.goToSlide(pagerIndex, 'prev');
		};

		/**
		 * Starts the auto show
		 *
		 * @param preventControlUpdate (boolean)
		 *  - if true, auto controls state will not be updated
		 */
		el.startAuto = function(preventControlUpdate){
			// if an interval already exists, disregard call
			if(slider.interval){ return; }
			// create an interval
			slider.interval = setInterval(function(){
				if(slider.settings.autoDirection === 'next'){ 
					el.goToNextSlide(); 
				}else{
					el.goToPrevSlide();
				}
			}, slider.settings.pause);
			// if auto controls are displayed and preventControlUpdate is not true
			if(slider.settings.autoControls && preventControlUpdate !== true){ updateAutoControls('stop'); }
		};

		/**
		 * Stops the auto show
		 *
		 * @param preventControlUpdate (boolean)
		 *  - if true, auto controls state will not be updated
		 */
		el.stopAuto = function(preventControlUpdate){
			// if no interval exists, disregard call
			if(!slider.interval){ return; }
			// clear the interval
			clearInterval(slider.interval);
			slider.interval = null;
			// if auto controls are displayed and preventControlUpdate is not true
			if(slider.settings.autoControls && preventControlUpdate !== true){ updateAutoControls('start'); }
		};

		/**
		 * Returns current slide index (zero-based)
		 */
		el.getCurrentSlide = function(){
			return slider.active.index;
		};

		/**
		 * Returns current slide element
		 */
		el.getCurrentSlideElement = function(){
			return slider.children.eq(slider.active.index);
		};

		/**
		 * Returns number of slides in show
		 */
		el.getSlideCount = function(){
			return slider.children.length;
		};

		/**
		 * Return slider.working variable
		 */
		el.isWorking = function() {
			return slider.working;
		}

		/**
		 * Update all dynamic slider elements
		 */
		el.redrawSlider = function(){
			// resize all children in ratio to new screen size
			slider.children.add(el.find('.bx-clone')).outerWidth(getSlideWidth());
			// adjust the height
			slider.viewport.css('height', getViewportHeight());
			// update the slide position
			if(!slider.settings.ticker) { setSlidePosition(); }                 
			// if active.last was true before the screen resize, we want
			// to keep it last no matter what screen size we end on
			if (slider.active.last) { slider.active.index = getPagerQty() - 1; }
			// if the active index (page) no longer exists due to the resize, simply set the index as last
			if (slider.active.index >= getPagerQty()) { slider.active.last = true; }
			// if a pager is being displayed and a custom pager is not being used, update it
			if(slider.settings.pager && !slider.settings.pagerCustom){
				populatePager();
				updatePagerActive(slider.active.index);
			}
		};

		/**
		 * Destroy the current instance of the slider (revert everything back to original state)
		 */
		el.destroySlider = function(){
			// don't do anything if slider has already been destroyed
			if(!slider.initialized){ return; }
			slider.initialized = false;
			$('.bx-clone', this).remove();
			slider.children.each(function(){
				if($(this).data("origStyle") !== undefined){
					$(this).attr("style", $(this).data("origStyle"));
				} else {
					$(this).removeAttr('style');
				}
			});
			if($(this).data("origStyle") !== undefined){
				this.attr("style", $(this).data("origStyle"));
			} else {
				$(this).removeAttr('style');
			}
			$(this).unwrap().unwrap();
			if(slider.controls.el){ slider.controls.el.remove(); }
			if(slider.controls.next){ slider.controls.next.remove(); }
			if(slider.controls.prev){ slider.controls.prev.remove(); }
			if(slider.pagerEl && slider.settings.controls && !slider.settings.pagerCustom){ slider.pagerEl.remove(); }
			$('.bx-caption', this).remove();
			if(slider.controls.autoEl){ slider.controls.autoEl.remove(); }
			clearInterval(slider.interval);
			if(slider.settings.responsive){ $(window).unbind('resize', resizeWindow); }
			if(slider.settings.keyboardEnabled){ $(document).unbind('keydown', keyPress); }
		};

		/**
		 * Reload the slider (revert all DOM changes, and re-initialize)
		 */
		el.reloadSlider = function(settings){
			if(settings !== undefined){ options = settings; }
			el.destroySlider();
			init();
		};

		init();

		// returns the current jQuery object
		return this;
	};

})(jQuery);

/**
 * Lightbox v2.7.1
 * by Lokesh Dhakar - http://lokeshdhakar.com/projects/lightbox2/
 *
 * @license http://creativecommons.org/licenses/by/2.5/
 * - Free for use in both personal and commercial projects
 * - Attribution requires leaving author name, author link, and the license info intact
 */

(function() {
  // Use local alias
  var $ = jQuery;

  var LightboxOptions = (function() {
    function LightboxOptions() {
      this.fadeDuration                = 500;
      this.fitImagesInViewport         = true;
      this.resizeDuration              = 700;
      this.positionFromTop             = 50;
      this.showImageNumberLabel        = true;
      this.alwaysShowNavOnTouchDevices = false;
      this.wrapAround                  = false;
    }
    
    // Change to localize to non-english language
    LightboxOptions.prototype.albumLabel = function(curImageNum, albumSize) {
      return "Image " + curImageNum + " of " + albumSize;
    };

    return LightboxOptions;
  })();


  var Lightbox = (function() {
    function Lightbox(options) {
      this.options           = options;
      this.album             = [];
      this.currentImageIndex = void 0;
      this.init();
    }

    Lightbox.prototype.init = function() {
      this.enable();
      this.build();
    };

    // Loop through anchors and areamaps looking for either data-lightbox attributes or rel attributes
    // that contain 'lightbox'. When these are clicked, start lightbox.
    Lightbox.prototype.enable = function() {
      var self = this;
      $('body').on('click', 'a[rel^=lightbox], area[rel^=lightbox], a[data-lightbox], area[data-lightbox]', function(event) {
        self.start($(event.currentTarget));
        return false;
      });
    };

    // Build html for the lightbox and the overlay.
    // Attach event handlers to the new DOM elements. click click click
    Lightbox.prototype.build = function() {
      var self = this;
      $("<div id='lightboxOverlay' class='lightboxOverlay'></div><div id='lightbox' class='lightbox'><div class='lb-outerContainer'><div class='lb-container'><img class='lb-image' src='' /><div class='lb-nav'><a class='lb-prev' href='' ></a><a class='lb-next' href='' ></a></div><div class='lb-loader'><a class='lb-cancel'></a></div></div></div><div class='lb-dataContainer'><div class='lb-data'><div class='lb-details'><span class='lb-caption'></span><span class='lb-number'></span></div><div class='lb-closeContainer'><a class='lb-close'></a></div></div></div></div>").appendTo($('body'));
      
      // Cache jQuery objects
      this.$lightbox       = $('#lightbox');
      this.$overlay        = $('#lightboxOverlay');
      this.$outerContainer = this.$lightbox.find('.lb-outerContainer');
      this.$container      = this.$lightbox.find('.lb-container');

      // Store css values for future lookup
      this.containerTopPadding = parseInt(this.$container.css('padding-top'), 10);
      this.containerRightPadding = parseInt(this.$container.css('padding-right'), 10);
      this.containerBottomPadding = parseInt(this.$container.css('padding-bottom'), 10);
      this.containerLeftPadding = parseInt(this.$container.css('padding-left'), 10);
      
      // Attach event handlers to the newly minted DOM elements
      this.$overlay.hide().on('click', function() {
        self.end();
        return false;
      });

      this.$lightbox.hide().on('click', function(event) {
        if ($(event.target).attr('id') === 'lightbox') {
          self.end();
        }
        return false;
      });

      this.$outerContainer.on('click', function(event) {
        if ($(event.target).attr('id') === 'lightbox') {
          self.end();
        }
        return false;
      });

      this.$lightbox.find('.lb-prev').on('click', function() {
        if (self.currentImageIndex === 0) {
          self.changeImage(self.album.length - 1);
        } else {
          self.changeImage(self.currentImageIndex - 1);
        }
        return false;
      });

      this.$lightbox.find('.lb-next').on('click', function() {
        if (self.currentImageIndex === self.album.length - 1) {
          self.changeImage(0);
        } else {
          self.changeImage(self.currentImageIndex + 1);
        }
        return false;
      });

      this.$lightbox.find('.lb-loader, .lb-close').on('click', function() {
        self.end();
        return false;
      });
    };

    // Show overlay and lightbox. If the image is part of a set, add siblings to album array.
    Lightbox.prototype.start = function($link) {
      var self    = this;
      var $window = $(window);

      $window.on('resize', $.proxy(this.sizeOverlay, this));

      $('select, object, embed').css({
        visibility: "hidden"
      });

      this.sizeOverlay();

      this.album = [];
      var imageNumber = 0;

      function addToAlbum($link) {
        self.album.push({
          link: $link.attr('href'),
          title: $link.attr('data-title') || $link.attr('title')
        });
      }

      // Support both data-lightbox attribute and rel attribute implementations
      var dataLightboxValue = $link.attr('data-lightbox');
      var $links;

      if (dataLightboxValue) {
        $links = $($link.prop("tagName") + '[data-lightbox="' + dataLightboxValue + '"]');
        for (var i = 0; i < $links.length; i = ++i) {
          addToAlbum($($links[i]));
          if ($links[i] === $link[0]) {
            imageNumber = i;
          }
        }
      } else {
        if ($link.attr('rel') === 'lightbox') {
          // If image is not part of a set
          addToAlbum($link);
        } else {
          // If image is part of a set
          $links = $($link.prop("tagName") + '[rel="' + $link.attr('rel') + '"]');
          for (var j = 0; j < $links.length; j = ++j) {
            addToAlbum($($links[j]));
            if ($links[j] === $link[0]) {
              imageNumber = j;
            }
          }
        }
      }
      
      // Position Lightbox
      var top  = $window.scrollTop() + this.options.positionFromTop;
      var left = $window.scrollLeft();
      this.$lightbox.css({
        top: top + 'px',
        left: left + 'px'
      }).fadeIn(this.options.fadeDuration);

      this.changeImage(imageNumber);
    };

    // Hide most UI elements in preparation for the animated resizing of the lightbox.
    Lightbox.prototype.changeImage = function(imageNumber) {
      var self = this;

      this.disableKeyboardNav();
      var $image = this.$lightbox.find('.lb-image');

      this.$overlay.fadeIn(this.options.fadeDuration);

      $('.lb-loader').fadeIn('slow');
      this.$lightbox.find('.lb-image, .lb-nav, .lb-prev, .lb-next, .lb-dataContainer, .lb-numbers, .lb-caption').hide();

      this.$outerContainer.addClass('animating');

      // When image to show is preloaded, we send the width and height to sizeContainer()
      var preloader = new Image();
      preloader.onload = function() {
        var $preloader, imageHeight, imageWidth, maxImageHeight, maxImageWidth, windowHeight, windowWidth;
        $image.attr('src', self.album[imageNumber].link);

        $preloader = $(preloader);

        $image.width(preloader.width);
        $image.height(preloader.height);
        
        if (self.options.fitImagesInViewport) {
          // Fit image inside the viewport.
          // Take into account the border around the image and an additional 10px gutter on each side.

          windowWidth    = $(window).width();
          windowHeight   = $(window).height();
          maxImageWidth  = windowWidth - self.containerLeftPadding - self.containerRightPadding - 20;
          maxImageHeight = windowHeight - self.containerTopPadding - self.containerBottomPadding - 120;

          // Is there a fitting issue?
          if ((preloader.width > maxImageWidth) || (preloader.height > maxImageHeight)) {
            if ((preloader.width / maxImageWidth) > (preloader.height / maxImageHeight)) {
              imageWidth  = maxImageWidth;
              imageHeight = parseInt(preloader.height / (preloader.width / imageWidth), 10);
              $image.width(imageWidth);
              $image.height(imageHeight);
            } else {
              imageHeight = maxImageHeight;
              imageWidth = parseInt(preloader.width / (preloader.height / imageHeight), 10);
              $image.width(imageWidth);
              $image.height(imageHeight);
            }
          }
        }
        self.sizeContainer($image.width(), $image.height());
      };

      preloader.src          = this.album[imageNumber].link;
      this.currentImageIndex = imageNumber;
    };

    // Stretch overlay to fit the viewport
    Lightbox.prototype.sizeOverlay = function() {
      this.$overlay
        .width($(window).width())
        .height($(document).height());
    };

    // Animate the size of the lightbox to fit the image we are showing
    Lightbox.prototype.sizeContainer = function(imageWidth, imageHeight) {
      var self = this;
      
      var oldWidth  = this.$outerContainer.outerWidth();
      var oldHeight = this.$outerContainer.outerHeight();
      var newWidth  = imageWidth + this.containerLeftPadding + this.containerRightPadding;
      var newHeight = imageHeight + this.containerTopPadding + this.containerBottomPadding;
      
      function postResize() {
        self.$lightbox.find('.lb-dataContainer').width(newWidth);
        self.$lightbox.find('.lb-prevLink').height(newHeight);
        self.$lightbox.find('.lb-nextLink').height(newHeight);
        self.showImage();
      }

      if (oldWidth !== newWidth || oldHeight !== newHeight) {
        this.$outerContainer.animate({
          width: newWidth,
          height: newHeight
        }, this.options.resizeDuration, 'swing', function() {
          postResize();
        });
      } else {
        postResize();
      }
    };

    // Display the image and it's details and begin preload neighboring images.
    Lightbox.prototype.showImage = function() {
      this.$lightbox.find('.lb-loader').hide();
      this.$lightbox.find('.lb-image').fadeIn('slow');
    
      this.updateNav();
      this.updateDetails();
      this.preloadNeighboringImages();
      this.enableKeyboardNav();
    };

    // Display previous and next navigation if appropriate.
    Lightbox.prototype.updateNav = function() {
      // Check to see if the browser supports touch events. If so, we take the conservative approach
      // and assume that mouse hover events are not supported and always show prev/next navigation
      // arrows in image sets.
      var alwaysShowNav = false;
      try {
        document.createEvent("TouchEvent");
        alwaysShowNav = (this.options.alwaysShowNavOnTouchDevices)? true: false;
      } catch (e) {}

      this.$lightbox.find('.lb-nav').show();

      if (this.album.length > 1) {
        if (this.options.wrapAround) {
          if (alwaysShowNav) {
            this.$lightbox.find('.lb-prev, .lb-next').css('opacity', '1');
          }
          this.$lightbox.find('.lb-prev, .lb-next').show();
        } else {
          if (this.currentImageIndex > 0) {
            this.$lightbox.find('.lb-prev').show();
            if (alwaysShowNav) {
              this.$lightbox.find('.lb-prev').css('opacity', '1');
            }
          }
          if (this.currentImageIndex < this.album.length - 1) {
            this.$lightbox.find('.lb-next').show();
            if (alwaysShowNav) {
              this.$lightbox.find('.lb-next').css('opacity', '1');
            }
          }
        }
      }
    };

    // Display caption, image number, and closing button.
    Lightbox.prototype.updateDetails = function() {
      var self = this;

      // Enable anchor clicks in the injected caption html.
      // Thanks Nate Wright for the fix. @https://github.com/NateWr
      if (typeof this.album[this.currentImageIndex].title !== 'undefined' && this.album[this.currentImageIndex].title !== "") {
        this.$lightbox.find('.lb-caption')
          .html(this.album[this.currentImageIndex].title)
          .fadeIn('fast')
          .find('a').on('click', function(event){
            location.href = $(this).attr('href');
          });
      }
    
      if (this.album.length > 1 && this.options.showImageNumberLabel) {
        this.$lightbox.find('.lb-number').text(this.options.albumLabel(this.currentImageIndex + 1, this.album.length)).fadeIn('fast');
      } else {
        this.$lightbox.find('.lb-number').hide();
      }
    
      this.$outerContainer.removeClass('animating');
    
      this.$lightbox.find('.lb-dataContainer').fadeIn(this.options.resizeDuration, function() {
        return self.sizeOverlay();
      });
    };

    // Preload previous and next images in set.
    Lightbox.prototype.preloadNeighboringImages = function() {
      if (this.album.length > this.currentImageIndex + 1) {
        var preloadNext = new Image();
        preloadNext.src = this.album[this.currentImageIndex + 1].link;
      }
      if (this.currentImageIndex > 0) {
        var preloadPrev = new Image();
        preloadPrev.src = this.album[this.currentImageIndex - 1].link;
      }
    };

    Lightbox.prototype.enableKeyboardNav = function() {
      $(document).on('keyup.keyboard', $.proxy(this.keyboardAction, this));
    };

    Lightbox.prototype.disableKeyboardNav = function() {
      $(document).off('.keyboard');
    };

    Lightbox.prototype.keyboardAction = function(event) {
      var KEYCODE_ESC        = 27;
      var KEYCODE_LEFTARROW  = 37;
      var KEYCODE_RIGHTARROW = 39;

      var keycode = event.keyCode;
      var key     = String.fromCharCode(keycode).toLowerCase();
      if (keycode === KEYCODE_ESC || key.match(/x|o|c/)) {
        this.end();
      } else if (key === 'p' || keycode === KEYCODE_LEFTARROW) {
        if (this.currentImageIndex !== 0) {
          this.changeImage(this.currentImageIndex - 1);
        } else if (this.options.wrapAround && this.album.length > 1) {
          this.changeImage(this.album.length - 1);
        }
      } else if (key === 'n' || keycode === KEYCODE_RIGHTARROW) {
        if (this.currentImageIndex !== this.album.length - 1) {
          this.changeImage(this.currentImageIndex + 1);
        } else if (this.options.wrapAround && this.album.length > 1) {
          this.changeImage(0);
        }
      }
    };

    // Closing time. :-(
    Lightbox.prototype.end = function() {
      this.disableKeyboardNav();
      $(window).off("resize", this.sizeOverlay);
      this.$lightbox.fadeOut(this.options.fadeDuration);
      this.$overlay.fadeOut(this.options.fadeDuration);
      $('select, object, embed').css({
        visibility: "visible"
      });
    };

    return Lightbox;

  })();

  $(function() {
    var options  = new LightboxOptions();
    var lightbox = new Lightbox(options);
  });

}).call(this);

/*!
 * money.js / fx() v0.2
 * Copyright 2014 Open Exchange Rates
 *
 * JavaScript library for realtime currency conversion and exchange rate calculation.
 *
 * Freely distributable under the MIT license.
 * Portions of money.js are inspired by or borrowed from underscore.js
 *
 * For details, examples and documentation:
 * http://openexchangerates.github.io/money.js/
 */
(function(root, undefined) {

	// Create a safe reference to the money.js object for use below.
	var fx = function(obj) {
		return new fxWrapper(obj);
	};

	// Current version.
	fx.version = '0.2';


	/* --- Setup --- */

	// fxSetup can be defined before loading money.js, to set the exchange rates and the base
	// (and default from/to) currencies - or the rates can be loaded in later if needed.
	var fxSetup = root.fxSetup || {
		rates : {},
		base : ""
	};

	// Object containing exchange rates relative to the fx.base currency, eg { "GBP" : "0.64" }
	fx.rates = fxSetup.rates;

	// Default exchange rate base currency (eg "USD"), which all the exchange rates are relative to
	fx.base = fxSetup.base;

	// Default from / to currencies for conversion via fx.convert():
	fx.settings = {
		from : fxSetup.from || fx.base,
		to : fxSetup.to || fx.base
	};


	/* --- Conversion --- */

	// The base function of the library: converts a value from one currency to another
	var convert = fx.convert = function(val, opts) {
		// Convert arrays recursively
		if (typeof val === 'object' && val.length) {
			for (var i = 0; i< val.length; i++ ) {
				val[i] = convert(val[i], opts);
			}
			return val;
		}

		// Make sure we gots some opts
		opts = opts || {};

		// We need to know the `from` and `to` currencies
		if( !opts.from ) opts.from = fx.settings.from;
		if( !opts.to ) opts.to = fx.settings.to;

		// Multiple the value by the exchange rate
		return val * getRate( opts.to, opts.from );
	};

	// Returns the exchange rate to `target` currency from `base` currency
	var getRate = function(to, from) {
		// Save bytes in minified version
		var rates = fx.rates;

		// Make sure the base rate is in the rates object:
		rates[fx.base] = 1;

		// Throw an error if either rate isn't in the rates array
		if ( !rates[to] || !rates[from] ) throw "fx error";

		// If `from` currency === fx.base, return the basic exchange rate for the `to` currency
		if ( from === fx.base ) {
			return rates[to];
		}

		// If `to` currency === fx.base, return the basic inverse rate of the `from` currency
		if ( to === fx.base ) {
			return 1 / rates[from];
		}

		// Otherwise, return the `to` rate multipled by the inverse of the `from` rate to get the
		// relative exchange rate between the two currencies
		return rates[to] * (1 / rates[from]);
	};


	/* --- OOP wrapper and chaining --- */

	// If fx(val) is called as a function, it returns a wrapped object that can be used OO-style
	var fxWrapper = function(val) {
		// Experimental: parse strings to pull out currency code and value:
		if ( typeof	val === "string" ) {
			this._v = parseFloat(val.replace(/[^0-9-.]/g, ""));
			this._fx = val.replace(/([^A-Za-z])/g, "");
		} else {
			this._v = val;
		}
	};

	// Expose `wrapper.prototype` as `fx.prototype`
	var fxProto = fx.prototype = fxWrapper.prototype;

	// fx(val).convert(opts) does the same thing as fx.convert(val, opts)
	fxProto.convert = function() {
		var args = Array.prototype.slice.call(arguments);
		args.unshift(this._v);
		return convert.apply(fx, args);
	};

	// fx(val).from(currency) returns a wrapped `fx` where the value has been converted from
	// `currency` to the `fx.base` currency. Should be followed by `.to(otherCurrency)`
	fxProto.from = function(currency) {
		var wrapped = fx(convert(this._v, {from: currency, to: fx.base}));
		wrapped._fx = fx.base;
		return wrapped;
	};

	// fx(val).to(currency) returns the value, converted from `fx.base` to `currency`
	fxProto.to = function(currency) {
		return convert(this._v, {from: this._fx ? this._fx : fx.settings.from, to: currency});
	};


	/* --- Module Definition --- */

	// Export the fx object for CommonJS. If being loaded as an AMD module, define it as such.
	// Otherwise, just add `fx` to the global object
	if (typeof exports !== 'undefined') {
		if (typeof module !== 'undefined' && module.exports) {
			exports = module.exports = fx;
		}
		exports.fx = fx;
	} else if (typeof define === 'function' && define.amd) {
		// Return the library as an AMD module:
		define([], function() {
			return fx;
		});
	} else {
		// Use fx.noConflict to restore `fx` back to its original value before money.js loaded.
		// Returns a reference to the library's `fx` object; e.g. `var money = fx.noConflict();`
		fx.noConflict = (function(previousFx) {
			return function() {
				// Reset the value of the root's `fx` variable:
				root.fx = previousFx;
				// Delete the noConflict function:
				fx.noConflict = undefined;
				// Return reference to the library to re-assign it:
				return fx;
			};
		})(root.fx);

		// Declare `fx` on the root (global/window) object:
		root['fx'] = fx;
	}

	// Root will be `window` in browser or `global` on the server:
}(this));

/*===================================================================================================================
 * @name: bPopup
 * @type: jQuery
 * @author: (c) Bjoern Klinggaard - @bklinggaard
 * @demo: http://dinbror.dk/bpopup
 * @version: 0.10.0
 * @requires jQuery 1.4.3
 *==================================================================================================================*/
;(function($) {
	'use strict';
	
    $.fn.bPopup = function(options, callback) {
        
    	if ($.isFunction(options)) {
            callback 		= options;
            options 		= null;
        }

		// OPTIONS
        var o 				= $.extend({}, $.fn.bPopup.defaults, options);
		
		// HIDE SCROLLBAR?  
        if (!o.scrollBar)
            $('html').css('overflow', 'hidden');
        
		// VARIABLES	
        var $popup 			= this
          ,  $this                       = $(this)
          , d 				= $(document)
          , w 				= window
		  , $w				= $(w)
          , wH				= windowHeight()
		  , wW				= windowWidth()
          , prefix			= '__b-popup'
		  , isIOS6X			= (/OS 6(_\d)+/i).test(navigator.userAgent) // Used for a temporary fix for ios6 timer bug when using zoom/scroll 
          , buffer			= 200
		  , popups			= 0
          , id
          , inside
          , fixedVPos
          , fixedHPos
          , fixedPosStyle
		  , vPos
          , hPos
		  , height
		  , width
		  , debounce
		  , autoCloseTO
		;

        /* PUBLIC FUNCTION - call it: $(element).bPopup().close();*/
        $popup.close = function() {
            _init();
            _close();
        };
		
        $popup.reposition = function(animateSpeed) {
            reposition(animateSpeed);
        };

        return $popup.each(function() {
            if ($(this).data('bPopup')) return; /*POPUP already exists?*/
            init();
        });

        function _init() {
            triggerCall(o.onOpen);
			popups = ($w.data('bPopup') || 0), 
                        id = prefix + popups + '__',
                        fixedVPos = o.position[1] !== 'auto', 
                        fixedHPos = o.position[0] !== 'auto', 
                        fixedPosStyle = o.positionStyle === 'fixed', 
                        height = $popup.outerHeight(true), 
                        width = $popup.outerWidth(true);
                
            // o.loadUrl ? createContent() : open();
        };
        
        function _close() {
            
            // alert(id, $popup.data('id'), $popup.data('bPopup'));
            if (o.modal) {
                $('.b-modal.'+id)
	                .fadeTo(o.speed, 0, function() {
	                    $(this).remove();
	                });
            }
            // Clean up
            unbindEvents();	
            clearTimeout(autoCloseTO);
            // Close trasition
            doTransition();
            
            return false; // Prevent default
        };

        /* HELPER FUNCTIONS - PRIVATE*/
        function init() {
            triggerCall(o.onOpen);
			popups = ($w.data('bPopup') || 0) + 1, id = prefix + popups + '__',fixedVPos = o.position[1] !== 'auto', fixedHPos = o.position[0] !== 'auto', fixedPosStyle = o.positionStyle === 'fixed', height = $popup.outerHeight(true), width = $popup.outerWidth(true);
            o.loadUrl ? createContent() : open();
        };
		
		function createContent() {
            o.contentContainer = $(o.contentContainer || $popup);
            switch (o.content) {
                case ('iframe'):
					var iframe = $('<iframe class="b-iframe" ' + o.iframeAttr +'></iframe>');
					iframe.appendTo(o.contentContainer);
					height = $popup.outerHeight(true);
					width = $popup.outerWidth(true);
					open();
					iframe.attr('src', o.loadUrl); // setting iframe src after open due IE9 bug
					triggerCall(o.loadCallback);
                    break;
				case ('image'):
					open();
					$('<img />')
						.load(function() {
						    triggerCall(o.loadCallback);
							recenter($(this));
					    }).attr('src', o.loadUrl).hide().appendTo(o.contentContainer);
					break;
                default:
					open();
					$('<div class="b-ajax-wrapper"></div>')
                    	.load(o.loadUrl, o.loadData, function(response, status, xhr) {
						    triggerCall(o.loadCallback, status);
							recenter($(this));
						}).hide().appendTo(o.contentContainer);
                    break;
            }
        };

		function open(){
			// MODAL OVERLAY
            if (o.modal) {
                $('<div class="b-modal '+id+'"></div>')
                .css({backgroundColor: o.modalColor, position: 'fixed', top: 0, right:0, bottom:0, left: 0, opacity: 0, zIndex: o.zIndex + popups})
                .appendTo(o.appendTo)
                .fadeTo(o.speed, o.opacity);
            }
			
			// POPUP
			calcPosition();
            $popup
				.data('bPopup', o).data('id',id)
				.css({ 
					  'left': o.transition == 'slideIn' || o.transition == 'slideBack' ? (o.transition == 'slideBack' ? d.scrollLeft() + wW : (hPos + width) *-1) : getLeftPos(!(!o.follow[0] && fixedHPos || fixedPosStyle))
					, 'position': o.positionStyle || 'absolute'
					, 'top': o.transition == 'slideDown' || o.transition == 'slideUp' ? (o.transition == 'slideUp' ? d.scrollTop() + wH : vPos + height * -1) : getTopPos(!(!o.follow[1] && fixedVPos || fixedPosStyle))
					, 'z-index': o.zIndex + popups + 1 
				}).each(function() {
            		if(o.appending) {
                                $(this).appendTo(o.appendTo);
            		}
        		});
			doTransition(true);	
		};
		
        function close() {
            // console.log(id, $popup.data('id'), $popup.data('bPopup'));
            
            // alert(id, $popup.data('id'), $popup.data('bPopup'));
            if (o.modal) {
                $('.b-modal.'+$popup.data('id'))
	                .fadeTo(o.speed, 0, function() {
	                    $(this).remove();
	                });
            }
            // Clean up
            unbindEvents();	
            clearTimeout(autoCloseTO);
            // Close trasition
            doTransition();
            
            return false; // Prevent default
        };
		
		function reposition(animateSpeed){
            wH = windowHeight();
  		    wW = windowWidth();
			inside = insideWindow();
           	if(inside){
				clearTimeout(debounce);
				debounce = setTimeout(function(){
					calcPosition();
					animateSpeed = animateSpeed || o.followSpeed;
					$popup
                       	.dequeue()
                       	.each(function() {
                           	if(fixedPosStyle) {
                            	$(this).css({ 'left': hPos, 'top': vPos });
                           	}
                           	else {
                               	$(this).animate({ 'left': o.follow[0] ? getLeftPos(true) : 'auto', 'top': o.follow[1] ? getTopPos(true) : 'auto' }, animateSpeed, o.followEasing);
                           	}
                       	});
				}, 50);					
           	}
		};
		
		//Eksperimental
		function recenter(content){
			var _width = content.width(), _height = content.height(), css = {};
			o.contentContainer.css({height:_height,width:_width});
			
			if (_height >= $popup.height()){
				css.height = $popup.height();
			}
			if(_width >= $popup.width()){
				css.width = $popup.width();
			}
			height = $popup.outerHeight(true)
			, width = $popup.outerWidth(true);
				
			calcPosition();
			o.contentContainer.css({height:'auto',width:'auto'});		
			
			css.left = getLeftPos(!(!o.follow[0] && fixedHPos || fixedPosStyle)),
			css.top = getTopPos(!(!o.follow[1] && fixedVPos || fixedPosStyle));
			
			$popup
				.animate(
					css
					, 250
					, function() { 
						content.show();
						inside = insideWindow();
					}
				);
		};
		
        function bindEvents() {
            $w.data('bPopup', popups);
			$popup.delegate('.bClose, .' + o.closeClass, 'click.'+id, close); // legacy, still supporting the close class bClose
            
            if (o.modalClose) {
                $('.b-modal.'+id).css('cursor', 'pointer').bind('click', close);
            }
			
			// Temporary disabling scroll/resize events on devices with IOS6+
			// due to a bug where events are dropped after pinch to zoom
            if (!isIOS6X && (o.follow[0] || o.follow[1])) {
               $w.bind('scroll.'+id, function() {
                	if(inside){
                    	$popup
                        	.dequeue()
                            .animate({ 'left': o.follow[0] ? getLeftPos(!fixedPosStyle) : 'auto', 'top': o.follow[1] ? getTopPos(!fixedPosStyle) : 'auto' }, o.followSpeed, o.followEasing);
					 }  
            	}).bind('resize.'+id, function() {
		            reposition();
                });
            }
            if (o.escClose) {
                d.bind('keydown.'+id, function(e) {
                    if (e.which == 27) {  //escape
                        close();
                    }
                });
            }
        };
		
        function unbindEvents() {
            if (!o.scrollBar) {
                $('html').css('overflow', 'auto');
            }
            $('.b-modal.'+id).unbind('click');
            d.unbind('keydown.'+id);
            $w.unbind('.'+id).data('bPopup', ($w.data('bPopup')-1 > 0) ? $w.data('bPopup')-1 : null);
            $popup.undelegate('.bClose, .' + o.closeClass, 'click.'+id, close).data('bPopup', null);
        };
		
		function doTransition(open) {
			switch (open ? o.transition : o.transitionClose || o.transition) {
			   case "slideIn":
				   	animate({
				   		left: open ? getLeftPos(!(!o.follow[0] && fixedHPos || fixedPosStyle)) : d.scrollLeft() - (width || $popup.outerWidth(true)) - buffer
				   	});
			      	break;
			   case "slideBack":
				   	animate({
				   		left: open ? getLeftPos(!(!o.follow[0] && fixedHPos || fixedPosStyle)) : d.scrollLeft() + wW + buffer
				   	});
			      	break;
			   case "slideDown":
				   	animate({
				   		top: open ? getTopPos(!(!o.follow[1] && fixedVPos || fixedPosStyle)) : d.scrollTop() - (height || $popup.outerHeight(true)) - buffer
				   	});
			      	break;
		   		case "slideUp":
					animate({
						top: open ? getTopPos(!(!o.follow[1] && fixedVPos || fixedPosStyle)) : d.scrollTop() + wH + buffer
					});
		      	  	break;
                                
                        case "fadeOut": 
                                $this.hide();
                                $popup.stop().fadeOut(o.speed);
                            break;
			   default:
			   	  	//Hardtyping 1 and 0 to ensure opacity 1 and not 0.9999998
				  	$popup.stop().fadeTo(o.speed, open ? 1 : 0, function(){onCompleteCallback(open);});
			}
			
			function animate(css){
			  	$popup
					.css({display: 'block',opacity: 1})
					.animate(css, o.speed, o.easing, function(){ onCompleteCallback(open); });
			};
		};
		
		
		function onCompleteCallback(open){
			if(open){
				bindEvents();
	            triggerCall(callback);
				if(o.autoClose){
					autoCloseTO = setTimeout(close, o.autoClose);
				}
			} else {
				$popup.hide();
				triggerCall(o.onClose);
				if (o.loadUrl) {
                    o.contentContainer.empty();
					$popup.css({height: 'auto', width: 'auto'});
                }		
			}
		};
		
		function getLeftPos(includeScroll){
			return includeScroll ? hPos + d.scrollLeft() : hPos;
		};
		
		function getTopPos(includeScroll){
			return includeScroll ? vPos + d.scrollTop() : vPos;
		};
		
		function triggerCall(func, arg) {
			$.isFunction(func) && func.call($popup, arg);
		};
		
       	function calcPosition(){
			vPos 		= fixedVPos ? o.position[1] : Math.max(0, ((wH- $popup.outerHeight(true)) / 2) - o.amsl)
			, hPos 		= fixedHPos ? o.position[0] : (wW - $popup.outerWidth(true)) / 2
			, inside 	= insideWindow();
		};
		
        function insideWindow(){
            return wH > $popup.outerHeight(true) && wW > $popup.outerWidth(true);
        };
		
		function windowHeight(){
			return w.innerHeight || $w.height();
		};
		
		function windowWidth(){
			return w.innerWidth || $w.width();
		};
    };

	/* DEFAULT VALUES */
    $.fn.bPopup.defaults = {
          amsl: 			50
        , appending: 		true
        , appendTo: 		'body'
		, autoClose:		false
        , closeClass: 		'b-close'
        , content: 			'ajax' // ajax, iframe or image
        , contentContainer: false
		, easing: 			'swing'
        , escClose: 		true
        , follow: 			[true, true] // x, y
		, followEasing: 	'swing'
        , followSpeed: 		500
		, iframeAttr: 		'scrolling="no" frameborder="0"'
		, loadCallback: 	false
		, loadData: 		false
        , loadUrl: 			false
        , modal: 			true
        , modalClose: 		true
        , modalColor: 		'#000'
        , onClose: 			false
        , onOpen: 			false
        , opacity: 			0.7
        , position: 		['auto', 'auto'] // x, y,
        , positionStyle: 	'absolute'// absolute or fixed
        , scrollBar: 		true
		, speed: 			250 // open & close speed
		, transition:		'fadeIn' //transitions: fadeIn, slideDown, slideIn, slideBack
		, transitionClose:	false
        , zIndex: 			9997 // popup gets z-index 9999, modal overlay 9998
    };
})(jQuery);

/* ===========================================================
 * jquery.autofix_anything.js v1
 * ===========================================================
 * Copyright 2013 Pete Rojwongsuriya.
 * http://www.thepetedesign.com
 *
 * Fix position of anything on your website automatically
 * with one js call
 *
 * https://github.com/peachananr/autofix_anything
 *
 * ========================================================== */

!function($){
  
  var defaults = {
    customOffset: false,
    manual: false,
    onlyInContainer: true
	};

  $.fn.autofix_anything = function(options){
    var settings = $.extend({}, defaults, options),
        el = $(this),
        curpos = el.position(),
        offset = settings.customOffset,
        pos = el.offset();
        
    el.addClass("autofix_sb")  
    
    $.fn.manualfix = function() {
      var el = $(this),
          pos = el.offset();
      if (el.hasClass("fixed")) {
        el.removeClass("fixed")
      } else {
        el.addClass("fixed").css({
          top: 0,
          left: pos.left,
          right: "auto",
          bottom: "auto"
        });
      }
      
    }
    
    fixAll = function(el, settings, curpos, pos){
      if (settings.customOffset == false) offset =  el.parent().offset().top
      if($(document).scrollTop() > offset && $(document).scrollTop() <= (el.parent().height() + (offset - $(window).height())))  {
          el.removeClass("bottom").addClass("fixed").css({
            top: 0,
            left: pos.left,
            right: "auto",
            bottom: "auto"
          });
      } else {
        if($(document).scrollTop() > offset) {
          if (settings.onlyInContainer == true ) {
            if($(document).scrollTop() > (el.parent().height() - $(window).height())) {
              el.addClass("bottom fixed").removeAttr( 'style' ).css({
                left: curpos.left
              });
            }else {
              el.removeClass("bottom fixed").removeAttr( 'style' );

            }
          }
        } else {
          el.removeClass("bottom fixed").removeAttr( 'style' );
        }
      }
    
    }
    if (settings.manual == false) {
      $(window).scroll(function() {
        fixAll(el, settings, curpos, pos)
      });
    }
    

  }
}(window.jQuery);


// Generated by CoffeeScript 1.9.2

/**
@license Sticky-kit v1.1.2 | WTFPL | Leaf Corcoran 2015 | http://leafo.net
 */
(function() {
  var $, win;

  $ = this.jQuery || window.jQuery;

  win = $(window);

  $.fn.stick_in_parent = function(opts) {
    var doc, elm, enable_bottoming, fn, i, inner_scrolling, len, manual_spacer, offset_top, outer_width, parent_selector, recalc_every, sticky_class;
    if (opts == null) {
      opts = {};
    }
    sticky_class = opts.sticky_class, inner_scrolling = opts.inner_scrolling, recalc_every = opts.recalc_every, parent_selector = opts.parent, offset_top = opts.offset_top, manual_spacer = opts.spacer, enable_bottoming = opts.bottoming;
    if (offset_top == null) {
      offset_top = 0;
    }
    if (parent_selector == null) {
      parent_selector = void 0;
    }
    if (inner_scrolling == null) {
      inner_scrolling = true;
    }
    if (sticky_class == null) {
      sticky_class = "is_stuck";
    }
    doc = $(document);
    if (enable_bottoming == null) {
      enable_bottoming = true;
    }
    outer_width = function(el) {
      var _el, computed, w;
      if (window.getComputedStyle) {
        _el = el[0];
        computed = window.getComputedStyle(el[0]);
        w = parseFloat(computed.getPropertyValue("width")) + parseFloat(computed.getPropertyValue("margin-left")) + parseFloat(computed.getPropertyValue("margin-right"));
        if (computed.getPropertyValue("box-sizing") !== "border-box") {
          w += parseFloat(computed.getPropertyValue("border-left-width")) + parseFloat(computed.getPropertyValue("border-right-width")) + parseFloat(computed.getPropertyValue("padding-left")) + parseFloat(computed.getPropertyValue("padding-right"));
        }
        return w;
      } else {
        return el.outerWidth(true);
      }
    };
    fn = function(elm, padding_bottom, parent_top, parent_height, top, height, el_float, detached) {
      var bottomed, detach, fixed, last_pos, last_scroll_height, offset, parent, recalc, recalc_and_tick, recalc_counter, spacer, tick;
      if (elm.data("sticky_kit")) {
        return;
      }
      elm.data("sticky_kit", true);
      last_scroll_height = doc.height();
      parent = elm.parent();
      if (parent_selector != null) {
        parent = parent.closest(parent_selector);
      }
      if (!parent.length) {
        throw "failed to find stick parent";
      }
      fixed = false;
      bottomed = false;
      spacer = manual_spacer != null ? manual_spacer && elm.closest(manual_spacer) : $("<div />");
      if (spacer) {
        spacer.css('position', elm.css('position'));
      }
      recalc = function() {
        var border_top, padding_top, restore;
        if (detached) {
          return;
        }
        last_scroll_height = doc.height();
        border_top = parseInt(parent.css("border-top-width"), 10);
        padding_top = parseInt(parent.css("padding-top"), 10);
        padding_bottom = parseInt(parent.css("padding-bottom"), 10);
        parent_top = parent.offset().top + border_top + padding_top;
        parent_height = parent.height();
        if (fixed) {
          fixed = false;
          bottomed = false;
          if (manual_spacer == null) {
            elm.insertAfter(spacer);
            spacer.detach();
          }
          elm.css({
            position: "",
            top: "",
            width: "",
            bottom: ""
          }).removeClass(sticky_class);
          restore = true;
        }
        top = elm.offset().top - (parseInt(elm.css("margin-top"), 10) || 0) - offset_top;
        height = elm.outerHeight(true);
        el_float = elm.css("float");
        if (spacer) {
          spacer.css({
            width: outer_width(elm),
            height: height,
            display: elm.css("display"),
            "vertical-align": elm.css("vertical-align"),
            "float": el_float
          });
        }
        if (restore) {
          return tick();
        }
      };
      recalc();
      if (height === parent_height) {
        return;
      }
      last_pos = void 0;
      offset = offset_top;
      recalc_counter = recalc_every;
      tick = function() {
        var css, delta, recalced, scroll, will_bottom, win_height;
        if (detached) {
          return;
        }
        recalced = false;
        if (recalc_counter != null) {
          recalc_counter -= 1;
          if (recalc_counter <= 0) {
            recalc_counter = recalc_every;
            recalc();
            recalced = true;
          }
        }
        if (!recalced && doc.height() !== last_scroll_height) {
          recalc();
          recalced = true;
        }
        scroll = win.scrollTop();
        if (last_pos != null) {
          delta = scroll - last_pos;
        }
        last_pos = scroll;
        if (fixed) {
          if (enable_bottoming) {
            will_bottom = scroll + height + offset > parent_height + parent_top;
            if (bottomed && !will_bottom) {
              bottomed = false;
              elm.css({
                position: "fixed",
                bottom: "",
                top: offset
              }).trigger("sticky_kit:unbottom");
            }
          }
          if (scroll < top) {
            fixed = false;
            offset = offset_top;
            if (manual_spacer == null) {
              if (el_float === "left" || el_float === "right") {
                elm.insertAfter(spacer);
              }
              spacer.detach();
            }
            css = {
              position: "",
              width: "",
              top: ""
            };
            elm.css(css).removeClass(sticky_class).trigger("sticky_kit:unstick");
          }
          if (inner_scrolling) {
            win_height = win.height();
            if (height + offset_top > win_height) {
              if (!bottomed) {
                offset -= delta;
                offset = Math.max(win_height - height, offset);
                offset = Math.min(offset_top, offset);
                if (fixed) {
                  elm.css({
                    top: offset + "px"
                  });
                }
              }
            }
          }
        } else {
          if (scroll > top) {
            fixed = true;
            css = {
              position: "fixed",
              top: offset
            };
            css.width = elm.css("box-sizing") === "border-box" ? elm.outerWidth() + "px" : elm.width() + "px";
            elm.css(css).addClass(sticky_class);
            if (manual_spacer == null) {
              elm.after(spacer);
              if (el_float === "left" || el_float === "right") {
                spacer.append(elm);
              }
            }
            elm.trigger("sticky_kit:stick");
          }
        }
        if (fixed && enable_bottoming) {
          if (will_bottom == null) {
            will_bottom = scroll + height + offset > parent_height + parent_top;
          }
          if (!bottomed && will_bottom) {
            bottomed = true;
            if (parent.css("position") === "static") {
              parent.css({
                position: "relative"
              });
            }
            return elm.css({
              position: "absolute",
              bottom: padding_bottom,
              top: "auto"
            }).trigger("sticky_kit:bottom");
          }
        }
      };
      recalc_and_tick = function() {
        recalc();
        return tick();
      };
      detach = function() {
        detached = true;
        win.off("touchmove", tick);
        win.off("scroll", tick);
        win.off("resize", recalc_and_tick);
        $(document.body).off("sticky_kit:recalc", recalc_and_tick);
        elm.off("sticky_kit:detach", detach);
        elm.removeData("sticky_kit");
        elm.css({
          position: "",
          bottom: "",
          top: "",
          width: ""
        });
        parent.position("position", "");
        if (fixed) {
          if (manual_spacer == null) {
            if (el_float === "left" || el_float === "right") {
              elm.insertAfter(spacer);
            }
            spacer.remove();
          }
          return elm.removeClass(sticky_class);
        }
      };
      win.on("touchmove", tick);
      win.on("scroll", tick);
      win.on("resize", recalc_and_tick);
      $(document.body).on("sticky_kit:recalc", recalc_and_tick);
      elm.on("sticky_kit:detach", detach);
      return setTimeout(tick, 0);
    };
    for (i = 0, len = this.length; i < len; i++) {
      elm = this[i];
      fn($(elm));
    }
    return this;
  };

}).call(this);

/**
 * jQuery syncTranslit plugin
 *
 * Copyright (c) 2009 Snitko Roman
 * Dual licensed under the MIT (MIT-LICENSE.txt)
 * and GPL (GPL-LICENSE.txt) licenses.
 *
 * @author 	Roman Snitko snowcore.net@gmail.com
 * @link http://snowcore.net/
 * @version 0.0.7
 */
;(function($){
    $.fn.syncTranslit = function(options) {
        var opts = $.extend({}, $.fn.syncTranslit.defaults, options);
        if(opts.strtr) {
            return $.fn.syncTranslit.strtr( opts );
        }
        
        return this.each(function() {
            $this = $(this);
            var o = $.meta ? $.extend({}, opts, $this.data()) : opts;
            var $destination = $('#' + opts.destination);
            o.destinationObject = $destination;
            
            // IE always sucks :)
            if (!Array.indexOf) {
                Array.prototype.indexOf = function(obj) {
                    for (var i = 0; i < this.length; i++) {
                        if (this[i] == obj) {
                            return i;
                        }
                    }
                    return -1;
                }
            }
            
            $this.keyup(function(){
            	var str = $(this).val();
            	var result = '';
            	for (var i = 0; i < str.length; i++) {
            		result += $.fn.syncTranslit.transliterate(str.charAt(i), o)
            	}
            	var regExp = new RegExp('[' + o.urlSeparator + ']{2,}', 'g');
            	result = result.replace(regExp, o.urlSeparator);
            	$destination.val(result);
            })
        });
    };
    
    
    $.fn.syncTranslit.strtr = function(opts) {
        var text = (opts._text) ? opts._text : '';

        var result = '';
        for (var i = 0; i < text.length; i++) {
                result += $.fn.syncTranslit.transliterate(text.charAt(i), opts);
        }
        var regExp = new RegExp('[' + opts.urlSeparator + ']{2,}', 'g');
        result = result.replace(regExp, opts.urlSeparator);
        return result;
    }
    
    /**
     * Transliterate character
     * @param {String} character
     * @param {Object} opts
     */
    $.fn.syncTranslit.transliterate = function(char, opts) {
    	var charIsLowerCase = true, trChar;
    	if (char.toLowerCase() != char) {
    		charIsLowerCase = false;
    	}
    	
    	char = char.toLowerCase();
    	
    	var index = opts.dictOriginal.indexOf(char);
    	if (index == -1) {
    		trChar = char;
    	} else {
    		trChar = opts.dictTranslate[index];
    	}
    	
    	if (opts.type == 'url') {
	    	var code = trChar.charCodeAt(0);
                
                if(trChar == '.') { return '.'; } // fix 
                
	    	if (code >= 33  && code <= 47 && code != 45
	    		|| code >= 58  && code <= 64
	    		|| code >= 91  && code <= 96
	    		|| code >= 123 && code <= 126
	    		|| code >= 1072
	    	) {
	    		return '';
	    	}
	    	if (trChar == ' ' || trChar == '-') {
	    		return opts.urlSeparator;
	    	}
    	}
    	
    	if (opts.caseStyle == 'upper') {
    		return trChar.toUpperCase();
    	} else if (opts.caseStyle == 'normal') {
    		if (charIsLowerCase) {
    			return trChar.toLowerCase();
    		} else {
    			return trChar.toUpperCase();
    		}
    	}
	    return trChar;
    };
    
    /**
     * Default options
     */
    $.fn.syncTranslit.defaults = {
        /**
         * Dictionaries
         */
        dictOriginal:  ['', '', '', '', '', '',
                        '', '', '', '', '', '',
                        '', '', '', '', '', '',
                        '', '', '', '', '', '',
                        '', '', '', '', '', '',
                        '', '', '',
                        '', '', '', ''
                        ],
        dictTranslate: ['a', 'b', 'v', 'g', 'd', 'e',
                        'e', 'zh','z', 'i', 'j', 'k',
                        'l', 'm', 'n', 'o', 'p', 'r',
                        's', 't', 'u', 'f', 'h', 'ts',
                        'ch','sh','sch', '', 'y', '',
                        'e', 'ju', 'ja',
                        'i', 'je', 'ji', 'g'
                        ],
        
        /*
         * Case transformation: normal, lower, upper
         */
        caseStyle: 'lower',
        
        /*
         * Words separator in url
         */
        urlSeparator: '-',
        
        /*
         * Transliteration type: raw or url
         *    url - used for transliterating text into url slug
         *    raw - raw transliteration (with special characters)
         */
        type: 'url'
    };
})(jQuery);
$(document).ready(function(){ 
    var _email = new String($(".box-form-subscribe > form input.email").attr("name"));
    $('.box-form-subscribe > form').validate({
        onfocusout: false,
        onkeyup: false,
        onclick: true,
        onsubmit: true,
        focusInvalid: false,
        focusCleanup: false,        
        _email: {
            required: true,
            email: true
        },
        messages: {
            _email: {
                required: 'The Email field is empty',
                email: 'Well never share your email adress and you can opt out at any time, we promise.'
            }
        },

        errorClass: 'block-error',
        validClass: 'success',
        invalidHandler: function(event, validator) {
            if($('.box-form-subscribe > form .block-error').length)
                $('.box-form-subscribe > form .block-error').html( ' ' ).hide();
        },
        //  
        showErrors: function(errorMap, errorList) {
            var msg = '';
            $.each(errorList, function(){
                if(this.message) 
                    msg += this.message + '<br />'; 
             });

            if(msg !== '') 
                $('.box-form-subscribe > form .block-error').html(msg).show();
        },
    });
});    

/* 
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */

function isset(element) {
    if(typeof element != 'undefined') {
        return element.length > 0;
    } else
        return false;
}

/*
 * parce url
 **/
function parseUrlQuery() {
    var data = {};
    if(location.search) {
        var pair = (location.search.substr(1)).split('&');
        for(var i = 0; i < pair.length; i ++) {
            var param = pair[i].split('=');
            data[param[0]] = param[1];
        }
    }
    return data;
}

/*
 * parce string serilize
 **/
function parseQuery( str ) {
    var data = {};
    if(typeof str == 'string') {
        var pair = (str).split('&');
        for(var i = 0; i < pair.length; i ++) {
            var param = pair[i].split('=');
            data[param[0]] = param[1];
        }
    } else if(typeof str == 'object') {
        $.each(str, function(_k, _val) {
            if(_val.name)
                data[ _val.name ] = (_val.value) ? _val.value : null;
        });
    }
    return data;
}

/*
 * Ajax function.
 * return json result
 **/
function getAjaxForm(path, params, options) {
  
    if(!options) options = {};
    
    var settings = $.extend( {
        'dataType': 'json',
        'async': false,
        'crossDomain': false,
        'type': 'POST',
        'cache': true
    }, options || {});
    
    console.log( settings );
    
    if(!path) {
        console.log('enter url AJAX!');
        return null;
    }
    var res = $.ajax({
                    url: path,
                    dataType: settings.dataType,
                    async: settings.async,
                    crossDomain: settings.crossDomain,
                    type: settings.type,
                    cache: settings.cache,
                    success: function() {
                        
                    },
                    complete: function(){
                    },
                    data: {
                        params: params 
                    }
		}).responseText;
                
    console.log(res);            
                
    res = eval('['+res+']');
    var obj = res[0];
    return obj;
}

/*
 * JSONP
 * 
 */
function _getAJAX( path, params, options ) {
   if(!options) options = {};
    
    var settings = $.extend( {
        'dataType': 'jsonp',
        'jsonp': "callback",
        'async': false,
        'crossDomain': false,
        'type': 'POST',
        'cache': true
    }, options || {});
    
    console.log( settings );
    
    if(!path) {
        console.log('enter url AJAX!');
        return null;
    }   

    return $.ajax({ 
        type: settings.type,
        async: settings.async,
        url: path,
        data: { 
           params: params 
        },
        dataType: settings.dataType,
        jsonp: settings.jsonp,
        crossDomain: settings.crossDomain,
        cache: settings.cache,
    });
}
/*!
 * Bootstrap YouTube Popup Player Plugin
 * author: Edii Shadow
 */
(function ($) {
  var $YouTubeModal = null,
    $YouTubeModalDialog = null,
    $YouTubeModalTitle = null,
    $YouTubeModalBody = null,
    margin = 5,
    methods;

  //Plugin methods
  methods = {
    //initialize plugin
    init: function (options) {
      options = $.extend({}, $.fn.YouTubeModal.defaults, options);

      // initialize YouTube Player Modal
      if ($YouTubeModal == null) {
        $YouTubeModal = $('<div class="modal ' + options.cssClass + '" id="YouTubeModal" role="dialog" aria-hidden="true">'); // fade
        
        
        var modalContent = '<div class="modal-dialog" id="YouTubeModalDialog">' +
                              '<div class="modal-content" id="YouTubeModalContent">' +
                                    '<div class="video-wrapper">' +
                                         '<div class="video-inner">'+
                                             '<button type="button" data-dismiss="modal" aria-hidden="true" class="video-close close"></button>'+
                                
                                              '<div class="modal-body" id="YouTubeModalBody"></div>' +
                                          '</div>'+ 
                                     '</div>'+     
                              '</div>' +
                            '</div>';
        
        
//        var modalContent = '<div class="modal-dialog" id="YouTubeModalDialog">' +
//                              '<div class="modal-content" id="YouTubeModalContent">' +
//                                '<div class="modal-header">' +
//                                  '<button type="button" class="close" data-dismiss="modal">&times;</button>' +
//                                  '<h4 class="modal-title" id="YouTubeModalTitle"></h4>' +
//                                '</div>' +
//                                '<div class="modal-body" id="YouTubeModalBody" style="padding:0;"></div>' +
//                              '</div>' +
//                            '</div>';
        $YouTubeModal.html(modalContent).hide().appendTo('body');
        $YouTubeModalDialog = $("#YouTubeModalDialog");
        $YouTubeModalTitle = $("#YouTubeModalTitle");
        $YouTubeModalBody = $("#YouTubeModalBody");
        $YouTubeModal.modal({
          show: false
        }).on('hide.bs.modal', resetModalBody);
      }

      return this.each(function () {
        var obj = $(this);
        var data = obj.data('YouTube');
        if (!data) { //check if event is already assigned
          obj.data('YouTube', {
            target: obj
          });
          $(obj).bind('click.YouTubeModal', function (event) {
            var youtubeId = options.youtubeId;
            if ($.trim(youtubeId) == '' && obj.is("a")) {
              youtubeId = getYouTubeIdFromUrl(obj.attr("href"));
            }
            if ($.trim(youtubeId) == '' || youtubeId === false) {
              youtubeId = obj.attr(options.idAttribute);
            }
            var videoTitle = $.trim(options.title);
            if (videoTitle == '') {
              if (options.useYouTubeTitle) setYouTubeTitle(youtubeId);
              else videoTitle = obj.attr('title');
            }
            if (videoTitle) {
              setModalTitle(videoTitle);
            }

            resizeModal(options.width);

            //Setup YouTube Modal
            var YouTubeURL = getYouTubeUrl(youtubeId, options);
            var YouTubePlayerIframe = getYouTubePlayer(YouTubeURL, options.width, options.height);
            $YouTubeModalBody.css({'max-width': options.width, 'height': options.height});
            setModalBody(YouTubePlayerIframe);
            $YouTubeModal.modal('show');

            event.preventDefault();
          });
        }
      });
    },
    destroy: function () {
      return this.each(function () {
        $(this).unbind(".YouTubeModal").removeData('YouTube');
      });
    }
  };

  function setModalTitle(title) {
    $YouTubeModalTitle.html($.trim(title));
  }

  function setModalBody(content) {
    $YouTubeModalBody.html(content);
  }

  function resetModalBody() {
    setModalTitle('');
    setModalBody('');
  }

  function resizeModal(w) {
//    $YouTubeModalDialog.css({
//      'max-width': w + (margin * 2)
//    });
  }

  function getYouTubeUrl(youtubeId, options) {
    return ["//www.youtube.com/embed/", youtubeId, "?rel=0&showsearch=0&autohide=", options.autohide,
      "&autoplay=", options.autoplay, "&controls=", options.controls, "&fs=", options.fs, "&loop=", options.loop,
      "&showinfo=", options.showinfo, "&color=", options.color, "&theme=", options.theme, "&wmode=transparent"
    ].join('');
  }

  function getYouTubePlayer(URL, width, height) {
    return ['<iframe title="YouTube video player" width="', width, '" height="', height, '" ',
      'style="margin:0; padding:0; box-sizing:border-box; border:0; -webkit-border-radius:5px; -moz-border-radius:5px; border-radius:5px; margin:', (margin - 1), 'px;" ',
      'src="', URL, '" frameborder="0" allowfullscreen seamless></iframe>'
    ].join('');
  }

  function setYouTubeTitle(youtubeId) {
    $.ajax({
      url: window.location.protocol + '//query.yahooapis.com/v1/public/yql',
      data: {
        q: "select * from json where url ='http://www.youtube.com/oembed?url=http://www.youtube.com/watch?v=" + youtubeId + "&format=json'",
        format: "json"
      },
      dataType: "jsonp",
      success: function (data) {
          if (data && data.query && data.query.results && data.query.results.json) {
            setModalTitle(data.query.results.json.title);
          }
      }
    });
  }

  function getYouTubeIdFromUrl(youtubeUrl) {
    var regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=)([^#\&\?]*).*/;
    var match = youtubeUrl.match(regExp);
    if (match && match[2].length == 11) {
      return match[2];
    } else {
      return false;
    }
  }

  $.fn.YouTubeModal = function (method) {
    if (methods[method]) {
      return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
    } else if (typeof method === 'object' || !method) {
      return methods.init.apply(this, arguments);
    } else {
      $.error('Method ' + method + ' does not exist on Bootstrap.YouTubeModal');
    }
  };

  //default configuration
  $.fn.YouTubeModal.defaults = {
    youtubeId: '',
    title: '',
    useYouTubeTitle: true,
    idAttribute: 'rel',
    cssClass: 'YouTubeModal',
    width: 640,
    height: 480,
    autohide: 2,
    autoplay: 1,
    color: 'red',
    controls: 1,
    fs: 1,
    loop: 0,
    showinfo: 0,
    theme: 'light'
  };
})(jQuery);

/*!
 * Bootstrap YouTube Popup Player Plugin
 * http://lab.abhinayrathore.com/bootstrap-youtube/
 * https://github.com/abhinayrathore/Bootstrap-Youtube-Popup-Player-Plugin
 */
!function(o){function t(t){h.html(o.trim(t))}function e(o){b.html(o)}function u(){t(""),e("")}function a(o){c.css({width:o+2*m})}function i(o,t){return["//www.youtube.com/embed/",o,"?rel=0&showsearch=0&autohide=",t.autohide,"&autoplay=",t.autoplay,"&controls=",t.controls,"&fs=",t.fs,"&loop=",t.loop,"&showinfo=",t.showinfo,"&color=",t.color,"&theme=",t.theme,"&wmode=transparent"].join("")}function l(o,t,e){return['<iframe title="YouTube video player" width="',t,'" height="',e,'" ','style="margin:0; padding:0; box-sizing:border-box; border:0; -webkit-border-radius:5px; -moz-border-radius:5px; border-radius:5px; margin:',m-1,'px;" ','src="',o,'" frameborder="0" allowfullscreen seamless></iframe>'].join("")}function d(e){o.ajax({url:window.location.protocol+"//query.yahooapis.com/v1/public/yql",data:{q:"select * from json where url ='http://www.youtube.com/oembed?url=http://www.youtube.com/watch?v="+e+"&format=json'",format:"json"},dataType:"jsonp",success:function(o){o&&o.query&&o.query.results&&o.query.results.json&&t(o.query.results.json.title)}})}function r(o){var t=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=)([^#\&\?]*).*/,e=o.match(t);return e&&11==e[2].length?e[2]:!1}var n,s=null,c=null,h=null,b=null,m=5;n={init:function(n){if(n=o.extend({},o.fn.YouTubeModal.defaults,n),null==s){s=o('<div class="modal fade '+n.cssClass+'" id="YouTubeModal" role="dialog" aria-hidden="true">');var m='<div class="modal-dialog" id="YouTubeModalDialog"><div class="modal-content" id="YouTubeModalContent"><div class="modal-header"><button type="button" class="close" data-dismiss="modal">&times;</button><h4 class="modal-title" id="YouTubeModalTitle"></h4></div><div class="modal-body" id="YouTubeModalBody" style="padding:0;"></div></div></div>';s.html(m).hide().appendTo("body"),c=o("#YouTubeModalDialog"),h=o("#YouTubeModalTitle"),b=o("#YouTubeModalBody"),s.modal({show:!1}).on("hide.bs.modal",u)}return this.each(function(){var u=o(this),c=u.data("YouTube");c||(u.data("YouTube",{target:u}),o(u).bind("click.YouTubeModal",function(c){var h=n.youtubeId;""==o.trim(h)&&u.is("a")&&(h=r(u.attr("href"))),(""==o.trim(h)||h===!1)&&(h=u.attr(n.idAttribute));var b=o.trim(n.title);""==b&&(n.useYouTubeTitle?d(h):b=u.attr("title")),b&&t(b),a(n.width);var m=i(h,n),f=l(m,n.width,n.height);e(f),s.modal("show"),c.preventDefault()}))})},destroy:function(){return this.each(function(){o(this).unbind(".YouTubeModal").removeData("YouTube")})}},o.fn.YouTubeModal=function(t){return n[t]?n[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void o.error("Method "+t+" does not exist on Bootstrap.YouTubeModal"):n.init.apply(this,arguments)},o.fn.YouTubeModal.defaults={youtubeId:"",title:"",useYouTubeTitle:!0,idAttribute:"rel",cssClass:"YouTubeModal",width:640,height:480,autohide:2,autoplay:1,color:"red",controls:1,fs:1,loop:0,showinfo:0,theme:"light"}}(jQuery);

/*!
 * Bootstrap YouTube Popup Player Plugin
 * http://lab.abhinayrathore.com/bootstrap-youtube/
 * https://github.com/abhinayrathore/Bootstrap-Youtube-Popup-Player-Plugin
 */
(function ($) {
  var $YouTubeModal = null,
    $YouTubeModalDialog = null,
    $YouTubeModalTitle = null,
    $YouTubeModalBody = null,
    margin = 5,
    methods;

  //Plugin methods
  methods = {
    //initialize plugin
    init: function (options) {
      options = $.extend({}, $.fn.YouTubeModal.defaults, options);

      // initialize YouTube Player Modal
      if ($YouTubeModal == null) {
        $YouTubeModal = $('<div class="modal fade ' + options.cssClass + '" id="YouTubeModal" role="dialog" aria-hidden="true">');
        var modalContent = '<div class="modal-dialog" id="YouTubeModalDialog">' +
                              '<div class="modal-content" id="YouTubeModalContent">' +
                                '<div class="modal-header">' +
                                  '<button type="button" class="close" data-dismiss="modal">&times;</button>' +
                                  '<h4 class="modal-title" id="YouTubeModalTitle"></h4>' +
                                '</div>' +
                                '<div class="modal-body" id="YouTubeModalBody" style="padding:0;"></div>' +
                              '</div>' +
                            '</div>';
        $YouTubeModal.html(modalContent).hide().appendTo('body');
        $YouTubeModalDialog = $("#YouTubeModalDialog");
        $YouTubeModalTitle = $("#YouTubeModalTitle");
        $YouTubeModalBody = $("#YouTubeModalBody");
        $YouTubeModal.modal({
          show: false
        }).on('hide.bs.modal', resetModalBody);
      }

      return this.each(function () {
        var obj = $(this);
        var data = obj.data('YouTube');
        if (!data) { //check if event is already assigned
          obj.data('YouTube', {
            target: obj
          });
          $(obj).bind('click.YouTubeModal', function (event) {
            var youtubeId = options.youtubeId;
            if ($.trim(youtubeId) == '' && obj.is("a")) {
              youtubeId = getYouTubeIdFromUrl(obj.attr("href"));
            }
            if ($.trim(youtubeId) == '' || youtubeId === false) {
              youtubeId = obj.attr(options.idAttribute);
            }
            var videoTitle = $.trim(options.title);
            if (videoTitle == '') {
              if (options.useYouTubeTitle) setYouTubeTitle(youtubeId);
              else videoTitle = obj.attr('title');
            }
            if (videoTitle) {
              setModalTitle(videoTitle);
            }

            resizeModal(options.width);

            //Setup YouTube Modal
            var YouTubeURL = getYouTubeUrl(youtubeId, options);
            var YouTubePlayerIframe = getYouTubePlayer(YouTubeURL, options.width, options.height);
            setModalBody(YouTubePlayerIframe);
            $YouTubeModal.modal('show');

            event.preventDefault();
          });
        }
      });
    },
    destroy: function () {
      return this.each(function () {
        $(this).unbind(".YouTubeModal").removeData('YouTube');
      });
    }
  };

  function setModalTitle(title) {
    $YouTubeModalTitle.html($.trim(title));
  }

  function setModalBody(content) {
    $YouTubeModalBody.html(content);
  }

  function resetModalBody() {
    setModalTitle('');
    setModalBody('');
  }

  function resizeModal(w) {
    $YouTubeModalDialog.css({
      width: w + (margin * 2)
    });
  }

  function getYouTubeUrl(youtubeId, options) {
    return ["//www.youtube.com/embed/", youtubeId, "?rel=0&showsearch=0&autohide=", options.autohide,
      "&autoplay=", options.autoplay, "&controls=", options.controls, "&fs=", options.fs, "&loop=", options.loop,
      "&showinfo=", options.showinfo, "&color=", options.color, "&theme=", options.theme, "&wmode=transparent"
    ].join('');
  }

  function getYouTubePlayer(URL, width, height) {
    return ['<iframe title="YouTube video player" width="', width, '" height="', height, '" ',
      'style="margin:0; padding:0; box-sizing:border-box; border:0; -webkit-border-radius:5px; -moz-border-radius:5px; border-radius:5px; margin:', (margin - 1), 'px;" ',
      'src="', URL, '" frameborder="0" allowfullscreen seamless></iframe>'
    ].join('');
  }

  function setYouTubeTitle(youtubeId) {
    $.ajax({
      url: window.location.protocol + '//query.yahooapis.com/v1/public/yql',
      data: {
        q: "select * from json where url ='http://www.youtube.com/oembed?url=http://www.youtube.com/watch?v=" + youtubeId + "&format=json'",
        format: "json"
      },
      dataType: "jsonp",
      success: function (data) {
          if (data && data.query && data.query.results && data.query.results.json) {
            setModalTitle(data.query.results.json.title);
          }
      }
    });
  }

  function getYouTubeIdFromUrl(youtubeUrl) {
    var regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=)([^#\&\?]*).*/;
    var match = youtubeUrl.match(regExp);
    if (match && match[2].length == 11) {
      return match[2];
    } else {
      return false;
    }
  }

  $.fn.YouTubeModal = function (method) {
    if (methods[method]) {
      return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
    } else if (typeof method === 'object' || !method) {
      return methods.init.apply(this, arguments);
    } else {
      $.error('Method ' + method + ' does not exist on Bootstrap.YouTubeModal');
    }
  };

  //default configuration
  $.fn.YouTubeModal.defaults = {
    youtubeId: '',
    title: '',
    useYouTubeTitle: true,
    idAttribute: 'rel',
    cssClass: 'YouTubeModal',
    width: 640,
    height: 480,
    autohide: 2,
    autoplay: 1,
    color: 'red',
    controls: 1,
    fs: 1,
    loop: 0,
    showinfo: 0,
    theme: 'light'
  };
})(jQuery);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlplcm9DbGlwYm9hcmQubWluLmpzIiwiYm9vdHN0cmFwLmpzIiwiYnJvd3Nlci5qcyIsImJ1dHRvbi5qcyIsImN1cnJhbmN5LmpzIiwiZWFzeVRvb2x0aXAuanMiLCJmYW5jeV9jaGVja2JveC5qcyIsImZseV9mZWFjaGVycy5qcyIsImluaXQuanMiLCJqcXVlcnkuYmEtaGFzaGNoYW5nZS5taW4uanMiLCJqcXVlcnkuY29va2llLmpzIiwianF1ZXJ5LmhhbmRsZXItdG9vbGtpdC5qcyIsImpxdWVyeS5tYXRjaEhlaWdodC1taW4uanMiLCJqcXVlcnkuc2ltcGxlUGFnaW5hdGlvbi5qcyIsImpxdWVyeS50YXAuanMiLCJqcXVlcnkudG90YWwtc3RvcmFnZS5taW4uanMiLCJqcXVlcnkudmFsaWRhdGUuanMiLCJtYWluLmpzIiwib3V0V2luZG93cy5qcyIsInJlc2l6ZV9pbWFnZXMuanMiLCJyZXNpemVfdGVoLmpzIiwic2Nyb2xsLmpzIiwic3RvcmVGaWx0ZXIuanMiLCJieHNsaWRlci9ieEluaXQuanMiLCJieHNsaWRlci9qcXVlcnkuYnhzbGlkZXIuanMiLCJsaWdodGJveC9saWdodGJveC5qcyIsIm1vbmV5L21vbmV5LmpzIiwicG9wdXAvanF1ZXJ5LmJwb3B1cC5qcyIsInN0aWNreS9qcXVlcnkuYXV0b2ZpeF9hbnl0aGluZy5qcyIsInN0aWNreWJhci9qcXVlcnkuc3RpY2t5LWtpdC5qcyIsInRyYW5zbGl0ZS9qcXVlcnkuc3luY3RyYW5zbGl0LmpzIiwid3AvaW5pdC5qcyIsIndwL3NldHRpbmdzLmpzIiwieW91dHViZS9ib290c3RyYXAueW91dHViZXBvcHVwLmpzIiwieW91dHViZS9ib290c3RyYXAueW91dHViZXBvcHVwLm1pbi5qcyIsInlvdXR1YmUvYm9vdHN0cmFwLnlvdXR1YmVwb3B1cF8xLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM3lHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDOVpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdCtFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMvRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hWQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2hHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwMUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwUUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BQQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2xIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdkpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDemdEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNaQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdEtBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMxWUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDeFFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDekpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdkNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaklBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUMzTEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNOQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImZyb250ZW5kLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qIVxuICogWmVyb0NsaXBib2FyZFxuICogVGhlIFplcm9DbGlwYm9hcmQgbGlicmFyeSBwcm92aWRlcyBhbiBlYXN5IHdheSB0byBjb3B5IHRleHQgdG8gdGhlIGNsaXBib2FyZCB1c2luZyBhbiBpbnZpc2libGUgQWRvYmUgRmxhc2ggbW92aWUgYW5kIGEgSmF2YVNjcmlwdCBpbnRlcmZhY2UuXG4gKiBDb3B5cmlnaHQgKGMpIDIwMDktMjAxNSBKb24gUm9oYW4sIEphbWVzIE0uIEdyZWVuZVxuICogTGljZW5zZWQgTUlUXG4gKiBodHRwOi8vemVyb2NsaXBib2FyZC5vcmcvXG4gKiB2Mi4zLjAtYmV0YS4xXG4gKi9cbiFmdW5jdGlvbihhLGIpe1widXNlIHN0cmljdFwiO3ZhciBjLGQsZSxmPWEsZz1mLmRvY3VtZW50LGg9Zi5uYXZpZ2F0b3IsaT1mLnNldFRpbWVvdXQsaj1mLmNsZWFyVGltZW91dCxrPWYuc2V0SW50ZXJ2YWwsbD1mLmNsZWFySW50ZXJ2YWwsbT1mLmdldENvbXB1dGVkU3R5bGUsbj1mLmVuY29kZVVSSUNvbXBvbmVudCxvPWYuQWN0aXZlWE9iamVjdCxwPWYuRXJyb3IscT1mLk51bWJlci5wYXJzZUludHx8Zi5wYXJzZUludCxyPWYuTnVtYmVyLnBhcnNlRmxvYXR8fGYucGFyc2VGbG9hdCxzPWYuTnVtYmVyLmlzTmFOfHxmLmlzTmFOLHQ9Zi5EYXRlLm5vdyx1PWYuT2JqZWN0LmtleXMsdj1mLk9iamVjdC5kZWZpbmVQcm9wZXJ0eSx3PWYuT2JqZWN0LnByb3RvdHlwZS5oYXNPd25Qcm9wZXJ0eSx4PWYuQXJyYXkucHJvdG90eXBlLnNsaWNlLHk9ZnVuY3Rpb24oKXt2YXIgYT1mdW5jdGlvbihhKXtyZXR1cm4gYX07aWYoXCJmdW5jdGlvblwiPT10eXBlb2YgZi53cmFwJiZcImZ1bmN0aW9uXCI9PXR5cGVvZiBmLnVud3JhcCl0cnl7dmFyIGI9Zy5jcmVhdGVFbGVtZW50KFwiZGl2XCIpLGM9Zi51bndyYXAoYik7MT09PWIubm9kZVR5cGUmJmMmJjE9PT1jLm5vZGVUeXBlJiYoYT1mLnVud3JhcCl9Y2F0Y2goZCl7fXJldHVybiBhfSgpLHo9ZnVuY3Rpb24oYSl7cmV0dXJuIHguY2FsbChhLDApfSxBPWZ1bmN0aW9uKCl7dmFyIGEsYyxkLGUsZixnLGg9eihhcmd1bWVudHMpLGk9aFswXXx8e307Zm9yKGE9MSxjPWgubGVuZ3RoO2M+YTthKyspaWYobnVsbCE9KGQ9aFthXSkpZm9yKGUgaW4gZCl3LmNhbGwoZCxlKSYmKGY9aVtlXSxnPWRbZV0saSE9PWcmJmchPT1iJiYoaVtlXT1nKSk7cmV0dXJuIGl9LEI9ZnVuY3Rpb24oYSl7dmFyIGIsYyxkLGU7aWYoXCJvYmplY3RcIiE9dHlwZW9mIGF8fG51bGw9PWF8fFwibnVtYmVyXCI9PXR5cGVvZiBhLm5vZGVUeXBlKWI9YTtlbHNlIGlmKFwibnVtYmVyXCI9PXR5cGVvZiBhLmxlbmd0aClmb3IoYj1bXSxjPTAsZD1hLmxlbmd0aDtkPmM7YysrKXcuY2FsbChhLGMpJiYoYltjXT1CKGFbY10pKTtlbHNle2I9e307Zm9yKGUgaW4gYSl3LmNhbGwoYSxlKSYmKGJbZV09QihhW2VdKSl9cmV0dXJuIGJ9LEM9ZnVuY3Rpb24oYSxiKXtmb3IodmFyIGM9e30sZD0wLGU9Yi5sZW5ndGg7ZT5kO2QrKyliW2RdaW4gYSYmKGNbYltkXV09YVtiW2RdXSk7cmV0dXJuIGN9LEQ9ZnVuY3Rpb24oYSxiKXt2YXIgYz17fTtmb3IodmFyIGQgaW4gYSktMT09PWIuaW5kZXhPZihkKSYmKGNbZF09YVtkXSk7cmV0dXJuIGN9LEU9ZnVuY3Rpb24oYSl7aWYoYSlmb3IodmFyIGIgaW4gYSl3LmNhbGwoYSxiKSYmZGVsZXRlIGFbYl07cmV0dXJuIGF9LEY9ZnVuY3Rpb24oYSxiKXtpZihhJiYxPT09YS5ub2RlVHlwZSYmYS5vd25lckRvY3VtZW50JiZiJiYoMT09PWIubm9kZVR5cGUmJmIub3duZXJEb2N1bWVudCYmYi5vd25lckRvY3VtZW50PT09YS5vd25lckRvY3VtZW50fHw5PT09Yi5ub2RlVHlwZSYmIWIub3duZXJEb2N1bWVudCYmYj09PWEub3duZXJEb2N1bWVudCkpZG97aWYoYT09PWIpcmV0dXJuITA7YT1hLnBhcmVudE5vZGV9d2hpbGUoYSk7cmV0dXJuITF9LEc9ZnVuY3Rpb24oYSl7dmFyIGI7cmV0dXJuXCJzdHJpbmdcIj09dHlwZW9mIGEmJmEmJihiPWEuc3BsaXQoXCIjXCIpWzBdLnNwbGl0KFwiP1wiKVswXSxiPWEuc2xpY2UoMCxhLmxhc3RJbmRleE9mKFwiL1wiKSsxKSksYn0sSD1mdW5jdGlvbihhKXt2YXIgYixjO3JldHVyblwic3RyaW5nXCI9PXR5cGVvZiBhJiZhJiYoYz1hLm1hdGNoKC9eKD86fFteOkBdKkB8LitcXClAKD89aHR0cFtzXT98ZmlsZSl8Lis/XFxzKyg/OiBhdCB8QCkoPzpbXjpcXChdKyApKltcXChdPykoKD86aHR0cFtzXT98ZmlsZSk6XFwvXFwvW1xcL10/Lis/XFwvW146XFwpXSo/KSg/OjpcXGQrKSg/OjpcXGQrKT8vKSxjJiZjWzFdP2I9Y1sxXTooYz1hLm1hdGNoKC9cXClAKCg/Omh0dHBbc10/fGZpbGUpOlxcL1xcL1tcXC9dPy4rP1xcL1teOlxcKV0qPykoPzo6XFxkKykoPzo6XFxkKyk/LyksYyYmY1sxXSYmKGI9Y1sxXSkpKSxifSxJPWZ1bmN0aW9uKCl7dmFyIGEsYjt0cnl7dGhyb3cgbmV3IHB9Y2F0Y2goYyl7Yj1jfXJldHVybiBiJiYoYT1iLnNvdXJjZVVSTHx8Yi5maWxlTmFtZXx8SChiLnN0YWNrKSksYX0sSj1mdW5jdGlvbigpe3ZhciBhLGMsZDtpZihnLmN1cnJlbnRTY3JpcHQmJihhPWcuY3VycmVudFNjcmlwdC5zcmMpKXJldHVybiBhO2lmKGM9Zy5nZXRFbGVtZW50c0J5VGFnTmFtZShcInNjcmlwdFwiKSwxPT09Yy5sZW5ndGgpcmV0dXJuIGNbMF0uc3JjfHxiO2lmKFwicmVhZHlTdGF0ZVwiaW4gY1swXSlmb3IoZD1jLmxlbmd0aDtkLS07KWlmKFwiaW50ZXJhY3RpdmVcIj09PWNbZF0ucmVhZHlTdGF0ZSYmKGE9Y1tkXS5zcmMpKXJldHVybiBhO3JldHVyblwibG9hZGluZ1wiPT09Zy5yZWFkeVN0YXRlJiYoYT1jW2MubGVuZ3RoLTFdLnNyYyk/YTooYT1JKCkpP2E6Yn0sSz1mdW5jdGlvbigpe3ZhciBhLGMsZCxlPWcuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJzY3JpcHRcIik7Zm9yKGE9ZS5sZW5ndGg7YS0tOyl7aWYoIShkPWVbYV0uc3JjKSl7Yz1udWxsO2JyZWFrfWlmKGQ9RyhkKSxudWxsPT1jKWM9ZDtlbHNlIGlmKGMhPT1kKXtjPW51bGw7YnJlYWt9fXJldHVybiBjfHxifSxMPWZ1bmN0aW9uKCl7dmFyIGE9RyhKKCkpfHxLKCl8fFwiXCI7cmV0dXJuIGErXCJaZXJvQ2xpcGJvYXJkLnN3ZlwifSxNPWZ1bmN0aW9uKCl7dmFyIGE9L3dpbihkb3dzfFtcXHNdPyhudHxtZXxjZXx4cHx2aXN0YXxbXFxkXSspKS9pO3JldHVybiEhaCYmKGEudGVzdChoLmFwcFZlcnNpb258fFwiXCIpfHxhLnRlc3QoaC5wbGF0Zm9ybXx8XCJcIil8fC0xIT09KGgudXNlckFnZW50fHxcIlwiKS5pbmRleE9mKFwiV2luZG93c1wiKSl9LE49ZnVuY3Rpb24oKXtyZXR1cm4gbnVsbD09YS5vcGVuZXImJighIWEudG9wJiZhIT1hLnRvcHx8ISFhLnBhcmVudCYmYSE9YS5wYXJlbnQpfSgpLE89e2JyaWRnZTpudWxsLHZlcnNpb246XCIwLjAuMFwiLHBsdWdpblR5cGU6XCJ1bmtub3duXCIsZGlzYWJsZWQ6bnVsbCxvdXRkYXRlZDpudWxsLHNhbmRib3hlZDpudWxsLHVuYXZhaWxhYmxlOm51bGwsZGVncmFkZWQ6bnVsbCxkZWFjdGl2YXRlZDpudWxsLG92ZXJkdWU6bnVsbCxyZWFkeTpudWxsfSxQPVwiMTEuMC4wXCIsUT17fSxSPXt9LFM9bnVsbCxUPTAsVT0wLFY9e3JlYWR5OlwiRmxhc2ggY29tbXVuaWNhdGlvbiBpcyBlc3RhYmxpc2hlZFwiLGVycm9yOntcImZsYXNoLWRpc2FibGVkXCI6XCJGbGFzaCBpcyBkaXNhYmxlZCBvciBub3QgaW5zdGFsbGVkLiBNYXkgYWxzbyBiZSBhdHRlbXB0aW5nIHRvIHJ1biBGbGFzaCBpbiBhIHNhbmRib3hlZCBpZnJhbWUsIHdoaWNoIGlzIGltcG9zc2libGUuXCIsXCJmbGFzaC1vdXRkYXRlZFwiOlwiRmxhc2ggaXMgdG9vIG91dGRhdGVkIHRvIHN1cHBvcnQgWmVyb0NsaXBib2FyZFwiLFwiZmxhc2gtc2FuZGJveGVkXCI6XCJBdHRlbXB0aW5nIHRvIHJ1biBGbGFzaCBpbiBhIHNhbmRib3hlZCBpZnJhbWUsIHdoaWNoIGlzIGltcG9zc2libGVcIixcImZsYXNoLXVuYXZhaWxhYmxlXCI6XCJGbGFzaCBpcyB1bmFibGUgdG8gY29tbXVuaWNhdGUgYmlkaXJlY3Rpb25hbGx5IHdpdGggSmF2YVNjcmlwdFwiLFwiZmxhc2gtZGVncmFkZWRcIjpcIkZsYXNoIGlzIHVuYWJsZSB0byBwcmVzZXJ2ZSBkYXRhIGZpZGVsaXR5IHdoZW4gY29tbXVuaWNhdGluZyB3aXRoIEphdmFTY3JpcHRcIixcImZsYXNoLWRlYWN0aXZhdGVkXCI6XCJGbGFzaCBpcyB0b28gb3V0ZGF0ZWQgZm9yIHlvdXIgYnJvd3NlciBhbmQvb3IgaXMgY29uZmlndXJlZCBhcyBjbGljay10by1hY3RpdmF0ZS5cXG5UaGlzIG1heSBhbHNvIG1lYW4gdGhhdCB0aGUgWmVyb0NsaXBib2FyZCBTV0Ygb2JqZWN0IGNvdWxkIG5vdCBiZSBsb2FkZWQsIHNvIHBsZWFzZSBjaGVjayB5b3VyIGBzd2ZQYXRoYCBjb25maWd1cmF0aW9uIGFuZC9vciBuZXR3b3JrIGNvbm5lY3Rpdml0eS5cXG5NYXkgYWxzbyBiZSBhdHRlbXB0aW5nIHRvIHJ1biBGbGFzaCBpbiBhIHNhbmRib3hlZCBpZnJhbWUsIHdoaWNoIGlzIGltcG9zc2libGUuXCIsXCJmbGFzaC1vdmVyZHVlXCI6XCJGbGFzaCBjb21tdW5pY2F0aW9uIHdhcyBlc3RhYmxpc2hlZCBidXQgTk9UIHdpdGhpbiB0aGUgYWNjZXB0YWJsZSB0aW1lIGxpbWl0XCIsXCJ2ZXJzaW9uLW1pc21hdGNoXCI6XCJaZXJvQ2xpcGJvYXJkIEpTIHZlcnNpb24gbnVtYmVyIGRvZXMgbm90IG1hdGNoIFplcm9DbGlwYm9hcmQgU1dGIHZlcnNpb24gbnVtYmVyXCIsXCJjbGlwYm9hcmQtZXJyb3JcIjpcIkF0IGxlYXN0IG9uZSBlcnJvciB3YXMgdGhyb3duIHdoaWxlIFplcm9DbGlwYm9hcmQgd2FzIGF0dGVtcHRpbmcgdG8gaW5qZWN0IHlvdXIgZGF0YSBpbnRvIHRoZSBjbGlwYm9hcmRcIixcImNvbmZpZy1taXNtYXRjaFwiOlwiWmVyb0NsaXBib2FyZCBjb25maWd1cmF0aW9uIGRvZXMgbm90IG1hdGNoIEZsYXNoJ3MgcmVhbGl0eVwiLFwic3dmLW5vdC1mb3VuZFwiOlwiVGhlIFplcm9DbGlwYm9hcmQgU1dGIG9iamVjdCBjb3VsZCBub3QgYmUgbG9hZGVkLCBzbyBwbGVhc2UgY2hlY2sgeW91ciBgc3dmUGF0aGAgY29uZmlndXJhdGlvbiBhbmQvb3IgbmV0d29yayBjb25uZWN0aXZpdHlcIn19LFc9W1wiZmxhc2gtdW5hdmFpbGFibGVcIixcImZsYXNoLWRlZ3JhZGVkXCIsXCJmbGFzaC1vdmVyZHVlXCIsXCJ2ZXJzaW9uLW1pc21hdGNoXCIsXCJjb25maWctbWlzbWF0Y2hcIixcImNsaXBib2FyZC1lcnJvclwiXSxYPVtcImZsYXNoLWRpc2FibGVkXCIsXCJmbGFzaC1vdXRkYXRlZFwiLFwiZmxhc2gtc2FuZGJveGVkXCIsXCJmbGFzaC11bmF2YWlsYWJsZVwiLFwiZmxhc2gtZGVncmFkZWRcIixcImZsYXNoLWRlYWN0aXZhdGVkXCIsXCJmbGFzaC1vdmVyZHVlXCJdLFk9bmV3IFJlZ0V4cChcIl5mbGFzaC0oXCIrWC5tYXAoZnVuY3Rpb24oYSl7cmV0dXJuIGEucmVwbGFjZSgvXmZsYXNoLS8sXCJcIil9KS5qb2luKFwifFwiKStcIikkXCIpLFo9bmV3IFJlZ0V4cChcIl5mbGFzaC0oXCIrWC5zbGljZSgxKS5tYXAoZnVuY3Rpb24oYSl7cmV0dXJuIGEucmVwbGFjZSgvXmZsYXNoLS8sXCJcIil9KS5qb2luKFwifFwiKStcIikkXCIpLCQ9e3N3ZlBhdGg6TCgpLHRydXN0ZWREb21haW5zOmEubG9jYXRpb24uaG9zdD9bYS5sb2NhdGlvbi5ob3N0XTpbXSxjYWNoZUJ1c3Q6ITAsZm9yY2VFbmhhbmNlZENsaXBib2FyZDohMSxmbGFzaExvYWRUaW1lb3V0OjNlNCxhdXRvQWN0aXZhdGU6ITAsYnViYmxlRXZlbnRzOiEwLGZpeExpbmVFbmRpbmdzOiEwLGNvbnRhaW5lcklkOlwiZ2xvYmFsLXplcm9jbGlwYm9hcmQtaHRtbC1icmlkZ2VcIixjb250YWluZXJDbGFzczpcImdsb2JhbC16ZXJvY2xpcGJvYXJkLWNvbnRhaW5lclwiLHN3Zk9iamVjdElkOlwiZ2xvYmFsLXplcm9jbGlwYm9hcmQtZmxhc2gtYnJpZGdlXCIsaG92ZXJDbGFzczpcInplcm9jbGlwYm9hcmQtaXMtaG92ZXJcIixhY3RpdmVDbGFzczpcInplcm9jbGlwYm9hcmQtaXMtYWN0aXZlXCIsZm9yY2VIYW5kQ3Vyc29yOiExLHRpdGxlOm51bGwsekluZGV4Ojk5OTk5OTk5OX0sXz1mdW5jdGlvbihhKXtpZihcIm9iamVjdFwiPT10eXBlb2YgYSYmbnVsbCE9PWEpZm9yKHZhciBiIGluIGEpaWYody5jYWxsKGEsYikpaWYoL14oPzpmb3JjZUhhbmRDdXJzb3J8dGl0bGV8ekluZGV4fGJ1YmJsZUV2ZW50c3xmaXhMaW5lRW5kaW5ncykkLy50ZXN0KGIpKSRbYl09YVtiXTtlbHNlIGlmKG51bGw9PU8uYnJpZGdlKWlmKFwiY29udGFpbmVySWRcIj09PWJ8fFwic3dmT2JqZWN0SWRcIj09PWIpe2lmKCFvYShhW2JdKSl0aHJvdyBuZXcgRXJyb3IoXCJUaGUgc3BlY2lmaWVkIGBcIitiK1wiYCB2YWx1ZSBpcyBub3QgdmFsaWQgYXMgYW4gSFRNTDQgRWxlbWVudCBJRFwiKTskW2JdPWFbYl19ZWxzZSAkW2JdPWFbYl07e2lmKFwic3RyaW5nXCIhPXR5cGVvZiBhfHwhYSlyZXR1cm4gQigkKTtpZih3LmNhbGwoJCxhKSlyZXR1cm4gJFthXX19LGFhPWZ1bmN0aW9uKCl7cmV0dXJuIFZhKCkse2Jyb3dzZXI6QyhoLFtcInVzZXJBZ2VudFwiLFwicGxhdGZvcm1cIixcImFwcE5hbWVcIixcImFwcFZlcnNpb25cIl0pLGZsYXNoOkQoTyxbXCJicmlkZ2VcIl0pLHplcm9jbGlwYm9hcmQ6e3ZlcnNpb246WGEudmVyc2lvbixjb25maWc6WGEuY29uZmlnKCl9fX0sYmE9ZnVuY3Rpb24oKXtyZXR1cm4hIShPLmRpc2FibGVkfHxPLm91dGRhdGVkfHxPLnNhbmRib3hlZHx8Ty51bmF2YWlsYWJsZXx8Ty5kZWdyYWRlZHx8Ty5kZWFjdGl2YXRlZCl9LGNhPWZ1bmN0aW9uKGEsZCl7dmFyIGUsZixnLGg9e307aWYoXCJzdHJpbmdcIj09dHlwZW9mIGEmJmEpZz1hLnRvTG93ZXJDYXNlKCkuc3BsaXQoL1xccysvKTtlbHNlIGlmKFwib2JqZWN0XCI9PXR5cGVvZiBhJiZhJiZcInVuZGVmaW5lZFwiPT10eXBlb2YgZClmb3IoZSBpbiBhKXcuY2FsbChhLGUpJiZcInN0cmluZ1wiPT10eXBlb2YgZSYmZSYmXCJmdW5jdGlvblwiPT10eXBlb2YgYVtlXSYmWGEub24oZSxhW2VdKTtpZihnJiZnLmxlbmd0aCl7Zm9yKGU9MCxmPWcubGVuZ3RoO2Y+ZTtlKyspYT1nW2VdLnJlcGxhY2UoL15vbi8sXCJcIiksaFthXT0hMCxRW2FdfHwoUVthXT1bXSksUVthXS5wdXNoKGQpO2lmKGgucmVhZHkmJk8ucmVhZHkmJlhhLmVtaXQoe3R5cGU6XCJyZWFkeVwifSksaC5lcnJvcil7Zm9yKGU9MCxmPVgubGVuZ3RoO2Y+ZTtlKyspaWYoT1tYW2VdLnJlcGxhY2UoL15mbGFzaC0vLFwiXCIpXT09PSEwKXtYYS5lbWl0KHt0eXBlOlwiZXJyb3JcIixuYW1lOlhbZV19KTticmVha31jIT09YiYmWGEudmVyc2lvbiE9PWMmJlhhLmVtaXQoe3R5cGU6XCJlcnJvclwiLG5hbWU6XCJ2ZXJzaW9uLW1pc21hdGNoXCIsanNWZXJzaW9uOlhhLnZlcnNpb24sc3dmVmVyc2lvbjpjfSl9fXJldHVybiBYYX0sZGE9ZnVuY3Rpb24oYSxiKXt2YXIgYyxkLGUsZixnO2lmKDA9PT1hcmd1bWVudHMubGVuZ3RoKWY9dShRKTtlbHNlIGlmKFwic3RyaW5nXCI9PXR5cGVvZiBhJiZhKWY9YS5zcGxpdCgvXFxzKy8pO2Vsc2UgaWYoXCJvYmplY3RcIj09dHlwZW9mIGEmJmEmJlwidW5kZWZpbmVkXCI9PXR5cGVvZiBiKWZvcihjIGluIGEpdy5jYWxsKGEsYykmJlwic3RyaW5nXCI9PXR5cGVvZiBjJiZjJiZcImZ1bmN0aW9uXCI9PXR5cGVvZiBhW2NdJiZYYS5vZmYoYyxhW2NdKTtpZihmJiZmLmxlbmd0aClmb3IoYz0wLGQ9Zi5sZW5ndGg7ZD5jO2MrKylpZihhPWZbY10udG9Mb3dlckNhc2UoKS5yZXBsYWNlKC9eb24vLFwiXCIpLGc9UVthXSxnJiZnLmxlbmd0aClpZihiKWZvcihlPWcuaW5kZXhPZihiKTstMSE9PWU7KWcuc3BsaWNlKGUsMSksZT1nLmluZGV4T2YoYixlKTtlbHNlIGcubGVuZ3RoPTA7cmV0dXJuIFhhfSxlYT1mdW5jdGlvbihhKXt2YXIgYjtyZXR1cm4gYj1cInN0cmluZ1wiPT10eXBlb2YgYSYmYT9CKFFbYV0pfHxudWxsOkIoUSl9LGZhPWZ1bmN0aW9uKGEpe3ZhciBiLGMsZDtyZXR1cm4gYT1wYShhKSxhJiYhd2EoYSk/XCJyZWFkeVwiPT09YS50eXBlJiZPLm92ZXJkdWU9PT0hMD9YYS5lbWl0KHt0eXBlOlwiZXJyb3JcIixuYW1lOlwiZmxhc2gtb3ZlcmR1ZVwifSk6KGI9QSh7fSxhKSx1YS5jYWxsKHRoaXMsYiksXCJjb3B5XCI9PT1hLnR5cGUmJihkPUVhKFIpLGM9ZC5kYXRhLFM9ZC5mb3JtYXRNYXApLGMpOnZvaWQgMH0sZ2E9ZnVuY3Rpb24oKXt2YXIgYT1PLnNhbmRib3hlZDtpZihWYSgpLFwiYm9vbGVhblwiIT10eXBlb2YgTy5yZWFkeSYmKE8ucmVhZHk9ITEpLE8uc2FuZGJveGVkIT09YSYmTy5zYW5kYm94ZWQ9PT0hMClPLnJlYWR5PSExLFhhLmVtaXQoe3R5cGU6XCJlcnJvclwiLG5hbWU6XCJmbGFzaC1zYW5kYm94ZWRcIn0pO2Vsc2UgaWYoIVhhLmlzRmxhc2hVbnVzYWJsZSgpJiZudWxsPT09Ty5icmlkZ2Upe3ZhciBiPSQuZmxhc2hMb2FkVGltZW91dDtcIm51bWJlclwiPT10eXBlb2YgYiYmYj49MCYmKFQ9aShmdW5jdGlvbigpe1wiYm9vbGVhblwiIT10eXBlb2YgTy5kZWFjdGl2YXRlZCYmKE8uZGVhY3RpdmF0ZWQ9ITApLE8uZGVhY3RpdmF0ZWQ9PT0hMCYmWGEuZW1pdCh7dHlwZTpcImVycm9yXCIsbmFtZTpcImZsYXNoLWRlYWN0aXZhdGVkXCJ9KX0sYikpLE8ub3ZlcmR1ZT0hMSxDYSgpfX0saGE9ZnVuY3Rpb24oKXtYYS5jbGVhckRhdGEoKSxYYS5ibHVyKCksWGEuZW1pdChcImRlc3Ryb3lcIiksRGEoKSxYYS5vZmYoKX0saWE9ZnVuY3Rpb24oYSxiKXt2YXIgYztpZihcIm9iamVjdFwiPT10eXBlb2YgYSYmYSYmXCJ1bmRlZmluZWRcIj09dHlwZW9mIGIpYz1hLFhhLmNsZWFyRGF0YSgpO2Vsc2V7aWYoXCJzdHJpbmdcIiE9dHlwZW9mIGF8fCFhKXJldHVybjtjPXt9LGNbYV09Yn1mb3IodmFyIGQgaW4gYylcInN0cmluZ1wiPT10eXBlb2YgZCYmZCYmdy5jYWxsKGMsZCkmJlwic3RyaW5nXCI9PXR5cGVvZiBjW2RdJiZjW2RdJiYoUltkXT1VYShjW2RdKSl9LGphPWZ1bmN0aW9uKGEpe1widW5kZWZpbmVkXCI9PXR5cGVvZiBhPyhFKFIpLFM9bnVsbCk6XCJzdHJpbmdcIj09dHlwZW9mIGEmJncuY2FsbChSLGEpJiZkZWxldGUgUlthXX0sa2E9ZnVuY3Rpb24oYSl7cmV0dXJuXCJ1bmRlZmluZWRcIj09dHlwZW9mIGE/QihSKTpcInN0cmluZ1wiPT10eXBlb2YgYSYmdy5jYWxsKFIsYSk/UlthXTp2b2lkIDB9LGxhPWZ1bmN0aW9uKGEpe2lmKGEmJjE9PT1hLm5vZGVUeXBlKXtkJiYoTWEoZCwkLmFjdGl2ZUNsYXNzKSxkIT09YSYmTWEoZCwkLmhvdmVyQ2xhc3MpKSxkPWEsTGEoYSwkLmhvdmVyQ2xhc3MpO3ZhciBiPWEuZ2V0QXR0cmlidXRlKFwidGl0bGVcIil8fCQudGl0bGU7aWYoXCJzdHJpbmdcIj09dHlwZW9mIGImJmIpe3ZhciBjPUJhKE8uYnJpZGdlKTtjJiZjLnNldEF0dHJpYnV0ZShcInRpdGxlXCIsYil9dmFyIGU9JC5mb3JjZUhhbmRDdXJzb3I9PT0hMHx8XCJwb2ludGVyXCI9PT1OYShhLFwiY3Vyc29yXCIpO1NhKGUpLFJhKCl9fSxtYT1mdW5jdGlvbigpe3ZhciBhPUJhKE8uYnJpZGdlKTthJiYoYS5yZW1vdmVBdHRyaWJ1dGUoXCJ0aXRsZVwiKSxhLnN0eWxlLmxlZnQ9XCIwcHhcIixhLnN0eWxlLnRvcD1cIi05OTk5cHhcIixhLnN0eWxlLndpZHRoPVwiMXB4XCIsYS5zdHlsZS5oZWlnaHQ9XCIxcHhcIiksZCYmKE1hKGQsJC5ob3ZlckNsYXNzKSxNYShkLCQuYWN0aXZlQ2xhc3MpLGQ9bnVsbCl9LG5hPWZ1bmN0aW9uKCl7cmV0dXJuIGR8fG51bGx9LG9hPWZ1bmN0aW9uKGEpe3JldHVyblwic3RyaW5nXCI9PXR5cGVvZiBhJiZhJiYvXltBLVphLXpdW0EtWmEtejAtOV86XFwtXFwuXSokLy50ZXN0KGEpfSxwYT1mdW5jdGlvbihhKXt2YXIgYjtpZihcInN0cmluZ1wiPT10eXBlb2YgYSYmYT8oYj1hLGE9e30pOlwib2JqZWN0XCI9PXR5cGVvZiBhJiZhJiZcInN0cmluZ1wiPT10eXBlb2YgYS50eXBlJiZhLnR5cGUmJihiPWEudHlwZSksYil7Yj1iLnRvTG93ZXJDYXNlKCksIWEudGFyZ2V0JiYoL14oY29weXxhZnRlcmNvcHl8X2NsaWNrKSQvLnRlc3QoYil8fFwiZXJyb3JcIj09PWImJlwiY2xpcGJvYXJkLWVycm9yXCI9PT1hLm5hbWUpJiYoYS50YXJnZXQ9ZSksQShhLHt0eXBlOmIsdGFyZ2V0OmEudGFyZ2V0fHxkfHxudWxsLHJlbGF0ZWRUYXJnZXQ6YS5yZWxhdGVkVGFyZ2V0fHxudWxsLGN1cnJlbnRUYXJnZXQ6TyYmTy5icmlkZ2V8fG51bGwsdGltZVN0YW1wOmEudGltZVN0YW1wfHx0KCl8fG51bGx9KTt2YXIgYz1WW2EudHlwZV07cmV0dXJuXCJlcnJvclwiPT09YS50eXBlJiZhLm5hbWUmJmMmJihjPWNbYS5uYW1lXSksYyYmKGEubWVzc2FnZT1jKSxcInJlYWR5XCI9PT1hLnR5cGUmJkEoYSx7dGFyZ2V0Om51bGwsdmVyc2lvbjpPLnZlcnNpb259KSxcImVycm9yXCI9PT1hLnR5cGUmJihZLnRlc3QoYS5uYW1lKSYmQShhLHt0YXJnZXQ6bnVsbCxtaW5pbXVtVmVyc2lvbjpQfSksWi50ZXN0KGEubmFtZSkmJkEoYSx7dmVyc2lvbjpPLnZlcnNpb259KSksXCJjb3B5XCI9PT1hLnR5cGUmJihhLmNsaXBib2FyZERhdGE9e3NldERhdGE6WGEuc2V0RGF0YSxjbGVhckRhdGE6WGEuY2xlYXJEYXRhfSksXCJhZnRlcmNvcHlcIj09PWEudHlwZSYmKGE9RmEoYSxTKSksYS50YXJnZXQmJiFhLnJlbGF0ZWRUYXJnZXQmJihhLnJlbGF0ZWRUYXJnZXQ9cWEoYS50YXJnZXQpKSxyYShhKX19LHFhPWZ1bmN0aW9uKGEpe3ZhciBiPWEmJmEuZ2V0QXR0cmlidXRlJiZhLmdldEF0dHJpYnV0ZShcImRhdGEtY2xpcGJvYXJkLXRhcmdldFwiKTtyZXR1cm4gYj9nLmdldEVsZW1lbnRCeUlkKGIpOm51bGx9LHJhPWZ1bmN0aW9uKGEpe2lmKGEmJi9eXyg/OmNsaWNrfG1vdXNlKD86b3ZlcnxvdXR8ZG93bnx1cHxtb3ZlKSkkLy50ZXN0KGEudHlwZSkpe3ZhciBjPWEudGFyZ2V0LGQ9XCJfbW91c2VvdmVyXCI9PT1hLnR5cGUmJmEucmVsYXRlZFRhcmdldD9hLnJlbGF0ZWRUYXJnZXQ6YixlPVwiX21vdXNlb3V0XCI9PT1hLnR5cGUmJmEucmVsYXRlZFRhcmdldD9hLnJlbGF0ZWRUYXJnZXQ6YixoPU9hKGMpLGk9Zi5zY3JlZW5MZWZ0fHxmLnNjcmVlblh8fDAsaj1mLnNjcmVlblRvcHx8Zi5zY3JlZW5ZfHwwLGs9Zy5ib2R5LnNjcm9sbExlZnQrZy5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsTGVmdCxsPWcuYm9keS5zY3JvbGxUb3ArZy5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wLG09aC5sZWZ0KyhcIm51bWJlclwiPT10eXBlb2YgYS5fc3RhZ2VYP2EuX3N0YWdlWDowKSxuPWgudG9wKyhcIm51bWJlclwiPT10eXBlb2YgYS5fc3RhZ2VZP2EuX3N0YWdlWTowKSxvPW0tayxwPW4tbCxxPWkrbyxyPWorcCxzPVwibnVtYmVyXCI9PXR5cGVvZiBhLm1vdmVtZW50WD9hLm1vdmVtZW50WDowLHQ9XCJudW1iZXJcIj09dHlwZW9mIGEubW92ZW1lbnRZP2EubW92ZW1lbnRZOjA7ZGVsZXRlIGEuX3N0YWdlWCxkZWxldGUgYS5fc3RhZ2VZLEEoYSx7c3JjRWxlbWVudDpjLGZyb21FbGVtZW50OmQsdG9FbGVtZW50OmUsc2NyZWVuWDpxLHNjcmVlblk6cixwYWdlWDptLHBhZ2VZOm4sY2xpZW50WDpvLGNsaWVudFk6cCx4Om8seTpwLG1vdmVtZW50WDpzLG1vdmVtZW50WTp0LG9mZnNldFg6MCxvZmZzZXRZOjAsbGF5ZXJYOjAsbGF5ZXJZOjB9KX1yZXR1cm4gYX0sc2E9ZnVuY3Rpb24oYSl7dmFyIGI9YSYmXCJzdHJpbmdcIj09dHlwZW9mIGEudHlwZSYmYS50eXBlfHxcIlwiO3JldHVybiEvXig/Oig/OmJlZm9yZSk/Y29weXxkZXN0cm95KSQvLnRlc3QoYil9LHRhPWZ1bmN0aW9uKGEsYixjLGQpe2Q/aShmdW5jdGlvbigpe2EuYXBwbHkoYixjKX0sMCk6YS5hcHBseShiLGMpfSx1YT1mdW5jdGlvbihhKXtpZihcIm9iamVjdFwiPT10eXBlb2YgYSYmYSYmYS50eXBlKXt2YXIgYj1zYShhKSxjPVFbXCIqXCJdfHxbXSxkPVFbYS50eXBlXXx8W10sZT1jLmNvbmNhdChkKTtpZihlJiZlLmxlbmd0aCl7dmFyIGcsaCxpLGosayxsPXRoaXM7Zm9yKGc9MCxoPWUubGVuZ3RoO2g+ZztnKyspaT1lW2ddLGo9bCxcInN0cmluZ1wiPT10eXBlb2YgaSYmXCJmdW5jdGlvblwiPT10eXBlb2YgZltpXSYmKGk9ZltpXSksXCJvYmplY3RcIj09dHlwZW9mIGkmJmkmJlwiZnVuY3Rpb25cIj09dHlwZW9mIGkuaGFuZGxlRXZlbnQmJihqPWksaT1pLmhhbmRsZUV2ZW50KSxcImZ1bmN0aW9uXCI9PXR5cGVvZiBpJiYoaz1BKHt9LGEpLHRhKGksaixba10sYikpfXJldHVybiB0aGlzfX0sdmE9ZnVuY3Rpb24oYSl7dmFyIGI9bnVsbDtyZXR1cm4oTj09PSExfHxhJiZcImVycm9yXCI9PT1hLnR5cGUmJmEubmFtZSYmLTEhPT1XLmluZGV4T2YoYS5uYW1lKSkmJihiPSExKSxifSx3YT1mdW5jdGlvbihhKXt2YXIgYj1hLnRhcmdldHx8ZHx8bnVsbCxmPVwic3dmXCI9PT1hLl9zb3VyY2U7c3dpdGNoKGRlbGV0ZSBhLl9zb3VyY2UsYS50eXBlKXtjYXNlXCJlcnJvclwiOnZhciBnPVwiZmxhc2gtc2FuZGJveGVkXCI9PT1hLm5hbWV8fHZhKGEpO1wiYm9vbGVhblwiPT10eXBlb2YgZyYmKE8uc2FuZGJveGVkPWcpLC0xIT09WC5pbmRleE9mKGEubmFtZSk/QShPLHtkaXNhYmxlZDpcImZsYXNoLWRpc2FibGVkXCI9PT1hLm5hbWUsb3V0ZGF0ZWQ6XCJmbGFzaC1vdXRkYXRlZFwiPT09YS5uYW1lLHVuYXZhaWxhYmxlOlwiZmxhc2gtdW5hdmFpbGFibGVcIj09PWEubmFtZSxkZWdyYWRlZDpcImZsYXNoLWRlZ3JhZGVkXCI9PT1hLm5hbWUsZGVhY3RpdmF0ZWQ6XCJmbGFzaC1kZWFjdGl2YXRlZFwiPT09YS5uYW1lLG92ZXJkdWU6XCJmbGFzaC1vdmVyZHVlXCI9PT1hLm5hbWUscmVhZHk6ITF9KTpcInZlcnNpb24tbWlzbWF0Y2hcIj09PWEubmFtZSYmKGM9YS5zd2ZWZXJzaW9uLEEoTyx7ZGlzYWJsZWQ6ITEsb3V0ZGF0ZWQ6ITEsdW5hdmFpbGFibGU6ITEsZGVncmFkZWQ6ITEsZGVhY3RpdmF0ZWQ6ITEsb3ZlcmR1ZTohMSxyZWFkeTohMX0pKSxRYSgpO2JyZWFrO2Nhc2VcInJlYWR5XCI6Yz1hLnN3ZlZlcnNpb247dmFyIGg9Ty5kZWFjdGl2YXRlZD09PSEwO0EoTyx7ZGlzYWJsZWQ6ITEsb3V0ZGF0ZWQ6ITEsc2FuZGJveGVkOiExLHVuYXZhaWxhYmxlOiExLGRlZ3JhZGVkOiExLGRlYWN0aXZhdGVkOiExLG92ZXJkdWU6aCxyZWFkeTohaH0pLFFhKCk7YnJlYWs7Y2FzZVwiYmVmb3JlY29weVwiOmU9YjticmVhaztjYXNlXCJjb3B5XCI6dmFyIGksaixrPWEucmVsYXRlZFRhcmdldDshUltcInRleHQvaHRtbFwiXSYmIVJbXCJ0ZXh0L3BsYWluXCJdJiZrJiYoaj1rLnZhbHVlfHxrLm91dGVySFRNTHx8ay5pbm5lckhUTUwpJiYoaT1rLnZhbHVlfHxrLnRleHRDb250ZW50fHxrLmlubmVyVGV4dCk/KGEuY2xpcGJvYXJkRGF0YS5jbGVhckRhdGEoKSxhLmNsaXBib2FyZERhdGEuc2V0RGF0YShcInRleHQvcGxhaW5cIixpKSxqIT09aSYmYS5jbGlwYm9hcmREYXRhLnNldERhdGEoXCJ0ZXh0L2h0bWxcIixqKSk6IVJbXCJ0ZXh0L3BsYWluXCJdJiZhLnRhcmdldCYmKGk9YS50YXJnZXQuZ2V0QXR0cmlidXRlKFwiZGF0YS1jbGlwYm9hcmQtdGV4dFwiKSkmJihhLmNsaXBib2FyZERhdGEuY2xlYXJEYXRhKCksYS5jbGlwYm9hcmREYXRhLnNldERhdGEoXCJ0ZXh0L3BsYWluXCIsaSkpO2JyZWFrO2Nhc2VcImFmdGVyY29weVwiOnhhKGEpLFhhLmNsZWFyRGF0YSgpLGImJmIhPT1LYSgpJiZiLmZvY3VzJiZiLmZvY3VzKCk7YnJlYWs7Y2FzZVwiX21vdXNlb3ZlclwiOlhhLmZvY3VzKGIpLCQuYnViYmxlRXZlbnRzPT09ITAmJmYmJihiJiZiIT09YS5yZWxhdGVkVGFyZ2V0JiYhRihhLnJlbGF0ZWRUYXJnZXQsYikmJnlhKEEoe30sYSx7dHlwZTpcIm1vdXNlZW50ZXJcIixidWJibGVzOiExLGNhbmNlbGFibGU6ITF9KSkseWEoQSh7fSxhLHt0eXBlOlwibW91c2VvdmVyXCJ9KSkpO2JyZWFrO2Nhc2VcIl9tb3VzZW91dFwiOlhhLmJsdXIoKSwkLmJ1YmJsZUV2ZW50cz09PSEwJiZmJiYoYiYmYiE9PWEucmVsYXRlZFRhcmdldCYmIUYoYS5yZWxhdGVkVGFyZ2V0LGIpJiZ5YShBKHt9LGEse3R5cGU6XCJtb3VzZWxlYXZlXCIsYnViYmxlczohMSxjYW5jZWxhYmxlOiExfSkpLHlhKEEoe30sYSx7dHlwZTpcIm1vdXNlb3V0XCJ9KSkpO2JyZWFrO2Nhc2VcIl9tb3VzZWRvd25cIjpMYShiLCQuYWN0aXZlQ2xhc3MpLCQuYnViYmxlRXZlbnRzPT09ITAmJmYmJnlhKEEoe30sYSx7dHlwZTphLnR5cGUuc2xpY2UoMSl9KSk7YnJlYWs7Y2FzZVwiX21vdXNldXBcIjpNYShiLCQuYWN0aXZlQ2xhc3MpLCQuYnViYmxlRXZlbnRzPT09ITAmJmYmJnlhKEEoe30sYSx7dHlwZTphLnR5cGUuc2xpY2UoMSl9KSk7YnJlYWs7Y2FzZVwiX2NsaWNrXCI6ZT1udWxsLCQuYnViYmxlRXZlbnRzPT09ITAmJmYmJnlhKEEoe30sYSx7dHlwZTphLnR5cGUuc2xpY2UoMSl9KSk7YnJlYWs7Y2FzZVwiX21vdXNlbW92ZVwiOiQuYnViYmxlRXZlbnRzPT09ITAmJmYmJnlhKEEoe30sYSx7dHlwZTphLnR5cGUuc2xpY2UoMSl9KSl9cmV0dXJuL15fKD86Y2xpY2t8bW91c2UoPzpvdmVyfG91dHxkb3dufHVwfG1vdmUpKSQvLnRlc3QoYS50eXBlKT8hMDp2b2lkIDB9LHhhPWZ1bmN0aW9uKGEpe2lmKGEuZXJyb3JzJiZhLmVycm9ycy5sZW5ndGg+MCl7dmFyIGI9QihhKTtBKGIse3R5cGU6XCJlcnJvclwiLG5hbWU6XCJjbGlwYm9hcmQtZXJyb3JcIn0pLGRlbGV0ZSBiLnN1Y2Nlc3MsaShmdW5jdGlvbigpe1hhLmVtaXQoYil9LDApfX0seWE9ZnVuY3Rpb24oYSl7aWYoYSYmXCJzdHJpbmdcIj09dHlwZW9mIGEudHlwZSYmYSl7dmFyIGIsYz1hLnRhcmdldHx8bnVsbCxkPWMmJmMub3duZXJEb2N1bWVudHx8ZyxlPXt2aWV3OmQuZGVmYXVsdFZpZXd8fGYsY2FuQnViYmxlOiEwLGNhbmNlbGFibGU6ITAsZGV0YWlsOlwiY2xpY2tcIj09PWEudHlwZT8xOjAsYnV0dG9uOlwibnVtYmVyXCI9PXR5cGVvZiBhLndoaWNoP2Eud2hpY2gtMTpcIm51bWJlclwiPT10eXBlb2YgYS5idXR0b24/YS5idXR0b246ZC5jcmVhdGVFdmVudD8wOjF9LGg9QShlLGEpO2MmJmQuY3JlYXRlRXZlbnQmJmMuZGlzcGF0Y2hFdmVudCYmKGg9W2gudHlwZSxoLmNhbkJ1YmJsZSxoLmNhbmNlbGFibGUsaC52aWV3LGguZGV0YWlsLGguc2NyZWVuWCxoLnNjcmVlblksaC5jbGllbnRYLGguY2xpZW50WSxoLmN0cmxLZXksaC5hbHRLZXksaC5zaGlmdEtleSxoLm1ldGFLZXksaC5idXR0b24saC5yZWxhdGVkVGFyZ2V0XSxiPWQuY3JlYXRlRXZlbnQoXCJNb3VzZUV2ZW50c1wiKSxiLmluaXRNb3VzZUV2ZW50JiYoYi5pbml0TW91c2VFdmVudC5hcHBseShiLGgpLGIuX3NvdXJjZT1cImpzXCIsYy5kaXNwYXRjaEV2ZW50KGIpKSl9fSx6YT1mdW5jdGlvbigpe3ZhciBhPSQuZmxhc2hMb2FkVGltZW91dDtpZihcIm51bWJlclwiPT10eXBlb2YgYSYmYT49MCl7dmFyIGI9TWF0aC5taW4oMWUzLGEvMTApLGM9JC5zd2ZPYmplY3RJZCtcIl9mYWxsYmFja0NvbnRlbnRcIjtVPWsoZnVuY3Rpb24oKXt2YXIgYT1nLmdldEVsZW1lbnRCeUlkKGMpO1BhKGEpJiYoUWEoKSxPLmRlYWN0aXZhdGVkPW51bGwsWGEuZW1pdCh7dHlwZTpcImVycm9yXCIsbmFtZTpcInN3Zi1ub3QtZm91bmRcIn0pKX0sYil9fSxBYT1mdW5jdGlvbigpe3ZhciBhPWcuY3JlYXRlRWxlbWVudChcImRpdlwiKTtyZXR1cm4gYS5pZD0kLmNvbnRhaW5lcklkLGEuY2xhc3NOYW1lPSQuY29udGFpbmVyQ2xhc3MsYS5zdHlsZS5wb3NpdGlvbj1cImFic29sdXRlXCIsYS5zdHlsZS5sZWZ0PVwiMHB4XCIsYS5zdHlsZS50b3A9XCItOTk5OXB4XCIsYS5zdHlsZS53aWR0aD1cIjFweFwiLGEuc3R5bGUuaGVpZ2h0PVwiMXB4XCIsYS5zdHlsZS56SW5kZXg9XCJcIitUYSgkLnpJbmRleCksYX0sQmE9ZnVuY3Rpb24oYSl7Zm9yKHZhciBiPWEmJmEucGFyZW50Tm9kZTtiJiZcIk9CSkVDVFwiPT09Yi5ub2RlTmFtZSYmYi5wYXJlbnROb2RlOyliPWIucGFyZW50Tm9kZTtyZXR1cm4gYnx8bnVsbH0sQ2E9ZnVuY3Rpb24oKXt2YXIgYSxiPU8uYnJpZGdlLGM9QmEoYik7aWYoIWIpe3ZhciBkPUphKGYubG9jYXRpb24uaG9zdCwkKSxlPVwibmV2ZXJcIj09PWQ/XCJub25lXCI6XCJhbGxcIixoPUhhKEEoe2pzVmVyc2lvbjpYYS52ZXJzaW9ufSwkKSksaT0kLnN3ZlBhdGgrR2EoJC5zd2ZQYXRoLCQpO2M9QWEoKTt2YXIgaj1nLmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7Yy5hcHBlbmRDaGlsZChqKSxnLmJvZHkuYXBwZW5kQ2hpbGQoYyk7dmFyIGs9Zy5jcmVhdGVFbGVtZW50KFwiZGl2XCIpLGw9XCJhY3RpdmV4XCI9PT1PLnBsdWdpblR5cGU7ay5pbm5lckhUTUw9JzxvYmplY3QgaWQ9XCInKyQuc3dmT2JqZWN0SWQrJ1wiIG5hbWU9XCInKyQuc3dmT2JqZWN0SWQrJ1wiIHdpZHRoPVwiMTAwJVwiIGhlaWdodD1cIjEwMCVcIiAnKyhsPydjbGFzc2lkPVwiY2xzaWQ6ZDI3Y2RiNmUtYWU2ZC0xMWNmLTk2YjgtNDQ0NTUzNTQwMDAwXCInOid0eXBlPVwiYXBwbGljYXRpb24veC1zaG9ja3dhdmUtZmxhc2hcIiBkYXRhPVwiJytpKydcIicpK1wiPlwiKyhsPyc8cGFyYW0gbmFtZT1cIm1vdmllXCIgdmFsdWU9XCInK2krJ1wiLz4nOlwiXCIpKyc8cGFyYW0gbmFtZT1cImFsbG93U2NyaXB0QWNjZXNzXCIgdmFsdWU9XCInK2QrJ1wiLz48cGFyYW0gbmFtZT1cImFsbG93TmV0d29ya2luZ1wiIHZhbHVlPVwiJytlKydcIi8+PHBhcmFtIG5hbWU9XCJtZW51XCIgdmFsdWU9XCJmYWxzZVwiLz48cGFyYW0gbmFtZT1cIndtb2RlXCIgdmFsdWU9XCJ0cmFuc3BhcmVudFwiLz48cGFyYW0gbmFtZT1cImZsYXNodmFyc1wiIHZhbHVlPVwiJytoKydcIi8+PGRpdiBpZD1cIicrJC5zd2ZPYmplY3RJZCsnX2ZhbGxiYWNrQ29udGVudFwiPiZuYnNwOzwvZGl2Pjwvb2JqZWN0PicsYj1rLmZpcnN0Q2hpbGQsaz1udWxsLHkoYikuWmVyb0NsaXBib2FyZD1YYSxjLnJlcGxhY2VDaGlsZChiLGopLHphKCl9cmV0dXJuIGJ8fChiPWdbJC5zd2ZPYmplY3RJZF0sYiYmKGE9Yi5sZW5ndGgpJiYoYj1iW2EtMV0pLCFiJiZjJiYoYj1jLmZpcnN0Q2hpbGQpKSxPLmJyaWRnZT1ifHxudWxsLGJ9LERhPWZ1bmN0aW9uKCl7dmFyIGE9Ty5icmlkZ2U7aWYoYSl7dmFyIGQ9QmEoYSk7ZCYmKFwiYWN0aXZleFwiPT09Ty5wbHVnaW5UeXBlJiZcInJlYWR5U3RhdGVcImluIGE/KGEuc3R5bGUuZGlzcGxheT1cIm5vbmVcIixmdW5jdGlvbiBlKCl7aWYoND09PWEucmVhZHlTdGF0ZSl7Zm9yKHZhciBiIGluIGEpXCJmdW5jdGlvblwiPT10eXBlb2YgYVtiXSYmKGFbYl09bnVsbCk7YS5wYXJlbnROb2RlJiZhLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoYSksZC5wYXJlbnROb2RlJiZkLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZCl9ZWxzZSBpKGUsMTApfSgpKTooYS5wYXJlbnROb2RlJiZhLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoYSksZC5wYXJlbnROb2RlJiZkLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZCkpKSxRYSgpLE8ucmVhZHk9bnVsbCxPLmJyaWRnZT1udWxsLE8uZGVhY3RpdmF0ZWQ9bnVsbCxjPWJ9fSxFYT1mdW5jdGlvbihhKXt2YXIgYj17fSxjPXt9O2lmKFwib2JqZWN0XCI9PXR5cGVvZiBhJiZhKXtmb3IodmFyIGQgaW4gYSlpZihkJiZ3LmNhbGwoYSxkKSYmXCJzdHJpbmdcIj09dHlwZW9mIGFbZF0mJmFbZF0pc3dpdGNoKGQudG9Mb3dlckNhc2UoKSl7Y2FzZVwidGV4dC9wbGFpblwiOmNhc2VcInRleHRcIjpjYXNlXCJhaXI6dGV4dFwiOmNhc2VcImZsYXNoOnRleHRcIjpiLnRleHQ9YVtkXSxjLnRleHQ9ZDticmVhaztjYXNlXCJ0ZXh0L2h0bWxcIjpjYXNlXCJodG1sXCI6Y2FzZVwiYWlyOmh0bWxcIjpjYXNlXCJmbGFzaDpodG1sXCI6Yi5odG1sPWFbZF0sYy5odG1sPWQ7YnJlYWs7Y2FzZVwiYXBwbGljYXRpb24vcnRmXCI6Y2FzZVwidGV4dC9ydGZcIjpjYXNlXCJydGZcIjpjYXNlXCJyaWNodGV4dFwiOmNhc2VcImFpcjpydGZcIjpjYXNlXCJmbGFzaDpydGZcIjpiLnJ0Zj1hW2RdLGMucnRmPWR9cmV0dXJue2RhdGE6Yixmb3JtYXRNYXA6Y319fSxGYT1mdW5jdGlvbihhLGIpe2lmKFwib2JqZWN0XCIhPXR5cGVvZiBhfHwhYXx8XCJvYmplY3RcIiE9dHlwZW9mIGJ8fCFiKXJldHVybiBhO3ZhciBjPXt9O2Zvcih2YXIgZCBpbiBhKWlmKHcuY2FsbChhLGQpKWlmKFwiZXJyb3JzXCI9PT1kKXtjW2RdPWFbZF0/YVtkXS5zbGljZSgpOltdO2Zvcih2YXIgZT0wLGY9Y1tkXS5sZW5ndGg7Zj5lO2UrKyljW2RdW2VdLmZvcm1hdD1iW2NbZF1bZV0uZm9ybWF0XX1lbHNlIGlmKFwic3VjY2Vzc1wiIT09ZCYmXCJkYXRhXCIhPT1kKWNbZF09YVtkXTtlbHNle2NbZF09e307dmFyIGc9YVtkXTtmb3IodmFyIGggaW4gZyloJiZ3LmNhbGwoZyxoKSYmdy5jYWxsKGIsaCkmJihjW2RdW2JbaF1dPWdbaF0pfXJldHVybiBjfSxHYT1mdW5jdGlvbihhLGIpe3ZhciBjPW51bGw9PWJ8fGImJmIuY2FjaGVCdXN0PT09ITA7cmV0dXJuIGM/KC0xPT09YS5pbmRleE9mKFwiP1wiKT9cIj9cIjpcIiZcIikrXCJub0NhY2hlPVwiK3QoKTpcIlwifSxIYT1mdW5jdGlvbihhKXt2YXIgYixjLGQsZSxnPVwiXCIsaD1bXTtpZihhLnRydXN0ZWREb21haW5zJiYoXCJzdHJpbmdcIj09dHlwZW9mIGEudHJ1c3RlZERvbWFpbnM/ZT1bYS50cnVzdGVkRG9tYWluc106XCJvYmplY3RcIj09dHlwZW9mIGEudHJ1c3RlZERvbWFpbnMmJlwibGVuZ3RoXCJpbiBhLnRydXN0ZWREb21haW5zJiYoZT1hLnRydXN0ZWREb21haW5zKSksZSYmZS5sZW5ndGgpZm9yKGI9MCxjPWUubGVuZ3RoO2M+YjtiKyspaWYody5jYWxsKGUsYikmJmVbYl0mJlwic3RyaW5nXCI9PXR5cGVvZiBlW2JdKXtpZihkPUlhKGVbYl0pLCFkKWNvbnRpbnVlO2lmKFwiKlwiPT09ZCl7aC5sZW5ndGg9MCxoLnB1c2goZCk7YnJlYWt9aC5wdXNoLmFwcGx5KGgsW2QsXCIvL1wiK2QsZi5sb2NhdGlvbi5wcm90b2NvbCtcIi8vXCIrZF0pfXJldHVybiBoLmxlbmd0aCYmKGcrPVwidHJ1c3RlZE9yaWdpbnM9XCIrbihoLmpvaW4oXCIsXCIpKSksYS5mb3JjZUVuaGFuY2VkQ2xpcGJvYXJkPT09ITAmJihnKz0oZz9cIiZcIjpcIlwiKStcImZvcmNlRW5oYW5jZWRDbGlwYm9hcmQ9dHJ1ZVwiKSxcInN0cmluZ1wiPT10eXBlb2YgYS5zd2ZPYmplY3RJZCYmYS5zd2ZPYmplY3RJZCYmKGcrPShnP1wiJlwiOlwiXCIpK1wic3dmT2JqZWN0SWQ9XCIrbihhLnN3Zk9iamVjdElkKSksXCJzdHJpbmdcIj09dHlwZW9mIGEuanNWZXJzaW9uJiZhLmpzVmVyc2lvbiYmKGcrPShnP1wiJlwiOlwiXCIpK1wianNWZXJzaW9uPVwiK24oYS5qc1ZlcnNpb24pKSxnfSxJYT1mdW5jdGlvbihhKXtpZihudWxsPT1hfHxcIlwiPT09YSlyZXR1cm4gbnVsbDtpZihhPWEucmVwbGFjZSgvXlxccyt8XFxzKyQvZyxcIlwiKSxcIlwiPT09YSlyZXR1cm4gbnVsbDt2YXIgYj1hLmluZGV4T2YoXCIvL1wiKTthPS0xPT09Yj9hOmEuc2xpY2UoYisyKTt2YXIgYz1hLmluZGV4T2YoXCIvXCIpO3JldHVybiBhPS0xPT09Yz9hOi0xPT09Ynx8MD09PWM/bnVsbDphLnNsaWNlKDAsYyksYSYmXCIuc3dmXCI9PT1hLnNsaWNlKC00KS50b0xvd2VyQ2FzZSgpP251bGw6YXx8bnVsbH0sSmE9ZnVuY3Rpb24oKXt2YXIgYT1mdW5jdGlvbihhKXt2YXIgYixjLGQsZT1bXTtpZihcInN0cmluZ1wiPT10eXBlb2YgYSYmKGE9W2FdKSxcIm9iamVjdFwiIT10eXBlb2YgYXx8IWF8fFwibnVtYmVyXCIhPXR5cGVvZiBhLmxlbmd0aClyZXR1cm4gZTtmb3IoYj0wLGM9YS5sZW5ndGg7Yz5iO2IrKylpZih3LmNhbGwoYSxiKSYmKGQ9SWEoYVtiXSkpKXtpZihcIipcIj09PWQpe2UubGVuZ3RoPTAsZS5wdXNoKFwiKlwiKTticmVha30tMT09PWUuaW5kZXhPZihkKSYmZS5wdXNoKGQpfXJldHVybiBlfTtyZXR1cm4gZnVuY3Rpb24oYixjKXt2YXIgZD1JYShjLnN3ZlBhdGgpO251bGw9PT1kJiYoZD1iKTt2YXIgZT1hKGMudHJ1c3RlZERvbWFpbnMpLGY9ZS5sZW5ndGg7aWYoZj4wKXtpZigxPT09ZiYmXCIqXCI9PT1lWzBdKXJldHVyblwiYWx3YXlzXCI7aWYoLTEhPT1lLmluZGV4T2YoYikpcmV0dXJuIDE9PT1mJiZiPT09ZD9cInNhbWVEb21haW5cIjpcImFsd2F5c1wifXJldHVyblwibmV2ZXJcIn19KCksS2E9ZnVuY3Rpb24oKXt0cnl7cmV0dXJuIGcuYWN0aXZlRWxlbWVudH1jYXRjaChhKXtyZXR1cm4gbnVsbH19LExhPWZ1bmN0aW9uKGEsYil7dmFyIGMsZCxlLGY9W107aWYoXCJzdHJpbmdcIj09dHlwZW9mIGImJmImJihmPWIuc3BsaXQoL1xccysvKSksYSYmMT09PWEubm9kZVR5cGUmJmYubGVuZ3RoPjApe2ZvcihlPShcIiBcIisoYS5jbGFzc05hbWV8fFwiXCIpK1wiIFwiKS5yZXBsYWNlKC9bXFx0XFxyXFxuXFxmXS9nLFwiIFwiKSxjPTAsZD1mLmxlbmd0aDtkPmM7YysrKS0xPT09ZS5pbmRleE9mKFwiIFwiK2ZbY10rXCIgXCIpJiYoZSs9ZltjXStcIiBcIik7ZT1lLnJlcGxhY2UoL15cXHMrfFxccyskL2csXCJcIiksZSE9PWEuY2xhc3NOYW1lJiYoYS5jbGFzc05hbWU9ZSl9cmV0dXJuIGF9LE1hPWZ1bmN0aW9uKGEsYil7dmFyIGMsZCxlLGY9W107aWYoXCJzdHJpbmdcIj09dHlwZW9mIGImJmImJihmPWIuc3BsaXQoL1xccysvKSksYSYmMT09PWEubm9kZVR5cGUmJmYubGVuZ3RoPjAmJmEuY2xhc3NOYW1lKXtmb3IoZT0oXCIgXCIrYS5jbGFzc05hbWUrXCIgXCIpLnJlcGxhY2UoL1tcXHRcXHJcXG5cXGZdL2csXCIgXCIpLGM9MCxkPWYubGVuZ3RoO2Q+YztjKyspZT1lLnJlcGxhY2UoXCIgXCIrZltjXStcIiBcIixcIiBcIik7ZT1lLnJlcGxhY2UoL15cXHMrfFxccyskL2csXCJcIiksZSE9PWEuY2xhc3NOYW1lJiYoYS5jbGFzc05hbWU9ZSl9cmV0dXJuIGF9LE5hPWZ1bmN0aW9uKGEsYil7dmFyIGM9bShhLG51bGwpLmdldFByb3BlcnR5VmFsdWUoYik7cmV0dXJuXCJjdXJzb3JcIiE9PWJ8fGMmJlwiYXV0b1wiIT09Y3x8XCJBXCIhPT1hLm5vZGVOYW1lP2M6XCJwb2ludGVyXCJ9LE9hPWZ1bmN0aW9uKGEpe3ZhciBiPXtsZWZ0OjAsdG9wOjAsd2lkdGg6MCxoZWlnaHQ6MH07aWYoYS5nZXRCb3VuZGluZ0NsaWVudFJlY3Qpe3ZhciBjPWEuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksZD1mLnBhZ2VYT2Zmc2V0LGU9Zi5wYWdlWU9mZnNldCxoPWcuZG9jdW1lbnRFbGVtZW50LmNsaWVudExlZnR8fDAsaT1nLmRvY3VtZW50RWxlbWVudC5jbGllbnRUb3B8fDAsaj0wLGs9MDtpZihcInJlbGF0aXZlXCI9PT1OYShnLmJvZHksXCJwb3NpdGlvblwiKSl7dmFyIGw9Zy5ib2R5LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLG09Zy5kb2N1bWVudEVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7aj1sLmxlZnQtbS5sZWZ0fHwwLGs9bC50b3AtbS50b3B8fDB9Yi5sZWZ0PWMubGVmdCtkLWgtaixiLnRvcD1jLnRvcCtlLWktayxiLndpZHRoPVwid2lkdGhcImluIGM/Yy53aWR0aDpjLnJpZ2h0LWMubGVmdCxiLmhlaWdodD1cImhlaWdodFwiaW4gYz9jLmhlaWdodDpjLmJvdHRvbS1jLnRvcH1yZXR1cm4gYn0sUGE9ZnVuY3Rpb24oYSl7aWYoIWEpcmV0dXJuITE7dmFyIGI9bShhLG51bGwpO2lmKCFiKXJldHVybiExO3ZhciBjPXIoYi5oZWlnaHQpPjAsZD1yKGIud2lkdGgpPjAsZT1yKGIudG9wKT49MCxmPXIoYi5sZWZ0KT49MCxnPWMmJmQmJmUmJmYsaD1nP251bGw6T2EoYSksaT1cIm5vbmVcIiE9PWIuZGlzcGxheSYmXCJjb2xsYXBzZVwiIT09Yi52aXNpYmlsaXR5JiYoZ3x8ISFoJiYoY3x8aC5oZWlnaHQ+MCkmJihkfHxoLndpZHRoPjApJiYoZXx8aC50b3A+PTApJiYoZnx8aC5sZWZ0Pj0wKSk7cmV0dXJuIGl9LFFhPWZ1bmN0aW9uKCl7aihUKSxUPTAsbChVKSxVPTB9LFJhPWZ1bmN0aW9uKCl7dmFyIGE7aWYoZCYmKGE9QmEoTy5icmlkZ2UpKSl7dmFyIGI9T2EoZCk7QShhLnN0eWxlLHt3aWR0aDpiLndpZHRoK1wicHhcIixoZWlnaHQ6Yi5oZWlnaHQrXCJweFwiLHRvcDpiLnRvcCtcInB4XCIsbGVmdDpiLmxlZnQrXCJweFwiLHpJbmRleDpcIlwiK1RhKCQuekluZGV4KX0pfX0sU2E9ZnVuY3Rpb24oYSl7Ty5yZWFkeT09PSEwJiYoTy5icmlkZ2UmJlwiZnVuY3Rpb25cIj09dHlwZW9mIE8uYnJpZGdlLnNldEhhbmRDdXJzb3I/Ty5icmlkZ2Uuc2V0SGFuZEN1cnNvcihhKTpPLnJlYWR5PSExKX0sVGE9ZnVuY3Rpb24oYSl7aWYoL14oPzphdXRvfGluaGVyaXQpJC8udGVzdChhKSlyZXR1cm4gYTt2YXIgYjtyZXR1cm5cIm51bWJlclwiIT10eXBlb2YgYXx8cyhhKT9cInN0cmluZ1wiPT10eXBlb2YgYSYmKGI9VGEocShhLDEwKSkpOmI9YSxcIm51bWJlclwiPT10eXBlb2YgYj9iOlwiYXV0b1wifSxVYT1mdW5jdGlvbihhKXt2YXIgYj0vKFxcclxcbnxcXHJ8XFxuKS9nO3JldHVyblwic3RyaW5nXCI9PXR5cGVvZiBhJiYkLmZpeExpbmVFbmRpbmdzPT09ITAmJihNKCk/LygoXnxbXlxccl0pXFxufFxccihbXlxcbl18JCkpLy50ZXN0KGEpJiYoYT1hLnJlcGxhY2UoYixcIlxcclxcblwiKSk6L1xcci8udGVzdChhKSYmKGE9YS5yZXBsYWNlKGIsXCJcXG5cIikpKSxhfSxWYT1mdW5jdGlvbihiKXt2YXIgYyxkLGUsZj1PLnNhbmRib3hlZCxnPW51bGw7aWYoYj1iPT09ITAsTj09PSExKWc9ITE7ZWxzZXt0cnl7ZD1hLmZyYW1lRWxlbWVudHx8bnVsbH1jYXRjaChoKXtlPXtuYW1lOmgubmFtZSxtZXNzYWdlOmgubWVzc2FnZX19aWYoZCYmMT09PWQubm9kZVR5cGUmJlwiSUZSQU1FXCI9PT1kLm5vZGVOYW1lKXRyeXtnPWQuaGFzQXR0cmlidXRlKFwic2FuZGJveFwiKX1jYXRjaChoKXtnPW51bGx9ZWxzZXt0cnl7Yz1kb2N1bWVudC5kb21haW58fG51bGx9Y2F0Y2goaCl7Yz1udWxsfShudWxsPT09Y3x8ZSYmXCJTZWN1cml0eUVycm9yXCI9PT1lLm5hbWUmJi8oXnxbXFxzXFwoXFxbQF0pc2FuZGJveChlc3xlZHxpbmd8W1xcc1xcLiwhXFwpXFxdQF18JCkvLnRlc3QoZS5tZXNzYWdlLnRvTG93ZXJDYXNlKCkpKSYmKGc9ITApfX1yZXR1cm4gTy5zYW5kYm94ZWQ9ZyxmPT09Z3x8Ynx8V2EobyksZ30sV2E9ZnVuY3Rpb24oYSl7ZnVuY3Rpb24gYihhKXt2YXIgYj1hLm1hdGNoKC9bXFxkXSsvZyk7cmV0dXJuIGIubGVuZ3RoPTMsYi5qb2luKFwiLlwiKX1mdW5jdGlvbiBjKGEpe3JldHVybiEhYSYmKGE9YS50b0xvd2VyQ2FzZSgpKSYmKC9eKHBlcGZsYXNocGxheWVyXFwuZGxsfGxpYnBlcGZsYXNocGxheWVyXFwuc298cGVwcGVyZmxhc2hwbGF5ZXJcXC5wbHVnaW4pJC8udGVzdChhKXx8XCJjaHJvbWUucGx1Z2luXCI9PT1hLnNsaWNlKC0xMykpfWZ1bmN0aW9uIGQoYSl7YSYmKGk9ITAsYS52ZXJzaW9uJiYobD1iKGEudmVyc2lvbikpLCFsJiZhLmRlc2NyaXB0aW9uJiYobD1iKGEuZGVzY3JpcHRpb24pKSxhLmZpbGVuYW1lJiYoaz1jKGEuZmlsZW5hbWUpKSl9dmFyIGUsZixnLGk9ITEsaj0hMSxrPSExLGw9XCJcIjtpZihoLnBsdWdpbnMmJmgucGx1Z2lucy5sZW5ndGgpZT1oLnBsdWdpbnNbXCJTaG9ja3dhdmUgRmxhc2hcIl0sZChlKSxoLnBsdWdpbnNbXCJTaG9ja3dhdmUgRmxhc2ggMi4wXCJdJiYoaT0hMCxsPVwiMi4wLjAuMTFcIik7ZWxzZSBpZihoLm1pbWVUeXBlcyYmaC5taW1lVHlwZXMubGVuZ3RoKWc9aC5taW1lVHlwZXNbXCJhcHBsaWNhdGlvbi94LXNob2Nrd2F2ZS1mbGFzaFwiXSxlPWcmJmcuZW5hYmxlZFBsdWdpbixkKGUpO2Vsc2UgaWYoXCJ1bmRlZmluZWRcIiE9dHlwZW9mIGEpe2o9ITA7dHJ5e2Y9bmV3IGEoXCJTaG9ja3dhdmVGbGFzaC5TaG9ja3dhdmVGbGFzaC43XCIpLGk9ITAsbD1iKGYuR2V0VmFyaWFibGUoXCIkdmVyc2lvblwiKSl9Y2F0Y2gobSl7dHJ5e2Y9bmV3IGEoXCJTaG9ja3dhdmVGbGFzaC5TaG9ja3dhdmVGbGFzaC42XCIpLGk9ITAsbD1cIjYuMC4yMVwifWNhdGNoKG4pe3RyeXtmPW5ldyBhKFwiU2hvY2t3YXZlRmxhc2guU2hvY2t3YXZlRmxhc2hcIiksaT0hMCxsPWIoZi5HZXRWYXJpYWJsZShcIiR2ZXJzaW9uXCIpKX1jYXRjaChvKXtqPSExfX19fU8uZGlzYWJsZWQ9aSE9PSEwLE8ub3V0ZGF0ZWQ9bCYmcihsKTxyKFApLE8udmVyc2lvbj1sfHxcIjAuMC4wXCIsTy5wbHVnaW5UeXBlPWs/XCJwZXBwZXJcIjpqP1wiYWN0aXZleFwiOmk/XCJuZXRzY2FwZVwiOlwidW5rbm93blwifTtXYShvKSxWYSghMCk7dmFyIFhhPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMgaW5zdGFuY2VvZiBYYT92b2lkKFwiZnVuY3Rpb25cIj09dHlwZW9mIFhhLl9jcmVhdGVDbGllbnQmJlhhLl9jcmVhdGVDbGllbnQuYXBwbHkodGhpcyx6KGFyZ3VtZW50cykpKTpuZXcgWGF9O3YoWGEsXCJ2ZXJzaW9uXCIse3ZhbHVlOlwiMi4zLjAtYmV0YS4xXCIsd3JpdGFibGU6ITEsY29uZmlndXJhYmxlOiEwLGVudW1lcmFibGU6ITB9KSxYYS5jb25maWc9ZnVuY3Rpb24oKXtyZXR1cm4gXy5hcHBseSh0aGlzLHooYXJndW1lbnRzKSl9LFhhLnN0YXRlPWZ1bmN0aW9uKCl7cmV0dXJuIGFhLmFwcGx5KHRoaXMseihhcmd1bWVudHMpKX0sWGEuaXNGbGFzaFVudXNhYmxlPWZ1bmN0aW9uKCl7cmV0dXJuIGJhLmFwcGx5KHRoaXMseihhcmd1bWVudHMpKX0sWGEub249ZnVuY3Rpb24oKXtyZXR1cm4gY2EuYXBwbHkodGhpcyx6KGFyZ3VtZW50cykpfSxYYS5vZmY9ZnVuY3Rpb24oKXtyZXR1cm4gZGEuYXBwbHkodGhpcyx6KGFyZ3VtZW50cykpfSxYYS5oYW5kbGVycz1mdW5jdGlvbigpe3JldHVybiBlYS5hcHBseSh0aGlzLHooYXJndW1lbnRzKSl9LFhhLmVtaXQ9ZnVuY3Rpb24oKXtyZXR1cm4gZmEuYXBwbHkodGhpcyx6KGFyZ3VtZW50cykpfSxYYS5jcmVhdGU9ZnVuY3Rpb24oKXtyZXR1cm4gZ2EuYXBwbHkodGhpcyx6KGFyZ3VtZW50cykpfSxYYS5kZXN0cm95PWZ1bmN0aW9uKCl7cmV0dXJuIGhhLmFwcGx5KHRoaXMseihhcmd1bWVudHMpKX0sWGEuc2V0RGF0YT1mdW5jdGlvbigpe3JldHVybiBpYS5hcHBseSh0aGlzLHooYXJndW1lbnRzKSl9LFhhLmNsZWFyRGF0YT1mdW5jdGlvbigpe3JldHVybiBqYS5hcHBseSh0aGlzLHooYXJndW1lbnRzKSl9LFhhLmdldERhdGE9ZnVuY3Rpb24oKXtyZXR1cm4ga2EuYXBwbHkodGhpcyx6KGFyZ3VtZW50cykpfSxYYS5mb2N1cz1YYS5hY3RpdmF0ZT1mdW5jdGlvbigpe3JldHVybiBsYS5hcHBseSh0aGlzLHooYXJndW1lbnRzKSl9LFhhLmJsdXI9WGEuZGVhY3RpdmF0ZT1mdW5jdGlvbigpe3JldHVybiBtYS5hcHBseSh0aGlzLHooYXJndW1lbnRzKSl9LFhhLmFjdGl2ZUVsZW1lbnQ9ZnVuY3Rpb24oKXtyZXR1cm4gbmEuYXBwbHkodGhpcyx6KGFyZ3VtZW50cykpfTt2YXIgWWE9MCxaYT17fSwkYT0wLF9hPXt9LGFiPXt9O0EoJCx7YXV0b0FjdGl2YXRlOiEwfSk7dmFyIGJiPWZ1bmN0aW9uKGEpe3ZhciBiPXRoaXM7Yi5pZD1cIlwiK1lhKyssWmFbYi5pZF09e2luc3RhbmNlOmIsZWxlbWVudHM6W10saGFuZGxlcnM6e319LGEmJmIuY2xpcChhKSxYYS5vbihcIipcIixmdW5jdGlvbihhKXtyZXR1cm4gYi5lbWl0KGEpfSksWGEub24oXCJkZXN0cm95XCIsZnVuY3Rpb24oKXtiLmRlc3Ryb3koKX0pLFhhLmNyZWF0ZSgpfSxjYj1mdW5jdGlvbihhLGQpe3ZhciBlLGYsZyxoPXt9LGk9WmFbdGhpcy5pZF0saj1pJiZpLmhhbmRsZXJzO2lmKCFpKXRocm93IG5ldyBFcnJvcihcIkF0dGVtcHRlZCB0byBhZGQgbmV3IGxpc3RlbmVyKHMpIHRvIGEgZGVzdHJveWVkIFplcm9DbGlwYm9hcmQgY2xpZW50IGluc3RhbmNlXCIpO2lmKFwic3RyaW5nXCI9PXR5cGVvZiBhJiZhKWc9YS50b0xvd2VyQ2FzZSgpLnNwbGl0KC9cXHMrLyk7ZWxzZSBpZihcIm9iamVjdFwiPT10eXBlb2YgYSYmYSYmXCJ1bmRlZmluZWRcIj09dHlwZW9mIGQpZm9yKGUgaW4gYSl3LmNhbGwoYSxlKSYmXCJzdHJpbmdcIj09dHlwZW9mIGUmJmUmJlwiZnVuY3Rpb25cIj09dHlwZW9mIGFbZV0mJnRoaXMub24oZSxhW2VdKTtpZihnJiZnLmxlbmd0aCl7Zm9yKGU9MCxmPWcubGVuZ3RoO2Y+ZTtlKyspYT1nW2VdLnJlcGxhY2UoL15vbi8sXCJcIiksaFthXT0hMCxqW2FdfHwoalthXT1bXSksalthXS5wdXNoKGQpO2lmKGgucmVhZHkmJk8ucmVhZHkmJnRoaXMuZW1pdCh7dHlwZTpcInJlYWR5XCIsY2xpZW50OnRoaXN9KSxoLmVycm9yKXtmb3IoZT0wLGY9WC5sZW5ndGg7Zj5lO2UrKylpZihPW1hbZV0ucmVwbGFjZSgvXmZsYXNoLS8sXCJcIildKXt0aGlzLmVtaXQoe3R5cGU6XCJlcnJvclwiLG5hbWU6WFtlXSxjbGllbnQ6dGhpc30pO2JyZWFrfWMhPT1iJiZYYS52ZXJzaW9uIT09YyYmdGhpcy5lbWl0KHt0eXBlOlwiZXJyb3JcIixuYW1lOlwidmVyc2lvbi1taXNtYXRjaFwiLGpzVmVyc2lvbjpYYS52ZXJzaW9uLHN3ZlZlcnNpb246Y30pfX1yZXR1cm4gdGhpc30sZGI9ZnVuY3Rpb24oYSxiKXt2YXIgYyxkLGUsZixnLGg9WmFbdGhpcy5pZF0saT1oJiZoLmhhbmRsZXJzO2lmKCFpKXJldHVybiB0aGlzO2lmKDA9PT1hcmd1bWVudHMubGVuZ3RoKWY9dShpKTtlbHNlIGlmKFwic3RyaW5nXCI9PXR5cGVvZiBhJiZhKWY9YS5zcGxpdCgvXFxzKy8pO2Vsc2UgaWYoXCJvYmplY3RcIj09dHlwZW9mIGEmJmEmJlwidW5kZWZpbmVkXCI9PXR5cGVvZiBiKWZvcihjIGluIGEpdy5jYWxsKGEsYykmJlwic3RyaW5nXCI9PXR5cGVvZiBjJiZjJiZcImZ1bmN0aW9uXCI9PXR5cGVvZiBhW2NdJiZ0aGlzLm9mZihjLGFbY10pO2lmKGYmJmYubGVuZ3RoKWZvcihjPTAsZD1mLmxlbmd0aDtkPmM7YysrKWlmKGE9ZltjXS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL15vbi8sXCJcIiksZz1pW2FdLGcmJmcubGVuZ3RoKWlmKGIpZm9yKGU9Zy5pbmRleE9mKGIpOy0xIT09ZTspZy5zcGxpY2UoZSwxKSxlPWcuaW5kZXhPZihiLGUpO2Vsc2UgZy5sZW5ndGg9MDtyZXR1cm4gdGhpc30sZWI9ZnVuY3Rpb24oYSl7dmFyIGI9bnVsbCxjPVphW3RoaXMuaWRdJiZaYVt0aGlzLmlkXS5oYW5kbGVycztyZXR1cm4gYyYmKGI9XCJzdHJpbmdcIj09dHlwZW9mIGEmJmE/Y1thXT9jW2FdLnNsaWNlKDApOltdOkIoYykpLGJ9LGZiPWZ1bmN0aW9uKGEpe2lmKGtiLmNhbGwodGhpcyxhKSl7XCJvYmplY3RcIj09dHlwZW9mIGEmJmEmJlwic3RyaW5nXCI9PXR5cGVvZiBhLnR5cGUmJmEudHlwZSYmKGE9QSh7fSxhKSk7dmFyIGI9QSh7fSxwYShhKSx7Y2xpZW50OnRoaXN9KTtsYi5jYWxsKHRoaXMsYil9cmV0dXJuIHRoaXN9LGdiPWZ1bmN0aW9uKGEpe2lmKCFaYVt0aGlzLmlkXSl0aHJvdyBuZXcgRXJyb3IoXCJBdHRlbXB0ZWQgdG8gY2xpcCBlbGVtZW50KHMpIHRvIGEgZGVzdHJveWVkIFplcm9DbGlwYm9hcmQgY2xpZW50IGluc3RhbmNlXCIpO2E9bWIoYSk7Zm9yKHZhciBiPTA7YjxhLmxlbmd0aDtiKyspaWYody5jYWxsKGEsYikmJmFbYl0mJjE9PT1hW2JdLm5vZGVUeXBlKXthW2JdLnpjQ2xpcHBpbmdJZD8tMT09PV9hW2FbYl0uemNDbGlwcGluZ0lkXS5pbmRleE9mKHRoaXMuaWQpJiZfYVthW2JdLnpjQ2xpcHBpbmdJZF0ucHVzaCh0aGlzLmlkKTooYVtiXS56Y0NsaXBwaW5nSWQ9XCJ6Y0NsaXBwaW5nSWRfXCIrJGErKyxfYVthW2JdLnpjQ2xpcHBpbmdJZF09W3RoaXMuaWRdLCQuYXV0b0FjdGl2YXRlPT09ITAmJm5iKGFbYl0pKTt2YXIgYz1aYVt0aGlzLmlkXSYmWmFbdGhpcy5pZF0uZWxlbWVudHM7LTE9PT1jLmluZGV4T2YoYVtiXSkmJmMucHVzaChhW2JdKX1yZXR1cm4gdGhpc30saGI9ZnVuY3Rpb24oYSl7dmFyIGI9WmFbdGhpcy5pZF07aWYoIWIpcmV0dXJuIHRoaXM7dmFyIGMsZD1iLmVsZW1lbnRzO2E9XCJ1bmRlZmluZWRcIj09dHlwZW9mIGE/ZC5zbGljZSgwKTptYihhKTtmb3IodmFyIGU9YS5sZW5ndGg7ZS0tOylpZih3LmNhbGwoYSxlKSYmYVtlXSYmMT09PWFbZV0ubm9kZVR5cGUpe2ZvcihjPTA7LTEhPT0oYz1kLmluZGV4T2YoYVtlXSxjKSk7KWQuc3BsaWNlKGMsMSk7dmFyIGY9X2FbYVtlXS56Y0NsaXBwaW5nSWRdO2lmKGYpe2ZvcihjPTA7LTEhPT0oYz1mLmluZGV4T2YodGhpcy5pZCxjKSk7KWYuc3BsaWNlKGMsMSk7MD09PWYubGVuZ3RoJiYoJC5hdXRvQWN0aXZhdGU9PT0hMCYmb2IoYVtlXSksZGVsZXRlIGFbZV0uemNDbGlwcGluZ0lkKX19cmV0dXJuIHRoaXN9LGliPWZ1bmN0aW9uKCl7dmFyIGE9WmFbdGhpcy5pZF07cmV0dXJuIGEmJmEuZWxlbWVudHM/YS5lbGVtZW50cy5zbGljZSgwKTpbXX0samI9ZnVuY3Rpb24oKXtaYVt0aGlzLmlkXSYmKHRoaXMudW5jbGlwKCksdGhpcy5vZmYoKSxkZWxldGUgWmFbdGhpcy5pZF0pfSxrYj1mdW5jdGlvbihhKXtpZighYXx8IWEudHlwZSlyZXR1cm4hMTtpZihhLmNsaWVudCYmYS5jbGllbnQhPT10aGlzKXJldHVybiExO3ZhciBiPVphW3RoaXMuaWRdLGM9YiYmYi5lbGVtZW50cyxkPSEhYyYmYy5sZW5ndGg+MCxlPSFhLnRhcmdldHx8ZCYmLTEhPT1jLmluZGV4T2YoYS50YXJnZXQpLGY9YS5yZWxhdGVkVGFyZ2V0JiZkJiYtMSE9PWMuaW5kZXhPZihhLnJlbGF0ZWRUYXJnZXQpLGc9YS5jbGllbnQmJmEuY2xpZW50PT09dGhpcztyZXR1cm4gYiYmKGV8fGZ8fGcpPyEwOiExfSxsYj1mdW5jdGlvbihhKXt2YXIgYj1aYVt0aGlzLmlkXTtpZihcIm9iamVjdFwiPT10eXBlb2YgYSYmYSYmYS50eXBlJiZiKXt2YXIgYz1zYShhKSxkPWImJmIuaGFuZGxlcnNbXCIqXCJdfHxbXSxlPWImJmIuaGFuZGxlcnNbYS50eXBlXXx8W10sZz1kLmNvbmNhdChlKTtpZihnJiZnLmxlbmd0aCl7dmFyIGgsaSxqLGssbCxtPXRoaXM7Zm9yKGg9MCxpPWcubGVuZ3RoO2k+aDtoKyspaj1nW2hdLGs9bSxcInN0cmluZ1wiPT10eXBlb2YgaiYmXCJmdW5jdGlvblwiPT10eXBlb2YgZltqXSYmKGo9ZltqXSksXCJvYmplY3RcIj09dHlwZW9mIGomJmomJlwiZnVuY3Rpb25cIj09dHlwZW9mIGouaGFuZGxlRXZlbnQmJihrPWosaj1qLmhhbmRsZUV2ZW50KSxcImZ1bmN0aW9uXCI9PXR5cGVvZiBqJiYobD1BKHt9LGEpLHRhKGosayxbbF0sYykpfX19LG1iPWZ1bmN0aW9uKGEpe3JldHVyblwic3RyaW5nXCI9PXR5cGVvZiBhJiYoYT1bXSksXCJudW1iZXJcIiE9dHlwZW9mIGEubGVuZ3RoP1thXTphfSxuYj1mdW5jdGlvbihhKXtpZihhJiYxPT09YS5ub2RlVHlwZSl7dmFyIGI9ZnVuY3Rpb24oYSl7KGF8fChhPWYuZXZlbnQpKSYmKFwianNcIiE9PWEuX3NvdXJjZSYmKGEuc3RvcEltbWVkaWF0ZVByb3BhZ2F0aW9uKCksYS5wcmV2ZW50RGVmYXVsdCgpKSxkZWxldGUgYS5fc291cmNlKX0sYz1mdW5jdGlvbihjKXsoY3x8KGM9Zi5ldmVudCkpJiYoYihjKSxYYS5mb2N1cyhhKSl9O2EuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3ZlclwiLGMsITEpLGEuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlb3V0XCIsYiwhMSksYS5hZGRFdmVudExpc3RlbmVyKFwibW91c2VlbnRlclwiLGIsITEpLGEuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbGVhdmVcIixiLCExKSxhLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZW1vdmVcIixiLCExKSxhYlthLnpjQ2xpcHBpbmdJZF09e21vdXNlb3ZlcjpjLG1vdXNlb3V0OmIsbW91c2VlbnRlcjpiLG1vdXNlbGVhdmU6Yixtb3VzZW1vdmU6Yn19fSxvYj1mdW5jdGlvbihhKXtpZihhJiYxPT09YS5ub2RlVHlwZSl7dmFyIGI9YWJbYS56Y0NsaXBwaW5nSWRdO2lmKFwib2JqZWN0XCI9PXR5cGVvZiBiJiZiKXtmb3IodmFyIGMsZCxlPVtcIm1vdmVcIixcImxlYXZlXCIsXCJlbnRlclwiLFwib3V0XCIsXCJvdmVyXCJdLGY9MCxnPWUubGVuZ3RoO2c+ZjtmKyspYz1cIm1vdXNlXCIrZVtmXSxkPWJbY10sXCJmdW5jdGlvblwiPT10eXBlb2YgZCYmYS5yZW1vdmVFdmVudExpc3RlbmVyKGMsZCwhMSk7ZGVsZXRlIGFiW2EuemNDbGlwcGluZ0lkXX19fTtYYS5fY3JlYXRlQ2xpZW50PWZ1bmN0aW9uKCl7YmIuYXBwbHkodGhpcyx6KGFyZ3VtZW50cykpfSxYYS5wcm90b3R5cGUub249ZnVuY3Rpb24oKXtyZXR1cm4gY2IuYXBwbHkodGhpcyx6KGFyZ3VtZW50cykpfSxYYS5wcm90b3R5cGUub2ZmPWZ1bmN0aW9uKCl7cmV0dXJuIGRiLmFwcGx5KHRoaXMseihhcmd1bWVudHMpKX0sWGEucHJvdG90eXBlLmhhbmRsZXJzPWZ1bmN0aW9uKCl7cmV0dXJuIGViLmFwcGx5KHRoaXMseihhcmd1bWVudHMpKX0sWGEucHJvdG90eXBlLmVtaXQ9ZnVuY3Rpb24oKXtyZXR1cm4gZmIuYXBwbHkodGhpcyx6KGFyZ3VtZW50cykpfSxYYS5wcm90b3R5cGUuY2xpcD1mdW5jdGlvbigpe3JldHVybiBnYi5hcHBseSh0aGlzLHooYXJndW1lbnRzKSl9LFhhLnByb3RvdHlwZS51bmNsaXA9ZnVuY3Rpb24oKXtyZXR1cm4gaGIuYXBwbHkodGhpcyx6KGFyZ3VtZW50cykpfSxYYS5wcm90b3R5cGUuZWxlbWVudHM9ZnVuY3Rpb24oKXtyZXR1cm4gaWIuYXBwbHkodGhpcyx6KGFyZ3VtZW50cykpfSxYYS5wcm90b3R5cGUuZGVzdHJveT1mdW5jdGlvbigpe3JldHVybiBqYi5hcHBseSh0aGlzLHooYXJndW1lbnRzKSl9LFhhLnByb3RvdHlwZS5zZXRUZXh0PWZ1bmN0aW9uKGEpe2lmKCFaYVt0aGlzLmlkXSl0aHJvdyBuZXcgRXJyb3IoXCJBdHRlbXB0ZWQgdG8gc2V0IHBlbmRpbmcgY2xpcGJvYXJkIGRhdGEgZnJvbSBhIGRlc3Ryb3llZCBaZXJvQ2xpcGJvYXJkIGNsaWVudCBpbnN0YW5jZVwiKTtyZXR1cm4gWGEuc2V0RGF0YShcInRleHQvcGxhaW5cIixhKSx0aGlzfSxYYS5wcm90b3R5cGUuc2V0SHRtbD1mdW5jdGlvbihhKXtpZighWmFbdGhpcy5pZF0pdGhyb3cgbmV3IEVycm9yKFwiQXR0ZW1wdGVkIHRvIHNldCBwZW5kaW5nIGNsaXBib2FyZCBkYXRhIGZyb20gYSBkZXN0cm95ZWQgWmVyb0NsaXBib2FyZCBjbGllbnQgaW5zdGFuY2VcIik7cmV0dXJuIFhhLnNldERhdGEoXCJ0ZXh0L2h0bWxcIixhKSx0aGlzfSxYYS5wcm90b3R5cGUuc2V0UmljaFRleHQ9ZnVuY3Rpb24oYSl7aWYoIVphW3RoaXMuaWRdKXRocm93IG5ldyBFcnJvcihcIkF0dGVtcHRlZCB0byBzZXQgcGVuZGluZyBjbGlwYm9hcmQgZGF0YSBmcm9tIGEgZGVzdHJveWVkIFplcm9DbGlwYm9hcmQgY2xpZW50IGluc3RhbmNlXCIpO3JldHVybiBYYS5zZXREYXRhKFwiYXBwbGljYXRpb24vcnRmXCIsYSksdGhpc30sWGEucHJvdG90eXBlLnNldERhdGE9ZnVuY3Rpb24oKXtpZighWmFbdGhpcy5pZF0pdGhyb3cgbmV3IEVycm9yKFwiQXR0ZW1wdGVkIHRvIHNldCBwZW5kaW5nIGNsaXBib2FyZCBkYXRhIGZyb20gYSBkZXN0cm95ZWQgWmVyb0NsaXBib2FyZCBjbGllbnQgaW5zdGFuY2VcIik7cmV0dXJuIFhhLnNldERhdGEuYXBwbHkodGhpcyx6KGFyZ3VtZW50cykpLHRoaXN9LFhhLnByb3RvdHlwZS5jbGVhckRhdGE9ZnVuY3Rpb24oKXtpZighWmFbdGhpcy5pZF0pdGhyb3cgbmV3IEVycm9yKFwiQXR0ZW1wdGVkIHRvIGNsZWFyIHBlbmRpbmcgY2xpcGJvYXJkIGRhdGEgZnJvbSBhIGRlc3Ryb3llZCBaZXJvQ2xpcGJvYXJkIGNsaWVudCBpbnN0YW5jZVwiKTtyZXR1cm4gWGEuY2xlYXJEYXRhLmFwcGx5KHRoaXMseihhcmd1bWVudHMpKSx0aGlzfSxYYS5wcm90b3R5cGUuZ2V0RGF0YT1mdW5jdGlvbigpe2lmKCFaYVt0aGlzLmlkXSl0aHJvdyBuZXcgRXJyb3IoXCJBdHRlbXB0ZWQgdG8gZ2V0IHBlbmRpbmcgY2xpcGJvYXJkIGRhdGEgZnJvbSBhIGRlc3Ryb3llZCBaZXJvQ2xpcGJvYXJkIGNsaWVudCBpbnN0YW5jZVwiKTtyZXR1cm4gWGEuZ2V0RGF0YS5hcHBseSh0aGlzLHooYXJndW1lbnRzKSl9LFwiZnVuY3Rpb25cIj09dHlwZW9mIGRlZmluZSYmZGVmaW5lLmFtZD9kZWZpbmUoZnVuY3Rpb24oKXtyZXR1cm4gWGF9KTpcIm9iamVjdFwiPT10eXBlb2YgbW9kdWxlJiZtb2R1bGUmJlwib2JqZWN0XCI9PXR5cGVvZiBtb2R1bGUuZXhwb3J0cyYmbW9kdWxlLmV4cG9ydHM/bW9kdWxlLmV4cG9ydHM9WGE6YS5aZXJvQ2xpcGJvYXJkPVhhfShmdW5jdGlvbigpe3JldHVybiB0aGlzfHx3aW5kb3d9KCkpO1xuLy8jIHNvdXJjZU1hcHBpbmdVUkw9WmVyb0NsaXBib2FyZC5taW4ubWFwIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiBCb290c3RyYXA6IGFmZml4LmpzIHYzLjIuMFxuICogaHR0cDovL2dldGJvb3RzdHJhcC5jb20vamF2YXNjcmlwdC8jYWZmaXhcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogQ29weXJpZ2h0IDIwMTEtMjAxNCBUd2l0dGVyLCBJbmMuXG4gKiBMaWNlbnNlZCB1bmRlciBNSVQgKGh0dHBzOi8vZ2l0aHViLmNvbS90d2JzL2Jvb3RzdHJhcC9ibG9iL21hc3Rlci9MSUNFTlNFKVxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cblxuKyBmdW5jdGlvbigkKSB7XG5cdCd1c2Ugc3RyaWN0Jztcblx0Ly8gQUZGSVggQ0xBU1MgREVGSU5JVElPTlxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09XG5cblx0dmFyIEFmZml4ID0gZnVuY3Rpb24oZWxlbWVudCwgb3B0aW9ucykge1xuXHRcdHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBBZmZpeC5ERUZBVUxUUywgb3B0aW9ucylcblxuXHRcdHRoaXMuJHRhcmdldCA9ICQodGhpcy5vcHRpb25zLnRhcmdldClcblx0XHRcdC5vbignc2Nyb2xsLmJzLmFmZml4LmRhdGEtYXBpJywgJC5wcm94eSh0aGlzLmNoZWNrUG9zaXRpb24sIHRoaXMpKVxuXHRcdFx0Lm9uKCdjbGljay5icy5hZmZpeC5kYXRhLWFwaScsICQucHJveHkodGhpcy5jaGVja1Bvc2l0aW9uV2l0aEV2ZW50TG9vcCwgdGhpcykpXG5cblx0XHR0aGlzLiRlbGVtZW50ID0gJChlbGVtZW50KVxuXHRcdHRoaXMuYWZmaXhlZCA9XG5cdFx0XHR0aGlzLnVucGluID1cblx0XHRcdHRoaXMucGlubmVkT2Zmc2V0ID0gbnVsbFxuXG5cdFx0dGhpcy5jaGVja1Bvc2l0aW9uKClcblx0fVxuXG5cdEFmZml4LlZFUlNJT04gPSAnMy4yLjAnXG5cblx0QWZmaXguUkVTRVQgPSAnYWZmaXggYWZmaXgtdG9wIGFmZml4LWJvdHRvbSdcblxuXHRBZmZpeC5ERUZBVUxUUyA9IHtcblx0XHRvZmZzZXQ6IDAsXG5cdFx0dGFyZ2V0OiB3aW5kb3dcblx0fVxuXG5cdEFmZml4LnByb3RvdHlwZS5nZXRQaW5uZWRPZmZzZXQgPSBmdW5jdGlvbigpIHtcblx0XHRpZiAodGhpcy5waW5uZWRPZmZzZXQpIHJldHVybiB0aGlzLnBpbm5lZE9mZnNldFxuXHRcdHRoaXMuJGVsZW1lbnQucmVtb3ZlQ2xhc3MoQWZmaXguUkVTRVQpLmFkZENsYXNzKCdhZmZpeCcpXG5cdFx0dmFyIHNjcm9sbFRvcCA9IHRoaXMuJHRhcmdldC5zY3JvbGxUb3AoKVxuXHRcdHZhciBwb3NpdGlvbiA9IHRoaXMuJGVsZW1lbnQub2Zmc2V0KClcblx0XHRyZXR1cm4gKHRoaXMucGlubmVkT2Zmc2V0ID0gcG9zaXRpb24udG9wIC0gc2Nyb2xsVG9wKVxuXHR9XG5cblx0QWZmaXgucHJvdG90eXBlLmNoZWNrUG9zaXRpb25XaXRoRXZlbnRMb29wID0gZnVuY3Rpb24oKSB7XG5cdFx0c2V0VGltZW91dCgkLnByb3h5KHRoaXMuY2hlY2tQb3NpdGlvbiwgdGhpcyksIDEpXG5cdH1cblxuXHRBZmZpeC5wcm90b3R5cGUuY2hlY2tQb3NpdGlvbiA9IGZ1bmN0aW9uKCkge1xuXHRcdGlmICghdGhpcy4kZWxlbWVudC5pcygnOnZpc2libGUnKSkgcmV0dXJuXG5cblx0XHR2YXIgc2Nyb2xsSGVpZ2h0ID0gJChkb2N1bWVudCkuaGVpZ2h0KClcblx0XHR2YXIgc2Nyb2xsVG9wID0gdGhpcy4kdGFyZ2V0LnNjcm9sbFRvcCgpXG5cdFx0dmFyIHBvc2l0aW9uID0gdGhpcy4kZWxlbWVudC5vZmZzZXQoKVxuXHRcdHZhciBvZmZzZXQgPSB0aGlzLm9wdGlvbnMub2Zmc2V0XG5cdFx0dmFyIG9mZnNldFRvcCA9IG9mZnNldC50b3Bcblx0XHR2YXIgb2Zmc2V0Qm90dG9tID0gb2Zmc2V0LmJvdHRvbVxuXG5cdFx0aWYgKHR5cGVvZiBvZmZzZXQgIT0gJ29iamVjdCcpIG9mZnNldEJvdHRvbSA9IG9mZnNldFRvcCA9IG9mZnNldFxuXHRcdGlmICh0eXBlb2Ygb2Zmc2V0VG9wID09ICdmdW5jdGlvbicpIG9mZnNldFRvcCA9IG9mZnNldC50b3AodGhpcy4kZWxlbWVudClcblx0XHRpZiAodHlwZW9mIG9mZnNldEJvdHRvbSA9PSAnZnVuY3Rpb24nKSBvZmZzZXRCb3R0b20gPSBvZmZzZXQuYm90dG9tKHRoaXMuJGVsZW1lbnQpXG5cblx0XHR2YXIgYWZmaXggPSB0aGlzLnVucGluICE9IG51bGwgJiYgKHNjcm9sbFRvcCArIHRoaXMudW5waW4gPD0gcG9zaXRpb24udG9wKSA/IGZhbHNlIDpcblx0XHRcdG9mZnNldEJvdHRvbSAhPSBudWxsICYmIChwb3NpdGlvbi50b3AgKyB0aGlzLiRlbGVtZW50LmhlaWdodCgpID49IHNjcm9sbEhlaWdodCAtIG9mZnNldEJvdHRvbSkgPyAnYm90dG9tJyA6XG5cdFx0XHRvZmZzZXRUb3AgIT0gbnVsbCAmJiAoc2Nyb2xsVG9wIDw9IG9mZnNldFRvcCkgPyAndG9wJyA6IGZhbHNlXG5cblx0XHRpZiAodGhpcy5hZmZpeGVkID09PSBhZmZpeCkgcmV0dXJuXG5cdFx0aWYgKHRoaXMudW5waW4gIT0gbnVsbCkgdGhpcy4kZWxlbWVudC5jc3MoJ3RvcCcsICcnKVxuXG5cdFx0dmFyIGFmZml4VHlwZSA9ICdhZmZpeCcgKyAoYWZmaXggPyAnLScgKyBhZmZpeCA6ICcnKVxuXHRcdHZhciBlID0gJC5FdmVudChhZmZpeFR5cGUgKyAnLmJzLmFmZml4JylcblxuXHRcdHRoaXMuJGVsZW1lbnQudHJpZ2dlcihlKVxuXG5cdFx0aWYgKGUuaXNEZWZhdWx0UHJldmVudGVkKCkpIHJldHVyblxuXG5cdFx0dGhpcy5hZmZpeGVkID0gYWZmaXhcblx0XHR0aGlzLnVucGluID0gYWZmaXggPT0gJ2JvdHRvbScgPyB0aGlzLmdldFBpbm5lZE9mZnNldCgpIDogbnVsbFxuXG5cdFx0dGhpcy4kZWxlbWVudFxuXHRcdFx0LnJlbW92ZUNsYXNzKEFmZml4LlJFU0VUKVxuXHRcdFx0LmFkZENsYXNzKGFmZml4VHlwZSlcblx0XHRcdC50cmlnZ2VyKCQuRXZlbnQoYWZmaXhUeXBlLnJlcGxhY2UoJ2FmZml4JywgJ2FmZml4ZWQnKSkpXG5cblx0XHRpZiAoYWZmaXggPT0gJ2JvdHRvbScpIHtcblx0XHRcdHRoaXMuJGVsZW1lbnQub2Zmc2V0KHtcblx0XHRcdFx0dG9wOiBzY3JvbGxIZWlnaHQgLSB0aGlzLiRlbGVtZW50LmhlaWdodCgpIC0gb2Zmc2V0Qm90dG9tXG5cdFx0XHR9KVxuXHRcdH1cblx0fVxuXG5cblx0Ly8gQUZGSVggUExVR0lOIERFRklOSVRJT05cblx0Ly8gPT09PT09PT09PT09PT09PT09PT09PT1cblxuXHRmdW5jdGlvbiBQbHVnaW4ob3B0aW9uKSB7XG5cdFx0cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHtcblx0XHRcdHZhciAkdGhpcyA9ICQodGhpcylcblx0XHRcdHZhciBkYXRhID0gJHRoaXMuZGF0YSgnYnMuYWZmaXgnKVxuXHRcdFx0dmFyIG9wdGlvbnMgPSB0eXBlb2Ygb3B0aW9uID09ICdvYmplY3QnICYmIG9wdGlvblxuXG5cdFx0XHRpZiAoIWRhdGEpICR0aGlzLmRhdGEoJ2JzLmFmZml4JywgKGRhdGEgPSBuZXcgQWZmaXgodGhpcywgb3B0aW9ucykpKVxuXHRcdFx0aWYgKHR5cGVvZiBvcHRpb24gPT0gJ3N0cmluZycpIGRhdGFbb3B0aW9uXSgpXG5cdFx0fSlcblx0fVxuXG5cdHZhciBvbGQgPSAkLmZuLmFmZml4XG5cblx0JC5mbi5hZmZpeCA9IFBsdWdpblxuXHQkLmZuLmFmZml4LkNvbnN0cnVjdG9yID0gQWZmaXhcblxuXG5cdC8vIEFGRklYIE5PIENPTkZMSUNUXG5cdC8vID09PT09PT09PT09PT09PT09XG5cblx0JC5mbi5hZmZpeC5ub0NvbmZsaWN0ID0gZnVuY3Rpb24oKSB7XG5cdFx0JC5mbi5hZmZpeCA9IG9sZFxuXHRcdHJldHVybiB0aGlzXG5cdH1cblxuXG5cdC8vIEFGRklYIERBVEEtQVBJXG5cdC8vID09PT09PT09PT09PT09XG5cblx0JCh3aW5kb3cpLm9uKCdsb2FkJywgZnVuY3Rpb24oKSB7XG5cdFx0JCgnW2RhdGEtc3B5PVwiYWZmaXhcIl0nKS5lYWNoKGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyICRzcHkgPSAkKHRoaXMpXG5cdFx0XHR2YXIgZGF0YSA9ICRzcHkuZGF0YSgpXG5cblx0XHRcdGRhdGEub2Zmc2V0ID0gZGF0YS5vZmZzZXQgfHwge31cblxuXHRcdFx0aWYgKGRhdGEub2Zmc2V0Qm90dG9tKSBkYXRhLm9mZnNldC5ib3R0b20gPSBkYXRhLm9mZnNldEJvdHRvbVxuXHRcdFx0aWYgKGRhdGEub2Zmc2V0VG9wKSBkYXRhLm9mZnNldC50b3AgPSBkYXRhLm9mZnNldFRvcFxuXG5cdFx0XHRQbHVnaW4uY2FsbCgkc3B5LCBkYXRhKVxuXHRcdH0pXG5cdH0pXG5cbn0oalF1ZXJ5KTtcblxuLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiBCb290c3RyYXA6IGFsZXJ0LmpzIHYzLjIuMFxuICogaHR0cDovL2dldGJvb3RzdHJhcC5jb20vamF2YXNjcmlwdC8jYWxlcnRzXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqIENvcHlyaWdodCAyMDExLTIwMTQgVHdpdHRlciwgSW5jLlxuICogTGljZW5zZWQgdW5kZXIgTUlUIChodHRwczovL2dpdGh1Yi5jb20vdHdicy9ib290c3RyYXAvYmxvYi9tYXN0ZXIvTElDRU5TRSlcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG5cbisgZnVuY3Rpb24oJCkge1xuXHQndXNlIHN0cmljdCc7XG5cblx0Ly8gQUxFUlQgQ0xBU1MgREVGSU5JVElPTlxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09XG5cblx0dmFyIGRpc21pc3MgPSAnW2RhdGEtZGlzbWlzcz1cImFsZXJ0XCJdJ1xuXHR2YXIgQWxlcnQgPSBmdW5jdGlvbihlbCkge1xuXHRcdCQoZWwpLm9uKCdjbGljaycsIGRpc21pc3MsIHRoaXMuY2xvc2UpXG5cdH1cblxuXHRBbGVydC5WRVJTSU9OID0gJzMuMi4wJ1xuXG5cdEFsZXJ0LnByb3RvdHlwZS5jbG9zZSA9IGZ1bmN0aW9uKGUpIHtcblx0XHR2YXIgJHRoaXMgPSAkKHRoaXMpXG5cdFx0dmFyIHNlbGVjdG9yID0gJHRoaXMuYXR0cignZGF0YS10YXJnZXQnKVxuXG5cdFx0aWYgKCFzZWxlY3Rvcikge1xuXHRcdFx0c2VsZWN0b3IgPSAkdGhpcy5hdHRyKCdocmVmJylcblx0XHRcdHNlbGVjdG9yID0gc2VsZWN0b3IgJiYgc2VsZWN0b3IucmVwbGFjZSgvLiooPz0jW15cXHNdKiQpLywgJycpIC8vIHN0cmlwIGZvciBpZTdcblx0XHR9XG5cblx0XHR2YXIgJHBhcmVudCA9ICQoc2VsZWN0b3IpXG5cblx0XHRpZiAoZSkgZS5wcmV2ZW50RGVmYXVsdCgpXG5cblx0XHRpZiAoISRwYXJlbnQubGVuZ3RoKSB7XG5cdFx0XHQkcGFyZW50ID0gJHRoaXMuaGFzQ2xhc3MoJ2FsZXJ0JykgPyAkdGhpcyA6ICR0aGlzLnBhcmVudCgpXG5cdFx0fVxuXG5cdFx0JHBhcmVudC50cmlnZ2VyKGUgPSAkLkV2ZW50KCdjbG9zZS5icy5hbGVydCcpKVxuXG5cdFx0aWYgKGUuaXNEZWZhdWx0UHJldmVudGVkKCkpIHJldHVyblxuXG5cdFx0JHBhcmVudC5yZW1vdmVDbGFzcygnaW4nKVxuXG5cdFx0ZnVuY3Rpb24gcmVtb3ZlRWxlbWVudCgpIHtcblx0XHRcdC8vIGRldGFjaCBmcm9tIHBhcmVudCwgZmlyZSBldmVudCB0aGVuIGNsZWFuIHVwIGRhdGFcblx0XHRcdCRwYXJlbnQuZGV0YWNoKCkudHJpZ2dlcignY2xvc2VkLmJzLmFsZXJ0JykucmVtb3ZlKClcblx0XHR9XG5cblx0XHQkLnN1cHBvcnQudHJhbnNpdGlvbiAmJiAkcGFyZW50Lmhhc0NsYXNzKCdmYWRlJykgP1xuXHRcdFx0JHBhcmVudFxuXHRcdFx0Lm9uZSgnYnNUcmFuc2l0aW9uRW5kJywgcmVtb3ZlRWxlbWVudClcblx0XHRcdC5lbXVsYXRlVHJhbnNpdGlvbkVuZCgxNTApIDpcblx0XHRcdHJlbW92ZUVsZW1lbnQoKVxuXHR9XG5cblxuXHQvLyBBTEVSVCBQTFVHSU4gREVGSU5JVElPTlxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09PVxuXG5cdGZ1bmN0aW9uIFBsdWdpbihvcHRpb24pIHtcblx0XHRyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyICR0aGlzID0gJCh0aGlzKVxuXHRcdFx0dmFyIGRhdGEgPSAkdGhpcy5kYXRhKCdicy5hbGVydCcpXG5cblx0XHRcdGlmICghZGF0YSkgJHRoaXMuZGF0YSgnYnMuYWxlcnQnLCAoZGF0YSA9IG5ldyBBbGVydCh0aGlzKSkpXG5cdFx0XHRpZiAodHlwZW9mIG9wdGlvbiA9PSAnc3RyaW5nJykgZGF0YVtvcHRpb25dLmNhbGwoJHRoaXMpXG5cdFx0fSlcblx0fVxuXG5cdHZhciBvbGQgPSAkLmZuLmFsZXJ0XG5cblx0JC5mbi5hbGVydCA9IFBsdWdpblxuXHQkLmZuLmFsZXJ0LkNvbnN0cnVjdG9yID0gQWxlcnRcblxuXG5cdC8vIEFMRVJUIE5PIENPTkZMSUNUXG5cdC8vID09PT09PT09PT09PT09PT09XG5cblx0JC5mbi5hbGVydC5ub0NvbmZsaWN0ID0gZnVuY3Rpb24oKSB7XG5cdFx0JC5mbi5hbGVydCA9IG9sZFxuXHRcdHJldHVybiB0aGlzXG5cdH1cblxuXG5cdC8vIEFMRVJUIERBVEEtQVBJXG5cdC8vID09PT09PT09PT09PT09XG5cblx0JChkb2N1bWVudCkub24oJ2NsaWNrLmJzLmFsZXJ0LmRhdGEtYXBpJywgZGlzbWlzcywgQWxlcnQucHJvdG90eXBlLmNsb3NlKVxuXG59KGpRdWVyeSk7XG5cbi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogQm9vdHN0cmFwOiBidXR0b24uanMgdjMuMi4wXG4gKiBodHRwOi8vZ2V0Ym9vdHN0cmFwLmNvbS9qYXZhc2NyaXB0LyNidXR0b25zXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqIENvcHlyaWdodCAyMDExLTIwMTQgVHdpdHRlciwgSW5jLlxuICogTGljZW5zZWQgdW5kZXIgTUlUIChodHRwczovL2dpdGh1Yi5jb20vdHdicy9ib290c3RyYXAvYmxvYi9tYXN0ZXIvTElDRU5TRSlcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG5cbisgZnVuY3Rpb24oJCkge1xuXHQndXNlIHN0cmljdCc7XG5cblx0Ly8gQlVUVE9OIFBVQkxJQyBDTEFTUyBERUZJTklUSU9OXG5cdC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5cdHZhciBCdXR0b24gPSBmdW5jdGlvbihlbGVtZW50LCBvcHRpb25zKSB7XG5cdFx0dGhpcy4kZWxlbWVudCA9ICQoZWxlbWVudClcblx0XHR0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgQnV0dG9uLkRFRkFVTFRTLCBvcHRpb25zKVxuXHRcdHRoaXMuaXNMb2FkaW5nID0gZmFsc2Vcblx0fVxuXG5cdEJ1dHRvbi5WRVJTSU9OID0gJzMuMi4wJ1xuXG5cdEJ1dHRvbi5ERUZBVUxUUyA9IHtcblx0XHRsb2FkaW5nVGV4dDogJ2xvYWRpbmcuLi4nXG5cdH1cblxuXHRCdXR0b24ucHJvdG90eXBlLnNldFN0YXRlID0gZnVuY3Rpb24oc3RhdGUpIHtcblx0XHR2YXIgZCA9ICdkaXNhYmxlZCdcblx0XHR2YXIgJGVsID0gdGhpcy4kZWxlbWVudFxuXHRcdHZhciB2YWwgPSAkZWwuaXMoJ2lucHV0JykgPyAndmFsJyA6ICdodG1sJ1xuXHRcdHZhciBkYXRhID0gJGVsLmRhdGEoKVxuXG5cdFx0c3RhdGUgPSBzdGF0ZSArICdUZXh0J1xuXG5cdFx0aWYgKGRhdGEucmVzZXRUZXh0ID09IG51bGwpICRlbC5kYXRhKCdyZXNldFRleHQnLCAkZWxbdmFsXSgpKVxuXG5cdFx0JGVsW3ZhbF0oZGF0YVtzdGF0ZV0gPT0gbnVsbCA/IHRoaXMub3B0aW9uc1tzdGF0ZV0gOiBkYXRhW3N0YXRlXSlcblxuXHRcdC8vIHB1c2ggdG8gZXZlbnQgbG9vcCB0byBhbGxvdyBmb3JtcyB0byBzdWJtaXRcblx0XHRzZXRUaW1lb3V0KCQucHJveHkoZnVuY3Rpb24oKSB7XG5cdFx0XHRpZiAoc3RhdGUgPT0gJ2xvYWRpbmdUZXh0Jykge1xuXHRcdFx0XHR0aGlzLmlzTG9hZGluZyA9IHRydWVcblx0XHRcdFx0JGVsLmFkZENsYXNzKGQpLmF0dHIoZCwgZClcblx0XHRcdH0gZWxzZSBpZiAodGhpcy5pc0xvYWRpbmcpIHtcblx0XHRcdFx0dGhpcy5pc0xvYWRpbmcgPSBmYWxzZVxuXHRcdFx0XHQkZWwucmVtb3ZlQ2xhc3MoZCkucmVtb3ZlQXR0cihkKVxuXHRcdFx0fVxuXHRcdH0sIHRoaXMpLCAwKVxuXHR9XG5cblx0QnV0dG9uLnByb3RvdHlwZS50b2dnbGUgPSBmdW5jdGlvbigpIHtcblx0XHR2YXIgY2hhbmdlZCA9IHRydWVcblx0XHR2YXIgJHBhcmVudCA9IHRoaXMuJGVsZW1lbnQuY2xvc2VzdCgnW2RhdGEtdG9nZ2xlPVwiYnV0dG9uc1wiXScpXG5cblx0XHRpZiAoJHBhcmVudC5sZW5ndGgpIHtcblx0XHRcdHZhciAkaW5wdXQgPSB0aGlzLiRlbGVtZW50LmZpbmQoJ2lucHV0Jylcblx0XHRcdGlmICgkaW5wdXQucHJvcCgndHlwZScpID09ICdyYWRpbycpIHtcblx0XHRcdFx0aWYgKCRpbnB1dC5wcm9wKCdjaGVja2VkJykgJiYgdGhpcy4kZWxlbWVudC5oYXNDbGFzcygnYWN0aXZlJykpIGNoYW5nZWQgPSBmYWxzZVxuXHRcdFx0XHRlbHNlICRwYXJlbnQuZmluZCgnLmFjdGl2ZScpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKVxuXHRcdFx0fVxuXHRcdFx0aWYgKGNoYW5nZWQpICRpbnB1dC5wcm9wKCdjaGVja2VkJywgIXRoaXMuJGVsZW1lbnQuaGFzQ2xhc3MoJ2FjdGl2ZScpKS50cmlnZ2VyKCdjaGFuZ2UnKVxuXHRcdH1cblxuXHRcdGlmIChjaGFuZ2VkKSB0aGlzLiRlbGVtZW50LnRvZ2dsZUNsYXNzKCdhY3RpdmUnKVxuXHR9XG5cblxuXHQvLyBCVVRUT04gUExVR0lOIERFRklOSVRJT05cblx0Ly8gPT09PT09PT09PT09PT09PT09PT09PT09XG5cblx0ZnVuY3Rpb24gUGx1Z2luKG9wdGlvbikge1xuXHRcdHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgJHRoaXMgPSAkKHRoaXMpXG5cdFx0XHR2YXIgZGF0YSA9ICR0aGlzLmRhdGEoJ2JzLmJ1dHRvbicpXG5cdFx0XHR2YXIgb3B0aW9ucyA9IHR5cGVvZiBvcHRpb24gPT0gJ29iamVjdCcgJiYgb3B0aW9uXG5cblx0XHRcdGlmICghZGF0YSkgJHRoaXMuZGF0YSgnYnMuYnV0dG9uJywgKGRhdGEgPSBuZXcgQnV0dG9uKHRoaXMsIG9wdGlvbnMpKSlcblxuXHRcdFx0aWYgKG9wdGlvbiA9PSAndG9nZ2xlJykgZGF0YS50b2dnbGUoKVxuXHRcdFx0ZWxzZSBpZiAob3B0aW9uKSBkYXRhLnNldFN0YXRlKG9wdGlvbilcblx0XHR9KVxuXHR9XG5cblx0dmFyIG9sZCA9ICQuZm4uYnV0dG9uXG5cblx0JC5mbi5idXR0b24gPSBQbHVnaW5cblx0JC5mbi5idXR0b24uQ29uc3RydWN0b3IgPSBCdXR0b25cblxuXG5cdC8vIEJVVFRPTiBOTyBDT05GTElDVFxuXHQvLyA9PT09PT09PT09PT09PT09PT1cblxuXHQkLmZuLmJ1dHRvbi5ub0NvbmZsaWN0ID0gZnVuY3Rpb24oKSB7XG5cdFx0JC5mbi5idXR0b24gPSBvbGRcblx0XHRyZXR1cm4gdGhpc1xuXHR9XG5cblxuXHQvLyBCVVRUT04gREFUQS1BUElcblx0Ly8gPT09PT09PT09PT09PT09XG5cblx0JChkb2N1bWVudCkub24oJ2NsaWNrLmJzLmJ1dHRvbi5kYXRhLWFwaScsICdbZGF0YS10b2dnbGVePVwiYnV0dG9uXCJdJywgZnVuY3Rpb24oZSkge1xuXHRcdHZhciAkYnRuID0gJChlLnRhcmdldClcblx0XHRpZiAoISRidG4uaGFzQ2xhc3MoJ2J0bicpKSAkYnRuID0gJGJ0bi5jbG9zZXN0KCcuYnRuJylcblx0XHRQbHVnaW4uY2FsbCgkYnRuLCAndG9nZ2xlJylcblx0XHRlLnByZXZlbnREZWZhdWx0KClcblx0fSlcblxufShqUXVlcnkpO1xuXG4vKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqIEJvb3RzdHJhcDogY2Fyb3VzZWwuanMgdjMuMi4wXG4gKiBodHRwOi8vZ2V0Ym9vdHN0cmFwLmNvbS9qYXZhc2NyaXB0LyNjYXJvdXNlbFxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiBDb3B5cmlnaHQgMjAxMS0yMDE0IFR3aXR0ZXIsIEluYy5cbiAqIExpY2Vuc2VkIHVuZGVyIE1JVCAoaHR0cHM6Ly9naXRodWIuY29tL3R3YnMvYm9vdHN0cmFwL2Jsb2IvbWFzdGVyL0xJQ0VOU0UpXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuXG4rIGZ1bmN0aW9uKCQpIHtcblx0J3VzZSBzdHJpY3QnO1xuXG5cdC8vIENBUk9VU0VMIENMQVNTIERFRklOSVRJT05cblx0Ly8gPT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5cdHZhciBDYXJvdXNlbCA9IGZ1bmN0aW9uKGVsZW1lbnQsIG9wdGlvbnMpIHtcblx0XHR0aGlzLiRlbGVtZW50ID0gJChlbGVtZW50KS5vbigna2V5ZG93bi5icy5jYXJvdXNlbCcsICQucHJveHkodGhpcy5rZXlkb3duLCB0aGlzKSlcblx0XHR0aGlzLiRpbmRpY2F0b3JzID0gdGhpcy4kZWxlbWVudC5maW5kKCcuY2Fyb3VzZWwtaW5kaWNhdG9ycycpXG5cdFx0dGhpcy5vcHRpb25zID0gb3B0aW9uc1xuXHRcdHRoaXMucGF1c2VkID1cblx0XHRcdHRoaXMuc2xpZGluZyA9XG5cdFx0XHR0aGlzLmludGVydmFsID1cblx0XHRcdHRoaXMuJGFjdGl2ZSA9XG5cdFx0XHR0aGlzLiRpdGVtcyA9IG51bGxcblxuXHRcdHRoaXMub3B0aW9ucy5wYXVzZSA9PSAnaG92ZXInICYmIHRoaXMuJGVsZW1lbnRcblx0XHRcdC5vbignbW91c2VlbnRlci5icy5jYXJvdXNlbCcsICQucHJveHkodGhpcy5wYXVzZSwgdGhpcykpXG5cdFx0XHQub24oJ21vdXNlbGVhdmUuYnMuY2Fyb3VzZWwnLCAkLnByb3h5KHRoaXMuY3ljbGUsIHRoaXMpKVxuXHR9XG5cblx0Q2Fyb3VzZWwuVkVSU0lPTiA9ICczLjIuMCdcblxuXHRDYXJvdXNlbC5ERUZBVUxUUyA9IHtcblx0XHRpbnRlcnZhbDogNTAwMCxcblx0XHRwYXVzZTogJ2hvdmVyJyxcblx0XHR3cmFwOiB0cnVlXG5cdH1cblxuXHRDYXJvdXNlbC5wcm90b3R5cGUua2V5ZG93biA9IGZ1bmN0aW9uKGUpIHtcblx0XHRzd2l0Y2ggKGUud2hpY2gpIHtcblx0XHRcdGNhc2UgMzc6XG5cdFx0XHRcdHRoaXMucHJldigpO1xuXHRcdFx0XHRicmVha1xuXHRcdFx0Y2FzZSAzOTpcblx0XHRcdFx0dGhpcy5uZXh0KCk7XG5cdFx0XHRcdGJyZWFrXG5cdFx0XHRkZWZhdWx0OlxuXHRcdFx0XHRyZXR1cm5cblx0XHR9XG5cblx0XHRlLnByZXZlbnREZWZhdWx0KClcblx0fVxuXG5cdENhcm91c2VsLnByb3RvdHlwZS5jeWNsZSA9IGZ1bmN0aW9uKGUpIHtcblx0XHRlIHx8ICh0aGlzLnBhdXNlZCA9IGZhbHNlKVxuXG5cdFx0dGhpcy5pbnRlcnZhbCAmJiBjbGVhckludGVydmFsKHRoaXMuaW50ZXJ2YWwpXG5cblx0XHR0aGlzLm9wdGlvbnMuaW50ZXJ2YWwgJiYgIXRoaXMucGF1c2VkICYmICh0aGlzLmludGVydmFsID0gc2V0SW50ZXJ2YWwoJC5wcm94eSh0aGlzLm5leHQsIHRoaXMpLCB0aGlzLm9wdGlvbnMuaW50ZXJ2YWwpKVxuXG5cdFx0cmV0dXJuIHRoaXNcblx0fVxuXG5cdENhcm91c2VsLnByb3RvdHlwZS5nZXRJdGVtSW5kZXggPSBmdW5jdGlvbihpdGVtKSB7XG5cdFx0dGhpcy4kaXRlbXMgPSBpdGVtLnBhcmVudCgpLmNoaWxkcmVuKCcuaXRlbScpXG5cdFx0cmV0dXJuIHRoaXMuJGl0ZW1zLmluZGV4KGl0ZW0gfHwgdGhpcy4kYWN0aXZlKVxuXHR9XG5cblx0Q2Fyb3VzZWwucHJvdG90eXBlLnRvID0gZnVuY3Rpb24ocG9zKSB7XG5cdFx0dmFyIHRoYXQgPSB0aGlzXG5cdFx0dmFyIGFjdGl2ZUluZGV4ID0gdGhpcy5nZXRJdGVtSW5kZXgodGhpcy4kYWN0aXZlID0gdGhpcy4kZWxlbWVudC5maW5kKCcuaXRlbS5hY3RpdmUnKSlcblxuXHRcdGlmIChwb3MgPiAodGhpcy4kaXRlbXMubGVuZ3RoIC0gMSkgfHwgcG9zIDwgMCkgcmV0dXJuXG5cblx0XHRpZiAodGhpcy5zbGlkaW5nKSByZXR1cm4gdGhpcy4kZWxlbWVudC5vbmUoJ3NsaWQuYnMuY2Fyb3VzZWwnLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0dGhhdC50byhwb3MpXG5cdFx0XHR9KSAvLyB5ZXMsIFwic2xpZFwiXG5cdFx0aWYgKGFjdGl2ZUluZGV4ID09IHBvcykgcmV0dXJuIHRoaXMucGF1c2UoKS5jeWNsZSgpXG5cblx0XHRyZXR1cm4gdGhpcy5zbGlkZShwb3MgPiBhY3RpdmVJbmRleCA/ICduZXh0JyA6ICdwcmV2JywgJCh0aGlzLiRpdGVtc1twb3NdKSlcblx0fVxuXG5cdENhcm91c2VsLnByb3RvdHlwZS5wYXVzZSA9IGZ1bmN0aW9uKGUpIHtcblx0XHRlIHx8ICh0aGlzLnBhdXNlZCA9IHRydWUpXG5cblx0XHRpZiAodGhpcy4kZWxlbWVudC5maW5kKCcubmV4dCwgLnByZXYnKS5sZW5ndGggJiYgJC5zdXBwb3J0LnRyYW5zaXRpb24pIHtcblx0XHRcdHRoaXMuJGVsZW1lbnQudHJpZ2dlcigkLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQpXG5cdFx0XHR0aGlzLmN5Y2xlKHRydWUpXG5cdFx0fVxuXG5cdFx0dGhpcy5pbnRlcnZhbCA9IGNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbClcblxuXHRcdHJldHVybiB0aGlzXG5cdH1cblxuXHRDYXJvdXNlbC5wcm90b3R5cGUubmV4dCA9IGZ1bmN0aW9uKCkge1xuXHRcdGlmICh0aGlzLnNsaWRpbmcpIHJldHVyblxuXHRcdHJldHVybiB0aGlzLnNsaWRlKCduZXh0Jylcblx0fVxuXG5cdENhcm91c2VsLnByb3RvdHlwZS5wcmV2ID0gZnVuY3Rpb24oKSB7XG5cdFx0aWYgKHRoaXMuc2xpZGluZykgcmV0dXJuXG5cdFx0cmV0dXJuIHRoaXMuc2xpZGUoJ3ByZXYnKVxuXHR9XG5cblx0Q2Fyb3VzZWwucHJvdG90eXBlLnNsaWRlID0gZnVuY3Rpb24odHlwZSwgbmV4dCkge1xuXHRcdHZhciAkYWN0aXZlID0gdGhpcy4kZWxlbWVudC5maW5kKCcuaXRlbS5hY3RpdmUnKVxuXHRcdHZhciAkbmV4dCA9IG5leHQgfHwgJGFjdGl2ZVt0eXBlXSgpXG5cdFx0dmFyIGlzQ3ljbGluZyA9IHRoaXMuaW50ZXJ2YWxcblx0XHR2YXIgZGlyZWN0aW9uID0gdHlwZSA9PSAnbmV4dCcgPyAnbGVmdCcgOiAncmlnaHQnXG5cdFx0dmFyIGZhbGxiYWNrID0gdHlwZSA9PSAnbmV4dCcgPyAnZmlyc3QnIDogJ2xhc3QnXG5cdFx0dmFyIHRoYXQgPSB0aGlzXG5cblx0XHRpZiAoISRuZXh0Lmxlbmd0aCkge1xuXHRcdFx0aWYgKCF0aGlzLm9wdGlvbnMud3JhcCkgcmV0dXJuXG5cdFx0XHQkbmV4dCA9IHRoaXMuJGVsZW1lbnQuZmluZCgnLml0ZW0nKVtmYWxsYmFja10oKVxuXHRcdH1cblxuXHRcdGlmICgkbmV4dC5oYXNDbGFzcygnYWN0aXZlJykpIHJldHVybiAodGhpcy5zbGlkaW5nID0gZmFsc2UpXG5cblx0XHR2YXIgcmVsYXRlZFRhcmdldCA9ICRuZXh0WzBdXG5cdFx0dmFyIHNsaWRlRXZlbnQgPSAkLkV2ZW50KCdzbGlkZS5icy5jYXJvdXNlbCcsIHtcblx0XHRcdHJlbGF0ZWRUYXJnZXQ6IHJlbGF0ZWRUYXJnZXQsXG5cdFx0XHRkaXJlY3Rpb246IGRpcmVjdGlvblxuXHRcdH0pXG5cdFx0dGhpcy4kZWxlbWVudC50cmlnZ2VyKHNsaWRlRXZlbnQpXG5cdFx0aWYgKHNsaWRlRXZlbnQuaXNEZWZhdWx0UHJldmVudGVkKCkpIHJldHVyblxuXG5cdFx0dGhpcy5zbGlkaW5nID0gdHJ1ZVxuXG5cdFx0aXNDeWNsaW5nICYmIHRoaXMucGF1c2UoKVxuXG5cdFx0aWYgKHRoaXMuJGluZGljYXRvcnMubGVuZ3RoKSB7XG5cdFx0XHR0aGlzLiRpbmRpY2F0b3JzLmZpbmQoJy5hY3RpdmUnKS5yZW1vdmVDbGFzcygnYWN0aXZlJylcblx0XHRcdHZhciAkbmV4dEluZGljYXRvciA9ICQodGhpcy4kaW5kaWNhdG9ycy5jaGlsZHJlbigpW3RoaXMuZ2V0SXRlbUluZGV4KCRuZXh0KV0pXG5cdFx0XHQkbmV4dEluZGljYXRvciAmJiAkbmV4dEluZGljYXRvci5hZGRDbGFzcygnYWN0aXZlJylcblx0XHR9XG5cblx0XHR2YXIgc2xpZEV2ZW50ID0gJC5FdmVudCgnc2xpZC5icy5jYXJvdXNlbCcsIHtcblx0XHRcdFx0cmVsYXRlZFRhcmdldDogcmVsYXRlZFRhcmdldCxcblx0XHRcdFx0ZGlyZWN0aW9uOiBkaXJlY3Rpb25cblx0XHRcdH0pIC8vIHllcywgXCJzbGlkXCJcblx0XHRpZiAoJC5zdXBwb3J0LnRyYW5zaXRpb24gJiYgdGhpcy4kZWxlbWVudC5oYXNDbGFzcygnc2xpZGUnKSkge1xuXHRcdFx0JG5leHQuYWRkQ2xhc3ModHlwZSlcblx0XHRcdCRuZXh0WzBdLm9mZnNldFdpZHRoIC8vIGZvcmNlIHJlZmxvd1xuXHRcdFx0JGFjdGl2ZS5hZGRDbGFzcyhkaXJlY3Rpb24pXG5cdFx0XHQkbmV4dC5hZGRDbGFzcyhkaXJlY3Rpb24pXG5cdFx0XHQkYWN0aXZlXG5cdFx0XHRcdC5vbmUoJ2JzVHJhbnNpdGlvbkVuZCcsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdCRuZXh0LnJlbW92ZUNsYXNzKFt0eXBlLCBkaXJlY3Rpb25dLmpvaW4oJyAnKSkuYWRkQ2xhc3MoJ2FjdGl2ZScpXG5cdFx0XHRcdFx0JGFjdGl2ZS5yZW1vdmVDbGFzcyhbJ2FjdGl2ZScsIGRpcmVjdGlvbl0uam9pbignICcpKVxuXHRcdFx0XHRcdHRoYXQuc2xpZGluZyA9IGZhbHNlXG5cdFx0XHRcdFx0c2V0VGltZW91dChmdW5jdGlvbigpIHtcblx0XHRcdFx0XHRcdHRoYXQuJGVsZW1lbnQudHJpZ2dlcihzbGlkRXZlbnQpXG5cdFx0XHRcdFx0fSwgMClcblx0XHRcdFx0fSlcblx0XHRcdFx0LmVtdWxhdGVUcmFuc2l0aW9uRW5kKCRhY3RpdmUuY3NzKCd0cmFuc2l0aW9uLWR1cmF0aW9uJykuc2xpY2UoMCwgLTEpICogMTAwMClcblx0XHR9IGVsc2Uge1xuXHRcdFx0JGFjdGl2ZS5yZW1vdmVDbGFzcygnYWN0aXZlJylcblx0XHRcdCRuZXh0LmFkZENsYXNzKCdhY3RpdmUnKVxuXHRcdFx0dGhpcy5zbGlkaW5nID0gZmFsc2Vcblx0XHRcdHRoaXMuJGVsZW1lbnQudHJpZ2dlcihzbGlkRXZlbnQpXG5cdFx0fVxuXG5cdFx0aXNDeWNsaW5nICYmIHRoaXMuY3ljbGUoKVxuXG5cdFx0cmV0dXJuIHRoaXNcblx0fVxuXG5cblx0Ly8gQ0FST1VTRUwgUExVR0lOIERFRklOSVRJT05cblx0Ly8gPT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuXHRmdW5jdGlvbiBQbHVnaW4ob3B0aW9uKSB7XG5cdFx0cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHtcblx0XHRcdHZhciAkdGhpcyA9ICQodGhpcylcblx0XHRcdHZhciBkYXRhID0gJHRoaXMuZGF0YSgnYnMuY2Fyb3VzZWwnKVxuXHRcdFx0dmFyIG9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgQ2Fyb3VzZWwuREVGQVVMVFMsICR0aGlzLmRhdGEoKSwgdHlwZW9mIG9wdGlvbiA9PSAnb2JqZWN0JyAmJiBvcHRpb24pXG5cdFx0XHR2YXIgYWN0aW9uID0gdHlwZW9mIG9wdGlvbiA9PSAnc3RyaW5nJyA/IG9wdGlvbiA6IG9wdGlvbnMuc2xpZGVcblxuXHRcdFx0aWYgKCFkYXRhKSAkdGhpcy5kYXRhKCdicy5jYXJvdXNlbCcsIChkYXRhID0gbmV3IENhcm91c2VsKHRoaXMsIG9wdGlvbnMpKSlcblx0XHRcdGlmICh0eXBlb2Ygb3B0aW9uID09ICdudW1iZXInKSBkYXRhLnRvKG9wdGlvbilcblx0XHRcdGVsc2UgaWYgKGFjdGlvbikgZGF0YVthY3Rpb25dKClcblx0XHRcdGVsc2UgaWYgKG9wdGlvbnMuaW50ZXJ2YWwpIGRhdGEucGF1c2UoKS5jeWNsZSgpXG5cdFx0fSlcblx0fVxuXG5cdHZhciBvbGQgPSAkLmZuLmNhcm91c2VsXG5cblx0JC5mbi5jYXJvdXNlbCA9IFBsdWdpblxuXHQkLmZuLmNhcm91c2VsLkNvbnN0cnVjdG9yID0gQ2Fyb3VzZWxcblxuXG5cdC8vIENBUk9VU0VMIE5PIENPTkZMSUNUXG5cdC8vID09PT09PT09PT09PT09PT09PT09XG5cblx0JC5mbi5jYXJvdXNlbC5ub0NvbmZsaWN0ID0gZnVuY3Rpb24oKSB7XG5cdFx0JC5mbi5jYXJvdXNlbCA9IG9sZFxuXHRcdHJldHVybiB0aGlzXG5cdH1cblxuXG5cdC8vIENBUk9VU0VMIERBVEEtQVBJXG5cdC8vID09PT09PT09PT09PT09PT09XG5cblx0JChkb2N1bWVudCkub24oJ2NsaWNrLmJzLmNhcm91c2VsLmRhdGEtYXBpJywgJ1tkYXRhLXNsaWRlXSwgW2RhdGEtc2xpZGUtdG9dJywgZnVuY3Rpb24oZSkge1xuXHRcdHZhciBocmVmXG5cdFx0dmFyICR0aGlzID0gJCh0aGlzKVxuXHRcdHZhciAkdGFyZ2V0ID0gJCgkdGhpcy5hdHRyKCdkYXRhLXRhcmdldCcpIHx8IChocmVmID0gJHRoaXMuYXR0cignaHJlZicpKSAmJiBocmVmLnJlcGxhY2UoLy4qKD89I1teXFxzXSskKS8sICcnKSkgLy8gc3RyaXAgZm9yIGllN1xuXHRcdGlmICghJHRhcmdldC5oYXNDbGFzcygnY2Fyb3VzZWwnKSkgcmV0dXJuXG5cdFx0dmFyIG9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgJHRhcmdldC5kYXRhKCksICR0aGlzLmRhdGEoKSlcblx0XHR2YXIgc2xpZGVJbmRleCA9ICR0aGlzLmF0dHIoJ2RhdGEtc2xpZGUtdG8nKVxuXHRcdGlmIChzbGlkZUluZGV4KSBvcHRpb25zLmludGVydmFsID0gZmFsc2VcblxuXHRcdFBsdWdpbi5jYWxsKCR0YXJnZXQsIG9wdGlvbnMpXG5cblx0XHRpZiAoc2xpZGVJbmRleCkge1xuXHRcdFx0JHRhcmdldC5kYXRhKCdicy5jYXJvdXNlbCcpLnRvKHNsaWRlSW5kZXgpXG5cdFx0fVxuXG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpXG5cdH0pXG5cblx0JCh3aW5kb3cpLm9uKCdsb2FkJywgZnVuY3Rpb24oKSB7XG5cdFx0JCgnW2RhdGEtcmlkZT1cImNhcm91c2VsXCJdJykuZWFjaChmdW5jdGlvbigpIHtcblx0XHRcdHZhciAkY2Fyb3VzZWwgPSAkKHRoaXMpXG5cdFx0XHRQbHVnaW4uY2FsbCgkY2Fyb3VzZWwsICRjYXJvdXNlbC5kYXRhKCkpXG5cdFx0fSlcblx0fSlcblxufShqUXVlcnkpO1xuXG4vKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqIEJvb3RzdHJhcDogY29sbGFwc2UuanMgdjMuMi4wXG4gKiBodHRwOi8vZ2V0Ym9vdHN0cmFwLmNvbS9qYXZhc2NyaXB0LyNjb2xsYXBzZVxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiBDb3B5cmlnaHQgMjAxMS0yMDE0IFR3aXR0ZXIsIEluYy5cbiAqIExpY2Vuc2VkIHVuZGVyIE1JVCAoaHR0cHM6Ly9naXRodWIuY29tL3R3YnMvYm9vdHN0cmFwL2Jsb2IvbWFzdGVyL0xJQ0VOU0UpXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuXG4rIGZ1bmN0aW9uKCQpIHtcblx0J3VzZSBzdHJpY3QnO1xuXG5cdC8vIENPTExBUFNFIFBVQkxJQyBDTEFTUyBERUZJTklUSU9OXG5cdC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cblx0dmFyIENvbGxhcHNlID0gZnVuY3Rpb24oZWxlbWVudCwgb3B0aW9ucykge1xuXHRcdHRoaXMuJGVsZW1lbnQgPSAkKGVsZW1lbnQpXG5cdFx0dGhpcy5vcHRpb25zID0gJC5leHRlbmQoe30sIENvbGxhcHNlLkRFRkFVTFRTLCBvcHRpb25zKVxuXHRcdHRoaXMudHJhbnNpdGlvbmluZyA9IG51bGxcblxuXHRcdGlmICh0aGlzLm9wdGlvbnMucGFyZW50KSB0aGlzLiRwYXJlbnQgPSAkKHRoaXMub3B0aW9ucy5wYXJlbnQpXG5cdFx0aWYgKHRoaXMub3B0aW9ucy50b2dnbGUpIHRoaXMudG9nZ2xlKClcblx0fVxuXG5cdENvbGxhcHNlLlZFUlNJT04gPSAnMy4yLjAnXG5cblx0Q29sbGFwc2UuREVGQVVMVFMgPSB7XG5cdFx0dG9nZ2xlOiB0cnVlXG5cdH1cblxuXHRDb2xsYXBzZS5wcm90b3R5cGUuZGltZW5zaW9uID0gZnVuY3Rpb24oKSB7XG5cdFx0dmFyIGhhc1dpZHRoID0gdGhpcy4kZWxlbWVudC5oYXNDbGFzcygnd2lkdGgnKVxuXHRcdHJldHVybiBoYXNXaWR0aCA/ICd3aWR0aCcgOiAnaGVpZ2h0J1xuXHR9XG5cblx0Q29sbGFwc2UucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbigpIHtcblx0XHRpZiAodGhpcy50cmFuc2l0aW9uaW5nIHx8IHRoaXMuJGVsZW1lbnQuaGFzQ2xhc3MoJ2luJykpIHJldHVyblxuXG5cdFx0dmFyIHN0YXJ0RXZlbnQgPSAkLkV2ZW50KCdzaG93LmJzLmNvbGxhcHNlJylcblx0XHR0aGlzLiRlbGVtZW50LnRyaWdnZXIoc3RhcnRFdmVudClcblx0XHRpZiAoc3RhcnRFdmVudC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgcmV0dXJuXG5cblx0XHR2YXIgYWN0aXZlcyA9IHRoaXMuJHBhcmVudCAmJiB0aGlzLiRwYXJlbnQuZmluZCgnPiAucGFuZWwgPiAuaW4nKVxuXG5cdFx0aWYgKGFjdGl2ZXMgJiYgYWN0aXZlcy5sZW5ndGgpIHtcblx0XHRcdHZhciBoYXNEYXRhID0gYWN0aXZlcy5kYXRhKCdicy5jb2xsYXBzZScpXG5cdFx0XHRpZiAoaGFzRGF0YSAmJiBoYXNEYXRhLnRyYW5zaXRpb25pbmcpIHJldHVyblxuXHRcdFx0UGx1Z2luLmNhbGwoYWN0aXZlcywgJ2hpZGUnKVxuXHRcdFx0aGFzRGF0YSB8fCBhY3RpdmVzLmRhdGEoJ2JzLmNvbGxhcHNlJywgbnVsbClcblx0XHR9XG5cblx0XHR2YXIgZGltZW5zaW9uID0gdGhpcy5kaW1lbnNpb24oKVxuXG5cdFx0dGhpcy4kZWxlbWVudFxuXHRcdFx0LnJlbW92ZUNsYXNzKCdjb2xsYXBzZScpXG5cdFx0XHQuYWRkQ2xhc3MoJ2NvbGxhcHNpbmcnKVtkaW1lbnNpb25dKDApXG5cblx0XHR0aGlzLnRyYW5zaXRpb25pbmcgPSAxXG5cblx0XHR2YXIgY29tcGxldGUgPSBmdW5jdGlvbigpIHtcblx0XHRcdHRoaXMuJGVsZW1lbnRcblx0XHRcdFx0LnJlbW92ZUNsYXNzKCdjb2xsYXBzaW5nJylcblx0XHRcdFx0LmFkZENsYXNzKCdjb2xsYXBzZSBpbicpW2RpbWVuc2lvbl0oJycpXG5cdFx0XHR0aGlzLnRyYW5zaXRpb25pbmcgPSAwXG5cdFx0XHR0aGlzLiRlbGVtZW50XG5cdFx0XHRcdC50cmlnZ2VyKCdzaG93bi5icy5jb2xsYXBzZScpXG5cdFx0fVxuXG5cdFx0aWYgKCEkLnN1cHBvcnQudHJhbnNpdGlvbikgcmV0dXJuIGNvbXBsZXRlLmNhbGwodGhpcylcblxuXHRcdHZhciBzY3JvbGxTaXplID0gJC5jYW1lbENhc2UoWydzY3JvbGwnLCBkaW1lbnNpb25dLmpvaW4oJy0nKSlcblxuXHRcdHRoaXMuJGVsZW1lbnRcblx0XHRcdC5vbmUoJ2JzVHJhbnNpdGlvbkVuZCcsICQucHJveHkoY29tcGxldGUsIHRoaXMpKVxuXHRcdFx0LmVtdWxhdGVUcmFuc2l0aW9uRW5kKDM1MClbZGltZW5zaW9uXSh0aGlzLiRlbGVtZW50WzBdW3Njcm9sbFNpemVdKVxuXHR9XG5cblx0Q29sbGFwc2UucHJvdG90eXBlLmhpZGUgPSBmdW5jdGlvbigpIHtcblx0XHRpZiAodGhpcy50cmFuc2l0aW9uaW5nIHx8ICF0aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCdpbicpKSByZXR1cm5cblxuXHRcdHZhciBzdGFydEV2ZW50ID0gJC5FdmVudCgnaGlkZS5icy5jb2xsYXBzZScpXG5cdFx0dGhpcy4kZWxlbWVudC50cmlnZ2VyKHN0YXJ0RXZlbnQpXG5cdFx0aWYgKHN0YXJ0RXZlbnQuaXNEZWZhdWx0UHJldmVudGVkKCkpIHJldHVyblxuXG5cdFx0dmFyIGRpbWVuc2lvbiA9IHRoaXMuZGltZW5zaW9uKClcblxuXHRcdHRoaXMuJGVsZW1lbnRbZGltZW5zaW9uXSh0aGlzLiRlbGVtZW50W2RpbWVuc2lvbl0oKSlbMF0ub2Zmc2V0SGVpZ2h0XG5cblx0XHR0aGlzLiRlbGVtZW50XG5cdFx0XHQuYWRkQ2xhc3MoJ2NvbGxhcHNpbmcnKVxuXHRcdFx0LnJlbW92ZUNsYXNzKCdjb2xsYXBzZScpXG5cdFx0XHQucmVtb3ZlQ2xhc3MoJ2luJylcblxuXHRcdHRoaXMudHJhbnNpdGlvbmluZyA9IDFcblxuXHRcdHZhciBjb21wbGV0ZSA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0dGhpcy50cmFuc2l0aW9uaW5nID0gMFxuXHRcdFx0dGhpcy4kZWxlbWVudFxuXHRcdFx0XHQudHJpZ2dlcignaGlkZGVuLmJzLmNvbGxhcHNlJylcblx0XHRcdFx0LnJlbW92ZUNsYXNzKCdjb2xsYXBzaW5nJylcblx0XHRcdFx0LmFkZENsYXNzKCdjb2xsYXBzZScpXG5cdFx0fVxuXG5cdFx0aWYgKCEkLnN1cHBvcnQudHJhbnNpdGlvbikgcmV0dXJuIGNvbXBsZXRlLmNhbGwodGhpcylcblxuXHRcdHRoaXMuJGVsZW1lbnRbZGltZW5zaW9uXSgwKVxuXHRcdFx0Lm9uZSgnYnNUcmFuc2l0aW9uRW5kJywgJC5wcm94eShjb21wbGV0ZSwgdGhpcykpXG5cdFx0XHQuZW11bGF0ZVRyYW5zaXRpb25FbmQoMzUwKVxuXHR9XG5cblx0Q29sbGFwc2UucHJvdG90eXBlLnRvZ2dsZSA9IGZ1bmN0aW9uKCkge1xuXHRcdHRoaXNbdGhpcy4kZWxlbWVudC5oYXNDbGFzcygnaW4nKSA/ICdoaWRlJyA6ICdzaG93J10oKVxuXHR9XG5cblxuXHQvLyBDT0xMQVBTRSBQTFVHSU4gREVGSU5JVElPTlxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5cdGZ1bmN0aW9uIFBsdWdpbihvcHRpb24pIHtcblx0XHRyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyICR0aGlzID0gJCh0aGlzKVxuXHRcdFx0dmFyIGRhdGEgPSAkdGhpcy5kYXRhKCdicy5jb2xsYXBzZScpXG5cdFx0XHR2YXIgb3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBDb2xsYXBzZS5ERUZBVUxUUywgJHRoaXMuZGF0YSgpLCB0eXBlb2Ygb3B0aW9uID09ICdvYmplY3QnICYmIG9wdGlvbilcblxuXHRcdFx0aWYgKCFkYXRhICYmIG9wdGlvbnMudG9nZ2xlICYmIG9wdGlvbiA9PSAnc2hvdycpIG9wdGlvbiA9ICFvcHRpb25cblx0XHRcdGlmICghZGF0YSkgJHRoaXMuZGF0YSgnYnMuY29sbGFwc2UnLCAoZGF0YSA9IG5ldyBDb2xsYXBzZSh0aGlzLCBvcHRpb25zKSkpXG5cdFx0XHRpZiAodHlwZW9mIG9wdGlvbiA9PSAnc3RyaW5nJykgZGF0YVtvcHRpb25dKClcblx0XHR9KVxuXHR9XG5cblx0dmFyIG9sZCA9ICQuZm4uY29sbGFwc2VcblxuXHQkLmZuLmNvbGxhcHNlID0gUGx1Z2luXG5cdCQuZm4uY29sbGFwc2UuQ29uc3RydWN0b3IgPSBDb2xsYXBzZVxuXG5cblx0Ly8gQ09MTEFQU0UgTk8gQ09ORkxJQ1Rcblx0Ly8gPT09PT09PT09PT09PT09PT09PT1cblxuXHQkLmZuLmNvbGxhcHNlLm5vQ29uZmxpY3QgPSBmdW5jdGlvbigpIHtcblx0XHQkLmZuLmNvbGxhcHNlID0gb2xkXG5cdFx0cmV0dXJuIHRoaXNcblx0fVxuXG5cblx0Ly8gQ09MTEFQU0UgREFUQS1BUElcblx0Ly8gPT09PT09PT09PT09PT09PT1cblxuXHQkKGRvY3VtZW50KS5vbignY2xpY2suYnMuY29sbGFwc2UuZGF0YS1hcGknLCAnW2RhdGEtdG9nZ2xlPVwiY29sbGFwc2VcIl0nLCBmdW5jdGlvbihlKSB7XG5cdFx0dmFyIGhyZWZcblx0XHR2YXIgJHRoaXMgPSAkKHRoaXMpXG5cdFx0dmFyIHRhcmdldCA9ICR0aGlzLmF0dHIoJ2RhdGEtdGFyZ2V0JykgfHwgZS5wcmV2ZW50RGVmYXVsdCgpIHx8IChocmVmID0gJHRoaXMuYXR0cignaHJlZicpKSAmJiBocmVmLnJlcGxhY2UoLy4qKD89I1teXFxzXSskKS8sICcnKSAvLyBzdHJpcCBmb3IgaWU3XG5cdFx0dmFyICR0YXJnZXQgPSAkKHRhcmdldClcblx0XHR2YXIgZGF0YSA9ICR0YXJnZXQuZGF0YSgnYnMuY29sbGFwc2UnKVxuXHRcdHZhciBvcHRpb24gPSBkYXRhID8gJ3RvZ2dsZScgOiAkdGhpcy5kYXRhKClcblx0XHR2YXIgcGFyZW50ID0gJHRoaXMuYXR0cignZGF0YS1wYXJlbnQnKVxuXHRcdHZhciAkcGFyZW50ID0gcGFyZW50ICYmICQocGFyZW50KVxuXG5cdFx0aWYgKCFkYXRhIHx8ICFkYXRhLnRyYW5zaXRpb25pbmcpIHtcblx0XHRcdGlmICgkcGFyZW50KSAkcGFyZW50LmZpbmQoJ1tkYXRhLXRvZ2dsZT1cImNvbGxhcHNlXCJdW2RhdGEtcGFyZW50PVwiJyArIHBhcmVudCArICdcIl0nKS5ub3QoJHRoaXMpLmFkZENsYXNzKCdjb2xsYXBzZWQnKVxuXHRcdFx0JHRoaXNbJHRhcmdldC5oYXNDbGFzcygnaW4nKSA/ICdhZGRDbGFzcycgOiAncmVtb3ZlQ2xhc3MnXSgnY29sbGFwc2VkJylcblx0XHR9XG5cblx0XHRQbHVnaW4uY2FsbCgkdGFyZ2V0LCBvcHRpb24pXG5cdH0pXG5cbn0oalF1ZXJ5KTtcblxuLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiBCb290c3RyYXA6IGRyb3Bkb3duLmpzIHYzLjIuMFxuICogaHR0cDovL2dldGJvb3RzdHJhcC5jb20vamF2YXNjcmlwdC8jZHJvcGRvd25zXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqIENvcHlyaWdodCAyMDExLTIwMTQgVHdpdHRlciwgSW5jLlxuICogTGljZW5zZWQgdW5kZXIgTUlUIChodHRwczovL2dpdGh1Yi5jb20vdHdicy9ib290c3RyYXAvYmxvYi9tYXN0ZXIvTElDRU5TRSlcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG5cbisgZnVuY3Rpb24oJCkge1xuXHQndXNlIHN0cmljdCc7XG5cblx0Ly8gRFJPUERPV04gQ0xBU1MgREVGSU5JVElPTlxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09PT09XG5cblx0dmFyIGJhY2tkcm9wID0gJy5kcm9wZG93bi1iYWNrZHJvcCdcblx0dmFyIHRvZ2dsZSA9ICdbZGF0YS10b2dnbGU9XCJkcm9wZG93blwiXSdcblx0dmFyIERyb3Bkb3duID0gZnVuY3Rpb24oZWxlbWVudCkge1xuXHRcdCQoZWxlbWVudCkub24oJ2NsaWNrLmJzLmRyb3Bkb3duJywgdGhpcy50b2dnbGUpXG5cdH1cblxuXHREcm9wZG93bi5WRVJTSU9OID0gJzMuMi4wJ1xuXG5cdERyb3Bkb3duLnByb3RvdHlwZS50b2dnbGUgPSBmdW5jdGlvbihlKSB7XG5cdFx0dmFyICR0aGlzID0gJCh0aGlzKVxuXG5cdFx0aWYgKCR0aGlzLmlzKCcuZGlzYWJsZWQsIDpkaXNhYmxlZCcpKSByZXR1cm5cblxuXHRcdHZhciAkcGFyZW50ID0gZ2V0UGFyZW50KCR0aGlzKVxuXHRcdHZhciBpc0FjdGl2ZSA9ICRwYXJlbnQuaGFzQ2xhc3MoJ29wZW4nKVxuXG5cdFx0Y2xlYXJNZW51cygpXG5cblx0XHRpZiAoIWlzQWN0aXZlKSB7XG5cdFx0XHRpZiAoJ29udG91Y2hzdGFydCcgaW4gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50ICYmICEkcGFyZW50LmNsb3Nlc3QoJy5uYXZiYXItbmF2JykubGVuZ3RoKSB7XG5cdFx0XHRcdC8vIGlmIG1vYmlsZSB3ZSB1c2UgYSBiYWNrZHJvcCBiZWNhdXNlIGNsaWNrIGV2ZW50cyBkb24ndCBkZWxlZ2F0ZVxuXHRcdFx0XHQkKCc8ZGl2IGNsYXNzPVwiZHJvcGRvd24tYmFja2Ryb3BcIi8+JykuaW5zZXJ0QWZ0ZXIoJCh0aGlzKSkub24oJ2NsaWNrJywgY2xlYXJNZW51cylcblx0XHRcdH1cblxuXHRcdFx0dmFyIHJlbGF0ZWRUYXJnZXQgPSB7XG5cdFx0XHRcdHJlbGF0ZWRUYXJnZXQ6IHRoaXNcblx0XHRcdH1cblx0XHRcdCRwYXJlbnQudHJpZ2dlcihlID0gJC5FdmVudCgnc2hvdy5icy5kcm9wZG93bicsIHJlbGF0ZWRUYXJnZXQpKVxuXG5cdFx0XHRpZiAoZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgcmV0dXJuXG5cblx0XHRcdCR0aGlzLnRyaWdnZXIoJ2ZvY3VzJylcblxuXHRcdFx0JHBhcmVudFxuXHRcdFx0XHQudG9nZ2xlQ2xhc3MoJ29wZW4nKVxuXHRcdFx0XHQudHJpZ2dlcignc2hvd24uYnMuZHJvcGRvd24nLCByZWxhdGVkVGFyZ2V0KVxuXHRcdH1cblxuXHRcdHJldHVybiBmYWxzZVxuXHR9XG5cblx0RHJvcGRvd24ucHJvdG90eXBlLmtleWRvd24gPSBmdW5jdGlvbihlKSB7XG5cdFx0aWYgKCEvKDM4fDQwfDI3KS8udGVzdChlLmtleUNvZGUpKSByZXR1cm5cblxuXHRcdHZhciAkdGhpcyA9ICQodGhpcylcblxuXHRcdGUucHJldmVudERlZmF1bHQoKVxuXHRcdGUuc3RvcFByb3BhZ2F0aW9uKClcblxuXHRcdGlmICgkdGhpcy5pcygnLmRpc2FibGVkLCA6ZGlzYWJsZWQnKSkgcmV0dXJuXG5cblx0XHR2YXIgJHBhcmVudCA9IGdldFBhcmVudCgkdGhpcylcblx0XHR2YXIgaXNBY3RpdmUgPSAkcGFyZW50Lmhhc0NsYXNzKCdvcGVuJylcblxuXHRcdGlmICghaXNBY3RpdmUgfHwgKGlzQWN0aXZlICYmIGUua2V5Q29kZSA9PSAyNykpIHtcblx0XHRcdGlmIChlLndoaWNoID09IDI3KSAkcGFyZW50LmZpbmQodG9nZ2xlKS50cmlnZ2VyKCdmb2N1cycpXG5cdFx0XHRyZXR1cm4gJHRoaXMudHJpZ2dlcignY2xpY2snKVxuXHRcdH1cblxuXHRcdHZhciBkZXNjID0gJyBsaTpub3QoLmRpdmlkZXIpOnZpc2libGUgYSdcblx0XHR2YXIgJGl0ZW1zID0gJHBhcmVudC5maW5kKCdbcm9sZT1cIm1lbnVcIl0nICsgZGVzYyArICcsIFtyb2xlPVwibGlzdGJveFwiXScgKyBkZXNjKVxuXG5cdFx0aWYgKCEkaXRlbXMubGVuZ3RoKSByZXR1cm5cblxuXHRcdHZhciBpbmRleCA9ICRpdGVtcy5pbmRleCgkaXRlbXMuZmlsdGVyKCc6Zm9jdXMnKSlcblxuXHRcdGlmIChlLmtleUNvZGUgPT0gMzggJiYgaW5kZXggPiAwKSBpbmRleC0tIC8vIHVwXG5cdFx0XHRpZiAoZS5rZXlDb2RlID09IDQwICYmIGluZGV4IDwgJGl0ZW1zLmxlbmd0aCAtIDEpIGluZGV4KysgLy8gZG93blxuXHRcdFx0XHRpZiAoIX5pbmRleCkgaW5kZXggPSAwXG5cblx0XHQkaXRlbXMuZXEoaW5kZXgpLnRyaWdnZXIoJ2ZvY3VzJylcblx0fVxuXG5cdGZ1bmN0aW9uIGNsZWFyTWVudXMoZSkge1xuXHRcdGlmIChlICYmIGUud2hpY2ggPT09IDMpIHJldHVyblxuXHRcdCQoYmFja2Ryb3ApLnJlbW92ZSgpXG5cdFx0JCh0b2dnbGUpLmVhY2goZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgJHBhcmVudCA9IGdldFBhcmVudCgkKHRoaXMpKVxuXHRcdFx0dmFyIHJlbGF0ZWRUYXJnZXQgPSB7XG5cdFx0XHRcdHJlbGF0ZWRUYXJnZXQ6IHRoaXNcblx0XHRcdH1cblx0XHRcdGlmICghJHBhcmVudC5oYXNDbGFzcygnb3BlbicpKSByZXR1cm5cblx0XHRcdCRwYXJlbnQudHJpZ2dlcihlID0gJC5FdmVudCgnaGlkZS5icy5kcm9wZG93bicsIHJlbGF0ZWRUYXJnZXQpKVxuXHRcdFx0aWYgKGUuaXNEZWZhdWx0UHJldmVudGVkKCkpIHJldHVyblxuXHRcdFx0JHBhcmVudC5yZW1vdmVDbGFzcygnb3BlbicpLnRyaWdnZXIoJ2hpZGRlbi5icy5kcm9wZG93bicsIHJlbGF0ZWRUYXJnZXQpXG5cdFx0fSlcblx0fVxuXG5cdGZ1bmN0aW9uIGdldFBhcmVudCgkdGhpcykge1xuXHRcdHZhciBzZWxlY3RvciA9ICR0aGlzLmF0dHIoJ2RhdGEtdGFyZ2V0JylcblxuXHRcdGlmICghc2VsZWN0b3IpIHtcblx0XHRcdHNlbGVjdG9yID0gJHRoaXMuYXR0cignaHJlZicpXG5cdFx0XHRzZWxlY3RvciA9IHNlbGVjdG9yICYmIC8jW0EtWmEtel0vLnRlc3Qoc2VsZWN0b3IpICYmIHNlbGVjdG9yLnJlcGxhY2UoLy4qKD89I1teXFxzXSokKS8sICcnKSAvLyBzdHJpcCBmb3IgaWU3XG5cdFx0fVxuXG5cdFx0dmFyICRwYXJlbnQgPSBzZWxlY3RvciAmJiAkKHNlbGVjdG9yKVxuXG5cdFx0cmV0dXJuICRwYXJlbnQgJiYgJHBhcmVudC5sZW5ndGggPyAkcGFyZW50IDogJHRoaXMucGFyZW50KClcblx0fVxuXG5cblx0Ly8gRFJPUERPV04gUExVR0lOIERFRklOSVRJT05cblx0Ly8gPT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuXHRmdW5jdGlvbiBQbHVnaW4ob3B0aW9uKSB7XG5cdFx0cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHtcblx0XHRcdHZhciAkdGhpcyA9ICQodGhpcylcblx0XHRcdHZhciBkYXRhID0gJHRoaXMuZGF0YSgnYnMuZHJvcGRvd24nKVxuXG5cdFx0XHRpZiAoIWRhdGEpICR0aGlzLmRhdGEoJ2JzLmRyb3Bkb3duJywgKGRhdGEgPSBuZXcgRHJvcGRvd24odGhpcykpKVxuXHRcdFx0aWYgKHR5cGVvZiBvcHRpb24gPT0gJ3N0cmluZycpIGRhdGFbb3B0aW9uXS5jYWxsKCR0aGlzKVxuXHRcdH0pXG5cdH1cblxuXHR2YXIgb2xkID0gJC5mbi5kcm9wZG93blxuXG5cdCQuZm4uZHJvcGRvd24gPSBQbHVnaW5cblx0JC5mbi5kcm9wZG93bi5Db25zdHJ1Y3RvciA9IERyb3Bkb3duXG5cblxuXHQvLyBEUk9QRE9XTiBOTyBDT05GTElDVFxuXHQvLyA9PT09PT09PT09PT09PT09PT09PVxuXG5cdCQuZm4uZHJvcGRvd24ubm9Db25mbGljdCA9IGZ1bmN0aW9uKCkge1xuXHRcdCQuZm4uZHJvcGRvd24gPSBvbGRcblx0XHRyZXR1cm4gdGhpc1xuXHR9XG5cblxuXHQvLyBBUFBMWSBUTyBTVEFOREFSRCBEUk9QRE9XTiBFTEVNRU5UU1xuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5cdCQoZG9jdW1lbnQpXG5cdFx0Lm9uKCdjbGljay5icy5kcm9wZG93bi5kYXRhLWFwaScsIGNsZWFyTWVudXMpXG5cdFx0Lm9uKCdjbGljay5icy5kcm9wZG93bi5kYXRhLWFwaScsICcuZHJvcGRvd24gZm9ybScsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKClcblx0XHR9KVxuXHRcdC5vbignY2xpY2suYnMuZHJvcGRvd24uZGF0YS1hcGknLCB0b2dnbGUsIERyb3Bkb3duLnByb3RvdHlwZS50b2dnbGUpXG5cdFx0Lm9uKCdrZXlkb3duLmJzLmRyb3Bkb3duLmRhdGEtYXBpJywgdG9nZ2xlICsgJywgW3JvbGU9XCJtZW51XCJdLCBbcm9sZT1cImxpc3Rib3hcIl0nLCBEcm9wZG93bi5wcm90b3R5cGUua2V5ZG93bilcblxufShqUXVlcnkpO1xuXG4vKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqIEJvb3RzdHJhcDogdGFiLmpzIHYzLjIuMFxuICogaHR0cDovL2dldGJvb3RzdHJhcC5jb20vamF2YXNjcmlwdC8jdGFic1xuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiBDb3B5cmlnaHQgMjAxMS0yMDE0IFR3aXR0ZXIsIEluYy5cbiAqIExpY2Vuc2VkIHVuZGVyIE1JVCAoaHR0cHM6Ly9naXRodWIuY29tL3R3YnMvYm9vdHN0cmFwL2Jsb2IvbWFzdGVyL0xJQ0VOU0UpXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuXG4rIGZ1bmN0aW9uKCQpIHtcblx0J3VzZSBzdHJpY3QnO1xuXG5cdC8vIFRBQiBDTEFTUyBERUZJTklUSU9OXG5cdC8vID09PT09PT09PT09PT09PT09PT09XG5cblx0dmFyIFRhYiA9IGZ1bmN0aW9uKGVsZW1lbnQpIHtcblx0XHR0aGlzLmVsZW1lbnQgPSAkKGVsZW1lbnQpXG5cdH1cblxuXHRUYWIuVkVSU0lPTiA9ICczLjIuMCdcblxuXHRUYWIucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbigpIHtcblx0XHR2YXIgJHRoaXMgPSB0aGlzLmVsZW1lbnRcblx0XHR2YXIgJHVsID0gJHRoaXMuY2xvc2VzdCgndWw6bm90KC5kcm9wZG93bi1tZW51KScpXG5cdFx0dmFyIHNlbGVjdG9yID0gJHRoaXMuZGF0YSgndGFyZ2V0JylcblxuXHRcdGlmICghc2VsZWN0b3IpIHtcblx0XHRcdHNlbGVjdG9yID0gJHRoaXMuYXR0cignaHJlZicpXG5cdFx0XHRzZWxlY3RvciA9IHNlbGVjdG9yICYmIHNlbGVjdG9yLnJlcGxhY2UoLy4qKD89I1teXFxzXSokKS8sICcnKSAvLyBzdHJpcCBmb3IgaWU3XG5cdFx0fVxuXG5cdFx0aWYgKCR0aGlzLnBhcmVudCgnbGknKS5oYXNDbGFzcygnYWN0aXZlJykpIHJldHVyblxuXG5cdFx0dmFyIHByZXZpb3VzID0gJHVsLmZpbmQoJy5hY3RpdmU6bGFzdCBhJylbMF1cblx0XHR2YXIgZSA9ICQuRXZlbnQoJ3Nob3cuYnMudGFiJywge1xuXHRcdFx0cmVsYXRlZFRhcmdldDogcHJldmlvdXNcblx0XHR9KVxuXG5cdFx0JHRoaXMudHJpZ2dlcihlKVxuXG5cdFx0aWYgKGUuaXNEZWZhdWx0UHJldmVudGVkKCkpIHJldHVyblxuXG5cdFx0dmFyICR0YXJnZXQgPSAkKHNlbGVjdG9yKVxuXG5cdFx0dGhpcy5hY3RpdmF0ZSgkdGhpcy5jbG9zZXN0KCdsaScpLCAkdWwpXG5cdFx0dGhpcy5hY3RpdmF0ZSgkdGFyZ2V0LCAkdGFyZ2V0LnBhcmVudCgpLCBmdW5jdGlvbigpIHtcblx0XHRcdCR0aGlzLnRyaWdnZXIoe1xuXHRcdFx0XHR0eXBlOiAnc2hvd24uYnMudGFiJyxcblx0XHRcdFx0cmVsYXRlZFRhcmdldDogcHJldmlvdXNcblx0XHRcdH0pXG5cdFx0fSlcblx0fVxuXG5cdFRhYi5wcm90b3R5cGUuYWN0aXZhdGUgPSBmdW5jdGlvbihlbGVtZW50LCBjb250YWluZXIsIGNhbGxiYWNrKSB7XG5cdFx0dmFyICRhY3RpdmUgPSBjb250YWluZXIuZmluZCgnPiAuYWN0aXZlJylcblx0XHR2YXIgdHJhbnNpdGlvbiA9IGNhbGxiYWNrICYmICQuc3VwcG9ydC50cmFuc2l0aW9uICYmICRhY3RpdmUuaGFzQ2xhc3MoJ2ZhZGUnKVxuXG5cdFx0ZnVuY3Rpb24gbmV4dCgpIHtcblx0XHRcdCRhY3RpdmVcblx0XHRcdFx0LnJlbW92ZUNsYXNzKCdhY3RpdmUnKVxuXHRcdFx0XHQuZmluZCgnPiAuZHJvcGRvd24tbWVudSA+IC5hY3RpdmUnKVxuXHRcdFx0XHQucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpXG5cblx0XHRcdGVsZW1lbnQuYWRkQ2xhc3MoJ2FjdGl2ZScpXG5cblx0XHRcdGlmICh0cmFuc2l0aW9uKSB7XG5cdFx0XHRcdGVsZW1lbnRbMF0ub2Zmc2V0V2lkdGggLy8gcmVmbG93IGZvciB0cmFuc2l0aW9uXG5cdFx0XHRcdGVsZW1lbnQuYWRkQ2xhc3MoJ2luJylcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGVsZW1lbnQucmVtb3ZlQ2xhc3MoJ2ZhZGUnKVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAoZWxlbWVudC5wYXJlbnQoJy5kcm9wZG93bi1tZW51JykpIHtcblx0XHRcdFx0ZWxlbWVudC5jbG9zZXN0KCdsaS5kcm9wZG93bicpLmFkZENsYXNzKCdhY3RpdmUnKVxuXHRcdFx0fVxuXG5cdFx0XHRjYWxsYmFjayAmJiBjYWxsYmFjaygpXG5cdFx0fVxuXG5cdFx0dHJhbnNpdGlvbiA/XG5cdFx0XHQkYWN0aXZlXG5cdFx0XHQub25lKCdic1RyYW5zaXRpb25FbmQnLCBuZXh0KVxuXHRcdFx0LmVtdWxhdGVUcmFuc2l0aW9uRW5kKDE1MCkgOlxuXHRcdFx0bmV4dCgpXG5cblx0XHQkYWN0aXZlLnJlbW92ZUNsYXNzKCdpbicpXG5cdH1cblxuXG5cdC8vIFRBQiBQTFVHSU4gREVGSU5JVElPTlxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT1cblxuXHRmdW5jdGlvbiBQbHVnaW4ob3B0aW9uKSB7XG5cdFx0cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHtcblx0XHRcdHZhciAkdGhpcyA9ICQodGhpcylcblx0XHRcdHZhciBkYXRhID0gJHRoaXMuZGF0YSgnYnMudGFiJylcblxuXHRcdFx0aWYgKCFkYXRhKSAkdGhpcy5kYXRhKCdicy50YWInLCAoZGF0YSA9IG5ldyBUYWIodGhpcykpKVxuXHRcdFx0aWYgKHR5cGVvZiBvcHRpb24gPT0gJ3N0cmluZycpIGRhdGFbb3B0aW9uXSgpXG5cdFx0fSlcblx0fVxuXG5cdHZhciBvbGQgPSAkLmZuLnRhYlxuXG5cdCQuZm4udGFiID0gUGx1Z2luXG5cdCQuZm4udGFiLkNvbnN0cnVjdG9yID0gVGFiXG5cblxuXHQvLyBUQUIgTk8gQ09ORkxJQ1Rcblx0Ly8gPT09PT09PT09PT09PT09XG5cblx0JC5mbi50YWIubm9Db25mbGljdCA9IGZ1bmN0aW9uKCkge1xuXHRcdCQuZm4udGFiID0gb2xkXG5cdFx0cmV0dXJuIHRoaXNcblx0fVxuXG5cblx0Ly8gVEFCIERBVEEtQVBJXG5cdC8vID09PT09PT09PT09PVxuXG5cdCQoZG9jdW1lbnQpLm9uKCdjbGljay5icy50YWIuZGF0YS1hcGknLCAnW2RhdGEtdG9nZ2xlPVwidGFiXCJdLCBbZGF0YS10b2dnbGU9XCJwaWxsXCJdJywgZnVuY3Rpb24oZSkge1xuXHRcdGUucHJldmVudERlZmF1bHQoKVxuXHRcdFBsdWdpbi5jYWxsKCQodGhpcyksICdzaG93Jylcblx0fSlcblxufShqUXVlcnkpO1xuXG4vKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqIEJvb3RzdHJhcDogdHJhbnNpdGlvbi5qcyB2My4yLjBcbiAqIGh0dHA6Ly9nZXRib290c3RyYXAuY29tL2phdmFzY3JpcHQvI3RyYW5zaXRpb25zXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqIENvcHlyaWdodCAyMDExLTIwMTQgVHdpdHRlciwgSW5jLlxuICogTGljZW5zZWQgdW5kZXIgTUlUIChodHRwczovL2dpdGh1Yi5jb20vdHdicy9ib290c3RyYXAvYmxvYi9tYXN0ZXIvTElDRU5TRSlcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG5cbisgZnVuY3Rpb24oJCkge1xuXHQndXNlIHN0cmljdCc7XG5cblx0Ly8gQ1NTIFRSQU5TSVRJT04gU1VQUE9SVCAoU2hvdXRvdXQ6IGh0dHA6Ly93d3cubW9kZXJuaXpyLmNvbS8pXG5cdC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5cdGZ1bmN0aW9uIHRyYW5zaXRpb25FbmQoKSB7XG5cdFx0dmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnYm9vdHN0cmFwJylcblxuXHRcdHZhciB0cmFuc0VuZEV2ZW50TmFtZXMgPSB7XG5cdFx0XHRXZWJraXRUcmFuc2l0aW9uOiAnd2Via2l0VHJhbnNpdGlvbkVuZCcsXG5cdFx0XHRNb3pUcmFuc2l0aW9uOiAndHJhbnNpdGlvbmVuZCcsXG5cdFx0XHRPVHJhbnNpdGlvbjogJ29UcmFuc2l0aW9uRW5kIG90cmFuc2l0aW9uZW5kJyxcblx0XHRcdHRyYW5zaXRpb246ICd0cmFuc2l0aW9uZW5kJ1xuXHRcdH1cblxuXHRcdGZvciAodmFyIG5hbWUgaW4gdHJhbnNFbmRFdmVudE5hbWVzKSB7XG5cdFx0XHRpZiAoZWwuc3R5bGVbbmFtZV0gIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRcdGVuZDogdHJhbnNFbmRFdmVudE5hbWVzW25hbWVdXG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gZmFsc2UgLy8gZXhwbGljaXQgZm9yIGllOCAoICAuXy4pXG5cdH1cblxuXHQvLyBodHRwOi8vYmxvZy5hbGV4bWFjY2F3LmNvbS9jc3MtdHJhbnNpdGlvbnNcblx0JC5mbi5lbXVsYXRlVHJhbnNpdGlvbkVuZCA9IGZ1bmN0aW9uKGR1cmF0aW9uKSB7XG5cdFx0dmFyIGNhbGxlZCA9IGZhbHNlXG5cdFx0dmFyICRlbCA9IHRoaXNcblx0XHQkKHRoaXMpLm9uZSgnYnNUcmFuc2l0aW9uRW5kJywgZnVuY3Rpb24oKSB7XG5cdFx0XHRjYWxsZWQgPSB0cnVlXG5cdFx0fSlcblx0XHR2YXIgY2FsbGJhY2sgPSBmdW5jdGlvbigpIHtcblx0XHRcdGlmICghY2FsbGVkKSAkKCRlbCkudHJpZ2dlcigkLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQpXG5cdFx0fVxuXHRcdHNldFRpbWVvdXQoY2FsbGJhY2ssIGR1cmF0aW9uKVxuXHRcdHJldHVybiB0aGlzXG5cdH1cblxuXHQkKGZ1bmN0aW9uKCkge1xuXHRcdCQuc3VwcG9ydC50cmFuc2l0aW9uID0gdHJhbnNpdGlvbkVuZCgpXG5cblx0XHRpZiAoISQuc3VwcG9ydC50cmFuc2l0aW9uKSByZXR1cm5cblxuXHRcdCQuZXZlbnQuc3BlY2lhbC5ic1RyYW5zaXRpb25FbmQgPSB7XG5cdFx0XHRiaW5kVHlwZTogJC5zdXBwb3J0LnRyYW5zaXRpb24uZW5kLFxuXHRcdFx0ZGVsZWdhdGVUeXBlOiAkLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQsXG5cdFx0XHRoYW5kbGU6IGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0aWYgKCQoZS50YXJnZXQpLmlzKHRoaXMpKSByZXR1cm4gZS5oYW5kbGVPYmouaGFuZGxlci5hcHBseSh0aGlzLCBhcmd1bWVudHMpXG5cdFx0XHR9XG5cdFx0fVxuXHR9KVxuXG59KGpRdWVyeSk7XG5cbi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogQm9vdHN0cmFwOiBzY3JvbGxzcHkuanMgdjMuMi4wXG4gKiBodHRwOi8vZ2V0Ym9vdHN0cmFwLmNvbS9qYXZhc2NyaXB0LyNzY3JvbGxzcHlcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogQ29weXJpZ2h0IDIwMTEtMjAxNCBUd2l0dGVyLCBJbmMuXG4gKiBMaWNlbnNlZCB1bmRlciBNSVQgKGh0dHBzOi8vZ2l0aHViLmNvbS90d2JzL2Jvb3RzdHJhcC9ibG9iL21hc3Rlci9MSUNFTlNFKVxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cblxuKyBmdW5jdGlvbigkKSB7XG5cdCd1c2Ugc3RyaWN0JztcblxuXHQvLyBTQ1JPTExTUFkgQ0xBU1MgREVGSU5JVElPTlxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5cdGZ1bmN0aW9uIFNjcm9sbFNweShlbGVtZW50LCBvcHRpb25zKSB7XG5cdFx0dmFyIHByb2Nlc3MgPSAkLnByb3h5KHRoaXMucHJvY2VzcywgdGhpcylcblxuXHRcdHRoaXMuJGJvZHkgPSAkKCdib2R5Jylcblx0XHR0aGlzLiRzY3JvbGxFbGVtZW50ID0gJChlbGVtZW50KS5pcygnYm9keScpID8gJCh3aW5kb3cpIDogJChlbGVtZW50KVxuXHRcdHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBTY3JvbGxTcHkuREVGQVVMVFMsIG9wdGlvbnMpXG5cdFx0dGhpcy5zZWxlY3RvciA9ICh0aGlzLm9wdGlvbnMudGFyZ2V0IHx8ICcnKSArICcgLm5hdiBsaSA+IGEnXG5cdFx0dGhpcy5vZmZzZXRzID0gW11cblx0XHR0aGlzLnRhcmdldHMgPSBbXVxuXHRcdHRoaXMuYWN0aXZlVGFyZ2V0ID0gbnVsbFxuXHRcdHRoaXMuc2Nyb2xsSGVpZ2h0ID0gMFxuXG5cdFx0dGhpcy4kc2Nyb2xsRWxlbWVudC5vbignc2Nyb2xsLmJzLnNjcm9sbHNweScsIHByb2Nlc3MpXG5cdFx0dGhpcy5yZWZyZXNoKClcblx0XHR0aGlzLnByb2Nlc3MoKVxuXHR9XG5cblx0U2Nyb2xsU3B5LlZFUlNJT04gPSAnMy4yLjAnXG5cblx0U2Nyb2xsU3B5LkRFRkFVTFRTID0ge1xuXHRcdG9mZnNldDogMTBcblx0fVxuXG5cdFNjcm9sbFNweS5wcm90b3R5cGUuZ2V0U2Nyb2xsSGVpZ2h0ID0gZnVuY3Rpb24oKSB7XG5cdFx0cmV0dXJuIHRoaXMuJHNjcm9sbEVsZW1lbnRbMF0uc2Nyb2xsSGVpZ2h0IHx8IE1hdGgubWF4KHRoaXMuJGJvZHlbMF0uc2Nyb2xsSGVpZ2h0LCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsSGVpZ2h0KVxuXHR9XG5cblx0U2Nyb2xsU3B5LnByb3RvdHlwZS5yZWZyZXNoID0gZnVuY3Rpb24oKSB7XG5cdFx0dmFyIG9mZnNldE1ldGhvZCA9ICdvZmZzZXQnXG5cdFx0dmFyIG9mZnNldEJhc2UgPSAwXG5cblx0XHRpZiAoISQuaXNXaW5kb3codGhpcy4kc2Nyb2xsRWxlbWVudFswXSkpIHtcblx0XHRcdG9mZnNldE1ldGhvZCA9ICdwb3NpdGlvbidcblx0XHRcdG9mZnNldEJhc2UgPSB0aGlzLiRzY3JvbGxFbGVtZW50LnNjcm9sbFRvcCgpXG5cdFx0fVxuXG5cdFx0dGhpcy5vZmZzZXRzID0gW11cblx0XHR0aGlzLnRhcmdldHMgPSBbXVxuXHRcdHRoaXMuc2Nyb2xsSGVpZ2h0ID0gdGhpcy5nZXRTY3JvbGxIZWlnaHQoKVxuXG5cdFx0dmFyIHNlbGYgPSB0aGlzXG5cblx0XHR0aGlzLiRib2R5XG5cdFx0XHQuZmluZCh0aGlzLnNlbGVjdG9yKVxuXHRcdFx0Lm1hcChmdW5jdGlvbigpIHtcblx0XHRcdFx0dmFyICRlbCA9ICQodGhpcylcblx0XHRcdFx0dmFyIGhyZWYgPSAkZWwuZGF0YSgndGFyZ2V0JykgfHwgJGVsLmF0dHIoJ2hyZWYnKVxuXHRcdFx0XHR2YXIgJGhyZWYgPSAvXiMuLy50ZXN0KGhyZWYpICYmICQoaHJlZilcblxuXHRcdFx0XHRyZXR1cm4gKCRocmVmICYmICRocmVmLmxlbmd0aCAmJiAkaHJlZi5pcygnOnZpc2libGUnKSAmJiBbXG5cdFx0XHRcdFx0WyRocmVmW29mZnNldE1ldGhvZF0oKS50b3AgKyBvZmZzZXRCYXNlLCBocmVmXVxuXHRcdFx0XHRdKSB8fCBudWxsXG5cdFx0XHR9KVxuXHRcdFx0LnNvcnQoZnVuY3Rpb24oYSwgYikge1xuXHRcdFx0XHRyZXR1cm4gYVswXSAtIGJbMF1cblx0XHRcdH0pXG5cdFx0XHQuZWFjaChmdW5jdGlvbigpIHtcblx0XHRcdFx0c2VsZi5vZmZzZXRzLnB1c2godGhpc1swXSlcblx0XHRcdFx0c2VsZi50YXJnZXRzLnB1c2godGhpc1sxXSlcblx0XHRcdH0pXG5cdH1cblxuXHRTY3JvbGxTcHkucHJvdG90eXBlLnByb2Nlc3MgPSBmdW5jdGlvbigpIHtcblx0XHR2YXIgc2Nyb2xsVG9wID0gdGhpcy4kc2Nyb2xsRWxlbWVudC5zY3JvbGxUb3AoKSArIHRoaXMub3B0aW9ucy5vZmZzZXRcblx0XHR2YXIgc2Nyb2xsSGVpZ2h0ID0gdGhpcy5nZXRTY3JvbGxIZWlnaHQoKVxuXHRcdHZhciBtYXhTY3JvbGwgPSB0aGlzLm9wdGlvbnMub2Zmc2V0ICsgc2Nyb2xsSGVpZ2h0IC0gdGhpcy4kc2Nyb2xsRWxlbWVudC5oZWlnaHQoKVxuXHRcdHZhciBvZmZzZXRzID0gdGhpcy5vZmZzZXRzXG5cdFx0dmFyIHRhcmdldHMgPSB0aGlzLnRhcmdldHNcblx0XHR2YXIgYWN0aXZlVGFyZ2V0ID0gdGhpcy5hY3RpdmVUYXJnZXRcblx0XHR2YXIgaVxuXG5cdFx0aWYgKHRoaXMuc2Nyb2xsSGVpZ2h0ICE9IHNjcm9sbEhlaWdodCkge1xuXHRcdFx0dGhpcy5yZWZyZXNoKClcblx0XHR9XG5cblx0XHRpZiAoc2Nyb2xsVG9wID49IG1heFNjcm9sbCkge1xuXHRcdFx0cmV0dXJuIGFjdGl2ZVRhcmdldCAhPSAoaSA9IHRhcmdldHNbdGFyZ2V0cy5sZW5ndGggLSAxXSkgJiYgdGhpcy5hY3RpdmF0ZShpKVxuXHRcdH1cblxuXHRcdGlmIChhY3RpdmVUYXJnZXQgJiYgc2Nyb2xsVG9wIDw9IG9mZnNldHNbMF0pIHtcblx0XHRcdHJldHVybiBhY3RpdmVUYXJnZXQgIT0gKGkgPSB0YXJnZXRzWzBdKSAmJiB0aGlzLmFjdGl2YXRlKGkpXG5cdFx0fVxuXG5cdFx0Zm9yIChpID0gb2Zmc2V0cy5sZW5ndGg7IGktLTspIHtcblx0XHRcdGFjdGl2ZVRhcmdldCAhPSB0YXJnZXRzW2ldICYmIHNjcm9sbFRvcCA+PSBvZmZzZXRzW2ldICYmICghb2Zmc2V0c1tpICsgMV0gfHwgc2Nyb2xsVG9wIDw9IG9mZnNldHNbaSArIDFdKSAmJiB0aGlzLmFjdGl2YXRlKHRhcmdldHNbaV0pXG5cdFx0fVxuXHR9XG5cblx0U2Nyb2xsU3B5LnByb3RvdHlwZS5hY3RpdmF0ZSA9IGZ1bmN0aW9uKHRhcmdldCkge1xuXHRcdHRoaXMuYWN0aXZlVGFyZ2V0ID0gdGFyZ2V0XG5cblx0XHQkKHRoaXMuc2VsZWN0b3IpXG5cdFx0XHQucGFyZW50c1VudGlsKHRoaXMub3B0aW9ucy50YXJnZXQsICcuYWN0aXZlJylcblx0XHRcdC5yZW1vdmVDbGFzcygnYWN0aXZlJylcblxuXHRcdHZhciBzZWxlY3RvciA9IHRoaXMuc2VsZWN0b3IgK1xuXHRcdFx0J1tkYXRhLXRhcmdldD1cIicgKyB0YXJnZXQgKyAnXCJdLCcgK1xuXHRcdFx0dGhpcy5zZWxlY3RvciArICdbaHJlZj1cIicgKyB0YXJnZXQgKyAnXCJdJ1xuXG5cdFx0dmFyIGFjdGl2ZSA9ICQoc2VsZWN0b3IpXG5cdFx0XHQucGFyZW50cygnbGknKVxuXHRcdFx0LmFkZENsYXNzKCdhY3RpdmUnKVxuXG5cdFx0aWYgKGFjdGl2ZS5wYXJlbnQoJy5kcm9wZG93bi1tZW51JykubGVuZ3RoKSB7XG5cdFx0XHRhY3RpdmUgPSBhY3RpdmVcblx0XHRcdFx0LmNsb3Nlc3QoJ2xpLmRyb3Bkb3duJylcblx0XHRcdFx0LmFkZENsYXNzKCdhY3RpdmUnKVxuXHRcdH1cblxuXHRcdGFjdGl2ZS50cmlnZ2VyKCdhY3RpdmF0ZS5icy5zY3JvbGxzcHknKVxuXHR9XG5cblxuXHQvLyBTQ1JPTExTUFkgUExVR0lOIERFRklOSVRJT05cblx0Ly8gPT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cblx0ZnVuY3Rpb24gUGx1Z2luKG9wdGlvbikge1xuXHRcdHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgJHRoaXMgPSAkKHRoaXMpXG5cdFx0XHR2YXIgZGF0YSA9ICR0aGlzLmRhdGEoJ2JzLnNjcm9sbHNweScpXG5cdFx0XHR2YXIgb3B0aW9ucyA9IHR5cGVvZiBvcHRpb24gPT0gJ29iamVjdCcgJiYgb3B0aW9uXG5cblx0XHRcdGlmICghZGF0YSkgJHRoaXMuZGF0YSgnYnMuc2Nyb2xsc3B5JywgKGRhdGEgPSBuZXcgU2Nyb2xsU3B5KHRoaXMsIG9wdGlvbnMpKSlcblx0XHRcdGlmICh0eXBlb2Ygb3B0aW9uID09ICdzdHJpbmcnKSBkYXRhW29wdGlvbl0oKVxuXHRcdH0pXG5cdH1cblxuXHR2YXIgb2xkID0gJC5mbi5zY3JvbGxzcHlcblxuXHQkLmZuLnNjcm9sbHNweSA9IFBsdWdpblxuXHQkLmZuLnNjcm9sbHNweS5Db25zdHJ1Y3RvciA9IFNjcm9sbFNweVxuXG5cblx0Ly8gU0NST0xMU1BZIE5PIENPTkZMSUNUXG5cdC8vID09PT09PT09PT09PT09PT09PT09PVxuXG5cdCQuZm4uc2Nyb2xsc3B5Lm5vQ29uZmxpY3QgPSBmdW5jdGlvbigpIHtcblx0XHQkLmZuLnNjcm9sbHNweSA9IG9sZFxuXHRcdHJldHVybiB0aGlzXG5cdH1cblxuXG5cdC8vIFNDUk9MTFNQWSBEQVRBLUFQSVxuXHQvLyA9PT09PT09PT09PT09PT09PT1cblxuXHQkKHdpbmRvdykub24oJ2xvYWQuYnMuc2Nyb2xsc3B5LmRhdGEtYXBpJywgZnVuY3Rpb24oKSB7XG5cdFx0JCgnW2RhdGEtc3B5PVwic2Nyb2xsXCJdJykuZWFjaChmdW5jdGlvbigpIHtcblx0XHRcdHZhciAkc3B5ID0gJCh0aGlzKVxuXHRcdFx0UGx1Z2luLmNhbGwoJHNweSwgJHNweS5kYXRhKCkpXG5cdFx0fSlcblx0fSlcblxufShqUXVlcnkpO1xuXG4vKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqIEJvb3RzdHJhcDogbW9kYWwuanMgdjMuMi4wXG4gKiBodHRwOi8vZ2V0Ym9vdHN0cmFwLmNvbS9qYXZhc2NyaXB0LyNtb2RhbHNcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogQ29weXJpZ2h0IDIwMTEtMjAxNCBUd2l0dGVyLCBJbmMuXG4gKiBMaWNlbnNlZCB1bmRlciBNSVQgKGh0dHBzOi8vZ2l0aHViLmNvbS90d2JzL2Jvb3RzdHJhcC9ibG9iL21hc3Rlci9MSUNFTlNFKVxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cblxuKyBmdW5jdGlvbigkKSB7XG5cdCd1c2Ugc3RyaWN0JztcblxuXHQvLyBNT0RBTCBDTEFTUyBERUZJTklUSU9OXG5cdC8vID09PT09PT09PT09PT09PT09PT09PT1cblxuXHR2YXIgTW9kYWwgPSBmdW5jdGlvbihlbGVtZW50LCBvcHRpb25zKSB7XG5cdFx0dGhpcy5vcHRpb25zID0gb3B0aW9uc1xuXHRcdHRoaXMuJGJvZHkgPSAkKGRvY3VtZW50LmJvZHkpXG5cdFx0dGhpcy4kZWxlbWVudCA9ICQoZWxlbWVudClcblx0XHR0aGlzLiRiYWNrZHJvcCA9XG5cdFx0XHR0aGlzLmlzU2hvd24gPSBudWxsXG5cdFx0dGhpcy5zY3JvbGxiYXJXaWR0aCA9IDBcblxuXHRcdGlmICh0aGlzLm9wdGlvbnMucmVtb3RlKSB7XG5cdFx0XHR0aGlzLiRlbGVtZW50XG5cdFx0XHRcdC5maW5kKCcubW9kYWwtY29udGVudCcpXG5cdFx0XHRcdC5sb2FkKHRoaXMub3B0aW9ucy5yZW1vdGUsICQucHJveHkoZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0dGhpcy4kZWxlbWVudC50cmlnZ2VyKCdsb2FkZWQuYnMubW9kYWwnKVxuXHRcdFx0XHR9LCB0aGlzKSlcblx0XHR9XG5cdH1cblxuXHRNb2RhbC5WRVJTSU9OID0gJzMuMi4wJ1xuXG5cdE1vZGFsLkRFRkFVTFRTID0ge1xuXHRcdGJhY2tkcm9wOiB0cnVlLFxuXHRcdGtleWJvYXJkOiB0cnVlLFxuXHRcdHNob3c6IHRydWVcblx0fVxuXG5cdE1vZGFsLnByb3RvdHlwZS50b2dnbGUgPSBmdW5jdGlvbihfcmVsYXRlZFRhcmdldCkge1xuXHRcdHJldHVybiB0aGlzLmlzU2hvd24gPyB0aGlzLmhpZGUoKSA6IHRoaXMuc2hvdyhfcmVsYXRlZFRhcmdldClcblx0fVxuXG5cdE1vZGFsLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24oX3JlbGF0ZWRUYXJnZXQpIHtcblx0XHR2YXIgdGhhdCA9IHRoaXNcblx0XHR2YXIgZSA9ICQuRXZlbnQoJ3Nob3cuYnMubW9kYWwnLCB7XG5cdFx0XHRyZWxhdGVkVGFyZ2V0OiBfcmVsYXRlZFRhcmdldFxuXHRcdH0pXG5cblx0XHR0aGlzLiRlbGVtZW50LnRyaWdnZXIoZSlcblxuXHRcdGlmICh0aGlzLmlzU2hvd24gfHwgZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgcmV0dXJuXG5cblx0XHR0aGlzLmlzU2hvd24gPSB0cnVlXG5cblx0XHR0aGlzLmNoZWNrU2Nyb2xsYmFyKClcblx0XHR0aGlzLiRib2R5LmFkZENsYXNzKCdtb2RhbC1vcGVuJylcblxuXHRcdHRoaXMuc2V0U2Nyb2xsYmFyKClcblx0XHR0aGlzLmVzY2FwZSgpXG5cblx0XHR0aGlzLiRlbGVtZW50Lm9uKCdjbGljay5kaXNtaXNzLmJzLm1vZGFsJywgJ1tkYXRhLWRpc21pc3M9XCJtb2RhbFwiXScsICQucHJveHkodGhpcy5oaWRlLCB0aGlzKSlcblxuXHRcdHRoaXMuYmFja2Ryb3AoZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgdHJhbnNpdGlvbiA9ICQuc3VwcG9ydC50cmFuc2l0aW9uICYmIHRoYXQuJGVsZW1lbnQuaGFzQ2xhc3MoJ2ZhZGUnKVxuXG5cdFx0XHRpZiAoIXRoYXQuJGVsZW1lbnQucGFyZW50KCkubGVuZ3RoKSB7XG5cdFx0XHRcdHRoYXQuJGVsZW1lbnQuYXBwZW5kVG8odGhhdC4kYm9keSkgLy8gZG9uJ3QgbW92ZSBtb2RhbHMgZG9tIHBvc2l0aW9uXG5cdFx0XHR9XG5cblx0XHRcdHRoYXQuJGVsZW1lbnRcblx0XHRcdFx0LnNob3coKVxuXHRcdFx0XHQuc2Nyb2xsVG9wKDApXG5cblx0XHRcdGlmICh0cmFuc2l0aW9uKSB7XG5cdFx0XHRcdHRoYXQuJGVsZW1lbnRbMF0ub2Zmc2V0V2lkdGggLy8gZm9yY2UgcmVmbG93XG5cdFx0XHR9XG5cblx0XHRcdHRoYXQuJGVsZW1lbnRcblx0XHRcdFx0LmFkZENsYXNzKCdpbicpXG5cdFx0XHRcdC5hdHRyKCdhcmlhLWhpZGRlbicsIGZhbHNlKVxuXG5cdFx0XHR0aGF0LmVuZm9yY2VGb2N1cygpXG5cblx0XHRcdHZhciBlID0gJC5FdmVudCgnc2hvd24uYnMubW9kYWwnLCB7XG5cdFx0XHRcdHJlbGF0ZWRUYXJnZXQ6IF9yZWxhdGVkVGFyZ2V0XG5cdFx0XHR9KVxuXG5cdFx0XHR0cmFuc2l0aW9uID9cblx0XHRcdFx0dGhhdC4kZWxlbWVudC5maW5kKCcubW9kYWwtZGlhbG9nJykgLy8gd2FpdCBmb3IgbW9kYWwgdG8gc2xpZGUgaW5cblx0XHRcdC5vbmUoJ2JzVHJhbnNpdGlvbkVuZCcsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0aGF0LiRlbGVtZW50LnRyaWdnZXIoJ2ZvY3VzJykudHJpZ2dlcihlKVxuXHRcdFx0fSlcblx0XHRcdFx0LmVtdWxhdGVUcmFuc2l0aW9uRW5kKDMwMCkgOlxuXHRcdFx0XHR0aGF0LiRlbGVtZW50LnRyaWdnZXIoJ2ZvY3VzJykudHJpZ2dlcihlKVxuXHRcdH0pXG5cdH1cblxuXHRNb2RhbC5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uKGUpIHtcblx0XHRpZiAoZSkgZS5wcmV2ZW50RGVmYXVsdCgpXG5cblx0XHRlID0gJC5FdmVudCgnaGlkZS5icy5tb2RhbCcpXG5cblx0XHR0aGlzLiRlbGVtZW50LnRyaWdnZXIoZSlcblxuXHRcdGlmICghdGhpcy5pc1Nob3duIHx8IGUuaXNEZWZhdWx0UHJldmVudGVkKCkpIHJldHVyblxuXG5cdFx0dGhpcy5pc1Nob3duID0gZmFsc2VcblxuXHRcdHRoaXMuJGJvZHkucmVtb3ZlQ2xhc3MoJ21vZGFsLW9wZW4nKVxuXG5cdFx0dGhpcy5yZXNldFNjcm9sbGJhcigpXG5cdFx0dGhpcy5lc2NhcGUoKVxuXG5cdFx0JChkb2N1bWVudCkub2ZmKCdmb2N1c2luLmJzLm1vZGFsJylcblxuXHRcdHRoaXMuJGVsZW1lbnRcblx0XHRcdC5yZW1vdmVDbGFzcygnaW4nKVxuXHRcdFx0LmF0dHIoJ2FyaWEtaGlkZGVuJywgdHJ1ZSlcblx0XHRcdC5vZmYoJ2NsaWNrLmRpc21pc3MuYnMubW9kYWwnKVxuXG5cdFx0JC5zdXBwb3J0LnRyYW5zaXRpb24gJiYgdGhpcy4kZWxlbWVudC5oYXNDbGFzcygnZmFkZScpID9cblx0XHRcdHRoaXMuJGVsZW1lbnRcblx0XHRcdC5vbmUoJ2JzVHJhbnNpdGlvbkVuZCcsICQucHJveHkodGhpcy5oaWRlTW9kYWwsIHRoaXMpKVxuXHRcdFx0LmVtdWxhdGVUcmFuc2l0aW9uRW5kKDMwMCkgOlxuXHRcdFx0dGhpcy5oaWRlTW9kYWwoKVxuXHR9XG5cblx0TW9kYWwucHJvdG90eXBlLmVuZm9yY2VGb2N1cyA9IGZ1bmN0aW9uKCkge1xuXHRcdCQoZG9jdW1lbnQpXG5cdFx0XHQub2ZmKCdmb2N1c2luLmJzLm1vZGFsJykgLy8gZ3VhcmQgYWdhaW5zdCBpbmZpbml0ZSBmb2N1cyBsb29wXG5cdFx0Lm9uKCdmb2N1c2luLmJzLm1vZGFsJywgJC5wcm94eShmdW5jdGlvbihlKSB7XG5cdFx0XHRpZiAodGhpcy4kZWxlbWVudFswXSAhPT0gZS50YXJnZXQgJiYgIXRoaXMuJGVsZW1lbnQuaGFzKGUudGFyZ2V0KS5sZW5ndGgpIHtcblx0XHRcdFx0dGhpcy4kZWxlbWVudC50cmlnZ2VyKCdmb2N1cycpXG5cdFx0XHR9XG5cdFx0fSwgdGhpcykpXG5cdH1cblxuXHRNb2RhbC5wcm90b3R5cGUuZXNjYXBlID0gZnVuY3Rpb24oKSB7XG5cdFx0aWYgKHRoaXMuaXNTaG93biAmJiB0aGlzLm9wdGlvbnMua2V5Ym9hcmQpIHtcblx0XHRcdHRoaXMuJGVsZW1lbnQub24oJ2tleXVwLmRpc21pc3MuYnMubW9kYWwnLCAkLnByb3h5KGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0ZS53aGljaCA9PSAyNyAmJiB0aGlzLmhpZGUoKVxuXHRcdFx0fSwgdGhpcykpXG5cdFx0fSBlbHNlIGlmICghdGhpcy5pc1Nob3duKSB7XG5cdFx0XHR0aGlzLiRlbGVtZW50Lm9mZigna2V5dXAuZGlzbWlzcy5icy5tb2RhbCcpXG5cdFx0fVxuXHR9XG5cblx0TW9kYWwucHJvdG90eXBlLmhpZGVNb2RhbCA9IGZ1bmN0aW9uKCkge1xuXHRcdHZhciB0aGF0ID0gdGhpc1xuXHRcdHRoaXMuJGVsZW1lbnQuaGlkZSgpXG5cdFx0dGhpcy5iYWNrZHJvcChmdW5jdGlvbigpIHtcblx0XHRcdHRoYXQuJGVsZW1lbnQudHJpZ2dlcignaGlkZGVuLmJzLm1vZGFsJylcblx0XHR9KVxuXHR9XG5cblx0TW9kYWwucHJvdG90eXBlLnJlbW92ZUJhY2tkcm9wID0gZnVuY3Rpb24oKSB7XG5cdFx0dGhpcy4kYmFja2Ryb3AgJiYgdGhpcy4kYmFja2Ryb3AucmVtb3ZlKClcblx0XHR0aGlzLiRiYWNrZHJvcCA9IG51bGxcblx0fVxuXG5cdE1vZGFsLnByb3RvdHlwZS5iYWNrZHJvcCA9IGZ1bmN0aW9uKGNhbGxiYWNrKSB7XG5cdFx0dmFyIHRoYXQgPSB0aGlzXG5cdFx0dmFyIGFuaW1hdGUgPSB0aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCdmYWRlJykgPyAnZmFkZScgOiAnJ1xuXG5cdFx0aWYgKHRoaXMuaXNTaG93biAmJiB0aGlzLm9wdGlvbnMuYmFja2Ryb3ApIHtcblx0XHRcdHZhciBkb0FuaW1hdGUgPSAkLnN1cHBvcnQudHJhbnNpdGlvbiAmJiBhbmltYXRlXG5cblx0XHRcdHRoaXMuJGJhY2tkcm9wID0gJCgnPGRpdiBjbGFzcz1cIm1vZGFsLWJhY2tkcm9wICcgKyBhbmltYXRlICsgJ1wiIC8+Jylcblx0XHRcdFx0LmFwcGVuZFRvKHRoaXMuJGJvZHkpXG5cblx0XHRcdHRoaXMuJGVsZW1lbnQub24oJ2NsaWNrLmRpc21pc3MuYnMubW9kYWwnLCAkLnByb3h5KGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0aWYgKGUudGFyZ2V0ICE9PSBlLmN1cnJlbnRUYXJnZXQpIHJldHVyblxuXHRcdFx0XHR0aGlzLm9wdGlvbnMuYmFja2Ryb3AgPT0gJ3N0YXRpYycgPyB0aGlzLiRlbGVtZW50WzBdLmZvY3VzLmNhbGwodGhpcy4kZWxlbWVudFswXSkgOiB0aGlzLmhpZGUuY2FsbCh0aGlzKVxuXHRcdFx0fSwgdGhpcykpXG5cblx0XHRcdGlmIChkb0FuaW1hdGUpIHRoaXMuJGJhY2tkcm9wWzBdLm9mZnNldFdpZHRoIC8vIGZvcmNlIHJlZmxvd1xuXG5cdFx0XHR0aGlzLiRiYWNrZHJvcC5hZGRDbGFzcygnaW4nKVxuXG5cdFx0XHRpZiAoIWNhbGxiYWNrKSByZXR1cm5cblxuXHRcdFx0ZG9BbmltYXRlID9cblx0XHRcdFx0dGhpcy4kYmFja2Ryb3Bcblx0XHRcdFx0Lm9uZSgnYnNUcmFuc2l0aW9uRW5kJywgY2FsbGJhY2spXG5cdFx0XHRcdC5lbXVsYXRlVHJhbnNpdGlvbkVuZCgxNTApIDpcblx0XHRcdFx0Y2FsbGJhY2soKVxuXG5cdFx0fSBlbHNlIGlmICghdGhpcy5pc1Nob3duICYmIHRoaXMuJGJhY2tkcm9wKSB7XG5cdFx0XHR0aGlzLiRiYWNrZHJvcC5yZW1vdmVDbGFzcygnaW4nKVxuXG5cdFx0XHR2YXIgY2FsbGJhY2tSZW1vdmUgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0dGhhdC5yZW1vdmVCYWNrZHJvcCgpXG5cdFx0XHRcdGNhbGxiYWNrICYmIGNhbGxiYWNrKClcblx0XHRcdH1cblx0XHRcdCQuc3VwcG9ydC50cmFuc2l0aW9uICYmIHRoaXMuJGVsZW1lbnQuaGFzQ2xhc3MoJ2ZhZGUnKSA/XG5cdFx0XHRcdHRoaXMuJGJhY2tkcm9wXG5cdFx0XHRcdC5vbmUoJ2JzVHJhbnNpdGlvbkVuZCcsIGNhbGxiYWNrUmVtb3ZlKVxuXHRcdFx0XHQuZW11bGF0ZVRyYW5zaXRpb25FbmQoMTUwKSA6XG5cdFx0XHRcdGNhbGxiYWNrUmVtb3ZlKClcblxuXHRcdH0gZWxzZSBpZiAoY2FsbGJhY2spIHtcblx0XHRcdGNhbGxiYWNrKClcblx0XHR9XG5cdH1cblxuXHRNb2RhbC5wcm90b3R5cGUuY2hlY2tTY3JvbGxiYXIgPSBmdW5jdGlvbigpIHtcblx0XHRpZiAoZG9jdW1lbnQuYm9keS5jbGllbnRXaWR0aCA+PSB3aW5kb3cuaW5uZXJXaWR0aCkgcmV0dXJuXG5cdFx0dGhpcy5zY3JvbGxiYXJXaWR0aCA9IHRoaXMuc2Nyb2xsYmFyV2lkdGggfHwgdGhpcy5tZWFzdXJlU2Nyb2xsYmFyKClcblx0fVxuXG5cdE1vZGFsLnByb3RvdHlwZS5zZXRTY3JvbGxiYXIgPSBmdW5jdGlvbigpIHtcblx0XHR2YXIgYm9keVBhZCA9IHBhcnNlSW50KCh0aGlzLiRib2R5LmNzcygncGFkZGluZy1yaWdodCcpIHx8IDApLCAxMClcblx0XHRpZiAodGhpcy5zY3JvbGxiYXJXaWR0aCkgdGhpcy4kYm9keS5jc3MoJ3BhZGRpbmctcmlnaHQnLCBib2R5UGFkICsgdGhpcy5zY3JvbGxiYXJXaWR0aClcblx0fVxuXG5cdE1vZGFsLnByb3RvdHlwZS5yZXNldFNjcm9sbGJhciA9IGZ1bmN0aW9uKCkge1xuXHRcdHRoaXMuJGJvZHkuY3NzKCdwYWRkaW5nLXJpZ2h0JywgJycpXG5cdH1cblxuXHRNb2RhbC5wcm90b3R5cGUubWVhc3VyZVNjcm9sbGJhciA9IGZ1bmN0aW9uKCkgeyAvLyB0aHggd2Fsc2hcblx0XHR2YXIgc2Nyb2xsRGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jylcblx0XHRzY3JvbGxEaXYuY2xhc3NOYW1lID0gJ21vZGFsLXNjcm9sbGJhci1tZWFzdXJlJ1xuXHRcdHRoaXMuJGJvZHkuYXBwZW5kKHNjcm9sbERpdilcblx0XHR2YXIgc2Nyb2xsYmFyV2lkdGggPSBzY3JvbGxEaXYub2Zmc2V0V2lkdGggLSBzY3JvbGxEaXYuY2xpZW50V2lkdGhcblx0XHR0aGlzLiRib2R5WzBdLnJlbW92ZUNoaWxkKHNjcm9sbERpdilcblx0XHRyZXR1cm4gc2Nyb2xsYmFyV2lkdGhcblx0fVxuXG5cblx0Ly8gTU9EQUwgUExVR0lOIERFRklOSVRJT05cblx0Ly8gPT09PT09PT09PT09PT09PT09PT09PT1cblxuXHRmdW5jdGlvbiBQbHVnaW4ob3B0aW9uLCBfcmVsYXRlZFRhcmdldCkge1xuXHRcdHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgJHRoaXMgPSAkKHRoaXMpXG5cdFx0XHR2YXIgZGF0YSA9ICR0aGlzLmRhdGEoJ2JzLm1vZGFsJylcblx0XHRcdHZhciBvcHRpb25zID0gJC5leHRlbmQoe30sIE1vZGFsLkRFRkFVTFRTLCAkdGhpcy5kYXRhKCksIHR5cGVvZiBvcHRpb24gPT0gJ29iamVjdCcgJiYgb3B0aW9uKVxuXG5cdFx0XHRpZiAoIWRhdGEpICR0aGlzLmRhdGEoJ2JzLm1vZGFsJywgKGRhdGEgPSBuZXcgTW9kYWwodGhpcywgb3B0aW9ucykpKVxuXHRcdFx0aWYgKHR5cGVvZiBvcHRpb24gPT0gJ3N0cmluZycpIGRhdGFbb3B0aW9uXShfcmVsYXRlZFRhcmdldClcblx0XHRcdGVsc2UgaWYgKG9wdGlvbnMuc2hvdykgZGF0YS5zaG93KF9yZWxhdGVkVGFyZ2V0KVxuXHRcdH0pXG5cdH1cblxuXHR2YXIgb2xkID0gJC5mbi5tb2RhbFxuXG5cdCQuZm4ubW9kYWwgPSBQbHVnaW5cblx0JC5mbi5tb2RhbC5Db25zdHJ1Y3RvciA9IE1vZGFsXG5cblxuXHQvLyBNT0RBTCBOTyBDT05GTElDVFxuXHQvLyA9PT09PT09PT09PT09PT09PVxuXG5cdCQuZm4ubW9kYWwubm9Db25mbGljdCA9IGZ1bmN0aW9uKCkge1xuXHRcdCQuZm4ubW9kYWwgPSBvbGRcblx0XHRyZXR1cm4gdGhpc1xuXHR9XG5cblxuXHQvLyBNT0RBTCBEQVRBLUFQSVxuXHQvLyA9PT09PT09PT09PT09PVxuXG5cdCQoZG9jdW1lbnQpLm9uKCdjbGljay5icy5tb2RhbC5kYXRhLWFwaScsICdbZGF0YS10b2dnbGU9XCJtb2RhbFwiXScsIGZ1bmN0aW9uKGUpIHtcblx0XHR2YXIgJHRoaXMgPSAkKHRoaXMpXG5cdFx0dmFyIGhyZWYgPSAkdGhpcy5hdHRyKCdocmVmJylcblx0XHR2YXIgJHRhcmdldCA9ICQoJHRoaXMuYXR0cignZGF0YS10YXJnZXQnKSB8fCAoaHJlZiAmJiBocmVmLnJlcGxhY2UoLy4qKD89I1teXFxzXSskKS8sICcnKSkpIC8vIHN0cmlwIGZvciBpZTdcblx0XHR2YXIgb3B0aW9uID0gJHRhcmdldC5kYXRhKCdicy5tb2RhbCcpID8gJ3RvZ2dsZScgOiAkLmV4dGVuZCh7XG5cdFx0XHRyZW1vdGU6ICEvIy8udGVzdChocmVmKSAmJiBocmVmXG5cdFx0fSwgJHRhcmdldC5kYXRhKCksICR0aGlzLmRhdGEoKSlcblxuXHRcdGlmICgkdGhpcy5pcygnYScpKSBlLnByZXZlbnREZWZhdWx0KClcblxuXHRcdCR0YXJnZXQub25lKCdzaG93LmJzLm1vZGFsJywgZnVuY3Rpb24oc2hvd0V2ZW50KSB7XG5cdFx0XHRpZiAoc2hvd0V2ZW50LmlzRGVmYXVsdFByZXZlbnRlZCgpKSByZXR1cm4gLy8gb25seSByZWdpc3RlciBmb2N1cyByZXN0b3JlciBpZiBtb2RhbCB3aWxsIGFjdHVhbGx5IGdldCBzaG93blxuXHRcdFx0JHRhcmdldC5vbmUoJ2hpZGRlbi5icy5tb2RhbCcsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHQkdGhpcy5pcygnOnZpc2libGUnKSAmJiAkdGhpcy50cmlnZ2VyKCdmb2N1cycpXG5cdFx0XHR9KVxuXHRcdH0pXG5cdFx0UGx1Z2luLmNhbGwoJHRhcmdldCwgb3B0aW9uLCB0aGlzKVxuXHR9KVxuXG59KGpRdWVyeSk7XG5cbi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogQm9vdHN0cmFwOiB0b29sdGlwLmpzIHYzLjIuMFxuICogaHR0cDovL2dldGJvb3RzdHJhcC5jb20vamF2YXNjcmlwdC8jdG9vbHRpcFxuICogSW5zcGlyZWQgYnkgdGhlIG9yaWdpbmFsIGpRdWVyeS50aXBzeSBieSBKYXNvbiBGcmFtZVxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiBDb3B5cmlnaHQgMjAxMS0yMDE0IFR3aXR0ZXIsIEluYy5cbiAqIExpY2Vuc2VkIHVuZGVyIE1JVCAoaHR0cHM6Ly9naXRodWIuY29tL3R3YnMvYm9vdHN0cmFwL2Jsb2IvbWFzdGVyL0xJQ0VOU0UpXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuXG4rIGZ1bmN0aW9uKCQpIHtcblx0J3VzZSBzdHJpY3QnO1xuXG5cdC8vIFRPT0xUSVAgUFVCTElDIENMQVNTIERFRklOSVRJT05cblx0Ly8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5cdHZhciBUb29sdGlwID0gZnVuY3Rpb24oZWxlbWVudCwgb3B0aW9ucykge1xuXHRcdHRoaXMudHlwZSA9XG5cdFx0XHR0aGlzLm9wdGlvbnMgPVxuXHRcdFx0dGhpcy5lbmFibGVkID1cblx0XHRcdHRoaXMudGltZW91dCA9XG5cdFx0XHR0aGlzLmhvdmVyU3RhdGUgPVxuXHRcdFx0dGhpcy4kZWxlbWVudCA9IG51bGxcblxuXHRcdHRoaXMuaW5pdCgndG9vbHRpcCcsIGVsZW1lbnQsIG9wdGlvbnMpXG5cdH1cblxuXHRUb29sdGlwLlZFUlNJT04gPSAnMy4yLjAnXG5cblx0VG9vbHRpcC5ERUZBVUxUUyA9IHtcblx0XHRhbmltYXRpb246IHRydWUsXG5cdFx0cGxhY2VtZW50OiAndG9wJyxcblx0XHRzZWxlY3RvcjogZmFsc2UsXG5cdFx0dGVtcGxhdGU6ICc8ZGl2IGNsYXNzPVwidG9vbHRpcFwiIHJvbGU9XCJ0b29sdGlwXCI+PGRpdiBjbGFzcz1cInRvb2x0aXAtYXJyb3dcIj48L2Rpdj48ZGl2IGNsYXNzPVwidG9vbHRpcC1pbm5lclwiPjwvZGl2PjwvZGl2PicsXG5cdFx0dHJpZ2dlcjogJ2hvdmVyIGZvY3VzJyxcblx0XHR0aXRsZTogJycsXG5cdFx0ZGVsYXk6IDAsXG5cdFx0aHRtbDogZmFsc2UsXG5cdFx0Y29udGFpbmVyOiBmYWxzZSxcblx0XHR2aWV3cG9ydDoge1xuXHRcdFx0c2VsZWN0b3I6ICdib2R5Jyxcblx0XHRcdHBhZGRpbmc6IDBcblx0XHR9XG5cdH1cblxuXHRUb29sdGlwLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24odHlwZSwgZWxlbWVudCwgb3B0aW9ucykge1xuXHRcdHRoaXMuZW5hYmxlZCA9IHRydWVcblx0XHR0aGlzLnR5cGUgPSB0eXBlXG5cdFx0dGhpcy4kZWxlbWVudCA9ICQoZWxlbWVudClcblx0XHR0aGlzLm9wdGlvbnMgPSB0aGlzLmdldE9wdGlvbnMob3B0aW9ucylcblx0XHR0aGlzLiR2aWV3cG9ydCA9IHRoaXMub3B0aW9ucy52aWV3cG9ydCAmJiAkKHRoaXMub3B0aW9ucy52aWV3cG9ydC5zZWxlY3RvciB8fCB0aGlzLm9wdGlvbnMudmlld3BvcnQpXG5cblx0XHR2YXIgdHJpZ2dlcnMgPSB0aGlzLm9wdGlvbnMudHJpZ2dlci5zcGxpdCgnICcpXG5cblx0XHRmb3IgKHZhciBpID0gdHJpZ2dlcnMubGVuZ3RoOyBpLS07KSB7XG5cdFx0XHR2YXIgdHJpZ2dlciA9IHRyaWdnZXJzW2ldXG5cblx0XHRcdGlmICh0cmlnZ2VyID09ICdjbGljaycpIHtcblx0XHRcdFx0dGhpcy4kZWxlbWVudC5vbignY2xpY2suJyArIHRoaXMudHlwZSwgdGhpcy5vcHRpb25zLnNlbGVjdG9yLCAkLnByb3h5KHRoaXMudG9nZ2xlLCB0aGlzKSlcblx0XHRcdH0gZWxzZSBpZiAodHJpZ2dlciAhPSAnbWFudWFsJykge1xuXHRcdFx0XHR2YXIgZXZlbnRJbiA9IHRyaWdnZXIgPT0gJ2hvdmVyJyA/ICdtb3VzZWVudGVyJyA6ICdmb2N1c2luJ1xuXHRcdFx0XHR2YXIgZXZlbnRPdXQgPSB0cmlnZ2VyID09ICdob3ZlcicgPyAnbW91c2VsZWF2ZScgOiAnZm9jdXNvdXQnXG5cblx0XHRcdFx0dGhpcy4kZWxlbWVudC5vbihldmVudEluICsgJy4nICsgdGhpcy50eXBlLCB0aGlzLm9wdGlvbnMuc2VsZWN0b3IsICQucHJveHkodGhpcy5lbnRlciwgdGhpcykpXG5cdFx0XHRcdHRoaXMuJGVsZW1lbnQub24oZXZlbnRPdXQgKyAnLicgKyB0aGlzLnR5cGUsIHRoaXMub3B0aW9ucy5zZWxlY3RvciwgJC5wcm94eSh0aGlzLmxlYXZlLCB0aGlzKSlcblx0XHRcdH1cblx0XHR9XG5cblx0XHR0aGlzLm9wdGlvbnMuc2VsZWN0b3IgP1xuXHRcdFx0KHRoaXMuX29wdGlvbnMgPSAkLmV4dGVuZCh7fSwgdGhpcy5vcHRpb25zLCB7XG5cdFx0XHR0cmlnZ2VyOiAnbWFudWFsJyxcblx0XHRcdHNlbGVjdG9yOiAnJ1xuXHRcdH0pKSA6XG5cdFx0XHR0aGlzLmZpeFRpdGxlKClcblx0fVxuXG5cdFRvb2x0aXAucHJvdG90eXBlLmdldERlZmF1bHRzID0gZnVuY3Rpb24oKSB7XG5cdFx0cmV0dXJuIFRvb2x0aXAuREVGQVVMVFNcblx0fVxuXG5cdFRvb2x0aXAucHJvdG90eXBlLmdldE9wdGlvbnMgPSBmdW5jdGlvbihvcHRpb25zKSB7XG5cdFx0b3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCB0aGlzLmdldERlZmF1bHRzKCksIHRoaXMuJGVsZW1lbnQuZGF0YSgpLCBvcHRpb25zKVxuXG5cdFx0aWYgKG9wdGlvbnMuZGVsYXkgJiYgdHlwZW9mIG9wdGlvbnMuZGVsYXkgPT0gJ251bWJlcicpIHtcblx0XHRcdG9wdGlvbnMuZGVsYXkgPSB7XG5cdFx0XHRcdHNob3c6IG9wdGlvbnMuZGVsYXksXG5cdFx0XHRcdGhpZGU6IG9wdGlvbnMuZGVsYXlcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gb3B0aW9uc1xuXHR9XG5cblx0VG9vbHRpcC5wcm90b3R5cGUuZ2V0RGVsZWdhdGVPcHRpb25zID0gZnVuY3Rpb24oKSB7XG5cdFx0dmFyIG9wdGlvbnMgPSB7fVxuXHRcdHZhciBkZWZhdWx0cyA9IHRoaXMuZ2V0RGVmYXVsdHMoKVxuXG5cdFx0dGhpcy5fb3B0aW9ucyAmJiAkLmVhY2godGhpcy5fb3B0aW9ucywgZnVuY3Rpb24oa2V5LCB2YWx1ZSkge1xuXHRcdFx0aWYgKGRlZmF1bHRzW2tleV0gIT0gdmFsdWUpIG9wdGlvbnNba2V5XSA9IHZhbHVlXG5cdFx0fSlcblxuXHRcdHJldHVybiBvcHRpb25zXG5cdH1cblxuXHRUb29sdGlwLnByb3RvdHlwZS5lbnRlciA9IGZ1bmN0aW9uKG9iaikge1xuXHRcdHZhciBzZWxmID0gb2JqIGluc3RhbmNlb2YgdGhpcy5jb25zdHJ1Y3RvciA/XG5cdFx0XHRvYmogOiAkKG9iai5jdXJyZW50VGFyZ2V0KS5kYXRhKCdicy4nICsgdGhpcy50eXBlKVxuXG5cdFx0aWYgKCFzZWxmKSB7XG5cdFx0XHRzZWxmID0gbmV3IHRoaXMuY29uc3RydWN0b3Iob2JqLmN1cnJlbnRUYXJnZXQsIHRoaXMuZ2V0RGVsZWdhdGVPcHRpb25zKCkpXG5cdFx0XHQkKG9iai5jdXJyZW50VGFyZ2V0KS5kYXRhKCdicy4nICsgdGhpcy50eXBlLCBzZWxmKVxuXHRcdH1cblxuXHRcdGNsZWFyVGltZW91dChzZWxmLnRpbWVvdXQpXG5cblx0XHRzZWxmLmhvdmVyU3RhdGUgPSAnaW4nXG5cblx0XHRpZiAoIXNlbGYub3B0aW9ucy5kZWxheSB8fCAhc2VsZi5vcHRpb25zLmRlbGF5LnNob3cpIHJldHVybiBzZWxmLnNob3coKVxuXG5cdFx0c2VsZi50aW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcblx0XHRcdGlmIChzZWxmLmhvdmVyU3RhdGUgPT0gJ2luJykgc2VsZi5zaG93KClcblx0XHR9LCBzZWxmLm9wdGlvbnMuZGVsYXkuc2hvdylcblx0fVxuXG5cdFRvb2x0aXAucHJvdG90eXBlLmxlYXZlID0gZnVuY3Rpb24ob2JqKSB7XG5cdFx0dmFyIHNlbGYgPSBvYmogaW5zdGFuY2VvZiB0aGlzLmNvbnN0cnVjdG9yID9cblx0XHRcdG9iaiA6ICQob2JqLmN1cnJlbnRUYXJnZXQpLmRhdGEoJ2JzLicgKyB0aGlzLnR5cGUpXG5cblx0XHRpZiAoIXNlbGYpIHtcblx0XHRcdHNlbGYgPSBuZXcgdGhpcy5jb25zdHJ1Y3RvcihvYmouY3VycmVudFRhcmdldCwgdGhpcy5nZXREZWxlZ2F0ZU9wdGlvbnMoKSlcblx0XHRcdCQob2JqLmN1cnJlbnRUYXJnZXQpLmRhdGEoJ2JzLicgKyB0aGlzLnR5cGUsIHNlbGYpXG5cdFx0fVxuXG5cdFx0Y2xlYXJUaW1lb3V0KHNlbGYudGltZW91dClcblxuXHRcdHNlbGYuaG92ZXJTdGF0ZSA9ICdvdXQnXG5cblx0XHRpZiAoIXNlbGYub3B0aW9ucy5kZWxheSB8fCAhc2VsZi5vcHRpb25zLmRlbGF5LmhpZGUpIHJldHVybiBzZWxmLmhpZGUoKVxuXG5cdFx0c2VsZi50aW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbigpIHtcblx0XHRcdGlmIChzZWxmLmhvdmVyU3RhdGUgPT0gJ291dCcpIHNlbGYuaGlkZSgpXG5cdFx0fSwgc2VsZi5vcHRpb25zLmRlbGF5LmhpZGUpXG5cdH1cblxuXHRUb29sdGlwLnByb3RvdHlwZS5zaG93ID0gZnVuY3Rpb24oKSB7XG5cdFx0dmFyIGUgPSAkLkV2ZW50KCdzaG93LmJzLicgKyB0aGlzLnR5cGUpXG5cblx0XHRpZiAodGhpcy5oYXNDb250ZW50KCkgJiYgdGhpcy5lbmFibGVkKSB7XG5cdFx0XHR0aGlzLiRlbGVtZW50LnRyaWdnZXIoZSlcblxuXHRcdFx0dmFyIGluRG9tID0gJC5jb250YWlucyhkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQsIHRoaXMuJGVsZW1lbnRbMF0pXG5cdFx0XHRpZiAoZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSB8fCAhaW5Eb20pIHJldHVyblxuXHRcdFx0dmFyIHRoYXQgPSB0aGlzXG5cblx0XHRcdHZhciAkdGlwID0gdGhpcy50aXAoKVxuXG5cdFx0XHR2YXIgdGlwSWQgPSB0aGlzLmdldFVJRCh0aGlzLnR5cGUpXG5cblx0XHRcdHRoaXMuc2V0Q29udGVudCgpXG5cdFx0XHQkdGlwLmF0dHIoJ2lkJywgdGlwSWQpXG5cdFx0XHR0aGlzLiRlbGVtZW50LmF0dHIoJ2FyaWEtZGVzY3JpYmVkYnknLCB0aXBJZClcblxuXHRcdFx0aWYgKHRoaXMub3B0aW9ucy5hbmltYXRpb24pICR0aXAuYWRkQ2xhc3MoJ2ZhZGUnKVxuXG5cdFx0XHR2YXIgcGxhY2VtZW50ID0gdHlwZW9mIHRoaXMub3B0aW9ucy5wbGFjZW1lbnQgPT0gJ2Z1bmN0aW9uJyA/XG5cdFx0XHRcdHRoaXMub3B0aW9ucy5wbGFjZW1lbnQuY2FsbCh0aGlzLCAkdGlwWzBdLCB0aGlzLiRlbGVtZW50WzBdKSA6XG5cdFx0XHRcdHRoaXMub3B0aW9ucy5wbGFjZW1lbnRcblxuXHRcdFx0dmFyIGF1dG9Ub2tlbiA9IC9cXHM/YXV0bz9cXHM/L2lcblx0XHRcdHZhciBhdXRvUGxhY2UgPSBhdXRvVG9rZW4udGVzdChwbGFjZW1lbnQpXG5cdFx0XHRpZiAoYXV0b1BsYWNlKSBwbGFjZW1lbnQgPSBwbGFjZW1lbnQucmVwbGFjZShhdXRvVG9rZW4sICcnKSB8fCAndG9wJ1xuXG5cdFx0XHQkdGlwXG5cdFx0XHRcdC5kZXRhY2goKVxuXHRcdFx0XHQuY3NzKHtcblx0XHRcdFx0XHR0b3A6IDAsXG5cdFx0XHRcdFx0bGVmdDogMCxcblx0XHRcdFx0XHRkaXNwbGF5OiAnYmxvY2snXG5cdFx0XHRcdH0pXG5cdFx0XHRcdC5hZGRDbGFzcyhwbGFjZW1lbnQpXG5cdFx0XHRcdC5kYXRhKCdicy4nICsgdGhpcy50eXBlLCB0aGlzKVxuXG5cdFx0XHR0aGlzLm9wdGlvbnMuY29udGFpbmVyID8gJHRpcC5hcHBlbmRUbyh0aGlzLm9wdGlvbnMuY29udGFpbmVyKSA6ICR0aXAuaW5zZXJ0QWZ0ZXIodGhpcy4kZWxlbWVudClcblxuXHRcdFx0dmFyIHBvcyA9IHRoaXMuZ2V0UG9zaXRpb24oKVxuXHRcdFx0dmFyIGFjdHVhbFdpZHRoID0gJHRpcFswXS5vZmZzZXRXaWR0aFxuXHRcdFx0dmFyIGFjdHVhbEhlaWdodCA9ICR0aXBbMF0ub2Zmc2V0SGVpZ2h0XG5cblx0XHRcdGlmIChhdXRvUGxhY2UpIHtcblx0XHRcdFx0dmFyIG9yZ1BsYWNlbWVudCA9IHBsYWNlbWVudFxuXHRcdFx0XHR2YXIgJHBhcmVudCA9IHRoaXMuJGVsZW1lbnQucGFyZW50KClcblx0XHRcdFx0dmFyIHBhcmVudERpbSA9IHRoaXMuZ2V0UG9zaXRpb24oJHBhcmVudClcblxuXHRcdFx0XHRwbGFjZW1lbnQgPSBwbGFjZW1lbnQgPT0gJ2JvdHRvbScgJiYgcG9zLnRvcCArIHBvcy5oZWlnaHQgKyBhY3R1YWxIZWlnaHQgLSBwYXJlbnREaW0uc2Nyb2xsID4gcGFyZW50RGltLmhlaWdodCA/ICd0b3AnIDpcblx0XHRcdFx0XHRwbGFjZW1lbnQgPT0gJ3RvcCcgJiYgcG9zLnRvcCAtIHBhcmVudERpbS5zY3JvbGwgLSBhY3R1YWxIZWlnaHQgPCAwID8gJ2JvdHRvbScgOlxuXHRcdFx0XHRcdHBsYWNlbWVudCA9PSAncmlnaHQnICYmIHBvcy5yaWdodCArIGFjdHVhbFdpZHRoID4gcGFyZW50RGltLndpZHRoID8gJ2xlZnQnIDpcblx0XHRcdFx0XHRwbGFjZW1lbnQgPT0gJ2xlZnQnICYmIHBvcy5sZWZ0IC0gYWN0dWFsV2lkdGggPCBwYXJlbnREaW0ubGVmdCA/ICdyaWdodCcgOlxuXHRcdFx0XHRcdHBsYWNlbWVudFxuXG5cdFx0XHRcdCR0aXBcblx0XHRcdFx0XHQucmVtb3ZlQ2xhc3Mob3JnUGxhY2VtZW50KVxuXHRcdFx0XHRcdC5hZGRDbGFzcyhwbGFjZW1lbnQpXG5cdFx0XHR9XG5cblx0XHRcdHZhciBjYWxjdWxhdGVkT2Zmc2V0ID0gdGhpcy5nZXRDYWxjdWxhdGVkT2Zmc2V0KHBsYWNlbWVudCwgcG9zLCBhY3R1YWxXaWR0aCwgYWN0dWFsSGVpZ2h0KVxuXG5cdFx0XHR0aGlzLmFwcGx5UGxhY2VtZW50KGNhbGN1bGF0ZWRPZmZzZXQsIHBsYWNlbWVudClcblxuXHRcdFx0dmFyIGNvbXBsZXRlID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRoYXQuJGVsZW1lbnQudHJpZ2dlcignc2hvd24uYnMuJyArIHRoYXQudHlwZSlcblx0XHRcdFx0dGhhdC5ob3ZlclN0YXRlID0gbnVsbFxuXHRcdFx0fVxuXG5cdFx0XHQkLnN1cHBvcnQudHJhbnNpdGlvbiAmJiB0aGlzLiR0aXAuaGFzQ2xhc3MoJ2ZhZGUnKSA/XG5cdFx0XHRcdCR0aXBcblx0XHRcdFx0Lm9uZSgnYnNUcmFuc2l0aW9uRW5kJywgY29tcGxldGUpXG5cdFx0XHRcdC5lbXVsYXRlVHJhbnNpdGlvbkVuZCgxNTApIDpcblx0XHRcdFx0Y29tcGxldGUoKVxuXHRcdH1cblx0fVxuXG5cdFRvb2x0aXAucHJvdG90eXBlLmFwcGx5UGxhY2VtZW50ID0gZnVuY3Rpb24ob2Zmc2V0LCBwbGFjZW1lbnQpIHtcblx0XHR2YXIgJHRpcCA9IHRoaXMudGlwKClcblx0XHR2YXIgd2lkdGggPSAkdGlwWzBdLm9mZnNldFdpZHRoXG5cdFx0dmFyIGhlaWdodCA9ICR0aXBbMF0ub2Zmc2V0SGVpZ2h0XG5cblx0XHQvLyBtYW51YWxseSByZWFkIG1hcmdpbnMgYmVjYXVzZSBnZXRCb3VuZGluZ0NsaWVudFJlY3QgaW5jbHVkZXMgZGlmZmVyZW5jZVxuXHRcdHZhciBtYXJnaW5Ub3AgPSBwYXJzZUludCgkdGlwLmNzcygnbWFyZ2luLXRvcCcpLCAxMClcblx0XHR2YXIgbWFyZ2luTGVmdCA9IHBhcnNlSW50KCR0aXAuY3NzKCdtYXJnaW4tbGVmdCcpLCAxMClcblxuXHRcdC8vIHdlIG11c3QgY2hlY2sgZm9yIE5hTiBmb3IgaWUgOC85XG5cdFx0aWYgKGlzTmFOKG1hcmdpblRvcCkpIG1hcmdpblRvcCA9IDBcblx0XHRpZiAoaXNOYU4obWFyZ2luTGVmdCkpIG1hcmdpbkxlZnQgPSAwXG5cblx0XHRvZmZzZXQudG9wID0gb2Zmc2V0LnRvcCArIG1hcmdpblRvcFxuXHRcdG9mZnNldC5sZWZ0ID0gb2Zmc2V0LmxlZnQgKyBtYXJnaW5MZWZ0XG5cblx0XHQvLyAkLmZuLm9mZnNldCBkb2Vzbid0IHJvdW5kIHBpeGVsIHZhbHVlc1xuXHRcdC8vIHNvIHdlIHVzZSBzZXRPZmZzZXQgZGlyZWN0bHkgd2l0aCBvdXIgb3duIGZ1bmN0aW9uIEItMFxuXHRcdCQub2Zmc2V0LnNldE9mZnNldCgkdGlwWzBdLCAkLmV4dGVuZCh7XG5cdFx0XHR1c2luZzogZnVuY3Rpb24ocHJvcHMpIHtcblx0XHRcdFx0JHRpcC5jc3Moe1xuXHRcdFx0XHRcdHRvcDogTWF0aC5yb3VuZChwcm9wcy50b3ApLFxuXHRcdFx0XHRcdGxlZnQ6IE1hdGgucm91bmQocHJvcHMubGVmdClcblx0XHRcdFx0fSlcblx0XHRcdH1cblx0XHR9LCBvZmZzZXQpLCAwKVxuXG5cdFx0JHRpcC5hZGRDbGFzcygnaW4nKVxuXG5cdFx0Ly8gY2hlY2sgdG8gc2VlIGlmIHBsYWNpbmcgdGlwIGluIG5ldyBvZmZzZXQgY2F1c2VkIHRoZSB0aXAgdG8gcmVzaXplIGl0c2VsZlxuXHRcdHZhciBhY3R1YWxXaWR0aCA9ICR0aXBbMF0ub2Zmc2V0V2lkdGhcblx0XHR2YXIgYWN0dWFsSGVpZ2h0ID0gJHRpcFswXS5vZmZzZXRIZWlnaHRcblxuXHRcdGlmIChwbGFjZW1lbnQgPT0gJ3RvcCcgJiYgYWN0dWFsSGVpZ2h0ICE9IGhlaWdodCkge1xuXHRcdFx0b2Zmc2V0LnRvcCA9IG9mZnNldC50b3AgKyBoZWlnaHQgLSBhY3R1YWxIZWlnaHRcblx0XHR9XG5cblx0XHR2YXIgZGVsdGEgPSB0aGlzLmdldFZpZXdwb3J0QWRqdXN0ZWREZWx0YShwbGFjZW1lbnQsIG9mZnNldCwgYWN0dWFsV2lkdGgsIGFjdHVhbEhlaWdodClcblxuXHRcdGlmIChkZWx0YS5sZWZ0KSBvZmZzZXQubGVmdCArPSBkZWx0YS5sZWZ0XG5cdFx0ZWxzZSBvZmZzZXQudG9wICs9IGRlbHRhLnRvcFxuXG5cdFx0dmFyIGFycm93RGVsdGEgPSBkZWx0YS5sZWZ0ID8gZGVsdGEubGVmdCAqIDIgLSB3aWR0aCArIGFjdHVhbFdpZHRoIDogZGVsdGEudG9wICogMiAtIGhlaWdodCArIGFjdHVhbEhlaWdodFxuXHRcdHZhciBhcnJvd1Bvc2l0aW9uID0gZGVsdGEubGVmdCA/ICdsZWZ0JyA6ICd0b3AnXG5cdFx0dmFyIGFycm93T2Zmc2V0UG9zaXRpb24gPSBkZWx0YS5sZWZ0ID8gJ29mZnNldFdpZHRoJyA6ICdvZmZzZXRIZWlnaHQnXG5cblx0XHQkdGlwLm9mZnNldChvZmZzZXQpXG5cdFx0dGhpcy5yZXBsYWNlQXJyb3coYXJyb3dEZWx0YSwgJHRpcFswXVthcnJvd09mZnNldFBvc2l0aW9uXSwgYXJyb3dQb3NpdGlvbilcblx0fVxuXG5cdFRvb2x0aXAucHJvdG90eXBlLnJlcGxhY2VBcnJvdyA9IGZ1bmN0aW9uKGRlbHRhLCBkaW1lbnNpb24sIHBvc2l0aW9uKSB7XG5cdFx0dGhpcy5hcnJvdygpLmNzcyhwb3NpdGlvbiwgZGVsdGEgPyAoNTAgKiAoMSAtIGRlbHRhIC8gZGltZW5zaW9uKSArICclJykgOiAnJylcblx0fVxuXG5cdFRvb2x0aXAucHJvdG90eXBlLnNldENvbnRlbnQgPSBmdW5jdGlvbigpIHtcblx0XHR2YXIgJHRpcCA9IHRoaXMudGlwKClcblx0XHR2YXIgdGl0bGUgPSB0aGlzLmdldFRpdGxlKClcblxuXHRcdCR0aXAuZmluZCgnLnRvb2x0aXAtaW5uZXInKVt0aGlzLm9wdGlvbnMuaHRtbCA/ICdodG1sJyA6ICd0ZXh0J10odGl0bGUpXG5cdFx0JHRpcC5yZW1vdmVDbGFzcygnZmFkZSBpbiB0b3AgYm90dG9tIGxlZnQgcmlnaHQnKVxuXHR9XG5cblx0VG9vbHRpcC5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uKCkge1xuXHRcdHZhciB0aGF0ID0gdGhpc1xuXHRcdHZhciAkdGlwID0gdGhpcy50aXAoKVxuXHRcdHZhciBlID0gJC5FdmVudCgnaGlkZS5icy4nICsgdGhpcy50eXBlKVxuXG5cdFx0dGhpcy4kZWxlbWVudC5yZW1vdmVBdHRyKCdhcmlhLWRlc2NyaWJlZGJ5JylcblxuXHRcdGZ1bmN0aW9uIGNvbXBsZXRlKCkge1xuXHRcdFx0aWYgKHRoYXQuaG92ZXJTdGF0ZSAhPSAnaW4nKSAkdGlwLmRldGFjaCgpXG5cdFx0XHR0aGF0LiRlbGVtZW50LnRyaWdnZXIoJ2hpZGRlbi5icy4nICsgdGhhdC50eXBlKVxuXHRcdH1cblxuXHRcdHRoaXMuJGVsZW1lbnQudHJpZ2dlcihlKVxuXG5cdFx0aWYgKGUuaXNEZWZhdWx0UHJldmVudGVkKCkpIHJldHVyblxuXG5cdFx0JHRpcC5yZW1vdmVDbGFzcygnaW4nKVxuXG5cdFx0JC5zdXBwb3J0LnRyYW5zaXRpb24gJiYgdGhpcy4kdGlwLmhhc0NsYXNzKCdmYWRlJykgP1xuXHRcdFx0JHRpcFxuXHRcdFx0Lm9uZSgnYnNUcmFuc2l0aW9uRW5kJywgY29tcGxldGUpXG5cdFx0XHQuZW11bGF0ZVRyYW5zaXRpb25FbmQoMTUwKSA6XG5cdFx0XHRjb21wbGV0ZSgpXG5cblx0XHR0aGlzLmhvdmVyU3RhdGUgPSBudWxsXG5cblx0XHRyZXR1cm4gdGhpc1xuXHR9XG5cblx0VG9vbHRpcC5wcm90b3R5cGUuZml4VGl0bGUgPSBmdW5jdGlvbigpIHtcblx0XHR2YXIgJGUgPSB0aGlzLiRlbGVtZW50XG5cdFx0aWYgKCRlLmF0dHIoJ3RpdGxlJykgfHwgdHlwZW9mKCRlLmF0dHIoJ2RhdGEtb3JpZ2luYWwtdGl0bGUnKSkgIT0gJ3N0cmluZycpIHtcblx0XHRcdCRlLmF0dHIoJ2RhdGEtb3JpZ2luYWwtdGl0bGUnLCAkZS5hdHRyKCd0aXRsZScpIHx8ICcnKS5hdHRyKCd0aXRsZScsICcnKVxuXHRcdH1cblx0fVxuXG5cdFRvb2x0aXAucHJvdG90eXBlLmhhc0NvbnRlbnQgPSBmdW5jdGlvbigpIHtcblx0XHRyZXR1cm4gdGhpcy5nZXRUaXRsZSgpXG5cdH1cblxuXHRUb29sdGlwLnByb3RvdHlwZS5nZXRQb3NpdGlvbiA9IGZ1bmN0aW9uKCRlbGVtZW50KSB7XG5cdFx0JGVsZW1lbnQgPSAkZWxlbWVudCB8fCB0aGlzLiRlbGVtZW50XG5cdFx0dmFyIGVsID0gJGVsZW1lbnRbMF1cblx0XHR2YXIgaXNCb2R5ID0gZWwudGFnTmFtZSA9PSAnQk9EWSdcblx0XHRyZXR1cm4gJC5leHRlbmQoe30sICh0eXBlb2YgZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0ID09ICdmdW5jdGlvbicpID8gZWwuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCkgOiBudWxsLCB7XG5cdFx0XHRzY3JvbGw6IGlzQm9keSA/IGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AgfHwgZG9jdW1lbnQuYm9keS5zY3JvbGxUb3AgOiAkZWxlbWVudC5zY3JvbGxUb3AoKSxcblx0XHRcdHdpZHRoOiBpc0JvZHkgPyAkKHdpbmRvdykud2lkdGgoKSA6ICRlbGVtZW50Lm91dGVyV2lkdGgoKSxcblx0XHRcdGhlaWdodDogaXNCb2R5ID8gJCh3aW5kb3cpLmhlaWdodCgpIDogJGVsZW1lbnQub3V0ZXJIZWlnaHQoKVxuXHRcdH0sIGlzQm9keSA/IHtcblx0XHRcdHRvcDogMCxcblx0XHRcdGxlZnQ6IDBcblx0XHR9IDogJGVsZW1lbnQub2Zmc2V0KCkpXG5cdH1cblxuXHRUb29sdGlwLnByb3RvdHlwZS5nZXRDYWxjdWxhdGVkT2Zmc2V0ID0gZnVuY3Rpb24ocGxhY2VtZW50LCBwb3MsIGFjdHVhbFdpZHRoLCBhY3R1YWxIZWlnaHQpIHtcblx0XHRyZXR1cm4gcGxhY2VtZW50ID09ICdib3R0b20nID8ge1xuXHRcdFx0XHR0b3A6IHBvcy50b3AgKyBwb3MuaGVpZ2h0LFxuXHRcdFx0XHRsZWZ0OiBwb3MubGVmdCArIHBvcy53aWR0aCAvIDIgLSBhY3R1YWxXaWR0aCAvIDJcblx0XHRcdH0gOlxuXHRcdFx0cGxhY2VtZW50ID09ICd0b3AnID8ge1xuXHRcdFx0XHR0b3A6IHBvcy50b3AgLSBhY3R1YWxIZWlnaHQsXG5cdFx0XHRcdGxlZnQ6IHBvcy5sZWZ0ICsgcG9zLndpZHRoIC8gMiAtIGFjdHVhbFdpZHRoIC8gMlxuXHRcdFx0fSA6XG5cdFx0XHRwbGFjZW1lbnQgPT0gJ2xlZnQnID8ge1xuXHRcdFx0XHR0b3A6IHBvcy50b3AgKyBwb3MuaGVpZ2h0IC8gMiAtIGFjdHVhbEhlaWdodCAvIDIsXG5cdFx0XHRcdGxlZnQ6IHBvcy5sZWZ0IC0gYWN0dWFsV2lkdGhcblx0XHRcdH0gOlxuXHRcdFx0LyogcGxhY2VtZW50ID09ICdyaWdodCcgKi9cblx0XHRcdHtcblx0XHRcdFx0dG9wOiBwb3MudG9wICsgcG9zLmhlaWdodCAvIDIgLSBhY3R1YWxIZWlnaHQgLyAyLFxuXHRcdFx0XHRsZWZ0OiBwb3MubGVmdCArIHBvcy53aWR0aFxuXHRcdFx0fVxuXG5cdH1cblxuXHRUb29sdGlwLnByb3RvdHlwZS5nZXRWaWV3cG9ydEFkanVzdGVkRGVsdGEgPSBmdW5jdGlvbihwbGFjZW1lbnQsIHBvcywgYWN0dWFsV2lkdGgsIGFjdHVhbEhlaWdodCkge1xuXHRcdHZhciBkZWx0YSA9IHtcblx0XHRcdHRvcDogMCxcblx0XHRcdGxlZnQ6IDBcblx0XHR9XG5cdFx0aWYgKCF0aGlzLiR2aWV3cG9ydCkgcmV0dXJuIGRlbHRhXG5cblx0XHR2YXIgdmlld3BvcnRQYWRkaW5nID0gdGhpcy5vcHRpb25zLnZpZXdwb3J0ICYmIHRoaXMub3B0aW9ucy52aWV3cG9ydC5wYWRkaW5nIHx8IDBcblx0XHR2YXIgdmlld3BvcnREaW1lbnNpb25zID0gdGhpcy5nZXRQb3NpdGlvbih0aGlzLiR2aWV3cG9ydClcblxuXHRcdGlmICgvcmlnaHR8bGVmdC8udGVzdChwbGFjZW1lbnQpKSB7XG5cdFx0XHR2YXIgdG9wRWRnZU9mZnNldCA9IHBvcy50b3AgLSB2aWV3cG9ydFBhZGRpbmcgLSB2aWV3cG9ydERpbWVuc2lvbnMuc2Nyb2xsXG5cdFx0XHR2YXIgYm90dG9tRWRnZU9mZnNldCA9IHBvcy50b3AgKyB2aWV3cG9ydFBhZGRpbmcgLSB2aWV3cG9ydERpbWVuc2lvbnMuc2Nyb2xsICsgYWN0dWFsSGVpZ2h0XG5cdFx0XHRpZiAodG9wRWRnZU9mZnNldCA8IHZpZXdwb3J0RGltZW5zaW9ucy50b3ApIHsgLy8gdG9wIG92ZXJmbG93XG5cdFx0XHRcdGRlbHRhLnRvcCA9IHZpZXdwb3J0RGltZW5zaW9ucy50b3AgLSB0b3BFZGdlT2Zmc2V0XG5cdFx0XHR9IGVsc2UgaWYgKGJvdHRvbUVkZ2VPZmZzZXQgPiB2aWV3cG9ydERpbWVuc2lvbnMudG9wICsgdmlld3BvcnREaW1lbnNpb25zLmhlaWdodCkgeyAvLyBib3R0b20gb3ZlcmZsb3dcblx0XHRcdFx0ZGVsdGEudG9wID0gdmlld3BvcnREaW1lbnNpb25zLnRvcCArIHZpZXdwb3J0RGltZW5zaW9ucy5oZWlnaHQgLSBib3R0b21FZGdlT2Zmc2V0XG5cdFx0XHR9XG5cdFx0fSBlbHNlIHtcblx0XHRcdHZhciBsZWZ0RWRnZU9mZnNldCA9IHBvcy5sZWZ0IC0gdmlld3BvcnRQYWRkaW5nXG5cdFx0XHR2YXIgcmlnaHRFZGdlT2Zmc2V0ID0gcG9zLmxlZnQgKyB2aWV3cG9ydFBhZGRpbmcgKyBhY3R1YWxXaWR0aFxuXHRcdFx0aWYgKGxlZnRFZGdlT2Zmc2V0IDwgdmlld3BvcnREaW1lbnNpb25zLmxlZnQpIHsgLy8gbGVmdCBvdmVyZmxvd1xuXHRcdFx0XHRkZWx0YS5sZWZ0ID0gdmlld3BvcnREaW1lbnNpb25zLmxlZnQgLSBsZWZ0RWRnZU9mZnNldFxuXHRcdFx0fSBlbHNlIGlmIChyaWdodEVkZ2VPZmZzZXQgPiB2aWV3cG9ydERpbWVuc2lvbnMud2lkdGgpIHsgLy8gcmlnaHQgb3ZlcmZsb3dcblx0XHRcdFx0ZGVsdGEubGVmdCA9IHZpZXdwb3J0RGltZW5zaW9ucy5sZWZ0ICsgdmlld3BvcnREaW1lbnNpb25zLndpZHRoIC0gcmlnaHRFZGdlT2Zmc2V0XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIGRlbHRhXG5cdH1cblxuXHRUb29sdGlwLnByb3RvdHlwZS5nZXRUaXRsZSA9IGZ1bmN0aW9uKCkge1xuXHRcdHZhciB0aXRsZVxuXHRcdHZhciAkZSA9IHRoaXMuJGVsZW1lbnRcblx0XHR2YXIgbyA9IHRoaXMub3B0aW9uc1xuXG5cdFx0dGl0bGUgPSAkZS5hdHRyKCdkYXRhLW9yaWdpbmFsLXRpdGxlJykgfHwgKHR5cGVvZiBvLnRpdGxlID09ICdmdW5jdGlvbicgPyBvLnRpdGxlLmNhbGwoJGVbMF0pIDogby50aXRsZSlcblxuXHRcdHJldHVybiB0aXRsZVxuXHR9XG5cblx0VG9vbHRpcC5wcm90b3R5cGUuZ2V0VUlEID0gZnVuY3Rpb24ocHJlZml4KSB7XG5cdFx0ZG8gcHJlZml4ICs9IH5+KE1hdGgucmFuZG9tKCkgKiAxMDAwMDAwKVxuXHRcdHdoaWxlIChkb2N1bWVudC5nZXRFbGVtZW50QnlJZChwcmVmaXgpKVxuXHRcdHJldHVybiBwcmVmaXhcblx0fVxuXG5cdFRvb2x0aXAucHJvdG90eXBlLnRpcCA9IGZ1bmN0aW9uKCkge1xuXHRcdHJldHVybiAodGhpcy4kdGlwID0gdGhpcy4kdGlwIHx8ICQodGhpcy5vcHRpb25zLnRlbXBsYXRlKSlcblx0fVxuXG5cdFRvb2x0aXAucHJvdG90eXBlLmFycm93ID0gZnVuY3Rpb24oKSB7XG5cdFx0cmV0dXJuICh0aGlzLiRhcnJvdyA9IHRoaXMuJGFycm93IHx8IHRoaXMudGlwKCkuZmluZCgnLnRvb2x0aXAtYXJyb3cnKSlcblx0fVxuXG5cdFRvb2x0aXAucHJvdG90eXBlLnZhbGlkYXRlID0gZnVuY3Rpb24oKSB7XG5cdFx0aWYgKCF0aGlzLiRlbGVtZW50WzBdLnBhcmVudE5vZGUpIHtcblx0XHRcdHRoaXMuaGlkZSgpXG5cdFx0XHR0aGlzLiRlbGVtZW50ID0gbnVsbFxuXHRcdFx0dGhpcy5vcHRpb25zID0gbnVsbFxuXHRcdH1cblx0fVxuXG5cdFRvb2x0aXAucHJvdG90eXBlLmVuYWJsZSA9IGZ1bmN0aW9uKCkge1xuXHRcdHRoaXMuZW5hYmxlZCA9IHRydWVcblx0fVxuXG5cdFRvb2x0aXAucHJvdG90eXBlLmRpc2FibGUgPSBmdW5jdGlvbigpIHtcblx0XHR0aGlzLmVuYWJsZWQgPSBmYWxzZVxuXHR9XG5cblx0VG9vbHRpcC5wcm90b3R5cGUudG9nZ2xlRW5hYmxlZCA9IGZ1bmN0aW9uKCkge1xuXHRcdHRoaXMuZW5hYmxlZCA9ICF0aGlzLmVuYWJsZWRcblx0fVxuXG5cdFRvb2x0aXAucHJvdG90eXBlLnRvZ2dsZSA9IGZ1bmN0aW9uKGUpIHtcblx0XHR2YXIgc2VsZiA9IHRoaXNcblx0XHRpZiAoZSkge1xuXHRcdFx0c2VsZiA9ICQoZS5jdXJyZW50VGFyZ2V0KS5kYXRhKCdicy4nICsgdGhpcy50eXBlKVxuXHRcdFx0aWYgKCFzZWxmKSB7XG5cdFx0XHRcdHNlbGYgPSBuZXcgdGhpcy5jb25zdHJ1Y3RvcihlLmN1cnJlbnRUYXJnZXQsIHRoaXMuZ2V0RGVsZWdhdGVPcHRpb25zKCkpXG5cdFx0XHRcdCQoZS5jdXJyZW50VGFyZ2V0KS5kYXRhKCdicy4nICsgdGhpcy50eXBlLCBzZWxmKVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHNlbGYudGlwKCkuaGFzQ2xhc3MoJ2luJykgPyBzZWxmLmxlYXZlKHNlbGYpIDogc2VsZi5lbnRlcihzZWxmKVxuXHR9XG5cblx0VG9vbHRpcC5wcm90b3R5cGUuZGVzdHJveSA9IGZ1bmN0aW9uKCkge1xuXHRcdGNsZWFyVGltZW91dCh0aGlzLnRpbWVvdXQpXG5cdFx0dGhpcy5oaWRlKCkuJGVsZW1lbnQub2ZmKCcuJyArIHRoaXMudHlwZSkucmVtb3ZlRGF0YSgnYnMuJyArIHRoaXMudHlwZSlcblx0fVxuXG5cblx0Ly8gVE9PTFRJUCBQTFVHSU4gREVGSU5JVElPTlxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09PT09XG5cblx0ZnVuY3Rpb24gUGx1Z2luKG9wdGlvbikge1xuXHRcdHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgJHRoaXMgPSAkKHRoaXMpXG5cdFx0XHR2YXIgZGF0YSA9ICR0aGlzLmRhdGEoJ2JzLnRvb2x0aXAnKVxuXHRcdFx0dmFyIG9wdGlvbnMgPSB0eXBlb2Ygb3B0aW9uID09ICdvYmplY3QnICYmIG9wdGlvblxuXG5cdFx0XHRpZiAoIWRhdGEgJiYgb3B0aW9uID09ICdkZXN0cm95JykgcmV0dXJuXG5cdFx0XHRpZiAoIWRhdGEpICR0aGlzLmRhdGEoJ2JzLnRvb2x0aXAnLCAoZGF0YSA9IG5ldyBUb29sdGlwKHRoaXMsIG9wdGlvbnMpKSlcblx0XHRcdGlmICh0eXBlb2Ygb3B0aW9uID09ICdzdHJpbmcnKSBkYXRhW29wdGlvbl0oKVxuXHRcdH0pXG5cdH1cblxuXHR2YXIgb2xkID0gJC5mbi50b29sdGlwXG5cblx0JC5mbi50b29sdGlwID0gUGx1Z2luXG5cdCQuZm4udG9vbHRpcC5Db25zdHJ1Y3RvciA9IFRvb2x0aXBcblxuXG5cdC8vIFRPT0xUSVAgTk8gQ09ORkxJQ1Rcblx0Ly8gPT09PT09PT09PT09PT09PT09PVxuXG5cdCQuZm4udG9vbHRpcC5ub0NvbmZsaWN0ID0gZnVuY3Rpb24oKSB7XG5cdFx0JC5mbi50b29sdGlwID0gb2xkXG5cdFx0cmV0dXJuIHRoaXNcblx0fVxuXG59KGpRdWVyeSk7XG5cbi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogQm9vdHN0cmFwOiBwb3BvdmVyLmpzIHYzLjIuMFxuICogaHR0cDovL2dldGJvb3RzdHJhcC5jb20vamF2YXNjcmlwdC8jcG9wb3ZlcnNcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogQ29weXJpZ2h0IDIwMTEtMjAxNCBUd2l0dGVyLCBJbmMuXG4gKiBMaWNlbnNlZCB1bmRlciBNSVQgKGh0dHBzOi8vZ2l0aHViLmNvbS90d2JzL2Jvb3RzdHJhcC9ibG9iL21hc3Rlci9MSUNFTlNFKVxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cblxuKyBmdW5jdGlvbigkKSB7XG5cdCd1c2Ugc3RyaWN0JztcblxuXHQvLyBQT1BPVkVSIFBVQkxJQyBDTEFTUyBERUZJTklUSU9OXG5cdC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuXHR2YXIgUG9wb3ZlciA9IGZ1bmN0aW9uKGVsZW1lbnQsIG9wdGlvbnMpIHtcblx0XHR0aGlzLmluaXQoJ3BvcG92ZXInLCBlbGVtZW50LCBvcHRpb25zKVxuXHR9XG5cblx0aWYgKCEkLmZuLnRvb2x0aXApIHRocm93IG5ldyBFcnJvcignUG9wb3ZlciByZXF1aXJlcyB0b29sdGlwLmpzJylcblxuXHRQb3BvdmVyLlZFUlNJT04gPSAnMy4yLjAnXG5cblx0UG9wb3Zlci5ERUZBVUxUUyA9ICQuZXh0ZW5kKHt9LCAkLmZuLnRvb2x0aXAuQ29uc3RydWN0b3IuREVGQVVMVFMsIHtcblx0XHRwbGFjZW1lbnQ6ICdyaWdodCcsXG5cdFx0dHJpZ2dlcjogJ2NsaWNrJyxcblx0XHRjb250ZW50OiAnJyxcblx0XHR0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJwb3BvdmVyXCIgcm9sZT1cInRvb2x0aXBcIj48ZGl2IGNsYXNzPVwiYXJyb3dcIj48L2Rpdj48aDMgY2xhc3M9XCJwb3BvdmVyLXRpdGxlXCI+PC9oMz48ZGl2IGNsYXNzPVwicG9wb3Zlci1jb250ZW50XCI+PC9kaXY+PC9kaXY+J1xuXHR9KVxuXG5cblx0Ly8gTk9URTogUE9QT1ZFUiBFWFRFTkRTIHRvb2x0aXAuanNcblx0Ly8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuXHRQb3BvdmVyLnByb3RvdHlwZSA9ICQuZXh0ZW5kKHt9LCAkLmZuLnRvb2x0aXAuQ29uc3RydWN0b3IucHJvdG90eXBlKVxuXG5cdFBvcG92ZXIucHJvdG90eXBlLmNvbnN0cnVjdG9yID0gUG9wb3ZlclxuXG5cdFBvcG92ZXIucHJvdG90eXBlLmdldERlZmF1bHRzID0gZnVuY3Rpb24oKSB7XG5cdFx0cmV0dXJuIFBvcG92ZXIuREVGQVVMVFNcblx0fVxuXG5cdFBvcG92ZXIucHJvdG90eXBlLnNldENvbnRlbnQgPSBmdW5jdGlvbigpIHtcblx0XHR2YXIgJHRpcCA9IHRoaXMudGlwKClcblx0XHR2YXIgdGl0bGUgPSB0aGlzLmdldFRpdGxlKClcblx0XHR2YXIgY29udGVudCA9IHRoaXMuZ2V0Q29udGVudCgpXG5cblx0XHQkdGlwLmZpbmQoJy5wb3BvdmVyLXRpdGxlJylbdGhpcy5vcHRpb25zLmh0bWwgPyAnaHRtbCcgOiAndGV4dCddKHRpdGxlKVxuXHRcdCR0aXAuZmluZCgnLnBvcG92ZXItY29udGVudCcpLmVtcHR5KClbIC8vIHdlIHVzZSBhcHBlbmQgZm9yIGh0bWwgb2JqZWN0cyB0byBtYWludGFpbiBqcyBldmVudHNcblx0XHRcdHRoaXMub3B0aW9ucy5odG1sID8gKHR5cGVvZiBjb250ZW50ID09ICdzdHJpbmcnID8gJ2h0bWwnIDogJ2FwcGVuZCcpIDogJ3RleHQnXG5cdFx0XShjb250ZW50KVxuXG5cdFx0JHRpcC5yZW1vdmVDbGFzcygnZmFkZSB0b3AgYm90dG9tIGxlZnQgcmlnaHQgaW4nKVxuXG5cdFx0Ly8gSUU4IGRvZXNuJ3QgYWNjZXB0IGhpZGluZyB2aWEgdGhlIGA6ZW1wdHlgIHBzZXVkbyBzZWxlY3Rvciwgd2UgaGF2ZSB0byBkb1xuXHRcdC8vIHRoaXMgbWFudWFsbHkgYnkgY2hlY2tpbmcgdGhlIGNvbnRlbnRzLlxuXHRcdGlmICghJHRpcC5maW5kKCcucG9wb3Zlci10aXRsZScpLmh0bWwoKSkgJHRpcC5maW5kKCcucG9wb3Zlci10aXRsZScpLmhpZGUoKVxuXHR9XG5cblx0UG9wb3Zlci5wcm90b3R5cGUuaGFzQ29udGVudCA9IGZ1bmN0aW9uKCkge1xuXHRcdHJldHVybiB0aGlzLmdldFRpdGxlKCkgfHwgdGhpcy5nZXRDb250ZW50KClcblx0fVxuXG5cdFBvcG92ZXIucHJvdG90eXBlLmdldENvbnRlbnQgPSBmdW5jdGlvbigpIHtcblx0XHR2YXIgJGUgPSB0aGlzLiRlbGVtZW50XG5cdFx0dmFyIG8gPSB0aGlzLm9wdGlvbnNcblxuXHRcdHJldHVybiAkZS5hdHRyKCdkYXRhLWNvbnRlbnQnKSB8fCAodHlwZW9mIG8uY29udGVudCA9PSAnZnVuY3Rpb24nID9cblx0XHRcdG8uY29udGVudC5jYWxsKCRlWzBdKSA6XG5cdFx0XHRvLmNvbnRlbnQpXG5cdH1cblxuXHRQb3BvdmVyLnByb3RvdHlwZS5hcnJvdyA9IGZ1bmN0aW9uKCkge1xuXHRcdHJldHVybiAodGhpcy4kYXJyb3cgPSB0aGlzLiRhcnJvdyB8fCB0aGlzLnRpcCgpLmZpbmQoJy5hcnJvdycpKVxuXHR9XG5cblx0UG9wb3Zlci5wcm90b3R5cGUudGlwID0gZnVuY3Rpb24oKSB7XG5cdFx0aWYgKCF0aGlzLiR0aXApIHRoaXMuJHRpcCA9ICQodGhpcy5vcHRpb25zLnRlbXBsYXRlKVxuXHRcdHJldHVybiB0aGlzLiR0aXBcblx0fVxuXG5cblx0Ly8gUE9QT1ZFUiBQTFVHSU4gREVGSU5JVElPTlxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09PT09XG5cblx0ZnVuY3Rpb24gUGx1Z2luKG9wdGlvbikge1xuXHRcdHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgJHRoaXMgPSAkKHRoaXMpXG5cdFx0XHR2YXIgZGF0YSA9ICR0aGlzLmRhdGEoJ2JzLnBvcG92ZXInKVxuXHRcdFx0dmFyIG9wdGlvbnMgPSB0eXBlb2Ygb3B0aW9uID09ICdvYmplY3QnICYmIG9wdGlvblxuXG5cdFx0XHRpZiAoIWRhdGEgJiYgb3B0aW9uID09ICdkZXN0cm95JykgcmV0dXJuXG5cdFx0XHRpZiAoIWRhdGEpICR0aGlzLmRhdGEoJ2JzLnBvcG92ZXInLCAoZGF0YSA9IG5ldyBQb3BvdmVyKHRoaXMsIG9wdGlvbnMpKSlcblx0XHRcdGlmICh0eXBlb2Ygb3B0aW9uID09ICdzdHJpbmcnKSBkYXRhW29wdGlvbl0oKVxuXHRcdH0pXG5cdH1cblxuXHR2YXIgb2xkID0gJC5mbi5wb3BvdmVyXG5cblx0JC5mbi5wb3BvdmVyID0gUGx1Z2luXG5cdCQuZm4ucG9wb3Zlci5Db25zdHJ1Y3RvciA9IFBvcG92ZXJcblxuXG5cdC8vIFBPUE9WRVIgTk8gQ09ORkxJQ1Rcblx0Ly8gPT09PT09PT09PT09PT09PT09PVxuXG5cdCQuZm4ucG9wb3Zlci5ub0NvbmZsaWN0ID0gZnVuY3Rpb24oKSB7XG5cdFx0JC5mbi5wb3BvdmVyID0gb2xkXG5cdFx0cmV0dXJuIHRoaXNcblx0fVxuXG59KGpRdWVyeSk7XG5cbi8qKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqIVxuICogQm9vdHN0cmFwLXNlbGVjdCB2MS42LjIgKGh0dHA6Ly9zaWx2aW9tb3JldG8uZ2l0aHViLmlvL2Jvb3RzdHJhcC1zZWxlY3QvKVxuICpcbiAqIENvcHlyaWdodCAyMDEzLTIwMTQgYm9vdHN0cmFwLXNlbGVjdFxuICogTGljZW5zZWQgdW5kZXIgTUlUIChodHRwczovL2dpdGh1Yi5jb20vc2lsdmlvbW9yZXRvL2Jvb3RzdHJhcC1zZWxlY3QvYmxvYi9tYXN0ZXIvTElDRU5TRSlcbiAqL1xuKGZ1bmN0aW9uKCQpIHtcblx0J3VzZSBzdHJpY3QnO1xuXG5cdC8vIENhc2UgaW5zZW5zaXRpdmUgc2VhcmNoXG5cdCQuZXhwclsnOiddLmljb250YWlucyA9IGZ1bmN0aW9uKG9iaiwgaW5kZXgsIG1ldGEpIHtcblx0XHRyZXR1cm4gaWNvbnRhaW5zKCQob2JqKS50ZXh0KCksIG1ldGFbM10pO1xuXHR9O1xuXG5cdC8vIENhc2UgYW5kIGFjY2VudCBpbnNlbnNpdGl2ZSBzZWFyY2hcblx0JC5leHByWyc6J10uYWljb250YWlucyA9IGZ1bmN0aW9uKG9iaiwgaW5kZXgsIG1ldGEpIHtcblx0XHRyZXR1cm4gaWNvbnRhaW5zKCQob2JqKS5kYXRhKCdub3JtYWxpemVkVGV4dCcpIHx8ICQob2JqKS50ZXh0KCksIG1ldGFbM10pO1xuXHR9O1xuXG5cdC8qKlxuXHQgKiBBY3R1YWwgaW1wbGVtZW50YXRpb24gb2YgdGhlIGNhc2UgaW5zZW5zaXRpdmUgc2VhcmNoLlxuXHQgKiBAYWNjZXNzIHByaXZhdGVcblx0ICogQHBhcmFtIHtTdHJpbmd9IGhheXN0YWNrXG5cdCAqIEBwYXJhbSB7U3RyaW5nfSBuZWVkbGVcblx0ICogQHJldHVybnMge2Jvb2xlYW59XG5cdCAqL1xuXHRmdW5jdGlvbiBpY29udGFpbnMoaGF5c3RhY2ssIG5lZWRsZSkge1xuXHRcdHJldHVybiBoYXlzdGFjay50b1VwcGVyQ2FzZSgpLmluZGV4T2YobmVlZGxlLnRvVXBwZXJDYXNlKCkpID4gLTE7XG5cdH1cblxuXHQvKipcblx0ICogUmVtb3ZlIGFsbCBkaWF0cmljcyBmcm9tIHRoZSBnaXZlbiB0ZXh0LlxuXHQgKiBAYWNjZXNzIHByaXZhdGVcblx0ICogQHBhcmFtIHtTdHJpbmd9IHRleHRcblx0ICogQHJldHVybnMge1N0cmluZ31cblx0ICovXG5cdGZ1bmN0aW9uIG5vcm1hbGl6ZVRvQmFzZSh0ZXh0KSB7XG5cdFx0dmFyIHJFeHBzID0gW3tcblx0XHRcdHJlOiAvW1xceEMwLVxceEM2XS9nLFxuXHRcdFx0Y2g6IFwiQVwiXG5cdFx0fSwge1xuXHRcdFx0cmU6IC9bXFx4RTAtXFx4RTZdL2csXG5cdFx0XHRjaDogXCJhXCJcblx0XHR9LCB7XG5cdFx0XHRyZTogL1tcXHhDOC1cXHhDQl0vZyxcblx0XHRcdGNoOiBcIkVcIlxuXHRcdH0sIHtcblx0XHRcdHJlOiAvW1xceEU4LVxceEVCXS9nLFxuXHRcdFx0Y2g6IFwiZVwiXG5cdFx0fSwge1xuXHRcdFx0cmU6IC9bXFx4Q0MtXFx4Q0ZdL2csXG5cdFx0XHRjaDogXCJJXCJcblx0XHR9LCB7XG5cdFx0XHRyZTogL1tcXHhFQy1cXHhFRl0vZyxcblx0XHRcdGNoOiBcImlcIlxuXHRcdH0sIHtcblx0XHRcdHJlOiAvW1xceEQyLVxceEQ2XS9nLFxuXHRcdFx0Y2g6IFwiT1wiXG5cdFx0fSwge1xuXHRcdFx0cmU6IC9bXFx4RjItXFx4RjZdL2csXG5cdFx0XHRjaDogXCJvXCJcblx0XHR9LCB7XG5cdFx0XHRyZTogL1tcXHhEOS1cXHhEQ10vZyxcblx0XHRcdGNoOiBcIlVcIlxuXHRcdH0sIHtcblx0XHRcdHJlOiAvW1xceEY5LVxceEZDXS9nLFxuXHRcdFx0Y2g6IFwidVwiXG5cdFx0fSwge1xuXHRcdFx0cmU6IC9bXFx4QzctXFx4RTddL2csXG5cdFx0XHRjaDogXCJjXCJcblx0XHR9LCB7XG5cdFx0XHRyZTogL1tcXHhEMV0vZyxcblx0XHRcdGNoOiBcIk5cIlxuXHRcdH0sIHtcblx0XHRcdHJlOiAvW1xceEYxXS9nLFxuXHRcdFx0Y2g6IFwiblwiXG5cdFx0fV07XG5cdFx0JC5lYWNoKHJFeHBzLCBmdW5jdGlvbigpIHtcblx0XHRcdHRleHQgPSB0ZXh0LnJlcGxhY2UodGhpcy5yZSwgdGhpcy5jaCk7XG5cdFx0fSk7XG5cdFx0cmV0dXJuIHRleHQ7XG5cdH1cblxuXHR2YXIgU2VsZWN0cGlja2VyID0gZnVuY3Rpb24oZWxlbWVudCwgb3B0aW9ucywgZSkge1xuXHRcdGlmIChlKSB7XG5cdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdH1cblxuXHRcdHRoaXMuJGVsZW1lbnQgPSAkKGVsZW1lbnQpO1xuXHRcdHRoaXMuJG5ld0VsZW1lbnQgPSBudWxsO1xuXHRcdHRoaXMuJGJ1dHRvbiA9IG51bGw7XG5cdFx0dGhpcy4kbWVudSA9IG51bGw7XG5cdFx0dGhpcy4kbGlzID0gbnVsbDtcblx0XHR0aGlzLm9wdGlvbnMgPSBvcHRpb25zO1xuXG5cdFx0Ly8gSWYgd2UgaGF2ZSBubyB0aXRsZSB5ZXQsIHRyeSB0byBwdWxsIGl0IGZyb20gdGhlIGh0bWwgdGl0bGUgYXR0cmlidXRlIChqUXVlcnkgZG9lc250JyBwaWNrIGl0IHVwIGFzIGl0J3Mgbm90IGFcblx0XHQvLyBkYXRhLWF0dHJpYnV0ZSlcblx0XHRpZiAodGhpcy5vcHRpb25zLnRpdGxlID09PSBudWxsKSB7XG5cdFx0XHR0aGlzLm9wdGlvbnMudGl0bGUgPSB0aGlzLiRlbGVtZW50LmF0dHIoJ3RpdGxlJyk7XG5cdFx0fVxuXG5cdFx0Ly9FeHBvc2UgcHVibGljIG1ldGhvZHNcblx0XHR0aGlzLnZhbCA9IFNlbGVjdHBpY2tlci5wcm90b3R5cGUudmFsO1xuXHRcdHRoaXMucmVuZGVyID0gU2VsZWN0cGlja2VyLnByb3RvdHlwZS5yZW5kZXI7XG5cdFx0dGhpcy5yZWZyZXNoID0gU2VsZWN0cGlja2VyLnByb3RvdHlwZS5yZWZyZXNoO1xuXHRcdHRoaXMuc2V0U3R5bGUgPSBTZWxlY3RwaWNrZXIucHJvdG90eXBlLnNldFN0eWxlO1xuXHRcdHRoaXMuc2VsZWN0QWxsID0gU2VsZWN0cGlja2VyLnByb3RvdHlwZS5zZWxlY3RBbGw7XG5cdFx0dGhpcy5kZXNlbGVjdEFsbCA9IFNlbGVjdHBpY2tlci5wcm90b3R5cGUuZGVzZWxlY3RBbGw7XG5cdFx0dGhpcy5kZXN0cm95ID0gU2VsZWN0cGlja2VyLnByb3RvdHlwZS5yZW1vdmU7XG5cdFx0dGhpcy5yZW1vdmUgPSBTZWxlY3RwaWNrZXIucHJvdG90eXBlLnJlbW92ZTtcblx0XHR0aGlzLnNob3cgPSBTZWxlY3RwaWNrZXIucHJvdG90eXBlLnNob3c7XG5cdFx0dGhpcy5oaWRlID0gU2VsZWN0cGlja2VyLnByb3RvdHlwZS5oaWRlO1xuXG5cdFx0dGhpcy5pbml0KCk7XG5cdH07XG5cblx0U2VsZWN0cGlja2VyLlZFUlNJT04gPSAnMS42LjInO1xuXG5cdC8vIHBhcnQgb2YgdGhpcyBpcyBkdXBsaWNhdGVkIGluIGkxOG4vZGVmYXVsdHMtZW5fVVMuanMuIE1ha2Ugc3VyZSB0byB1cGRhdGUgYm90aC5cblx0U2VsZWN0cGlja2VyLkRFRkFVTFRTID0ge1xuXHRcdG5vbmVTZWxlY3RlZFRleHQ6ICdOb3RoaW5nIHNlbGVjdGVkJyxcblx0XHRub25lUmVzdWx0c1RleHQ6ICdObyByZXN1bHRzIG1hdGNoJyxcblx0XHRjb3VudFNlbGVjdGVkVGV4dDogZnVuY3Rpb24obnVtU2VsZWN0ZWQsIG51bVRvdGFsKSB7XG5cdFx0XHRyZXR1cm4gKG51bVNlbGVjdGVkID09IDEpID8gXCJ7MH0gaXRlbSBzZWxlY3RlZFwiIDogXCJ7MH0gaXRlbXMgc2VsZWN0ZWRcIjtcblx0XHR9LFxuXHRcdG1heE9wdGlvbnNUZXh0OiBmdW5jdGlvbihudW1BbGwsIG51bUdyb3VwKSB7XG5cdFx0XHR2YXIgYXJyID0gW107XG5cblx0XHRcdGFyclswXSA9IChudW1BbGwgPT0gMSkgPyAnTGltaXQgcmVhY2hlZCAoe259IGl0ZW0gbWF4KScgOiAnTGltaXQgcmVhY2hlZCAoe259IGl0ZW1zIG1heCknO1xuXHRcdFx0YXJyWzFdID0gKG51bUdyb3VwID09IDEpID8gJ0dyb3VwIGxpbWl0IHJlYWNoZWQgKHtufSBpdGVtIG1heCknIDogJ0dyb3VwIGxpbWl0IHJlYWNoZWQgKHtufSBpdGVtcyBtYXgpJztcblxuXHRcdFx0cmV0dXJuIGFycjtcblx0XHR9LFxuXHRcdHNlbGVjdEFsbFRleHQ6ICdTZWxlY3QgQWxsJyxcblx0XHRkZXNlbGVjdEFsbFRleHQ6ICdEZXNlbGVjdCBBbGwnLFxuXHRcdG11bHRpcGxlU2VwYXJhdG9yOiAnLCAnLFxuXHRcdHN0eWxlOiAnYnRuLXNlbGVjdCcsXG5cdFx0c2l6ZTogJ2F1dG8nLFxuXHRcdHRpdGxlOiAnc3RyaW5nJyxcblx0XHRzZWxlY3RlZFRleHRGb3JtYXQ6ICd2YWx1ZXMnLFxuXHRcdHdpZHRoOiBmYWxzZSxcblx0XHRjb250YWluZXI6IGZhbHNlLFxuXHRcdGhpZGVEaXNhYmxlZDogZmFsc2UsXG5cdFx0c2hvd1N1YnRleHQ6IGZhbHNlLFxuXHRcdHNob3dJY29uOiB0cnVlLFxuXHRcdHNob3dDb250ZW50OiB0cnVlLFxuXHRcdGRyb3B1cEF1dG86IHRydWUsXG5cdFx0aGVhZGVyOiBmYWxzZSxcblx0XHRsaXZlU2VhcmNoOiBmYWxzZSxcblx0XHRhY3Rpb25zQm94OiBmYWxzZSxcblx0XHRpY29uQmFzZTogJ2dseXBoaWNvbicsXG5cdFx0dGlja0ljb246ICdnbHlwaGljb24tb2snLFxuXHRcdG1heE9wdGlvbnM6IGZhbHNlLFxuXHRcdG1vYmlsZTogZmFsc2UsXG5cdFx0c2VsZWN0T25UYWI6IGZhbHNlLFxuXHRcdGRyb3Bkb3duQWxpZ25SaWdodDogZmFsc2UsXG5cdFx0c2VhcmNoQWNjZW50SW5zZW5zaXRpdmU6IGZhbHNlXG5cdH07XG5cblx0U2VsZWN0cGlja2VyLnByb3RvdHlwZSA9IHtcblxuXHRcdGNvbnN0cnVjdG9yOiBTZWxlY3RwaWNrZXIsXG5cblx0XHRpbml0OiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciB0aGF0ID0gdGhpcyxcblx0XHRcdFx0aWQgPSB0aGlzLiRlbGVtZW50LmF0dHIoJ2lkJyk7XG5cblx0XHRcdHRoaXMuJGVsZW1lbnQuaGlkZSgpO1xuXHRcdFx0dGhpcy5tdWx0aXBsZSA9IHRoaXMuJGVsZW1lbnQucHJvcCgnbXVsdGlwbGUnKTtcblx0XHRcdHRoaXMuYXV0b2ZvY3VzID0gdGhpcy4kZWxlbWVudC5wcm9wKCdhdXRvZm9jdXMnKTtcblx0XHRcdHRoaXMuJG5ld0VsZW1lbnQgPSB0aGlzLmNyZWF0ZVZpZXcoKTtcblx0XHRcdHRoaXMuJGVsZW1lbnQuYWZ0ZXIodGhpcy4kbmV3RWxlbWVudCk7XG5cdFx0XHR0aGlzLiRtZW51ID0gdGhpcy4kbmV3RWxlbWVudC5maW5kKCc+IC5kcm9wZG93bi1tZW51Jyk7XG5cdFx0XHR0aGlzLiRidXR0b24gPSB0aGlzLiRuZXdFbGVtZW50LmZpbmQoJz4gYnV0dG9uJyk7XG5cdFx0XHR0aGlzLiRzZWFyY2hib3ggPSB0aGlzLiRuZXdFbGVtZW50LmZpbmQoJ2lucHV0Jyk7XG5cblx0XHRcdGlmICh0aGlzLm9wdGlvbnMuZHJvcGRvd25BbGlnblJpZ2h0KVxuXHRcdFx0XHR0aGlzLiRtZW51LmFkZENsYXNzKCdkcm9wZG93bi1tZW51LXJpZ2h0Jyk7XG5cblx0XHRcdGlmICh0eXBlb2YgaWQgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdHRoaXMuJGJ1dHRvbi5hdHRyKCdkYXRhLWlkJywgaWQpO1xuXHRcdFx0XHQkKCdsYWJlbFtmb3I9XCInICsgaWQgKyAnXCJdJykuY2xpY2soZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHR0aGF0LiRidXR0b24uZm9jdXMoKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuY2hlY2tEaXNhYmxlZCgpO1xuXHRcdFx0dGhpcy5jbGlja0xpc3RlbmVyKCk7XG5cdFx0XHRpZiAodGhpcy5vcHRpb25zLmxpdmVTZWFyY2gpIHRoaXMubGl2ZVNlYXJjaExpc3RlbmVyKCk7XG5cdFx0XHR0aGlzLnJlbmRlcigpO1xuXHRcdFx0dGhpcy5saUhlaWdodCgpO1xuXHRcdFx0dGhpcy5zZXRTdHlsZSgpO1xuXHRcdFx0dGhpcy5zZXRXaWR0aCgpO1xuXHRcdFx0aWYgKHRoaXMub3B0aW9ucy5jb250YWluZXIpIHRoaXMuc2VsZWN0UG9zaXRpb24oKTtcblx0XHRcdHRoaXMuJG1lbnUuZGF0YSgndGhpcycsIHRoaXMpO1xuXHRcdFx0dGhpcy4kbmV3RWxlbWVudC5kYXRhKCd0aGlzJywgdGhpcyk7XG5cdFx0XHRpZiAodGhpcy5vcHRpb25zLm1vYmlsZSkgdGhpcy5tb2JpbGUoKTtcblx0XHR9LFxuXG5cdFx0Y3JlYXRlRHJvcGRvd246IGZ1bmN0aW9uKCkge1xuXHRcdFx0Ly8gT3B0aW9uc1xuXHRcdFx0Ly8gSWYgd2UgYXJlIG11bHRpcGxlLCB0aGVuIGFkZCB0aGUgc2hvdy10aWNrIGNsYXNzIGJ5IGRlZmF1bHRcblx0XHRcdHZhciBtdWx0aXBsZSA9IHRoaXMubXVsdGlwbGUgPyAnIHNob3ctdGljaycgOiAnJyxcblx0XHRcdFx0aW5wdXRHcm91cCA9IHRoaXMuJGVsZW1lbnQucGFyZW50KCkuaGFzQ2xhc3MoJ2lucHV0LWdyb3VwJykgPyAnIGlucHV0LWdyb3VwLWJ0bicgOiAnJyxcblx0XHRcdFx0YXV0b2ZvY3VzID0gdGhpcy5hdXRvZm9jdXMgPyAnIGF1dG9mb2N1cycgOiAnJyxcblx0XHRcdFx0YnRuU2l6ZSA9IHRoaXMuJGVsZW1lbnQucGFyZW50cygpLmhhc0NsYXNzKCdmb3JtLWdyb3VwLWxnJykgPyAnIGJ0bi1sZycgOiAodGhpcy4kZWxlbWVudC5wYXJlbnRzKCkuaGFzQ2xhc3MoJ2Zvcm0tZ3JvdXAtc20nKSA/ICcgYnRuLXNtJyA6ICcnKTtcblx0XHRcdC8vIEVsZW1lbnRzXG5cdFx0XHR2YXIgaGVhZGVyID0gdGhpcy5vcHRpb25zLmhlYWRlciA/ICc8ZGl2IGNsYXNzPVwicG9wb3Zlci10aXRsZVwiPjxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiY2xvc2VcIiBhcmlhLWhpZGRlbj1cInRydWVcIj4mdGltZXM7PC9idXR0b24+JyArIHRoaXMub3B0aW9ucy5oZWFkZXIgKyAnPC9kaXY+JyA6ICcnO1xuXHRcdFx0dmFyIHNlYXJjaGJveCA9IHRoaXMub3B0aW9ucy5saXZlU2VhcmNoID8gJzxkaXYgY2xhc3M9XCJicy1zZWFyY2hib3hcIj48aW5wdXQgdHlwZT1cInRleHRcIiBjbGFzcz1cImlucHV0LWJsb2NrLWxldmVsIGZvcm0tY29udHJvbFwiIGF1dG9jb21wbGV0ZT1cIm9mZlwiIC8+PC9kaXY+JyA6ICcnO1xuXHRcdFx0dmFyIGFjdGlvbnNib3ggPSB0aGlzLm9wdGlvbnMuYWN0aW9uc0JveCA/ICc8ZGl2IGNsYXNzPVwiYnMtYWN0aW9uc2JveFwiPicgK1xuXHRcdFx0XHQnPGRpdiBjbGFzcz1cImJ0bi1ncm91cCBidG4tYmxvY2tcIj4nICtcblx0XHRcdFx0JzxidXR0b24gY2xhc3M9XCJhY3Rpb25zLWJ0biBicy1zZWxlY3QtYWxsIGJ0biBidG4tc20gYnRuLWRlZmF1bHRcIj4nICtcblx0XHRcdFx0dGhpcy5vcHRpb25zLnNlbGVjdEFsbFRleHQgK1xuXHRcdFx0XHQnPC9idXR0b24+JyArXG5cdFx0XHRcdCc8YnV0dG9uIGNsYXNzPVwiYWN0aW9ucy1idG4gYnMtZGVzZWxlY3QtYWxsIGJ0biBidG4tc20gYnRuLWRlZmF1bHRcIj4nICtcblx0XHRcdFx0dGhpcy5vcHRpb25zLmRlc2VsZWN0QWxsVGV4dCArXG5cdFx0XHRcdCc8L2J1dHRvbj4nICtcblx0XHRcdFx0JzwvZGl2PicgK1xuXHRcdFx0XHQnPC9kaXY+JyA6ICcnO1xuXHRcdFx0dmFyIGRyb3AgPVxuXHRcdFx0XHQnPGRpdiBjbGFzcz1cImJ0bi1ncm91cCBib290c3RyYXAtc2VsZWN0JyArIG11bHRpcGxlICsgaW5wdXRHcm91cCArICdcIj4nICtcblx0XHRcdFx0JzxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiYnRuIGRyb3Bkb3duLXRvZ2dsZSBzZWxlY3RwaWNrZXInICsgYnRuU2l6ZSArICdcIiBkYXRhLXRvZ2dsZT1cImRyb3Bkb3duXCInICsgYXV0b2ZvY3VzICsgJz4nICtcblx0XHRcdFx0JzxzcGFuIGNsYXNzPVwiZmlsdGVyLW9wdGlvbiBwdWxsLWxlZnRcIj48L3NwYW4+Jm5ic3A7JyArXG5cdFx0XHRcdCc8c3BhbiBjbGFzcz1cImNhcmV0XCI+PC9zcGFuPicgK1xuXHRcdFx0XHQnPC9idXR0b24+JyArXG5cdFx0XHRcdCc8ZGl2IGNsYXNzPVwiZHJvcGRvd24tbWVudSBvcGVuXCI+JyArXG5cdFx0XHRcdGhlYWRlciArXG5cdFx0XHRcdHNlYXJjaGJveCArXG5cdFx0XHRcdGFjdGlvbnNib3ggK1xuXHRcdFx0XHQnPHVsIGNsYXNzPVwiZHJvcGRvd24tbWVudSBpbm5lciBzZWxlY3RwaWNrZXJcIiByb2xlPVwibWVudVwiPicgK1xuXHRcdFx0XHQnPC91bD4nICtcblx0XHRcdFx0JzwvZGl2PicgK1xuXHRcdFx0XHQnPC9kaXY+JztcblxuXHRcdFx0cmV0dXJuICQoZHJvcCk7XG5cdFx0fSxcblxuXHRcdGNyZWF0ZVZpZXc6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyICRkcm9wID0gdGhpcy5jcmVhdGVEcm9wZG93bigpO1xuXHRcdFx0dmFyICRsaSA9IHRoaXMuY3JlYXRlTGkoKTtcblx0XHRcdCRkcm9wLmZpbmQoJ3VsJykuYXBwZW5kKCRsaSk7XG5cdFx0XHRyZXR1cm4gJGRyb3A7XG5cdFx0fSxcblxuXHRcdHJlbG9hZExpOiBmdW5jdGlvbigpIHtcblx0XHRcdC8vUmVtb3ZlIGFsbCBjaGlsZHJlbi5cblx0XHRcdHRoaXMuZGVzdHJveUxpKCk7XG5cdFx0XHQvL1JlIGJ1aWxkXG5cdFx0XHR2YXIgJGxpID0gdGhpcy5jcmVhdGVMaSgpO1xuXHRcdFx0dGhpcy4kbWVudS5maW5kKCd1bCcpLmFwcGVuZCgkbGkpO1xuXHRcdH0sXG5cblx0XHRkZXN0cm95TGk6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dGhpcy4kbWVudS5maW5kKCdsaScpLnJlbW92ZSgpO1xuXHRcdH0sXG5cblx0XHRjcmVhdGVMaTogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgdGhhdCA9IHRoaXMsXG5cdFx0XHRcdF9saSA9IFtdLFxuXHRcdFx0XHRvcHRJRCA9IDA7XG5cblx0XHRcdC8vIEhlbHBlciBmdW5jdGlvbnNcblx0XHRcdC8qKlxuXHRcdFx0ICogQHBhcmFtIGNvbnRlbnRcblx0XHRcdCAqIEBwYXJhbSBbaW5kZXhdXG5cdFx0XHQgKiBAcGFyYW0gW2NsYXNzZXNdXG5cdFx0XHQgKiBAcmV0dXJucyB7c3RyaW5nfVxuXHRcdFx0ICovXG5cdFx0XHR2YXIgZ2VuZXJhdGVMSSA9IGZ1bmN0aW9uKGNvbnRlbnQsIGluZGV4LCBjbGFzc2VzKSB7XG5cdFx0XHRcdHJldHVybiAnPGxpJyArXG5cdFx0XHRcdFx0KHR5cGVvZiBjbGFzc2VzICE9PSAndW5kZWZpbmVkJyA/ICcgY2xhc3M9XCInICsgY2xhc3NlcyArICdcIicgOiAnJykgK1xuXHRcdFx0XHRcdCh0eXBlb2YgaW5kZXggIT09ICd1bmRlZmluZWQnIHwgbnVsbCA9PT0gaW5kZXggPyAnIGRhdGEtb3JpZ2luYWwtaW5kZXg9XCInICsgaW5kZXggKyAnXCInIDogJycpICtcblx0XHRcdFx0XHQnPicgKyBjb250ZW50ICsgJzwvbGk+Jztcblx0XHRcdH07XG5cblx0XHRcdC8qKlxuXHRcdFx0ICogQHBhcmFtIHRleHRcblx0XHRcdCAqIEBwYXJhbSBbY2xhc3Nlc11cblx0XHRcdCAqIEBwYXJhbSBbaW5saW5lXVxuXHRcdFx0ICogQHBhcmFtIFtvcHRncm91cF1cblx0XHRcdCAqIEByZXR1cm5zIHtzdHJpbmd9XG5cdFx0XHQgKi9cblx0XHRcdHZhciBnZW5lcmF0ZUEgPSBmdW5jdGlvbih0ZXh0LCBjbGFzc2VzLCBpbmxpbmUsIG9wdGdyb3VwKSB7XG5cdFx0XHRcdHZhciBub3JtVGV4dCA9IG5vcm1hbGl6ZVRvQmFzZSgkLnRyaW0oJChcIjxkaXYvPlwiKS5odG1sKHRleHQpLnRleHQoKSkucmVwbGFjZSgvXFxzXFxzKy9nLCAnICcpKTtcblx0XHRcdFx0cmV0dXJuICc8YSB0YWJpbmRleD1cIjBcIicgK1xuXHRcdFx0XHRcdCh0eXBlb2YgY2xhc3NlcyAhPT0gJ3VuZGVmaW5lZCcgPyAnIGNsYXNzPVwiJyArIGNsYXNzZXMgKyAnXCInIDogJycpICtcblx0XHRcdFx0XHQodHlwZW9mIGlubGluZSAhPT0gJ3VuZGVmaW5lZCcgPyAnIHN0eWxlPVwiJyArIGlubGluZSArICdcIicgOiAnJykgK1xuXHRcdFx0XHRcdCh0eXBlb2Ygb3B0Z3JvdXAgIT09ICd1bmRlZmluZWQnID8gJ2RhdGEtb3B0Z3JvdXA9XCInICsgb3B0Z3JvdXAgKyAnXCInIDogJycpICtcblx0XHRcdFx0XHQnIGRhdGEtbm9ybWFsaXplZC10ZXh0PVwiJyArIG5vcm1UZXh0ICsgJ1wiJyArXG5cdFx0XHRcdFx0Jz4nICsgdGV4dCArXG5cdFx0XHRcdFx0JzxzcGFuIGNsYXNzPVwiJyArIHRoYXQub3B0aW9ucy5pY29uQmFzZSArICcgJyArIHRoYXQub3B0aW9ucy50aWNrSWNvbiArICcgY2hlY2stbWFya1wiPjwvc3Bhbj4nICtcblx0XHRcdFx0XHQnPC9hPic7XG5cdFx0XHR9O1xuXG5cdFx0XHR0aGlzLiRlbGVtZW50LmZpbmQoJ29wdGlvbicpLmVhY2goZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHZhciAkdGhpcyA9ICQodGhpcyk7XG5cblx0XHRcdFx0Ly8gR2V0IHRoZSBjbGFzcyBhbmQgdGV4dCBmb3IgdGhlIG9wdGlvblxuXHRcdFx0XHR2YXIgb3B0aW9uQ2xhc3MgPSAkdGhpcy5hdHRyKCdjbGFzcycpIHx8ICcnLFxuXHRcdFx0XHRcdGlubGluZSA9ICR0aGlzLmF0dHIoJ3N0eWxlJyksXG5cdFx0XHRcdFx0dGV4dCA9ICR0aGlzLmRhdGEoJ2NvbnRlbnQnKSA/ICR0aGlzLmRhdGEoJ2NvbnRlbnQnKSA6ICR0aGlzLmh0bWwoKSxcblx0XHRcdFx0XHRzdWJ0ZXh0ID0gdHlwZW9mICR0aGlzLmRhdGEoJ3N1YnRleHQnKSAhPT0gJ3VuZGVmaW5lZCcgPyAnPHNtYWxsIGNsYXNzPVwibXV0ZWQgdGV4dC1tdXRlZFwiPicgKyAkdGhpcy5kYXRhKCdzdWJ0ZXh0JykgKyAnPC9zbWFsbD4nIDogJycsXG5cdFx0XHRcdFx0aWNvbiA9IHR5cGVvZiAkdGhpcy5kYXRhKCdpY29uJykgIT09ICd1bmRlZmluZWQnID8gJzxzcGFuIGNsYXNzPVwiJyArIHRoYXQub3B0aW9ucy5pY29uQmFzZSArICcgJyArICR0aGlzLmRhdGEoJ2ljb24nKSArICdcIj48L3NwYW4+ICcgOiAnJyxcblx0XHRcdFx0XHRpc0Rpc2FibGVkID0gJHRoaXMuaXMoJzpkaXNhYmxlZCcpIHx8ICR0aGlzLnBhcmVudCgpLmlzKCc6ZGlzYWJsZWQnKSxcblx0XHRcdFx0XHRpbmRleCA9ICR0aGlzWzBdLmluZGV4O1xuXHRcdFx0XHRpZiAoaWNvbiAhPT0gJycgJiYgaXNEaXNhYmxlZCkge1xuXHRcdFx0XHRcdGljb24gPSAnPHNwYW4+JyArIGljb24gKyAnPC9zcGFuPic7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoISR0aGlzLmRhdGEoJ2NvbnRlbnQnKSkge1xuXHRcdFx0XHRcdC8vIFByZXBlbmQgYW55IGljb24gYW5kIGFwcGVuZCBhbnkgc3VidGV4dCB0byB0aGUgbWFpbiB0ZXh0LlxuXHRcdFx0XHRcdHRleHQgPSBpY29uICsgJzxzcGFuIGNsYXNzPVwidGV4dFwiPicgKyB0ZXh0ICsgc3VidGV4dCArICc8L3NwYW4+Jztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0aGF0Lm9wdGlvbnMuaGlkZURpc2FibGVkICYmIGlzRGlzYWJsZWQpIHtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoJHRoaXMucGFyZW50KCkuaXMoJ29wdGdyb3VwJykgJiYgJHRoaXMuZGF0YSgnZGl2aWRlcicpICE9PSB0cnVlKSB7XG5cdFx0XHRcdFx0aWYgKCR0aGlzLmluZGV4KCkgPT09IDApIHsgLy8gSXMgaXQgdGhlIGZpcnN0IG9wdGlvbiBvZiB0aGUgb3B0Z3JvdXA/XG5cdFx0XHRcdFx0XHRvcHRJRCArPSAxO1xuXG5cdFx0XHRcdFx0XHQvLyBHZXQgdGhlIG9wdCBncm91cCBsYWJlbFxuXHRcdFx0XHRcdFx0dmFyIGxhYmVsID0gJHRoaXMucGFyZW50KCkuYXR0cignbGFiZWwnKTtcblx0XHRcdFx0XHRcdHZhciBsYWJlbFN1YnRleHQgPSB0eXBlb2YgJHRoaXMucGFyZW50KCkuZGF0YSgnc3VidGV4dCcpICE9PSAndW5kZWZpbmVkJyA/ICc8c21hbGwgY2xhc3M9XCJtdXRlZCB0ZXh0LW11dGVkXCI+JyArICR0aGlzLnBhcmVudCgpLmRhdGEoJ3N1YnRleHQnKSArICc8L3NtYWxsPicgOiAnJztcblx0XHRcdFx0XHRcdHZhciBsYWJlbEljb24gPSAkdGhpcy5wYXJlbnQoKS5kYXRhKCdpY29uJykgPyAnPHNwYW4gY2xhc3M9XCInICsgdGhhdC5vcHRpb25zLmljb25CYXNlICsgJyAnICsgJHRoaXMucGFyZW50KCkuZGF0YSgnaWNvbicpICsgJ1wiPjwvc3Bhbj4gJyA6ICcnO1xuXHRcdFx0XHRcdFx0bGFiZWwgPSBsYWJlbEljb24gKyAnPHNwYW4gY2xhc3M9XCJ0ZXh0XCI+JyArIGxhYmVsICsgbGFiZWxTdWJ0ZXh0ICsgJzwvc3Bhbj4nO1xuXG5cdFx0XHRcdFx0XHRpZiAoaW5kZXggIT09IDAgJiYgX2xpLmxlbmd0aCA+IDApIHsgLy8gSXMgaXQgTk9UIHRoZSBmaXJzdCBvcHRpb24gb2YgdGhlIHNlbGVjdCAmJiBhcmUgdGhlcmUgZWxlbWVudHMgaW4gdGhlIGRyb3Bkb3duP1xuXHRcdFx0XHRcdFx0XHRfbGkucHVzaChnZW5lcmF0ZUxJKCcnLCBudWxsLCAnZGl2aWRlcicpKTtcblx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0X2xpLnB1c2goZ2VuZXJhdGVMSShsYWJlbCwgbnVsbCwgJ2Ryb3Bkb3duLWhlYWRlcicpKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRfbGkucHVzaChnZW5lcmF0ZUxJKGdlbmVyYXRlQSh0ZXh0LCAnb3B0ICcgKyBvcHRpb25DbGFzcywgaW5saW5lLCBvcHRJRCksIGluZGV4KSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoJHRoaXMuZGF0YSgnZGl2aWRlcicpID09PSB0cnVlKSB7XG5cdFx0XHRcdFx0X2xpLnB1c2goZ2VuZXJhdGVMSSgnJywgaW5kZXgsICdkaXZpZGVyJykpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCR0aGlzLmRhdGEoJ2hpZGRlbicpID09PSB0cnVlKSB7XG5cdFx0XHRcdFx0X2xpLnB1c2goZ2VuZXJhdGVMSShnZW5lcmF0ZUEodGV4dCwgb3B0aW9uQ2xhc3MsIGlubGluZSksIGluZGV4LCAnaGlkZSBpcy1oaWRkZW4nKSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0X2xpLnB1c2goZ2VuZXJhdGVMSShnZW5lcmF0ZUEodGV4dCwgb3B0aW9uQ2xhc3MsIGlubGluZSksIGluZGV4KSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHQvL0lmIHdlIGFyZSBub3QgbXVsdGlwbGUsIHdlIGRvbid0IGhhdmUgYSBzZWxlY3RlZCBpdGVtLCBhbmQgd2UgZG9uJ3QgaGF2ZSBhIHRpdGxlLCBzZWxlY3QgdGhlIGZpcnN0IGVsZW1lbnQgc28gc29tZXRoaW5nIGlzIHNldCBpbiB0aGUgYnV0dG9uXG5cdFx0XHRpZiAoIXRoaXMubXVsdGlwbGUgJiYgdGhpcy4kZWxlbWVudC5maW5kKCdvcHRpb246c2VsZWN0ZWQnKS5sZW5ndGggPT09IDAgJiYgIXRoaXMub3B0aW9ucy50aXRsZSkge1xuXHRcdFx0XHR0aGlzLiRlbGVtZW50LmZpbmQoJ29wdGlvbicpLmVxKDApLnByb3AoJ3NlbGVjdGVkJywgdHJ1ZSkuYXR0cignc2VsZWN0ZWQnLCAnc2VsZWN0ZWQnKTtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuICQoX2xpLmpvaW4oJycpKTtcblx0XHR9LFxuXG5cdFx0ZmluZExpczogZnVuY3Rpb24oKSB7XG5cdFx0XHRpZiAodGhpcy4kbGlzID09IG51bGwpIHRoaXMuJGxpcyA9IHRoaXMuJG1lbnUuZmluZCgnbGknKTtcblx0XHRcdHJldHVybiB0aGlzLiRsaXM7XG5cdFx0fSxcblxuXHRcdC8qKlxuXHRcdCAqIEBwYXJhbSBbdXBkYXRlTGldIGRlZmF1bHRzIHRvIHRydWVcblx0XHQgKi9cblx0XHRyZW5kZXI6IGZ1bmN0aW9uKHVwZGF0ZUxpKSB7XG5cdFx0XHR2YXIgdGhhdCA9IHRoaXM7XG5cblx0XHRcdC8vVXBkYXRlIHRoZSBMSSB0byBtYXRjaCB0aGUgU0VMRUNUXG5cdFx0XHRpZiAodXBkYXRlTGkgIT09IGZhbHNlKSB7XG5cdFx0XHRcdHRoaXMuJGVsZW1lbnQuZmluZCgnb3B0aW9uJykuZWFjaChmdW5jdGlvbihpbmRleCkge1xuXHRcdFx0XHRcdHRoYXQuc2V0RGlzYWJsZWQoaW5kZXgsICQodGhpcykuaXMoJzpkaXNhYmxlZCcpIHx8ICQodGhpcykucGFyZW50KCkuaXMoJzpkaXNhYmxlZCcpKTtcblx0XHRcdFx0XHR0aGF0LnNldFNlbGVjdGVkKGluZGV4LCAkKHRoaXMpLmlzKCc6c2VsZWN0ZWQnKSk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLnRhYkluZGV4KCk7XG5cdFx0XHR2YXIgbm90RGlzYWJsZWQgPSB0aGlzLm9wdGlvbnMuaGlkZURpc2FibGVkID8gJzpub3QoW2Rpc2FibGVkXSknIDogJyc7XG5cdFx0XHR2YXIgc2VsZWN0ZWRJdGVtcyA9IHRoaXMuJGVsZW1lbnQuZmluZCgnb3B0aW9uOnNlbGVjdGVkJyArIG5vdERpc2FibGVkKS5tYXAoZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHZhciAkdGhpcyA9ICQodGhpcyk7XG5cdFx0XHRcdHZhciBpY29uID0gJHRoaXMuZGF0YSgnaWNvbicpICYmIHRoYXQub3B0aW9ucy5zaG93SWNvbiA/ICc8aSBjbGFzcz1cIicgKyB0aGF0Lm9wdGlvbnMuaWNvbkJhc2UgKyAnICcgKyAkdGhpcy5kYXRhKCdpY29uJykgKyAnXCI+PC9pPiAnIDogJyc7XG5cdFx0XHRcdHZhciBzdWJ0ZXh0O1xuXHRcdFx0XHRpZiAodGhhdC5vcHRpb25zLnNob3dTdWJ0ZXh0ICYmICR0aGlzLmF0dHIoJ2RhdGEtc3VidGV4dCcpICYmICF0aGF0Lm11bHRpcGxlKSB7XG5cdFx0XHRcdFx0c3VidGV4dCA9ICcgPHNtYWxsIGNsYXNzPVwibXV0ZWQgdGV4dC1tdXRlZFwiPicgKyAkdGhpcy5kYXRhKCdzdWJ0ZXh0JykgKyAnPC9zbWFsbD4nO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHN1YnRleHQgPSAnJztcblx0XHRcdFx0fVxuXHRcdFx0XHRpZiAoJHRoaXMuZGF0YSgnY29udGVudCcpICYmIHRoYXQub3B0aW9ucy5zaG93Q29udGVudCkge1xuXHRcdFx0XHRcdHJldHVybiAkdGhpcy5kYXRhKCdjb250ZW50Jyk7XG5cdFx0XHRcdH0gZWxzZSBpZiAodHlwZW9mICR0aGlzLmF0dHIoJ3RpdGxlJykgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRcdFx0cmV0dXJuICR0aGlzLmF0dHIoJ3RpdGxlJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0cmV0dXJuIGljb24gKyAkdGhpcy5odG1sKCkgKyBzdWJ0ZXh0O1xuXHRcdFx0XHR9XG5cdFx0XHR9KS50b0FycmF5KCk7XG5cblx0XHRcdC8vRml4ZXMgaXNzdWUgaW4gSUUxMCBvY2N1cnJpbmcgd2hlbiBubyBkZWZhdWx0IG9wdGlvbiBpcyBzZWxlY3RlZCBhbmQgYXQgbGVhc3Qgb25lIG9wdGlvbiBpcyBkaXNhYmxlZFxuXHRcdFx0Ly9Db252ZXJ0IGFsbCB0aGUgdmFsdWVzIGludG8gYSBjb21tYSBkZWxpbWl0ZWQgc3RyaW5nXG5cdFx0XHR2YXIgdGl0bGUgPSAhdGhpcy5tdWx0aXBsZSA/IHNlbGVjdGVkSXRlbXNbMF0gOiBzZWxlY3RlZEl0ZW1zLmpvaW4odGhpcy5vcHRpb25zLm11bHRpcGxlU2VwYXJhdG9yKTtcblxuXHRcdFx0Ly9JZiB0aGlzIGlzIG11bHRpIHNlbGVjdCwgYW5kIHRoZSBzZWxlY3RUZXh0IHR5cGUgaXMgY291bnQsIHRoZSBzaG93IDEgb2YgMiBzZWxlY3RlZCBldGMuLlxuXHRcdFx0aWYgKHRoaXMubXVsdGlwbGUgJiYgdGhpcy5vcHRpb25zLnNlbGVjdGVkVGV4dEZvcm1hdC5pbmRleE9mKCdjb3VudCcpID4gLTEpIHtcblx0XHRcdFx0dmFyIG1heCA9IHRoaXMub3B0aW9ucy5zZWxlY3RlZFRleHRGb3JtYXQuc3BsaXQoJz4nKTtcblx0XHRcdFx0aWYgKChtYXgubGVuZ3RoID4gMSAmJiBzZWxlY3RlZEl0ZW1zLmxlbmd0aCA+IG1heFsxXSkgfHwgKG1heC5sZW5ndGggPT0gMSAmJiBzZWxlY3RlZEl0ZW1zLmxlbmd0aCA+PSAyKSkge1xuXHRcdFx0XHRcdG5vdERpc2FibGVkID0gdGhpcy5vcHRpb25zLmhpZGVEaXNhYmxlZCA/ICcsIFtkaXNhYmxlZF0nIDogJyc7XG5cdFx0XHRcdFx0dmFyIHRvdGFsQ291bnQgPSB0aGlzLiRlbGVtZW50LmZpbmQoJ29wdGlvbicpLm5vdCgnW2RhdGEtZGl2aWRlcj1cInRydWVcIl0sIFtkYXRhLWhpZGRlbj1cInRydWVcIl0nICsgbm90RGlzYWJsZWQpLmxlbmd0aCxcblx0XHRcdFx0XHRcdHRyOG5UZXh0ID0gKHR5cGVvZiB0aGlzLm9wdGlvbnMuY291bnRTZWxlY3RlZFRleHQgPT09ICdmdW5jdGlvbicpID8gdGhpcy5vcHRpb25zLmNvdW50U2VsZWN0ZWRUZXh0KHNlbGVjdGVkSXRlbXMubGVuZ3RoLCB0b3RhbENvdW50KSA6IHRoaXMub3B0aW9ucy5jb3VudFNlbGVjdGVkVGV4dDtcblx0XHRcdFx0XHR0aXRsZSA9IHRyOG5UZXh0LnJlcGxhY2UoJ3swfScsIHNlbGVjdGVkSXRlbXMubGVuZ3RoLnRvU3RyaW5nKCkpLnJlcGxhY2UoJ3sxfScsIHRvdGFsQ291bnQudG9TdHJpbmcoKSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0dGhpcy5vcHRpb25zLnRpdGxlID0gdGhpcy4kZWxlbWVudC5hdHRyKCd0aXRsZScpO1xuXG5cdFx0XHRpZiAodGhpcy5vcHRpb25zLnNlbGVjdGVkVGV4dEZvcm1hdCA9PSAnc3RhdGljJykge1xuXHRcdFx0XHR0aXRsZSA9IHRoaXMub3B0aW9ucy50aXRsZTtcblx0XHRcdH1cblxuXHRcdFx0Ly9JZiB3ZSBkb250IGhhdmUgYSB0aXRsZSwgdGhlbiB1c2UgdGhlIGRlZmF1bHQsIG9yIGlmIG5vdGhpbmcgaXMgc2V0IGF0IGFsbCwgdXNlIHRoZSBub3Qgc2VsZWN0ZWQgdGV4dFxuXHRcdFx0aWYgKCF0aXRsZSkge1xuXHRcdFx0XHR0aXRsZSA9IHR5cGVvZiB0aGlzLm9wdGlvbnMudGl0bGUgIT09ICd1bmRlZmluZWQnID8gdGhpcy5vcHRpb25zLnRpdGxlIDogdGhpcy5vcHRpb25zLm5vbmVTZWxlY3RlZFRleHQ7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuJGJ1dHRvbi5hdHRyKCd0aXRsZScsICQudHJpbSgkKFwiPGRpdi8+XCIpLmh0bWwodGl0bGUpLnRleHQoKSkucmVwbGFjZSgvXFxzXFxzKy9nLCAnICcpKTtcblx0XHRcdHRoaXMuJG5ld0VsZW1lbnQuZmluZCgnLmZpbHRlci1vcHRpb24nKS5odG1sKHRpdGxlKTtcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogQHBhcmFtIFtzdHlsZV1cblx0XHQgKiBAcGFyYW0gW3N0YXR1c11cblx0XHQgKi9cblx0XHRzZXRTdHlsZTogZnVuY3Rpb24oc3R5bGUsIHN0YXR1cykge1xuXHRcdFx0aWYgKHRoaXMuJGVsZW1lbnQuYXR0cignY2xhc3MnKSkge1xuXHRcdFx0XHR0aGlzLiRuZXdFbGVtZW50LmFkZENsYXNzKHRoaXMuJGVsZW1lbnQuYXR0cignY2xhc3MnKS5yZXBsYWNlKC9zZWxlY3RwaWNrZXJ8bW9iaWxlLWRldmljZXx2YWxpZGF0ZVxcWy4qXFxdL2dpLCAnJykpO1xuXHRcdFx0fVxuXG5cdFx0XHR2YXIgYnV0dG9uQ2xhc3MgPSBzdHlsZSA/IHN0eWxlIDogdGhpcy5vcHRpb25zLnN0eWxlO1xuXG5cdFx0XHRpZiAoc3RhdHVzID09ICdhZGQnKSB7XG5cdFx0XHRcdHRoaXMuJGJ1dHRvbi5hZGRDbGFzcyhidXR0b25DbGFzcyk7XG5cdFx0XHR9IGVsc2UgaWYgKHN0YXR1cyA9PSAncmVtb3ZlJykge1xuXHRcdFx0XHR0aGlzLiRidXR0b24ucmVtb3ZlQ2xhc3MoYnV0dG9uQ2xhc3MpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy4kYnV0dG9uLnJlbW92ZUNsYXNzKHRoaXMub3B0aW9ucy5zdHlsZSk7XG5cdFx0XHRcdHRoaXMuJGJ1dHRvbi5hZGRDbGFzcyhidXR0b25DbGFzcyk7XG5cdFx0XHR9XG5cdFx0fSxcblxuXHRcdGxpSGVpZ2h0OiBmdW5jdGlvbigpIHtcblx0XHRcdGlmICh0aGlzLm9wdGlvbnMuc2l6ZSA9PT0gZmFsc2UpIHJldHVybjtcblxuXHRcdFx0dmFyICRzZWxlY3RDbG9uZSA9IHRoaXMuJG1lbnUucGFyZW50KCkuY2xvbmUoKS5maW5kKCc+IC5kcm9wZG93bi10b2dnbGUnKS5wcm9wKCdhdXRvZm9jdXMnLCBmYWxzZSkuZW5kKCkuYXBwZW5kVG8oJ2JvZHknKSxcblx0XHRcdFx0JG1lbnVDbG9uZSA9ICRzZWxlY3RDbG9uZS5hZGRDbGFzcygnb3BlbicpLmZpbmQoJz4gLmRyb3Bkb3duLW1lbnUnKSxcblx0XHRcdFx0bGlIZWlnaHQgPSAkbWVudUNsb25lLmZpbmQoJ2xpJykubm90KCcuZGl2aWRlcicpLm5vdCgnLmRyb3Bkb3duLWhlYWRlcicpLmZpbHRlcignOnZpc2libGUnKS5jaGlsZHJlbignYScpLm91dGVySGVpZ2h0KCksXG5cdFx0XHRcdGhlYWRlckhlaWdodCA9IHRoaXMub3B0aW9ucy5oZWFkZXIgPyAkbWVudUNsb25lLmZpbmQoJy5wb3BvdmVyLXRpdGxlJykub3V0ZXJIZWlnaHQoKSA6IDAsXG5cdFx0XHRcdHNlYXJjaEhlaWdodCA9IHRoaXMub3B0aW9ucy5saXZlU2VhcmNoID8gJG1lbnVDbG9uZS5maW5kKCcuYnMtc2VhcmNoYm94Jykub3V0ZXJIZWlnaHQoKSA6IDAsXG5cdFx0XHRcdGFjdGlvbnNIZWlnaHQgPSB0aGlzLm9wdGlvbnMuYWN0aW9uc0JveCA/ICRtZW51Q2xvbmUuZmluZCgnLmJzLWFjdGlvbnNib3gnKS5vdXRlckhlaWdodCgpIDogMDtcblxuXHRcdFx0JHNlbGVjdENsb25lLnJlbW92ZSgpO1xuXG5cdFx0XHR0aGlzLiRuZXdFbGVtZW50XG5cdFx0XHRcdC5kYXRhKCdsaUhlaWdodCcsIGxpSGVpZ2h0KVxuXHRcdFx0XHQuZGF0YSgnaGVhZGVySGVpZ2h0JywgaGVhZGVySGVpZ2h0KVxuXHRcdFx0XHQuZGF0YSgnc2VhcmNoSGVpZ2h0Jywgc2VhcmNoSGVpZ2h0KVxuXHRcdFx0XHQuZGF0YSgnYWN0aW9uc0hlaWdodCcsIGFjdGlvbnNIZWlnaHQpO1xuXHRcdH0sXG5cblx0XHRzZXRTaXplOiBmdW5jdGlvbigpIHtcblx0XHRcdHRoaXMuZmluZExpcygpO1xuXHRcdFx0dmFyIHRoYXQgPSB0aGlzLFxuXHRcdFx0XHRtZW51ID0gdGhpcy4kbWVudSxcblx0XHRcdFx0bWVudUlubmVyID0gbWVudS5maW5kKCcuaW5uZXInKSxcblx0XHRcdFx0c2VsZWN0SGVpZ2h0ID0gdGhpcy4kbmV3RWxlbWVudC5vdXRlckhlaWdodCgpLFxuXHRcdFx0XHRsaUhlaWdodCA9IHRoaXMuJG5ld0VsZW1lbnQuZGF0YSgnbGlIZWlnaHQnKSxcblx0XHRcdFx0aGVhZGVySGVpZ2h0ID0gdGhpcy4kbmV3RWxlbWVudC5kYXRhKCdoZWFkZXJIZWlnaHQnKSxcblx0XHRcdFx0c2VhcmNoSGVpZ2h0ID0gdGhpcy4kbmV3RWxlbWVudC5kYXRhKCdzZWFyY2hIZWlnaHQnKSxcblx0XHRcdFx0YWN0aW9uc0hlaWdodCA9IHRoaXMuJG5ld0VsZW1lbnQuZGF0YSgnYWN0aW9uc0hlaWdodCcpLFxuXHRcdFx0XHRkaXZIZWlnaHQgPSB0aGlzLiRsaXMuZmlsdGVyKCcuZGl2aWRlcicpLm91dGVySGVpZ2h0KHRydWUpLFxuXHRcdFx0XHRtZW51UGFkZGluZyA9IHBhcnNlSW50KG1lbnUuY3NzKCdwYWRkaW5nLXRvcCcpKSArXG5cdFx0XHRcdHBhcnNlSW50KG1lbnUuY3NzKCdwYWRkaW5nLWJvdHRvbScpKSArXG5cdFx0XHRcdHBhcnNlSW50KG1lbnUuY3NzKCdib3JkZXItdG9wLXdpZHRoJykpICtcblx0XHRcdFx0cGFyc2VJbnQobWVudS5jc3MoJ2JvcmRlci1ib3R0b20td2lkdGgnKSksXG5cdFx0XHRcdG5vdERpc2FibGVkID0gdGhpcy5vcHRpb25zLmhpZGVEaXNhYmxlZCA/ICcsIC5kaXNhYmxlZCcgOiAnJyxcblx0XHRcdFx0JHdpbmRvdyA9ICQod2luZG93KSxcblx0XHRcdFx0bWVudUV4dHJhcyA9IG1lbnVQYWRkaW5nICsgcGFyc2VJbnQobWVudS5jc3MoJ21hcmdpbi10b3AnKSkgKyBwYXJzZUludChtZW51LmNzcygnbWFyZ2luLWJvdHRvbScpKSArIDIsXG5cdFx0XHRcdG1lbnVIZWlnaHQsXG5cdFx0XHRcdHNlbGVjdE9mZnNldFRvcCxcblx0XHRcdFx0c2VsZWN0T2Zmc2V0Qm90LFxuXHRcdFx0XHRwb3NWZXJ0ID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0Ly8gSlF1ZXJ5IGRlZmluZXMgYSBzY3JvbGxUb3AgZnVuY3Rpb24sIGJ1dCBpbiBwdXJlIEpTIGl0J3MgYSBwcm9wZXJ0eVxuXHRcdFx0XHRcdC8vbm9pbnNwZWN0aW9uIEpTVmFsaWRhdGVUeXBlc1xuXHRcdFx0XHRcdHNlbGVjdE9mZnNldFRvcCA9IHRoYXQuJG5ld0VsZW1lbnQub2Zmc2V0KCkudG9wIC0gJHdpbmRvdy5zY3JvbGxUb3AoKTtcblx0XHRcdFx0XHRzZWxlY3RPZmZzZXRCb3QgPSAkd2luZG93LmhlaWdodCgpIC0gc2VsZWN0T2Zmc2V0VG9wIC0gc2VsZWN0SGVpZ2h0O1xuXHRcdFx0XHR9O1xuXHRcdFx0cG9zVmVydCgpO1xuXHRcdFx0aWYgKHRoaXMub3B0aW9ucy5oZWFkZXIpIG1lbnUuY3NzKCdwYWRkaW5nLXRvcCcsIDApO1xuXG5cdFx0XHRpZiAodGhpcy5vcHRpb25zLnNpemUgPT0gJ2F1dG8nKSB7XG5cdFx0XHRcdHZhciBnZXRTaXplID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0dmFyIG1pbkhlaWdodCxcblx0XHRcdFx0XHRcdGxpc1ZpcyA9IHRoYXQuJGxpcy5ub3QoJy5oaWRlJyk7XG5cblx0XHRcdFx0XHRwb3NWZXJ0KCk7XG5cdFx0XHRcdFx0bWVudUhlaWdodCA9IHNlbGVjdE9mZnNldEJvdCAtIG1lbnVFeHRyYXM7XG5cblx0XHRcdFx0XHRpZiAodGhhdC5vcHRpb25zLmRyb3B1cEF1dG8pIHtcblx0XHRcdFx0XHRcdHRoYXQuJG5ld0VsZW1lbnQudG9nZ2xlQ2xhc3MoJ2Ryb3B1cCcsIChzZWxlY3RPZmZzZXRUb3AgPiBzZWxlY3RPZmZzZXRCb3QpICYmICgobWVudUhlaWdodCAtIG1lbnVFeHRyYXMpIDwgbWVudS5oZWlnaHQoKSkpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAodGhhdC4kbmV3RWxlbWVudC5oYXNDbGFzcygnZHJvcHVwJykpIHtcblx0XHRcdFx0XHRcdG1lbnVIZWlnaHQgPSBzZWxlY3RPZmZzZXRUb3AgLSBtZW51RXh0cmFzO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICgobGlzVmlzLmxlbmd0aCArIGxpc1Zpcy5maWx0ZXIoJy5kcm9wZG93bi1oZWFkZXInKS5sZW5ndGgpID4gMykge1xuXHRcdFx0XHRcdFx0bWluSGVpZ2h0ID0gbGlIZWlnaHQgKiAzICsgbWVudUV4dHJhcyAtIDI7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdG1pbkhlaWdodCA9IDA7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0bWVudS5jc3Moe1xuXHRcdFx0XHRcdFx0J21heC1oZWlnaHQnOiBtZW51SGVpZ2h0ICsgJ3B4Jyxcblx0XHRcdFx0XHRcdCdvdmVyZmxvdyc6ICdoaWRkZW4nLFxuXHRcdFx0XHRcdFx0J21pbi1oZWlnaHQnOiBtaW5IZWlnaHQgKyBoZWFkZXJIZWlnaHQgKyBzZWFyY2hIZWlnaHQgKyBhY3Rpb25zSGVpZ2h0ICsgJ3B4J1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdG1lbnVJbm5lci5jc3Moe1xuXHRcdFx0XHRcdFx0J21heC1oZWlnaHQnOiBtZW51SGVpZ2h0IC0gaGVhZGVySGVpZ2h0IC0gc2VhcmNoSGVpZ2h0IC0gYWN0aW9uc0hlaWdodCAtIG1lbnVQYWRkaW5nICsgJ3B4Jyxcblx0XHRcdFx0XHRcdCdvdmVyZmxvdy15JzogJ2F1dG8nLFxuXHRcdFx0XHRcdFx0J21pbi1oZWlnaHQnOiBNYXRoLm1heChtaW5IZWlnaHQgLSBtZW51UGFkZGluZywgMCkgKyAncHgnXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH07XG5cdFx0XHRcdGdldFNpemUoKTtcblx0XHRcdFx0dGhpcy4kc2VhcmNoYm94Lm9mZignaW5wdXQuZ2V0U2l6ZSBwcm9wZXJ0eWNoYW5nZS5nZXRTaXplJykub24oJ2lucHV0LmdldFNpemUgcHJvcGVydHljaGFuZ2UuZ2V0U2l6ZScsIGdldFNpemUpO1xuXHRcdFx0XHQkKHdpbmRvdykub2ZmKCdyZXNpemUuZ2V0U2l6ZScpLm9uKCdyZXNpemUuZ2V0U2l6ZScsIGdldFNpemUpO1xuXHRcdFx0XHQkKHdpbmRvdykub2ZmKCdzY3JvbGwuZ2V0U2l6ZScpLm9uKCdzY3JvbGwuZ2V0U2l6ZScsIGdldFNpemUpO1xuXHRcdFx0fSBlbHNlIGlmICh0aGlzLm9wdGlvbnMuc2l6ZSAmJiB0aGlzLm9wdGlvbnMuc2l6ZSAhPSAnYXV0bycgJiYgbWVudS5maW5kKCdsaScgKyBub3REaXNhYmxlZCkubGVuZ3RoID4gdGhpcy5vcHRpb25zLnNpemUpIHtcblx0XHRcdFx0dmFyIG9wdEluZGV4ID0gdGhpcy4kbGlzLm5vdCgnLmRpdmlkZXInICsgbm90RGlzYWJsZWQpLmZpbmQoJyA+IConKS5zbGljZSgwLCB0aGlzLm9wdGlvbnMuc2l6ZSkubGFzdCgpLnBhcmVudCgpLmluZGV4KCk7XG5cdFx0XHRcdHZhciBkaXZMZW5ndGggPSB0aGlzLiRsaXMuc2xpY2UoMCwgb3B0SW5kZXggKyAxKS5maWx0ZXIoJy5kaXZpZGVyJykubGVuZ3RoO1xuXHRcdFx0XHRtZW51SGVpZ2h0ID0gbGlIZWlnaHQgKiB0aGlzLm9wdGlvbnMuc2l6ZSArIGRpdkxlbmd0aCAqIGRpdkhlaWdodCArIG1lbnVQYWRkaW5nO1xuXHRcdFx0XHRpZiAodGhhdC5vcHRpb25zLmRyb3B1cEF1dG8pIHtcblx0XHRcdFx0XHQvL25vaW5zcGVjdGlvbiBKU1VudXNlZEFzc2lnbm1lbnRcblx0XHRcdFx0XHR0aGlzLiRuZXdFbGVtZW50LnRvZ2dsZUNsYXNzKCdkcm9wdXAnLCAoc2VsZWN0T2Zmc2V0VG9wID4gc2VsZWN0T2Zmc2V0Qm90KSAmJiAobWVudUhlaWdodCA8IG1lbnUuaGVpZ2h0KCkpKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRtZW51LmNzcyh7XG5cdFx0XHRcdFx0J21heC1oZWlnaHQnOiBtZW51SGVpZ2h0ICsgaGVhZGVySGVpZ2h0ICsgc2VhcmNoSGVpZ2h0ICsgYWN0aW9uc0hlaWdodCArICdweCcsXG5cdFx0XHRcdFx0J292ZXJmbG93JzogJ2hpZGRlbidcblx0XHRcdFx0fSk7XG5cdFx0XHRcdG1lbnVJbm5lci5jc3Moe1xuXHRcdFx0XHRcdCdtYXgtaGVpZ2h0JzogbWVudUhlaWdodCAtIG1lbnVQYWRkaW5nICsgJ3B4Jyxcblx0XHRcdFx0XHQnb3ZlcmZsb3cteSc6ICdhdXRvJ1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0c2V0V2lkdGg6IGZ1bmN0aW9uKCkge1xuXHRcdFx0aWYgKHRoaXMub3B0aW9ucy53aWR0aCA9PSAnYXV0bycpIHtcblx0XHRcdFx0dGhpcy4kbWVudS5jc3MoJ21pbi13aWR0aCcsICcwJyk7XG5cblx0XHRcdFx0Ly8gR2V0IGNvcnJlY3Qgd2lkdGggaWYgZWxlbWVudCBoaWRkZW5cblx0XHRcdFx0dmFyIHNlbGVjdENsb25lID0gdGhpcy4kbmV3RWxlbWVudC5jbG9uZSgpLmFwcGVuZFRvKCdib2R5Jyk7XG5cdFx0XHRcdHZhciB1bFdpZHRoID0gc2VsZWN0Q2xvbmUuZmluZCgnPiAuZHJvcGRvd24tbWVudScpLmNzcygnd2lkdGgnKTtcblx0XHRcdFx0dmFyIGJ0bldpZHRoID0gc2VsZWN0Q2xvbmUuY3NzKCd3aWR0aCcsICdhdXRvJykuZmluZCgnPiBidXR0b24nKS5jc3MoJ3dpZHRoJyk7XG5cdFx0XHRcdHNlbGVjdENsb25lLnJlbW92ZSgpO1xuXG5cdFx0XHRcdC8vIFNldCB3aWR0aCB0byB3aGF0ZXZlcidzIGxhcmdlciwgYnV0dG9uIHRpdGxlIG9yIGxvbmdlc3Qgb3B0aW9uXG5cdFx0XHRcdHRoaXMuJG5ld0VsZW1lbnQuY3NzKCd3aWR0aCcsIE1hdGgubWF4KHBhcnNlSW50KHVsV2lkdGgpLCBwYXJzZUludChidG5XaWR0aCkpICsgJ3B4Jyk7XG5cdFx0XHR9IGVsc2UgaWYgKHRoaXMub3B0aW9ucy53aWR0aCA9PSAnZml0Jykge1xuXHRcdFx0XHQvLyBSZW1vdmUgaW5saW5lIG1pbi13aWR0aCBzbyB3aWR0aCBjYW4gYmUgY2hhbmdlZCBmcm9tICdhdXRvJ1xuXHRcdFx0XHR0aGlzLiRtZW51LmNzcygnbWluLXdpZHRoJywgJycpO1xuXHRcdFx0XHR0aGlzLiRuZXdFbGVtZW50LmNzcygnd2lkdGgnLCAnJykuYWRkQ2xhc3MoJ2ZpdC13aWR0aCcpO1xuXHRcdFx0fSBlbHNlIGlmICh0aGlzLm9wdGlvbnMud2lkdGgpIHtcblx0XHRcdFx0Ly8gUmVtb3ZlIGlubGluZSBtaW4td2lkdGggc28gd2lkdGggY2FuIGJlIGNoYW5nZWQgZnJvbSAnYXV0bydcblx0XHRcdFx0dGhpcy4kbWVudS5jc3MoJ21pbi13aWR0aCcsICcnKTtcblx0XHRcdFx0dGhpcy4kbmV3RWxlbWVudC5jc3MoJ3dpZHRoJywgdGhpcy5vcHRpb25zLndpZHRoKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdC8vIFJlbW92ZSBpbmxpbmUgbWluLXdpZHRoL3dpZHRoIHNvIHdpZHRoIGNhbiBiZSBjaGFuZ2VkXG5cdFx0XHRcdHRoaXMuJG1lbnUuY3NzKCdtaW4td2lkdGgnLCAnJyk7XG5cdFx0XHRcdHRoaXMuJG5ld0VsZW1lbnQuY3NzKCd3aWR0aCcsICcnKTtcblx0XHRcdH1cblx0XHRcdC8vIFJlbW92ZSBmaXQtd2lkdGggY2xhc3MgaWYgd2lkdGggaXMgY2hhbmdlZCBwcm9ncmFtbWF0aWNhbGx5XG5cdFx0XHRpZiAodGhpcy4kbmV3RWxlbWVudC5oYXNDbGFzcygnZml0LXdpZHRoJykgJiYgdGhpcy5vcHRpb25zLndpZHRoICE9PSAnZml0Jykge1xuXHRcdFx0XHR0aGlzLiRuZXdFbGVtZW50LnJlbW92ZUNsYXNzKCdmaXQtd2lkdGgnKTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0c2VsZWN0UG9zaXRpb246IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHRoYXQgPSB0aGlzLFxuXHRcdFx0XHRkcm9wID0gJzxkaXYgLz4nLFxuXHRcdFx0XHQkZHJvcCA9ICQoZHJvcCksXG5cdFx0XHRcdHBvcyxcblx0XHRcdFx0YWN0dWFsSGVpZ2h0LFxuXHRcdFx0XHRnZXRQbGFjZW1lbnQgPSBmdW5jdGlvbigkZWxlbWVudCkge1xuXHRcdFx0XHRcdCRkcm9wLmFkZENsYXNzKCRlbGVtZW50LmF0dHIoJ2NsYXNzJykucmVwbGFjZSgvZm9ybS1jb250cm9sL2dpLCAnJykpLnRvZ2dsZUNsYXNzKCdkcm9wdXAnLCAkZWxlbWVudC5oYXNDbGFzcygnZHJvcHVwJykpO1xuXHRcdFx0XHRcdHBvcyA9ICRlbGVtZW50Lm9mZnNldCgpO1xuXHRcdFx0XHRcdGFjdHVhbEhlaWdodCA9ICRlbGVtZW50Lmhhc0NsYXNzKCdkcm9wdXAnKSA/IDAgOiAkZWxlbWVudFswXS5vZmZzZXRIZWlnaHQ7XG5cdFx0XHRcdFx0JGRyb3AuY3NzKHtcblx0XHRcdFx0XHRcdCd0b3AnOiBwb3MudG9wICsgYWN0dWFsSGVpZ2h0LFxuXHRcdFx0XHRcdFx0J2xlZnQnOiBwb3MubGVmdCxcblx0XHRcdFx0XHRcdCd3aWR0aCc6ICRlbGVtZW50WzBdLm9mZnNldFdpZHRoLFxuXHRcdFx0XHRcdFx0J3Bvc2l0aW9uJzogJ2Fic29sdXRlJ1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9O1xuXHRcdFx0dGhpcy4kbmV3RWxlbWVudC5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0aWYgKHRoYXQuaXNEaXNhYmxlZCgpKSB7XG5cdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGdldFBsYWNlbWVudCgkKHRoaXMpKTtcblx0XHRcdFx0JGRyb3AuYXBwZW5kVG8odGhhdC5vcHRpb25zLmNvbnRhaW5lcik7XG5cdFx0XHRcdCRkcm9wLnRvZ2dsZUNsYXNzKCdvcGVuJywgISQodGhpcykuaGFzQ2xhc3MoJ29wZW4nKSk7XG5cdFx0XHRcdCRkcm9wLmFwcGVuZCh0aGF0LiRtZW51KTtcblx0XHRcdH0pO1xuXHRcdFx0JCh3aW5kb3cpLnJlc2l6ZShmdW5jdGlvbigpIHtcblx0XHRcdFx0Z2V0UGxhY2VtZW50KHRoYXQuJG5ld0VsZW1lbnQpO1xuXHRcdFx0fSk7XG5cdFx0XHQkKHdpbmRvdykub24oJ3Njcm9sbCcsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRnZXRQbGFjZW1lbnQodGhhdC4kbmV3RWxlbWVudCk7XG5cdFx0XHR9KTtcblx0XHRcdCQoJ2h0bWwnKS5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdGlmICgkKGUudGFyZ2V0KS5jbG9zZXN0KHRoYXQuJG5ld0VsZW1lbnQpLmxlbmd0aCA8IDEpIHtcblx0XHRcdFx0XHQkZHJvcC5yZW1vdmVDbGFzcygnb3BlbicpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9LFxuXG5cdFx0c2V0U2VsZWN0ZWQ6IGZ1bmN0aW9uKGluZGV4LCBzZWxlY3RlZCkge1xuXHRcdFx0dGhpcy5maW5kTGlzKCk7XG5cdFx0XHR0aGlzLiRsaXMuZmlsdGVyKCdbZGF0YS1vcmlnaW5hbC1pbmRleD1cIicgKyBpbmRleCArICdcIl0nKS50b2dnbGVDbGFzcygnc2VsZWN0ZWQnLCBzZWxlY3RlZCk7XG5cdFx0fSxcblxuXHRcdHNldERpc2FibGVkOiBmdW5jdGlvbihpbmRleCwgZGlzYWJsZWQpIHtcblx0XHRcdHRoaXMuZmluZExpcygpO1xuXHRcdFx0aWYgKGRpc2FibGVkKSB7XG5cdFx0XHRcdHRoaXMuJGxpcy5maWx0ZXIoJ1tkYXRhLW9yaWdpbmFsLWluZGV4PVwiJyArIGluZGV4ICsgJ1wiXScpLmFkZENsYXNzKCdkaXNhYmxlZCcpLmZpbmQoJ2EnKS5hdHRyKCdocmVmJywgJyMnKS5hdHRyKCd0YWJpbmRleCcsIC0xKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMuJGxpcy5maWx0ZXIoJ1tkYXRhLW9yaWdpbmFsLWluZGV4PVwiJyArIGluZGV4ICsgJ1wiXScpLnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpLmZpbmQoJ2EnKS5yZW1vdmVBdHRyKCdocmVmJykuYXR0cigndGFiaW5kZXgnLCAwKTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0aXNEaXNhYmxlZDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy4kZWxlbWVudC5pcygnOmRpc2FibGVkJyk7XG5cdFx0fSxcblxuXHRcdGNoZWNrRGlzYWJsZWQ6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHRoYXQgPSB0aGlzO1xuXG5cdFx0XHRpZiAodGhpcy5pc0Rpc2FibGVkKCkpIHtcblx0XHRcdFx0dGhpcy4kYnV0dG9uLmFkZENsYXNzKCdkaXNhYmxlZCcpLmF0dHIoJ3RhYmluZGV4JywgLTEpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0aWYgKHRoaXMuJGJ1dHRvbi5oYXNDbGFzcygnZGlzYWJsZWQnKSkge1xuXHRcdFx0XHRcdHRoaXMuJGJ1dHRvbi5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0aGlzLiRidXR0b24uYXR0cigndGFiaW5kZXgnKSA9PSAtMSkge1xuXHRcdFx0XHRcdGlmICghdGhpcy4kZWxlbWVudC5kYXRhKCd0YWJpbmRleCcpKSB0aGlzLiRidXR0b24ucmVtb3ZlQXR0cigndGFiaW5kZXgnKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLiRidXR0b24uY2xpY2soZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHJldHVybiAhdGhhdC5pc0Rpc2FibGVkKCk7XG5cdFx0XHR9KTtcblx0XHR9LFxuXG5cdFx0dGFiSW5kZXg6IGZ1bmN0aW9uKCkge1xuXHRcdFx0aWYgKHRoaXMuJGVsZW1lbnQuaXMoJ1t0YWJpbmRleF0nKSkge1xuXHRcdFx0XHR0aGlzLiRlbGVtZW50LmRhdGEoJ3RhYmluZGV4JywgdGhpcy4kZWxlbWVudC5hdHRyKCd0YWJpbmRleCcpKTtcblx0XHRcdFx0dGhpcy4kYnV0dG9uLmF0dHIoJ3RhYmluZGV4JywgdGhpcy4kZWxlbWVudC5kYXRhKCd0YWJpbmRleCcpKTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0Y2xpY2tMaXN0ZW5lcjogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgdGhhdCA9IHRoaXM7XG5cblx0XHRcdHRoaXMuJG5ld0VsZW1lbnQub24oJ3RvdWNoc3RhcnQuZHJvcGRvd24nLCAnLmRyb3Bkb3duLW1lbnUnLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy4kbmV3RWxlbWVudC5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0dGhhdC5zZXRTaXplKCk7XG5cdFx0XHRcdGlmICghdGhhdC5vcHRpb25zLmxpdmVTZWFyY2ggJiYgIXRoYXQubXVsdGlwbGUpIHtcblx0XHRcdFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0dGhhdC4kbWVudS5maW5kKCcuc2VsZWN0ZWQgYScpLmZvY3VzKCk7XG5cdFx0XHRcdFx0fSwgMTApO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy4kbWVudS5vbignY2xpY2snLCAnbGkgYScsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0dmFyICR0aGlzID0gJCh0aGlzKSxcblx0XHRcdFx0XHRjbGlja2VkSW5kZXggPSAkdGhpcy5wYXJlbnQoKS5kYXRhKCdvcmlnaW5hbEluZGV4JyksXG5cdFx0XHRcdFx0cHJldlZhbHVlID0gdGhhdC4kZWxlbWVudC52YWwoKSxcblx0XHRcdFx0XHRwcmV2SW5kZXggPSB0aGF0LiRlbGVtZW50LnByb3AoJ3NlbGVjdGVkSW5kZXgnKTtcblxuXHRcdFx0XHQvLyBEb24ndCBjbG9zZSBvbiBtdWx0aSBjaG9pY2UgbWVudVxuXHRcdFx0XHRpZiAodGhhdC5tdWx0aXBsZSkge1xuXHRcdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cblx0XHRcdFx0Ly9Eb24ndCBydW4gaWYgd2UgaGF2ZSBiZWVuIGRpc2FibGVkXG5cdFx0XHRcdGlmICghdGhhdC5pc0Rpc2FibGVkKCkgJiYgISR0aGlzLnBhcmVudCgpLmhhc0NsYXNzKCdkaXNhYmxlZCcpKSB7XG5cdFx0XHRcdFx0dmFyICRvcHRpb25zID0gdGhhdC4kZWxlbWVudC5maW5kKCdvcHRpb24nKSxcblx0XHRcdFx0XHRcdCRvcHRpb24gPSAkb3B0aW9ucy5lcShjbGlja2VkSW5kZXgpLFxuXHRcdFx0XHRcdFx0c3RhdGUgPSAkb3B0aW9uLnByb3AoJ3NlbGVjdGVkJyksXG5cdFx0XHRcdFx0XHQkb3B0Z3JvdXAgPSAkb3B0aW9uLnBhcmVudCgnb3B0Z3JvdXAnKSxcblx0XHRcdFx0XHRcdG1heE9wdGlvbnMgPSB0aGF0Lm9wdGlvbnMubWF4T3B0aW9ucyxcblx0XHRcdFx0XHRcdG1heE9wdGlvbnNHcnAgPSAkb3B0Z3JvdXAuZGF0YSgnbWF4T3B0aW9ucycpIHx8IGZhbHNlO1xuXG5cdFx0XHRcdFx0aWYgKCF0aGF0Lm11bHRpcGxlKSB7IC8vIERlc2VsZWN0IGFsbCBvdGhlcnMgaWYgbm90IG11bHRpIHNlbGVjdCBib3hcblx0XHRcdFx0XHRcdCRvcHRpb25zLnByb3AoJ3NlbGVjdGVkJywgZmFsc2UpO1xuXHRcdFx0XHRcdFx0JG9wdGlvbi5wcm9wKCdzZWxlY3RlZCcsIHRydWUpO1xuXHRcdFx0XHRcdFx0dGhhdC4kbWVudS5maW5kKCcuc2VsZWN0ZWQnKS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcblx0XHRcdFx0XHRcdHRoYXQuc2V0U2VsZWN0ZWQoY2xpY2tlZEluZGV4LCB0cnVlKTtcblx0XHRcdFx0XHR9IGVsc2UgeyAvLyBUb2dnbGUgdGhlIG9uZSB3ZSBoYXZlIGNob3NlbiBpZiB3ZSBhcmUgbXVsdGkgc2VsZWN0LlxuXHRcdFx0XHRcdFx0JG9wdGlvbi5wcm9wKCdzZWxlY3RlZCcsICFzdGF0ZSk7XG5cdFx0XHRcdFx0XHR0aGF0LnNldFNlbGVjdGVkKGNsaWNrZWRJbmRleCwgIXN0YXRlKTtcblx0XHRcdFx0XHRcdCR0aGlzLmJsdXIoKTtcblxuXHRcdFx0XHRcdFx0aWYgKChtYXhPcHRpb25zICE9PSBmYWxzZSkgfHwgKG1heE9wdGlvbnNHcnAgIT09IGZhbHNlKSkge1xuXHRcdFx0XHRcdFx0XHR2YXIgbWF4UmVhY2hlZCA9IG1heE9wdGlvbnMgPCAkb3B0aW9ucy5maWx0ZXIoJzpzZWxlY3RlZCcpLmxlbmd0aCxcblx0XHRcdFx0XHRcdFx0XHRtYXhSZWFjaGVkR3JwID0gbWF4T3B0aW9uc0dycCA8ICRvcHRncm91cC5maW5kKCdvcHRpb246c2VsZWN0ZWQnKS5sZW5ndGg7XG5cblx0XHRcdFx0XHRcdFx0aWYgKChtYXhPcHRpb25zICYmIG1heFJlYWNoZWQpIHx8IChtYXhPcHRpb25zR3JwICYmIG1heFJlYWNoZWRHcnApKSB7XG5cdFx0XHRcdFx0XHRcdFx0aWYgKG1heE9wdGlvbnMgJiYgbWF4T3B0aW9ucyA9PSAxKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHQkb3B0aW9ucy5wcm9wKCdzZWxlY3RlZCcsIGZhbHNlKTtcblx0XHRcdFx0XHRcdFx0XHRcdCRvcHRpb24ucHJvcCgnc2VsZWN0ZWQnLCB0cnVlKTtcblx0XHRcdFx0XHRcdFx0XHRcdHRoYXQuJG1lbnUuZmluZCgnLnNlbGVjdGVkJykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkJyk7XG5cdFx0XHRcdFx0XHRcdFx0XHR0aGF0LnNldFNlbGVjdGVkKGNsaWNrZWRJbmRleCwgdHJ1ZSk7XG5cdFx0XHRcdFx0XHRcdFx0fSBlbHNlIGlmIChtYXhPcHRpb25zR3JwICYmIG1heE9wdGlvbnNHcnAgPT0gMSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0JG9wdGdyb3VwLmZpbmQoJ29wdGlvbjpzZWxlY3RlZCcpLnByb3AoJ3NlbGVjdGVkJywgZmFsc2UpO1xuXHRcdFx0XHRcdFx0XHRcdFx0JG9wdGlvbi5wcm9wKCdzZWxlY3RlZCcsIHRydWUpO1xuXHRcdFx0XHRcdFx0XHRcdFx0dmFyIG9wdGdyb3VwSUQgPSAkdGhpcy5kYXRhKCdvcHRncm91cCcpO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHR0aGF0LiRtZW51LmZpbmQoJy5zZWxlY3RlZCcpLmhhcygnYVtkYXRhLW9wdGdyb3VwPVwiJyArIG9wdGdyb3VwSUQgKyAnXCJdJykucmVtb3ZlQ2xhc3MoJ3NlbGVjdGVkJyk7XG5cblx0XHRcdFx0XHRcdFx0XHRcdHRoYXQuc2V0U2VsZWN0ZWQoY2xpY2tlZEluZGV4LCB0cnVlKTtcblx0XHRcdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRcdFx0dmFyIG1heE9wdGlvbnNBcnIgPSAodHlwZW9mIHRoYXQub3B0aW9ucy5tYXhPcHRpb25zVGV4dCA9PT0gJ2Z1bmN0aW9uJykgP1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR0aGF0Lm9wdGlvbnMubWF4T3B0aW9uc1RleHQobWF4T3B0aW9ucywgbWF4T3B0aW9uc0dycCkgOiB0aGF0Lm9wdGlvbnMubWF4T3B0aW9uc1RleHQsXG5cdFx0XHRcdFx0XHRcdFx0XHRcdG1heFR4dCA9IG1heE9wdGlvbnNBcnJbMF0ucmVwbGFjZSgne259JywgbWF4T3B0aW9ucyksXG5cdFx0XHRcdFx0XHRcdFx0XHRcdG1heFR4dEdycCA9IG1heE9wdGlvbnNBcnJbMV0ucmVwbGFjZSgne259JywgbWF4T3B0aW9uc0dycCksXG5cdFx0XHRcdFx0XHRcdFx0XHRcdCRub3RpZnkgPSAkKCc8ZGl2IGNsYXNzPVwibm90aWZ5XCI+PC9kaXY+Jyk7XG5cdFx0XHRcdFx0XHRcdFx0XHQvLyBJZiB7dmFyfSBpcyBzZXQgaW4gYXJyYXksIHJlcGxhY2UgaXRcblx0XHRcdFx0XHRcdFx0XHRcdC8qKiBAZGVwcmVjYXRlZCAqL1xuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKG1heE9wdGlvbnNBcnJbMl0pIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0bWF4VHh0ID0gbWF4VHh0LnJlcGxhY2UoJ3t2YXJ9JywgbWF4T3B0aW9uc0FyclsyXVttYXhPcHRpb25zID4gMSA/IDAgOiAxXSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdG1heFR4dEdycCA9IG1heFR4dEdycC5yZXBsYWNlKCd7dmFyfScsIG1heE9wdGlvbnNBcnJbMl1bbWF4T3B0aW9uc0dycCA+IDEgPyAwIDogMV0pO1xuXHRcdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0XHQkb3B0aW9uLnByb3AoJ3NlbGVjdGVkJywgZmFsc2UpO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHR0aGF0LiRtZW51LmFwcGVuZCgkbm90aWZ5KTtcblxuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKG1heE9wdGlvbnMgJiYgbWF4UmVhY2hlZCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHQkbm90aWZ5LmFwcGVuZCgkKCc8ZGl2PicgKyBtYXhUeHQgKyAnPC9kaXY+JykpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR0aGF0LiRlbGVtZW50LnRyaWdnZXIoJ21heFJlYWNoZWQuYnMuc2VsZWN0Jyk7XG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRcdGlmIChtYXhPcHRpb25zR3JwICYmIG1heFJlYWNoZWRHcnApIHtcblx0XHRcdFx0XHRcdFx0XHRcdFx0JG5vdGlmeS5hcHBlbmQoJCgnPGRpdj4nICsgbWF4VHh0R3JwICsgJzwvZGl2PicpKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0dGhhdC4kZWxlbWVudC50cmlnZ2VyKCdtYXhSZWFjaGVkR3JwLmJzLnNlbGVjdCcpO1xuXHRcdFx0XHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRcdFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR0aGF0LnNldFNlbGVjdGVkKGNsaWNrZWRJbmRleCwgZmFsc2UpO1xuXHRcdFx0XHRcdFx0XHRcdFx0fSwgMTApO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHQkbm90aWZ5LmRlbGF5KDc1MCkuZmFkZU91dCgzMDAsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHQkKHRoaXMpLnJlbW92ZSgpO1xuXHRcdFx0XHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCF0aGF0Lm11bHRpcGxlKSB7XG5cdFx0XHRcdFx0XHR0aGF0LiRidXR0b24uZm9jdXMoKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKHRoYXQub3B0aW9ucy5saXZlU2VhcmNoKSB7XG5cdFx0XHRcdFx0XHR0aGF0LiRzZWFyY2hib3guZm9jdXMoKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHQvLyBUcmlnZ2VyIHNlbGVjdCAnY2hhbmdlJ1xuXHRcdFx0XHRcdGlmICgocHJldlZhbHVlICE9IHRoYXQuJGVsZW1lbnQudmFsKCkgJiYgdGhhdC5tdWx0aXBsZSkgfHwgKHByZXZJbmRleCAhPSB0aGF0LiRlbGVtZW50LnByb3AoJ3NlbGVjdGVkSW5kZXgnKSAmJiAhdGhhdC5tdWx0aXBsZSkpIHtcblx0XHRcdFx0XHRcdHRoYXQuJGVsZW1lbnQuY2hhbmdlKCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy4kbWVudS5vbignY2xpY2snLCAnbGkuZGlzYWJsZWQgYSwgLnBvcG92ZXItdGl0bGUsIC5wb3BvdmVyLXRpdGxlIDpub3QoLmNsb3NlKScsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0aWYgKGUudGFyZ2V0ID09IHRoaXMpIHtcblx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0XHRpZiAoIXRoYXQub3B0aW9ucy5saXZlU2VhcmNoKSB7XG5cdFx0XHRcdFx0XHR0aGF0LiRidXR0b24uZm9jdXMoKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0dGhhdC4kc2VhcmNoYm94LmZvY3VzKCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy4kbWVudS5vbignY2xpY2snLCAnbGkuZGl2aWRlciwgbGkuZHJvcGRvd24taGVhZGVyJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRcdGlmICghdGhhdC5vcHRpb25zLmxpdmVTZWFyY2gpIHtcblx0XHRcdFx0XHR0aGF0LiRidXR0b24uZm9jdXMoKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGF0LiRzZWFyY2hib3guZm9jdXMoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdHRoaXMuJG1lbnUub24oJ2NsaWNrJywgJy5wb3BvdmVyLXRpdGxlIC5jbG9zZScsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0aGF0LiRidXR0b24uZm9jdXMoKTtcblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLiRzZWFyY2hib3gub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0fSk7XG5cblxuXHRcdFx0dGhpcy4kbWVudS5vbignY2xpY2snLCAnLmFjdGlvbnMtYnRuJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRpZiAodGhhdC5vcHRpb25zLmxpdmVTZWFyY2gpIHtcblx0XHRcdFx0XHR0aGF0LiRzZWFyY2hib3guZm9jdXMoKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGF0LiRidXR0b24uZm9jdXMoKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblxuXHRcdFx0XHRpZiAoJCh0aGlzKS5pcygnLmJzLXNlbGVjdC1hbGwnKSkge1xuXHRcdFx0XHRcdHRoYXQuc2VsZWN0QWxsKCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhhdC5kZXNlbGVjdEFsbCgpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHRoYXQuJGVsZW1lbnQuY2hhbmdlKCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy4kZWxlbWVudC5jaGFuZ2UoZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRoYXQucmVuZGVyKGZhbHNlKTtcblx0XHRcdH0pO1xuXHRcdH0sXG5cblx0XHRsaXZlU2VhcmNoTGlzdGVuZXI6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHRoYXQgPSB0aGlzLFxuXHRcdFx0XHRub19yZXN1bHRzID0gJCgnPGxpIGNsYXNzPVwibm8tcmVzdWx0c1wiPjwvbGk+Jyk7XG5cblx0XHRcdHRoaXMuJG5ld0VsZW1lbnQub24oJ2NsaWNrLmRyb3Bkb3duLmRhdGEtYXBpJywgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRoYXQuJG1lbnUuZmluZCgnLmFjdGl2ZScpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcblx0XHRcdFx0aWYgKCEhdGhhdC4kc2VhcmNoYm94LnZhbCgpKSB7XG5cdFx0XHRcdFx0dGhhdC4kc2VhcmNoYm94LnZhbCgnJyk7XG5cdFx0XHRcdFx0dGhhdC4kbGlzLm5vdCgnLmlzLWhpZGRlbicpLnJlbW92ZUNsYXNzKCdoaWRlJyk7XG5cdFx0XHRcdFx0aWYgKCEhbm9fcmVzdWx0cy5wYXJlbnQoKS5sZW5ndGgpIG5vX3Jlc3VsdHMucmVtb3ZlKCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0aWYgKCF0aGF0Lm11bHRpcGxlKSB0aGF0LiRtZW51LmZpbmQoJy5zZWxlY3RlZCcpLmFkZENsYXNzKCdhY3RpdmUnKTtcblx0XHRcdFx0c2V0VGltZW91dChmdW5jdGlvbigpIHtcblx0XHRcdFx0XHR0aGF0LiRzZWFyY2hib3guZm9jdXMoKTtcblx0XHRcdFx0fSwgMTApO1xuXHRcdFx0fSk7XG5cblx0XHRcdHRoaXMuJHNlYXJjaGJveC5vbignaW5wdXQgcHJvcGVydHljaGFuZ2UnLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0aWYgKHRoYXQuJHNlYXJjaGJveC52YWwoKSkge1xuXG5cdFx0XHRcdFx0aWYgKHRoYXQub3B0aW9ucy5zZWFyY2hBY2NlbnRJbnNlbnNpdGl2ZSkge1xuXHRcdFx0XHRcdFx0dGhhdC4kbGlzLm5vdCgnLmlzLWhpZGRlbicpLnJlbW92ZUNsYXNzKCdoaWRlJykuZmluZCgnYScpLm5vdCgnOmFpY29udGFpbnMoJyArIG5vcm1hbGl6ZVRvQmFzZSh0aGF0LiRzZWFyY2hib3gudmFsKCkpICsgJyknKS5wYXJlbnQoKS5hZGRDbGFzcygnaGlkZScpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHR0aGF0LiRsaXMubm90KCcuaXMtaGlkZGVuJykucmVtb3ZlQ2xhc3MoJ2hpZGUnKS5maW5kKCdhJykubm90KCc6aWNvbnRhaW5zKCcgKyB0aGF0LiRzZWFyY2hib3gudmFsKCkgKyAnKScpLnBhcmVudCgpLmFkZENsYXNzKCdoaWRlJyk7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCF0aGF0LiRtZW51LmZpbmQoJ2xpJykuZmlsdGVyKCc6dmlzaWJsZTpub3QoLm5vLXJlc3VsdHMpJykubGVuZ3RoKSB7XG5cdFx0XHRcdFx0XHRpZiAoISFub19yZXN1bHRzLnBhcmVudCgpLmxlbmd0aCkgbm9fcmVzdWx0cy5yZW1vdmUoKTtcblx0XHRcdFx0XHRcdG5vX3Jlc3VsdHMuaHRtbCh0aGF0Lm9wdGlvbnMubm9uZVJlc3VsdHNUZXh0ICsgJyBcIicgKyB0aGF0LiRzZWFyY2hib3gudmFsKCkgKyAnXCInKS5zaG93KCk7XG5cdFx0XHRcdFx0XHR0aGF0LiRtZW51LmZpbmQoJ2xpJykubGFzdCgpLmFmdGVyKG5vX3Jlc3VsdHMpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAoISFub19yZXN1bHRzLnBhcmVudCgpLmxlbmd0aCkge1xuXHRcdFx0XHRcdFx0bm9fcmVzdWx0cy5yZW1vdmUoKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGF0LiRsaXMubm90KCcuaXMtaGlkZGVuJykucmVtb3ZlQ2xhc3MoJ2hpZGUnKTtcblx0XHRcdFx0XHRpZiAoISFub19yZXN1bHRzLnBhcmVudCgpLmxlbmd0aCkgbm9fcmVzdWx0cy5yZW1vdmUoKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHRoYXQuJG1lbnUuZmluZCgnbGkuYWN0aXZlJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuXHRcdFx0XHR0aGF0LiRtZW51LmZpbmQoJ2xpJykuZmlsdGVyKCc6dmlzaWJsZTpub3QoLmRpdmlkZXIpJykuZXEoMCkuYWRkQ2xhc3MoJ2FjdGl2ZScpLmZpbmQoJ2EnKS5mb2N1cygpO1xuXHRcdFx0XHQkKHRoaXMpLmZvY3VzKCk7XG5cdFx0XHR9KTtcblx0XHR9LFxuXG5cdFx0dmFsOiBmdW5jdGlvbih2YWx1ZSkge1xuXHRcdFx0aWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy4kZWxlbWVudC52YWwodmFsdWUpO1xuXHRcdFx0XHR0aGlzLnJlbmRlcigpO1xuXG5cdFx0XHRcdHJldHVybiB0aGlzLiRlbGVtZW50O1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuJGVsZW1lbnQudmFsKCk7XG5cdFx0XHR9XG5cdFx0fSxcblxuXHRcdHNlbGVjdEFsbDogZnVuY3Rpb24oKSB7XG5cdFx0XHR0aGlzLmZpbmRMaXMoKTtcblx0XHRcdHRoaXMuJGxpcy5ub3QoJy5kaXZpZGVyJykubm90KCcuZGlzYWJsZWQnKS5ub3QoJy5zZWxlY3RlZCcpLmZpbHRlcignOnZpc2libGUnKS5maW5kKCdhJykuY2xpY2soKTtcblx0XHR9LFxuXG5cdFx0ZGVzZWxlY3RBbGw6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dGhpcy5maW5kTGlzKCk7XG5cdFx0XHR0aGlzLiRsaXMubm90KCcuZGl2aWRlcicpLm5vdCgnLmRpc2FibGVkJykuZmlsdGVyKCcuc2VsZWN0ZWQnKS5maWx0ZXIoJzp2aXNpYmxlJykuZmluZCgnYScpLmNsaWNrKCk7XG5cdFx0fSxcblxuXHRcdGtleWRvd246IGZ1bmN0aW9uKGUpIHtcblx0XHRcdHZhciAkdGhpcyA9ICQodGhpcyksXG5cdFx0XHRcdCRwYXJlbnQgPSAoJHRoaXMuaXMoJ2lucHV0JykpID8gJHRoaXMucGFyZW50KCkucGFyZW50KCkgOiAkdGhpcy5wYXJlbnQoKSxcblx0XHRcdFx0JGl0ZW1zLFxuXHRcdFx0XHR0aGF0ID0gJHBhcmVudC5kYXRhKCd0aGlzJyksXG5cdFx0XHRcdGluZGV4LFxuXHRcdFx0XHRuZXh0LFxuXHRcdFx0XHRmaXJzdCxcblx0XHRcdFx0bGFzdCxcblx0XHRcdFx0cHJldixcblx0XHRcdFx0bmV4dFByZXYsXG5cdFx0XHRcdHByZXZJbmRleCxcblx0XHRcdFx0aXNBY3RpdmUsXG5cdFx0XHRcdGtleUNvZGVNYXAgPSB7XG5cdFx0XHRcdFx0MzI6ICcgJyxcblx0XHRcdFx0XHQ0ODogJzAnLFxuXHRcdFx0XHRcdDQ5OiAnMScsXG5cdFx0XHRcdFx0NTA6ICcyJyxcblx0XHRcdFx0XHQ1MTogJzMnLFxuXHRcdFx0XHRcdDUyOiAnNCcsXG5cdFx0XHRcdFx0NTM6ICc1Jyxcblx0XHRcdFx0XHQ1NDogJzYnLFxuXHRcdFx0XHRcdDU1OiAnNycsXG5cdFx0XHRcdFx0NTY6ICc4Jyxcblx0XHRcdFx0XHQ1NzogJzknLFxuXHRcdFx0XHRcdDU5OiAnOycsXG5cdFx0XHRcdFx0NjU6ICdhJyxcblx0XHRcdFx0XHQ2NjogJ2InLFxuXHRcdFx0XHRcdDY3OiAnYycsXG5cdFx0XHRcdFx0Njg6ICdkJyxcblx0XHRcdFx0XHQ2OTogJ2UnLFxuXHRcdFx0XHRcdDcwOiAnZicsXG5cdFx0XHRcdFx0NzE6ICdnJyxcblx0XHRcdFx0XHQ3MjogJ2gnLFxuXHRcdFx0XHRcdDczOiAnaScsXG5cdFx0XHRcdFx0NzQ6ICdqJyxcblx0XHRcdFx0XHQ3NTogJ2snLFxuXHRcdFx0XHRcdDc2OiAnbCcsXG5cdFx0XHRcdFx0Nzc6ICdtJyxcblx0XHRcdFx0XHQ3ODogJ24nLFxuXHRcdFx0XHRcdDc5OiAnbycsXG5cdFx0XHRcdFx0ODA6ICdwJyxcblx0XHRcdFx0XHQ4MTogJ3EnLFxuXHRcdFx0XHRcdDgyOiAncicsXG5cdFx0XHRcdFx0ODM6ICdzJyxcblx0XHRcdFx0XHQ4NDogJ3QnLFxuXHRcdFx0XHRcdDg1OiAndScsXG5cdFx0XHRcdFx0ODY6ICd2Jyxcblx0XHRcdFx0XHQ4NzogJ3cnLFxuXHRcdFx0XHRcdDg4OiAneCcsXG5cdFx0XHRcdFx0ODk6ICd5Jyxcblx0XHRcdFx0XHQ5MDogJ3onLFxuXHRcdFx0XHRcdDk2OiAnMCcsXG5cdFx0XHRcdFx0OTc6ICcxJyxcblx0XHRcdFx0XHQ5ODogJzInLFxuXHRcdFx0XHRcdDk5OiAnMycsXG5cdFx0XHRcdFx0MTAwOiAnNCcsXG5cdFx0XHRcdFx0MTAxOiAnNScsXG5cdFx0XHRcdFx0MTAyOiAnNicsXG5cdFx0XHRcdFx0MTAzOiAnNycsXG5cdFx0XHRcdFx0MTA0OiAnOCcsXG5cdFx0XHRcdFx0MTA1OiAnOSdcblx0XHRcdFx0fTtcblxuXHRcdFx0aWYgKHRoYXQub3B0aW9ucy5saXZlU2VhcmNoKSAkcGFyZW50ID0gJHRoaXMucGFyZW50KCkucGFyZW50KCk7XG5cblx0XHRcdGlmICh0aGF0Lm9wdGlvbnMuY29udGFpbmVyKSAkcGFyZW50ID0gdGhhdC4kbWVudTtcblxuXHRcdFx0JGl0ZW1zID0gJCgnW3JvbGU9bWVudV0gbGkgYScsICRwYXJlbnQpO1xuXG5cdFx0XHRpc0FjdGl2ZSA9IHRoYXQuJG1lbnUucGFyZW50KCkuaGFzQ2xhc3MoJ29wZW4nKTtcblxuXHRcdFx0aWYgKCFpc0FjdGl2ZSAmJiAvKFswLTldfFtBLXpdKS8udGVzdChTdHJpbmcuZnJvbUNoYXJDb2RlKGUua2V5Q29kZSkpKSB7XG5cdFx0XHRcdGlmICghdGhhdC5vcHRpb25zLmNvbnRhaW5lcikge1xuXHRcdFx0XHRcdHRoYXQuc2V0U2l6ZSgpO1xuXHRcdFx0XHRcdHRoYXQuJG1lbnUucGFyZW50KCkuYWRkQ2xhc3MoJ29wZW4nKTtcblx0XHRcdFx0XHRpc0FjdGl2ZSA9IHRydWU7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhhdC4kbmV3RWxlbWVudC50cmlnZ2VyKCdjbGljaycpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHRoYXQuJHNlYXJjaGJveC5mb2N1cygpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAodGhhdC5vcHRpb25zLmxpdmVTZWFyY2gpIHtcblx0XHRcdFx0aWYgKC8oXjkkfDI3KS8udGVzdChlLmtleUNvZGUudG9TdHJpbmcoMTApKSAmJiBpc0FjdGl2ZSAmJiB0aGF0LiRtZW51LmZpbmQoJy5hY3RpdmUnKS5sZW5ndGggPT09IDApIHtcblx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0dGhhdC4kbWVudS5wYXJlbnQoKS5yZW1vdmVDbGFzcygnb3BlbicpO1xuXHRcdFx0XHRcdHRoYXQuJGJ1dHRvbi5mb2N1cygpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdCRpdGVtcyA9ICQoJ1tyb2xlPW1lbnVdIGxpOm5vdCguZGl2aWRlcik6bm90KC5kcm9wZG93bi1oZWFkZXIpOnZpc2libGUnLCAkcGFyZW50KTtcblx0XHRcdFx0aWYgKCEkdGhpcy52YWwoKSAmJiAhLygzOHw0MCkvLnRlc3QoZS5rZXlDb2RlLnRvU3RyaW5nKDEwKSkpIHtcblx0XHRcdFx0XHRpZiAoJGl0ZW1zLmZpbHRlcignLmFjdGl2ZScpLmxlbmd0aCA9PT0gMCkge1xuXHRcdFx0XHRcdFx0aWYgKHRoYXQub3B0aW9ucy5zZWFyY2hBY2NlbnRJbnNlbnNpdGl2ZSkge1xuXHRcdFx0XHRcdFx0XHQkaXRlbXMgPSB0aGF0LiRuZXdFbGVtZW50LmZpbmQoJ2xpJykuZmlsdGVyKCc6YWljb250YWlucygnICsgbm9ybWFsaXplVG9CYXNlKGtleUNvZGVNYXBbZS5rZXlDb2RlXSkgKyAnKScpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0JGl0ZW1zID0gdGhhdC4kbmV3RWxlbWVudC5maW5kKCdsaScpLmZpbHRlcignOmljb250YWlucygnICsga2V5Q29kZU1hcFtlLmtleUNvZGVdICsgJyknKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0aWYgKCEkaXRlbXMubGVuZ3RoKSByZXR1cm47XG5cblx0XHRcdGlmICgvKDM4fDQwKS8udGVzdChlLmtleUNvZGUudG9TdHJpbmcoMTApKSkge1xuXHRcdFx0XHRpbmRleCA9ICRpdGVtcy5pbmRleCgkaXRlbXMuZmlsdGVyKCc6Zm9jdXMnKSk7XG5cdFx0XHRcdGZpcnN0ID0gJGl0ZW1zLnBhcmVudCgnOm5vdCguZGlzYWJsZWQpOnZpc2libGUnKS5maXJzdCgpLmluZGV4KCk7XG5cdFx0XHRcdGxhc3QgPSAkaXRlbXMucGFyZW50KCc6bm90KC5kaXNhYmxlZCk6dmlzaWJsZScpLmxhc3QoKS5pbmRleCgpO1xuXHRcdFx0XHRuZXh0ID0gJGl0ZW1zLmVxKGluZGV4KS5wYXJlbnQoKS5uZXh0QWxsKCc6bm90KC5kaXNhYmxlZCk6dmlzaWJsZScpLmVxKDApLmluZGV4KCk7XG5cdFx0XHRcdHByZXYgPSAkaXRlbXMuZXEoaW5kZXgpLnBhcmVudCgpLnByZXZBbGwoJzpub3QoLmRpc2FibGVkKTp2aXNpYmxlJykuZXEoMCkuaW5kZXgoKTtcblx0XHRcdFx0bmV4dFByZXYgPSAkaXRlbXMuZXEobmV4dCkucGFyZW50KCkucHJldkFsbCgnOm5vdCguZGlzYWJsZWQpOnZpc2libGUnKS5lcSgwKS5pbmRleCgpO1xuXG5cdFx0XHRcdGlmICh0aGF0Lm9wdGlvbnMubGl2ZVNlYXJjaCkge1xuXHRcdFx0XHRcdCRpdGVtcy5lYWNoKGZ1bmN0aW9uKGkpIHtcblx0XHRcdFx0XHRcdGlmICgkKHRoaXMpLmlzKCc6bm90KC5kaXNhYmxlZCknKSkge1xuXHRcdFx0XHRcdFx0XHQkKHRoaXMpLmRhdGEoJ2luZGV4JywgaSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0aW5kZXggPSAkaXRlbXMuaW5kZXgoJGl0ZW1zLmZpbHRlcignLmFjdGl2ZScpKTtcblx0XHRcdFx0XHRmaXJzdCA9ICRpdGVtcy5maWx0ZXIoJzpub3QoLmRpc2FibGVkKTp2aXNpYmxlJykuZmlyc3QoKS5kYXRhKCdpbmRleCcpO1xuXHRcdFx0XHRcdGxhc3QgPSAkaXRlbXMuZmlsdGVyKCc6bm90KC5kaXNhYmxlZCk6dmlzaWJsZScpLmxhc3QoKS5kYXRhKCdpbmRleCcpO1xuXHRcdFx0XHRcdG5leHQgPSAkaXRlbXMuZXEoaW5kZXgpLm5leHRBbGwoJzpub3QoLmRpc2FibGVkKTp2aXNpYmxlJykuZXEoMCkuZGF0YSgnaW5kZXgnKTtcblx0XHRcdFx0XHRwcmV2ID0gJGl0ZW1zLmVxKGluZGV4KS5wcmV2QWxsKCc6bm90KC5kaXNhYmxlZCk6dmlzaWJsZScpLmVxKDApLmRhdGEoJ2luZGV4Jyk7XG5cdFx0XHRcdFx0bmV4dFByZXYgPSAkaXRlbXMuZXEobmV4dCkucHJldkFsbCgnOm5vdCguZGlzYWJsZWQpOnZpc2libGUnKS5lcSgwKS5kYXRhKCdpbmRleCcpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cHJldkluZGV4ID0gJHRoaXMuZGF0YSgncHJldkluZGV4Jyk7XG5cblx0XHRcdFx0aWYgKGUua2V5Q29kZSA9PSAzOCkge1xuXHRcdFx0XHRcdGlmICh0aGF0Lm9wdGlvbnMubGl2ZVNlYXJjaCkgaW5kZXggLT0gMTtcblx0XHRcdFx0XHRpZiAoaW5kZXggIT0gbmV4dFByZXYgJiYgaW5kZXggPiBwcmV2KSBpbmRleCA9IHByZXY7XG5cdFx0XHRcdFx0aWYgKGluZGV4IDwgZmlyc3QpIGluZGV4ID0gZmlyc3Q7XG5cdFx0XHRcdFx0aWYgKGluZGV4ID09IHByZXZJbmRleCkgaW5kZXggPSBsYXN0O1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKGUua2V5Q29kZSA9PSA0MCkge1xuXHRcdFx0XHRcdGlmICh0aGF0Lm9wdGlvbnMubGl2ZVNlYXJjaCkgaW5kZXggKz0gMTtcblx0XHRcdFx0XHRpZiAoaW5kZXggPT0gLTEpIGluZGV4ID0gMDtcblx0XHRcdFx0XHRpZiAoaW5kZXggIT0gbmV4dFByZXYgJiYgaW5kZXggPCBuZXh0KSBpbmRleCA9IG5leHQ7XG5cdFx0XHRcdFx0aWYgKGluZGV4ID4gbGFzdCkgaW5kZXggPSBsYXN0O1xuXHRcdFx0XHRcdGlmIChpbmRleCA9PSBwcmV2SW5kZXgpIGluZGV4ID0gZmlyc3Q7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQkdGhpcy5kYXRhKCdwcmV2SW5kZXgnLCBpbmRleCk7XG5cblx0XHRcdFx0aWYgKCF0aGF0Lm9wdGlvbnMubGl2ZVNlYXJjaCkge1xuXHRcdFx0XHRcdCRpdGVtcy5lcShpbmRleCkuZm9jdXMoKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdFx0aWYgKCEkdGhpcy5pcygnLmRyb3Bkb3duLXRvZ2dsZScpKSB7XG5cdFx0XHRcdFx0XHQkaXRlbXMucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuXHRcdFx0XHRcdFx0JGl0ZW1zLmVxKGluZGV4KS5hZGRDbGFzcygnYWN0aXZlJykuZmluZCgnYScpLmZvY3VzKCk7XG5cdFx0XHRcdFx0XHQkdGhpcy5mb2N1cygpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHR9IGVsc2UgaWYgKCEkdGhpcy5pcygnaW5wdXQnKSkge1xuXHRcdFx0XHR2YXIga2V5SW5kZXggPSBbXSxcblx0XHRcdFx0XHRjb3VudCxcblx0XHRcdFx0XHRwcmV2S2V5O1xuXG5cdFx0XHRcdCRpdGVtcy5lYWNoKGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdGlmICgkKHRoaXMpLnBhcmVudCgpLmlzKCc6bm90KC5kaXNhYmxlZCknKSkge1xuXHRcdFx0XHRcdFx0aWYgKCQudHJpbSgkKHRoaXMpLnRleHQoKS50b0xvd2VyQ2FzZSgpKS5zdWJzdHJpbmcoMCwgMSkgPT0ga2V5Q29kZU1hcFtlLmtleUNvZGVdKSB7XG5cdFx0XHRcdFx0XHRcdGtleUluZGV4LnB1c2goJCh0aGlzKS5wYXJlbnQoKS5pbmRleCgpKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXG5cdFx0XHRcdGNvdW50ID0gJChkb2N1bWVudCkuZGF0YSgna2V5Y291bnQnKTtcblx0XHRcdFx0Y291bnQrKztcblx0XHRcdFx0JChkb2N1bWVudCkuZGF0YSgna2V5Y291bnQnLCBjb3VudCk7XG5cblx0XHRcdFx0cHJldktleSA9ICQudHJpbSgkKCc6Zm9jdXMnKS50ZXh0KCkudG9Mb3dlckNhc2UoKSkuc3Vic3RyaW5nKDAsIDEpO1xuXG5cdFx0XHRcdGlmIChwcmV2S2V5ICE9IGtleUNvZGVNYXBbZS5rZXlDb2RlXSkge1xuXHRcdFx0XHRcdGNvdW50ID0gMTtcblx0XHRcdFx0XHQkKGRvY3VtZW50KS5kYXRhKCdrZXljb3VudCcsIGNvdW50KTtcblx0XHRcdFx0fSBlbHNlIGlmIChjb3VudCA+PSBrZXlJbmRleC5sZW5ndGgpIHtcblx0XHRcdFx0XHQkKGRvY3VtZW50KS5kYXRhKCdrZXljb3VudCcsIDApO1xuXHRcdFx0XHRcdGlmIChjb3VudCA+IGtleUluZGV4Lmxlbmd0aCkgY291bnQgPSAxO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0JGl0ZW1zLmVxKGtleUluZGV4W2NvdW50IC0gMV0pLmZvY3VzKCk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIFNlbGVjdCBmb2N1c2VkIG9wdGlvbiBpZiBcIkVudGVyXCIsIFwiU3BhY2ViYXJcIiBvciBcIlRhYlwiICh3aGVuIHNlbGVjdE9uVGFiIGlzIHRydWUpIGFyZSBwcmVzc2VkIGluc2lkZSB0aGUgbWVudS5cblx0XHRcdGlmICgoLygxM3wzMikvLnRlc3QoZS5rZXlDb2RlLnRvU3RyaW5nKDEwKSkgfHwgKC8oXjkkKS8udGVzdChlLmtleUNvZGUudG9TdHJpbmcoMTApKSAmJiB0aGF0Lm9wdGlvbnMuc2VsZWN0T25UYWIpKSAmJiBpc0FjdGl2ZSkge1xuXHRcdFx0XHRpZiAoIS8oMzIpLy50ZXN0KGUua2V5Q29kZS50b1N0cmluZygxMCkpKSBlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdGlmICghdGhhdC5vcHRpb25zLmxpdmVTZWFyY2gpIHtcblx0XHRcdFx0XHQkKCc6Zm9jdXMnKS5jbGljaygpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCEvKDMyKS8udGVzdChlLmtleUNvZGUudG9TdHJpbmcoMTApKSkge1xuXHRcdFx0XHRcdHRoYXQuJG1lbnUuZmluZCgnLmFjdGl2ZSBhJykuY2xpY2soKTtcblx0XHRcdFx0XHQkdGhpcy5mb2N1cygpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdCQoZG9jdW1lbnQpLmRhdGEoJ2tleWNvdW50JywgMCk7XG5cdFx0XHR9XG5cblx0XHRcdGlmICgoLyheOSR8MjcpLy50ZXN0KGUua2V5Q29kZS50b1N0cmluZygxMCkpICYmIGlzQWN0aXZlICYmICh0aGF0Lm11bHRpcGxlIHx8IHRoYXQub3B0aW9ucy5saXZlU2VhcmNoKSkgfHwgKC8oMjcpLy50ZXN0KGUua2V5Q29kZS50b1N0cmluZygxMCkpICYmICFpc0FjdGl2ZSkpIHtcblx0XHRcdFx0dGhhdC4kbWVudS5wYXJlbnQoKS5yZW1vdmVDbGFzcygnb3BlbicpO1xuXHRcdFx0XHR0aGF0LiRidXR0b24uZm9jdXMoKTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0bW9iaWxlOiBmdW5jdGlvbigpIHtcblx0XHRcdHRoaXMuJGVsZW1lbnQuYWRkQ2xhc3MoJ21vYmlsZS1kZXZpY2UnKS5hcHBlbmRUbyh0aGlzLiRuZXdFbGVtZW50KTtcblx0XHRcdGlmICh0aGlzLm9wdGlvbnMuY29udGFpbmVyKSB0aGlzLiRtZW51LmhpZGUoKTtcblx0XHR9LFxuXG5cdFx0cmVmcmVzaDogZnVuY3Rpb24oKSB7XG5cdFx0XHR0aGlzLiRsaXMgPSBudWxsO1xuXHRcdFx0dGhpcy5yZWxvYWRMaSgpO1xuXHRcdFx0dGhpcy5yZW5kZXIoKTtcblx0XHRcdHRoaXMuc2V0V2lkdGgoKTtcblx0XHRcdHRoaXMuc2V0U3R5bGUoKTtcblx0XHRcdHRoaXMuY2hlY2tEaXNhYmxlZCgpO1xuXHRcdFx0dGhpcy5saUhlaWdodCgpO1xuXHRcdH0sXG5cblx0XHR1cGRhdGU6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dGhpcy5yZWxvYWRMaSgpO1xuXHRcdFx0dGhpcy5zZXRXaWR0aCgpO1xuXHRcdFx0dGhpcy5zZXRTdHlsZSgpO1xuXHRcdFx0dGhpcy5jaGVja0Rpc2FibGVkKCk7XG5cdFx0XHR0aGlzLmxpSGVpZ2h0KCk7XG5cdFx0fSxcblxuXHRcdGhpZGU6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dGhpcy4kbmV3RWxlbWVudC5oaWRlKCk7XG5cdFx0fSxcblxuXHRcdHNob3c6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dGhpcy4kbmV3RWxlbWVudC5zaG93KCk7XG5cdFx0fSxcblxuXHRcdHJlbW92ZTogZnVuY3Rpb24oKSB7XG5cdFx0XHR0aGlzLiRuZXdFbGVtZW50LnJlbW92ZSgpO1xuXHRcdFx0dGhpcy4kZWxlbWVudC5yZW1vdmUoKTtcblx0XHR9XG5cdH07XG5cblx0Ly8gU0VMRUNUUElDS0VSIFBMVUdJTiBERUZJTklUSU9OXG5cdC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRmdW5jdGlvbiBQbHVnaW4ob3B0aW9uLCBldmVudCkge1xuXHRcdC8vIGdldCB0aGUgYXJncyBvZiB0aGUgb3V0ZXIgZnVuY3Rpb24uLlxuXHRcdHZhciBhcmdzID0gYXJndW1lbnRzO1xuXHRcdC8vIFRoZSBhcmd1bWVudHMgb2YgdGhlIGZ1bmN0aW9uIGFyZSBleHBsaWNpdGx5IHJlLWRlZmluZWQgZnJvbSB0aGUgYXJndW1lbnQgbGlzdCwgYmVjYXVzZSB0aGUgc2hpZnQgY2F1c2VzIHRoZW1cblx0XHQvLyB0byBnZXQgbG9zdFxuXHRcdC8vbm9pbnNwZWN0aW9uIEpTRHVwbGljYXRlZERlY2xhcmF0aW9uXG5cdFx0dmFyIF9vcHRpb24gPSBvcHRpb24sXG5cdFx0XHRvcHRpb24gPSBhcmdzWzBdLFxuXHRcdFx0ZXZlbnQgPSBhcmdzWzFdO1xuXHRcdFtdLnNoaWZ0LmFwcGx5KGFyZ3MpO1xuXG5cdFx0Ly8gVGhpcyBmaXhlcyBhIGJ1ZyBpbiB0aGUganMgaW1wbGVtZW50YXRpb24gb24gYW5kcm9pZCAyLjMgIzcxNVxuXHRcdGlmICh0eXBlb2Ygb3B0aW9uID09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHRvcHRpb24gPSBfb3B0aW9uO1xuXHRcdH1cblxuXHRcdHZhciB2YWx1ZTtcblx0XHR2YXIgY2hhaW4gPSB0aGlzLmVhY2goZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgJHRoaXMgPSAkKHRoaXMpO1xuXHRcdFx0aWYgKCR0aGlzLmlzKCdzZWxlY3QnKSkge1xuXHRcdFx0XHR2YXIgZGF0YSA9ICR0aGlzLmRhdGEoJ3NlbGVjdHBpY2tlcicpLFxuXHRcdFx0XHRcdG9wdGlvbnMgPSB0eXBlb2Ygb3B0aW9uID09ICdvYmplY3QnICYmIG9wdGlvbjtcblxuXHRcdFx0XHRpZiAoIWRhdGEpIHtcblx0XHRcdFx0XHR2YXIgY29uZmlnID0gJC5leHRlbmQoe30sIFNlbGVjdHBpY2tlci5ERUZBVUxUUywgJC5mbi5zZWxlY3RwaWNrZXIuZGVmYXVsdHMgfHwge30sICR0aGlzLmRhdGEoKSwgb3B0aW9ucyk7XG5cdFx0XHRcdFx0JHRoaXMuZGF0YSgnc2VsZWN0cGlja2VyJywgKGRhdGEgPSBuZXcgU2VsZWN0cGlja2VyKHRoaXMsIGNvbmZpZywgZXZlbnQpKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAob3B0aW9ucykge1xuXHRcdFx0XHRcdGZvciAodmFyIGkgaW4gb3B0aW9ucykge1xuXHRcdFx0XHRcdFx0aWYgKG9wdGlvbnMuaGFzT3duUHJvcGVydHkoaSkpIHtcblx0XHRcdFx0XHRcdFx0ZGF0YS5vcHRpb25zW2ldID0gb3B0aW9uc1tpXTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAodHlwZW9mIG9wdGlvbiA9PSAnc3RyaW5nJykge1xuXHRcdFx0XHRcdGlmIChkYXRhW29wdGlvbl0gaW5zdGFuY2VvZiBGdW5jdGlvbikge1xuXHRcdFx0XHRcdFx0dmFsdWUgPSBkYXRhW29wdGlvbl0uYXBwbHkoZGF0YSwgYXJncyk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdHZhbHVlID0gZGF0YS5vcHRpb25zW29wdGlvbl07XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRpZiAodHlwZW9mIHZhbHVlICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0Ly9ub2luc3BlY3Rpb24gSlNVbnVzZWRBc3NpZ25tZW50XG5cdFx0XHRyZXR1cm4gdmFsdWU7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHJldHVybiBjaGFpbjtcblx0XHR9XG5cdH1cblxuXHR2YXIgb2xkID0gJC5mbi5zZWxlY3RwaWNrZXI7XG5cdCQuZm4uc2VsZWN0cGlja2VyID0gUGx1Z2luO1xuXHQkLmZuLnNlbGVjdHBpY2tlci5Db25zdHJ1Y3RvciA9IFNlbGVjdHBpY2tlcjtcblxuXHQvLyBTRUxFQ1RQSUNLRVIgTk8gQ09ORkxJQ1Rcblx0Ly8gPT09PT09PT09PT09PT09PT09PT09PT09XG5cdCQuZm4uc2VsZWN0cGlja2VyLm5vQ29uZmxpY3QgPSBmdW5jdGlvbigpIHtcblx0XHQkLmZuLnNlbGVjdHBpY2tlciA9IG9sZDtcblx0XHRyZXR1cm4gdGhpcztcblx0fTtcblxuXHQkKGRvY3VtZW50KVxuXHRcdC5kYXRhKCdrZXljb3VudCcsIDApXG5cdFx0Lm9uKCdrZXlkb3duJywgJy5ib290c3RyYXAtc2VsZWN0IFtkYXRhLXRvZ2dsZT1kcm9wZG93bl0sIC5ib290c3RyYXAtc2VsZWN0IFtyb2xlPW1lbnVdLCAuYnMtc2VhcmNoYm94IGlucHV0JywgU2VsZWN0cGlja2VyLnByb3RvdHlwZS5rZXlkb3duKVxuXHRcdC5vbignZm9jdXNpbi5tb2RhbCcsICcuYm9vdHN0cmFwLXNlbGVjdCBbZGF0YS10b2dnbGU9ZHJvcGRvd25dLCAuYm9vdHN0cmFwLXNlbGVjdCBbcm9sZT1tZW51XSwgLmJzLXNlYXJjaGJveCBpbnB1dCcsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0fSk7XG5cblx0Ly8gU0VMRUNUUElDS0VSIERBVEEtQVBJXG5cdC8vID09PT09PT09PT09PT09PT09PT09PVxuXHQkKHdpbmRvdykub24oJ2xvYWQuYnMuc2VsZWN0LmRhdGEtYXBpJywgZnVuY3Rpb24oKSB7XG5cdFx0JCgnLnNlbGVjdHBpY2tlcicpLmVhY2goZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgJHNlbGVjdHBpY2tlciA9ICQodGhpcyk7XG5cdFx0XHRQbHVnaW4uY2FsbCgkc2VsZWN0cGlja2VyLCAkc2VsZWN0cGlja2VyLmRhdGEoKSk7XG5cdFx0fSlcblx0fSk7XG5cbn0pKGpRdWVyeSk7XG4iLCJmdW5jdGlvbiBkZXRlY3RJRSgpIHtcbiAgICB2YXIgdWEgPSB3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudDtcblxuICAgIHZhciBtc2llID0gdWEuaW5kZXhPZignTVNJRSAnKTtcbiAgICBpZiAobXNpZSA+IDApIHtcbiAgICAgICAgLy8gSUUgMTAgb3Igb2xkZXIgPT4gcmV0dXJuIHZlcnNpb24gbnVtYmVyXG4gICAgICAgIHJldHVybiBwYXJzZUludCh1YS5zdWJzdHJpbmcobXNpZSArIDUsIHVhLmluZGV4T2YoJy4nLCBtc2llKSksIDEwKTtcbiAgICB9XG5cbiAgICB2YXIgdHJpZGVudCA9IHVhLmluZGV4T2YoJ1RyaWRlbnQvJyk7XG4gICAgaWYgKHRyaWRlbnQgPiAwKSB7XG4gICAgICAgIC8vIElFIDExID0+IHJldHVybiB2ZXJzaW9uIG51bWJlclxuICAgICAgICB2YXIgcnYgPSB1YS5pbmRleE9mKCdydjonKTtcbiAgICAgICAgcmV0dXJuIHBhcnNlSW50KHVhLnN1YnN0cmluZyhydiArIDMsIHVhLmluZGV4T2YoJy4nLCBydikpLCAxMCk7XG4gICAgfVxuXG4gICAgdmFyIGVkZ2UgPSB1YS5pbmRleE9mKCdFZGdlLycpO1xuICAgIGlmIChlZGdlID4gMCkge1xuICAgICAgIC8vIElFIDEyID0+IHJldHVybiB2ZXJzaW9uIG51bWJlclxuICAgICAgIHJldHVybiBwYXJzZUludCh1YS5zdWJzdHJpbmcoZWRnZSArIDUsIHVhLmluZGV4T2YoJy4nLCBlZGdlKSksIDEwKTtcbiAgICB9XG5cbiAgICAvLyBvdGhlciBicm93c2VyXG4gICAgcmV0dXJuIGZhbHNlO1xufVxuXG4oZnVuY3Rpb24oJCl7XG4gICAgJChmdW5jdGlvbigpe1xuXG4gICAgICAgIC8vdmFyICRjb3B5ID0gJCgnZGl2LlNQQV9wcmludGNvbnRhY3QnKS5jbG9uZSgpO1xuICAgICAgICB2YXIgJGJvZHkgPSAkKCdib2R5Jyk7XG5cbiAgICAgICAgLy8kY29weS5pbnNlcnRBZnRlcignI3ByaW50ZGF0ZScpO1xuXG4gICAgICAgIGlmKCQuYnJvd3Nlci5tc2llIHx8IGRldGVjdElFKCkpIHtcbiAgICAgICAgICAgICRib2R5LmFkZENsYXNzKCdtc2llIGllJytkZXRlY3RJRSgpKTtcbiAgICAgICAgICAgIC8vdmFyIHVzZXJBZ2VudCA9IHVzZXJBZ2VudC5zdWJzdHJpbmcoMCx1c2VyQWdlbnQuaW5kZXhPZignLicpKTtcbiAgICAgICAgICAgIC8vdmFyIHZlcnNpb24gPSB1c2VyQWdlbnQ7XG4gICAgICAgICAgICAvLyRib2R5LmFkZENsYXNzKCdtc2llIGllJyArIHZlcnNpb24pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvL2FsZXJ0KCdJRScpO1xuICAgICAgICB9IGVsc2UgaWYoJC5icm93c2VyLndlYmtpdCkge1xuICAgICAgICAgICAgJGJvZHkuYWRkQ2xhc3MoJ3dlYmtpdCcpO1xuICAgICAgICB9IGVsc2UgaWYoJC5icm93c2VyLm1vemlsbGEpIHtcbiAgICAgICAgICAgICRib2R5LmFkZENsYXNzKCdtb3ppbGxhJyk7XG4gICAgICAgIH1cblxuICAgIH0pO1xufShqUXVlcnkpKTtcblxuXG4vKiFcbiogRGV0ZWN0aXpyIHZAVkVSU0lPTlxuKiBodHRwOi8vYmFyaXNheWRpbm9nbHUuZ2l0aHViLmNvbS9EZXRlY3RpenIvXG4qXG4qIFdyaXR0ZW4gYnkgQmFyaXMgQXlkaW5vZ2x1IChodHRwOi8vYmFyaXMuYXlkaW5vZ2x1LmluZm8pIC0gQ29weXJpZ2h0IDIwMTJcbiogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlXG4qXG4qIERhdGU6IEBEQVRFXG4qL1xuIiwiLy8kKGZ1bmN0aW9uKCkge1xuLy8gICAgXG4vL1x0JCgnLl9mb3J3YXJkX3ByaWNpbmcnKS5vbihcImNsaWNrXCIsZnVuY3Rpb24oKXtcbi8vICAgICAgICAgICAgX2dhX2dlbmVyYXRlZCggJCh0aGlzKSApOyAgIFxuLy8gICAgICAgICAgICAvLyByZWRpcmVjdCBzdG9yZVxuLy8gICAgICAgICAgICBkb2N1bWVudC5sb2NhdGlvbiA9IGRvbWFpbiArICcvc3RvcmUuaHRtbCc7XHRcbi8vXHR9KTtcbi8vICAgICAgICBcbi8vICAgICAgICAkKCcuZ2EtY2xpY2snKS5vbignY2xpY2snLCBmdW5jdGlvbihldmVudCkge1xuLy8gICAgICAgICAgICAvL2V2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4vLyAgICAgICAgICAgIF9nYV9nZW5lcmF0ZWQoICQodGhpcykgKTtcbi8vICAgICAgICAgICAgLy9yZXR1cm4gdHJ1ZTtcbi8vICAgICAgICB9KTtcbi8vXG4vL30pO1xuLy9cbi8vZnVuY3Rpb24gX2dhX2dlbmVyYXRlZCggJCh0aGlzKSApIHtcbi8vICAgIHZhciBfZ2FfbGFiZWxfYnV0dG9uID0gZmFsc2UsXG4vLyAgICAgICAgX2dhX3R5cGVfYnV0dG9uID0gZmFsc2UsXG4vLyAgICAgICAgX2dhX2V2ZW50ID0gZmFsc2U7XG4vL1xuLy8gICAgX2dhX2V2ZW50ID0gKCQodGhpcykuYXR0cignZ2EtZXZlbnQnKSkgPyAkKHRoaXMpLmF0dHIoJ2dhLWV2ZW50JykgOiBmYWxzZTtcbi8vICAgIF9nYV90eXBlX2J1dHRvbiA9ICgkKHRoaXMpLmF0dHIoJ2dhLXR5cGUtYnV0dG9uJykpID8gJCh0aGlzKS5hdHRyKCdnYS10eXBlLWJ1dHRvbicpIDogJ2J1eSBidXR0b24nO1xuLy8gICAgX2dhX2xhYmVsX2J1dHRvbiA9ICgkKHRoaXMpLmF0dHIoJ2dhLWxhYmVsLWJ1dHRvbicpKSA/ICQudHJpbSggJCh0aGlzKS5hdHRyKCdnYS1sYWJlbC1idXR0b24nKS50b0xvd2VyQ2FzZSgpICkucmVwbGFjZSgvXFxzL2csJy0nKSA6IGZhbHNlO1xuLy9cbi8vICAgIGlmKF9nYV9ldmVudCAmJiBfZ2FfdHlwZV9idXR0b24gJiYgX2dhX2xhYmVsX2J1dHRvbikge1xuLy8gICAgICAgIGdhKCdzZW5kJywgJ2V2ZW50JywgX2dhX3R5cGVfYnV0dG9uLCBfZ2FfZXZlbnQsIF9nYV9sYWJlbF9idXR0b24pO1xuLy8gICAgfSBcbi8vfVxuXG5mdW5jdGlvbiBnb29nbGVfYW5hbGl0eWNzX2NsaWNrKCBjYXRlZ29yeSwgYWN0aW9uLCBsYWJlbCApIHtcbiAgICBpZihhY3Rpb24gJiYgY2F0ZWdvcnkgJiYgbGFiZWwpIHtcbiAgICAgICAgZ2EoJ3NlbmQnLCAnZXZlbnQnLCBjYXRlZ29yeSwgYWN0aW9uLCBsYWJlbCk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBUcmFja0V2ZW50R0EoQ2F0ZWdvcnksIEFjdGlvbiwgTGFiZWwsIFZhbHVlKSB7XG4gICAgXCJ1c2Ugc3RyaWN0XCI7XG4gICAgaWYgKHR5cGVvZiAoX2dhcSkgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgX2dhcS5wdXNoKFsnX3RyYWNrRXZlbnQnLCBDYXRlZ29yeSwgQWN0aW9uLCBMYWJlbCwgVmFsdWVdKTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiAoZ2EpICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgIGdhKCdzZW5kJywgJ2V2ZW50JywgQ2F0ZWdvcnksIEFjdGlvbiwgTGFiZWwsIFZhbHVlKTtcbiAgICB9XG59XG5cbiQoZnVuY3Rpb24oKSB7XG4gICAgJCgnLmdhLWFjdGlvbi1jbGljaycpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICB2YXIgX2dhX2FjdGlvbiA9ICgkKHRoaXMpLmF0dHIoJ2dhLWFjdGlvbicpKSA/ICQodGhpcykuYXR0cignZ2EtYWN0aW9uJykgOiBmYWxzZSxcbiAgICAgICAgICAgICAgIF9nYV9jYXRlZ29yeSA9ICgkKHRoaXMpLmF0dHIoJ2dhLWNhdGVnb3J5JykpID8gJCh0aGlzKS5hdHRyKCdnYS1jYXRlZ29yeScpIDogZmFsc2UsXG4gICAgICAgICAgICAgICBfZ2FfbGFiZWwgPSAoJCh0aGlzKS5hdHRyKCdnYS1sYWJlbCcpKSA/ICQudHJpbSggJCh0aGlzKS5hdHRyKCdnYS1sYWJlbCcpLnRvTG93ZXJDYXNlKCkgKS5yZXBsYWNlKC9cXHMvZywnLScpIDogZmFsc2U7XG4gICAgICAgIFxuICAgICAgICBpZihfZ2FfYWN0aW9uICYmIF9nYV9jYXRlZ29yeSAmJiBfZ2FfbGFiZWwpIHtcbiAgICAgICAgICAgIC8vIGdhKCdzZW5kJywgJ2V2ZW50JywgX2dhX2NhdGVnb3J5LCBfZ2FfYWN0aW9uLCBfZ2FfbGFiZWwpO1xuICAgICAgICAgICAgVHJhY2tFdmVudEdBKF9nYV9jYXRlZ29yeSwgX2dhX2FjdGlvbiwgX2dhX2xhYmVsKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICB9KTtcbiAgICBcbiAgICAkKCcuZ2EtYWN0aW9uLXN1Ym1pdCcpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkgeyAvLyBjbG9zZXN0KCdmb3JtJykuIHN1Ym1pdFxuICAgICAgICB2YXIgX2IgPSAkKHRoaXMpLCBfZm9ybSA9ICQodGhpcykuY2xvc2VzdCgnZm9ybScpOyAgLy8gLmZpbmQoJy5nYS1hY3Rpb24tc3VibWl0JylcbiAgICAgICAgdmFyIF9nYV9hY3Rpb24gPSAoX2IuYXR0cignZ2EtYWN0aW9uJykpID8gX2IuYXR0cignZ2EtYWN0aW9uJykgOiBmYWxzZSxcbiAgICAgICAgICAgX2dhX2NhdGVnb3J5ID0gKF9iLmF0dHIoJ2dhLWNhdGVnb3J5JykpID8gX2IuYXR0cignZ2EtY2F0ZWdvcnknKSA6IGZhbHNlLFxuICAgICAgICAgICBfZ2FfcGFnZSA9IChfYi5hdHRyKCdnYS1wYWdlJykpID8gX2IuYXR0cignZ2EtcGFnZScpIDogJycsXG4gICAgICAgICAgIF9nYV9sYWJlbCA9IChfYi5hdHRyKCdnYS1sYWJlbCcpKSA/ICQudHJpbSggX2IuYXR0cignZ2EtbGFiZWwnKS50b0xvd2VyQ2FzZSgpICkucmVwbGFjZSgvXFxzL2csJy0nKSA6IGZhbHNlO1xuICAgICAgICBcbiAgICAgICAgaWYoX2dhX2FjdGlvbiAmJiBfZ2FfY2F0ZWdvcnkgJiYgX2dhX2xhYmVsKSB7XG4gICAgICAgICAgICBnYSgnc2VuZCcsICdwYWdlJywgX2dhX3BhZ2UpO1xuICAgICAgICAgICAgZ2EoJ3NlbmQnLCAncGFnZXZpZXcnLCBfZ2FfcGFnZSk7XG4gICAgICAgICAgICAvLyBnYSgnc2V0JywgJ3JlZmVycmVyJywgJ2h0dHA6Ly9wdW1waWMuY29tJyk7XG4gICAgICAgICAgICBnYSgnc2VuZCcsICdldmVudCcsIF9nYV9jYXRlZ29yeSwgX2dhX2FjdGlvbiwgX2dhX2xhYmVsLCB7XG4gICAgICAgICAgICAgICAgJ3BhZ2UnOiBfZ2FfcGFnZSxcbiAgICAgICAgICAgICAgICAnX3RyYWNrUGFnZXZpZXcnOiBfZ2FfcGFnZSwgXG4gICAgICAgICAgICAgICAgJ2hpdENhbGxiYWNrJzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIF9mb3JtLnN1Ym1pdCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICByZXR1cm4gIShnYS5oYXNPd25Qcm9wZXJ0eSgnbG9hZGVkJykgJiYgZ2EubG9hZGVkID09PSB0cnVlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgXG59KTtcblxuIiwiY3VycmVuY3lIYW5kbGVyID0ge1xuICBhZnRlckxvYWQ6IGZ1bmN0aW9uKHJhdGVzKXtcbiAgICAkLmVhY2goJCgnaW5wdXQuZGF0YS1wcmljZScpLCBmdW5jdGlvbihpLCBwcmljZVRhZyl7XG4gICAgICB2YXIgdXNkUHJpY2UgPSAkKHByaWNlVGFnKS5kYXRhKCdwcmljZS11c2QnKTtcbiAgICAgIFxuICAgICAgaWYgKHR5cGVvZiB1c2RQcmljZSAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgJC5lYWNoKFsnZ2JwJywgJ2V1cicsICdjYWQnLCAnYXVkJ10sIGZ1bmN0aW9uKGksIGN1cnJlbmN5KXtcbiAgICAgICAgICBcbiAgICAgICAgICBpZihyYXRlc1tjdXJyZW5jeS50b1VwcGVyQ2FzZSgpXSl7XG4gICAgICAgICAgICB2YXIgcHJpY2VJbkN1cnJlbmN5ID0gTnVtYmVyKCgxIC8gcmF0ZXNbY3VycmVuY3kudG9VcHBlckNhc2UoKV0pICogdXNkUHJpY2UpLnRvRml4ZWQoMik7XG4gICAgICAgICAgICAkKHByaWNlVGFnKS5hdHRyKCdkYXRhLXByaWNlLScgKyBjdXJyZW5jeSwgcHJpY2VJbkN1cnJlbmN5KTtcbiAgICAgICAgICAgIFxuICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBcbiAgICAgIHZhciBkb3VibGVQcmljZSA9ICQocHJpY2VUYWcpLmRhdGEoJ2RhdGEtb2ZmZXItcHJpY2UtdXNkJyk7XG4gICAgICBcbiAgICAgIGlmICh0eXBlb2YgZG91YmxlUHJpY2UgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICQuZWFjaChbJ2dicCcsICdldXInLCAnY2FkJywgJ2F1ZCddLCBmdW5jdGlvbihpLCBjdXJyZW5jeSl7XG4gICAgICAgICAgXG4gICAgICAgICAgaWYocmF0ZXNbY3VycmVuY3kudG9VcHBlckNhc2UoKV0pe1xuICAgICAgICAgICAgdmFyIHByaWNlSW5DdXJyZW5jeSA9IE51bWJlcigoMSAvIHJhdGVzW2N1cnJlbmN5LnRvVXBwZXJDYXNlKCldKSAqIGRvdWJsZVByaWNlKS50b0ZpeGVkKDIpO1xuICAgICAgICAgICAgJChwcmljZVRhZykuYXR0cignZGF0YS1vZmZlci1wcmljZS0nICsgY3VycmVuY3ksIHByaWNlSW5DdXJyZW5jeSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICAgICQoJ2lucHV0LmRhdGEtcHJpY2U6Y2hlY2tlZCcpLmNoYW5nZSgpO1xuICB9LFxuICBvbkNoYW5nZTogZnVuY3Rpb24oY3VycmVudEN1cnJlbmN5KXtcbiAgICAkKCdpbnB1dC5kYXRhLXByaWNlJylcbiAgICAgICAgLmF0dHIoJ2RhdGEtY3VyJywgY3VycmVudEN1cnJlbmN5KVxuICAgICAgICAuZmlsdGVyKCc6Y2hlY2tlZCcpXG4gICAgICAgIC5jaGFuZ2UoKTtcbiAgfVxufTtcblxuKGZ1bmN0aW9uKCAkICl7XG4gIC8vIHZhciBfZGF0YU9iaiA9ICgkKFwiYm9keVwiKS5oYXNDbGFzcyhcImllOFwiKSkgPyBkb2N1bWVudC5ib2R5IDogd2luZG93O1xuICB2YXIgJHRoaXMgPSB7fSwgJHJhdGVzID0ge30sICRfaHRtbCA9IFwiXCI7XG4gIFxuICB2YXIgJF9zZXR0aW5ncyA9IHtcbiAgICAnZGVidWcnOiBmYWxzZSxcbiAgICAnYXBpX2tleSc6ICcnLCAvLyBhcHBfaWQ9XG4gICAgLy8gJ2hvc3QnOiAnL2N1cnJlbmN5Lmh0bWwnLFxuICAgICdjdXJyQmFzZSc6ICdVU0QnLFxuICAgICdjdXJyQ29kZSc6IHsgJ3VzZCcgOiAnJCcsXG4gICAgICAnZXVyJyA6J+KCrCcsXG4gICAgICAnZ2JwJyA6ICfCoycsXG4gICAgICAnY2FkJyA6ICckJyxcbiAgICAgICdhdWQnIDogJyQnfSxcbiAgICAnZmlsdGVyJzoge1xuICAgICAgJ2lzbyc6IFsnVVNEJywnRVVSJywnR0JQJywnQ0FEJywnQVVEJ11cbiAgICB9LFxuICAgICdyYXRlcyc6IHt9LCAvLyBsaXN0IGN1cnJhbmNlIHJhdGVzXG4gICAgJ2NvbnZlcnQnOiB7XG4gICAgICAnZnJvbSc6IGZhbHNlLFxuICAgICAgJ3RvJzogZmFsc2UsXG4gICAgfSxcbiAgICAnYWpheCc6IHtcbiAgICAgICdkYXRhVHlwZSc6ICdqc29uJyxcbiAgICAgICd0eXBlJzogJ1BPU1QnLFxuICAgICAgJ2Nyb3NzRG9tYWluJzogdHJ1ZSxcbiAgICAgICdkYXRhJzoge1xuICAgICAgfVxuICAgIH0sXG4gICAgJ29uT3Blbic6IGZhbHNlLFxuICB9XG4gIFxuICAvLyBkZXRlY3RlZCBtZXRob2RcbiAgdmFyIG1ldGhvZHMgPSB7XG4gICAgaW5pdCA6IGZ1bmN0aW9uKCBvcHRpb25zICkge1xuICAgICAgbWV0aG9kcy5fZGllKCdMb2FkIGluaXQhICpDdXJyJyk7XG4gICAgICBcbiAgICAgICR0aGlzID0gJCh0aGlzKTtcbiAgICAgIC8vIHNldCBmaWx0ZXJzXG4gICAgICBtZXRob2RzLnNldFNldHRpbmdzKCBvcHRpb25zICk7XG4gICAgICBcbiAgICAgIC8vIHNldCByYXRlc1xuICAgICAgbWV0aG9kcy5zZXRSYXRlcygpO1xuICAgICAgXG4gICAgICBtZXRob2RzLl9kaWUoJ1JhdGVzIC4uLicpO1xuICAgICAgbWV0aG9kcy5fZGllKCAkX3NldHRpbmdzLnJhdGVzICk7XG4gICAgICBcbiAgICAgIC8vIGluaXQgbW9uZXlcbiAgICAgIHZhciByYXRlcyA9IG1ldGhvZHMuX2luaXRNb25leSgpO1xuICAgICAgXG4gICAgICBtZXRob2RzLnRyaWdnZXJDYWxsKCRfc2V0dGluZ3Mub25PcGVuLCByYXRlcyk7XG4gICAgICByZXR1cm4gJCh0aGlzKTtcbiAgICB9LCAvLyBzZXQgaW5pdFxuICAgIFxuICAgIHNldFNldHRpbmdzOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICBpZih0eXBlb2Ygb3B0aW9ucyAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAkX3NldHRpbmdzID0gJC5leHRlbmQoICRfc2V0dGluZ3MsIG9wdGlvbnMgfHwge30pO1xuICAgICAgfVxuICAgIH0sXG4gICAgXG4gICAgc2V0UmF0ZXM6IGZ1bmN0aW9uKCAkX29iaiApIHtcbiAgICAgIGlmKHR5cGVvZiAkX29iaiAhPT0gXCJ1bmRlZmluZWRcIiApIHtcbiAgICAgICAgJF9zZXR0aW5ncy5yYXRlcyA9ICRfb2JqO1xuICAgICAgfSBlbHNlIGlmKCRyYXRlcyA9IG1ldGhvZHMuX2pzb24oKSkge1xuICAgICAgICAkX3NldHRpbmdzLnJhdGVzID0gJHJhdGVzO1xuICAgICAgfVxuICAgIH0sXG4gICAgXG4gICAgdHJpZ2dlckNhbGw6IGZ1bmN0aW9uKGZ1bmMsIGFyZykge1xuICAgICAgJC5pc0Z1bmN0aW9uKGZ1bmMpICYmIGZ1bmMuY2FsbCh0aGlzLCBhcmcpO1xuICAgIH0sXG4gICAgXG4gICAgX2RpZTogZnVuY3Rpb24obXNnKSB7XG4gICAgICBpZigkX3NldHRpbmdzLmRlYnVnKVxuICAgICAgICBjb25zb2xlLmxvZyggbXNnICk7XG4gICAgfSxcbiAgICBcbiAgICAvKiA9PT09IGluaXQgY29va2llID09PT09PSAqL1xuICAgIF9jbGVhckNvb2tpZTogZnVuY3Rpb24oIGtleSApIHtcbiAgICAgIGlmKCQuY29va2llKCBrZXkgKSkge1xuICAgICAgICAkLnJlbW92ZUNvb2tpZSgga2V5LCB7IHBhdGg6ICcvJyB9KTtcbiAgICAgIH1cbiAgICB9LFxuICAgIFxuICAgIHNldENvb2tpZTogZnVuY3Rpb24oa2V5LCB2YWx1ZSkge1xuICAgICAgJC5jb29raWUoa2V5LCB2YWx1ZSwgeyBleHBpcmVzOiA3LCBwYXRoOiAnLycgfSk7XG4gICAgfSxcbiAgICBcbiAgICBnZXRDb29raWU6IGZ1bmN0aW9uKCBrZXkgKSB7XG4gICAgICBpZigkLmNvb2tpZShrZXkpKSB7XG4gICAgICAgIHJldHVybiAkLmNvb2tpZShrZXkpO1xuICAgICAgfSBlbHNlXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9LFxuICAgIFxuICAgIC8qID09PT0gaW5pdCBkYXRhIGNhaGNlID09PT09PSAqL1xuICAgIF9jbGVhckNhY2g6IGZ1bmN0aW9uKGtleSkge1xuLy8gICAgICAgICAgICBpZiggJChcImJvZHlcIikuaGFzQ2xhc3MoXCJpZThcIikgKSB7XG4vLyAgICAgICAgICAgICAgICBpZihrZXkpIHtcbi8vICAgICAgICAgICAgICAgICAgICBqUXVlcnkuZGF0YSggZG9jdW1lbnQuYm9keSwga2V5LCBmYWxzZSk7XG4vLyAgICAgICAgICAgICAgICB9IGVsc2Uge1xuLy8gICAgICAgICAgICAgICAgICAgIGpRdWVyeS5kYXRhKCBkb2N1bWVudC5ib2R5LCAnX3Jlc3VsdCcsIGZhbHNlKTtcbi8vICAgICAgICAgICAgICAgIH1cbi8vICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgIGlmKGtleSkge1xuICAgICAgICBqUXVlcnkuZGF0YSggd2luZG93LCBrZXksIGZhbHNlKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGpRdWVyeS5kYXRhKCB3aW5kb3csICdfcmVzdWx0JywgZmFsc2UpO1xuICAgICAgfVxuLy8gICAgICAgICAgICB9XG4gICAgfSxcbiAgICBzZXRDYWNoOiBmdW5jdGlvbihrZXksIHBhcmFtcykge1xuICAgICAga2V5ID0gKCFrZXkpID8gXCJfcmVzdWx0XCIgOiBrZXk7XG4gICAgICBcbiAgICAgIGlmKHBhcmFtcykge1xuLy8gICAgICAgICAgICAgICAgaWYoICQoXCJib2R5XCIpLmhhc0NsYXNzKFwiaWU4XCIpICkge1xuLy8gICAgICAgICAgICAgICAgICAgIHJldHVybiBqUXVlcnkuZGF0YSggZG9jdW1lbnQuYm9keSwga2V5LCBwYXJhbXMgKTtcbi8vICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBqUXVlcnkuZGF0YSggd2luZG93LCBrZXksIHBhcmFtcyk7XG4vLyAgICAgICAgICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuLy8gICAgICAgICAgICAgICAgaWYoICQoXCJib2R5XCIpLmhhc0NsYXNzKFwiaWU4XCIpICkge1xuLy8gICAgICAgICAgICAgICAgICAgIHJldHVybiBqUXVlcnkuZGF0YSggZG9jdW1lbnQuYm9keSwga2V5KTtcbi8vICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBqUXVlcnkuZGF0YSggd2luZG93LCBrZXkpO1xuLy8gICAgICAgICAgICAgICAgfVxuICAgICAgfVxuICAgICAgXG4gICAgfSwgLy8gc2V0IGNhaGNlXG4gICAgXG4gICAgZ2V0Q2FjaDogZnVuY3Rpb24oa2V5KSB7XG4vLyAgICAgICAgICAgIGlmKCAkKFwiYm9keVwiKS5oYXNDbGFzcyhcImllOFwiKSApIHtcbi8vICAgICAgICAgICAgICAgIGlmKGpRdWVyeS5kYXRhKCBkb2N1bWVudC5ib2R5LCBrZXkpKVxuLy8gICAgICAgICAgICAgICAgICAgIHJldHVybiBqUXVlcnkuZGF0YSggZG9jdW1lbnQuYm9keSwga2V5KTtcbi8vICAgICAgICAgICAgICAgIGVsc2Vcbi8vICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4vLyAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICBpZihqUXVlcnkuZGF0YSggd2luZG93LCBrZXkpKVxuICAgICAgICByZXR1cm4galF1ZXJ5LmRhdGEoIHdpbmRvdywga2V5KTtcbiAgICAgIGVsc2VcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuLy8gICAgICAgICAgICB9XG4gICAgfSxcbiAgICBcbiAgICAvKiBhamF4ICovXG4gICAgX2pzb246IGZ1bmN0aW9uKF9kYXRhKSB7XG4gICAgICBtZXRob2RzLl9kaWUoJ0xvYWQganNvbiBjdXJyLi4nKTtcbiAgICAgIHZhciBfdXJsID0gJycsIHJlc3VsdCA9IHt9O1xuXG5cblxuLy8gICAgICAgICAgICBfZGF0YSA9IChfZGF0YSkgPyBfZGF0YSA6IHtcbi8vICAgICAgICAgICAgICAgICdfYmFzZSc6ICRfc2V0dGluZ3MuY3VyckJhc2UsIC8vIHNldCBCYXNlIGN1cnJhbmNlXG4vLyAgICAgICAgICAgICAgICAnX2ZpbHRlcic6ICRfc2V0dGluZ3MuZmlsdGVyIC8vIHNldCBmaWx0ZXIgaW4gaXNvXG4vLyAgICAgICAgICAgIH07XG4vL1xuLy8gICAgICAgICAgICBpZiggJChcImJvZHlcIikuaGFzQ2xhc3MoXCJpZThcIikgfHwgJChcImJvZHlcIikuaGFzQ2xhc3MoXCJpZTlcIikgKSB7XG4vLyAgICAgICAgICAgICAgICBtZXRob2RzLl9kaWUoJ0xvYWQgaWU4IG9yIGllOSAuLi4nKTtcbi8vICAgICAgICAgICAgICAgIC8vIGZpeCBmb3IgaWU4XG4vLyAgICAgICAgICAgICAgICB2YXIgcmVzcG9uY2UgPSAkLmFqYXgoe1xuLy8gICAgICAgICAgICAgICAgICAgdHlwZTogJF9zZXR0aW5ncy5hamF4LnR5cGUsXG4vLyAgICAgICAgICAgICAgICAgICB1cmw6ICRfc2V0dGluZ3MuaG9zdCxcbi8vICAgICAgICAgICAgICAgICAgIHByb2Nlc3NEYXRhOiB0cnVlLFxuLy8gICAgICAgICAgICAgICAgICAgYXN5bmM6IGZhbHNlLFxuLy8gICAgICAgICAgICAgICAgICAgY2FjaGU6IGZhbHNlLFxuLy8gICAgICAgICAgICAgICAgICAgZGF0YTogJC5leHRlbmQoX2RhdGEsICRfc2V0dGluZ3MuYWpheC5kYXRhKSxcbi8vICAgICAgICAgICAgICAgICAgIGRhdGFUeXBlOiBcImpzb25cIixcbi8vICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uICgpIHtcbi8vICAgICAgICAgICAgICAgICAgIH1cbi8vICAgICAgICAgICAgICAgIH0pLnJlc3BvbnNlVGV4dDtcbi8vICAgICAgICAgICAgICAgIHJlc3BvbmNlID0gZXZhbCgnWycrcmVzcG9uY2UrJ10nKTtcbi8vICAgICAgICAgICAgICAgIG1ldGhvZHMuc2V0Q2FjaCgnX2FqYXgnLCByZXNwb25jZVswXSk7IC8vIC5yZXNwb25zZUpTT05cbi8vXG4vLyAgICAgICAgICAgIH0gZWxzZSB7XG4vLyAgICAgICAgICAgICAgICAkLmFqYXgoe1xuLy8gICAgICAgICAgICAgICAgICAgIHR5cGU6ICRfc2V0dGluZ3MuYWpheC50eXBlLFxuLy8gICAgICAgICAgICAgICAgICAgIGFzeW5jOiBmYWxzZSxcbi8vICAgICAgICAgICAgICAgICAgICBjYWNoZTogZmFsc2UsXG4vLyAgICAgICAgICAgICAgICAgICAgdXJsOiAkX3NldHRpbmdzLmhvc3QsXG4vLyAgICAgICAgICAgICAgICAgICAgZGF0YTogJC5leHRlbmQoX2RhdGEsICRfc2V0dGluZ3MuYWpheC5kYXRhKSxcbi8vICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogJF9zZXR0aW5ncy5hamF4LmRhdGFUeXBlLFxuLy8gICAgICAgICAgICAgICAgICAgIGNyb3NzRG9tYWluOiAkX3NldHRpbmdzLmFqYXguY3Jvc3NEb21haW5cbi8vICAgICAgICAgICAgICAgIH0pLmRvbmUoZnVuY3Rpb24ocmVzcG9uY2UpIHtcbi8vICAgICAgICAgICAgICAgICAgICBtZXRob2RzLl9kaWUoICdSZXNwb25jZS4uJyApO1xuLy8gICAgICAgICAgICAgICAgICAgIG1ldGhvZHMuX2RpZSggcmVzcG9uY2UgKTtcbi8vICAgICAgICAgICAgICAgICAgICBpZihyZXNwb25jZSkge1xuLy9cbi8vICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZHMuX2RpZSggcmVzcG9uY2UgKTtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kcy5zZXRDYWNoKCdfYWpheCcsIHJlc3BvbmNlKTsgLy8gLnJlc3BvbnNlSlNPTlxuLy8gICAgICAgICAgICAgICAgICAgIH1cbi8vICAgICAgICAgICAgICAgIH0pO1xuLy8gICAgICAgICAgICB9XG4gICAgICBcbiAgICAgIGlmKGlzc2V0KCRyYW5kKSAmJiAhbWV0aG9kcy5nZXRDYWNoKCdfYWpheCcpKSBtZXRob2RzLnNldENhY2goJ19hamF4JywgJHJhbmQpO1xuICAgICAgXG4gICAgICBtZXRob2RzLl9kaWUoICdnZXRDYWNoZS4uLicgKTtcbiAgICAgIG1ldGhvZHMuX2RpZSggbWV0aG9kcy5nZXRDYWNoKCdfYWpheCcpICk7XG4gICAgICByZXR1cm4gcmVzdWx0ID0gbWV0aG9kcy5nZXRDYWNoKCdfYWpheCcpO1xuICAgICAgXG4gICAgfSxcbiAgICBcbiAgICAvLyBtb25leSBtYXRoXG4gICAgX2luaXRNb25leTogZnVuY3Rpb24oIGRhdGEgKSB7XG4gICAgICB2YXIgX3JhdGVzID0ge307XG4gICAgICBpZigkX3NldHRpbmdzLnJhdGVzKSB7XG4gICAgICAgICQuZWFjaCgkX3NldHRpbmdzLnJhdGVzLCBmdW5jdGlvbihrZXksIHZhbCkge1xuICAgICAgICAgIGlmKHZhbC5pc28pXG4gICAgICAgICAgICBfcmF0ZXNbIHZhbC5pc28udG9VcHBlckNhc2UoKSBdID0gcGFyc2VGbG9hdCggdmFsLnJhdGVzICk7XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgXG4gICAgICBtZXRob2RzLl9kaWUoICBfcmF0ZXMgICApO1xuICAgICAgXG4gICAgICAvLyBpbml0IG1vbmV5XG4gICAgICBmeC5yYXRlcyA9IChfcmF0ZXMpID8gX3JhdGVzIDogZGF0YS5yYXRlcztcbiAgICAgIGZ4LmJhc2UgPSAoJF9zZXR0aW5ncy5jdXJyQmFzZSkgPyAkX3NldHRpbmdzLmN1cnJCYXNlIDogZGF0YS5iYXNlO1xuICAgICAgcmV0dXJuIF9yYXRlcztcbiAgICB9LFxuICAgIFxuICAgIF9jb252ZXJ0OiBmdW5jdGlvbiggcHJpY2luZywgZnJvbSwgdG8gKSB7XG4gICAgICBpZighcHJpY2luZykgcmV0dXJuIG51bGw7XG4gICAgICBcbiAgICAgIHZhciBfc2V0dGluZ3MgPSB7XG4gICAgICAgIGZyb206IChmcm9tKSA/IGZyb20udG9VcHBlckNhc2UoKSA6IGZhbHNlLFxuICAgICAgICB0bzogKHRvKSA/IHRvLnRvVXBwZXJDYXNlKCkgOiBmYWxzZSxcbiAgICAgIH07XG4gICAgICBcbiAgICAgIHJldHVybiBmeC5jb252ZXJ0KHByaWNpbmcsIF9zZXR0aW5ncyk7XG4gICAgfSxcbiAgICBcbiAgICBiaW5kRXZlbnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgLy8gY2xpY2tcbiAgICAgIGlmKCR0aGlzLmZpbmQoJy5zdG9yZS1mbGFncywgLnN0b3JlLWxpbmstY3VycmFuY3ktZmxhZycpLmxlbmd0aClcbiAgICAgICAgJHRoaXMuZmluZCgnLnN0b3JlLWZsYWdzLCAuc3RvcmUtbGluay1jdXJyYW5jeS1mbGFnJykub24oJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIHZhciBjdXJyX2NvbnZlcnQgPSAkKHRoaXMpLmF0dHIoJ2F0dHItcmF0ZXMtaXNvJyk7XG4gICAgICAgICAgXG4gICAgICAgICAgXG4gICAgICAgICAgaWYobWV0aG9kcy5nZXRDYWNoKCdjdXJySVNPJykgJiYgY3Vycl9jb252ZXJ0KSB7XG4gICAgICAgICAgICBpZihtZXRob2RzLmdldENhY2goJ2N1cnJJU08nKSAhPSBjdXJyX2NvbnZlcnQpIHtcbiAgICAgICAgICAgICAgbWV0aG9kcy5zZXRDYWNoKCdjdXJySVNPJywgY3Vycl9jb252ZXJ0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbWV0aG9kcy5zZXRDYWNoKCdjdXJySVNPJywgY3Vycl9jb252ZXJ0KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgXG4gICAgICAgICAgLy8gc3RhdHVzXG4gICAgICAgICAgJHRoaXMuZmluZCgnLnN0b3JlLWZsYWdzLCAuc3RvcmUtbGluay1jdXJyYW5jeS1mbGFnJykuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmKCQodGhpcykuaGFzQ2xhc3MoJ2FjdGl2ZScpKSB7XG4gICAgICAgICAgICAgICQodGhpcykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICAgIFxuICAgICAgICAgICQodGhpcykuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIGV2ZW50XG4gICAgICAgICAgbWV0aG9kcy5hZnRlckV2ZW50KCk7XG4gICAgICAgICAgLy8gYWxlcnQoIG1ldGhvZHMuX2NvbnZlcnQoMTAwLCAkX3NldHRpbmdzLmN1cnJCYXNlLCBjdXJyX2NvbnZlcnQgfHwgJF9zZXR0aW5ncy5jdXJyQmFzZSkgKTsgLy8gJ1VTRCcsICdFVVInXG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9KTtcbiAgICB9LFxuICAgIFxuICAgIHVuYmluZEV2ZW50OiBmdW5jdGlvbigpIHtcbiAgICAgICR0aGlzLmZpbmQoJy5zdG9yZS1mbGFncywgLnN0b3JlLWxpbmstY3VycmFuY3ktZmxhZycpLm9mZignY2xpY2snKTtcbiAgICB9LFxuICAgIFxuICAgIC8vIHNob3cgY3JlYXRlIGh0bWwgbGlzdCByYXRlc1xuICAgIHNob3c6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHN0YXR1cyA9IFtdO1xuICAgICAgbWV0aG9kcy5fZGllKCAkX3NldHRpbmdzLnJhdGVzICk7XG4gICAgICBcbiAgICAgIGlmKCRfc2V0dGluZ3MucmF0ZXMpIHtcbiAgICAgICAgJF9odG1sICs9ICc8c3Bhbj5DdXJyZW5jeTo8L3NwYW4+JztcbiAgICAgICAgLy8kX2h0bWwgKz0gJzx1bCBjbGFzcz1cImNsZWFyZml4XCI+JztcbiAgICAgICAgJC5lYWNoKCRfc2V0dGluZ3MucmF0ZXMsIGZ1bmN0aW9uKGtleSwgdmFsKSB7XG4gICAgICAgICAgc3RhdHVzWyBrZXkgXSA9ICh2YWwuaXNvLnRvVXBwZXJDYXNlKCkgPT0gJF9zZXR0aW5ncy5jdXJyQmFzZSkgPyAnYWN0aXZlJyA6ICcnO1xuICAgICAgICAgIC8vJF9odG1sICs9ICc8bGk+PHNwYW4gY2xhc3M9XCJzdG9yZS1mbGFncyBmbGFnLScrdmFsLmlzbysnICcrc3RhdHVzWyBrZXkgXSsnXCIgYXR0ci1yYXRlcy1pc289XCInK3ZhbC5pc28rJ1wiIGF0dHItcmF0ZXMtaWQ9XCInK3ZhbC5pZCsnXCI+PC9zcGFuPjwvbGk+JzsgLy8gJyt2YWwuaXNvLnRvVXBwZXJDYXNlKCkrJ1xuICAgICAgICAgICRfaHRtbCArPSAnPGEgY2xhc3M9XCJzdG9yZS1saW5rLWN1cnJhbmN5LWZsYWcgJytzdGF0dXNbIGtleSBdKydcIiBhdHRyLXJhdGVzLWlzbz1cIicrdmFsLmlzbysnXCIgYXR0ci1yYXRlcy1pZD1cIicrdmFsLmlkKydcIiBocmVmPVwiI1wiPjxpIGNsYXNzPVwiaWNvLWZsYWctJyt2YWwuaXNvKydcIj48L2k+PHNwYW4+Jyt2YWwuaXNvLnRvVXBwZXJDYXNlKCkrJzwvc3Bhbj48L2E+JztcbiAgICAgICAgfSk7XG4gICAgICAgIC8vJF9odG1sICs9ICc8L3VsPic7XG4gICAgICAgIFxuICAgICAgICAkdGhpcy5odG1sKCAkX2h0bWwgKTtcbiAgICAgICAgXG4gICAgICAgIG1ldGhvZHMuYmVmb3JlRXZlbnQoKTsgLy8gc2V0dXAgZGVmYXVsdFxuICAgICAgICBtZXRob2RzLmJpbmRFdmVudCgpO1xuICAgICAgfVxuICAgICAgXG4gICAgfSxcbiAgICBcbiAgICAvLyBiZWZvcmVFdmVudFxuICAgIGJlZm9yZUV2ZW50OiBmdW5jdGlvbigpIHtcbiAgICAgICQoJy5ib3gtY3VycmVuY2UnKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgX3N5bWJvbCA9ICQodGhpcykuZmluZCgnZGl2LnN5bWJvbCcpLFxuICAgICAgICAgICAgX2lzbyA9IF9zeW1ib2wuYXR0cignYXR0ci1pc28nKTtcbiAgICAgICAgaWYoIV9pc28ubGVuZ3RoKSBfc3ltYm9sLmF0dHIoJ2F0dHItaXNvJywgJF9zZXR0aW5ncy5jdXJyQmFzZSk7XG4gICAgICAgIGlmKCFfc3ltYm9sLmxlbmd0aCkgX3N5bWJvbC50ZXh0KCAkX3NldHRpbmdzLmN1cnJDb2RlWyAkX3NldHRpbmdzLmN1cnJCYXNlLnRvTG93ZXJDYXNlKCkgXSApO1xuICAgICAgfSk7XG4gICAgfSxcbiAgICBcbiAgICAvLyBhZnRlckV2ZW50XG4gICAgYWZ0ZXJFdmVudDogZnVuY3Rpb24oKSB7XG4gICAgICBjdXJyZW5jeUhhbmRsZXIub25DaGFuZ2UobWV0aG9kcy5nZXRDYWNoKCdjdXJySVNPJykpO1xuICAgICAgXG4gICAgICAkLmVhY2goJCgnLmJveC1jdXJyZW5jZScpLCBmdW5jdGlvbihpLCBib3hDdXJyKSB7XG4gICAgICAgIFxuICAgICAgICBtZXRob2RzLl9kaWUoICAkKGJveEN1cnIpICAgKTtcbiAgICAgICAgXG4gICAgICAgIHZhciBfc3ltYm9sID0gJCggYm94Q3VyciApLmZpbmQoJ2Rpdi5zeW1ib2wnKSxcbiAgICAgICAgICAgIF9wcmljZSA9ICQoIGJveEN1cnIgKS5maW5kKCdkaXYuY3VycicpLFxuICAgICAgICAgICAgc3ltYm9sID0gKF9zeW1ib2wpID8gX3N5bWJvbC50ZXh0KCkgOiBmYWxzZSxcbiAgICAgICAgICAgIHByaWNlID0gKF9wcmljZSkgPyBfcHJpY2UudGV4dCgpIDogZmFsc2UsXG4gICAgICAgICAgICBpc28gPSAoX3ByaWNlKSA/IF9zeW1ib2wuYXR0cignYXR0ci1pc28nKSA6IGZhbHNlO1xuICAgICAgICBcbiAgICAgICAgbWV0aG9kcy5fZGllKCAgJ2FmdGVyRXZlbnQuLi4nICAgKTtcbiAgICAgICAgbWV0aG9kcy5fZGllKCAgc3ltYm9sICAgKTtcbiAgICAgICAgbWV0aG9kcy5fZGllKCAgcHJpY2UgICApO1xuICAgICAgICBtZXRob2RzLl9kaWUoICBpc28gICApO1xuICAgICAgICBcbiAgICAgICAgaWYocHJpY2UpIHtcbiAgICAgICAgICBfcHJpY2UuaHRtbCggbWV0aG9kcy5fY29udmVydCggcGFyc2VGbG9hdChwcmljZSksXG4gICAgICAgICAgICAgIG1ldGhvZHMuZ2V0Q2FjaCgnY3VycklTTycpIHx8ICRfc2V0dGluZ3MuY3VyckJhc2UsXG4gICAgICAgICAgICAgIGlzb1xuICAgICAgICAgICkudG9GaXhlZCgyKSAgKTsgLy8gKS50b0ZpeGVkKDIpXG4gICAgICAgICAgX3N5bWJvbC5hdHRyKCdhdHRyLWlzbycsIG1ldGhvZHMuZ2V0Q2FjaCgnY3VycklTTycpKTtcbiAgICAgICAgICBfc3ltYm9sLnRleHQoICRfc2V0dGluZ3MuY3VyckNvZGVbIG1ldGhvZHMuZ2V0Q2FjaCgnY3VycklTTycpLnRvTG93ZXJDYXNlKCkgXSApXG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIFxuICAgICAgfSk7XG4gICAgICBcbiAgICB9LFxuICAgIFxuICAgIHJ1biA6IGZ1bmN0aW9uKCBwYXJhbXMgKSB7XG4gICAgICBtZXRob2RzLl9kaWUoIHBhcmFtcyApO1xuICAgICAgbWV0aG9kcy5fZGllKCAnUmF0ZXMgaW5pdCcgKTtcbiAgICAgIG1ldGhvZHMuX2RpZSggJF9zZXR0aW5ncy5yYXRlcyApO1xuICAgIH0sXG4gIH07XG4gIFxuICAvLyBjb25zdHJ1Y3RvclxuICAkLmZuLmN1cnJhbmN5ID0gZnVuY3Rpb24oIG1ldGhvZCwgdHlwZSApIHtcbiAgICBcbiAgICAvLyDQu9C+0LPQuNC60LAg0LLRi9C30L7QstCwINC80LXRgtC+0LTQsFxuICAgIGlmICggbWV0aG9kc1ttZXRob2RdICkge1xuICAgICAgcmV0dXJuIG1ldGhvZHNbIG1ldGhvZCBdLmFwcGx5KCB0aGlzLCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbCggYXJndW1lbnRzLCAxICkpO1xuICAgIH0gZWxzZSBpZiAoIHR5cGVvZiBtZXRob2QgPT09ICdvYmplY3QnIHx8ICEgbWV0aG9kICkge1xuICAgICAgbWV0aG9kcy5pbml0LmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTtcbiAgICAgIGlmKHR5cGVvZiB0eXBlICE9PSBcInVuZGVmaW5lZFwiICYmIG1ldGhvZHNbdHlwZV0pIHtcbiAgICAgICAgcmV0dXJuIG1ldGhvZHNbdHlwZV0uYXBwbHkoIHRoaXMsIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKCBhcmd1bWVudHMsIDEgKSk7XG4gICAgICB9XG4vLyAgICAgICAgICBlbHNlIHtcbi8vICAgICAgICAgICAgICByZXR1cm4gbWV0aG9kcy5pbml0LmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTtcbi8vICAgICAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgJC5lcnJvciggJ9Cc0LXRgtC+0LQg0YEg0LjQvNC10L3QtdC8ICcgKyAgbWV0aG9kICsgJyDQvdC1INGB0YPRidC10YHRgtCy0YPQtdGCINC00LvRjyBqUXVlcnkudG9vbHRpcCcgKTtcbiAgICB9XG4gICAgXG4gICAgXG4gIH07XG4gIFxufSkoIGpRdWVyeSApO1xuIFxuLy8gJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKXtcbi8vXG4vLyAgIGlmKCQoJy5saXN0LWN1cnJlbmNpZXMnKS5sZW5ndGgpIHtcbi8vICAgICAkKCcubGlzdC1jdXJyZW5jaWVzJykuY3VycmFuY3koe1xuLy8gICAgICAgb25PcGVuOiBmdW5jdGlvbihyYXRlcykge1xuLy8gICAgICAgICBjdXJyZW5jeUhhbmRsZXIuYWZ0ZXJMb2FkKHJhdGVzKTtcbi8vICAgICAgIH1cbi8vICAgICB9LCdzaG93Jyk7XG4vLyAgIH1cbi8vXG4vLyB9KTtcbiIsIi8qXG4gKiBcdEVhc3kgVG9vbHRpcCAxLjAgLSBqUXVlcnkgcGx1Z2luXG4gKlx0d3JpdHRlbiBieSBBbGVuIEdyYWthbGljXHRcbiAqXHRodHRwOi8vY3NzZ2xvYmUuY29tL3Bvc3QvNDM4MC9lYXN5LXRvb2x0aXAtLWpxdWVyeS1wbHVnaW5cbiAqXG4gKlx0Q29weXJpZ2h0IChjKSAyMDA5IEFsZW4gR3Jha2FsaWMgKGh0dHA6Ly9jc3NnbG9iZS5jb20pXG4gKlx0RHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIChNSVQtTElDRU5TRS50eHQpXG4gKlx0YW5kIEdQTCAoR1BMLUxJQ0VOU0UudHh0KSBsaWNlbnNlcy5cbiAqXG4gKlx0QnVpbHQgZm9yIGpRdWVyeSBsaWJyYXJ5XG4gKlx0aHR0cDovL2pxdWVyeS5jb21cbiAqXG4gKi9cbiBcbihmdW5jdGlvbigkKSB7XG5cblx0JC5mbi5lYXN5VG9vbHRpcCA9IGZ1bmN0aW9uKG9wdGlvbnMpe1xuXHQgIFxuXHRcdC8vIGRlZmF1bHQgY29uZmlndXJhdGlvbiBwcm9wZXJ0aWVzXG5cdFx0dmFyIGRlZmF1bHRzID0ge1x0XG5cdFx0XHR4T2Zmc2V0OiAxMCxcblx0XHRcdHlPZmZzZXQ6IDI1LFxuXHRcdFx0dG9vbHRpcElkOiBcImVhc3lUb29sdGlwXCIsXG5cdFx0XHRjbGlja1JlbW92ZTogZmFsc2UsXG5cdFx0XHRjb250ZW50OiBcIlwiLFxuXHRcdFx0dXNlRWxlbWVudDogXCJcIlxuXHRcdH07IFxuXHRcdFx0XG5cdFx0dmFyIG9wdGlvbnMgPSAkLmV4dGVuZChkZWZhdWx0cywgb3B0aW9ucyk7ICBcblx0XHR2YXIgY29udGVudDtcblx0XHRcdFx0XG5cdFx0dGhpcy5lYWNoKGZ1bmN0aW9uKCkgeyAgXHRcdFx0XHRcblx0XHRcdHZhciB0aXRsZSA9ICQodGhpcykuYXR0cihcInRpdGxlXCIpO1x0XHRcdFx0XG5cdFx0XHQkKHRoaXMpLmhvdmVyKGZ1bmN0aW9uKGUpe1x0XHRcdFx0XHRcdFx0XHRcdFx0XHQgXHRcdFx0XHRcdFx0XHQgICBcblx0XHRcdFx0Y29udGVudCA9IChvcHRpb25zLmNvbnRlbnQgIT0gXCJcIikgPyBvcHRpb25zLmNvbnRlbnQgOiB0aXRsZTtcblx0XHRcdFx0Y29udGVudCA9IChvcHRpb25zLnVzZUVsZW1lbnQgIT0gXCJcIikgPyAkKFwiI1wiICsgb3B0aW9ucy51c2VFbGVtZW50KS5odG1sKCkgOiBjb250ZW50O1xuXHRcdFx0XHQkKHRoaXMpLmF0dHIoXCJ0aXRsZVwiLFwiXCIpO1x0XHRcdFx0XHRcdFx0XHRcdCAgXHRcdFx0XHRcblx0XHRcdFx0aWYgKGNvbnRlbnQgIT0gXCJcIiAmJiBjb250ZW50ICE9IHVuZGVmaW5lZCl7XHRcdFx0XG5cdFx0XHRcdFx0JChcImJvZHlcIikuYXBwZW5kKFwiPGRpdiBpZD0nXCIrIG9wdGlvbnMudG9vbHRpcElkICtcIic+XCIrIGNvbnRlbnQgK1wiPC9kaXY+XCIpO1x0XHRcblx0XHRcdFx0XHQkKFwiI1wiICsgb3B0aW9ucy50b29sdGlwSWQpXG5cdFx0XHRcdFx0XHQuY3NzKFwicG9zaXRpb25cIixcImFic29sdXRlXCIpXG5cdFx0XHRcdFx0XHQuY3NzKFwidG9wXCIsKGUucGFnZVkgLSBvcHRpb25zLnlPZmZzZXQpICsgXCJweFwiKVxuXHRcdFx0XHRcdFx0LmNzcyhcImxlZnRcIiwoZS5wYWdlWCArIG9wdGlvbnMueE9mZnNldCkgKyBcInB4XCIpXHRcdFx0XHRcdFx0XG5cdFx0XHRcdFx0XHQuY3NzKFwiZGlzcGxheVwiLFwibm9uZVwiKVxuXHRcdFx0XHRcdFx0LmZhZGVJbihcImZhc3RcIilcblx0XHRcdFx0fVxuXHRcdFx0fSxcblx0XHRcdGZ1bmN0aW9uKCl7XHRcblx0XHRcdFx0JChcIiNcIiArIG9wdGlvbnMudG9vbHRpcElkKS5yZW1vdmUoKTtcblx0XHRcdFx0JCh0aGlzKS5hdHRyKFwidGl0bGVcIix0aXRsZSk7XG5cdFx0XHR9KTtcdFxuXHRcdFx0JCh0aGlzKS5tb3VzZW1vdmUoZnVuY3Rpb24oZSl7XG5cdFx0XHRcdCQoXCIjXCIgKyBvcHRpb25zLnRvb2x0aXBJZClcblx0XHRcdFx0XHQuY3NzKFwidG9wXCIsKGUucGFnZVkgLSBvcHRpb25zLnlPZmZzZXQpICsgXCJweFwiKVxuXHRcdFx0XHRcdC5jc3MoXCJsZWZ0XCIsKGUucGFnZVggKyBvcHRpb25zLnhPZmZzZXQpICsgXCJweFwiKVx0XHRcdFx0XHRcblx0XHRcdH0pO1x0XG5cdFx0XHRpZihvcHRpb25zLmNsaWNrUmVtb3ZlKXtcblx0XHRcdFx0JCh0aGlzKS5tb3VzZWRvd24oZnVuY3Rpb24oZSl7XG5cdFx0XHRcdFx0JChcIiNcIiArIG9wdGlvbnMudG9vbHRpcElkKS5yZW1vdmUoKTtcblx0XHRcdFx0XHQkKHRoaXMpLmF0dHIoXCJ0aXRsZVwiLHRpdGxlKTtcblx0XHRcdFx0fSk7XHRcdFx0XHRcblx0XHRcdH1cblx0XHR9KTtcblx0ICBcblx0fTtcblxufSkoalF1ZXJ5KTtcbiIsInZhciBkID0gZG9jdW1lbnQ7XG52YXIgc2FmYXJpID0gKG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UoKS5pbmRleE9mKCdzYWZhcmknKSAhPSAtMSkgPyB0cnVlIDogZmFsc2U7XG52YXIgZ2VidG4gPSBmdW5jdGlvbihwYXJFbCxjaGlsZCkgeyByZXR1cm4gcGFyRWwuZ2V0RWxlbWVudHNCeVRhZ05hbWUoY2hpbGQpOyB9O1xub25sb2FkID0gZnVuY3Rpb24oKSB7XG5cdFxuXHR2YXIgYm9keSA9IGdlYnRuKGQsJ2JvZHknKVswXTtcblx0Ym9keS5jbGFzc05hbWUgPSBib2R5LmNsYXNzTmFtZSAmJiBib2R5LmNsYXNzTmFtZSAhPSAnJyA/IGJvZHkuY2xhc3NOYW1lICsgJyBoYXMtanMnIDogJ2hhcy1qcyc7XG5cdFxuXHRpZiAoIWQuZ2V0RWxlbWVudEJ5SWQgfHwgIWQuY3JlYXRlVGV4dE5vZGUpIHJldHVybjtcblx0dmFyIGxzID0gZ2VidG4oZCwnbGFiZWwnKTtcblx0Zm9yICh2YXIgaSA9IDA7IGkgPCBscy5sZW5ndGg7IGkrKykge1xuXHRcdHZhciBsID0gbHNbaV07XG5cdFx0aWYgKGwuY2xhc3NOYW1lLmluZGV4T2YoJ2xhYmVsXycpID09IC0xKSBjb250aW51ZTtcblx0XHR2YXIgaW5wID0gZ2VidG4obCwnaW5wdXQnKVswXTtcblx0XHRpZiAobC5jbGFzc05hbWUgPT0gJ2xhYmVsX2NoZWNrJykge1xuXHRcdFx0bC5jbGFzc05hbWUgPSAoc2FmYXJpICYmIGlucC5jaGVja2VkID09IHRydWUgfHwgaW5wLmNoZWNrZWQpID8gJ2xhYmVsX2NoZWNrIGNfb24nIDogJ2xhYmVsX2NoZWNrIGNfb2ZmJztcblx0XHRcdGwub25jbGljayA9IGNoZWNrX2l0O1xuXHRcdH07XG5cdFx0aWYgKGwuY2xhc3NOYW1lID09ICdsYWJlbF9yYWRpbycpIHtcblx0XHRcdGwuY2xhc3NOYW1lID0gKHNhZmFyaSAmJiBpbnAuY2hlY2tlZCA9PSB0cnVlIHx8IGlucC5jaGVja2VkKSA/ICdsYWJlbF9yYWRpbyByX29uJyA6ICdsYWJlbF9yYWRpbyByX29mZic7XG5cdFx0XHRsLm9uY2xpY2sgPSB0dXJuX3JhZGlvO1xuXHRcdH07XG5cdH07XG59O1xudmFyIGNoZWNrX2l0ID0gZnVuY3Rpb24oKSB7XG5cdHZhciBpbnAgPSBnZWJ0bih0aGlzLCdpbnB1dCcpWzBdO1xuXHRpZiAodGhpcy5jbGFzc05hbWUgPT0gJ2xhYmVsX2NoZWNrIGNfb2ZmJyB8fCAoIXNhZmFyaSAmJiBpbnAuY2hlY2tlZCkpIHtcblx0XHR0aGlzLmNsYXNzTmFtZSA9ICdsYWJlbF9jaGVjayBjX29uJztcblx0XHRpZiAoc2FmYXJpKSBpbnAuY2xpY2soKTtcblx0fSBlbHNlIHtcblx0XHR0aGlzLmNsYXNzTmFtZSA9ICdsYWJlbF9jaGVjayBjX29mZic7XG5cdFx0aWYgKHNhZmFyaSkgaW5wLmNsaWNrKCk7XG5cdH07XG59O1xudmFyIHR1cm5fcmFkaW8gPSBmdW5jdGlvbigpIHtcblx0dmFyIGlucCA9IGdlYnRuKHRoaXMsJ2lucHV0JylbMF07XG5cdGlmICh0aGlzLmNsYXNzTmFtZSA9PSAnbGFiZWxfcmFkaW8gcl9vZmYnIHx8IGlucC5jaGVja2VkKSB7XG5cdFx0dmFyIGxzID0gZ2VidG4odGhpcy5wYXJlbnROb2RlLCdsYWJlbCcpO1xuXHRcdGZvciAodmFyIGkgPSAwOyBpIDwgbHMubGVuZ3RoOyBpKyspIHtcblx0XHRcdHZhciBsID0gbHNbaV07XG5cdFx0XHRpZiAobC5jbGFzc05hbWUuaW5kZXhPZignbGFiZWxfcmFkaW8nKSA9PSAtMSkgIGNvbnRpbnVlO1xuXHRcdFx0bC5jbGFzc05hbWUgPSAnbGFiZWxfcmFkaW8gcl9vZmYnO1xuXHRcdH07XG5cdFx0dGhpcy5jbGFzc05hbWUgPSAnbGFiZWxfcmFkaW8gcl9vbic7XG5cdFx0aWYgKHNhZmFyaSkgaW5wLmNsaWNrKCk7XG5cdH0gZWxzZSB7XG5cdFx0dGhpcy5jbGFzc05hbWUgPSAnbGFiZWxfcmFkaW8gcl9vZmYnO1xuXHRcdGlmIChzYWZhcmkpIGlucC5jbGljaygpO1xuXHR9O1xufTsiLCIkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpeyBcblxuICAgIC8vIGNyZWF0ZSBjb29raWVcbiAgICBpZih0eXBlb2YgJC5jb29raWUoJ2ZseV9mZWF0dXJlcycpID09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgJC5jb29raWUoJ2ZseV9mZWF0dXJlcycsIDAsIHsgIFxuICAgICAgICAgICAgZXhwaXJlczogMSAvLyDRg9GB0YLQsNC90L7QstC40YLRjCDQvdCwINGB0YPRgtC60LggIFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgXG4gICAgJCh3aW5kb3cpLnNjcm9sbChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIGlmICgkKHRoaXMpLnNjcm9sbFRvcCgpID4gMTAwICYmIFxuICAgICAgICAgICAgICAgICAgICB0eXBlb2YgJC5jb29raWUoJ2ZseV9mZWF0dXJlcycpICE9PSBcInVuZGVmaW5lZFwiICYmXG4gICAgICAgICAgICAgICAgICAgICFwYXJzZUludCggJC5jb29raWUoJ2ZseV9mZWF0dXJlcycpICkgKSB7XG4gICAgICAgICAgICAgICAgICAgICQoJyNmbHlfZmVhdHVyZXMnKS5mYWRlSW4oKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICQoJyNmbHlfZmVhdHVyZXMnKS5mYWRlT3V0KCk7XG4gICAgICAgICAgICB9XG4gICAgfSk7XG4gICAgXG4vLyAgICBpZih0eXBlb2YgJC5jb29raWUoJ2ZseV9mZWF0dXJlcycpICE9PSBcInVuZGVmaW5lZFwiIFxuLy8gICAgICAgICAgICAgICAgJiYgIXBhcnNlSW50KCAkLmNvb2tpZSgnZmx5X2ZlYXR1cmVzJykgKSkge1xuLy8gICAgICAgICAgICAkKCcjZmx5X2ZlYXR1cmVzJykuY3NzKHsnZGlzcGxheSc6ICdpbmxpbmUtYmxvY2snfSk7XG4vLyAgICB9XG4gICAgXG4gICAgaWYoJCgnLmZseV9jbG9zZScpLmxlbmd0aCkge1xuICAgICAgICAkKCcuZmx5X2Nsb3NlJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLmhpZGUoKTtcbiAgICAgICAgICAgIGlmKHR5cGVvZiAkLmNvb2tpZSgnZmx5X2ZlYXR1cmVzJykgIT09IFwidW5kZWZpbmVkXCIgXG4gICAgICAgICAgICAgICAgJiYgIXBhcnNlSW50KCAkLmNvb2tpZSgnZmx5X2ZlYXR1cmVzJykgKSkge1xuICAgICAgICAgICAgICAgICQuY29va2llKCdmbHlfZmVhdHVyZXMnLCAxKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9KTtcbiAgICB9XG59KTtcblxuIiwiLy8gZml4IGllOCAtIDEwXG52YXIgYWxlcnRGYWxsYmFjayA9IGZhbHNlO1xuaWYgKHR5cGVvZiBjb25zb2xlID09PSBcInVuZGVmaW5lZFwiIHx8IHR5cGVvZiBjb25zb2xlLmxvZyA9PT0gXCJ1bmRlZmluZWRcIikge1xuICAgIGNvbnNvbGUgPSB7fTtcbiAgICBpZiAoYWxlcnRGYWxsYmFjaykge1xuICAgICAgICBjb25zb2xlLmxvZyA9IGZ1bmN0aW9uIChtc2cpIHtcbiAgICAgICAgICAgIGFsZXJ0KG1zZyk7XG4gICAgICAgIH07XG4gICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2cgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIH07XG4gICAgfVxufVxuXG4oZnVuY3Rpb24gKCQpIHtcblx0XG5cdHZhciAkX3Jlc3VsdCA9IHtcbiAgICAgICAgJ19wbGFucyc6IGZhbHNlLFxuICAgICAgICAnX21vYmlsZSc6IGZhbHNlXG4gICAgfTtcbiAgICB2YXIgJHRoaXMgPSB7fTtcblxuICAgIHZhciBfc2V0dGluZ3MgPSB7XG4gICAgICAgICdwbGFuJzogZmFsc2UsXG4gICAgICAgICdtb2JpbGUnOiBmYWxzZVxuICAgIH1cblxuICAgIC8vIGRldGVjdGVkIG1ldGhvZFxuICAgIHZhciBtZXRob2RzID0ge1xuICAgICAgICBpbml0OiBmdW5jdGlvbiAob3B0aW9ucykge1xuXG4gICAgICAgICAgICAvLyBzZXQgZmlsdGVyc1xuICAgICAgICAgICAgaWYgKHR5cGVvZiBvcHRpb25zLmZpbHRlcnMgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgICAgICBfc2V0dGluZ3MucGxhbnMgPSAob3B0aW9ucy5maWx0ZXJzLnBsYW5zKSA/IG9wdGlvbnMuZmlsdGVycy5wbGFucyA6IG51bGw7XG4gICAgICAgICAgICAgICAgX3NldHRpbmdzLm1vYmlsZSA9IChvcHRpb25zLmZpbHRlcnMubW9iaWxlKSA/IG9wdGlvbnMuZmlsdGVycy5tb2JpbGUgOiBudWxsO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXR1cm4gJCh0aGlzKTtcbiAgICAgICAgfSwgLy8gc2V0IGluaXRcblxuICAgICAgICBfY2xlYXJDYWNoOiBmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICBpZiAoa2V5KSB7XG4gICAgICAgICAgICAgICAgalF1ZXJ5LmRhdGEod2luZG93LCBrZXksIGZhbHNlKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgalF1ZXJ5LmRhdGEod2luZG93LCAnX3Jlc3VsdCcsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICBqUXVlcnkuZGF0YSh3aW5kb3csICdfcGxhbnMnLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgalF1ZXJ5LmRhdGEod2luZG93LCAnX21vYmlsZScsIGZhbHNlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9LFxuICAgICAgICBfY2FjaDogZnVuY3Rpb24gKHBhcmFtcywga2V5KSB7XG4gICAgICAgICAgICBrZXkgPSAoIWtleSkgPyBcIl9yZXN1bHRcIiA6IGtleTtcbiAgICAgICAgICAgIGlmIChwYXJhbXMpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4galF1ZXJ5LmRhdGEod2luZG93LCBrZXksIHBhcmFtcyk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIHJldHVybiBqUXVlcnkuZGF0YSh3aW5kb3csIGtleSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sIC8vIHNldCBjYWhjZVxuXG4gICAgICAgIF9wbGFuczogZnVuY3Rpb24gKCApIHtcbiAgICAgICAgICAgIGlmIChfc2V0dGluZ3MucGxhbnMpIHtcbiAgICAgICAgICAgICAgICB2YXIgX3JlcyA9IFtdO1xuICAgICAgICAgICAgICAgICQuZWFjaCgkdGhpcywgZnVuY3Rpb24gKGtleSwgaXRlbV9vYmopIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyICRfaXRlbSA9ICQoaXRlbV9vYmopO1xuICAgICAgICAgICAgICAgICAgICB2YXIgJHVzZV9wbGFucyA9ICRfaXRlbS5hdHRyKCdhdHRyLXVzZS1wbGFuJykuc3BsaXQoJ3wnKTtcblxuICAgICAgICAgICAgICAgICAgICBpZiAoJC5pbkFycmF5KF9zZXR0aW5ncy5wbGFucywgJHVzZV9wbGFucykgIT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9yZXNbJF9pdGVtLmluZGV4KCldID0gJF9pdGVtLmluZGV4KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIG1ldGhvZHMuX2NhY2goX3JlcywgXCJfcGxhbnNcIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG1ldGhvZHMuX2NsZWFyQ2FjaCgnX3BsYW5zJyk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ05vdCBlbnRlciBmaWx0ZXJzIFBsYW5zICgqc2V0dGluZ3MpIScpO1xuICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgfSwgLy8gc2V0IHBsYW5zIGZpbHRlcnNcblxuICAgICAgICBfbW9iaWxlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoX3NldHRpbmdzLm1vYmlsZSkge1xuICAgICAgICAgICAgICAgIHZhciBfcmVzID0gW107XG4gICAgICAgICAgICAgICAgaWYgKCEkX3Jlc3VsdC5fcGxhbnMpIHtcbiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKF9zZXR0aW5ncy5tb2JpbGUsIGZ1bmN0aW9uIChfdHlwZSwgX3N0YXR1cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9zdGF0dXMgPT0gdHJ1ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQuZWFjaCgkdGhpcywgZnVuY3Rpb24gKGtleSwgaXRlbV9vYmopIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRfaXRlbSA9ICQoaXRlbV9vYmopO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJF9pdGVtLmZpbmQoJy5ib3gtZmlsdGVyLW1vYmlsZSBpLmljb24tJyArIF90eXBlICsgJycpLmlzKCcuc3VwcG9ydGVkJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9yZXNbICRfaXRlbS5pbmRleCgpIF0gPSAkX2l0ZW0uaW5kZXgoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICQuZWFjaCgkdGhpcywgZnVuY3Rpb24gKGtleSwgaXRlbV9vYmopIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkX2l0ZW0gPSAkKGl0ZW1fb2JqKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkLmluQXJyYXkoJF9pdGVtLmluZGV4KCksICRfcmVzdWx0Ll9wbGFucykgIT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2goX3NldHRpbmdzLm1vYmlsZSwgZnVuY3Rpb24gKF90eXBlLCBfc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfc3RhdHVzID09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkX2l0ZW0uZmluZCgnLmJveC1maWx0ZXItbW9iaWxlIGkuaWNvbi0nICsgX3R5cGUgKyAnJykuaXMoJy5zdXBwb3J0ZWQnKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfcmVzWyAkX2l0ZW0uaW5kZXgoKSBdID0gJF9pdGVtLmluZGV4KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgbWV0aG9kcy5fY2FjaChfcmVzLCBcIl9tb2JpbGVcIik7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIG1ldGhvZHMuX2NsZWFyQ2FjaCgnX21vYmlsZScpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdOb3QgZW50ZXIgZmlsdGVycyBtb2JpbGUgKCpzZXR0aW5ncykhJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSwgLy8gc2V0IG1vYmlsZSBmaWx0ZXJzXG4gICAgICAgIF9ydW46IGZ1bmN0aW9uIChvYmopIHtcbiAgICAgICAgICAgIGlmICghb2JqLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdOb3QgZGV0ZWN0ZWQgT2JqZWN0cyEnKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICR0aGlzID0gb2JqO1xuXG4gICAgICAgICAgICBtZXRob2RzLl9wbGFucygpOyAvLyBkZXRlY3RlZCBwbGFuc1xuICAgICAgICAgICAgJF9yZXN1bHQuX3BsYW5zID0gbWV0aG9kcy5fY2FjaChmYWxzZSwgXCJfcGxhbnNcIik7IC8vIGdldCBwYXJhbXMgcGxhbnMgaW4gY2FjaGVcblxuICAgICAgICAgICAgaWYgKHR5cGVvZiAkX3Jlc3VsdC5fcGxhbnMgPT09IFwidW5kZWZpbmVkXCIpXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ05vdCBlbnRlciBwbGFucyBmaWx0ZXJzIScpO1xuICAgICAgICAgICAgbWV0aG9kcy5fbW9iaWxlKCk7IC8vIGRldGVjdGVkIGZpbHRlcnMgbW9iaWxlXG4gICAgICAgICAgICAkX3Jlc3VsdC5fbW9iaWxlID0gbWV0aG9kcy5fY2FjaChmYWxzZSwgXCJfbW9iaWxlXCIpOyAvLyBnZXQgcGFyYW1zIG1vYmlsZSBpbiBjYWNoZVxuICAgICAgICAgICAgaWYgKHR5cGVvZiAkX3Jlc3VsdC5fbW9iaWxlID09PSBcInVuZGVmaW5lZFwiKVxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdOb3QgZW50ZXIgbW9iaWxlIGZpbHRlciEnKTtcbiAgICAgICAgICAgIG1ldGhvZHMuX3Zpc2libGUoJF9yZXN1bHQpOyAvLyBzaG93L2hpZGUgZWxlbWVudHNcbiAgICAgICAgfSxcbiAgICAgICAgX3Zpc2libGU6IGZ1bmN0aW9uIChhcnJfaW5kZXgpIHtcbiAgICAgICAgICAgIGlmICgkdGhpcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBhcnJfaW5kZXguX3BsYW5zICE9PSBcInVuZGVmaW5lZFwiICYmIGFycl9pbmRleC5fcGxhbnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAkLmVhY2goJHRoaXMsIGZ1bmN0aW9uIChrZXksIGl0ZW1fb2JqKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgJF9pdGVtID0gJChpdGVtX29iaik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoYXJyX2luZGV4Ll9wbGFucy5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2V0IHBsYW5zXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQuaW5BcnJheSgkX2l0ZW0uaW5kZXgoKSwgYXJyX2luZGV4Ll9wbGFucykgIT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRfaXRlbS5oYXNDbGFzcygnaGlkZScpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJF9pdGVtLnJlbW92ZUNsYXNzKCdoaWRlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRfaXRlbS5hZGRDbGFzcygnc2hvdycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkX2l0ZW0uaGFzQ2xhc3MoJ3Nob3cnKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRfaXRlbS5yZW1vdmVDbGFzcygnc2hvdycpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRfaXRlbS5hZGRDbGFzcygnaGlkZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICB9KTsgLy8gc2hvdy9oaWRlIGVsZW1lbnRzIHBsYW5zXG5cbiAgICAgICAgICAgICAgICAgICAgLy8gZmlsdGVyIG1vYmlsZSBpbiBwbGFuc1xuICAgICAgICAgICAgICAgICAgICBpZiAoYXJyX2luZGV4Ll9tb2JpbGUubGVuZ3RoID4gMCAmJiB0eXBlb2YgYXJyX2luZGV4Ll9tb2JpbGUgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQuZWFjaCgkdGhpcywgZnVuY3Rpb24gKGtleSwgaXRlbV9vYmopIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJF9pdGVtID0gJChpdGVtX29iaik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQuaW5BcnJheSgkX2l0ZW0uaW5kZXgoKSwgYXJyX2luZGV4Ll9tb2JpbGUpICE9IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkX2l0ZW0uaGFzQ2xhc3MoJ2hpZGUnKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRfaXRlbS5yZW1vdmVDbGFzcygnaGlkZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkX2l0ZW0uYWRkQ2xhc3MoJ3Nob3cnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJF9pdGVtLmhhc0NsYXNzKCdzaG93JykpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkX2l0ZW0ucmVtb3ZlQ2xhc3MoJ3Nob3cnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkX2l0ZW0uYWRkQ2xhc3MoJ2hpZGUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSAvLyBzaG93L2hpZGUgbW9iaWxlIGluIHBsYW5zXG5cblxuICAgICAgICAgICAgICAgIH0gLy8gZmlsdGVycyBwbGFuc1xuXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAoIWFycl9pbmRleC5fcGxhbnMubGVuZ3RoXG4gICAgICAgICAgICAgICAgICAgICAgICAmJiB0eXBlb2YgYXJyX2luZGV4Ll9tb2JpbGUgIT09IFwidW5kZWZpbmVkXCJcbiAgICAgICAgICAgICAgICAgICAgICAgICYmIGFycl9pbmRleC5fbW9iaWxlLmxlbmd0aCA+IDApIHtcblxuICAgICAgICAgICAgICAgICAgICAkLmVhY2goJHRoaXMsIGZ1bmN0aW9uIChrZXksIGl0ZW1fb2JqKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgJF9pdGVtID0gJChpdGVtX29iaik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJC5pbkFycmF5KCRfaXRlbS5pbmRleCgpLCBhcnJfaW5kZXguX21vYmlsZSkgIT0gLTEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJF9pdGVtLmhhc0NsYXNzKCdoaWRlJykpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRfaXRlbS5yZW1vdmVDbGFzcygnaGlkZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRfaXRlbS5hZGRDbGFzcygnc2hvdycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJF9pdGVtLmhhc0NsYXNzKCdzaG93JykpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRfaXRlbS5yZW1vdmVDbGFzcygnc2hvdycpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJF9pdGVtLmFkZENsYXNzKCdoaWRlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gLy8gYWxsIG1vYmlsZSBmaWx0ZXJzXG4gICAgICAgICAgICAgICAgZWxzZSB7XG5cbiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKCR0aGlzLCBmdW5jdGlvbiAoa2V5LCBpdGVtX29iaikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRfaXRlbSA9ICQoaXRlbV9vYmopO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRfaXRlbS5oYXNDbGFzcygnaGlkZScpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRfaXRlbS5yZW1vdmVDbGFzcygnaGlkZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJF9pdGVtLmFkZENsYXNzKCdzaG93Jyk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBzaG93OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICByZXR1cm4gbWV0aG9kcy5fcnVuKCQodGhpcykpO1xuICAgICAgICB9LFxuICAgICAgICB1cGRhdGU6IGZ1bmN0aW9uIChjb250ZW50KSB7XG4gICAgICAgICAgICAvLyAhISFcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICAvLyBjb25zdHJ1Y3RvclxuICAgICQuZm4udGFiUHVtcGljID0gZnVuY3Rpb24gKG1ldGhvZCkge1xuXG4gICAgICAgIC8vINC70L7Qs9C40LrQsCDQstGL0LfQvtCy0LAg0LzQtdGC0L7QtNCwXG4gICAgICAgIGlmIChtZXRob2RzW21ldGhvZF0pIHtcbiAgICAgICAgICAgIHJldHVybiBtZXRob2RzWyBtZXRob2QgXS5hcHBseSh0aGlzLCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKTtcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlb2YgbWV0aG9kID09PSAnb2JqZWN0JyB8fCAhbWV0aG9kKSB7XG4gICAgICAgICAgICByZXR1cm4gbWV0aG9kcy5pbml0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAkLmVycm9yKCfQnNC10YLQvtC0INGBINC40LzQtdC90LXQvCAnICsgbWV0aG9kICsgJyDQvdC1INGB0YPRidC10YHRgtCy0YPQtdGCINC00LvRjyBqUXVlcnkudG9vbHRpcCcpO1xuICAgICAgICB9XG5cblxuICAgIH07XG5cbn0pKGpRdWVyeSk7XG5cbi8vIGdsb2JhIHZhcmlhYmxlXG4kZGF0YV9oYXNoID0gW107XG5cbnZhciBfaHRtbFBvcFVwID0ge1xuICAgICdib3hTdGF0dXNBdXRoJzogJzxkaXYgaWQ9XCJib3gtc3RhdHVzLWF1dGhcIiBjbGFzcz1cInBvcFVwXCI+PGRpdj48bGFiZWwgY2xhc3M9XCJ0aXRsZSBnb2xkXCI+SGVsbG8hPGkgY2xhc3M9XCJjbG9zZSBzbWFsbFwiPjwvaT48L2xhYmVsPjwvZGl2PidcbiAgICAgICAgICAgICsgJzxwIGNsYXNzPVwiaW5mb1wiPllvdSBoYXZlIGp1c3QgbG9nZ2VkIGludG8gUHVtcGljLmNvbSwgZW5qb3kgeW91ciB0aW1lIHdpdGggdXMgb3IgZ28gc3RyYWlnaHQgdG8geW91ciA8YSBjbGFzcz1cImEtZGVmYXVsdFwiIGhyZWY9XCJodHRwczovL2NwLnB1bXBpYy5jb21cIj5hY2NvdW50PC9hPi48L3A+J1xuICAgICAgICAgICAgKyAnPC9kaXY+JyxcbiAgICAnYm94U3RhdHVzUmVnaXN0cmF0aW9uJzogJzxkaXYgaWQ9XCJib3gtc3RhdHVzLXJlZ2lzdHJhdGlvblwiIGNsYXNzPVwicG9wVXBcIj4nXG4gICAgICAgICAgICArICc8ZGl2PjxsYWJlbCBjbGFzcz1cInRpdGxlIGdvbGRcIj5IZWxsbyE8aSBjbGFzcz1cImNsb3NlIHNtYWxsXCI+PC9pPjwvbGFiZWw+PC9kaXY+J1xuICAgICAgICAgICAgKyAnPHAgY2xhc3M9XCJpbmZvXCI+WW91IGhhdmUganVzdCByZWdpc3RlcmVkIGluIFB1bXBpYy5jb20sIGVuam95IHlvdXIgdGltZSB3aXRoIHVzIG9yIGdvIHN0cmFpZ2h0IHRvIHlvdXIgPGEgY2xhc3M9XCJhLWRlZmF1bHRcIiBocmVmPVwiaHR0cHM6Ly9jcC5wdW1waWMuY29tXCI+YWNjb3VudDwvYT4uPC9wPidcbiAgICAgICAgICAgICsgJzwvZGl2PicsXG4gICAgJ2JveFN0YXR1c0ZyZWVUcmlhbFJlZ2lzdHJhdGlvbic6ICc8ZGl2IGlkPVwiYm94LXN0YXR1cy1mcmVlLXRyaWFsLXJlZ2lzdHJhdGlvblwiIGNsYXNzPVwicG9wVXBcIj4nXG4gICAgICAgICAgICArICc8ZGl2PjxsYWJlbCBjbGFzcz1cInRpdGxlIGdvbGRcIj5UaGFuayB5b3UgZm9yIHNpZ25pbmcgdXAhPGkgY2xhc3M9XCJjbG9zZSBzbWFsbFwiPjwvaT48L2xhYmVsPjwvZGl2PidcbiAgICAgICAgICAgICsgJzxwIGNsYXNzPVwiaW5mb1wiPlRoZSBlbWFpbCB3aXRoIHJlZ2lzdHJhdGlvbiBkZXRhaWxzIHdhcyBzZW50IHRvICcgKyBVc2VyTG9naW4gKyAnLjxiciAvPiBZb3UgY2FuIGdvIHN0cmFpZ2h0IHRvIHlvdXIgPGEgY2xhc3M9XCJhLWRlZmF1bHRcIiBocmVmPVwiaHR0cHM6Ly9jcC5wdW1waWMuY29tXCI+UGVyc29uYWwgQWNjb3VudDwvYT4gbm93LjwvcD4nXG4gICAgICAgICAgICArICc8L2Rpdj4nLFxuICAgICdlbWFpbF9zdWNjZXNzJzogJzxkaXYgaWQ9XCJib3gtZW1haWwtc3VjY2Vzc1wiIGNsYXNzPVwicG9wVXBcIj4nXG4gICAgICAgICAgICArICc8ZGl2PjxsYWJlbCBjbGFzcz1cInRpdGxlIGdvbGRcIj4gVGhhbmsgeW91ISA8aSBjbGFzcz1cImNsb3NlIHNtYWxsXCI+PC9pPjwvbGFiZWw+PC9kaXY+J1xuICAgICAgICAgICAgKyAnPGRpdiBjbGFzcz1cImluZm8gdGV4dC1jZW50ZXJcIj4gWW91ciBkaXNjb3VudCBjb2RlIHdpbGwgYmUgc2VudCB0byB5b3Ugc29vbi4nXG4gICAgICAgICAgICArICc8Zm9ybT48ZGl2PjxhIGhyZWY9XCIjXCIgY2xhc3M9XCJidXR0b24tcmVkIGJ0bi1kZWZhdWx0IGJsb2NrLXBvcFVwLWNsb3NlXCI+Q2xvc2U8L2E+PC9kaXY+PC9mb3JtPidcbiAgICAgICAgICAgICsgJzwvZGl2PjwvZGl2PicsXG4gICAgJ2JveF9lbWFpbCc6ICc8ZGl2IGlkPVwiYm94LWVtYWlsXCIgY2xhc3M9XCJwb3BVcFwiPidcbiAgICAgICAgICAgICsgJzxkaXY+PGxhYmVsIGNsYXNzPVwidGl0bGUgZ29sZFwiPiA8Yj4xMCU8L2I+IG9mZjxpIGNsYXNzPVwiY2xvc2Ugc21hbGxcIj48L2k+PC9sYWJlbD48L2Rpdj4nXG4gICAgICAgICAgICArICc8ZGl2IGNsYXNzPVwiaW5mbyB0ZXh0LWNlbnRlclwiPldhbnQgdG8gZ2V0IDxhIGNsYXNzPVwiYS1kZWZhdWx0XCIgaHJlZj1cIiNcIj4xMCUgZGlzY291bnQ8L2E+IHJpZ2h0IG5vdz88YnIgLz5TdWJzY3JpYmUgdG8gb3VyIHNwZWNhaWwgcHJvbW8hJ1xuICAgICAgICAgICAgKyAnPGZvcm0gY2xhc3M9XCJibG9jay1wb3B1cC1mb3JtIHRleHQtY2VudGVyXCI+J1xuICAgICAgICAgICAgKyAnPGRpdj48aW5wdXQgaWQ9XCJlbWFpbFwiIGNsYXNzPVwicmVxdWlyZWRcIiB0eXBlPVwiZW1haWxcIiBuYW1lPVwiZW1haWxcIiB2YWx1ZT1cIlwiIHBsYWNlaG9sZGVyPVwiZW1haWxcIiAvPidcbiAgICAgICAgICAgICsgJzxkaXYgaWQ9XCJlbWFpbC1lcnJvclwiIGNsYXNzPVwiZXJyb3JcIj48L2Rpdj48L2Rpdj48ZGl2PjxidXR0b24gY2xhc3M9XCJidXR0b24tcmVkIGJ0bi1kZWZhdWx0XCI+U2F2ZSAxMCUgdG9kYXk8L2J1dHRvbj48L2Rpdj4nXG4gICAgICAgICAgICArICc8L2Zvcm0+PC9kaXY+PC9kaXY+Jyxcbn07XG5cbi8vIGFuY2hvclxualF1ZXJ5KGZ1bmN0aW9uICgpIHtcbiAgICBqUXVlcnkod2luZG93KS5oYXNoY2hhbmdlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKGRvY3VtZW50LmxvY2F0aW9uLmhhc2ggPT0gJycpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHZhciBoYXNoID0gbG9jYXRpb24uaGFzaC5zcGxpdCgnIycpO1xuICAgICAgICBpZiAoaGFzaC5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICAkZGF0YV9oYXNoID0gaGFzaFsxXTtcbiAgICAgICAgICAgIGhhc2hjaGFuZ2Vfb25Mb2FkSW5pdCgpO1xuXG4gICAgICAgICAgICAvLyBpZigkKCcuYm94LWFuY2hvciAjJytoYXNoWzFdKS5sZW5ndGgpXG4gICAgICAgICAgICAvL2lmKHR5cGVvZiAkKCcuYm94LWFuY2hvciAjJytoYXNoWzFdKSA9PSBcIm9iamVjdFwiKVxuICAgICAgICAgICAgLy8gICAgJCgnaHRtbCwgYm9keScpLmFuaW1hdGUoe3Njcm9sbFRvcDogJCgnLmJveC1hbmNob3IgIycraGFzaFsxXSkub2Zmc2V0KCkudG9wfSwgODAwKTtcbiAgICAgICAgfVxuXG4gICAgfSk7XG4gICAgalF1ZXJ5KHdpbmRvdykuaGFzaGNoYW5nZSgpO1xufSk7XG5cbi8vIGluaXQgY29va2llc1xuZnVuY3Rpb24gY29va2llX2luaXQoKSB7XG4vLyAgICBpZighZ2V0Q29va2llKCdwb3BVcCcpKSB7XG4vLyAgICAgICAgJC5jb29raWUoJ3BvcFVwJywgZmFsc2UsIHtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgZXhwaXJlczogNyxcbi8vICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogJy8nXG4vLyAgICAgICAgICAgICAgICAgICAgfSk7XG4vLyAgICB9XG5cbiAgICAvLyBzYXZlIGNvb2tpZSBzY3JlZW4gd2luZG93XG4gICAgaWYgKCFnZXRDb29raWUoJ19zY3JlZW4nKSkge1xuICAgICAgICAkLmNvb2tpZSgnX3NjcmVlbicsICQod2luZG93KS53aWR0aCgpICsgJ3gnICsgJCh3aW5kb3cpLmhlaWdodCgpLCB7ZXhwaXJlczogNywgcGF0aDogJy8nLCBkb21haW46ICcucHVtcGljLmNvbSd9KTtcbiAgICB9XG5cbn1cblxuZnVuY3Rpb24gY29weV90b19jbGlwYm9hcmRfaW5pdCgpIHtcbiAgICB2YXIgY2xpZW50ID0gbmV3IFplcm9DbGlwYm9hcmQoJChcIi5jb3B5LXRvLWNsaXBib2FyZFwiKSk7XG5cbiAgICBjbGllbnQub24oXCJjb3B5XCIsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICB2YXIgY2xpcGJvYXJkID0gZXZlbnQuY2xpcGJvYXJkRGF0YTtcbiAgICAgICAgY2xpcGJvYXJkLnNldERhdGEoXCJ0ZXh0L3BsYWluXCIsICQoJy5jb3B5LXRoaXMnKS52YWwoKSk7XG4gICAgfSk7XG5cbiAgICBjbGllbnQub24oJ2FmdGVyY29weScsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAkKCcuY29weS1kb25lJykuc2hvdygpLmZhZGVPdXQoMTUwMCk7XG4gICAgfSk7XG5cbn1cblxuZnVuY3Rpb24gY29va2llX2NsZWFyKCkge1xuICAgIGlmICgkLmNvb2tpZSgncG9wVXAnKSkge1xuICAgICAgICAkLnJlbW92ZUNvb2tpZSgncG9wVXAnLCB7cGF0aDogJy8nfSk7XG4gICAgfVxufVxuXG5mdW5jdGlvbiBzZXRDb29raWUobmFtZSwgdmFsdWUpIHtcbiAgICAkLmNvb2tpZShuYW1lLCB2YWx1ZSwge2V4cGlyZXM6IDcsIHBhdGg6ICcvJ30pO1xufVxuXG5mdW5jdGlvbiBnZXRDb29raWUobmFtZSkge1xuICAgIGlmICgkLmNvb2tpZShuYW1lKSkge1xuICAgICAgICByZXR1cm4gJC5jb29raWUobmFtZSk7XG4gICAgfSBlbHNlXG4gICAgICAgIHJldHVybiBmYWxzZTtcbn1cblxuLy8gaW5pdCBoYXNoY2hhbmdlICggaW5pdCBiUG9wVXAgKVxuZnVuY3Rpb24gaGFzaGNoYW5nZV9vbkxvYWRJbml0KCkge1xuXG59XG5cbmZ1bmN0aW9uIGhhc2hjaGFuZ2VfQWZ0ZXJJbml0KCkge1xuICAgIHZhciBfZGF0YSA9IF9wYXJjZUhhc2goJGRhdGFfaGFzaCk7XG4gICAgdmFyICRfcG9wVXAgPSAkKCcuYm94LXBvcFVwJyksXG4gICAgICAgICAgICAkYXV0aCA9ICRfcG9wVXAuZmluZCgnI2JveC1zdGF0dXMtYXV0aCcpLFxuICAgICAgICAgICAgJHJlZ2lzdHJhdGlvbiA9ICRfcG9wVXAuZmluZCgnI2JveC1zdGF0dXMtcmVnaXN0cmF0aW9uJyksXG4gICAgICAgICAgICAkdHJpYWxfcmVnaXN0cmF0aW9uID0gJF9wb3BVcC5maW5kKCcjYm94LXN0YXR1cy1mcmVlLXRyaWFsLXJlZ2lzdHJhdGlvbicpO1xuICAgIC8vIGluaXQgYlBvcFVwXG4gICAgaWYgKGlzc2V0KF9kYXRhWydwb3BVcCddKSAmJiBfaGFzVXNlciA9PSAndHJ1ZScpIHtcblxuICAgICAgICBpZiAoX2RhdGFbJ3BvcFVwJ10gPT0gXCJhdXRoXCIpIHsgLy8gJiYgIWdldENvb2tpZSgncG9wVXAnKVxuICAgICAgICAgICAgLy8gZ29vZ2xlIGFuYWxpdHljc1xuICAgICAgICAgICAgZ2EoJ3NlbmQnLCAnZXZlbnQnLCAnZm9ybScsICdzdWJtaXQnLCAnbG9naW4tc3VjY2VzcycpO1xuXG4gICAgICAgICAgICBpZiAoISRhdXRoLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICRhdXRoID0gJF9wb3BVcFxuICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZChfaHRtbFBvcFVwLmJveFN0YXR1c0F1dGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAuZmluZCgnI2JveC1zdGF0dXMtYXV0aCcpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBsb2dpbiBzdGF0dXMgb2tcbiAgICAgICAgICAgIGlmIChpc3NldCgkYXV0aCkpIHtcbiAgICAgICAgICAgICAgICB2YXIgdGl0bGUgPSAkYXV0aC5maW5kKCcudGl0bGUnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLCBjb250ZW50ID0gJGF1dGguZmluZCgnLmluZm8nKTtcbiAgICAgICAgICAgICAgICAkYXV0aC5iUG9wdXAoe1xuICAgICAgICAgICAgICAgICAgICBtb2RhbENsb3NlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLjYsXG4gICAgICAgICAgICAgICAgICAgIGZvbGxvdzogW2ZhbHNlLCBmYWxzZV0sXG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uU3R5bGU6ICdmaXhlZCcsIC8vJ2ZpeGVkJyBvciAnYWJzb2x1dGUnXG4gICAgICAgICAgICAgICAgICAgIG9uT3BlbjogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9jb250ZW50Lmh0bWwoJ1RFU1QgUE9QVVAgZWxlbWVudCEnKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgY2xvc2VDbGFzczogJ2Nsb3NlJyxcbiAgICAgICAgICAgICAgICAgICAgb25DbG9zZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2V0Q29va2llKCdwb3BVcCcsIHRydWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9jb250ZW50LmVtcHR5KCk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoX2RhdGFbJ3BvcFVwJ10gPT0gXCJyZWdpc3RyYXRpb25cIikgeyAvLyAmJiAhZ2V0Q29va2llKCdwb3BVcCcpXG4gICAgICAgICAgICAvLyBnb29nbGUgYW5hbGl0eWNzXG4gICAgICAgICAgICBnYSgnc2VuZCcsICdldmVudCcsICdmb3JtJywgJ3N1Ym1pdCcsICdyZWdpc3RyYXRpb24tc3VjY2VzcycpO1xuXG4gICAgICAgICAgICBpZiAoISRyZWdpc3RyYXRpb24ubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgJHJlZ2lzdHJhdGlvbiA9ICRfcG9wVXBcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoX2h0bWxQb3BVcC5ib3hTdGF0dXNSZWdpc3RyYXRpb24pXG4gICAgICAgICAgICAgICAgICAgICAgICAuZmluZCgnI2JveC1zdGF0dXMtcmVnaXN0cmF0aW9uJyk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIC8vIGxvZ2luIHN0YXR1cyBva1xuICAgICAgICAgICAgaWYgKGlzc2V0KCRyZWdpc3RyYXRpb24pKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRpdGxlID0gJHJlZ2lzdHJhdGlvbi5maW5kKCcudGl0bGUnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLCBjb250ZW50ID0gJHJlZ2lzdHJhdGlvbi5maW5kKCcuaW5mbycpO1xuICAgICAgICAgICAgICAgICRyZWdpc3RyYXRpb24uYlBvcHVwKHtcbiAgICAgICAgICAgICAgICAgICAgbW9kYWxDbG9zZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMC42LFxuICAgICAgICAgICAgICAgICAgICBmb2xsb3c6IFtmYWxzZSwgZmFsc2VdLFxuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvblN0eWxlOiAnZml4ZWQnLCAvLydmaXhlZCcgb3IgJ2Fic29sdXRlJ1xuICAgICAgICAgICAgICAgICAgICBvbk9wZW46IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vY29udGVudC5odG1sKCdURVNUIFBPUFVQIGVsZW1lbnQhJyk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGNsb3NlQ2xhc3M6ICdjbG9zZScsXG4gICAgICAgICAgICAgICAgICAgIG9uQ2xvc2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNldENvb2tpZSgncG9wVXAnLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vY29udGVudC5lbXB0eSgpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgLy9mcmVlLXRyaWFsLXJlZ2lzdHJhdGlvblxuICAgICAgICBpZiAoX2RhdGFbJ3BvcFVwJ10gPT0gXCJmcmVlLXRyaWFsLXJlZ2lzdHJhdGlvblwiKSB7IC8vICYmICFnZXRDb29raWUoJ3BvcFVwJylcbiAgICAgICAgICAgIGlmICghJHRyaWFsX3JlZ2lzdHJhdGlvbi5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAkdHJpYWxfcmVnaXN0cmF0aW9uID0gJF9wb3BVcFxuICAgICAgICAgICAgICAgICAgICAgICAgLmFwcGVuZChfaHRtbFBvcFVwLmJveFN0YXR1c0ZyZWVUcmlhbFJlZ2lzdHJhdGlvbilcbiAgICAgICAgICAgICAgICAgICAgICAgIC5maW5kKCcjYm94LXN0YXR1cy1mcmVlLXRyaWFsLXJlZ2lzdHJhdGlvbicpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gbG9naW4gc3RhdHVzIG9rXG4gICAgICAgICAgICBpZiAoaXNzZXQoJHRyaWFsX3JlZ2lzdHJhdGlvbikpIHtcbiAgICAgICAgICAgICAgICB2YXIgdGl0bGUgPSAkdHJpYWxfcmVnaXN0cmF0aW9uLmZpbmQoJy50aXRsZScpXG4gICAgICAgICAgICAgICAgICAgICAgICAsIGNvbnRlbnQgPSAkdHJpYWxfcmVnaXN0cmF0aW9uLmZpbmQoJy5pbmZvJyk7XG5cbiAgICAgICAgICAgICAgICAkdHJpYWxfcmVnaXN0cmF0aW9uLmJQb3B1cCh7XG4gICAgICAgICAgICAgICAgICAgIG1vZGFsQ2xvc2U6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAuNixcbiAgICAgICAgICAgICAgICAgICAgZm9sbG93OiBbZmFsc2UsIGZhbHNlXSxcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb25TdHlsZTogJ2ZpeGVkJyxcbiAgICAgICAgICAgICAgICAgICAgb25PcGVuOiBmdW5jdGlvbiAoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGdvb2dsZSBhbmFsaXR5Y3NcbiAgICAgICAgICAgICAgICAgICAgICAgIGdhKCdzZW5kJywgJ2V2ZW50JywgJ3RyaWFsJywgJ3BvcHVwJywgJ2ZyZWUtdHJpYWwtcmVnaXN0cmF0aW9uLXN1Y2Nlc3MnKTtcblxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBjbG9zZUNsYXNzOiAnY2xvc2UnLFxuICAgICAgICAgICAgICAgICAgICBvbkNsb3NlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgIH1cbn1cblxuZnVuY3Rpb24gX3BhcmNlSGFzaChoYXNoKSB7XG4gICAgdmFyIF9kYXRhID0ge307XG4gICAgaWYgKGhhc2gubGVuZ3RoKSB7XG4gICAgICAgIHZhciBwYWlyID0gKGhhc2gpLnNwbGl0KCcmJyk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGFpci5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIHBhcmFtID0gcGFpcltpXS5zcGxpdCgnPScpO1xuICAgICAgICAgICAgX2RhdGFbcGFyYW1bMF1dID0gcGFyYW1bMV07XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIF9kYXRhO1xufVxuXG5cbmZ1bmN0aW9uIGlzc2V0KGVsZW1lbnQpIHtcbiAgICBpZiAodHlwZW9mIGVsZW1lbnQgIT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgcmV0dXJuIGVsZW1lbnQubGVuZ3RoID4gMDtcbiAgICB9IGVsc2VcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xufVxuXG4vLyB0b2dnbGVDbGlja2VkXG5qUXVlcnkuZm4uY2xpY2tUb2dnbGUgPSBmdW5jdGlvbiAoYSwgYikge1xuICAgIHZhciBhYiA9IFtiLCBhXTtcbiAgICBmdW5jdGlvbiBjYigpIHtcbiAgICAgICAgYWJbdGhpcy5fdG9nIF49IDFdLmNhbGwodGhpcyk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMub24oXCJjbGlja1wiLCBjYik7XG59O1xuXG4vKlxuIChmdW5jdGlvbigkKSB7XG4gJC5mbi5jbGlja1RvZ2dsZSA9IGZ1bmN0aW9uKGZ1bmMxLCBmdW5jMikge1xuIHZhciBmdW5jcyA9IFtmdW5jMSwgZnVuYzJdO1xuIHRoaXMuZGF0YSgndG9nZ2xlY2xpY2tlZCcsIDApO1xuIHRoaXMuY2xpY2soZnVuY3Rpb24oZXZlbnQpIHtcbiBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuIHZhciBkYXRhID0gJCh0aGlzKS5kYXRhKCk7XG4gdmFyIHRjID0gZGF0YS50b2dnbGVjbGlja2VkO1xuICQucHJveHkoZnVuY3NbdGNdLCB0aGlzKSgpO1xuIGRhdGEudG9nZ2xlY2xpY2tlZCA9ICh0YyArIDEpICUgMjtcbiByZXR1cm4gZmFsc2U7XG4gfSk7XG4gcmV0dXJuIHRoaXM7XG4gfTtcbiB9KGpRdWVyeSkpO1xuICovXG5cbi8qXG4gKiBwYXJjZSB1cmxcbiAqKi9cbmZ1bmN0aW9uIHBhcnNlVXJsUXVlcnkoKSB7XG4gICAgdmFyIGRhdGEgPSB7fTtcbiAgICBpZiAobG9jYXRpb24uc2VhcmNoKSB7XG4gICAgICAgIHZhciBwYWlyID0gKGxvY2F0aW9uLnNlYXJjaC5zdWJzdHIoMSkpLnNwbGl0KCcmJyk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGFpci5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIHBhcmFtID0gcGFpcltpXS5zcGxpdCgnPScpO1xuICAgICAgICAgICAgZGF0YVtwYXJhbVswXV0gPSBwYXJhbVsxXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZGF0YTtcbn1cblxuXG5mdW5jdGlvbiBjbGlja0FjdGl2ZShvYmosIF90aGlzKSB7XG4gICAgaWYgKCQob2JqKS5sZW5ndGggPiAwKSB7XG4gICAgICAgICQuZWFjaCgkKG9iaiksIGZ1bmN0aW9uIChrZXksIHZhbCkge1xuICAgICAgICAgICAgaWYgKCQodmFsKS5oYXNDbGFzcygnYWN0aXZlJykpXG4gICAgICAgICAgICAgICAgJCh2YWwpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgfSk7IC8vIGNsZWFyIGFsbCBhY3RpdmVcbiAgICAgICAgX3RoaXMuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICAgIH1cbn1cblxuLypcbiAqIHBhcmNlIHN0cmluZyBzZXJpbGl6ZVxuICoqL1xuZnVuY3Rpb24gcGFyc2VRdWVyeShzdHIpIHtcbiAgICB2YXIgZGF0YSA9IHt9O1xuICAgIGlmICh0eXBlb2Ygc3RyID09ICdzdHJpbmcnKSB7XG4gICAgICAgIHZhciBwYWlyID0gKHN0cikuc3BsaXQoJyYnKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBwYWlyLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICB2YXIgcGFyYW0gPSBwYWlyW2ldLnNwbGl0KCc9Jyk7XG4gICAgICAgICAgICBkYXRhW3BhcmFtWzBdXSA9IHBhcmFtWzFdO1xuICAgICAgICB9XG4gICAgfSBlbHNlIGlmICh0eXBlb2Ygc3RyID09ICdvYmplY3QnKSB7XG4gICAgICAgICQuZWFjaChzdHIsIGZ1bmN0aW9uIChfaywgX3ZhbCkge1xuICAgICAgICAgICAgaWYgKF92YWwubmFtZSlcbiAgICAgICAgICAgICAgICBkYXRhWyBfdmFsLm5hbWUgXSA9IChfdmFsLnZhbHVlKSA/IF92YWwudmFsdWUgOiBudWxsO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIGRhdGE7XG59XG5cblxuLypcbiAqIEFqYXggZnVuY3Rpb24uXG4gKiByZXR1cm4ganNvbiByZXN1bHRcbiAqKi9cbmZ1bmN0aW9uIGdldEFqYXhGb3JtKHBhdGgsIHBhcmFtcywgb3B0aW9ucykge1xuXG4gICAgaWYgKCFvcHRpb25zKVxuICAgICAgICBvcHRpb25zID0ge307XG5cbiAgICB2YXIgc2V0dGluZ3MgPSAkLmV4dGVuZCh7XG4gICAgICAgICdkYXRhVHlwZSc6ICdqc29uJyxcbiAgICAgICAgJ2FzeW5jJzogZmFsc2UsXG4gICAgICAgICdjcm9zc0RvbWFpbic6IGZhbHNlLFxuICAgICAgICAndHlwZSc6ICdQT1NUJyxcbiAgICAgICAgJ2NhY2hlJzogdHJ1ZVxuICAgIH0sIG9wdGlvbnMgfHwge30pO1xuXG5cbiAgICBpZiAoIXBhdGgpIHtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHZhciByZXMgPSAkLmFqYXgoe1xuICAgICAgICB1cmw6IHBhdGgsXG4gICAgICAgIGRhdGFUeXBlOiBzZXR0aW5ncy5kYXRhVHlwZSxcbiAgICAgICAgYXN5bmM6IHNldHRpbmdzLmFzeW5jLFxuICAgICAgICBjcm9zc0RvbWFpbjogc2V0dGluZ3MuY3Jvc3NEb21haW4sXG4gICAgICAgIHR5cGU6IHNldHRpbmdzLnR5cGUsXG4gICAgICAgIGNhY2hlOiBzZXR0aW5ncy5jYWNoZSxcbiAgICAgICAgc3VjY2VzczogZnVuY3Rpb24gKCkge1xuXG4gICAgICAgIH0sXG4gICAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIH0sXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHBhcmFtczogcGFyYW1zXG4gICAgICAgIH1cbiAgICB9KS5yZXNwb25zZVRleHQ7XG5cbiAgICBjb25zb2xlLmxvZyhyZXMpO1xuXG4gICAgcmVzID0gZXZhbCgnWycgKyByZXMgKyAnXScpO1xuICAgIHZhciBvYmogPSByZXNbMF07XG4gICAgcmV0dXJuIG9iajtcbn1cblxuLypcbiAqIEpTT05QXG4gKlxuICovXG5mdW5jdGlvbiBfZ2V0QUpBWChwYXRoLCBwYXJhbXMsIG9wdGlvbnMpIHtcbiAgICBpZiAoIW9wdGlvbnMpXG4gICAgICAgIG9wdGlvbnMgPSB7fTtcblxuICAgIHZhciBzZXR0aW5ncyA9ICQuZXh0ZW5kKHtcbiAgICAgICAgJ2RhdGFUeXBlJzogJ2pzb25wJyxcbiAgICAgICAgJ2pzb25wJzogXCJjYWxsYmFja1wiLFxuICAgICAgICAnYXN5bmMnOiBmYWxzZSxcbiAgICAgICAgJ2Nyb3NzRG9tYWluJzogZmFsc2UsXG4gICAgICAgICd0eXBlJzogJ1BPU1QnLFxuICAgICAgICAnY2FjaGUnOiB0cnVlXG4gICAgfSwgb3B0aW9ucyB8fCB7fSk7XG5cbiAgICBjb25zb2xlLmxvZyhzZXR0aW5ncyk7XG5cbiAgICBpZiAoIXBhdGgpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2VudGVyIHVybCBBSkFYIScpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICByZXR1cm4gJC5hamF4KHtcbiAgICAgICAgdHlwZTogc2V0dGluZ3MudHlwZSxcbiAgICAgICAgYXN5bmM6IHNldHRpbmdzLmFzeW5jLFxuICAgICAgICB1cmw6IHBhdGgsXG4gICAgICAgIGRhdGE6IHtcbiAgICAgICAgICAgIHBhcmFtczogcGFyYW1zXG4gICAgICAgIH0sXG4gICAgICAgIGRhdGFUeXBlOiBzZXR0aW5ncy5kYXRhVHlwZSxcbiAgICAgICAganNvbnA6IHNldHRpbmdzLmpzb25wLFxuICAgICAgICBjcm9zc0RvbWFpbjogc2V0dGluZ3MuY3Jvc3NEb21haW4sXG4gICAgICAgIGNhY2hlOiBzZXR0aW5ncy5jYWNoZSxcbiAgICB9KTtcbn1cblxuLypcbiAqXG4gKiBAcGFyYW0ge3R5cGV9ICRfbXNnXG4gKiBAcmV0dXJucyB7dW5kZWZpbmVkfVxuICovXG5mdW5jdGlvbiBnZXRKc29ucChfZGF0YSkge1xuICAgIGlmICh0eXBlb2YgX2RhdGEgIT0gJ29iamVjdCcpIHtcbiAgICAgICAgZGllKCdEYXRhIG5vdCBvYmplY3QhJyk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIGJhc2VVcmwgPSBcImh0dHA6Ly9hLnB1bXBpYy5kZXYvaW5kZXgucGhwXCI7XG4gICAgcmV0dXJuICQuYWpheCh7XG4gICAgICAgIHR5cGU6IFwiR0VUXCIsXG4gICAgICAgIGFzeW5jOiBmYWxzZSxcbiAgICAgICAgdXJsOiBiYXNlVXJsLFxuICAgICAgICBkYXRhOiBfZGF0YSxcbiAgICAgICAgZGF0YVR5cGU6IFwianNvbnBcIixcbiAgICAgICAganNvbnA6IFwiY2FsbGJhY2tcIixcbiAgICAgICAgY3Jvc3NEb21haW46IHRydWVcbiAgICB9KTtcblxufVxuXG5cbi8qXG4gKlxuICogQHBhcmFtIHt0eXBlfSAkX21zZ1xuICogQHJldHVybnMge3VuZGVmaW5lZH1cbiAqL1xuZnVuY3Rpb24gcmVsb2FkQ2FwdGNoYShvYmosIGVycm9yKSB7XG4gICAgaWYgKCFvYmoubGVuZ3RoKVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgdmFyIF9mb3JtID0gb2JqLnBhcmVudHMoJ2Zvcm0nKTtcbiAgICB2YXIgX3NyYyA9ICcvY2FwdGNoYS5odG1sPycgKyBNYXRoLnJhbmRvbSgpO1xuICAgIGlmICgkKG9iaikuYXR0cignYXR0ci13aWR0aCcpICYmICQob2JqKS5hdHRyKCdhdHRyLWhlaWdodCcpKSB7XG4gICAgICAgIF9zcmMgPSAnL2NhcHRjaGEuaHRtbD93aWR0aD0nICsgJChvYmopLmF0dHIoJ2F0dHItd2lkdGgnKSArICcmaGVpZ2h0PScgKyAkKG9iaikuYXR0cignYXR0ci1oZWlnaHQnKSArICcmJyArIE1hdGgucmFuZG9tKCk7XG4gICAgfVxuICAgICQoJy5ib3gtY2FwdGNoYScpLmZpbmQoJyNpbWctY2FwdGNoYScpLmF0dHIoJ3NyYycsIF9zcmMpO1xuXG4gICAgaWYgKGVycm9yKVxuICAgICAgICBfZm9ybS5maW5kKCdpbnB1dFtuYW1lPVwiY2FwdGNoYVwiXScpLmZvY3VzKCk7XG59XG5cbi8qXG4gKiBEaXNwbGF5IGVycm9yIG1hc3NlbmdlXG4gKiBAcGFyYW0ge3R5cGV9ICRfbXNnXG4gKiBAcmV0dXJucyB7dW5kZWZpbmVkfVxuICovXG5mdW5jdGlvbiBkaWUoJF9tc2cpIHtcbiAgICBjb25zb2xlLmxvZygkX21zZyk7XG59XG5cbiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcblxuICAgICRyc193aWR0aCA9IGZhbHNlO1xuICAgICQod2luZG93KS5yZXNpemUoZnVuY3Rpb24gKCkge1xuICAgICAgICAkcnNfd2lkdGggPSAkKHdpbmRvdykud2lkdGgoKVxuICAgIH0pO1xuXG4gICAgaWYgKCEkcnNfd2lkdGgpIHtcbiAgICAgICAgJHJzX3dpZHRoID0gJCh3aW5kb3cpLndpZHRoKCk7XG4gICAgfVxuXG4gICAgY29va2llX2luaXQoKTtcblxuICAgIGNvcHlfdG9fY2xpcGJvYXJkX2luaXQoKTtcblxuICAgICQuZGF0YSh3aW5kb3csIFwiZmlsdGVyc1wiLCBmYWxzZSk7IC8vIGluaXQgY2xlYXIgY2FjaGVcblxuICAgIHZhciBmaWx0ZXJzID0ge1xuICAgICAgICAncGxhbnMnOiBmYWxzZSxcbiAgICAgICAgJ21vYmlsZSc6IHtcbiAgICAgICAgICAgICdhcHBsZSc6IGZhbHNlLFxuICAgICAgICAgICAgJ2FuZHJvaWQnOiBmYWxzZSxcbiAgICAgICAgICAgICdibGFja2JlcnJ5JzogZmFsc2VcbiAgICAgICAgfVxuICAgIH07IC8vIGluaXQgc2V0dGluZ3NcblxuICAgIC8vIGFjdGl2YXRlIHRhYlxuICAgIGlmICh3aW5kb3cubG9jYXRpb24uaGFzaC5sZW5ndGgpIHtcbiAgICAgICAgdmFyIGhhc2ggPSB3aW5kb3cubG9jYXRpb24uaGFzaCxcbiAgICAgICAgICAgICAgICAkYnV0dG9uID0gJCgnYVtocmVmPVwiJyArIGhhc2ggKyAnXCJdJyk7XG4gICAgICAgIGlmICgkYnV0dG9uLmxlbmd0aCAmJiAkKGhhc2gpLmxlbmd0aCkge1xuICAgICAgICAgICAgJGJ1dHRvbi5hdHRyKCdkYXRhLXRvZ2dsZWQnLCAnb24nKTtcbiAgICAgICAgICAgICRidXR0b24ucGFyZW50KCkuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAgICAgJCgnLmJveF9jYXRlZ29yeT51bD5saScpLmhpZGUoKTtcbiAgICAgICAgICAgICQoaGFzaCkuc2hvdygpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gZmFjZWJvb2NrIHNoYXJlXG5cbi8vICAgICQuYWpheFNldHVwKHsgY2FjaGU6IHRydWUgfSk7XG4vLyAgICAkLmdldFNjcmlwdCgnLy9jb25uZWN0LmZhY2Vib29rLm5ldC9lbl9VUy9zZGsuanMnLCBmdW5jdGlvbigpe1xuLy8gICAgICAgIEZCLmluaXQoe1xuLy8gICAgICAgICAgICAvLyBhcHBJZDogJ3t5b3VyLWFwcC1pZH0nLFxuLy8gICAgICAgICAgICB2ZXJzaW9uOiAndjIuNCcgLy8gb3IgdjIuMCwgdjIuMSwgdjIuMiwgdjIuM1xuLy8gICAgICAgIH0pO1xuLy8gICAgICAgIC8vJCgnI2xvZ2luYnV0dG9uLCNmZWVkYnV0dG9uJykucmVtb3ZlQXR0cignZGlzYWJsZWQnKTtcbi8vICAgICAgICAvLyBGQi5nZXRMb2dpblN0YXR1cyh1cGRhdGVTdGF0dXNDYWxsYmFjayk7XG4vLyAgICB9KTtcblxuICAgIGZ1bmN0aW9uIGZiX3NoYXJlKCkge1xuICAgICAgICAvLyBmYWNlYm9vayBzaGFyZSBkaWFsb2dcbiAgICAgICAgRkIudWkoe1xuICAgICAgICAgICAgbWV0aG9kOiAnZmVlZCcsXG4gICAgICAgICAgICBuYW1lOiBcIllvdXIgUGFnZSBUaXRsZVwiLFxuICAgICAgICAgICAgbGluazogXCJodHRwczovL3d3dy53ZWJuaXJhai5jb20vbGluay10by1wYWdlL1wiLFxuICAgICAgICAgICAgcGljdHVyZTogXCJodHRwczovL3N0YWNrZXhjaGFuZ2UuY29tL3VzZXJzL2ZsYWlyLzU1Nzk2OS5wbmdcIixcbiAgICAgICAgICAgIGNhcHRpb246IFwiU29tZSBkZXNjcmlwdGlvbiBoZXJlXCJcbiAgICAgICAgfSwgZnVuY3Rpb24gKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAvLyBkbyBub3RoaW5nXG4gICAgICAgIH0pO1xuXG4gICAgfVxuXG5cblxuICAgICQoJy5zaGFyZV9saXN0IGEnKS5jbGljayhmdW5jdGlvbiAoZSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG5cbiAgICAgICAgLy8gZmFjZWJvb2tcbi8vICAgICAgICBpZigkKHRoaXMpLmhhc0NsYXNzKCdzaGFyZS1mYWNlYm9vaycpKSB7XG4vLyAgICAgICAgICAgd2luZG93Lm9wZW4oXCJodHRwOi8vd3d3LmZhY2Vib29rLmNvbS9zaGFyZXIvc2hhcmVyLnBocD9zPTEwMCZwW3VybF09XCIrZW5jb2RlVVJJQ29tcG9uZW50KHdpbmRvdy5sb2NhdGlvbikrXCImcFtpbWFnZXNdWzBdPWh0dHA6Ly9wdW1waWMuY29tL2ltYWdlcy9zb2NpYWxzL3NvY2lhbC1pY29uLmpwZyZwW3RpdGxlXT1Nb2JpbGUgUGhvbmUgU2VjdXJpdHkgTWVhc3VyZXMmcFtzdW1tYXJ5XT1Ib3cgdG8gcHJvdGVjdCBjaGlsZHJlbiBmcm9tIG9ubGluZSBwcmVkYXRvcnMsIGN5YmVyYnVsbGllcywgMTgrIGNvbnRlbnQsIGFuZCBpZGVudGl0eSB0aGVmdC4gUHVtcGljIGdhdGhlcmVkIGVzc2VudGlhbCBpbmZvcm1hdGlvbiBvbiBtb2JpbGUgcGhvbmUgc2FmZXR5IHByYWN0aWNlLiBMZWFybiBtb3JlIHRvIGtlZXAga2lkcyBzYWZlLlwiLFxuLy8gICAgICAgICAgICdTaGFyZScsXG4vLyAgICAgICAgICAgJ2hlaWdodD0zMDAsd2lkdGg9NTAwJyk7XG4vLyAgICAgICAgICAgLy8gZmJfc2hhcmUoKTtcbi8vICAgICAgICB9IGVsc2Uge1xuXG4vLyAgICAgICAgY29uc29sZS5sb2coICQodGhpcykuZGF0YSgnbG9jYXRpb24nKSArIGVuY29kZVVSSUNvbXBvbmVudCh3aW5kb3cubG9jYXRpb24pICk7XG4gICAgICAgIGlmIChpc3NldCgkKHRoaXMpLmRhdGEoJ2xvY2F0aW9uJykpICYmICQodGhpcykuZGF0YSgnbG9jYXRpb24nKS5sZW5ndGgpIHtcblxuICAgICAgICAgICAgdmFyIG1lZGlhID0gJyc7XG4gICAgICAgICAgICBpZiAoaXNzZXQoJCh0aGlzKS5kYXRhKCdtZWRpYScpKSAmJiAkKHRoaXMpLmRhdGEoJ21lZGlhJykubGVuZ3RoKVxuICAgICAgICAgICAgICAgIG1lZGlhID0gJyZtZWRpYT0nICsgJCh0aGlzKS5kYXRhKCdtZWRpYScpO1xuXG4gICAgICAgICAgICB3aW5kb3cub3BlbigkKHRoaXMpLmRhdGEoJ2xvY2F0aW9uJykgKyBlbmNvZGVVUklDb21wb25lbnQod2luZG93LmxvY2F0aW9uKSArIG1lZGlhLCAnU2hhcmUnLCAnaGVpZ2h0PTMwMCx3aWR0aD01MDAnKTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vfVxuICAgICAgICByZXR1cm4gZmFsc2VcbiAgICB9KTtcblxuICAgICQoJy5ib3gtcGxhbnMsIC5ib3gtcGhvbmUnKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgZmlsdGVycyA9ICghJC5kYXRhKHdpbmRvdywgXCJmaWx0ZXJzXCIpKSA/IGZpbHRlcnMgOiAkLmRhdGEod2luZG93LCBcImZpbHRlcnNcIik7XG4gICAgICAgIHZhciBfcmVsID0gJCh0aGlzKS5hdHRyKCdyZWwnKTtcblxuICAgICAgICBpZiAoJCh0aGlzKS5oYXNDbGFzcygnYWN0aXZlJykpIHtcbiAgICAgICAgICAgICQodGhpcykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuXG4gICAgICAgICAgICBpZiAoJCh0aGlzKS5pcygnLmJveC1wbGFucycpKSB7XG4gICAgICAgICAgICAgICAgZmlsdGVycy5wbGFucyA9IGZhbHNlO1xuICAgICAgICAgICAgfSBlbHNlIGlmICgkKHRoaXMpLmlzKCcuYm94LXBob25lJykpIHtcbiAgICAgICAgICAgICAgICBmb3IgKGtleSBpbiBmaWx0ZXJzLm1vYmlsZSkge1xuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJzLm1vYmlsZVtrZXldID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBpZiAoJCh0aGlzKS5pcygnLmJveC1wbGFucycpKSB7XG4gICAgICAgICAgICAgICAgY2xpY2tBY3RpdmUoJy5ib3gtcGxhbnMnLCAkKHRoaXMpKTtcbiAgICAgICAgICAgICAgICBmaWx0ZXJzLnBsYW5zID0gX3JlbDtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoJCh0aGlzKS5pcygnLmJveC1waG9uZScpKSB7XG4gICAgICAgICAgICAgICAgY2xpY2tBY3RpdmUoJy5ib3gtcGhvbmUnLCAkKHRoaXMpKTtcbiAgICAgICAgICAgICAgICAvLyBjbGVhciBhbGwgcGFyYW1zIChhZnRlciBjbGljayBpbiBtb2JpbGUpXG4gICAgICAgICAgICAgICAgZm9yIChrZXkgaW4gZmlsdGVycy5tb2JpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVycy5tb2JpbGVba2V5XSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgZmlsdGVycy5tb2JpbGVbX3JlbF0gIT09IFwidW5kZWZpbmVkXCIpXG4gICAgICAgICAgICAgICAgICAgIGZpbHRlcnMubW9iaWxlW19yZWxdID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnNvbGUubG9nKCdzYXZlIGNhc2hlIGZpbHRlci4uLicpO1xuICAgICAgICAkLmRhdGEod2luZG93LCBcImZpbHRlcnNcIiwgZmlsdGVycyk7IC8vIHNhdmUgaW4gcmVzdWx0IGxvY2FsZSBjYWNoZVxuICAgICAgICBjb25zb2xlLmxvZygnZW5kLi4uJyk7XG5cbiAgICAgICAgY29uc29sZS5sb2coJ2luaXQgUGx1Z2lucyBUYWJzLi4uJyk7XG4gICAgICAgICQoJy5ib3gtYm9keS1maWx0ZXJzJykudGFiUHVtcGljKHtcbiAgICAgICAgICAgICdmaWx0ZXJzJzogZmlsdGVyc1xuICAgICAgICB9KS50YWJQdW1waWMoJ3Nob3cnKTtcbiAgICAgICAgY29uc29sZS5sb2coJ2VuZC4uLicpO1xuXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9KTtcblxuICAgIGlmICgkKCcjaXRlbS1zdGlja3liYXInKS5sZW5ndGgpIHtcbiAgICAgICAgLy8gJChcIiNpdGVtLXN0aWNreWJhclwiKS50cmlnZ2VyKFwic3RpY2t5X2tpdDpkZXRhY2hcIik7XG4gICAgICAgIC8vICQoXCIjaXRlbS1zdGlja3liYXJcIikuc3RpY2tfaW5fcGFyZW50KCk7XG5cblxuICAgICAgICAkKCcubGlzdF9jYXRlZ29yeSA+IGxpJykuZWFjaChmdW5jdGlvbiAoa2V5LCB2YWwpIHtcbiAgICAgICAgICAgICQoJyNpdGVtLXN0aWNreWJhci5zdGlja3liYXItJyArIGtleSkuc3RpY2tfaW5fcGFyZW50KCk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygna2V5ID0gJyArIGtleSk7XG4gICAgICAgIH0pO1xuXG5cbi8vICAgICAgICAkKFwiI2l0ZW0tc3RpY2t5YmFyXCIpLmVhY2goZnVuY3Rpb24oa2V5LCB2YWwpIHtcbi8vICAgICAgICAgICAgY29uc29sZS5sb2coa2V5KTtcbi8vICAgICAgICAgICAgJCh0aGlzKS5zdGlja19pbl9wYXJlbnQoKTtcbi8vICAgICAgICB9KTtcblxuLy8gICAgICAgICQoXCIjaXRlbS1zdGlja3liYXJcIikuc3RpY2tfaW5fcGFyZW50KHtcbi8vICAgICAgICBwYXJlbnQ6IFwiI2l0ZW1zLXN0aWNreWJhclwiLFxuLy8gICAgICAgIHNwYWNlcjogXCIjaXRlbS1zdGlja3liYXJcIlxuLy8gICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAoJCgnI2Jsb2NrLXN0aWNreWJhcicpLmxlbmd0aCkge1xuICAgICAgICAkKCcjYmxvY2stc3RpY2t5YmFyJykuc3RpY2tfaW5fcGFyZW50KCk7XG4gICAgfVxuXG4gICAgaWYgKCQoJy5saXN0X2NhdGVnb3J5ID4gbGkgPiBhW2RhdGEtdG9nZ2xlZD1cIm9uXCJdJykubGVuZ3RoKSB7XG4gICAgICAgICQuZWFjaCgkKCcubGlzdF9jYXRlZ29yeSA+IGxpID4gYVtkYXRhLXRvZ2dsZWQ9XCJvblwiXScpLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkKCcuYm94X2NhdGVnb3J5ID4gdWwgPiBsaScpLmhpZGUoKTtcbiAgICAgICAgICAgIGlmICgkKHRoaXMpLnBhcmVudCgpLmhhc0NsYXNzKCdhY3RpdmUnKSkge1xuICAgICAgICAgICAgICAgIHZhciBfaGFzaCA9ICQodGhpcykuYXR0cignaHJlZicpLnNwbGl0KCcjJyk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coX2hhc2hbMV0pO1xuICAgICAgICAgICAgICAgIGlmIChfaGFzaC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnLmJveF9jYXRlZ29yeSA+IHVsID4gbGknKS5maW5kKCcjJyArIF9oYXNoWzFdKS5jbG9zZXN0KCdsaScpLnNob3coKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuXG4gICAgLy9jaGVjayBpZiBsaW5rIGlzIHdpdGggaGFzaFxuICAgIHZhciBjdXJyVXJsID0gd2luZG93LmxvY2F0aW9uLmhhc2g7XG4gICAgaWYoY3VyclVybCkge1xuICAgICAgJCgnLmxpc3RfY2F0ZWdvcnkgPiBsaTpmaXJzdC1jaGlsZCcpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKVxuICAgIH1cbiAgICBmdW5jdGlvbiBvZmZzZXRBbmNob3IoKSB7XG4gICAgICAgIGlmKGxvY2F0aW9uLmhhc2gubGVuZ3RoICE9PSAwKSB7XG4gICAgICAgICAgICB3aW5kb3cuc2Nyb2xsVG8od2luZG93LnNjcm9sbFgsIHdpbmRvdy5zY3JvbGxZIC0gOTApO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgLy8gVGhpcyB3aWxsIGNhcHR1cmUgaGFzaCBjaGFuZ2VzIHdoaWxlIG9uIHRoZSBwYWdlXG4gICAgJCh3aW5kb3cpLm9uKFwiaGFzaGNoYW5nZVwiLG9mZnNldEFuY2hvcik7XG5cbiAgICAvLyBUaGlzIGlzIGhlcmUgc28gdGhhdCB3aGVuIHlvdSBlbnRlciB0aGUgcGFnZSB3aXRoIGEgaGFzaCxcbiAgICAvLyBpdCBjYW4gcHJvdmlkZSB0aGUgb2Zmc2V0IGluIHRoYXQgY2FzZSB0b28uIEhhdmluZyBhIHRpbWVvdXRcbiAgICAvLyBzZWVtcyBuZWNlc3NhcnkgdG8gYWxsb3cgdGhlIGJyb3dzZXIgdG8ganVtcCB0byB0aGUgYW5jaG9yIGZpcnN0LlxuICAgIHdpbmRvdy5zZXRUaW1lb3V0KG9mZnNldEFuY2hvciwgMSk7XG4gICAgLy8gY2hvb3NlIGNhdGVnb2V5XG4gICAgLy8kKCcubGlzdF9jYXRlZ29yeSA+IGxpOmZpcnN0LWNoaWxkJykuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICQoJy5saXN0X2NhdGVnb3J5ID4gbGkgPiBhJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIC8vZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdmFyIF9oYXNoID0gJCh0aGlzKS5hdHRyKCdocmVmJykuc3BsaXQoJyMnKSxcbiAgICAgICAgICAgICAgICBfaW5kZXggPSAkKHRoaXMpLmNsb3Nlc3QoJ2xpJykuaW5kZXgoKSxcbiAgICAgICAgICAgICAgICAkaG9sZGVyID0gJCh0aGlzKS5wYXJlbnQoKS5wYXJlbnQoKTtcblxuICAgICAgICAvLyBjb25zb2xlLmxvZygnaW5kZXggPSAnK19pbmRleCk7XG5cbiAgICAgICAgdmFyIHN0b3JlX2hpc3RvcnkgPSAkaG9sZGVyLmF0dHIoJ3NhdmUtc3RhdGUnKTtcblxuICAgICAgICBpZiAodHlwZW9mIHN0b3JlX2hpc3RvcnkgIT09IHR5cGVvZiB1bmRlZmluZWQgJiYgc3RvcmVfaGlzdG9yeSAhPT0gZmFsc2UpIHtcbiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5oYXNoID0gJCh0aGlzKS5hdHRyKCdocmVmJyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBjbGVhciBhbGwgYWN0aXZlXG4gICAgICAgICQuZWFjaCgkKCcubGlzdF9jYXRlZ29yeSA+IGxpJykubm90KFwiOmVxKFwiICsgX2luZGV4ICsgXCIpXCIpLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoJCh0aGlzKS5oYXNDbGFzcygnYWN0aXZlJykpXG4gICAgICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG5cbiAgICAgICAgICAgIGlmICgkKHRoaXMpLmNoaWxkcmVuKCdhJykuYXR0cignZGF0YS10b2dnbGVkJykgPT0gJ29uJykge1xuICAgICAgICAgICAgICAgICQodGhpcykuY2hpbGRyZW4oJ2EnKS5hdHRyKCdkYXRhLXRvZ2dsZWQnLCAnb2ZmJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pOyAvLyBjbGVhciBhY3RpdmVcblxuICAgICAgICAvLyBhbGwgYWRkIGF0dHIgb2ZmXG5cbiAgICAgICAgaWYgKCEkKHRoaXMpLmF0dHIoJ2RhdGEtdG9nZ2xlZCcpIHx8ICQodGhpcykuYXR0cignZGF0YS10b2dnbGVkJykgPT0gJ29mZicpIHtcbiAgICAgICAgICAgICQodGhpcykuYXR0cignZGF0YS10b2dnbGVkJywgJ29uJyk7XG5cbiAgICAgICAgICAgICQoXCIubGlzdF9jYXRlZ29yeVwiKS5lYWNoKGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgaWYgKCQodGhpcykuZmluZChcImxpOmVxKFwiICsgX2luZGV4ICsgXCIpXCIpLmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5maW5kKFwibGk6ZXEoXCIgKyBfaW5kZXggKyBcIilcIikuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICQoJy5ib3hfY2F0ZWdvcnkgPiB1bCA+IGxpJykuaGlkZSgpO1xuXG4gICAgICAgICAgICBpZiAoX2hhc2gubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgIGlmIChfaGFzaFsxXSA9PSAnYWxsJykge1xuICAgICAgICAgICAgICAgICAgICAkKCcuYm94X2NhdGVnb3J5ID4gdWwgPiBsaScpLnNob3coKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkKCcuYm94X2NhdGVnb3J5ID4gdWwgPiBsaScpLmZpbmQoJyMnICsgX2hhc2hbMV0pLmNsb3Nlc3QoJ2xpJykuc2hvdygpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIGlmICgkKCcuYm94X2NhdGVnb3J5ID4gdWwgPiBsaScpLmZpbmQoJyMnICsgX2hhc2hbMV0pLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAvLyAkKCdodG1sLCBib2R5JykuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgIC8vICAgICBzY3JvbGxUb3A6IE1hdGguY2VpbCgkKCcuYm94X2NhdGVnb3J5ID4gdWwgPiBsaScpLmZpbmQoJyMnICsgX2hhc2hbMV0pLm9mZnNldCgpLnRvcCkgLy8gTWF0aC5jZWlsKCh0YXJnZXRfdG9wICogJCh3aW5kb3cpLm91dGVySGVpZ2h0KHRydWUpKSAvICQoJ2h0bWwsIGJvZHknKS5oZWlnaHQoKSlcbiAgICAgICAgICAgICAgICAgICAgLy8gfSwgJ2xpbmVhcicpO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfVxuXG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoJCh0aGlzKS5hdHRyKCdkYXRhLXRvZ2dsZWQnKSA9PSAnb24nKSB7XG4gICAgICAgICAgICAkKHRoaXMpLmF0dHIoJ2RhdGEtdG9nZ2xlZCcsICdvZmYnKTtcblxuICAgICAgICAgICAgJChcIi5saXN0X2NhdGVnb3J5XCIpLmVhY2goZnVuY3Rpb24gKGtleSwgdmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS5maW5kKFwibGk6ZXEoXCIgKyBfaW5kZXggKyBcIilcIikuaGFzQ2xhc3MoJ2FjdGl2ZScpKVxuICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmZpbmQoXCJsaTplcShcIiArIF9pbmRleCArIFwiKVwiKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgJCgnLmJveF9jYXRlZ29yeSA+IHVsID4gbGknKS5zaG93KCk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyAkKCcjaXRlbS1zdGlja3liYXInKS50cmlnZ2VyKFwic3RpY2t5X2tpdDpyZWNhbGNcIik7XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0pO1xuXG4vL1xuLy8gICAgICQoJy5saXN0X2NhdGVnb3J5ID4gbGkgPiBhJykub24oJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHtcbi8vICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbi8vICAgICAgICAgdmFyIF9oYXNoID0gJCh0aGlzKS5hdHRyKCdocmVmJykuc3BsaXQoJyMnKTtcbi8vXG4vLyAgICAgICAgICQuZWFjaCgkKCcubGlzdF9jYXRlZ29yeSA+IGxpJyksIGZ1bmN0aW9uKCkge1xuLy8gICAgICAgICAgICBpZigkKHRoaXMpLmhhc0NsYXNzKCdhY3RpdmUnKSlcbi8vICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuLy8gICAgICAgICB9KTsgLy8gY2xlYXIgYWN0aXZlXG4vL1xuLy8gICAgICAgICBpZigkKHRoaXMpLnBhcmVudCgpLmhhc0NsYXNzKCdhY3RpdmUnKSkge1xuLy8gICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4vLyAgICAgICAgICAgICAkKCcuYm94X2NhdGVnb3J5ID4gdWwgPiBsaScpLnNob3coKTtcbi8vICAgICAgICAgfSBlbHNlIHtcbi8vICAgICAgICAgICAgICQodGhpcykucGFyZW50KCkuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuLy8gICAgICAgICAgICAgJCgnLmJveF9jYXRlZ29yeSA+IHVsID4gbGknKS5oaWRlKCk7XG4vLyAgICAgICAgICAgICBpZihfaGFzaC5sZW5ndGggPiAxKSB7XG4vLyAgICAgICAgICAgICAgICBpZihfaGFzaFsxXSA9PSAnYWxsJykge1xuLy8gICAgICAgICAgICAgICAgICAgICQoJy5ib3hfY2F0ZWdvcnkgPiB1bCA+IGxpJykuc2hvdygpO1xuLy8gICAgICAgICAgICAgICAgfSBlbHNlIHtcbi8vICAgICAgICAgICAgICAgICAgICAkKCcuYm94X2NhdGVnb3J5ID4gdWwgPiBsaScpLmZpbmQoJyMnK19oYXNoWzFdKS5jbG9zZXN0KCdsaScpLnNob3coKTtcbi8vICAgICAgICAgICAgICAgIH1cbi8vXG4vL1xuLy8gICAgICAgICAgICAgfVxuLy8gICAgICAgICB9XG4vL1xuLy8gICAgICAgICByZXR1cm4gZmFsc2U7XG4vLyAgICAgfSk7XG5cbiAgICAvLyDRj9C60L7RgNC4XG4gICAgJCgnYS5hbmNob3InKS5vbihcImNsaWNrXCIsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdmFyIGFuY2hvciA9ICQodGhpcykuYXR0cignaHJlZicpLnNwbGl0KCcjJyk7XG4gICAgICAgIGlmIChhbmNob3IubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgJCgnaHRtbCwgYm9keScpLnN0b3AoKS5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICBzY3JvbGxUb3A6ICQoJy5ib3gtYW5jaG9yICMnICsgYW5jaG9yWzFdKS5vZmZzZXQoKS50b3BcbiAgICAgICAgICAgIH0sIDEwMDApO1xuICAgICAgICB9XG5cblxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSk7XG5cblxuLy8gICAkKCcuc2VhcmNoLWNhdGVnb3J5Jykub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuLy8gICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuLy8gICAgICAgdmFyIF9vcyA9ICQodGhpcykuYXR0cignYXR0cl9vcycpO1xuLy8gICAgICAgaWYoIF9vcykge1xuLy8gICAgICAgICAgICQuZm4uUHVtcGljTGlzdCgnc2VhcmNoJywge1xuLy8gICAgICAgICAgICAgICAnc2VhcmNoX21ldGhvZCc6ICdnZXRQaG9uZXNCeU9TJyxcbi8vICAgICAgICAgICAgICAgJ19tZXRob2QnOiAnZ2V0Q291bnRPUycsXG4vLyAgICAgICAgICAgICAgICdfcXVlcnknOiBfb3Ncbi8vICAgICAgICAgICB9KTtcbi8vICAgICAgIH1cbi8vXG4vLyAgICAgICByZXR1cm4gZmFsc2U7XG4vLyAgIH0pO1xuXG4gICAgLy8gY29tcGF0aWJpbGl0eSB0b29sdGlwIGluIGRldmljZVxuICAgIGlmICgkKCcubW9iaWxlX3Rvb2x0aXAnKS5sZW5ndGgpIHtcbiAgICAgICAgJCgnLm1vYmlsZV90b29sdGlwJykuZWFzeVRvb2x0aXAoKTtcbiAgICB9XG5cbiAgICAvLyBmb2N1c1xuICAgIGlmICgkKCcuZm9ybS1kaXNjb3VudCcpLmxlbmd0aCkge1xuICAgICAgICB2YXIgZWxlbWVudHMgPSAkKFwiLmZvcm0tZGlzY291bnQgaW5wdXRbdHlwZSE9J3N1Ym1pdCddLCAuZm9ybS1kaXNjb3VudCB0ZXh0YXJlYSwgLmZvcm0tZGlzY291bnQgc2VsZWN0XCIpO1xuICAgICAgICBlbGVtZW50cy5mb2N1cyhmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkKHRoaXMpLmFkZENsYXNzKCdoaWdobGlnaHQnKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGVsZW1lbnRzLmJsdXIoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJCh0aGlzKS5yZW1vdmVDbGFzcygnaGlnaGxpZ2h0Jyk7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIGlmICgkKCcuYm94LWZvcm0nKS5sZW5ndGgpIHtcbiAgICAgICAgdmFyIGVsZW1lbnRzID0gJChcIi5ib3gtZm9ybSBpbnB1dFt0eXBlIT0nc3VibWl0J10sIC5ib3gtZm9ybSB0ZXh0YXJlYSwgLmJveC1mb3JtIHNlbGVjdFwiKTtcbiAgICAgICAgZWxlbWVudHMuZm9jdXMoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJCh0aGlzKS5hZGRDbGFzcygnaGlnaGxpZ2h0Jyk7XG4gICAgICAgIH0pO1xuICAgICAgICBlbGVtZW50cy5ibHVyKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICQodGhpcykucmVtb3ZlQ2xhc3MoJ2hpZ2hsaWdodCcpO1xuICAgICAgICB9KTtcbiAgICB9XG5cblxuICAgIC8vIGNvbXBhdGliaWxpdHlfZm9ybVxuICAgIHZhciB2YWxpZGF0b3Jfc2VuZF9maW5kX3Bob25lID0gJCgnZm9ybVtuYW1lPVwic2VuZF9maW5kX3Bob25lXCJdJykudmFsaWRhdGUoe1xuICAgICAgICBvbmZvY3Vzb3V0OiBmYWxzZSxcbiAgICAgICAgb25rZXl1cDogZmFsc2UsXG4gICAgICAgIG9uY2xpY2s6IHRydWUsXG4gICAgICAgIG9uc3VibWl0OiB0cnVlLFxuICAgICAgICBmb2N1c0ludmFsaWQ6IGZhbHNlLFxuICAgICAgICBmb2N1c0NsZWFudXA6IGZhbHNlLFxuICAgICAgICBkZWJ1ZzogZmFsc2UsXG4gICAgICAgICdkZXZpY2UtbW9kZWwnOiB7XG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICAnY2FwdGNoYSc6IHtcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIGVtYWlsOiB7XG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICAgIGVtYWlsOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIG5hbWU6IHtcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIG1lc3NhZ2VzOiB7XG4gICAgICAgICAgICAnY2FwdGNoYSc6IFwiSW52YWxpZCBDQVBUQ0hBLlwiLCAvLyBUaGUgQ0FQVENIQSBmaWVsZCBpcyBlbXB0eS5cbiAgICAgICAgICAgIG5hbWU6IFwiVGhlIE5hbWUgZmllbGQgaXMgZW1wdHlcIixcbiAgICAgICAgICAgICdkZXZpY2UtbW9kZWwnOiBcIlRoZSBEZXZpY2UgTW9kZWwgZmllbGQgaXMgZW1wdHlcIixcbiAgICAgICAgICAgIGVtYWlsOiB7XG4gICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFwiVGhlIEVtYWlsIGZpZWxkIGlzIGVtcHR5XCIsXG4gICAgICAgICAgICAgICAgZW1haWw6IFwiSW52YWxpZCBlbWFpbCBmb3JtYXRcIlxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBlcnJvckNsYXNzOiBcImludmFsaWRcIixcbiAgICAgICAgdmFsaWRDbGFzczogXCJzdWNjZXNzXCIsXG4gICAgICAgIGludmFsaWRIYW5kbGVyOiBmdW5jdGlvbiAoZXZlbnQsIHZhbGlkYXRvcikge1xuICAgICAgICAgICAgaWYgKCQoJ2Zvcm1bbmFtZT1cInNlbmRfZmluZF9waG9uZVwiXSBzcGFuLmluZm8nKS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgJCgnZm9ybVtuYW1lPVwic2VuZF9maW5kX3Bob25lXCJdIHNwYW4uaW5mbycpLmh0bWwoXCIgXCIpLmhpZGUoKTtcblxuICAgICAgICAgICAgaWYgKCQoJ2Zvcm1bbmFtZT1cInNlbmRfZmluZF9waG9uZVwiXSAuZmF0YWwtZXJyb3InKS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgJCgnZm9ybVtuYW1lPVwic2VuZF9maW5kX3Bob25lXCJdIC5mYXRhbC1lcnJvcicpLmh0bWwoXCIgXCIpLmhpZGUoKTtcblxuICAgICAgICAgICAgaWYgKCQoJ2Zvcm1bbmFtZT1cInNlbmRfZmluZF9waG9uZVwiXSBsYWJlbC5lcnJvciwgZm9ybVtuYW1lPVwic2VuZF9maW5kX3Bob25lXCJdIGxhYmVsLmludmFsaWQnKS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgJCgnZm9ybVtuYW1lPVwic2VuZF9maW5kX3Bob25lXCJdIGxhYmVsLmVycm9yLCBmb3JtW25hbWU9XCJzZW5kX2ZpbmRfcGhvbmVcIl0gbGFiZWwuaW52YWxpZCcpLnJlbW92ZSgpO1xuICAgICAgICB9LFxuICAgICAgICAvLyDRg9C/0YDQsNCy0LvQtdC90LjQtSDQvtGI0LjQsdC60LDQvNC4XG4gICAgICAgIHNob3dFcnJvcnM6IGZ1bmN0aW9uIChlcnJvck1hcCwgZXJyb3JMaXN0KSB7XG4gICAgICAgICAgICB2YXIgX2Zvcm0gPSAkKCdmb3JtW25hbWU9XCJzZW5kX2ZpbmRfcGhvbmVcIl0nKTtcbiAgICAgICAgICAgIHZhciBtc2cgPSBudWxsO1xuXG4gICAgICAgICAgICAkLmVhY2goZXJyb3JMaXN0LCBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5lbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBuYW1lID0gX2Zvcm0uZmluZCh2YWx1ZS5lbGVtZW50KS5hdHRyKCduYW1lJyk7XG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCBuYW1lICk7XG4gICAgICAgICAgICAgICAgICAgIF9mb3JtLmZpbmQodmFsdWUuZWxlbWVudCkuYWZ0ZXIoJzxsYWJlbCBpZD1cIicgKyBuYW1lICsgJy1lcnJvclwiIGZvcj1cIicgKyBuYW1lICsgJ1wiIGNsYXNzPVwiaW52YWxpZFwiPicgKyB2YWx1ZS5tZXNzYWdlICsgJzwvbGFiZWw+Jyk7XG4gICAgICAgICAgICAgICAgICAgIF9mb3JtLmZpbmQodmFsdWUuZWxlbWVudCkubmV4dCgpLnNob3coKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgc3VibWl0SGFuZGxlcjogZnVuY3Rpb24gKGZvcm0pIHtcbiAgICAgICAgICAgIGlmICgkKCdmb3JtW25hbWU9XCJzZW5kX2ZpbmRfcGhvbmVcIl0gc3Bhbi5pbmZvJykubGVuZ3RoKVxuICAgICAgICAgICAgICAgICQoJ2Zvcm1bbmFtZT1cInNlbmRfZmluZF9waG9uZVwiXSBzcGFuLmluZm8nKS5odG1sKFwiIFwiKS5oaWRlKCk7XG5cbiAgICAgICAgICAgIGlmICgkKCdmb3JtW25hbWU9XCJzZW5kX2ZpbmRfcGhvbmVcIl0gLmZhdGFsLWVycm9yJykubGVuZ3RoKVxuICAgICAgICAgICAgICAgICQoJ2Zvcm1bbmFtZT1cInNlbmRfZmluZF9waG9uZVwiXSAuZmF0YWwtZXJyb3InKS5odG1sKFwiIFwiKS5oaWRlKCk7XG5cbiAgICAgICAgICAgIGlmICgkKCdmb3JtW25hbWU9XCJzZW5kX2ZpbmRfcGhvbmVcIl0gbGFiZWwuZXJyb3IsIGZvcm1bbmFtZT1cInNlbmRfZmluZF9waG9uZVwiXSBsYWJlbC5pbnZhbGlkJykubGVuZ3RoKVxuICAgICAgICAgICAgICAgICQoJ2Zvcm1bbmFtZT1cInNlbmRfZmluZF9waG9uZVwiXSBsYWJlbC5lcnJvciwgZm9ybVtuYW1lPVwic2VuZF9maW5kX3Bob25lXCJdIGxhYmVsLmludmFsaWQnKS5yZW1vdmUoKTtcblxuICAgICAgICAgICAgdmFyICRmb3JtID0gJChmb3JtKTtcbiAgICAgICAgICAgIHZhciBfcGFyYW1zID0gcGFyc2VRdWVyeSgkZm9ybS5zZXJpYWxpemVBcnJheSgpKTtcblxuICAgICAgICAgICAgdmFyIF9yZXNwb25zZSA9IGdldEFqYXhGb3JtKCcvY29tcGF0aWJpbGl0eV9zZW5kLmh0bWwnLCBfcGFyYW1zKTtcbiAgICAgICAgICAgIGlmIChfcmVzcG9uc2UucmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgdmFyIF9yZXMgPSBfcmVzcG9uc2UucmVzdWx0O1xuICAgICAgICAgICAgICAgIGlmIChfcmVzLmVycm9yKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBfcmVzLmVycm9yID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKF9yZXMuZXJyb3IsIGZ1bmN0aW9uIChuYW1lLCB0ZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9vYmogPSAkZm9ybS5maW5kKCdpbnB1dFtuYW1lPVwiJyArIG5hbWUgKyAnXCJdJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoX29iai5sZW5ndGgpIHtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoX29iai5uZXh0KCdsYWJlbCcpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX29iai5uZXh0KCkuaHRtbCh0ZXh0KS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCc8bGFiZWwgaWQ9XCInICsgbmFtZSArICctZXJyb3JcIiBmb3I9XCInICsgbmFtZSArICdcIiBjbGFzcz1cImludmFsaWRcIj4nICsgdGV4dCArICc8L2xhYmVsPicpLmluc2VydEFmdGVyKF9vYmopO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCdmb3JtW25hbWU9XCJzZW5kX2ZpbmRfcGhvbmVcIl0gLmZhdGFsLWVycm9yJykuaHRtbChfcmVzLmVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHJlbG9hZENhcHRjaGEoJGZvcm0uZmluZCgnLmJveC1jYXB0Y2hhID4gaW1nJyksIHRydWUpOyAvLyByZWxvYWQgY2FwdGNoYVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChfcmVzLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnZm9ybVtuYW1lPVwic2VuZF9maW5kX3Bob25lXCJdIHNwYW4uaW5mbycpLmh0bWwoX3Jlcy5zdWNjZXNzKS5jc3MoeydkaXNwbGF5JzogJ2lubGluZS1ibG9jayd9KTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBzY3JvbGxUbyBibG9jayBpbmZvXG4gICAgICAgICAgICAgICAgICAgIHZhciB0YXJnZXRfdG9wID0gJCgnZm9ybVtuYW1lPVwic2VuZF9maW5kX3Bob25lXCJdIHNwYW4uaW5mbycpLm9mZnNldCgpLnRvcDtcbiAgICAgICAgICAgICAgICAgICAgJCgnaHRtbCwgYm9keScpLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsVG9wOiBNYXRoLmNlaWwodGFyZ2V0X3RvcCkgLy8gTWF0aC5jZWlsKCh0YXJnZXRfdG9wICogJCh3aW5kb3cpLm91dGVySGVpZ2h0KHRydWUpKSAvICQoJ2h0bWwsIGJvZHknKS5oZWlnaHQoKSlcbiAgICAgICAgICAgICAgICAgICAgfSwgJ2xpbmVhcicpO1xuXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHRhcmdldF90b3AsIE1hdGguY2VpbCgodGFyZ2V0X3RvcCAqICQod2luZG93KS5vdXRlckhlaWdodCh0cnVlKSkgLyAkKCdodG1sLCBib2R5JykuaGVpZ2h0KCkpKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBnb29nbGUgYW5hbGl0eWNzXG4gICAgICAgICAgICAgICAgICAgIGdhKCdzZW5kJywgJ2V2ZW50JywgJ2Zvcm0nLCAnc3VibWl0JywgJ2NvbXBhdGliaWxpdHktcmVxdWVzdC1zdWNjZXNzJyk7XG5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkKCdmb3JtW25hbWU9XCJzZW5kX2ZpbmRfcGhvbmVcIl0gLmZhdGFsLWVycm9yJykuaHRtbCgnWW91ciBlbWFpbCB3YXMgbm90IHNlbnQnKTtcbiAgICAgICAgICAgICAgICAgICAgcmVsb2FkQ2FwdGNoYSgkZm9ybS5maW5kKCcuYm94LWNhcHRjaGEgPiBpbWcnKSwgdHJ1ZSk7IC8vIHJlbG9hZCBjYXB0Y2hhXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJCgnZm9ybVtuYW1lPVwic2VuZF9maW5kX3Bob25lXCJdIC5mYXRhbC1lcnJvcicpLmh0bWwoJ1lvdXIgZW1haWwgd2FzIG5vdCBzZW50Jyk7XG4gICAgICAgICAgICAgICAgcmVsb2FkQ2FwdGNoYSgkZm9ybS5maW5kKCcuYm94LWNhcHRjaGEgPiBpbWcnKSwgdHJ1ZSk7IC8vIHJlbG9hZCBjYXB0Y2hhXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZWxvYWRDYXB0Y2hhKCRmb3JtLmZpbmQoJy5ib3gtY2FwdGNoYSA+IGltZycpLCBmYWxzZSk7IC8vIHJlbG9hZCBjYXB0Y2hhXG4gICAgICAgICAgICAkZm9ybS50cmlnZ2VyKFwicmVzZXRcIik7XG5cbiAgICAgICAgICAgIC8vIHJldHVybiBmYWxzZTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gY2xlYXIgaW5mbyBpbiBmb2N1c1xuICAgICQoJ2Zvcm1bbmFtZT1cInNlbmRfZmluZF9waG9uZVwiXSBpbnB1dCwgZm9ybVtuYW1lPVwic2VuZF9maW5kX3Bob25lXCJdIHRleHRhcmVhJykuZm9jdXMoZnVuY3Rpb24gKCkge1xuICAgICAgICAvL2lmKCQoJ2Zvcm1bbmFtZT1cInNlbmRfZmluZF9waG9uZVwiXSBzcGFuLmluZm8nKS5sZW5ndGgpXG4gICAgICAgIC8vICAgICQoJ2Zvcm1bbmFtZT1cInNlbmRfZmluZF9waG9uZVwiXSBzcGFuLmluZm8nKS5odG1sKCBcIiBcIiApLmhpZGUoKTtcbiAgICAgICAgLy9pZigkKCdmb3JtW25hbWU9XCJzZW5kX2ZpbmRfcGhvbmVcIl0gLmZhdGFsLWVycm9yJykubGVuZ3RoKVxuICAgICAgICAvLyAgICAkKCdmb3JtW25hbWU9XCJzZW5kX2ZpbmRfcGhvbmVcIl0gLmZhdGFsLWVycm9yJykuaHRtbCggXCIgXCIgKS5oaWRlKCk7XG4gICAgICAgIC8vaWYoJCgnZm9ybVtuYW1lPVwic2VuZF9maW5kX3Bob25lXCJdIGxhYmVsLmVycm9yLCBmb3JtW25hbWU9XCJzZW5kX2ZpbmRfcGhvbmVcIl0gbGFiZWwuaW52YWxpZCcpLmxlbmd0aClcbiAgICAgICAgLy8gICAgJCgnZm9ybVtuYW1lPVwic2VuZF9maW5kX3Bob25lXCJdIGxhYmVsLmVycm9yLCBmb3JtW25hbWU9XCJzZW5kX2ZpbmRfcGhvbmVcIl0gbGFiZWwuaW52YWxpZCcpLnJlbW92ZSgpO1xuICAgIH0pO1xuXG4gICAgLy8gY29tcGF0aWJpbGl0eV9mb3JtXG4gICAgdmFyIHZhbGlkYXRvcl9zZW5kX21vYmlsZV9vcGVyYXRvcnNfZmluZF9waG9uZSA9ICQoJ2Zvcm1bbmFtZT1cInNlbmRfbW9iaWxlX29wZXJhdG9yc19maW5kX3Bob25lXCJdJykudmFsaWRhdGUoe1xuICAgICAgICBvbmZvY3Vzb3V0OiBmYWxzZSxcbiAgICAgICAgb25rZXl1cDogZmFsc2UsXG4gICAgICAgIG9uY2xpY2s6IHRydWUsXG4gICAgICAgIG9uc3VibWl0OiB0cnVlLFxuICAgICAgICBmb2N1c0ludmFsaWQ6IGZhbHNlLFxuICAgICAgICBmb2N1c0NsZWFudXA6IGZhbHNlLFxuICAgICAgICBkZWJ1ZzogZmFsc2UsXG4gICAgICAgICdjYXJyaWVyJzoge1xuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWVcbiAgICAgICAgfSxcbiAgICAgICAgJ2NhcHRjaGEnOiB7XG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICBlbWFpbDoge1xuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICBlbWFpbDogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICBtZXNzYWdlczoge1xuICAgICAgICAgICAgJ2NhcHRjaGEnOiBcIkludmFsaWQgQ0FQVENIQS5cIiwgLy8gVGhlIENBUFRDSEEgZmllbGQgaXMgZW1wdHkuXG4gICAgICAgICAgICBuYW1lOiBcIlRoZSBEZXZpY2UgTW9kZWwgZmllbGQgaXMgZW1wdHlcIixcbiAgICAgICAgICAgIGVtYWlsOiB7XG4gICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFwiVGhlIEVtYWlsIGZpZWxkIGlzIGVtcHR5XCIsXG4gICAgICAgICAgICAgICAgZW1haWw6IFwiSW52YWxpZCBlbWFpbCBmb3JtYXRcIlxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBlcnJvckNsYXNzOiBcImludmFsaWRcIixcbiAgICAgICAgdmFsaWRDbGFzczogXCJzdWNjZXNzXCIsXG4gICAgICAgIGludmFsaWRIYW5kbGVyOiBmdW5jdGlvbiAoZXZlbnQsIHZhbGlkYXRvcikge1xuICAgICAgICAgICAgaWYgKCQoJ2Zvcm1bbmFtZT1cInNlbmRfbW9iaWxlX29wZXJhdG9yc19maW5kX3Bob25lXCJdIHNwYW4uaW5mbycpLmxlbmd0aClcbiAgICAgICAgICAgICAgICAkKCdmb3JtW25hbWU9XCJzZW5kX21vYmlsZV9vcGVyYXRvcnNfZmluZF9waG9uZVwiXSBzcGFuLmluZm8nKS5odG1sKFwiIFwiKS5oaWRlKCk7XG5cbiAgICAgICAgICAgIGlmICgkKCdmb3JtW25hbWU9XCJzZW5kX21vYmlsZV9vcGVyYXRvcnNfZmluZF9waG9uZVwiXSAuZmF0YWwtZXJyb3InKS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgJCgnZm9ybVtuYW1lPVwic2VuZF9tb2JpbGVfb3BlcmF0b3JzX2ZpbmRfcGhvbmVcIl0gLmZhdGFsLWVycm9yJykuaHRtbChcIiBcIikuaGlkZSgpO1xuXG4gICAgICAgICAgICBpZiAoJCgnZm9ybVtuYW1lPVwic2VuZF9tb2JpbGVfb3BlcmF0b3JzX2ZpbmRfcGhvbmVcIl0gbGFiZWwuZXJyb3IsIGZvcm1bbmFtZT1cInNlbmRfbW9iaWxlX29wZXJhdG9yc19maW5kX3Bob25lXCJdIGxhYmVsLmludmFsaWQnKS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgJCgnZm9ybVtuYW1lPVwic2VuZF9tb2JpbGVfb3BlcmF0b3JzX2ZpbmRfcGhvbmVcIl0gbGFiZWwuZXJyb3IsIGZvcm1bbmFtZT1cInNlbmRfbW9iaWxlX29wZXJhdG9yc19maW5kX3Bob25lXCJdIGxhYmVsLmludmFsaWQnKS5yZW1vdmUoKTtcbiAgICAgICAgfSxcbiAgICAgICAgLy8g0YPQv9GA0LDQstC70LXQvdC40LUg0L7RiNC40LHQutCw0LzQuFxuICAgICAgICBzaG93RXJyb3JzOiBmdW5jdGlvbiAoZXJyb3JNYXAsIGVycm9yTGlzdCkge1xuICAgICAgICAgICAgdmFyIF9mb3JtID0gJCgnZm9ybVtuYW1lPVwic2VuZF9tb2JpbGVfb3BlcmF0b3JzX2ZpbmRfcGhvbmVcIl0nKTtcbiAgICAgICAgICAgIHZhciBtc2cgPSBudWxsO1xuXG4gICAgICAgICAgICAkLmVhY2goZXJyb3JMaXN0LCBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5lbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBuYW1lID0gX2Zvcm0uZmluZCh2YWx1ZS5lbGVtZW50KS5hdHRyKCduYW1lJyk7XG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCBuYW1lICk7XG4gICAgICAgICAgICAgICAgICAgIF9mb3JtLmZpbmQodmFsdWUuZWxlbWVudCkuYWZ0ZXIoJzxsYWJlbCBpZD1cIicgKyBuYW1lICsgJy1lcnJvclwiIGZvcj1cIicgKyBuYW1lICsgJ1wiIGNsYXNzPVwiaW52YWxpZFwiPicgKyB2YWx1ZS5tZXNzYWdlICsgJzwvbGFiZWw+Jyk7XG4gICAgICAgICAgICAgICAgICAgIF9mb3JtLmZpbmQodmFsdWUuZWxlbWVudCkubmV4dCgpLnNob3coKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgc3VibWl0SGFuZGxlcjogZnVuY3Rpb24gKGZvcm0pIHtcbiAgICAgICAgICAgIGlmICgkKCdmb3JtW25hbWU9XCJzZW5kX21vYmlsZV9vcGVyYXRvcnNfZmluZF9waG9uZVwiXSBzcGFuLmluZm8nKS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgJCgnZm9ybVtuYW1lPVwic2VuZF9tb2JpbGVfb3BlcmF0b3JzX2ZpbmRfcGhvbmVcIl0gc3Bhbi5pbmZvJykuaHRtbChcIiBcIikuaGlkZSgpO1xuXG4gICAgICAgICAgICBpZiAoJCgnZm9ybVtuYW1lPVwic2VuZF9tb2JpbGVfb3BlcmF0b3JzX2ZpbmRfcGhvbmVcIl0gLmZhdGFsLWVycm9yJykubGVuZ3RoKVxuICAgICAgICAgICAgICAgICQoJ2Zvcm1bbmFtZT1cInNlbmRfbW9iaWxlX29wZXJhdG9yc19maW5kX3Bob25lXCJdIC5mYXRhbC1lcnJvcicpLmh0bWwoXCIgXCIpLmhpZGUoKTtcblxuICAgICAgICAgICAgaWYgKCQoJ2Zvcm1bbmFtZT1cInNlbmRfbW9iaWxlX29wZXJhdG9yc19maW5kX3Bob25lXCJdIGxhYmVsLmVycm9yLCBmb3JtW25hbWU9XCJzZW5kX21vYmlsZV9vcGVyYXRvcnNfZmluZF9waG9uZVwiXSBsYWJlbC5pbnZhbGlkJykubGVuZ3RoKVxuICAgICAgICAgICAgICAgICQoJ2Zvcm1bbmFtZT1cInNlbmRfbW9iaWxlX29wZXJhdG9yc19maW5kX3Bob25lXCJdIGxhYmVsLmVycm9yLCBmb3JtW25hbWU9XCJzZW5kX21vYmlsZV9vcGVyYXRvcnNfZmluZF9waG9uZVwiXSBsYWJlbC5pbnZhbGlkJykucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgIHZhciAkZm9ybSA9ICQoZm9ybSk7XG4gICAgICAgICAgICB2YXIgX3BhcmFtcyA9IHBhcnNlUXVlcnkoJGZvcm0uc2VyaWFsaXplQXJyYXkoKSk7XG5cbiAgICAgICAgICAgIHZhciBfcmVzcG9uc2UgPSBnZXRBamF4Rm9ybSgnL2dwcy13aXJlbGVzcy10cmFja2luZy1waG9uZS5odG1sJywgX3BhcmFtcyk7XG4gICAgICAgICAgICBpZiAoX3Jlc3BvbnNlLnJlc3VsdCkge1xuICAgICAgICAgICAgICAgIHZhciBfcmVzID0gX3Jlc3BvbnNlLnJlc3VsdDtcbiAgICAgICAgICAgICAgICBpZiAoX3Jlcy5lcnJvcikge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgX3Jlcy5lcnJvciA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQuZWFjaChfcmVzLmVycm9yLCBmdW5jdGlvbiAobmFtZSwgdGV4dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfb2JqID0gJGZvcm0uZmluZCgnaW5wdXRbbmFtZT1cIicgKyBuYW1lICsgJ1wiXScpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9vYmoubGVuZ3RoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9vYmoubmV4dCgnbGFiZWwnKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9vYmoubmV4dCgpLmh0bWwodGV4dCkuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnPGxhYmVsIGlkPVwiJyArIG5hbWUgKyAnLWVycm9yXCIgZm9yPVwiJyArIG5hbWUgKyAnXCIgY2xhc3M9XCJpbnZhbGlkXCI+JyArIHRleHQgKyAnPC9sYWJlbD4nKS5pbnNlcnRBZnRlcihfb2JqKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgJCgnZm9ybVtuYW1lPVwic2VuZF9tb2JpbGVfb3BlcmF0b3JzX2ZpbmRfcGhvbmVcIl0gLmZhdGFsLWVycm9yJykuaHRtbChfcmVzLmVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHJlbG9hZENhcHRjaGEoJGZvcm0uZmluZCgnLmJveC1jYXB0Y2hhID4gaW1nJyksIHRydWUpOyAvLyByZWxvYWQgY2FwdGNoYVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChfcmVzLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnZm9ybVtuYW1lPVwic2VuZF9tb2JpbGVfb3BlcmF0b3JzX2ZpbmRfcGhvbmVcIl0gc3Bhbi5pbmZvJykuaHRtbChfcmVzLnN1Y2Nlc3MpLmNzcyh7J2Rpc3BsYXknOiAnaW5saW5lLWJsb2NrJ30pO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIHNjcm9sbFRvIGJsb2NrIGluZm9cbiAgICAgICAgICAgICAgICAgICAgdmFyIHRhcmdldF90b3AgPSAkKCdmb3JtW25hbWU9XCJzZW5kX21vYmlsZV9vcGVyYXRvcnNfZmluZF9waG9uZVwiXSBzcGFuLmluZm8nKS5vZmZzZXQoKS50b3A7XG4gICAgICAgICAgICAgICAgICAgICQoJ2h0bWwsIGJvZHknKS5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbFRvcDogTWF0aC5jZWlsKHRhcmdldF90b3ApIC8vIE1hdGguY2VpbCgodGFyZ2V0X3RvcCAqICQod2luZG93KS5vdXRlckhlaWdodCh0cnVlKSkgLyAkKCdodG1sLCBib2R5JykuaGVpZ2h0KCkpXG4gICAgICAgICAgICAgICAgICAgIH0sICdsaW5lYXInKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyggdGFyZ2V0X3RvcCwgTWF0aC5jZWlsKCh0YXJnZXRfdG9wICogJCh3aW5kb3cpLm91dGVySGVpZ2h0KHRydWUpKSAvICQoJ2h0bWwsIGJvZHknKS5oZWlnaHQoKSkgKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBnb29nbGUgYW5hbGl0eWNzXG4gICAgICAgICAgICAgICAgICAgIGdhKCdzZW5kJywgJ2V2ZW50JywgJ2Zvcm0nLCAnc3VibWl0JywgJ21vYmlsZS1vcGVyYXRvcnMtcmVxdWVzdC1zdWNjZXNzJyk7XG5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkKCdmb3JtW25hbWU9XCJzZW5kX21vYmlsZV9vcGVyYXRvcnNfZmluZF9waG9uZVwiXSAuZmF0YWwtZXJyb3InKS5odG1sKCdZb3VyIGVtYWlsIHdhcyBub3Qgc2VudCcpO1xuICAgICAgICAgICAgICAgICAgICByZWxvYWRDYXB0Y2hhKCRmb3JtLmZpbmQoJy5ib3gtY2FwdGNoYSA+IGltZycpLCB0cnVlKTsgLy8gcmVsb2FkIGNhcHRjaGFcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKCdmb3JtW25hbWU9XCJzZW5kX21vYmlsZV9vcGVyYXRvcnNfZmluZF9waG9uZVwiXSAuZmF0YWwtZXJyb3InKS5odG1sKCdZb3VyIGVtYWlsIHdhcyBub3Qgc2VudCcpO1xuICAgICAgICAgICAgICAgIHJlbG9hZENhcHRjaGEoJGZvcm0uZmluZCgnLmJveC1jYXB0Y2hhID4gaW1nJyksIHRydWUpOyAvLyByZWxvYWQgY2FwdGNoYVxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmVsb2FkQ2FwdGNoYSgkZm9ybS5maW5kKCcuYm94LWNhcHRjaGEgPiBpbWcnKSwgZmFsc2UpOyAvLyByZWxvYWQgY2FwdGNoYVxuICAgICAgICAgICAgJGZvcm0udHJpZ2dlcihcInJlc2V0XCIpO1xuXG4gICAgICAgICAgICAvLyByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIGNsZWFyIGluZm8gaW4gZm9jdXNcbiAgICAkKCdmb3JtW25hbWU9XCJzZW5kX21vYmlsZV9vcGVyYXRvcnNfZmluZF9waG9uZVwiXSBpbnB1dCwgZm9ybVtuYW1lPVwic2VuZF9tb2JpbGVfb3BlcmF0b3JzX2ZpbmRfcGhvbmVcIl0gdGV4dGFyZWEnKS5mb2N1cyhmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vaWYoJCgnZm9ybVtuYW1lPVwic2VuZF9tb2JpbGVfb3BlcmF0b3JzX2ZpbmRfcGhvbmVcIl0gc3Bhbi5pbmZvJykubGVuZ3RoKVxuICAgICAgICAvLyAgICAkKCdmb3JtW25hbWU9XCJzZW5kX21vYmlsZV9vcGVyYXRvcnNfZmluZF9waG9uZVwiXSBzcGFuLmluZm8nKS5odG1sKCBcIiBcIiApLmhpZGUoKTtcbiAgICAgICAgLy9pZigkKCdmb3JtW25hbWU9XCJzZW5kX21vYmlsZV9vcGVyYXRvcnNfZmluZF9waG9uZVwiXSAuZmF0YWwtZXJyb3InKS5sZW5ndGgpXG4gICAgICAgIC8vICAgICQoJ2Zvcm1bbmFtZT1cInNlbmRfbW9iaWxlX29wZXJhdG9yc19maW5kX3Bob25lXCJdIC5mYXRhbC1lcnJvcicpLmh0bWwoIFwiIFwiICkuaGlkZSgpO1xuICAgICAgICAvL2lmKCQoJ2Zvcm1bbmFtZT1cInNlbmRfbW9iaWxlX29wZXJhdG9yc19maW5kX3Bob25lXCJdIGxhYmVsLmVycm9yLCBmb3JtW25hbWU9XCJzZW5kX21vYmlsZV9vcGVyYXRvcnNfZmluZF9waG9uZVwiXSBsYWJlbC5pbnZhbGlkJykubGVuZ3RoKVxuICAgICAgICAvLyAgICAkKCdmb3JtW25hbWU9XCJzZW5kX21vYmlsZV9vcGVyYXRvcnNfZmluZF9waG9uZVwiXSBsYWJlbC5lcnJvciwgZm9ybVtuYW1lPVwic2VuZF9tb2JpbGVfb3BlcmF0b3JzX2ZpbmRfcGhvbmVcIl0gbGFiZWwuaW52YWxpZCcpLnJlbW92ZSgpO1xuICAgIH0pO1xuXG5cbiAgICAvLyB2YWxpZGF0b3IgZmFxIChmb3JtLWZhcS1zZW5kKVxuICAgIHZhciB2YWxpZGF0b3JfZm9ybV9mYXEgPSAkKCdmb3JtLmZvcm0tZmFxLXNlbmQnKS52YWxpZGF0ZSh7XG4gICAgICAgIG9uZm9jdXNvdXQ6IGZhbHNlLFxuICAgICAgICBmb2N1c0ludmFsaWQ6IGZhbHNlLFxuICAgICAgICAnbmFtZSc6IHtcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgICdxdWVzdGlvbic6IHtcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIGVtYWlsOiB7XG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICAgIGVtYWlsOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIG1lc3NhZ2VzOiB7XG4gICAgICAgICAgICBuYW1lOiBcIlRoZSBOYW1lIGZpZWxkIGlzIGVtcHR5XCIsXG4gICAgICAgICAgICBxdWVzdGlvbjogJ1RoZSBRdWVzdGlvbiBmaWVsZCBpcyBlbXB0eScsXG4gICAgICAgICAgICBlbWFpbDoge1xuICAgICAgICAgICAgICAgIHJlcXVpcmVkOiBcIlRoZSBFbWFpbCBmaWVsZCBpcyBlbXB0eVwiLFxuICAgICAgICAgICAgICAgIGVtYWlsOiBcIkludmFsaWQgZW1haWwgZm9ybWF0XCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yQ2xhc3M6IFwiaW52YWxpZFwiLFxuICAgICAgICB2YWxpZENsYXNzOiBcInN1Y2Nlc3NcIixcbiAgICAgICAgaW52YWxpZEhhbmRsZXI6IGZ1bmN0aW9uIChldmVudCwgdmFsaWRhdG9yKSB7XG4gICAgICAgICAgICBpZiAoJCgnZm9ybS5mb3JtLWZhcS1zZW5kIHNwYW4uaW5mbycpLmxlbmd0aClcbiAgICAgICAgICAgICAgICAkKCdmb3JtLmZvcm0tZmFxLXNlbmQgc3Bhbi5pbmZvJykuaHRtbChcIiBcIikuaGlkZSgpO1xuXG4gICAgICAgICAgICBpZiAoJCgnZm9ybS5mb3JtLWZhcS1zZW5kIC5mYXRhbC1lcnJvcicpLmxlbmd0aClcbiAgICAgICAgICAgICAgICAkKCdmb3JtLmZvcm0tZmFxLXNlbmQgLmZhdGFsLWVycm9yJykuaHRtbChcIiBcIikuaGlkZSgpO1xuICAgICAgICB9LFxuICAgICAgICBzdWJtaXRIYW5kbGVyOiBmdW5jdGlvbiAoZm9ybSkge1xuICAgICAgICAgICAgaWYgKCQoJ2Zvcm0uZm9ybS1mYXEtc2VuZCBzcGFuLmluZm8nKS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgJCgnZm9ybS5mb3JtLWZhcS1zZW5kIHNwYW4uaW5mbycpLmh0bWwoXCIgXCIpLmhpZGUoKTtcblxuICAgICAgICAgICAgaWYgKCQoJ2Zvcm0uZm9ybS1mYXEtc2VuZCAuZmF0YWwtZXJyb3InKS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgJCgnZm9ybS5mb3JtLWZhcS1zZW5kIC5mYXRhbC1lcnJvcicpLmh0bWwoXCIgXCIpLmhpZGUoKTtcblxuICAgICAgICAgICAgdmFyICRmb3JtID0gJChmb3JtKTtcbiAgICAgICAgICAgIHZhciBfcGFyYW1zID0gcGFyc2VRdWVyeSgkZm9ybS5zZXJpYWxpemVBcnJheSgpKTtcblxuICAgICAgICAgICAgdmFyIF9yZXNwb25zZSA9IGdldEFqYXhGb3JtKCcvZmFxX3NlbmQuaHRtbCcsIF9wYXJhbXMpO1xuICAgICAgICAgICAgaWYgKF9yZXNwb25zZS5yZXN1bHQpIHtcbiAgICAgICAgICAgICAgICB2YXIgX3JlcyA9IF9yZXNwb25zZS5yZXN1bHQ7XG4gICAgICAgICAgICAgICAgaWYgKF9yZXMuZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBfcmVzLmVycm9yID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKF9yZXMuZXJyb3IsIGZ1bmN0aW9uIChuYW1lLCB0ZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9vYmogPSAkZm9ybS5maW5kKCdpbnB1dFtuYW1lPVwiJyArIG5hbWUgKyAnXCJdJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9vYmoubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfb2JqLm5leHQoJ2xhYmVsJykubGVuZ3RoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX29iai5uZXh0KCkuaHRtbCh0ZXh0KS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJzxsYWJlbCBpZD1cIicgKyBuYW1lICsgJy1lcnJvclwiIGZvcj1cIicgKyBuYW1lICsgJ1wiIGNsYXNzPVwiaW52YWxpZFwiPicgKyB0ZXh0ICsgJzwvbGFiZWw+JykuaW5zZXJ0QWZ0ZXIoX29iaik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCdmb3JtLmZvcm0tZmFxLXNlbmQgLmZhdGFsLWVycm9yJykuaHRtbChfcmVzLmVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoX3Jlcy5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgICQoJ2Zvcm0uZm9ybS1mYXEtc2VuZCBzcGFuLmluZm8nKS5odG1sKF9yZXMuc3VjY2VzcykuY3NzKHsnZGlzcGxheSc6ICdpbmxpbmUtYmxvY2snfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gZ29vZ2xlIGFuYWxpdHljc1xuICAgICAgICAgICAgICAgICAgICBnYSgnc2VuZCcsICdldmVudCcsICdmb3JtJywgJ3N1Ym1pdCcsICdmYXEtcmVxdWVzdC1zdWNjZXNzJyk7XG5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkKCdmb3JtLmZvcm0tZmFxLXNlbmQgLmZhdGFsLWVycm9yJykuaHRtbCgnWW91ciBlbWFpbCB3YXMgbm90IHNlbnQnKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1N5c3RlbSBlcnJvciEnKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKCdmb3JtLmZvcm0tZmFxLXNlbmQgLmZhdGFsLWVycm9yJykuaHRtbCgnWW91ciBlbWFpbCB3YXMgbm90IHNlbnQnKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnQ2FuIG5vdCBnZXQgcGFyYW1zIGluIGFqYXghJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG5cbiAgICAgICAgICAgICRmb3JtLnRyaWdnZXIoXCJyZXNldFwiKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gY2xlYXIgaW5mbyBpbiBmb2N1c1xuICAgICQoJ2Zvcm0uZm9ybS1mYXEtc2VuZCBpbnB1dCwgZm9ybS5mb3JtLWZhcS1zZW5kIHRleHRhcmVhJykuZm9jdXMoZnVuY3Rpb24gKCkge1xuLy8gICAgICAgIGlmKCQoJ2Zvcm0uZm9ybS1mYXEtc2VuZCBzcGFuLmluZm8nKS5sZW5ndGgpXG4vLyAgICAgICAgICAgICQoJ2Zvcm0uZm9ybS1mYXEtc2VuZCBzcGFuLmluZm8nKS5odG1sKCBcIiBcIiApLmhpZGUoKTtcbi8vICAgICAgICBpZigkKCdmb3JtLmZvcm0tZmFxLXNlbmQgLmZhdGFsLWVycm9yJykubGVuZ3RoKVxuLy8gICAgICAgICAgICAkKCdmb3JtLmZvcm0tZmFxLXNlbmQgLmZhdGFsLWVycm9yJykuaHRtbCggXCIgXCIgKS5oaWRlKCk7XG4vLyAgICAgICAgaWYoJCgnZm9ybS5mb3JtLWZhcS1zZW5kIGxhYmVsLmVycm9yLCBmb3JtLmZvcm0tZmFxLXNlbmQgbGFiZWwuaW52YWxpZCcpLmxlbmd0aClcbi8vICAgICAgICAgICAgJCgnZm9ybS5mb3JtLWZhcS1zZW5kIGxhYmVsLmVycm9yLCBmb3JtLmZvcm0tZmFxLXNlbmQgbGFiZWwuaW52YWxpZCcpLnJlbW92ZSgpO1xuICAgIH0pO1xuXG5cblxuICAgIC8qIHZhbGlkYXRlIGNvbnRhY3QgdXMgKi9cbiAgICAkKCdmb3JtLmZvcm0tY29udGFjdC11cyBzZWxlY3QnKVxuICAgICAgICAgICAgLmNoYW5nZShmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyIF9zZWxlY3RlZCA9IGZhbHNlO1xuICAgICAgICAgICAgICAgICQoJ2Zvcm0uZm9ybS1jb250YWN0LXVzICN3b3MnKS52YWwoJycpO1xuICAgICAgICAgICAgICAgICQodGhpcykuZmluZChcIm9wdGlvbjpzZWxlY3RlZFwiKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgX3NlbGVjdGVkID0gJCh0aGlzKS52YWwoKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGlmIChfc2VsZWN0ZWQgJiYgX3NlbGVjdGVkICE9ICcwJykge1xuICAgICAgICAgICAgICAgICAgICAkKCdmb3JtLmZvcm0tY29udGFjdC11cyAjd29zJykudmFsKF9zZWxlY3RlZCkudmFsaWQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gJCh0aGlzKS5zZWxlY3RwaWNrZXIoJ2hpZGUnKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2hhbmdlKCk7XG5cblxuICAgIHZhciB2YWxpZGF0b3JfY29udGFjdF91cyA9ICQoJ2Zvcm0uZm9ybS1jb250YWN0LXVzJykudmFsaWRhdGUoe1xuICAgICAgICBvbmZvY3Vzb3V0OiBmYWxzZSxcbiAgICAgICAgb25rZXl1cDogZmFsc2UsXG4gICAgICAgIG9uY2xpY2s6IHRydWUsXG4gICAgICAgIG9uc3VibWl0OiB0cnVlLFxuICAgICAgICBmb2N1c0ludmFsaWQ6IGZhbHNlLFxuICAgICAgICBmb2N1c0NsZWFudXA6IGZhbHNlLFxuICAgICAgICBkZWJ1ZzogZmFsc2UsXG4gICAgICAgIGlnbm9yZTogXCJub3Q6aGlkZGVuXCIsXG4gICAgICAgICduYW1lJzoge1xuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWVcbiAgICAgICAgfSxcbiAgICAgICAgJ2Rlc2NyaXB0aW9uJzoge1xuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWVcbiAgICAgICAgfSxcbiAgICAgICAgd29zOiB7XG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICBlbWFpbDoge1xuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICBlbWFpbDogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICAnY2FwdGNoYSc6IHtcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICB9LFxuICAgICAgICBtZXNzYWdlczoge1xuICAgICAgICAgICAgJ2NhcHRjaGEnOiBcIkludmFsaWQgQ0FQVENIQS5cIiwgLy8gVGhlIENBUFRDSEEgZmllbGQgaXMgZW1wdHkuXG4gICAgICAgICAgICBuYW1lOiBcIlRoZSBOYW1lIGZpZWxkIGlzIGVtcHR5XCIsXG4gICAgICAgICAgICBkZXNjcmlwdGlvbjogJ1RoZSBRdWVzdGlvbiBmaWVsZCBpcyBlbXB0eScsXG4gICAgICAgICAgICB3b3M6ICdUaGUgZmllbGQgQ2hvb3NlIHlvdXIgT1MgaXMgZW1wdHknLFxuICAgICAgICAgICAgZW1haWw6IHtcbiAgICAgICAgICAgICAgICByZXF1aXJlZDogXCJUaGUgRW1haWwgZmllbGQgaXMgZW1wdHlcIixcbiAgICAgICAgICAgICAgICBlbWFpbDogXCJJbnZhbGlkIGVtYWlsIGZvcm1hdFwiXG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBlcnJvckNsYXNzOiBcImludmFsaWRcIixcbiAgICAgICAgdmFsaWRDbGFzczogXCJzdWNjZXNzXCIsXG4gICAgICAgIGludmFsaWRIYW5kbGVyOiBmdW5jdGlvbiAoZXZlbnQsIHZhbGlkYXRvcikge1xuICAgICAgICAgICAgaWYgKCQoJ2Zvcm0uZm9ybS1jb250YWN0LXVzIHNwYW4uaW5mbycpLmxlbmd0aClcbiAgICAgICAgICAgICAgICAkKCdmb3JtLmZvcm0tY29udGFjdC11cyBzcGFuLmluZm8nKS5odG1sKFwiIFwiKS5oaWRlKCk7XG5cbiAgICAgICAgICAgIGlmICgkKCdmb3JtLmZvcm0tY29udGFjdC11cyAuZmF0YWwtZXJyb3InKS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgJCgnZm9ybS5mb3JtLWNvbnRhY3QtdXMgLmZhdGFsLWVycm9yJykuaHRtbChcIiBcIikuaGlkZSgpO1xuXG4gICAgICAgICAgICBpZiAoJCgnZm9ybS5mb3JtLWNvbnRhY3QtdXMgbGFiZWwuZXJyb3IsIGZvcm0uZm9ybS1jb250YWN0LXVzIGxhYmVsLmludmFsaWQnKS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgJCgnZm9ybS5mb3JtLWNvbnRhY3QtdXMgbGFiZWwuZXJyb3IsIGZvcm0uZm9ybS1jb250YWN0LXVzIGxhYmVsLmludmFsaWQnKS5yZW1vdmUoKTtcbiAgICAgICAgfSxcbiAgICAgICAgLy8g0YPQv9GA0LDQstC70LXQvdC40LUg0L7RiNC40LHQutCw0LzQuFxuICAgICAgICBzaG93RXJyb3JzOiBmdW5jdGlvbiAoZXJyb3JNYXAsIGVycm9yTGlzdCkge1xuICAgICAgICAgICAgdmFyIF9mb3JtID0gJCgnZm9ybS5mb3JtLWNvbnRhY3QtdXMnKTtcbiAgICAgICAgICAgIHZhciBtc2cgPSBudWxsO1xuXG4gICAgICAgICAgICAkLmVhY2goZXJyb3JMaXN0LCBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5lbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBuYW1lID0gX2Zvcm0uZmluZCh2YWx1ZS5lbGVtZW50KS5hdHRyKCduYW1lJyk7XG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKCBuYW1lICk7XG4gICAgICAgICAgICAgICAgICAgIF9mb3JtLmZpbmQodmFsdWUuZWxlbWVudCkuYWZ0ZXIoJzxsYWJlbCBpZD1cIicgKyBuYW1lICsgJy1lcnJvclwiIGZvcj1cIicgKyBuYW1lICsgJ1wiIGNsYXNzPVwiaW52YWxpZFwiPicgKyB2YWx1ZS5tZXNzYWdlICsgJzwvbGFiZWw+Jyk7XG4gICAgICAgICAgICAgICAgICAgIF9mb3JtLmZpbmQodmFsdWUuZWxlbWVudCkubmV4dCgpLnNob3coKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSxcbiAgICAgICAgc3VibWl0SGFuZGxlcjogZnVuY3Rpb24gKGZvcm0pIHtcbiAgICAgICAgICAgIGlmICgkKCdmb3JtLmZvcm0tY29udGFjdC11cyBzcGFuLmluZm8nKS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgJCgnZm9ybS5mb3JtLWNvbnRhY3QtdXMgc3Bhbi5pbmZvJykuaHRtbChcIiBcIikuaGlkZSgpO1xuXG4gICAgICAgICAgICBpZiAoJCgnZm9ybS5mb3JtLWNvbnRhY3QtdXMgLmZhdGFsLWVycm9yJykubGVuZ3RoKVxuICAgICAgICAgICAgICAgICQoJ2Zvcm0uZm9ybS1jb250YWN0LXVzIC5mYXRhbC1lcnJvcicpLmh0bWwoXCIgXCIpLmhpZGUoKTtcblxuICAgICAgICAgICAgaWYgKCQoJ2Zvcm0uZm9ybS1jb250YWN0LXVzIGxhYmVsLmVycm9yLCBmb3JtLmZvcm0tY29udGFjdC11cyBsYWJlbC5pbnZhbGlkJykubGVuZ3RoKVxuICAgICAgICAgICAgICAgICQoJ2Zvcm0uZm9ybS1jb250YWN0LXVzIGxhYmVsLmVycm9yLCBmb3JtLmZvcm0tY29udGFjdC11cyBsYWJlbC5pbnZhbGlkJykucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgIHZhciAkZm9ybSA9ICQoZm9ybSk7XG4gICAgICAgICAgICB2YXIgX3BhcmFtcyA9IHBhcnNlUXVlcnkoJGZvcm0uc2VyaWFsaXplQXJyYXkoKSk7XG5cblxuICAgICAgICAgICAgdmFyIF9yZXNwb25zZSA9IGdldEFqYXhGb3JtKCcvY29udGFjdF91c19zZW5kLmh0bWwnLCBfcGFyYW1zKTtcbiAgICAgICAgICAgIGlmIChfcmVzcG9uc2UucmVzdWx0KSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgX3JlcyA9IF9yZXNwb25zZS5yZXN1bHQ7XG4gICAgICAgICAgICAgICAgaWYgKF9yZXMuZXJyb3IpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIF9yZXMuZXJyb3IgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2goX3Jlcy5lcnJvciwgZnVuY3Rpb24gKG5hbWUsIHRleHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgX29iaiA9ICRmb3JtLmZpbmQoJ2lucHV0W25hbWU9XCInICsgbmFtZSArICdcIl0nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoX29iai5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9vYmoubmV4dCgnbGFiZWwnKS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfb2JqLm5leHQoKS5odG1sKHRleHQpLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnPGxhYmVsIGlkPVwiJyArIG5hbWUgKyAnLWVycm9yXCIgZm9yPVwiJyArIG5hbWUgKyAnXCIgY2xhc3M9XCJpbnZhbGlkXCI+JyArIHRleHQgKyAnPC9sYWJlbD4nKS5pbnNlcnRBZnRlcihfb2JqKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJ2Zvcm0uZm9ybS1jb250YWN0LXVzIC5mYXRhbC1lcnJvcicpLmh0bWwoX3Jlcy5lcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZWxvYWRDYXB0Y2hhKCRmb3JtLmZpbmQoJy5ib3gtY2FwdGNoYSA+IGltZycpLCB0cnVlKTsgLy8gcmVsb2FkIGNhcHRjaGFcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoX3Jlcy5zdWNjZXNzKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgJCgnZm9ybS5mb3JtLWNvbnRhY3QtdXMgc3Bhbi5pbmZvJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuaHRtbChfcmVzLnN1Y2Nlc3MpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNzcyh7J2Rpc3BsYXknOiAnaW5saW5lLWJsb2NrJ30pO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIHNjcm9sbFRvIGJsb2NrIGluZm9cbiAgICAgICAgICAgICAgICAgICAgdmFyIHRhcmdldF90b3AgPSAkKCdmb3JtLmZvcm0tY29udGFjdC11cyBzcGFuLmluZm8nKS5vZmZzZXQoKS50b3A7XG4gICAgICAgICAgICAgICAgICAgICQoJ2h0bWwsIGJvZHknKS5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbFRvcDogTWF0aC5jZWlsKCh0YXJnZXRfdG9wICogJCh3aW5kb3cpLm91dGVySGVpZ2h0KHRydWUpKSAvICQoJ2h0bWwsIGJvZHknKS5oZWlnaHQoKSlcbiAgICAgICAgICAgICAgICAgICAgfSwgJ2xpbmVhcicpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGdvb2dsZSBhbmFsaXR5Y3NcbiAgICAgICAgICAgICAgICAgICAgZ2EoJ3NlbmQnLCAnZXZlbnQnLCAnZm9ybScsICdzdWJtaXQnLCAnY29udGFjdC1yZXF1ZXN0LXN1Y2Nlc3MnKTtcblxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICQoJ2Zvcm0uZm9ybS1jb250YWN0LXVzIC5mYXRhbC1lcnJvcicpLmh0bWwoJ1lvdXIgZW1haWwgd2FzIG5vdCBzZW50Jyk7XG4gICAgICAgICAgICAgICAgICAgIHJlbG9hZENhcHRjaGEoJGZvcm0uZmluZCgnLmJveC1jYXB0Y2hhID4gaW1nJyksIHRydWUpOyAvLyByZWxvYWQgY2FwdGNoYVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICQoJ2Zvcm0uZm9ybS1jb250YWN0LXVzIC5mYXRhbC1lcnJvcicpLmh0bWwoJ1lvdXIgZW1haWwgd2FzIG5vdCBzZW50Jyk7XG4gICAgICAgICAgICAgICAgcmVsb2FkQ2FwdGNoYSgkZm9ybS5maW5kKCcuYm94LWNhcHRjaGEgPiBpbWcnKSwgdHJ1ZSk7IC8vIHJlbG9hZCBjYXB0Y2hhXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZWxvYWRDYXB0Y2hhKCRmb3JtLmZpbmQoJy5ib3gtY2FwdGNoYSA+IGltZycpKTsgLy8gcmVsb2FkIGNhcHRjaGFcbiAgICAgICAgICAgICRmb3JtLnRyaWdnZXIoXCJyZXNldFwiKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG4vLyAgICAkKCdmb3JtLmZvcm0tY29udGFjdC11c1wiXScpLm9uKCdzdWJtaXQnLCBmdW5jdGlvbigpIHtcbi8vICAgICAgIGFsZXJ0KCdvayEnKTtcbi8vICAgICAgICByZXR1cm4gZmFsc2U7XG4vLyAgICB9KTtcblxuICAgICQoJ2Zvcm0uZm9ybS1jb250YWN0LXVzIGlucHV0LCBmb3JtLmZvcm0tY29udGFjdC11cyB0ZXh0YXJlYScpLmZvY3VzKGZ1bmN0aW9uICgpIHtcbi8vICAgICAgICBpZigkKCdmb3JtLmZvcm0tY29udGFjdC11cyBzcGFuLmluZm8nKS5sZW5ndGgpXG4vLyAgICAgICAgICAgICQoJ2Zvcm0uZm9ybS1jb250YWN0LXVzIHNwYW4uaW5mbycpLmh0bWwoIFwiIFwiICkuaGlkZSgpO1xuLy8gICAgICAgIGlmKCQoJ2Zvcm0uZm9ybS1jb250YWN0LXVzIC5mYXRhbC1lcnJvcicpLmxlbmd0aClcbi8vICAgICAgICAgICAgJCgnZm9ybS5mb3JtLWNvbnRhY3QtdXMgLmZhdGFsLWVycm9yJykuaHRtbCggXCIgXCIgKS5oaWRlKCk7XG4vLyAgICAgICAgaWYoJCgnZm9ybS5mb3JtLWNvbnRhY3QtdXMgbGFiZWwuZXJyb3IsIGZvcm0uZm9ybS1jb250YWN0LXVzIGxhYmVsLmludmFsaWQnKS5sZW5ndGgpXG4vLyAgICAgICAgICAgICQoJ2Zvcm0uZm9ybS1jb250YWN0LXVzIGxhYmVsLmVycm9yLCBmb3JtLmZvcm0tY29udGFjdC11cyBsYWJlbC5pbnZhbGlkJykucmVtb3ZlKCk7XG4gICAgfSk7XG5cbiAgICAvKiB2YWxpZGF0ZSBmYXEgZm9ybSAqL1xuICAgICQoJ2Zvcm0uZm9ybS1mYXEgc2VsZWN0JylcbiAgICAgICAgICAgIC5jaGFuZ2UoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBfc2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAkKCdmb3JtLmZvcm0tZmFxICN3b3MnKS52YWwoJycpO1xuICAgICAgICAgICAgICAgICQodGhpcykuZmluZChcIm9wdGlvbjpzZWxlY3RlZFwiKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgX3NlbGVjdGVkID0gJCh0aGlzKS52YWwoKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGlmIChfc2VsZWN0ZWQgJiYgX3NlbGVjdGVkICE9ICcwJykge1xuICAgICAgICAgICAgICAgICAgICAkKCdmb3JtLmZvcm0tZmFxICN3b3MnKS52YWwoX3NlbGVjdGVkKS52YWxpZCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAvLyAkKHRoaXMpLnNlbGVjdHBpY2tlcignaGlkZScpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jaGFuZ2UoKTtcblxuXG4gICAgdmFyIHZhbGlkYXRvcl9jb250YWN0X3VzID0gJCgnZm9ybS5mb3JtLWZhcScpLnZhbGlkYXRlKHtcbiAgICAgICAgb25mb2N1c291dDogZmFsc2UsXG4gICAgICAgIG9ua2V5dXA6IGZhbHNlLFxuICAgICAgICBvbmNsaWNrOiB0cnVlLFxuICAgICAgICBvbnN1Ym1pdDogdHJ1ZSxcbiAgICAgICAgZm9jdXNJbnZhbGlkOiBmYWxzZSxcbiAgICAgICAgZm9jdXNDbGVhbnVwOiBmYWxzZSxcbiAgICAgICAgZGVidWc6IGZhbHNlLFxuICAgICAgICBpZ25vcmU6IFwibm90OmhpZGRlblwiLFxuICAgICAgICAnbmFtZSc6IHtcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgICdkZXNjcmlwdGlvbic6IHtcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIHdvczoge1xuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWVcbiAgICAgICAgfSxcbiAgICAgICAgZW1haWw6IHtcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgICAgZW1haWw6IHRydWVcbiAgICAgICAgfSxcbiAgICAgICAgJ2NhcHRjaGEnOiB7XG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgICAgbWVzc2FnZXM6IHtcbiAgICAgICAgICAgICdjYXB0Y2hhJzogXCJJbnZhbGlkIENBUFRDSEEuXCIsIC8vIFRoZSBDQVBUQ0hBIGZpZWxkIGlzIGVtcHR5LlxuICAgICAgICAgICAgbmFtZTogXCJUaGUgTmFtZSBmaWVsZCBpcyBlbXB0eVwiLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246ICdUaGUgUXVlc3Rpb24gZmllbGQgaXMgZW1wdHknLFxuICAgICAgICAgICAgd29zOiAnVGhlIGZpZWxkIENob29zZSB5b3VyIE9TIGlzIGVtcHR5JyxcbiAgICAgICAgICAgIGVtYWlsOiB7XG4gICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFwiVGhlIEVtYWlsIGZpZWxkIGlzIGVtcHR5XCIsXG4gICAgICAgICAgICAgICAgZW1haWw6IFwiSW52YWxpZCBlbWFpbCBmb3JtYXRcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3JDbGFzczogXCJpbnZhbGlkXCIsXG4gICAgICAgIHZhbGlkQ2xhc3M6IFwic3VjY2Vzc1wiLFxuICAgICAgICBpbnZhbGlkSGFuZGxlcjogZnVuY3Rpb24gKGV2ZW50LCB2YWxpZGF0b3IpIHtcbiAgICAgICAgICAgIGlmICgkKCdmb3JtLmZvcm0tZmFxIHNwYW4uaW5mbycpLmxlbmd0aClcbiAgICAgICAgICAgICAgICAkKCdmb3JtLmZvcm0tZmFxIHNwYW4uaW5mbycpLmh0bWwoXCIgXCIpLmhpZGUoKTtcblxuICAgICAgICAgICAgaWYgKCQoJ2Zvcm0uZm9ybS1mYXEgLmZhdGFsLWVycm9yJykubGVuZ3RoKVxuICAgICAgICAgICAgICAgICQoJ2Zvcm0uZm9ybS1mYXEgLmZhdGFsLWVycm9yJykuaHRtbChcIiBcIikuaGlkZSgpO1xuXG4gICAgICAgICAgICBpZiAoJCgnZm9ybS5mb3JtLWZhcSBsYWJlbC5lcnJvciwgZm9ybS5mb3JtLWZhcSBsYWJlbC5pbnZhbGlkJykubGVuZ3RoKVxuICAgICAgICAgICAgICAgICQoJ2Zvcm0uZm9ybS1mYXEgbGFiZWwuZXJyb3IsIGZvcm0uZm9ybS1mYXEgbGFiZWwuaW52YWxpZCcpLnJlbW92ZSgpO1xuICAgICAgICB9LFxuICAgICAgICAvLyDRg9C/0YDQsNCy0LvQtdC90LjQtSDQvtGI0LjQsdC60LDQvNC4XG4gICAgICAgIHNob3dFcnJvcnM6IGZ1bmN0aW9uIChlcnJvck1hcCwgZXJyb3JMaXN0KSB7XG4gICAgICAgICAgICB2YXIgX2Zvcm0gPSAkKCdmb3JtLmZvcm0tZmFxJyk7XG4gICAgICAgICAgICB2YXIgbXNnID0gbnVsbDtcblxuICAgICAgICAgICAgJC5lYWNoKGVycm9yTGlzdCwgZnVuY3Rpb24gKGtleSwgdmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUuZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IF9mb3JtLmZpbmQodmFsdWUuZWxlbWVudCkuYXR0cignbmFtZScpO1xuICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyggbmFtZSApO1xuICAgICAgICAgICAgICAgICAgICBfZm9ybS5maW5kKHZhbHVlLmVsZW1lbnQpLmFmdGVyKCc8bGFiZWwgaWQ9XCInICsgbmFtZSArICctZXJyb3JcIiBmb3I9XCInICsgbmFtZSArICdcIiBjbGFzcz1cImludmFsaWRcIj4nICsgdmFsdWUubWVzc2FnZSArICc8L2xhYmVsPicpO1xuICAgICAgICAgICAgICAgICAgICBfZm9ybS5maW5kKHZhbHVlLmVsZW1lbnQpLm5leHQoKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHN1Ym1pdEhhbmRsZXI6IGZ1bmN0aW9uIChmb3JtKSB7XG4gICAgICAgICAgICBpZiAoJCgnZm9ybS5mb3JtLWZhcSBzcGFuLmluZm8nKS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgJCgnZm9ybS5mb3JtLWZhcSBzcGFuLmluZm8nKS5odG1sKFwiIFwiKS5oaWRlKCk7XG5cbiAgICAgICAgICAgIGlmICgkKCdmb3JtLmZvcm0tZmFxIC5mYXRhbC1lcnJvcicpLmxlbmd0aClcbiAgICAgICAgICAgICAgICAkKCdmb3JtLmZvcm0tZmFxIC5mYXRhbC1lcnJvcicpLmh0bWwoXCIgXCIpLmhpZGUoKTtcblxuICAgICAgICAgICAgaWYgKCQoJ2Zvcm0uZm9ybS1mYXEgbGFiZWwuZXJyb3IsIGZvcm0uZm9ybS1mYXEgbGFiZWwuaW52YWxpZCcpLmxlbmd0aClcbiAgICAgICAgICAgICAgICAkKCdmb3JtLmZvcm0tZmFxIGxhYmVsLmVycm9yLCBmb3JtLmZvcm0tZmFxIGxhYmVsLmludmFsaWQnKS5yZW1vdmUoKTtcblxuICAgICAgICAgICAgdmFyICRmb3JtID0gJChmb3JtKTtcbiAgICAgICAgICAgIHZhciBfcGFyYW1zID0gcGFyc2VRdWVyeSgkZm9ybS5zZXJpYWxpemVBcnJheSgpKTtcblxuXG4gICAgICAgICAgICB2YXIgX3Jlc3BvbnNlID0gZ2V0QWpheEZvcm0oJy9mYXEuaHRtbCcsIF9wYXJhbXMpO1xuICAgICAgICAgICAgaWYgKF9yZXNwb25zZS5yZXN1bHQpIHtcblxuICAgICAgICAgICAgICAgIHZhciBfcmVzID0gX3Jlc3BvbnNlLnJlc3VsdDtcbiAgICAgICAgICAgICAgICBpZiAoX3Jlcy5lcnJvcikge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgX3Jlcy5lcnJvciA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQuZWFjaChfcmVzLmVycm9yLCBmdW5jdGlvbiAobmFtZSwgdGV4dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfb2JqID0gJGZvcm0uZmluZCgnaW5wdXRbbmFtZT1cIicgKyBuYW1lICsgJ1wiXScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfb2JqLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoX29iai5uZXh0KCdsYWJlbCcpLmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9vYmoubmV4dCgpLmh0bWwodGV4dCkuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCc8bGFiZWwgaWQ9XCInICsgbmFtZSArICctZXJyb3JcIiBmb3I9XCInICsgbmFtZSArICdcIiBjbGFzcz1cImludmFsaWRcIj4nICsgdGV4dCArICc8L2xhYmVsPicpLmluc2VydEFmdGVyKF9vYmopO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgJCgnZm9ybS5mb3JtLWZhcSAuZmF0YWwtZXJyb3InKS5odG1sKF9yZXMuZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgcmVsb2FkQ2FwdGNoYSgkZm9ybS5maW5kKCcuYm94LWNhcHRjaGEgPiBpbWcnKSwgdHJ1ZSk7IC8vIHJlbG9hZCBjYXB0Y2hhXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKF9yZXMuc3VjY2Vzcykge1xuXG4gICAgICAgICAgICAgICAgICAgICQoJ2Zvcm0uZm9ybS1mYXEgc3Bhbi5pbmZvJylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuaHRtbChfcmVzLnN1Y2Nlc3MpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmNzcyh7J2Rpc3BsYXknOiAnaW5saW5lLWJsb2NrJ30pO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIHNjcm9sbFRvIGJsb2NrIGluZm9cbiAgICAgICAgICAgICAgICAgICAgdmFyIHRhcmdldF90b3AgPSAkKCdmb3JtLmZvcm0tZmFxIHNwYW4uaW5mbycpLm9mZnNldCgpLnRvcDtcbiAgICAgICAgICAgICAgICAgICAgJCgnaHRtbCwgYm9keScpLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsVG9wOiBNYXRoLmNlaWwoKHRhcmdldF90b3AgKiAkKHdpbmRvdykub3V0ZXJIZWlnaHQodHJ1ZSkpIC8gJCgnaHRtbCwgYm9keScpLmhlaWdodCgpKVxuICAgICAgICAgICAgICAgICAgICB9LCAnbGluZWFyJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gZ29vZ2xlIGFuYWxpdHljc1xuICAgICAgICAgICAgICAgICAgICBnYSgnc2VuZCcsICdldmVudCcsICdmb3JtJywgJ3N1Ym1pdCcsICdjb250YWN0LXJlcXVlc3Qtc3VjY2VzcycpO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnZm9ybS5mb3JtLWZhcSAuZmF0YWwtZXJyb3InKS5odG1sKCdZb3VyIGVtYWlsIHdhcyBub3Qgc2VudCcpO1xuICAgICAgICAgICAgICAgICAgICByZWxvYWRDYXB0Y2hhKCRmb3JtLmZpbmQoJy5ib3gtY2FwdGNoYSA+IGltZycpLCB0cnVlKTsgLy8gcmVsb2FkIGNhcHRjaGFcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKCdmb3JtLmZvcm0tZmFxIC5mYXRhbC1lcnJvcicpLmh0bWwoJ1lvdXIgZW1haWwgd2FzIG5vdCBzZW50Jyk7XG4gICAgICAgICAgICAgICAgcmVsb2FkQ2FwdGNoYSgkZm9ybS5maW5kKCcuYm94LWNhcHRjaGEgPiBpbWcnKSwgdHJ1ZSk7IC8vIHJlbG9hZCBjYXB0Y2hhXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZWxvYWRDYXB0Y2hhKCRmb3JtLmZpbmQoJy5ib3gtY2FwdGNoYSA+IGltZycpKTsgLy8gcmVsb2FkIGNhcHRjaGFcbiAgICAgICAgICAgICRmb3JtLnRyaWdnZXIoXCJyZXNldFwiKTtcbiAgICAgICAgfVxuICAgIH0pO1xuXG5cbiAgICAvLyB2YWxpZGF0ZSBmb3JtXG4gICAgLy9pZigkKFwiLmJveC1mb3JtXCIpLmxlbmd0aCkge1xuICAgIC8vICAgICQoXCIuYm94LWZvcm1cIikudmFsaWRhdGUoKTtcbiAgICAvLyB9XG4gICAgLyogLS0tLS0tLSBmb3JtIGxvZ2luIC0tLS0tLSAqL1xuICAgIGlmICgkKCdmb3JtW25hbWU9XCJmb3JtLWxvZ2luXCJdJykubGVuZ3RoKSB7XG4gICAgICAgICQoJ2Zvcm1bbmFtZT1cImZvcm0tbG9naW5cIl0nKS52YWxpZGF0ZSh7XG4gICAgICAgICAgICBvbmZvY3Vzb3V0OiBmYWxzZSxcbiAgICAgICAgICAgIG9ua2V5dXA6IGZhbHNlLFxuICAgICAgICAgICAgb25jbGljazogdHJ1ZSxcbiAgICAgICAgICAgIG9uc3VibWl0OiB0cnVlLFxuICAgICAgICAgICAgZm9jdXNJbnZhbGlkOiBmYWxzZSxcbiAgICAgICAgICAgIGZvY3VzQ2xlYW51cDogZmFsc2UsXG4gICAgICAgICAgICBtZXNzYWdlczoge1xuICAgICAgICAgICAgICAgICdwYXNzd29yZCc6IFwiVGhlIFBhc3N3b3JkIGZpZWxkIGlzIGVtcHR5LlwiLFxuICAgICAgICAgICAgICAgICdlbWFpbCc6IHtcbiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFwiVGhlIEVtYWlsIGZpZWxkIGlzIGVtcHR5LlwiLFxuICAgICAgICAgICAgICAgICAgICBlbWFpbDogXCJJbnZhbGlkIGVtYWlsIGZvcm1hdC5cIlxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZXJyb3JDbGFzczogXCJlcnJvclwiLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGludmFsaWRIYW5kbGVyOiBmdW5jdGlvbiAoZXZlbnQsIHZhbGlkYXRvcikge1xuICAgICAgICAgICAgICAgIGlmICgkKCdmb3JtW25hbWU9XCJmb3JtLWxvZ2luXCJdIGxhYmVsLmVycm9yJykubGVuZ3RoKVxuICAgICAgICAgICAgICAgICAgICAkKCdmb3JtW25hbWU9XCJmb3JtLWxvZ2luXCJdIGxhYmVsLmVycm9yJykucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoJCgnZm9ybVtuYW1lPVwiZm9ybS1sb2dpblwiXSBkaXYuYm94LWVycm9yJykpIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnZm9ybVtuYW1lPVwiZm9ybS1sb2dpblwiXSBkaXYuYm94LWVycm9yJykuYWRkQ2xhc3MoJ2hpZGUnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgLy8g0YPQv9GA0LDQstC70LXQvdC40LUg0L7RiNC40LHQutCw0LzQuFxuICAgICAgICAgICAgc2hvd0Vycm9yczogZnVuY3Rpb24gKGVycm9yTWFwLCBlcnJvckxpc3QpIHtcbiAgICAgICAgICAgICAgICB2YXIgX2Zvcm0gPSAkKCdmb3JtW25hbWU9XCJmb3JtLWxvZ2luXCJdJyk7XG4gICAgICAgICAgICAgICAgdmFyIG1zZyA9IG51bGw7XG5cbiAgICAgICAgICAgICAgICAkLmVhY2goZXJyb3JMaXN0LCBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUuZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX2Zvcm0uZmluZCh2YWx1ZS5lbGVtZW50KS5hZnRlcignPGxhYmVsIGNsYXNzPVwiZXJyb3JcIj4nICsgdmFsdWUubWVzc2FnZSArICc8L2xhYmVsPicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgX2Zvcm0uZmluZCh2YWx1ZS5lbGVtZW50KS5uZXh0KCkuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKiAtLS0tLS0tIGZvcm0tcmVnaXN0cmF0aW9uIC0tLS0tLSAqL1xuICAgIGlmICgkKCdmb3JtW25hbWU9XCJmb3JtLXJlZ2lzdHJhdGlvblwiXScpLmxlbmd0aCkge1xuICAgICAgICAkKCdmb3JtW25hbWU9XCJmb3JtLXJlZ2lzdHJhdGlvblwiXScpLnZhbGlkYXRlKHtcbiAgICAgICAgICAgIG9uZm9jdXNvdXQ6IGZhbHNlLFxuICAgICAgICAgICAgb25rZXl1cDogZmFsc2UsXG4gICAgICAgICAgICBvbmNsaWNrOiB0cnVlLFxuICAgICAgICAgICAgb25zdWJtaXQ6IHRydWUsXG4gICAgICAgICAgICBmb2N1c0ludmFsaWQ6IGZhbHNlLFxuICAgICAgICAgICAgZm9jdXNDbGVhbnVwOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2VzOiB7XG4gICAgICAgICAgICAgICAgJ2NhcHRjaGEnOiBcIkludmFsaWQgQ0FQVENIQS5cIiwgLy8gVGhlIENBUFRDSEEgZmllbGQgaXMgZW1wdHkuXG4gICAgICAgICAgICAgICAgJ2VtYWlsJzoge1xuICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogXCJUaGUgRW1haWwgZmllbGQgaXMgZW1wdHkuXCIsXG4gICAgICAgICAgICAgICAgICAgIGVtYWlsOiBcIkludmFsaWQgZW1haWwgZm9ybWF0LlwiXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBlcnJvckNsYXNzOiBcImVycm9yXCIsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaW52YWxpZEhhbmRsZXI6IGZ1bmN0aW9uIChldmVudCwgdmFsaWRhdG9yKSB7XG4gICAgICAgICAgICAgICAgaWYgKCQoJ2Zvcm1bbmFtZT1cImZvcm0tcmVnaXN0cmF0aW9uXCJdIGxhYmVsLmVycm9yJykubGVuZ3RoKVxuICAgICAgICAgICAgICAgICAgICAkKCdmb3JtW25hbWU9XCJmb3JtLXJlZ2lzdHJhdGlvblwiXSBsYWJlbC5lcnJvcicpLnJlbW92ZSgpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCQoJ2Zvcm1bbmFtZT1cImZvcm0tcmVnaXN0cmF0aW9uXCJdIGRpdi5ib3gtZXJyb3InKSkge1xuICAgICAgICAgICAgICAgICAgICAkKCdmb3JtW25hbWU9XCJmb3JtLXJlZ2lzdHJhdGlvblwiXSBkaXYuYm94LWVycm9yJykuYWRkQ2xhc3MoJ2hpZGUnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgLy8g0YPQv9GA0LDQstC70LXQvdC40LUg0L7RiNC40LHQutCw0LzQuFxuICAgICAgICAgICAgc2hvd0Vycm9yczogZnVuY3Rpb24gKGVycm9yTWFwLCBlcnJvckxpc3QpIHtcbiAgICAgICAgICAgICAgICB2YXIgX2Zvcm0gPSAkKCdmb3JtW25hbWU9XCJmb3JtLXJlZ2lzdHJhdGlvblwiXScpO1xuICAgICAgICAgICAgICAgIHZhciBtc2cgPSBudWxsO1xuXG4gICAgICAgICAgICAgICAgJC5lYWNoKGVycm9yTGlzdCwgZnVuY3Rpb24gKGtleSwgdmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9mb3JtLmZpbmQodmFsdWUuZWxlbWVudCkuYWZ0ZXIoJzxsYWJlbCBjbGFzcz1cImVycm9yXCI+JyArIHZhbHVlLm1lc3NhZ2UgKyAnPC9sYWJlbD4nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9mb3JtLmZpbmQodmFsdWUuZWxlbWVudCkubmV4dCgpLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyogLS0tLS0tLSBmb3JtLWZyZWUtdHJpYWwtcmVnaXN0cmF0aW9uIC0tLS0tLSAqL1xuICAgIGlmICgkKCdmb3JtW25hbWU9XCJmcmVlX3RyaWFsX3JlZ2lzdHJhdGlvblwiXScpLmxlbmd0aCkge1xuICAgICAgICAkKCdmb3JtW25hbWU9XCJmcmVlX3RyaWFsX3JlZ2lzdHJhdGlvblwiXScpLnZhbGlkYXRlKHtcbiAgICAgICAgICAgIG9uZm9jdXNvdXQ6IGZhbHNlLFxuICAgICAgICAgICAgb25rZXl1cDogZmFsc2UsXG4gICAgICAgICAgICBvbmNsaWNrOiB0cnVlLFxuICAgICAgICAgICAgb25zdWJtaXQ6IHRydWUsXG4gICAgICAgICAgICBmb2N1c0ludmFsaWQ6IGZhbHNlLFxuICAgICAgICAgICAgZm9jdXNDbGVhbnVwOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2VzOiB7XG4gICAgICAgICAgICAgICAgJ2NhcHRjaGEnOiBcIkludmFsaWQgQ0FQVENIQS5cIiwgLy8gVGhlIENBUFRDSEEgZmllbGQgaXMgZW1wdHkuXG4gICAgICAgICAgICAgICAgJ25hbWUnOiB7XG4gICAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiBcIlRoZSBOYW1lIGZpZWxkIGlzIGVtcHR5LlwiLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgJ2VtYWlsJzoge1xuICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogXCJUaGUgRW1haWwgZmllbGQgaXMgZW1wdHkuXCIsXG4gICAgICAgICAgICAgICAgICAgIGVtYWlsOiBcIkludmFsaWQgZW1haWwgZm9ybWF0LlwiXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBlcnJvckNsYXNzOiBcImVycm9yXCIsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaW52YWxpZEhhbmRsZXI6IGZ1bmN0aW9uIChldmVudCwgdmFsaWRhdG9yKSB7XG4gICAgICAgICAgICAgICAgaWYgKCQoJ2Zvcm1bbmFtZT1cImZyZWVfdHJpYWxfcmVnaXN0cmF0aW9uXCJdICNibG9jay1maWVsZHMgbGFiZWwuZXJyb3InKS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgICAgICQoJ2Zvcm1bbmFtZT1cImZyZWVfdHJpYWxfcmVnaXN0cmF0aW9uXCJdICNibG9jay1maWVsZHMgbGFiZWwuZXJyb3InKS5yZW1vdmUoKTtcblxuICAgICAgICAgICAgICAgIGlmICgkKCdmb3JtW25hbWU9XCJmcmVlX3RyaWFsX3JlZ2lzdHJhdGlvblwiXSBkaXYuYm94LWVycm9yJykpIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnZm9ybVtuYW1lPVwiZnJlZV90cmlhbF9yZWdpc3RyYXRpb25cIl0gZGl2LmJveC1lcnJvcicpLmFkZENsYXNzKCdoaWRlJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vINGD0L/RgNCw0LLQu9C10L3QuNC1INC+0YjQuNCx0LrQsNC80LhcbiAgICAgICAgICAgIHNob3dFcnJvcnM6IGZ1bmN0aW9uIChlcnJvck1hcCwgZXJyb3JMaXN0KSB7XG4gICAgICAgICAgICAgICAgdmFyIGZpbGVkcyA9ICQoJ2Zvcm1bbmFtZT1cImZyZWVfdHJpYWxfcmVnaXN0cmF0aW9uXCJdICNibG9jay1maWVsZHMnKTtcbiAgICAgICAgICAgICAgICB2YXIgbXNnID0gbnVsbDtcblxuICAgICAgICAgICAgICAgICQuZWFjaChlcnJvckxpc3QsIGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGtleSwgdmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUuZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZmlsZWRzLmZpbmQodmFsdWUuZWxlbWVudCkuYWZ0ZXIoJzxsYWJlbCBjbGFzcz1cImVycm9yXCI+JyArIHZhbHVlLm1lc3NhZ2UgKyAnPC9sYWJlbD4nKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qIC0tLS0tLS0gZm9ybS1yZXN0b3JlIC0tLS0tLSAqL1xuICAgIGlmICgkKCdmb3JtW25hbWU9XCJmb3JtLXJlc3RvcmVcIl0nKS5sZW5ndGgpIHtcbiAgICAgICAgJCgnZm9ybVtuYW1lPVwiZm9ybS1yZXN0b3JlXCJdJykudmFsaWRhdGUoe1xuICAgICAgICAgICAgb25mb2N1c291dDogZmFsc2UsXG4gICAgICAgICAgICBvbmtleXVwOiBmYWxzZSxcbiAgICAgICAgICAgIG9uY2xpY2s6IHRydWUsXG4gICAgICAgICAgICBvbnN1Ym1pdDogdHJ1ZSxcbiAgICAgICAgICAgIGZvY3VzSW52YWxpZDogZmFsc2UsXG4gICAgICAgICAgICBmb2N1c0NsZWFudXA6IGZhbHNlLFxuICAgICAgICAgICAgZGVidWc6IGZhbHNlLFxuICAgICAgICAgICAgbWVzc2FnZXM6IHtcbiAgICAgICAgICAgICAgICAnZW1haWwnOiB7XG4gICAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiBcIlRoZSBFbWFpbCBmaWVsZCBpcyBlbXB0eS5cIixcbiAgICAgICAgICAgICAgICAgICAgZW1haWw6IFwiSW52YWxpZCBlbWFpbCBmb3JtYXQuXCJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGVycm9yQ2xhc3M6IFwiZXJyb3JcIixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpbnZhbGlkSGFuZGxlcjogZnVuY3Rpb24gKGV2ZW50LCB2YWxpZGF0b3IpIHtcbiAgICAgICAgICAgICAgICBpZiAoJCgnZm9ybVtuYW1lPVwiZm9ybS1yZXN0b3JlXCJdIGxhYmVsLmVycm9yJykubGVuZ3RoKVxuICAgICAgICAgICAgICAgICAgICAkKCdmb3JtW25hbWU9XCJmb3JtLXJlc3RvcmVcIl0gbGFiZWwuZXJyb3InKS5yZW1vdmUoKTtcblxuICAgICAgICAgICAgICAgIGlmICgkKCdmb3JtW25hbWU9XCJmb3JtLXJlc3RvcmVcIl0gZGl2LmJveC1lcnJvcicpKSB7XG4gICAgICAgICAgICAgICAgICAgICQoJ2Zvcm1bbmFtZT1cImZvcm0tcmVzdG9yZVwiXSBkaXYuYm94LWVycm9yJykuYWRkQ2xhc3MoJ2hpZGUnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgLy8g0YPQv9GA0LDQstC70LXQvdC40LUg0L7RiNC40LHQutCw0LzQuFxuICAgICAgICAgICAgc2hvd0Vycm9yczogZnVuY3Rpb24gKGVycm9yTWFwLCBlcnJvckxpc3QpIHtcbiAgICAgICAgICAgICAgICB2YXIgX2Zvcm0gPSAkKCdmb3JtW25hbWU9XCJmb3JtLXJlc3RvcmVcIl0nKTtcbiAgICAgICAgICAgICAgICB2YXIgbXNnID0gbnVsbDtcblxuICAgICAgICAgICAgICAgICQuZWFjaChlcnJvckxpc3QsIGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5lbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfZm9ybS5maW5kKHZhbHVlLmVsZW1lbnQpLmFmdGVyKCc8bGFiZWwgY2xhc3M9XCJlcnJvclwiPicgKyB2YWx1ZS5tZXNzYWdlICsgJzwvbGFiZWw+Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBfZm9ybS5maW5kKHZhbHVlLmVsZW1lbnQpLm5leHQoKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qIC0tLS0tIGZvcm0gZGlzY291bnQgLS0tLS0gKi9cbiAgICBpZiAoJCgnI2Zvcm0tZGlzY291bnQnKS5sZW5ndGgpIHtcbiAgICAgICAgJCgnI2Zvcm0tZGlzY291bnQnKS52YWxpZGF0ZSh7XG4gICAgICAgICAgICBvbmZvY3Vzb3V0OiBmYWxzZSxcbiAgICAgICAgICAgIG9ua2V5dXA6IGZhbHNlLFxuICAgICAgICAgICAgb25jbGljazogdHJ1ZSxcbiAgICAgICAgICAgIG9uc3VibWl0OiB0cnVlLFxuICAgICAgICAgICAgZm9jdXNJbnZhbGlkOiBmYWxzZSxcbiAgICAgICAgICAgIGZvY3VzQ2xlYW51cDogZmFsc2UsXG4gICAgICAgICAgICBtZXNzYWdlczoge1xuICAgICAgICAgICAgICAgICdjYXB0Y2hhJzogXCJJbnZhbGlkIENBUFRDSEEuXCIsIC8vIFRoZSBDQVBUQ0hBIGZpZWxkIGlzIGVtcHR5LlxuICAgICAgICAgICAgICAgICdkaXNjb3VudFtuYW1lXSc6IFwiVGhlIE5hbWUgZmllbGQgaXMgZW1wdHkuXCIsXG4gICAgICAgICAgICAgICAgJ2Rpc2NvdW50W2VtYWlsXSc6IHtcbiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFwiVGhlIFBhc3N3b3JkIGZpZWxkIGlzIGVtcHR5LlwiLFxuICAgICAgICAgICAgICAgICAgICBlbWFpbDogXCJJbnZhbGlkIGVtYWlsIGZvcm1hdC5cIlxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZXJyb3JDbGFzczogXCJlcnJvclwiLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGludmFsaWRIYW5kbGVyOiBmdW5jdGlvbiAoZXZlbnQsIHZhbGlkYXRvcikge1xuICAgICAgICAgICAgICAgIGlmICgkKCcjZm9ybS1kaXNjb3VudCBsYWJlbC5lcnJvcicpLmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgJCgnI2Zvcm0tZGlzY291bnQgbGFiZWwuZXJyb3InKS5yZW1vdmUoKTtcblxuICAgICAgICAgICAgICAgIGlmICgkKCcjZm9ybS1kaXNjb3VudCBkaXYuYm94LWVycm9yJykpIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnI2Zvcm0tZGlzY291bnQgZGl2LmJveC1lcnJvcicpLmFkZENsYXNzKCdoaWRlJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vINGD0L/RgNCw0LLQu9C10L3QuNC1INC+0YjQuNCx0LrQsNC80LhcbiAgICAgICAgICAgIHNob3dFcnJvcnM6IGZ1bmN0aW9uIChlcnJvck1hcCwgZXJyb3JMaXN0KSB7XG4gICAgICAgICAgICAgICAgdmFyIF9mb3JtID0gJCgnI2Zvcm0tZGlzY291bnQnKTtcbiAgICAgICAgICAgICAgICB2YXIgbXNnID0gbnVsbDtcblxuICAgICAgICAgICAgICAgICQuZWFjaChlcnJvckxpc3QsIGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5lbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfZm9ybS5maW5kKHZhbHVlLmVsZW1lbnQpLmFmdGVyKCc8bGFiZWwgY2xhc3M9XCJlcnJvclwiPicgKyB2YWx1ZS5tZXNzYWdlICsgJzwvbGFiZWw+Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBfZm9ybS5maW5kKHZhbHVlLmVsZW1lbnQpLm5leHQoKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qKlxuICAgICAqIENBUEFDSEFcbiAgICAgKi9cbiAgICBpZiAoJCgnLmJveC1jYXB0Y2hhJykubGVuZ3RoKSB7XG4gICAgICAgICQoJy51cGRhdGUtY2FwdGNoYSwgLmEtdXBkYXRlLWNhcHRjaGEnKS5vbignY2xpY2snLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICByZWxvYWRDYXB0Y2hhKCQodGhpcyksIHRydWUpO1xuLy8gICAgICAgICAgIHZhciBfc3JjID0gJy9jYXB0Y2hhLmh0bWw/JytNYXRoLnJhbmRvbSgpO1xuLy8gICAgICAgICAgIGlmKCQodGhpcykuYXR0cignYXR0ci13aWR0aCcpICYmICQodGhpcykuYXR0cignYXR0ci1oZWlnaHQnKSkge1xuLy8gICAgICAgICAgICAgICBfc3JjID0gJy9jYXB0Y2hhLmh0bWw/d2lkdGg9JyskKHRoaXMpLmF0dHIoJ2F0dHItd2lkdGgnKSsnJmhlaWdodD0nKyQodGhpcykuYXR0cignYXR0ci1oZWlnaHQnKSsnJicrTWF0aC5yYW5kb20oKTtcbi8vICAgICAgICAgICB9XG4vL1xuLy8gICAgICAgICAgICQoJy5ib3gtY2FwdGNoYScpLmZpbmQoJyNpbWctY2FwdGNoYScpLmF0dHIoJ3NyYycsIF9zcmMpO1xuLy8gICAgICAgICAgICQoJ2Zvcm1bbmFtZT1cImZvcm0tcmVnaXN0cmF0aW9uXCJdLCBmb3JtW25hbWU9XCJmcmVlX3RyaWFsX3JlZ2lzdHJhdGlvblwiXScpLmZpbmQoJ2lucHV0W25hbWU9XCJjYXB0Y2hhXCJdJykuZm9jdXMoKTtcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLy9zY3JvbGwgdG8gdGFyZ2V0XG4gICAgZnVuY3Rpb24gc2Nyb2xsVG8oc2VsZWN0b3Isc3BlZWQpIHtcbiAgICAgICAgJCgnaHRtbCxib2R5JykuYW5pbWF0ZSh7c2Nyb2xsVG9wOiAkKHNlbGVjdG9yKS5vZmZzZXQoKS50b3AgLTUwIH0sIHNwZWVkKTtcbiAgICB9XG5cdFxuXHRcdC8vIHN3aXRjaCBmZWF0dXJlcyBpT1NcbiAgICAkKCcuc2hvd19wcmVtaXVtX2ZlYXR1cmVzLl9pY2xvdWQtZicpLm9uKCd0YXAnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIGlmKGUuaGFuZGxlZCAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgJCgnLnByZW1pdW1fZmUuX2ljbG91ZC1mJykuY3NzKFwibWFyZ2luLXRvcFwiLCBcIjEwcHhcIik7XG4gICAgICAgICAgICAkKCcucHJlbWl1bV9mZS5faWNsb3VkLWYnKS5zbGlkZVRvZ2dsZSgpO1xuICAgICAgICAgICAgJCgnLnNob3ctZi5faWNsb3VkLWYnKS50b2dnbGUoKVxuICAgICAgICAgICAgaWYoJCgnLmhpZGUtZi5faWNsb3VkLWYnKS5pcygnOnZpc2libGUnKSkge1xuICAgICAgICAgICAgICAgIHNjcm9sbFRvKCcucHJvZC1pY2xvdWQnLCAnZmFzdCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJCgnLmhpZGUtZi5faWNsb3VkLWYnKS50b2dnbGUoKVxuICAgICAgICAgICAgJCgnLnByb2QtaWNsb3VkLnByb2QtMicpLnRvZ2dsZSgpXG4gICAgICAgICAgICBlLmhhbmRsZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgXG4gICAgLy8gc3dpdGNoIGZlYXR1cmVzIEFuZHJvaWQgYmFzaWNcbiAgICAkKCcuc2hvd19iYXNpY19mZWF0dXJlcy5fYW5kcm9pZC1mJykub24oJ3RhcCcsIGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgaWYoZS5oYW5kbGVkICE9PSB0cnVlKSB7XG4gICAgICAgICAgICAkKCcuYmFzaWNfZmUuX2FuZHJvaWQtZicpLmNzcyhcIm1hcmdpbi10b3BcIiwgXCIxMHB4XCIpO1xuICAgICAgICAgICAgJCgnLmJhc2ljX2ZlLl9hbmRyb2lkLWYnKS5zbGlkZVRvZ2dsZSgpO1xuICAgICAgICAgICAgJCgnLmJhc2ljX3dyIC5zaG93LWYuX2FuZHJvaWQtZicpLnRvZ2dsZSgpXG4gICAgICAgICAgICBpZigkKCcuaGlkZS1mLl9hbmRyb2lkLWYnKS5pcygnOnZpc2libGUnKSkge1xuICAgICAgICAgICAgICAgIHNjcm9sbFRvKCcuYmFzaWNfaCcsICdmYXN0Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAkKCcuYmFzaWNfd3IgLmhpZGUtZi5fYW5kcm9pZC1mJykudG9nZ2xlKCk7XG4gICAgICAgICAgICBlLmhhbmRsZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgLy8gc3dpdGNoIGZlYXR1cmVzIEFuZHJvaWQgcHJlbWl1bVxuICAgICQoJy5zaG93X3ByZW1pdW1fZmVhdHVyZXMuX2FuZHJvaWQtZicpLm9uKCd0YXAnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIGlmKGUuaGFuZGxlZCAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgJCgnLnByZW1pdW1fZmUuX2FuZHJvaWQtZicpLmNzcyhcIm1hcmdpbi10b3BcIiwgXCIxMHB4XCIpO1xuICAgICAgICAgICAgJCgnLnByZW1pdW1fZmUuX2FuZHJvaWQtZicpLnNsaWRlVG9nZ2xlKCk7XG4gICAgICAgICAgICAkKCcucHJlbWl1bV93ciAuc2hvdy1mLl9hbmRyb2lkLWYnKS50b2dnbGUoKVxuICAgICAgICAgICAgaWYoJCgnLmhpZGUtZi5fYW5kcm9pZC1mJykuaXMoJzp2aXNpYmxlJykpIHtcbiAgICAgICAgICAgICAgICBzY3JvbGxUbygnI3ByZW0taGVhZGVyJywgJ2Zhc3QnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICQoJy5wcmVtaXVtX3dyIC5oaWRlLWYuX2FuZHJvaWQtZicpLnRvZ2dsZSgpO1xuICAgICAgICAgICAgZS5oYW5kbGVkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIFxuXHRcdC8vIHN3aXRjaCBmZWF0dXJlcyBKYWlsYnJlYWtcbiAgICAkKCcuc2hvd19wcmVtaXVtX2ZlYXR1cmVzLl9qYWlsYnJlYWstZicpLm9uKCd0YXAnLCBmdW5jdGlvbihlKSB7XG4gICAgICAgIGlmKGUuaGFuZGxlZCAhPT0gdHJ1ZSkge1xuICAgICAgICAgICAgJCgnLnByZW1pdW1fZmUuX2phaWxicmVhay1mJykuY3NzKFwibWFyZ2luLXRvcFwiLCBcIjEwcHhcIik7XG4gICAgICAgICAgICAkKCcucHJlbWl1bV9mZS5famFpbGJyZWFrLWYnKS5zbGlkZVRvZ2dsZSgpO1xuICAgICAgICAgICAgJCgnLnNob3ctZi5famFpbGJyZWFrLWYnKS50b2dnbGUoKVxuICAgICAgICAgICAgaWYoJCgnLmhpZGUtZi5famFpbGJyZWFrLWYnKS5pcygnOnZpc2libGUnKSkge1xuICAgICAgICAgICAgICAgIHNjcm9sbFRvKCdkaXZbZGF0YS1pbmZvLWJsb2NrPWlvcy1qYl0nLCAnZmFzdCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgJCgnLmhpZGUtZi5famFpbGJyZWFrLWYnKS50b2dnbGUoKVxuICAgICAgICAgICAgJCgnLnByb2QtaWNsb3VkLnByb2QtMi5qYWlsYnJlYWstZicpLnRvZ2dsZSgpXG4gICAgICAgICAgICBlLmhhbmRsZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgJChcImlucHV0W25hbWU9J29wdGlvbnNSYWRpb3MnXVwiKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgaWYgKHRoaXMuZ2V0QXR0cmlidXRlKFwiY2hlY2tlZFwiKSkge1xuXG4gICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgnLmxhYmVsX3JhZGlvJykuYWRkQ2xhc3MoJ3Jfb24nKTtcbiAgICAgICAgICAgICQodGhpcykucGFyZW50KCcubGFiZWxfcmFkaW8nKS5yZW1vdmVDbGFzcygncl9vZmYnKTtcbiAgICAgICAgICAgICQodGhpcykucGFyZW50cygnZm9ybScpLmNoaWxkcmVuKCcucHJvZHVjdF9wcmljZScpLnZhbCgkKHRoaXMpLnZhbCgpKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIFxuICAgIC8qJChcImlucHV0W25hbWU9J29wdGlvbnNSYWRpb3MnXVwiKS5maWx0ZXIoJzpjaGVja2VkJykuZWFjaChmdW5jdGlvbigpe1xuXG4gICAgIHZhciBjdXJyICA9ICQodGhpcyk7XG5cblxuXG4gICAgIGN1cnIucGFyZW50KCcubGFiZWxfcmFkaW8nKS5yZW1vdmVDbGFzcygncl9vZmYnKTtcbiAgICAgY3Vyci5wYXJlbnQoJy5sYWJlbF9yYWRpbycpLmFkZENsYXNzKCdyX29uJyk7XG5cbiAgICAgY3Vyci5wYXJlbnRzKCdmb3JtJykuY2hpbGRyZW4oJy5wcm9kdWN0X3ByaWNlJykudmFsKGN1cnIudmFsKCkpO1xuXG4gICAgIH0pOyAgICovXG4gICAgLyogaGFzaGNoYW5nZV9BZnRlckluaXQgKi9cblxuICAgIGhhc2hjaGFuZ2VfQWZ0ZXJJbml0KCk7XG5cbiAgICAvKiBmaXggZmVhdHVyZXMgZGVzaW5lIGNocm9tZSAqL1xuICAgIGlmICgkKCcjdmliZXItd2hhdHNhcHAtc2t5cGUnKS5sZW5ndGgpIHtcbiAgICAgICAgaWYgKCQuYnJvd3Nlci53ZWJraXQpIHtcbiAgICAgICAgICAgICQoJyN2aWJlci13aGF0c2FwcC1za3lwZScpLnJlbW92ZUNsYXNzKCd3MzBwJykuYWRkQ2xhc3MoJ3cxNnAnKTtcbiAgICAgICAgICAgIC8vIGFsZXJ0KCBcIlRoaXMgaXMgV2ViS2l0IVwiICk7XG4gICAgICAgIH0gZWxzZVxuICAgICAgICAgICAgJCgnI3ZpYmVyLXdoYXRzYXBwLXNreXBlJykucmVtb3ZlQ2xhc3MoJ3cxNnAnKS5hZGRDbGFzcygndzMwcCcpO1xuICAgIH1cblxuLy8gZ2EgY2xpY2tcbi8vIGZhcVxuICAgICQoJ2Zvcm1bbmFtZT1cImZvcm0tZmFxXCJdIGJ1dHRvbi5ldmVudC1zdWJtaXQnKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIGdhKCdzZW5kJywgJ2V2ZW50JywgJ2Zvcm0nLCAnc3VibWl0JywgJ2ZhcS1yZXF1ZXN0Jyk7XG4gICAgfSk7XG5cbi8vIGxvZ2luXG4gICAgJCgnZm9ybVtuYW1lPVwiZm9ybS1sb2dpblwiXSAuYnV0dG9uLXN1bWJpdCBidXR0b24nKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIGdhKCdzZW5kJywgJ2V2ZW50JywgJ2Zvcm0nLCAnc3VibWl0JywgJ2xvZ2luJyk7XG4gICAgfSk7XG5cbi8vIHJlc3RvcmVcbiAgICAkKCdmb3JtW25hbWU9XCJmb3JtLXJlc3RvcmVcIl0gLmJ1dHRvbi1zdW1iaXQgYnV0dG9uJykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICBnYSgnc2VuZCcsICdldmVudCcsICdmb3JtJywgJ3N1Ym1pdCcsICdyZXN0b3JlJyk7XG4gICAgfSk7XG5cbi8vIHJlZ2lzdHJhdGlvblxuICAgICQoJ2Zvcm1bbmFtZT1cImZvcm0tcmVnaXN0cmF0aW9uXCJdIC5idXR0b24tc3VtYml0IGJ1dHRvbicpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZ2EoJ3NlbmQnLCAnZXZlbnQnLCAnZm9ybScsICdzdWJtaXQnLCAncmVnaXN0cmF0aW9uJyk7XG4gICAgfSk7XG5cbi8vIGNvbnRhY3QtdXNcbiAgICAkKCdmb3JtW25hbWU9XCJzZW5kLW1haWwtY29udGFjdC11c1wiXSBidXR0b24uZXZlbnQtc3VibWl0JykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICBnYSgnc2VuZCcsICdldmVudCcsICdmb3JtJywgJ3N1Ym1pdCcsICdjb250YWN0LXJlcXVlc3QnKTtcbiAgICB9KTtcblxuLy8gY29tcGF0aWJpbGl0eVxuICAgICQoJ2Zvcm1bbmFtZT1cInNlbmRfZmluZF9waG9uZVwiXSBidXR0b24uZXZlbnQtc3VibWl0JykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICBnYSgnc2VuZCcsICdldmVudCcsICdmb3JtJywgJ3N1Ym1pdCcsICdjb21wYXRpYmlsaXR5LXJlcXVlc3QnKTtcbiAgICB9KTtcblxuXG5cbiAgICAvLyBzY3JvbGwgKGZseS1ib3gpXG4gICAgaWYgKCQoJy5mbHktYm94JykubGVuZ3RoKSB7XG4gICAgICAgICQoJy5mbHktYm94Jykuc2Nyb2xsUHVtcGljKHtcbiAgICAgICAgICAgICdzdGFydCc6IDEwMDAsXG4gICAgICAgICAgICAnc3RvcCc6IDAsXG4gICAgICAgICAgICAnYW5pbWF0ZSc6IHtcbiAgICAgICAgICAgICAgICAndHlwZSc6ICd2aXNpYmxlJywgLy8gZmFkZSwgdmlzaWJsZSwgYmxpbmtpbmdcbiAgICAgICAgICAgICAgICAndGltZVNob3cnOiA1MCxcbiAgICAgICAgICAgICAgICAndGltZUhpZGUnOiA1MFxuICAgICAgICAgICAgfVxuICAgICAgICB9KTsgLy9cImNvZWZmXCI6MS4xNVxuICAgIH1cblxuICAgIC8vIGZseSBibG9ja1xuICAgIGlmICgkKCcuZmx5LWJveC1idXR0b25zJykubGVuZ3RoKSB7XG4gICAgICAgICQod2luZG93KS5vbignbG9hZCByZXNpemUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgJG9mZmNldFRvcCA9IE1hdGgucm91bmQoJCgnLmZseS1wb3NpdGlvbicpLm9mZnNldCgpLnRvcCk7XG4gICAgICAgICAgICBpZiAodHlwZW9mICQuZGF0YShkb2N1bWVudCwgJ19zY3JvbGxCdXR0b25zXycgKyAkKHRoaXMpLndpZHRoKCkpID09IFwidW5kZWZpbmVkXCJcbiAgICAgICAgICAgICAgICAgICAgfHwgJC5kYXRhKGRvY3VtZW50LCAnX3Njcm9sbEJ1dHRvbnNfJyArICQodGhpcykud2lkdGgoKSkgIT0gJG9mZmNldFRvcCkge1xuICAgICAgICAgICAgICAgICQuZGF0YShkb2N1bWVudCwgJ19zY3JvbGxCdXR0b25zXycgKyAkKHRoaXMpLndpZHRoKCksICRvZmZjZXRUb3ApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyggJG9mZmNldFRvcCwgJC5kYXRhKGRvY3VtZW50LCAnX3Njcm9sbEJ1dHRvbnNfJyskKHRoaXMpLndpZHRoKCkpICk7XG5cbiAgICAgICAgICAgIGlmICgkLmRhdGEoZG9jdW1lbnQsICdfc2Nyb2xsQnV0dG9uc18nICsgJCh0aGlzKS53aWR0aCgpKSkge1xuICAgICAgICAgICAgICAgICQoJy5mbHktYm94LWJ1dHRvbnMnKS5zY3JvbGxQdW1waWMoe1xuICAgICAgICAgICAgICAgICAgICAnX29iakZseSc6ICcuYmxvY2stZmx5JyxcbiAgICAgICAgICAgICAgICAgICAgJ3N0YXJ0JzogJC5kYXRhKGRvY3VtZW50LCAnX3Njcm9sbEJ1dHRvbnNfJyArICQodGhpcykud2lkdGgoKSksXG4gICAgICAgICAgICAgICAgICAgICdzdG9wJzogMCxcbiAgICAgICAgICAgICAgICAgICAgJ3JpZ2h0JzogMzAwLFxuICAgICAgICAgICAgICAgICAgICAnX3NldHRpbmdzJzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ19yZXNwb25jZSc6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ192YWxpZGF0ZSc6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICdhbmltYXRlJzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ3R5cGUnOiAnYmxpbmtpbmcnLCAvLyBmYWRlLCB2aXNpYmxlLCBibGlua2luZ1xuICAgICAgICAgICAgICAgICAgICAgICAgJ3RpbWVTaG93JzogMzAsXG4gICAgICAgICAgICAgICAgICAgICAgICAndGltZUhpZGUnOiA1MFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7IC8vXCJjb2VmZlwiOjEuMTVcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyB0YWJzIGNvbXBhdGliaWxpdHlcbiAgICAkKCcjdGVtcC0xIC5iYy10YWJzIC5pdGVtLXRhYiBhLCAjdGVtcC0xIC5iYy10YWJzIC5pdGVtLXRhYiBzcGFuLCAjdGVtcC0yID4gdWwgPiBsaSA+IGEsICN0ZW1wLTIgPiB1bCA+IGxpID4gc3BhbicpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gY2xlYXIgYWxsIGFjdGl2ZVxuICAgICAgICB2YXIgX2l0YWIgPSAkKHRoaXMpLnBhcmVudCgpLFxuICAgICAgICAgICAgICAgIF90aGlzID0gJCh0aGlzKSxcbiAgICAgICAgICAgICAgICBfZGF0YV9jYXRfaWQgPSBfaXRhYi5hdHRyKCdkYXRhLWNhdC1pZCcpO1xuICAgICAgICAkLmVhY2goJCgnI3RlbXAtMSAuYmMtdGFicyAuaXRlbS10YWIsICN0ZW1wLTIgPiB1bCA+IGxpLCAjdGVtcC0xICN0YWItY29udGVudCA+IGRpdicpLCBmdW5jdGlvbiAoa2V5LCB2YWwpIHtcbiAgICAgICAgICAgIGlmICgkKHZhbCkuaGFzQ2xhc3MoJ2FjdGl2ZScpKVxuICAgICAgICAgICAgICAgICQodmFsKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghX2l0YWIuaGFzQ2xhc3MoJ2FjdGl2ZScpKSB7XG4gICAgICAgICAgICAkKCcjdGVtcC0xIC5iYy10YWJzIHNlY3Rpb24gPiBkaXZbZGF0YS1jYXQtaWQ9XCInICsgX2RhdGFfY2F0X2lkICsgJ1wiXSwgI3RlbXAtMiA+IHVsID4gbGlbZGF0YS1jYXQtaWQ9XCInICsgX2RhdGFfY2F0X2lkICsgJ1wiXScpLmFkZENsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgICAgICQoJyN0ZW1wLTEgI3RhYi1jb250ZW50ID4gZGl2W2RhdGEtY2F0LWlkPVwiJyArIF9kYXRhX2NhdF9pZCArICdcIl0nKS5hZGRDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBjbGVhciBhbGwgaXRlbXNcbi8vICAgICAgICAgICAgJC5lYWNoKCQoJyN0ZW1wLTIgPiB1bCA+IGxpIHVsJyksIGZ1bmN0aW9uKGtleSwgdmFsdWUpIHtcbi8vICAgICAgICAgICAgICAgICQodmFsdWUpLnNsaWRlVXAoKTtcbi8vICAgICAgICAgICAgfSk7XG5cbi8vICAgICAgaWYoJCgnI3RlbXAtMiA+IHVsID4gbGkgdWwnKS5pcygnOnZpc2libGUnKSkge1xuLy8gICAgICAgICAgJCgnI3RlbXAtMiA+IHVsID4gbGkgdWwnKS5zbGlkZVVwKCdzbG93Jyk7XG4vLyAgICAgIH1cblxuICAgICAgICBpZiAoX2l0YWIuY2hpbGRyZW4oJ3VsJykuaXMoJzpub3QodmlzaWJsZSknKSkge1xuICAgICAgICAgICAgX2l0YWIuY2hpbGRyZW4oJ3VsJykuc2xpZGVEb3duKCdzbG93JywgZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgJC5lYWNoKCQoJyN0ZW1wLTIgPiB1bCA+IGxpJykubm90KCc6ZXEoJyArICQodGhpcykucGFyZW50KCkuaW5kZXgoKSArICcpJykuY2hpbGRyZW4oJ3VsJyksIGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICQodmFsdWUpLnNsaWRlVXAoKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vIHNjcm9sbCB0byBhY3RpdmVcbiAgICAgICAgICAgICAgICAkKCdodG1sLCBib2R5Jykuc3RvcCgpLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICBzY3JvbGxUb3A6IF90aGlzLm9mZnNldCgpLnRvcFxuICAgICAgICAgICAgICAgIH0sIDEwMDApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuXG5cbiAgICB9KTtcblxuXG4gICAgLy8gbW9iaWxlIG9wZXJhdG9yc1xuICAgIGlmICgkKCcudG9nZ2xlLW1vYmlsZS1vcGVyYXRvcnMnKS5sZW5ndGgpIHtcbiAgICAgICAgJCgnLnRvZ2dsZS1tb2JpbGUtb3BlcmF0b3JzJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgJC5lYWNoKCQoJyNtb2JpbGUtb3BlcmF0b3JzIC5pdGVtLW9wZXJhdG9ycycpLCBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIGlmICgkKHZhbHVlKS5oYXNDbGFzcygnaGlkZScpKSB7XG4gICAgICAgICAgICAgICAgICAgICQodmFsdWUpLnJlbW92ZUNsYXNzKCdoaWRlJykuYWRkQ2xhc3MoJ3Nob3cnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICQodGhpcykucGFyZW50KCkuaGlkZSgpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9KTtcbiAgICB9XG5cblxuXG4gICAgLy8gaG92ZXJzXG4gICAgJCgnLmJveC12aWRlby1jb25zdHJ1Y3RvcnMgLmJsb2NrLXZpZGVvLWJ1dHRvbiA+IC5ib3gtaG92ZXInKS5ob3ZlcihcbiAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyggJHJzX3dpZHRoICk7XG4gICAgICAgICAgICAgICAgaWYgKCRyc193aWR0aCA+IDk5MikgLy8gISRyc193aWR0aCB8fFxuICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmZpbmQoJy5ob3Zlci12aWRlby1idXR0b25zJykuc2hvdygpO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoJHJzX3dpZHRoID4gOTkyKSAvLyAhJHJzX3dpZHRoIHx8XG4gICAgICAgICAgICAkKHRoaXMpLmZpbmQoJy5ob3Zlci12aWRlby1idXR0b25zJykuaGlkZSgpO1xuICAgIH1cbiAgICApO1xuXG5cbiAgICAvLyBib290c3RyYXAgY2xpYyBwb3BVcFxuICAgIGlmICgkKFwiLnlvdXR1YmVcIikubGVuZ3RoKSB7XG4gICAgICAgICQoXCIueW91dHViZVwiKS5Zb3VUdWJlTW9kYWwoe1xuICAgICAgICAgICAgYXV0b3BsYXk6IDEsXG4gICAgICAgICAgICBhdXRvaGlkZTogMSxcbiAgICAgICAgICAgIHdpZHRoOiA4MjAsXG4gICAgICAgICAgICBoZWlnaHQ6IDUyMCxcbiAgICAgICAgICAgIHRoZW1lOiAnZGFyY2snXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIHN0aWNreVxuICAgIGlmICgkKCcuc3RpY2t5JykubGVuZ3RoKSB7XG5cbiAgICAgICAgJCh3aW5kb3cpLm9uKCdzY3JvbGwnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgd2luZG93VG9wID0gJCh3aW5kb3cpLnNjcm9sbFRvcCgpO1xuICAgICAgICAgICAgaWYgKHdpbmRvd1RvcCA+IDY4KSB7XG4gICAgICAgICAgICAgICAgJCgnLnN0aWNreScpLmFkZENsYXNzKCdmaXhlZCcpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKCcuc3RpY2t5JykucmVtb3ZlQ2xhc3MoJ2ZpeGVkJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG5cbi8vICAgICAgICB2YXIgc3RpY2t5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnN0aWNreScpO1xuLy8gICAgICAgIHZhciBvcmlnT2Zmc2V0WSA9ICghc3RpY2t5Lm9mZnNldFRvcCkgPyA2OCA6IHN0aWNreS5vZmZzZXRUb3A7XG4vL1xuLy8gICAgICAgIGZ1bmN0aW9uIG9uU2Nyb2xsKGUpIHtcbi8vICAgICAgICAgICAgd2luZG93LnNjcm9sbFkgPj0gb3JpZ09mZnNldFkgPyBzdGlja3kuY2xhc3NMaXN0LmFkZCgnZml4ZWQnKSA6XG4vLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0aWNreS5jbGFzc0xpc3QucmVtb3ZlKCdmaXhlZCcpO1xuLy9cbi8vICAgICAgICAgICAgY29uc29sZS5sb2cod2luZG93LnNjcm9sbFkrJyA9ICcrIG9yaWdPZmZzZXRZKTtcbi8vICAgICAgICB9XG4vL1xuLy8gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIG9uU2Nyb2xsKTtcbiAgICB9XG4gICAgLyokKFwiLmJsb2Nrcy1zdGlja3lcIikuYXV0b2ZpeF9hbnl0aGluZyh7XG4gICAgIGN1c3RvbU9mZnNldDogZmFsc2UsIC8vIFlvdSBjYW4gZGVmaW5lIGN1c3RvbSBvZmZzZXQgZm9yIHdoZW4geW91IHdhbnQgdGhlIGNvbnRhaW5lciB0byBiZSBmaXhlZC4gVGhpcyBvcHRpb24gdGFrZXMgdGhlIG51bWJlciBvZiBwaXhlbHMgZnJvbSB0aGUgdG9wIG9mIHRoZSBwYWdlLiBUaGUgZGVmYXVsdCB2YWx1ZSBpcyBmYWxzZSB3aGljaCB0aGUgcGx1Z2luIHdpbGwgYXV0b21hdGljYWxseSBmaXggdGhlIGNvbnRhaW5lciB3aGVuIHRoZSBpdCBpcyBpbiB0aGUgdmlld3BvcnRcbiAgICAgbWFudWFsOiBmYWxzZSwgLy8gVG9nZ2xlIHRoaXMgdG8gdHJ1ZSBpZiB5b3Ugd2lzaCB0byBtYW51YWxseSBmaXggY29udGFpbmVycyB3aXRoIHRoZSBwdWJsaWMgbWV0aG9kLiBEZWZhdWx0IHZhbHVlIGlzIGZhbHNlXG4gICAgIG9ubHlJbkNvbnRhaW5lcjogdHJ1ZSAvLyBTZXQgdGhpcyB0byBmYWxzZSBpZiB5b3UgZG9uJ3Qgd2FudCB0aGUgZml4ZWQgY29udGFpbmVyIHRvIGxpbWl0IGl0c2VsZiB0byB0aGUgcGFyZW50J3MgY29udGFpbmVyLlxuICAgICB9KTtcbiAgICAgKi9cblxuICAgIC8qXG4gICAgIGlmKCQoXCIucGhvbmUtc3RpY2t5XCIpLmxlbmd0aCkge1xuXG4gICAgIGlmKCQoXCIucGhvbmUtc3RpY2t5XCIpLmlzKCc6dmlzaWJsZScpKSB7XG5cbiAgICAgJCh3aW5kb3cpLm9uKCdzY3JvbGwnLCBmdW5jdGlvbigpIHtcbiAgICAgdmFyIHdpbmRvd1RvcCA9ICQod2luZG93KS5zY3JvbGxUb3AoKTtcbiAgICAgaWYod2luZG93VG9wID4gNjgpIHtcbiAgICAgJChcIi5waG9uZS1zdGlja3lcIikuY3NzKHsncG9zaXRpb24nOiAnZml4ZWQnfSk7XG4gICAgIH0gZWxzZSB7XG4gICAgICQoXCIucGhvbmUtc3RpY2t5XCIpLmNzcyh7J3Bvc2l0aW9uJzogJ3N0YXRpYyd9KTtcbiAgICAgfVxuICAgICB9KTtcblxuICAgICB9XG5cbiAgICAgfVxuICAgICAqL1xuXG4gICAgLypcbiAgICAgJCgnYSNvcGVuQnRuVmlkZW8nKS5jbGljayhmdW5jdGlvbihlKXtcbiAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICB2YXIgc3JjID0gJCh0aGlzKS5hdHRyKCdkYXRhLXNyYycpO1xuICAgICB2YXIgaGVpZ2h0ID0gJCh0aGlzKS5hdHRyKCdkYXRhLWhlaWdodCcpIHx8IDUyMDtcbiAgICAgdmFyIHdpZHRoID0gJCh0aGlzKS5hdHRyKCdkYXRhLXdpZHRoJykgfHwgODIwO1xuXG4gICAgIHZhciBwX3cgPSBwYXJzZUludCggd2lkdGggKSArIDE1O1xuICAgICB2YXIgcF9oID0gcGFyc2VJbnQoIGhlaWdodCApICsgMjU7XG5cbiAgICAgLy8gJChcIiNteU1vZGFsIC5tb2RhbC1kaWFsb2dcIikuY3NzKHsnbWF4LXdpZHRoJzogcF93KydweCd9KTsgLy8gJ2hlaWdodCc6IHBfaCsncHgnXG4gICAgICQoXCIjbXlNb2RhbCAubW9kYWwtYm9keVwiKS5jc3MoeydtYXgtd2lkdGgnOiB3aWR0aCsncHgnLCAnaGVpZ2h0JzogaGVpZ2h0KydweCd9KTtcblxuICAgICAkKFwiI215TW9kYWwgaWZyYW1lXCIpLmF0dHIoeyAnaGVpZ2h0JzogaGVpZ2h0LFxuICAgICAnd2lkdGgnOiB3aWR0aH0pO1xuXG4gICAgICQoJyNteU1vZGFsJykub24oJ3Nob3duLmJzLm1vZGFsJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgJChcIiNteU1vZGFsIGlmcmFtZVwiKS5hdHRyKHsnc3JjJzpzcmN9KTtcbiAgICAgfSk7XG5cbiAgICAgJCgnI215TW9kYWwnKS5vbignaGlkZGVuLmJzLm1vZGFsJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgJChcIiNteU1vZGFsIGlmcmFtZVwiKS5hdHRyKHsnc3JjJzogJyMnfSk7XG4gICAgIH0pO1xuXG4gICAgICQoJyNteU1vZGFsJykubW9kYWwoe3Nob3c6dHJ1ZX0pO1xuICAgICByZXR1cm4gZmFsc2U7XG4gICAgIH0pO1xuXG4gICAgICQoJyNteU1vZGFsJykub24oJ3Nob3duLmJzLm1vZGFsJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgfSk7XG4gICAgICQoJyNteU1vZGFsJykub24oJ2hpZGRlbi5icy5tb2RhbCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgIH0pO1xuICAgICAqL1xuXG5cbi8vICAgICQoJ2Ejb3BlbkJ0blZpZGVvJykub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuLy8gICAgICAgIHZhciBzcmMgPSAkKHRoaXMpLmF0dHIoJ2RhdGEtc3JjJyk7XG4vLyAgICAgICAgdmFyIGhlaWdodCA9ICQodGhpcykuYXR0cignZGF0YS1oZWlnaHQnKSB8fCA1MjA7XG4vLyAgICAgICAgdmFyIHdpZHRoID0gJCh0aGlzKS5hdHRyKCdkYXRhLXdpZHRoJykgfHwgODIwO1xuLy9cbi8vICAgICAgICB2YXIgcF93ID0gcGFyc2VJbnQoIHdpZHRoICkgKyAxNTtcbi8vICAgICAgICB2YXIgcF9oID0gcGFyc2VJbnQoIGhlaWdodCApICsgMjU7XG4vL1xuLy8gICAgICAgICQoXCIjbXlNb2RhbCAubW9kYWwtZGlhbG9nXCIpLmNzcyh7J3dpZHRoJzogcF93KydweCcsICdoZWlnaHQnOiBwX2grJ3B4J30pO1xuLy8gICAgICAgICQoXCIjbXlNb2RhbCAubW9kYWwtYm9keVwiKS5jc3Moeyd3aWR0aCc6IHdpZHRoKydweCcsICdoZWlnaHQnOiBoZWlnaHQrJ3B4J30pO1xuLy8gICAgICAgICQoXCIjbXlNb2RhbCBpZnJhbWVcIikuYXR0cih7J3NyYyc6c3JjLFxuLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2hlaWdodCc6IGhlaWdodCxcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd3aWR0aCc6IHdpZHRofSk7XG4vLyAgICB9KTtcblxuXG5cbi8vICAgICQod2luZG93KS5vbignbG9hZCByZXNpemUnLCBmdW5jdGlvbigpIHtcbi8vICAgICAgICAgY29uc29sZS5sb2coJCh0aGlzKS53aWR0aCgpKTtcbi8vICAgIH0pO1xuXG5cbiAgICAvLyBjb3VudHJpZXNcbiAgICAkKFwiI2MtZmVhdHVyZXMgLnJvdy1saXN0ID4gbGksIC5iLWhvdy1pdC13b3JrIGgzLndlaWdodC1ub3JtYWwsICNibG9jay1jb21wYXRpYmlsaXR5LXRhYmxlIC50YWJsZS1ib2R5ID4gZGl2ID4gcFwiKS5tYXRjaEhlaWdodCgpO1xuXG4gICAgaWYgKCQoJy5tYXRjaC1oZWlnaHQnKS5sZW5ndGgpXG4gICAgICAgICQoJy5tYXRjaC1oZWlnaHQnKS5tYXRjaEhlaWdodCgpO1xuXG4vLyAgICBpZigkKCcjYi1yZWNvbW1lbmRlZC1ieSAubWFpbi1ibG9jayA+IC5iLWl0ZW0nKS5sZW5ndGgpXG4vLyAgICAgICAgJCgnI2ItcmVjb21tZW5kZWQtYnkgLm1haW4tYmxvY2sgPiAuYi1pdGVtJykubWF0Y2hIZWlnaHQoKTtcblxuICAgICQuZm4ubWF0Y2hIZWlnaHQuX2JlZm9yZVVwZGF0ZSA9IGZ1bmN0aW9uIChldmVudCwgZ3JvdXBzKSB7XG5cbiAgICAgICAgLy8gZG8gc29tZXRoaW5nIGJlZm9yZSBhbnkgdXBkYXRlcyBhcmUgYXBwbGllZFxuICAgIH1cblxuICAgICQuZm4ubWF0Y2hIZWlnaHQuX2FmdGVyVXBkYXRlID0gZnVuY3Rpb24gKGV2ZW50LCBncm91cHMpIHtcbiAgICAgICAgLypcbiAgICAgICAgIGlmKCQoJyNiLXJlY29tbWVuZGVkLWJ5IC5tYWluLWJsb2NrID4gLmItaXRlbScpLmxlbmd0aClcbiAgICAgICAgICQoJyNiLXJlY29tbWVuZGVkLWJ5IC5tYWluLWJsb2NrID4gLmItaXRlbScpLmZpbmQoJ2xhYmxlLnRpdGxlJykuY3NzKHsnbGluZS1oZWlnaHQnOiAkKCcjYi1yZWNvbW1lbmRlZC1ieSAubWFpbi1ibG9jayA+IC5iLWl0ZW0nKS5oZWlnaHQoKSsncHgnfSk7XG4gICAgICAgICAqL1xuICAgICAgICAvLyBkbyBzb21ldGhpbmcgYWZ0ZXIgYWxsIHVwZGF0ZXMgYXJlIGFwcGxpZWRcbiAgICB9XG5cbiAgICBpZiAoJCgnLmJveF9jYXRlZ29yeSAubWludXMsIC5ib3hfY2F0ZWdvcnkgLnBsdXMnKS5sZW5ndGgpIHtcbiAgICAgICAgJCgnLmJveF9jYXRlZ29yeSAubWludXMsIC5ib3hfY2F0ZWdvcnkgLnBsdXMnKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgnZGl2JykuZmluZCgnLmNvbGxhcHNlJykuY29sbGFwc2UoJ3RvZ2dsZScpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAkKCcuY29sbGFwc2UnKS5vbignc2hvd24uYnMuY29sbGFwc2UnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICBjb25zb2xlLmxvZygnU2hvdycpO1xuICAgICAgICBpZiAoJCh0aGlzKS5wYXJlbnQoJ2RpdicpLmZpbmQoJ2kucGx1cycpKSB7XG4gICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgnZGl2JykuZmluZCgnaS5wbHVzJykucmVtb3ZlQ2xhc3MoJ3BsdXMnKS5hZGRDbGFzcygnbWludXMnKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgICQoJy5jb2xsYXBzZScpLm9uKCdoaWRkZW4uYnMuY29sbGFwc2UnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICBpZiAoJCh0aGlzKS5wYXJlbnQoJ2RpdicpLmZpbmQoJ2kubWludXMnKSkge1xuICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoJ2RpdicpLmZpbmQoJ2kubWludXMnKS5yZW1vdmVDbGFzcygnbWludXMnKS5hZGRDbGFzcygncGx1cycpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbi8vICAgICQoZG9jdW1lbnQpLm9uKCdjbGljay5icy5jb2xsYXBzZS5kYXRhLWFwaScsICdbZGF0YS10b2dnbGU9XCJjb2xsYXBzZVwiXScsIGZ1bmN0aW9uKGUpIHtcbi8vICAgICAgIHZhciBfY2xhc3MgPSAkKHRoaXMpLnBhcmVudCgpLmF0dHIoJ2NsYXNzJyk7XG4vLyAgICAgICBpZihfY2xhc3MgPT0gJ3BsdXMnKSB7XG4vLyAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoJ2Rpdi5wbHVzJykuYXR0cignY2xhc3MnLCAnbWludXMnKTsgLy8gcmVtb3ZlQ2xhc3MoJ3BsdXMnKS5hZGRDbGFzcygnbWludXMnKTtcbi8vICAgICAgIH0gZWxzZSBpZihfY2xhc3MgPT0gJ21pbnVzJykge1xuLy8gICAgICAgICAgICQodGhpcykucGFyZW50KCdkaXYubWludXMnKS5hdHRyKCdjbGFzcycsICdwbHVzJyk7IC8vLnJlbW92ZUNsYXNzKCdtaW51cycpLmFkZENsYXNzKCdwbHVzJyk7XG4vLyAgICAgICB9XG4vL1xuLy8gICAgfSk7XG5cbiAgICBpZiAoJCgnLmJsb2NrLWNoaWxkLWxvY2F0aW9uLXRyYWNraW5nIC5mZWF0dXJlJykubGVuZ3RoKSB7XG4gICAgICAgICQod2luZG93KS5vbihcImxvYWQgcmVzaXplIG9yaWVudGF0aW9uY2hhbmdlXCIsIGZ1bmN0aW9uIChhKSB7XG4gICAgICAgICAgICBpZiAoJCh0aGlzKS53aWR0aCgpID4gOTkyKSB7XG4gICAgICAgICAgICAgICAgJCgnLmJsb2NrLWNoaWxkLWxvY2F0aW9uLXRyYWNraW5nIC5mZWF0dXJlJykuZWFjaChmdW5jdGlvbiAoa2V5LCBpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICQoaXRlbSkuY3NzKHtcImRpc3BsYXlcIjogXCJpbmxpbmUtYmxvY2tcIiwgJ3dpZHRoJzogJ2F1dG8nfSk7XG4gICAgICAgICAgICAgICAgICAgICQoaXRlbSkuY3NzKHtcIndpZHRoXCI6ICgkKGl0ZW0pLndpZHRoKCkgKyA4MSkgKyBcInB4XCJ9KTtcbiAgICAgICAgICAgICAgICAgICAgJChpdGVtKS5jc3Moe1wiZGlzcGxheVwiOiBcImJsb2NrXCIsICdtYXJnaW4nOiAnMCBhdXRvJ30pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKCcuYmxvY2stY2hpbGQtbG9jYXRpb24tdHJhY2tpbmcgLmZlYXR1cmUnKS5lYWNoKGZ1bmN0aW9uIChrZXksIGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgJChpdGVtKS5jc3Moe1wiZGlzcGxheVwiOiBcImJsb2NrXCIsICdtYXJnaW4nOiAnMCBhdXRvJywgJ3dpZHRoJzogJ2F1dG8nfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuXG4gICAgLy8g0Y/QutC+0YDQuCDQtNC70Y8g0LvQuNC/0LrQvtCz0L4g0LzQtdC90Y5cbiAgICAkKCdhLmFuY2hvci1tZW51LWZseScpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB2YXIgYW5jaG9yID0gJCh0aGlzKS5hdHRyKCdocmVmJykuc3BsaXQoJyMnKTtcbiAgICAgICAgaWYgKGFuY2hvci5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICB2YXIgX3RvcCA9ICQoJyMnICsgYW5jaG9yWzFdKS5vZmZzZXQoKS50b3AgLSAkKCcjYmxvY2stc3RpY2t5YmFyJykuaGVpZ2h0KCk7XG4gICAgICAgICAgICAkKCdodG1sLCBib2R5Jykuc3RvcCgpLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgIHNjcm9sbFRvcDogX3RvcCArICdweCdcbiAgICAgICAgICAgIH0sIDEwMDApO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0pO1xuXG4gICAgaWYgKCQoJy5idXktZm9ybS13aXRoLW9mZmVyJykuc2l6ZSgpKSB7XG4gICAgICAgIHZhciBzeW1ib2xzID0ge3VzZDogJyQnLCBldXI6ICfigqwnLCBnYnA6ICfCoycsIGNhZDogJyQnLCBhdWQ6ICckJ307XG5cbiAgICAgICAgdmFyIHVwZGF0ZVJhZGlvID0gZnVuY3Rpb24gKGlucHV0KSB7XG4gICAgICAgICAgICB2YXIgJGZvcm0gPSAkKGlucHV0KS5jbG9zZXN0KCdmb3JtJyk7XG5cbiAgICAgICAgICAgIHZhciBkYXRhID0gJChpbnB1dCkuZGF0YSgpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvL29sZCBzdG9yZVxuICAgICAgICAgICAgLy92YXIgb2ZmZXJFbmFibGVkID0gJGZvcm0uZmluZCgnaW5wdXRbdHlwZT1jaGVja2JveF1bbmFtZT1hbmRyb2lkLTQwb2ZmXVtkYXRhLWdyb3VwPScgKyBkYXRhLmdyb3VwICsgJ10nKS5pcygnOmNoZWNrZWQnKTtcbiAgICAgICAgICAgIHZhciBvZmZlckVuYWJsZWQgPSAkZm9ybS5maW5kKCdpbnB1dFt0eXBlPWNoZWNrYm94XVtkYXRhLWdyb3VwPScgKyBkYXRhLmdyb3VwICsgJ10nKS5pcygnOmNoZWNrZWQnKTtcbiAgICAgICAgICAgIHZhciAkb3B0aW9ucyA9ICQoJy5idXktZm9ybS13aXRoLW9mZmVyJykuZmluZCgnaW5wdXRbdHlwZT1yYWRpb11bZGF0YS1ncm91cD0nICsgZGF0YS5ncm91cCArICddW2RhdGEtcGVyaW9kPScgKyBkYXRhLnBlcmlvZCArICddJyk7XG5cbiAgICAgICAgICAgICRvcHRpb25zLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBvcHRpb25EYXRhID0gJCh0aGlzKS5kYXRhKCk7XG5cbiAgICAgICAgICAgICAgICAkcHJvZHVjdEZpZWxkID0gJCh0aGlzKS5jbG9zZXN0KCdmb3JtJykuZmluZCgnaW5wdXQucHJvZHVjdF9wcmljZScpO1xuXG4gICAgICAgICAgICAgICAgaWYgKG9mZmVyRW5hYmxlZCkge1xuICAgICAgICAgICAgICAgICAgICAkcHJvZHVjdEZpZWxkLnZhbChvcHRpb25EYXRhLm9mZmVyUHJvZHVjdCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJHByb2R1Y3RGaWVsZC52YWwob3B0aW9uRGF0YS5wcm9kdWN0KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAkKHRoaXMpLmNsb3Nlc3QoJ3VsJykuZmluZCgnbGFiZWwnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKCdyX29uJylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcygncl9vZmYnKTtcblxuICAgICAgICAgICAgICAgICQodGhpcykuY2xvc2VzdCgnbGFiZWwnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKCdyX29uJylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcygncl9vZmYnKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAodHlwZW9mIGRhdGEudGFyZ2V0ICE9ICd1bmRlZmluZWQnKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudFZhbHVlID0gJChpbnB1dCkuYXR0cignZGF0YS1wcmljZS0nICsgZGF0YS5jdXIpIC8gTnVtYmVyKGRhdGEucGVyaW9kKTtcblxuICAgICAgICAgICAgICAgIGlmIChvZmZlckVuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFZhbHVlID0gJChpbnB1dCkuYXR0cignZGF0YS1vZmZlci1wcmljZS0nICsgZGF0YS5jdXIpIC8gTnVtYmVyKGRhdGEucGVyaW9kKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgZGlzcGxheVZhbHVlID0gKE1hdGguZmxvb3IoY3VycmVudFZhbHVlICogMTAwKSAvIDEwMCkudG9GaXhlZCgyKTtcblxuICAgICAgICAgICAgICAgICQoZGF0YS50YXJnZXQpLmh0bWwoZGlzcGxheVZhbHVlKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnByZXYoJ2Rpdi5zeW1ib2wnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmh0bWwoc3ltYm9sc1tkYXRhLmN1cl0gPyBzeW1ib2xzW2RhdGEuY3VyXSA6ICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgdXBkYXRlQ2hlY2tib3ggPSBmdW5jdGlvbiAoaW5wdXQpIHtcbiAgICAgICAgICAgIHZhciBkYXRhID0gJChpbnB1dCkuZGF0YSgpO1xuXG4gICAgICAgICAgICB2YXIgb2ZmZXJFbmFibGVkID0gJChpbnB1dCkuaXMoXCI6Y2hlY2tlZFwiKTtcblxuICAgICAgICAgICAgdmFyICRjaGVja2JveGVzID0gJCgnLmJ1eS1mb3JtLXdpdGgtb2ZmZXInKS5maW5kKCdpbnB1dFt0eXBlPWNoZWNrYm94XVtkYXRhLWdyb3VwPScgKyBkYXRhLmdyb3VwICsgJ10nKTtcblxuICAgICAgICAgICAgJGNoZWNrYm94ZXMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyICRmb3JtID0gJCh0aGlzKS5jbG9zZXN0KCdmb3JtJyk7XG5cbiAgICAgICAgICAgICAgICBpZiAob2ZmZXJFbmFibGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghJCh0aGlzKS5pcyhcIjpjaGVja2VkXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnByb3AoJ2NoZWNrZWQnLCBvZmZlckVuYWJsZWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIC8vb2xkIHN0b3JlXG4gICAgICAgICAgICAgICAgICAgIC8vICQoJy53cl9wYWNrXycgKyBkYXRhLmdyb3VwKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgIC8vICQoJy53cl9wYWNrX2RvdWJsZV8nICsgZGF0YS5ncm91cCkuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICAvLyAkZm9ybS5maW5kKCcub2ZmZXJfb2xkX3ByaWNlJykuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICAvLyAkZm9ybS5maW5kKCcucGFja2FnZV9wcmljZScpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gJGZvcm0uZmluZCgnLnBhY2thZ2Vfb2ZmZXJfcHJpY2UnKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgICQoJy5fc2luZ2xlLXBhY2stJyArIGRhdGEuZ3JvdXApLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgJCgnLl9kb3VibGUtcGFjay0nICsgZGF0YS5ncm91cCkuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICAkZm9ybS5maW5kKCcub2ZmZXJfb2xkX3ByaWNlJykuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICAkZm9ybS5maW5kKCcucGFja2FnZV9wcmljZScpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgJGZvcm0uZmluZCgnLnBhY2thZ2Vfb2ZmZXJfcHJpY2UnKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICgkKHRoaXMpLmlzKFwiOmNoZWNrZWRcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykucHJvcCgnY2hlY2tlZCcsIG9mZmVyRW5hYmxlZCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIC8vb2xkIHN0b3JlXG4gICAgICAgICAgICAgICAgICAgIC8vICQoJy53cl9wYWNrX2RvdWJsZV8nICsgZGF0YS5ncm91cCkuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAvLyAkKCcud3JfcGFja18nICsgZGF0YS5ncm91cCkuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICAvLyAkZm9ybS5maW5kKCcub2ZmZXJfb2xkX3ByaWNlJykuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAvLyAkZm9ybS5maW5kKCcucGFja2FnZV9vZmZlcl9wcmljZScpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gJGZvcm0uZmluZCgnLnBhY2thZ2VfcHJpY2UnKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgICQoJy5fZG91YmxlLXBhY2stJyArIGRhdGEuZ3JvdXApLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgJCgnLl9zaW5nbGUtcGFjay0nICsgZGF0YS5ncm91cCkuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICAkZm9ybS5maW5kKCcub2ZmZXJfb2xkX3ByaWNlJykuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAkZm9ybS5maW5kKCcucGFja2FnZV9vZmZlcl9wcmljZScpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgJGZvcm0uZmluZCgnLnBhY2thZ2VfcHJpY2UnKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICQoaW5wdXQpLmNsb3Nlc3QoJ2Zvcm0nKS5maW5kKCdpbnB1dFt0eXBlPXJhZGlvXTpjaGVja2VkJykuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdXBkYXRlUmFkaW8odGhpcyk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfTtcblxuICAgICAgICAkKCcuYnV5LWZvcm0td2l0aC1vZmZlciBpbnB1dFt0eXBlPXJhZGlvXTpjaGVja2VkJykuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB1cGRhdGVSYWRpbyh0aGlzKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJCgnLmJ1eS1mb3JtLXdpdGgtb2ZmZXIgbGFiZWwnKS5oYXMoJ2lucHV0W3R5cGU9cmFkaW9dJykuY2xpY2soZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgICAgIGlmIChlLnRhcmdldC50YWdOYW1lICE9ICdJTlBVVCcpIHtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICRpbnB1dCA9ICQodGhpcykuZmluZCgnaW5wdXQ6Zmlyc3QnKTtcbiAgICAgICAgICAgIHVwZGF0ZVJhZGlvKCRpbnB1dCk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICQoJy5idXktZm9ybS13aXRoLW9mZmVyIGlucHV0W3R5cGU9Y2hlY2tib3hdJykuY2hhbmdlKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICB1cGRhdGVDaGVja2JveCh0aGlzKTtcbiAgICAgICAgfSk7XG4gICAgfSBlbHNlIGlmICgkKCcuYnV5LWZvcm0nKS5zaXplKCkpIHtcbiAgICAgICAgdmFyIHN5bWJvbHMgPSB7dXNkOiAnJCcsIGV1cjogJ+KCrCcsIGdicDogJ8KjJywgY2FkOiAnJCcsIGF1ZDogJyQnfTtcblxuICAgICAgICB2YXIgdXBkYXRlUmFkaW8gPSBmdW5jdGlvbiAoaW5wdXQpIHtcbiAgICAgICAgICAgIHZhciBkYXRhID0gJChpbnB1dCkuZGF0YSgpO1xuXG4gICAgICAgICAgICB2YXIgJGlucHV0cyA9ICQoJy5idXktZm9ybScpLmZpbmQoJ2lucHV0W2RhdGEtcGVyaW9kPScgKyBkYXRhLnBlcmlvZCArICddW2RhdGEtZ3JvdXA9JyArIGRhdGEuZ3JvdXAgKyAnXScpO1xuXG4gICAgICAgICAgICAkaW5wdXRzLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICRwcm9kdWN0RmllbGQgPSAkKHRoaXMpLmNsb3Nlc3QoJ2Zvcm0nKS5maW5kKCdpbnB1dC5wcm9kdWN0X3ByaWNlJyk7XG5cbiAgICAgICAgICAgICAgICAkcHJvZHVjdEZpZWxkLnZhbCgkKHRoaXMpLnZhbCgpKTtcblxuICAgICAgICAgICAgICAgICQodGhpcykuY2xvc2VzdCgndWwnKS5maW5kKCdsYWJlbCcpXG4gICAgICAgICAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoJ3Jfb24nKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKCdyX29mZicpO1xuXG4gICAgICAgICAgICAgICAgJCh0aGlzKS5jbG9zZXN0KCdsYWJlbCcpXG4gICAgICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoJ3Jfb24nKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKCdyX29mZicpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIGlmICh0eXBlb2YgZGF0YS50YXJnZXQgIT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudFZhbHVlID0gJChpbnB1dCkuYXR0cignZGF0YS1wcmljZS0nICsgZGF0YS5jdXIpIC8gTnVtYmVyKGRhdGEucGVyaW9kKTtcblxuICAgICAgICAgICAgICAgIGN1cnJlbnRWYWx1ZSA9IChNYXRoLmZsb29yKGN1cnJlbnRWYWx1ZSAqIDEwMCkgLyAxMDApLnRvRml4ZWQoMik7XG5cbiAgICAgICAgICAgICAgICAkKGRhdGEudGFyZ2V0KS5odG1sKGN1cnJlbnRWYWx1ZSlcbiAgICAgICAgICAgICAgICAgICAgICAgIC5wcmV2KCdkaXYuc3ltYm9sJylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5odG1sKHN5bWJvbHNbZGF0YS5jdXJdID8gc3ltYm9sc1tkYXRhLmN1cl0gOiAnJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgJCgnLmJ1eS1mb3JtIGlucHV0OmNoZWNrZWQnKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHVwZGF0ZVJhZGlvKHRoaXMpO1xuICAgICAgICB9KTtcblxuICAgICAgICAkKCcuYnV5LWZvcm0gbGFiZWwnKS5jbGljayhmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgaWYgKGUudGFyZ2V0LnRhZ05hbWUgIT0gJ0lOUFVUJykge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgdXBkYXRlUmFkaW8oJCh0aGlzKS5maW5kKCdpbnB1dDpmaXJzdCcpKTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGZ1bmN0aW9uIHVwZGF0ZUNoZWNrYm94ZXMoYXR0clZhbCkge1xuICAgICAgICAkKFwiaW5wdXRbZGF0YS1jaGVja2JveGVzPVwiK2F0dHJWYWwrXCJdXCIpLmNoYW5nZShmdW5jdGlvbigpe1xuICAgICAgICAgICAgdmFyICRpbnB1dHMgPSAkKFwiaW5wdXRbbmFtZT1cIithdHRyVmFsK1wiXVwiKVxuICAgICAgICAgICAgJGlucHV0cy5hdHRyKCdjaGVja2VkJywgdGhpcy5jaGVja2VkKTtcbiAgICAgICAgICAgICQuZWFjaCgkaW5wdXRzLCBmdW5jdGlvbigpIHt1cGRhdGVDaGVja2JveCh0aGlzKX0pXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICB1cGRhdGVDaGVja2JveGVzKCdqYWlsYnJlYWstNDBvZmYnKTtcbiAgICB1cGRhdGVDaGVja2JveGVzKCdhbmRyb2lkLTQwb2ZmJyk7XG4gICAgdXBkYXRlQ2hlY2tib3hlcygnaWNsb3VkLTQwb2ZmJyk7XG4gICAgXG4gICAgaWYoJCgnaW5wdXRbbmFtZT1nZXQtNDBvZmZdJykpIHtcbiAgICAgdXBkYXRlQ2hlY2tib3hlcygnZ2V0LTQwb2ZmJyk7XG4gICAgfVxuICAgIFxufSk7XG4iLCIvKlxuICogalF1ZXJ5IGhhc2hjaGFuZ2UgZXZlbnQgLSB2MS4zIC0gNy8yMS8yMDEwXG4gKiBodHRwOi8vYmVuYWxtYW4uY29tL3Byb2plY3RzL2pxdWVyeS1oYXNoY2hhbmdlLXBsdWdpbi9cbiAqIFxuICogQ29weXJpZ2h0IChjKSAyMDEwIFwiQ293Ym95XCIgQmVuIEFsbWFuXG4gKiBEdWFsIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgYW5kIEdQTCBsaWNlbnNlcy5cbiAqIGh0dHA6Ly9iZW5hbG1hbi5jb20vYWJvdXQvbGljZW5zZS9cbiAqL1xuKGZ1bmN0aW9uKCQsZSxiKXt2YXIgYz1cImhhc2hjaGFuZ2VcIixoPWRvY3VtZW50LGYsZz0kLmV2ZW50LnNwZWNpYWwsaT1oLmRvY3VtZW50TW9kZSxkPVwib25cIitjIGluIGUmJihpPT09Ynx8aT43KTtmdW5jdGlvbiBhKGope2o9anx8bG9jYXRpb24uaHJlZjtyZXR1cm5cIiNcIitqLnJlcGxhY2UoL15bXiNdKiM/KC4qKSQvLFwiJDFcIil9JC5mbltjXT1mdW5jdGlvbihqKXtyZXR1cm4gaj90aGlzLmJpbmQoYyxqKTp0aGlzLnRyaWdnZXIoYyl9OyQuZm5bY10uZGVsYXk9NTA7Z1tjXT0kLmV4dGVuZChnW2NdLHtzZXR1cDpmdW5jdGlvbigpe2lmKGQpe3JldHVybiBmYWxzZX0kKGYuc3RhcnQpfSx0ZWFyZG93bjpmdW5jdGlvbigpe2lmKGQpe3JldHVybiBmYWxzZX0kKGYuc3RvcCl9fSk7Zj0oZnVuY3Rpb24oKXt2YXIgaj17fSxwLG09YSgpLGs9ZnVuY3Rpb24ocSl7cmV0dXJuIHF9LGw9ayxvPWs7ai5zdGFydD1mdW5jdGlvbigpe3B8fG4oKX07ai5zdG9wPWZ1bmN0aW9uKCl7cCYmY2xlYXJUaW1lb3V0KHApO3A9Yn07ZnVuY3Rpb24gbigpe3ZhciByPWEoKSxxPW8obSk7aWYociE9PW0pe2wobT1yLHEpOyQoZSkudHJpZ2dlcihjKX1lbHNle2lmKHEhPT1tKXtsb2NhdGlvbi5ocmVmPWxvY2F0aW9uLmhyZWYucmVwbGFjZSgvIy4qLyxcIlwiKStxfX1wPXNldFRpbWVvdXQobiwkLmZuW2NdLmRlbGF5KX0kLnN1cHBvcnQubXNpZSYmIWQmJihmdW5jdGlvbigpe3ZhciBxLHI7ai5zdGFydD1mdW5jdGlvbigpe2lmKCFxKXtyPSQuZm5bY10uc3JjO3I9ciYmcithKCk7cT0kKCc8aWZyYW1lIHRhYmluZGV4PVwiLTFcIiB0aXRsZT1cImVtcHR5XCIvPicpLmhpZGUoKS5vbmUoXCJsb2FkXCIsZnVuY3Rpb24oKXtyfHxsKGEoKSk7bigpfSkuYXR0cihcInNyY1wiLHJ8fFwiamF2YXNjcmlwdDowXCIpLmluc2VydEFmdGVyKFwiYm9keVwiKVswXS5jb250ZW50V2luZG93O2gub25wcm9wZXJ0eWNoYW5nZT1mdW5jdGlvbigpe3RyeXtpZihldmVudC5wcm9wZXJ0eU5hbWU9PT1cInRpdGxlXCIpe3EuZG9jdW1lbnQudGl0bGU9aC50aXRsZX19Y2F0Y2gocyl7fX19fTtqLnN0b3A9aztvPWZ1bmN0aW9uKCl7cmV0dXJuIGEocS5sb2NhdGlvbi5ocmVmKX07bD1mdW5jdGlvbih2LHMpe3ZhciB1PXEuZG9jdW1lbnQsdD0kLmZuW2NdLmRvbWFpbjtpZih2IT09cyl7dS50aXRsZT1oLnRpdGxlO3Uub3BlbigpO3QmJnUud3JpdGUoJzxzY3JpcHQ+ZG9jdW1lbnQuZG9tYWluPVwiJyt0KydcIjxcXC9zY3JpcHQ+Jyk7dS5jbG9zZSgpO3EubG9jYXRpb24uaGFzaD12fX19KSgpO3JldHVybiBqfSkoKX0pKGpRdWVyeSx0aGlzKTsiLCIvKiFcbiAqIGpRdWVyeSBDb29raWUgUGx1Z2luIHYxLjMuMVxuICogaHR0cHM6Ly9naXRodWIuY29tL2NhcmhhcnRsL2pxdWVyeS1jb29raWVcbiAqXG4gKiBDb3B5cmlnaHQgMjAxMyBLbGF1cyBIYXJ0bFxuICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlXG4gKi9cbihmdW5jdGlvbiAoZmFjdG9yeSkge1xuXHRpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XG5cdFx0Ly8gQU1ELiBSZWdpc3RlciBhcyBhbm9ueW1vdXMgbW9kdWxlLlxuXHRcdGRlZmluZShbJ2pxdWVyeSddLCBmYWN0b3J5KTtcblx0fSBlbHNlIHtcblx0XHQvLyBCcm93c2VyIGdsb2JhbHMuXG5cdFx0ZmFjdG9yeShqUXVlcnkpO1xuXHR9XG59KGZ1bmN0aW9uICgkKSB7XG5cblx0dmFyIHBsdXNlcyA9IC9cXCsvZztcblxuXHRmdW5jdGlvbiByYXcocykge1xuXHRcdHJldHVybiBzO1xuXHR9XG5cblx0ZnVuY3Rpb24gZGVjb2RlZChzKSB7XG5cdFx0cmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChzLnJlcGxhY2UocGx1c2VzLCAnICcpKTtcblx0fVxuXG5cdGZ1bmN0aW9uIGNvbnZlcnRlZChzKSB7XG5cdFx0aWYgKHMuaW5kZXhPZignXCInKSA9PT0gMCkge1xuXHRcdFx0Ly8gVGhpcyBpcyBhIHF1b3RlZCBjb29raWUgYXMgYWNjb3JkaW5nIHRvIFJGQzIwNjgsIHVuZXNjYXBlXG5cdFx0XHRzID0gcy5zbGljZSgxLCAtMSkucmVwbGFjZSgvXFxcXFwiL2csICdcIicpLnJlcGxhY2UoL1xcXFxcXFxcL2csICdcXFxcJyk7XG5cdFx0fVxuXHRcdHRyeSB7XG5cdFx0XHRyZXR1cm4gY29uZmlnLmpzb24gPyBKU09OLnBhcnNlKHMpIDogcztcblx0XHR9IGNhdGNoKGVyKSB7fVxuXHR9XG5cblx0dmFyIGNvbmZpZyA9ICQuY29va2llID0gZnVuY3Rpb24gKGtleSwgdmFsdWUsIG9wdGlvbnMpIHtcblxuXHRcdC8vIHdyaXRlXG5cdFx0aWYgKHZhbHVlICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdG9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgY29uZmlnLmRlZmF1bHRzLCBvcHRpb25zKTtcblxuXHRcdFx0aWYgKHR5cGVvZiBvcHRpb25zLmV4cGlyZXMgPT09ICdudW1iZXInKSB7XG5cdFx0XHRcdHZhciBkYXlzID0gb3B0aW9ucy5leHBpcmVzLCB0ID0gb3B0aW9ucy5leHBpcmVzID0gbmV3IERhdGUoKTtcblx0XHRcdFx0dC5zZXREYXRlKHQuZ2V0RGF0ZSgpICsgZGF5cyk7XG5cdFx0XHR9XG5cblx0XHRcdHZhbHVlID0gY29uZmlnLmpzb24gPyBKU09OLnN0cmluZ2lmeSh2YWx1ZSkgOiBTdHJpbmcodmFsdWUpO1xuXG5cdFx0XHRyZXR1cm4gKGRvY3VtZW50LmNvb2tpZSA9IFtcblx0XHRcdFx0Y29uZmlnLnJhdyA/IGtleSA6IGVuY29kZVVSSUNvbXBvbmVudChrZXkpLFxuXHRcdFx0XHQnPScsXG5cdFx0XHRcdGNvbmZpZy5yYXcgPyB2YWx1ZSA6IGVuY29kZVVSSUNvbXBvbmVudCh2YWx1ZSksXG5cdFx0XHRcdG9wdGlvbnMuZXhwaXJlcyA/ICc7IGV4cGlyZXM9JyArIG9wdGlvbnMuZXhwaXJlcy50b1VUQ1N0cmluZygpIDogJycsIC8vIHVzZSBleHBpcmVzIGF0dHJpYnV0ZSwgbWF4LWFnZSBpcyBub3Qgc3VwcG9ydGVkIGJ5IElFXG5cdFx0XHRcdG9wdGlvbnMucGF0aCAgICA/ICc7IHBhdGg9JyArIG9wdGlvbnMucGF0aCA6ICcnLFxuXHRcdFx0XHRvcHRpb25zLmRvbWFpbiAgPyAnOyBkb21haW49JyArIG9wdGlvbnMuZG9tYWluIDogJycsXG5cdFx0XHRcdG9wdGlvbnMuc2VjdXJlICA/ICc7IHNlY3VyZScgOiAnJ1xuXHRcdFx0XS5qb2luKCcnKSk7XG5cdFx0fVxuXG5cdFx0Ly8gcmVhZFxuXHRcdHZhciBkZWNvZGUgPSBjb25maWcucmF3ID8gcmF3IDogZGVjb2RlZDtcblx0XHR2YXIgY29va2llcyA9IGRvY3VtZW50LmNvb2tpZS5zcGxpdCgnOyAnKTtcblx0XHR2YXIgcmVzdWx0ID0ga2V5ID8gdW5kZWZpbmVkIDoge307XG5cdFx0Zm9yICh2YXIgaSA9IDAsIGwgPSBjb29raWVzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuXHRcdFx0dmFyIHBhcnRzID0gY29va2llc1tpXS5zcGxpdCgnPScpO1xuXHRcdFx0dmFyIG5hbWUgPSBkZWNvZGUocGFydHMuc2hpZnQoKSk7XG5cdFx0XHR2YXIgY29va2llID0gZGVjb2RlKHBhcnRzLmpvaW4oJz0nKSk7XG5cblx0XHRcdGlmIChrZXkgJiYga2V5ID09PSBuYW1lKSB7XG5cdFx0XHRcdHJlc3VsdCA9IGNvbnZlcnRlZChjb29raWUpO1xuXHRcdFx0XHRicmVhaztcblx0XHRcdH1cblxuXHRcdFx0aWYgKCFrZXkpIHtcblx0XHRcdFx0cmVzdWx0W25hbWVdID0gY29udmVydGVkKGNvb2tpZSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJlc3VsdDtcblx0fTtcblxuXHRjb25maWcuZGVmYXVsdHMgPSB7fTtcblxuXHQkLnJlbW92ZUNvb2tpZSA9IGZ1bmN0aW9uIChrZXksIG9wdGlvbnMpIHtcblx0XHRpZiAoJC5jb29raWUoa2V5KSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHQvLyBNdXN0IG5vdCBhbHRlciBvcHRpb25zLCB0aHVzIGV4dGVuZGluZyBhIGZyZXNoIG9iamVjdC4uLlxuXHRcdFx0JC5jb29raWUoa2V5LCAnJywgJC5leHRlbmQoe30sIG9wdGlvbnMsIHsgZXhwaXJlczogLTEgfSkpO1xuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fVxuXHRcdHJldHVybiBmYWxzZTtcblx0fTtcblxufSkpO1xuIiwiLy9odHRwOi8vc3RhY2tvdmVyZmxvdy5jb20vcXVlc3Rpb25zLzEyMjE0NjU0L2pxdWVyeS0xLTgtZmluZC1ldmVudC1oYW5kbGVyc1xuLy9odHRwOi8vamFtZXMucGFkb2xzZXkuY29tL2phdmFzY3JpcHQvZGVidWctanF1ZXJ5LWV2ZW50cy13aXRoLWxpc3RoYW5kbGVycy9cbi8vICQoJyonKS5saXN0SGFuZGxlcnMoJyonKTtcbi8vICQoJ2EnKS5saXN0SGFuZGxlcnMoJ29uY2xpY2snKTtcbiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCl7XG4gICAgJC5mbi5saXN0SGFuZGxlcnMgPSBmdW5jdGlvbihldmVudHMpIHtcbiAgICAgICAgdGhpcy5lYWNoKGZ1bmN0aW9uKGkpe1xuICAgICAgICAgICAgdmFyIGVsZW0gPSB0aGlzLFxuICAgICAgICAgICAgLy8gZEV2ZW50cyA9ICQodGhpcykuZGF0YSgnZXZlbnRzJyk7XG4gICAgICAgICAgICBkRXZlbnRzID0gJC5fZGF0YSgkKHRoaXMpLmdldCgwKSwgXCJldmVudHNcIik7XG4gICAgICAgICAgICBpZiAoIWRFdmVudHMpIHtyZXR1cm47fVxuICAgICAgICAgICAgJC5lYWNoKGRFdmVudHMsIGZ1bmN0aW9uKG5hbWUsIGhhbmRsZXIpe1xuICAgICAgICAgICAgICAgIGlmKChuZXcgUmVnRXhwKCdeKCcgKyAoZXZlbnRzID09PSAnKicgPyAnLisnIDogZXZlbnRzLnJlcGxhY2UoJywnLCd8JykucmVwbGFjZSgvXm9uL2ksJycpKSArICcpJCcgLCdpJykpLnRlc3QobmFtZSkpIHtcbiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGhhbmRsZXIsXG4gICAgICAgICAgICAgICAgICAgICAgICBmdW5jdGlvbihpLGhhbmRsZXIpe1xuICAgICAgICAgICAgICAgICAgICAgICAgLy9jb25zb2xlLmluZm8oZWxlbSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmluZm8oZWxlbSwgJ1xcbicgKyBpICsgJzogWycgKyBuYW1lICsgJ10gOiAnICsgaGFuZGxlci5oYW5kbGVyICk7XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFxuICAgICQuZm4uaGFzSGFuZGxlcnMgPSBmdW5jdGlvbihldmVudHMsc2VsZWN0b3IpIHtcbiAgICAgICAgdmFyIHJlc3VsdD1mYWxzZTtcbiAgICAgICAgdGhpcy5lYWNoKGZ1bmN0aW9uKGkpe1xuICAgICAgICAgICAgdmFyIGVsZW0gPSB0aGlzO1xuICAgICAgICAgICAgZEV2ZW50cyA9ICQuX2RhdGEoJCh0aGlzKS5nZXQoMCksIFwiZXZlbnRzXCIpO1xuICAgICAgICAgICAgaWYgKCFkRXZlbnRzKSB7cmV0dXJuIGZhbHNlO31cbiAgICAgICAgICAgICQuZWFjaChkRXZlbnRzLCBmdW5jdGlvbihuYW1lLCBoYW5kbGVyKXtcbiAgICAgICAgICAgICAgICBpZigobmV3IFJlZ0V4cCgnXignICsgKGV2ZW50cyA9PT0gJyonID8gJy4rJyA6IGV2ZW50cy5yZXBsYWNlKCcsJywnfCcpLnJlcGxhY2UoL15vbi9pLCcnKSkgKyAnKSQnICwnaScpKS50ZXN0KG5hbWUpKSB7XG4gICAgICAgICAgICAgICAgJC5lYWNoKGhhbmRsZXIsXG4gICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGksaGFuZGxlcil7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoaGFuZGxlci5zZWxlY3Rvcj09PXNlbGVjdG9yKVxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0PXRydWU7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByZXN1bHQ7XG4gICAgfTtcbn0pOyAiLCIvKipcbioganF1ZXJ5Lm1hdGNoSGVpZ2h0LW1pbi5qcyBtYXN0ZXJcbiogaHR0cDovL2JybS5pby9qcXVlcnktbWF0Y2gtaGVpZ2h0L1xuKiBMaWNlbnNlOiBNSVRcbiovXG4oZnVuY3Rpb24oYyl7dmFyIG49LTEsZj0tMSxnPWZ1bmN0aW9uKGEpe3JldHVybiBwYXJzZUZsb2F0KGEpfHwwfSxyPWZ1bmN0aW9uKGEpe3ZhciBiPW51bGwsZD1bXTtjKGEpLmVhY2goZnVuY3Rpb24oKXt2YXIgYT1jKHRoaXMpLGs9YS5vZmZzZXQoKS50b3AtZyhhLmNzcyhcIm1hcmdpbi10b3BcIikpLGw9MDxkLmxlbmd0aD9kW2QubGVuZ3RoLTFdOm51bGw7bnVsbD09PWw/ZC5wdXNoKGEpOjE+PU1hdGguZmxvb3IoTWF0aC5hYnMoYi1rKSk/ZFtkLmxlbmd0aC0xXT1sLmFkZChhKTpkLnB1c2goYSk7Yj1rfSk7cmV0dXJuIGR9LHA9ZnVuY3Rpb24oYSl7dmFyIGI9e2J5Um93OiEwLHByb3BlcnR5OlwiaGVpZ2h0XCIsdGFyZ2V0Om51bGwscmVtb3ZlOiExfTtpZihcIm9iamVjdFwiPT09dHlwZW9mIGEpcmV0dXJuIGMuZXh0ZW5kKGIsYSk7XCJib29sZWFuXCI9PT10eXBlb2YgYT9iLmJ5Um93PWE6XCJyZW1vdmVcIj09PWEmJihiLnJlbW92ZT0hMCk7cmV0dXJuIGJ9LGI9Yy5mbi5tYXRjaEhlaWdodD1cbmZ1bmN0aW9uKGEpe2E9cChhKTtpZihhLnJlbW92ZSl7dmFyIGU9dGhpczt0aGlzLmNzcyhhLnByb3BlcnR5LFwiXCIpO2MuZWFjaChiLl9ncm91cHMsZnVuY3Rpb24oYSxiKXtiLmVsZW1lbnRzPWIuZWxlbWVudHMubm90KGUpfSk7cmV0dXJuIHRoaXN9aWYoMT49dGhpcy5sZW5ndGgmJiFhLnRhcmdldClyZXR1cm4gdGhpcztiLl9ncm91cHMucHVzaCh7ZWxlbWVudHM6dGhpcyxvcHRpb25zOmF9KTtiLl9hcHBseSh0aGlzLGEpO3JldHVybiB0aGlzfTtiLl9ncm91cHM9W107Yi5fdGhyb3R0bGU9ODA7Yi5fbWFpbnRhaW5TY3JvbGw9ITE7Yi5fYmVmb3JlVXBkYXRlPW51bGw7Yi5fYWZ0ZXJVcGRhdGU9bnVsbDtiLl9hcHBseT1mdW5jdGlvbihhLGUpe3ZhciBkPXAoZSksaD1jKGEpLGs9W2hdLGw9Yyh3aW5kb3cpLnNjcm9sbFRvcCgpLGY9YyhcImh0bWxcIikub3V0ZXJIZWlnaHQoITApLG09aC5wYXJlbnRzKCkuZmlsdGVyKFwiOmhpZGRlblwiKTttLmVhY2goZnVuY3Rpb24oKXt2YXIgYT1jKHRoaXMpO1xuYS5kYXRhKFwic3R5bGUtY2FjaGVcIixhLmF0dHIoXCJzdHlsZVwiKSl9KTttLmNzcyhcImRpc3BsYXlcIixcImJsb2NrXCIpO2QuYnlSb3cmJiFkLnRhcmdldCYmKGguZWFjaChmdW5jdGlvbigpe3ZhciBhPWModGhpcyksYj1hLmNzcyhcImRpc3BsYXlcIik7XCJpbmxpbmUtYmxvY2tcIiE9PWImJlwiaW5saW5lLWZsZXhcIiE9PWImJihiPVwiYmxvY2tcIik7YS5kYXRhKFwic3R5bGUtY2FjaGVcIixhLmF0dHIoXCJzdHlsZVwiKSk7YS5jc3Moe2Rpc3BsYXk6YixcInBhZGRpbmctdG9wXCI6XCIwXCIsXCJwYWRkaW5nLWJvdHRvbVwiOlwiMFwiLFwibWFyZ2luLXRvcFwiOlwiMFwiLFwibWFyZ2luLWJvdHRvbVwiOlwiMFwiLFwiYm9yZGVyLXRvcC13aWR0aFwiOlwiMFwiLFwiYm9yZGVyLWJvdHRvbS13aWR0aFwiOlwiMFwiLGhlaWdodDpcIjEwMHB4XCJ9KX0pLGs9cihoKSxoLmVhY2goZnVuY3Rpb24oKXt2YXIgYT1jKHRoaXMpO2EuYXR0cihcInN0eWxlXCIsYS5kYXRhKFwic3R5bGUtY2FjaGVcIil8fFwiXCIpfSkpO2MuZWFjaChrLGZ1bmN0aW9uKGEsYil7dmFyIGU9YyhiKSxcbmY9MDtpZihkLnRhcmdldClmPWQudGFyZ2V0Lm91dGVySGVpZ2h0KCExKTtlbHNle2lmKGQuYnlSb3cmJjE+PWUubGVuZ3RoKXtlLmNzcyhkLnByb3BlcnR5LFwiXCIpO3JldHVybn1lLmVhY2goZnVuY3Rpb24oKXt2YXIgYT1jKHRoaXMpLGI9YS5jc3MoXCJkaXNwbGF5XCIpO1wiaW5saW5lLWJsb2NrXCIhPT1iJiZcImlubGluZS1mbGV4XCIhPT1iJiYoYj1cImJsb2NrXCIpO2I9e2Rpc3BsYXk6Yn07YltkLnByb3BlcnR5XT1cIlwiO2EuY3NzKGIpO2Eub3V0ZXJIZWlnaHQoITEpPmYmJihmPWEub3V0ZXJIZWlnaHQoITEpKTthLmNzcyhcImRpc3BsYXlcIixcIlwiKX0pfWUuZWFjaChmdW5jdGlvbigpe3ZhciBhPWModGhpcyksYj0wO2QudGFyZ2V0JiZhLmlzKGQudGFyZ2V0KXx8KFwiYm9yZGVyLWJveFwiIT09YS5jc3MoXCJib3gtc2l6aW5nXCIpJiYoYis9ZyhhLmNzcyhcImJvcmRlci10b3Atd2lkdGhcIikpK2coYS5jc3MoXCJib3JkZXItYm90dG9tLXdpZHRoXCIpKSxiKz1nKGEuY3NzKFwicGFkZGluZy10b3BcIikpK2coYS5jc3MoXCJwYWRkaW5nLWJvdHRvbVwiKSkpLFxuYS5jc3MoZC5wcm9wZXJ0eSxmLWIrXCJweFwiKSl9KX0pO20uZWFjaChmdW5jdGlvbigpe3ZhciBhPWModGhpcyk7YS5hdHRyKFwic3R5bGVcIixhLmRhdGEoXCJzdHlsZS1jYWNoZVwiKXx8bnVsbCl9KTtiLl9tYWludGFpblNjcm9sbCYmYyh3aW5kb3cpLnNjcm9sbFRvcChsL2YqYyhcImh0bWxcIikub3V0ZXJIZWlnaHQoITApKTtyZXR1cm4gdGhpc307Yi5fYXBwbHlEYXRhQXBpPWZ1bmN0aW9uKCl7dmFyIGE9e307YyhcIltkYXRhLW1hdGNoLWhlaWdodF0sIFtkYXRhLW1oXVwiKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGI9Yyh0aGlzKSxkPWIuYXR0cihcImRhdGEtbWhcIil8fGIuYXR0cihcImRhdGEtbWF0Y2gtaGVpZ2h0XCIpO2FbZF09ZCBpbiBhP2FbZF0uYWRkKGIpOmJ9KTtjLmVhY2goYSxmdW5jdGlvbigpe3RoaXMubWF0Y2hIZWlnaHQoITApfSl9O3ZhciBxPWZ1bmN0aW9uKGEpe2IuX2JlZm9yZVVwZGF0ZSYmYi5fYmVmb3JlVXBkYXRlKGEsYi5fZ3JvdXBzKTtjLmVhY2goYi5fZ3JvdXBzLGZ1bmN0aW9uKCl7Yi5fYXBwbHkodGhpcy5lbGVtZW50cyxcbnRoaXMub3B0aW9ucyl9KTtiLl9hZnRlclVwZGF0ZSYmYi5fYWZ0ZXJVcGRhdGUoYSxiLl9ncm91cHMpfTtiLl91cGRhdGU9ZnVuY3Rpb24oYSxlKXtpZihlJiZcInJlc2l6ZVwiPT09ZS50eXBlKXt2YXIgZD1jKHdpbmRvdykud2lkdGgoKTtpZihkPT09bilyZXR1cm47bj1kfWE/LTE9PT1mJiYoZj1zZXRUaW1lb3V0KGZ1bmN0aW9uKCl7cShlKTtmPS0xfSxiLl90aHJvdHRsZSkpOnEoZSl9O2MoYi5fYXBwbHlEYXRhQXBpKTtjKHdpbmRvdykuYmluZChcImxvYWRcIixmdW5jdGlvbihhKXtiLl91cGRhdGUoITEsYSl9KTtjKHdpbmRvdykuYmluZChcInJlc2l6ZSBvcmllbnRhdGlvbmNoYW5nZVwiLGZ1bmN0aW9uKGEpe2IuX3VwZGF0ZSghMCxhKX0pfSkoalF1ZXJ5KTsiLCIvKipcbiogc2ltcGxlUGFnaW5hdGlvbi5qcyB2MS42XG4qIEEgc2ltcGxlIGpRdWVyeSBwYWdpbmF0aW9uIHBsdWdpbi5cbiogaHR0cDovL2ZsYXZpdXNtYXRpcy5naXRodWIuY29tL3NpbXBsZVBhZ2luYXRpb24uanMvXG4qXG4qIENvcHlyaWdodCAyMDEyLCBGbGF2aXVzIE1hdGlzXG4qIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZS5cbiogaHR0cDovL2ZsYXZpdXNtYXRpcy5naXRodWIuY29tL2xpY2Vuc2UuaHRtbFxuKi9cblxuKGZ1bmN0aW9uKCQpe1xuXG5cdHZhciBtZXRob2RzID0ge1xuXHRcdGluaXQ6IGZ1bmN0aW9uKG9wdGlvbnMpIHtcblx0XHRcdHZhciBvID0gJC5leHRlbmQoe1xuXHRcdFx0XHRpdGVtczogMSxcblx0XHRcdFx0aXRlbXNPblBhZ2U6IDEsXG5cdFx0XHRcdHBhZ2VzOiAwLFxuXHRcdFx0XHRkaXNwbGF5ZWRQYWdlczogNSxcblx0XHRcdFx0ZWRnZXM6IDIsXG5cdFx0XHRcdGN1cnJlbnRQYWdlOiAwLFxuXHRcdFx0XHRocmVmVGV4dFByZWZpeDogJyNwYWdlPScsXG5cdFx0XHRcdGhyZWZUZXh0U3VmZml4OiAnJyxcblx0XHRcdFx0cHJldlRleHQ6ICdQcmV2Jyxcblx0XHRcdFx0bmV4dFRleHQ6ICdOZXh0Jyxcblx0XHRcdFx0ZWxsaXBzZVRleHQ6ICcmaGVsbGlwOycsXG5cdFx0XHRcdGNzc1N0eWxlOiAnbGlnaHQtdGhlbWUnLFxuXHRcdFx0XHRsYWJlbE1hcDogW10sXG5cdFx0XHRcdHNlbGVjdE9uQ2xpY2s6IHRydWUsXG5cdFx0XHRcdG5leHRBdEZyb250OiBmYWxzZSxcblx0XHRcdFx0aW52ZXJ0UGFnZU9yZGVyOiBmYWxzZSxcblx0XHRcdFx0dXNlU3RhcnRFZGdlIDogdHJ1ZSxcblx0XHRcdFx0dXNlRW5kRWRnZSA6IHRydWUsXG5cdFx0XHRcdG9uUGFnZUNsaWNrOiBmdW5jdGlvbihwYWdlTnVtYmVyLCBldmVudCkge1xuXHRcdFx0XHRcdC8vIENhbGxiYWNrIHRyaWdnZXJlZCB3aGVuIGEgcGFnZSBpcyBjbGlja2VkXG5cdFx0XHRcdFx0Ly8gUGFnZSBudW1iZXIgaXMgZ2l2ZW4gYXMgYW4gb3B0aW9uYWwgcGFyYW1ldGVyXG5cdFx0XHRcdH0sXG5cdFx0XHRcdG9uSW5pdDogZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0Ly8gQ2FsbGJhY2sgdHJpZ2dlcmVkIGltbWVkaWF0ZWx5IGFmdGVyIGluaXRpYWxpemF0aW9uXG5cdFx0XHRcdH1cblx0XHRcdH0sIG9wdGlvbnMgfHwge30pO1xuXG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cblx0XHRcdG8ucGFnZXMgPSBvLnBhZ2VzID8gby5wYWdlcyA6IE1hdGguY2VpbChvLml0ZW1zIC8gby5pdGVtc09uUGFnZSkgPyBNYXRoLmNlaWwoby5pdGVtcyAvIG8uaXRlbXNPblBhZ2UpIDogMTtcblx0XHRcdGlmIChvLmN1cnJlbnRQYWdlKVxuXHRcdFx0XHRvLmN1cnJlbnRQYWdlID0gby5jdXJyZW50UGFnZSAtIDE7XG5cdFx0XHRlbHNlXG5cdFx0XHRcdG8uY3VycmVudFBhZ2UgPSAhby5pbnZlcnRQYWdlT3JkZXIgPyAwIDogby5wYWdlcyAtIDE7XG5cdFx0XHRvLmhhbGZEaXNwbGF5ZWQgPSBvLmRpc3BsYXllZFBhZ2VzIC8gMjtcblxuXHRcdFx0dGhpcy5lYWNoKGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRzZWxmLmFkZENsYXNzKG8uY3NzU3R5bGUgKyAnIHNpbXBsZS1wYWdpbmF0aW9uJykuZGF0YSgncGFnaW5hdGlvbicsIG8pO1xuXHRcdFx0XHRtZXRob2RzLl9kcmF3LmNhbGwoc2VsZik7XG5cdFx0XHR9KTtcblxuXHRcdFx0by5vbkluaXQoKTtcblxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblxuXHRcdHNlbGVjdFBhZ2U6IGZ1bmN0aW9uKHBhZ2UpIHtcblx0XHRcdG1ldGhvZHMuX3NlbGVjdFBhZ2UuY2FsbCh0aGlzLCBwYWdlIC0gMSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXG5cdFx0cHJldlBhZ2U6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIG8gPSB0aGlzLmRhdGEoJ3BhZ2luYXRpb24nKTtcblx0XHRcdGlmICghby5pbnZlcnRQYWdlT3JkZXIpIHtcblx0XHRcdFx0aWYgKG8uY3VycmVudFBhZ2UgPiAwKSB7XG5cdFx0XHRcdFx0bWV0aG9kcy5fc2VsZWN0UGFnZS5jYWxsKHRoaXMsIG8uY3VycmVudFBhZ2UgLSAxKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0aWYgKG8uY3VycmVudFBhZ2UgPCBvLnBhZ2VzIC0gMSkge1xuXHRcdFx0XHRcdG1ldGhvZHMuX3NlbGVjdFBhZ2UuY2FsbCh0aGlzLCBvLmN1cnJlbnRQYWdlICsgMSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cblx0XHRuZXh0UGFnZTogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgbyA9IHRoaXMuZGF0YSgncGFnaW5hdGlvbicpO1xuXHRcdFx0aWYgKCFvLmludmVydFBhZ2VPcmRlcikge1xuXHRcdFx0XHRpZiAoby5jdXJyZW50UGFnZSA8IG8ucGFnZXMgLSAxKSB7XG5cdFx0XHRcdFx0bWV0aG9kcy5fc2VsZWN0UGFnZS5jYWxsKHRoaXMsIG8uY3VycmVudFBhZ2UgKyAxKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0aWYgKG8uY3VycmVudFBhZ2UgPiAwKSB7XG5cdFx0XHRcdFx0bWV0aG9kcy5fc2VsZWN0UGFnZS5jYWxsKHRoaXMsIG8uY3VycmVudFBhZ2UgLSAxKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblxuXHRcdGdldFBhZ2VzQ291bnQ6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuZGF0YSgncGFnaW5hdGlvbicpLnBhZ2VzO1xuXHRcdH0sXG5cblx0XHRnZXRDdXJyZW50UGFnZTogZnVuY3Rpb24gKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuZGF0YSgncGFnaW5hdGlvbicpLmN1cnJlbnRQYWdlICsgMTtcblx0XHR9LFxuXG5cdFx0ZGVzdHJveTogZnVuY3Rpb24oKXtcblx0XHRcdHRoaXMuZW1wdHkoKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cblx0XHRkcmF3UGFnZTogZnVuY3Rpb24gKHBhZ2UpIHtcblx0XHRcdHZhciBvID0gdGhpcy5kYXRhKCdwYWdpbmF0aW9uJyk7XG5cdFx0XHRvLmN1cnJlbnRQYWdlID0gcGFnZSAtIDE7XG5cdFx0XHR0aGlzLmRhdGEoJ3BhZ2luYXRpb24nLCBvKTtcblx0XHRcdG1ldGhvZHMuX2RyYXcuY2FsbCh0aGlzKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cblx0XHRyZWRyYXc6IGZ1bmN0aW9uKCl7XG5cdFx0XHRtZXRob2RzLl9kcmF3LmNhbGwodGhpcyk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXG5cdFx0ZGlzYWJsZTogZnVuY3Rpb24oKXtcblx0XHRcdHZhciBvID0gdGhpcy5kYXRhKCdwYWdpbmF0aW9uJyk7XG5cdFx0XHRvLmRpc2FibGVkID0gdHJ1ZTtcblx0XHRcdHRoaXMuZGF0YSgncGFnaW5hdGlvbicsIG8pO1xuXHRcdFx0bWV0aG9kcy5fZHJhdy5jYWxsKHRoaXMpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblxuXHRcdGVuYWJsZTogZnVuY3Rpb24oKXtcblx0XHRcdHZhciBvID0gdGhpcy5kYXRhKCdwYWdpbmF0aW9uJyk7XG5cdFx0XHRvLmRpc2FibGVkID0gZmFsc2U7XG5cdFx0XHR0aGlzLmRhdGEoJ3BhZ2luYXRpb24nLCBvKTtcblx0XHRcdG1ldGhvZHMuX2RyYXcuY2FsbCh0aGlzKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cblx0XHR1cGRhdGVJdGVtczogZnVuY3Rpb24gKG5ld0l0ZW1zKSB7XG5cdFx0XHR2YXIgbyA9IHRoaXMuZGF0YSgncGFnaW5hdGlvbicpO1xuXHRcdFx0by5pdGVtcyA9IG5ld0l0ZW1zO1xuXHRcdFx0by5wYWdlcyA9IG1ldGhvZHMuX2dldFBhZ2VzKG8pO1xuXHRcdFx0dGhpcy5kYXRhKCdwYWdpbmF0aW9uJywgbyk7XG5cdFx0XHRtZXRob2RzLl9kcmF3LmNhbGwodGhpcyk7XG5cdFx0fSxcblxuXHRcdHVwZGF0ZUl0ZW1zT25QYWdlOiBmdW5jdGlvbiAoaXRlbXNPblBhZ2UpIHtcblx0XHRcdHZhciBvID0gdGhpcy5kYXRhKCdwYWdpbmF0aW9uJyk7XG5cdFx0XHRvLml0ZW1zT25QYWdlID0gaXRlbXNPblBhZ2U7XG5cdFx0XHRvLnBhZ2VzID0gbWV0aG9kcy5fZ2V0UGFnZXMobyk7XG5cdFx0XHR0aGlzLmRhdGEoJ3BhZ2luYXRpb24nLCBvKTtcblx0XHRcdG1ldGhvZHMuX3NlbGVjdFBhZ2UuY2FsbCh0aGlzLCAwKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cblx0XHRfZHJhdzogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXJcdG8gPSB0aGlzLmRhdGEoJ3BhZ2luYXRpb24nKSxcblx0XHRcdFx0aW50ZXJ2YWwgPSBtZXRob2RzLl9nZXRJbnRlcnZhbChvKSxcblx0XHRcdFx0aSxcblx0XHRcdFx0dGFnTmFtZTtcblxuXHRcdFx0bWV0aG9kcy5kZXN0cm95LmNhbGwodGhpcyk7XG5cdFx0XHRcblx0XHRcdHRhZ05hbWUgPSAodHlwZW9mIHRoaXMucHJvcCA9PT0gJ2Z1bmN0aW9uJykgPyB0aGlzLnByb3AoJ3RhZ05hbWUnKSA6IHRoaXMuYXR0cigndGFnTmFtZScpO1xuXG5cdFx0XHR2YXIgJHBhbmVsID0gdGFnTmFtZSA9PT0gJ1VMJyA/IHRoaXMgOiAkKCc8dWwgY2xhc3M9XCJwYWdpbmF0aW9uXCI+PC91bD4nKS5hcHBlbmRUbyh0aGlzKTtcblxuXHRcdFx0Ly8gR2VuZXJhdGUgUHJldiBsaW5rXG5cdFx0XHRpZiAoby5wcmV2VGV4dCkge1xuXHRcdFx0XHRtZXRob2RzLl9hcHBlbmRJdGVtLmNhbGwodGhpcywgIW8uaW52ZXJ0UGFnZU9yZGVyID8gby5jdXJyZW50UGFnZSAtIDEgOiBvLmN1cnJlbnRQYWdlICsgMSwge3RleHQ6IG8ucHJldlRleHQsIGNsYXNzZXM6ICdwcmV2J30pO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBHZW5lcmF0ZSBOZXh0IGxpbmsgKGlmIG9wdGlvbiBzZXQgZm9yIGF0IGZyb250KVxuXHRcdFx0aWYgKG8ubmV4dFRleHQgJiYgby5uZXh0QXRGcm9udCkge1xuXHRcdFx0XHRtZXRob2RzLl9hcHBlbmRJdGVtLmNhbGwodGhpcywgIW8uaW52ZXJ0UGFnZU9yZGVyID8gby5jdXJyZW50UGFnZSArIDEgOiBvLmN1cnJlbnRQYWdlIC0gMSwge3RleHQ6IG8ubmV4dFRleHQsIGNsYXNzZXM6ICduZXh0J30pO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBHZW5lcmF0ZSBzdGFydCBlZGdlc1xuXHRcdFx0aWYgKCFvLmludmVydFBhZ2VPcmRlcikge1xuXHRcdFx0XHRpZiAoaW50ZXJ2YWwuc3RhcnQgPiAwICYmIG8uZWRnZXMgPiAwKSB7XG5cdFx0XHRcdFx0aWYoby51c2VTdGFydEVkZ2UpIHtcblx0XHRcdFx0XHRcdHZhciBlbmQgPSBNYXRoLm1pbihvLmVkZ2VzLCBpbnRlcnZhbC5zdGFydCk7XG5cdFx0XHRcdFx0XHRmb3IgKGkgPSAwOyBpIDwgZW5kOyBpKyspIHtcblx0XHRcdFx0XHRcdFx0bWV0aG9kcy5fYXBwZW5kSXRlbS5jYWxsKHRoaXMsIGkpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRpZiAoby5lZGdlcyA8IGludGVydmFsLnN0YXJ0ICYmIChpbnRlcnZhbC5zdGFydCAtIG8uZWRnZXMgIT0gMSkpIHtcblx0XHRcdFx0XHRcdCRwYW5lbC5hcHBlbmQoJzxsaSBjbGFzcz1cImRpc2FibGVkXCI+PHNwYW4gY2xhc3M9XCJlbGxpcHNlXCI+JyArIG8uZWxsaXBzZVRleHQgKyAnPC9zcGFuPjwvbGk+Jyk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmIChpbnRlcnZhbC5zdGFydCAtIG8uZWRnZXMgPT0gMSkge1xuXHRcdFx0XHRcdFx0bWV0aG9kcy5fYXBwZW5kSXRlbS5jYWxsKHRoaXMsIG8uZWRnZXMpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0aWYgKGludGVydmFsLmVuZCA8IG8ucGFnZXMgJiYgby5lZGdlcyA+IDApIHtcblx0XHRcdFx0XHRpZihvLnVzZVN0YXJ0RWRnZSkge1xuXHRcdFx0XHRcdFx0dmFyIGJlZ2luID0gTWF0aC5tYXgoby5wYWdlcyAtIG8uZWRnZXMsIGludGVydmFsLmVuZCk7XG5cdFx0XHRcdFx0XHRmb3IgKGkgPSBvLnBhZ2VzIC0gMTsgaSA+PSBiZWdpbjsgaS0tKSB7XG5cdFx0XHRcdFx0XHRcdG1ldGhvZHMuX2FwcGVuZEl0ZW0uY2FsbCh0aGlzLCBpKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoby5wYWdlcyAtIG8uZWRnZXMgPiBpbnRlcnZhbC5lbmQgJiYgKG8ucGFnZXMgLSBvLmVkZ2VzIC0gaW50ZXJ2YWwuZW5kICE9IDEpKSB7XG5cdFx0XHRcdFx0XHQkcGFuZWwuYXBwZW5kKCc8bGkgY2xhc3M9XCJkaXNhYmxlZFwiPjxzcGFuIGNsYXNzPVwiZWxsaXBzZVwiPicgKyBvLmVsbGlwc2VUZXh0ICsgJzwvc3Bhbj48L2xpPicpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAoby5wYWdlcyAtIG8uZWRnZXMgLSBpbnRlcnZhbC5lbmQgPT0gMSkge1xuXHRcdFx0XHRcdFx0bWV0aG9kcy5fYXBwZW5kSXRlbS5jYWxsKHRoaXMsIGludGVydmFsLmVuZCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vIEdlbmVyYXRlIGludGVydmFsIGxpbmtzXG5cdFx0XHRpZiAoIW8uaW52ZXJ0UGFnZU9yZGVyKSB7XG5cdFx0XHRcdGZvciAoaSA9IGludGVydmFsLnN0YXJ0OyBpIDwgaW50ZXJ2YWwuZW5kOyBpKyspIHtcblx0XHRcdFx0XHRtZXRob2RzLl9hcHBlbmRJdGVtLmNhbGwodGhpcywgaSk7XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGZvciAoaSA9IGludGVydmFsLmVuZCAtIDE7IGkgPj0gaW50ZXJ2YWwuc3RhcnQ7IGktLSkge1xuXHRcdFx0XHRcdG1ldGhvZHMuX2FwcGVuZEl0ZW0uY2FsbCh0aGlzLCBpKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHQvLyBHZW5lcmF0ZSBlbmQgZWRnZXNcblx0XHRcdGlmICghby5pbnZlcnRQYWdlT3JkZXIpIHtcblx0XHRcdFx0aWYgKGludGVydmFsLmVuZCA8IG8ucGFnZXMgJiYgby5lZGdlcyA+IDApIHtcblx0XHRcdFx0XHRpZiAoby5wYWdlcyAtIG8uZWRnZXMgPiBpbnRlcnZhbC5lbmQgJiYgKG8ucGFnZXMgLSBvLmVkZ2VzIC0gaW50ZXJ2YWwuZW5kICE9IDEpKSB7XG5cdFx0XHRcdFx0XHQkcGFuZWwuYXBwZW5kKCc8bGkgY2xhc3M9XCJkaXNhYmxlZFwiPjxzcGFuIGNsYXNzPVwiZWxsaXBzZVwiPicgKyBvLmVsbGlwc2VUZXh0ICsgJzwvc3Bhbj48L2xpPicpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAoby5wYWdlcyAtIG8uZWRnZXMgLSBpbnRlcnZhbC5lbmQgPT0gMSkge1xuXHRcdFx0XHRcdFx0bWV0aG9kcy5fYXBwZW5kSXRlbS5jYWxsKHRoaXMsIGludGVydmFsLmVuZCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmKG8udXNlRW5kRWRnZSkge1xuXHRcdFx0XHRcdFx0dmFyIGJlZ2luID0gTWF0aC5tYXgoby5wYWdlcyAtIG8uZWRnZXMsIGludGVydmFsLmVuZCk7XG5cdFx0XHRcdFx0XHRmb3IgKGkgPSBiZWdpbjsgaSA8IG8ucGFnZXM7IGkrKykge1xuXHRcdFx0XHRcdFx0XHRtZXRob2RzLl9hcHBlbmRJdGVtLmNhbGwodGhpcywgaSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpZiAoaW50ZXJ2YWwuc3RhcnQgPiAwICYmIG8uZWRnZXMgPiAwKSB7XG5cdFx0XHRcdFx0aWYgKG8uZWRnZXMgPCBpbnRlcnZhbC5zdGFydCAmJiAoaW50ZXJ2YWwuc3RhcnQgLSBvLmVkZ2VzICE9IDEpKSB7XG5cdFx0XHRcdFx0XHQkcGFuZWwuYXBwZW5kKCc8bGkgY2xhc3M9XCJkaXNhYmxlZFwiPjxzcGFuIGNsYXNzPVwiZWxsaXBzZVwiPicgKyBvLmVsbGlwc2VUZXh0ICsgJzwvc3Bhbj48L2xpPicpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAoaW50ZXJ2YWwuc3RhcnQgLSBvLmVkZ2VzID09IDEpIHtcblx0XHRcdFx0XHRcdG1ldGhvZHMuX2FwcGVuZEl0ZW0uY2FsbCh0aGlzLCBvLmVkZ2VzKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZihvLnVzZUVuZEVkZ2UpIHtcblx0XHRcdFx0XHRcdHZhciBlbmQgPSBNYXRoLm1pbihvLmVkZ2VzLCBpbnRlcnZhbC5zdGFydCk7XG5cdFx0XHRcdFx0XHRmb3IgKGkgPSBlbmQgLSAxOyBpID49IDA7IGktLSkge1xuXHRcdFx0XHRcdFx0XHRtZXRob2RzLl9hcHBlbmRJdGVtLmNhbGwodGhpcywgaSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vIEdlbmVyYXRlIE5leHQgbGluayAodW5sZXNzIG9wdGlvbiBpcyBzZXQgZm9yIGF0IGZyb250KVxuXHRcdFx0aWYgKG8ubmV4dFRleHQgJiYgIW8ubmV4dEF0RnJvbnQpIHtcblx0XHRcdFx0bWV0aG9kcy5fYXBwZW5kSXRlbS5jYWxsKHRoaXMsICFvLmludmVydFBhZ2VPcmRlciA/IG8uY3VycmVudFBhZ2UgKyAxIDogby5jdXJyZW50UGFnZSAtIDEsIHt0ZXh0OiBvLm5leHRUZXh0LCBjbGFzc2VzOiAnbmV4dCd9KTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0X2dldFBhZ2VzOiBmdW5jdGlvbihvKSB7XG5cdFx0XHR2YXIgcGFnZXMgPSBNYXRoLmNlaWwoby5pdGVtcyAvIG8uaXRlbXNPblBhZ2UpO1xuXHRcdFx0cmV0dXJuIHBhZ2VzIHx8IDE7XG5cdFx0fSxcblxuXHRcdF9nZXRJbnRlcnZhbDogZnVuY3Rpb24obykge1xuXHRcdFx0cmV0dXJuIHtcblx0XHRcdFx0c3RhcnQ6IE1hdGguY2VpbChvLmN1cnJlbnRQYWdlID4gby5oYWxmRGlzcGxheWVkID8gTWF0aC5tYXgoTWF0aC5taW4oby5jdXJyZW50UGFnZSAtIG8uaGFsZkRpc3BsYXllZCwgKG8ucGFnZXMgLSBvLmRpc3BsYXllZFBhZ2VzKSksIDApIDogMCksXG5cdFx0XHRcdGVuZDogTWF0aC5jZWlsKG8uY3VycmVudFBhZ2UgPiBvLmhhbGZEaXNwbGF5ZWQgPyBNYXRoLm1pbihvLmN1cnJlbnRQYWdlICsgby5oYWxmRGlzcGxheWVkLCBvLnBhZ2VzKSA6IE1hdGgubWluKG8uZGlzcGxheWVkUGFnZXMsIG8ucGFnZXMpKVxuXHRcdFx0fTtcblx0XHR9LFxuXG5cdFx0X2FwcGVuZEl0ZW06IGZ1bmN0aW9uKHBhZ2VJbmRleCwgb3B0cykge1xuXHRcdFx0dmFyIHNlbGYgPSB0aGlzLCBvcHRpb25zLCAkbGluaywgbyA9IHNlbGYuZGF0YSgncGFnaW5hdGlvbicpLCAkbGlua1dyYXBwZXIgPSAkKCc8bGk+PC9saT4nKSwgJHVsID0gc2VsZi5maW5kKCd1bCcpO1xuXG5cdFx0XHRwYWdlSW5kZXggPSBwYWdlSW5kZXggPCAwID8gMCA6IChwYWdlSW5kZXggPCBvLnBhZ2VzID8gcGFnZUluZGV4IDogby5wYWdlcyAtIDEpO1xuXG5cdFx0XHRvcHRpb25zID0ge1xuXHRcdFx0XHR0ZXh0OiBwYWdlSW5kZXggKyAxLFxuXHRcdFx0XHRjbGFzc2VzOiAnJ1xuXHRcdFx0fTtcblxuXHRcdFx0aWYgKG8ubGFiZWxNYXAubGVuZ3RoICYmIG8ubGFiZWxNYXBbcGFnZUluZGV4XSkge1xuXHRcdFx0XHRvcHRpb25zLnRleHQgPSBvLmxhYmVsTWFwW3BhZ2VJbmRleF07XG5cdFx0XHR9XG5cblx0XHRcdG9wdGlvbnMgPSAkLmV4dGVuZChvcHRpb25zLCBvcHRzIHx8IHt9KTtcblxuXHRcdFx0aWYgKHBhZ2VJbmRleCA9PSBvLmN1cnJlbnRQYWdlIHx8IG8uZGlzYWJsZWQpIHtcblx0XHRcdFx0aWYgKG8uZGlzYWJsZWQpIHtcblx0XHRcdFx0XHQkbGlua1dyYXBwZXIuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0JGxpbmtXcmFwcGVyLmFkZENsYXNzKCdhY3RpdmUnKTtcblx0XHRcdFx0fVxuXHRcdFx0XHQkbGluayA9ICQoJzxzcGFuIGNsYXNzPVwiY3VycmVudFwiPicgKyAob3B0aW9ucy50ZXh0KSArICc8L3NwYW4+Jyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQkbGluayA9ICQoJzxhIGhyZWY9XCInICsgby5ocmVmVGV4dFByZWZpeCArIChwYWdlSW5kZXggKyAxKSArIG8uaHJlZlRleHRTdWZmaXggKyAnXCIgY2xhc3M9XCJwYWdlLWxpbmtcIj4nICsgKG9wdGlvbnMudGV4dCkgKyAnPC9hPicpO1xuXHRcdFx0XHQkbGluay5jbGljayhmdW5jdGlvbihldmVudCl7XG5cdFx0XHRcdFx0cmV0dXJuIG1ldGhvZHMuX3NlbGVjdFBhZ2UuY2FsbChzZWxmLCBwYWdlSW5kZXgsIGV2ZW50KTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmIChvcHRpb25zLmNsYXNzZXMpIHtcblx0XHRcdFx0JGxpbmsuYWRkQ2xhc3Mob3B0aW9ucy5jbGFzc2VzKTtcblx0XHRcdH1cblxuXHRcdFx0JGxpbmtXcmFwcGVyLmFwcGVuZCgkbGluayk7XG5cblx0XHRcdGlmICgkdWwubGVuZ3RoKSB7XG5cdFx0XHRcdCR1bC5hcHBlbmQoJGxpbmtXcmFwcGVyKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHNlbGYuYXBwZW5kKCRsaW5rV3JhcHBlcik7XG5cdFx0XHR9XG5cdFx0fSxcblxuXHRcdF9zZWxlY3RQYWdlOiBmdW5jdGlvbihwYWdlSW5kZXgsIGV2ZW50KSB7XG5cdFx0XHR2YXIgbyA9IHRoaXMuZGF0YSgncGFnaW5hdGlvbicpO1xuXHRcdFx0by5jdXJyZW50UGFnZSA9IHBhZ2VJbmRleDtcblx0XHRcdGlmIChvLnNlbGVjdE9uQ2xpY2spIHtcblx0XHRcdFx0bWV0aG9kcy5fZHJhdy5jYWxsKHRoaXMpO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIG8ub25QYWdlQ2xpY2socGFnZUluZGV4ICsgMSwgZXZlbnQpO1xuXHRcdH1cblxuXHR9O1xuXG5cdCQuZm4ucGFnaW5hdGlvbiA9IGZ1bmN0aW9uKG1ldGhvZCkge1xuXG5cdFx0Ly8gTWV0aG9kIGNhbGxpbmcgbG9naWNcblx0XHRpZiAobWV0aG9kc1ttZXRob2RdICYmIG1ldGhvZC5jaGFyQXQoMCkgIT0gJ18nKSB7XG5cdFx0XHRyZXR1cm4gbWV0aG9kc1ttZXRob2RdLmFwcGx5KHRoaXMsIEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywgMSkpO1xuXHRcdH0gZWxzZSBpZiAodHlwZW9mIG1ldGhvZCA9PT0gJ29iamVjdCcgfHwgIW1ldGhvZCkge1xuXHRcdFx0cmV0dXJuIG1ldGhvZHMuaW5pdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHQkLmVycm9yKCdNZXRob2QgJyArICBtZXRob2QgKyAnIGRvZXMgbm90IGV4aXN0IG9uIGpRdWVyeS5wYWdpbmF0aW9uJyk7XG5cdFx0fVxuXG5cdH07XG5cbn0pKGpRdWVyeSk7XG4iLCIoZnVuY3Rpb24oJCwgc3BlY2lhbEV2ZW50TmFtZSkge1xuICAndXNlIHN0cmljdCc7XG5cbiAgLyoqXG4gICAqIE5hdGl2ZSBldmVudCBuYW1lcyBmb3IgY3JlYXRpbmcgY3VzdG9tIG9uZS5cbiAgICpcbiAgICogQHR5cGUge09iamVjdH1cbiAgICovXG4gIHZhciBuYXRpdmVFdmVudCA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gIC8qKlxuICAgKiBHZXQgY3VycmVudCB0aW1lLlxuICAgKlxuICAgKiBAcmV0dXJuIHtOdW1iZXJ9XG4gICAqL1xuICB2YXIgZ2V0VGltZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcbiAgfTtcblxuICBuYXRpdmVFdmVudC5vcmlnaW5hbCA9ICdjbGljayc7XG5cbiAgaWYgKCdvbnRvdWNoc3RhcnQnIGluIGRvY3VtZW50KSB7XG4gICAgbmF0aXZlRXZlbnQuc3RhcnQgPSAndG91Y2hzdGFydCc7XG4gICAgbmF0aXZlRXZlbnQuZW5kID0gJ3RvdWNoZW5kJztcbiAgfSBlbHNlIHtcbiAgICBuYXRpdmVFdmVudC5zdGFydCA9ICdtb3VzZWRvd24nO1xuICAgIG5hdGl2ZUV2ZW50LmVuZCA9ICdtb3VzZXVwJztcbiAgfVxuXG4gICQuZXZlbnQuc3BlY2lhbFtzcGVjaWFsRXZlbnROYW1lXSA9IHtcbiAgICBzZXR1cDogZnVuY3Rpb24oZGF0YSwgbmFtZXNwYWNlcywgZXZlbnRIYW5kbGUpIHtcbiAgICAgIHZhciAkZWxlbWVudCA9ICQodGhpcyk7XG4gICAgICB2YXIgZXZlbnREYXRhID0ge307XG5cbiAgICAgICRlbGVtZW50XG4gICAgICAgIC8vIFJlbW92ZSBhbGwgaGFuZGxlcnMgdGhhdCB3ZXJlIHNldCBmb3IgYW4gb3JpZ2luYWwgZXZlbnQuXG4gICAgICAgIC5vZmYobmF0aXZlRXZlbnQub3JpZ2luYWwpXG4gICAgICAgIC8vIFByZXZlbnQgZGVmYXVsdCBhY3Rpb25zLlxuICAgICAgICAub24obmF0aXZlRXZlbnQub3JpZ2luYWwsIGZhbHNlKVxuICAgICAgICAvLyBTcGxpdCBvcmlnaW5hbCBldmVudCBieSB0d28gZGlmZmVyZW50IGFuZCBjb2xsZWN0IGFuIGluZm9ybWF0aW9uXG4gICAgICAgIC8vIG9uIGV2ZXJ5IHBoYXNlLlxuICAgICAgICAub24obmF0aXZlRXZlbnQuc3RhcnQgKyAnICcgKyBuYXRpdmVFdmVudC5lbmQsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgLy8gSGFuZGxlIHRoZSBldmVudCBzeXN0ZW0gb2YgdG91Y2hzY3JlZW4gZGV2aWNlcy5cbiAgICAgICAgICBldmVudERhdGEuZXZlbnQgPSBldmVudC5vcmlnaW5hbEV2ZW50LmNoYW5nZWRUb3VjaGVzID8gZXZlbnQub3JpZ2luYWxFdmVudC5jaGFuZ2VkVG91Y2hlc1swXSA6IGV2ZW50O1xuICAgICAgICB9KVxuICAgICAgICAub24obmF0aXZlRXZlbnQuc3RhcnQsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgICAgLy8gU3RvcCBleGVjdXRpb24gaWYgYW4gZXZlbnQgaXMgc2ltdWxhdGVkLlxuICAgICAgICAgIGlmIChldmVudC53aGljaCAmJiBldmVudC53aGljaCAhPT0gMSkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cblxuICAgICAgICAgIGV2ZW50RGF0YS50YXJnZXQgPSBldmVudC50YXJnZXQ7XG4gICAgICAgICAgZXZlbnREYXRhLnBhZ2VYID0gZXZlbnREYXRhLmV2ZW50LnBhZ2VYO1xuICAgICAgICAgIGV2ZW50RGF0YS5wYWdlWSA9IGV2ZW50RGF0YS5ldmVudC5wYWdlWTtcbiAgICAgICAgICBldmVudERhdGEudGltZSA9IGdldFRpbWUoKTtcbiAgICAgICAgfSlcbiAgICAgICAgLm9uKG5hdGl2ZUV2ZW50LmVuZCwgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgICAvLyBDb21wYXJlIHByb3BlcnRpZXMgZnJvbSB0d28gcGhhc2VzLlxuICAgICAgICAgIGlmIChcbiAgICAgICAgICAgIC8vIFRoZSB0YXJnZXQgc2hvdWxkIGJlIHRoZSBzYW1lLlxuICAgICAgICAgICAgZXZlbnREYXRhLnRhcmdldCA9PT0gZXZlbnQudGFyZ2V0ICYmXG4gICAgICAgICAgICAvLyBUaW1lIGJldHdlZW4gZmlyc3QgYW5kIGxhc3QgcGhhc2VzIHNob3VsZCBiZSBsZXNzIHRoYW4gNzUwIG1zLlxuICAgICAgICAgICAgZ2V0VGltZSgpIC0gZXZlbnREYXRhLnRpbWUgPCA3NTAgJiZcbiAgICAgICAgICAgIC8vIENvb3JkaW5hdGVzLCB3aGVuIGV2ZW50IGVuZHMsIHNob3VsZCBiZSB0aGUgc2FtZSBhcyB0aGV5IHdlcmVcbiAgICAgICAgICAgIC8vIG9uIHN0YXJ0LlxuICAgICAgICAgICAgKFxuICAgICAgICAgICAgICBldmVudERhdGEucGFnZVggPT09IGV2ZW50RGF0YS5ldmVudC5wYWdlWCAmJlxuICAgICAgICAgICAgICBldmVudERhdGEucGFnZVkgPT09IGV2ZW50RGF0YS5ldmVudC5wYWdlWVxuICAgICAgICAgICAgKVxuICAgICAgICAgICkge1xuICAgICAgICAgICAgZXZlbnQudHlwZSA9IHNwZWNpYWxFdmVudE5hbWU7XG4gICAgICAgICAgICBldmVudC5wYWdlWCA9IGV2ZW50RGF0YS5ldmVudC5wYWdlWDtcbiAgICAgICAgICAgIGV2ZW50LnBhZ2VZID0gZXZlbnREYXRhLmV2ZW50LnBhZ2VZO1xuXG4gICAgICAgICAgICBldmVudEhhbmRsZS5jYWxsKHRoaXMsIGV2ZW50KTtcblxuICAgICAgICAgICAgLy8gSWYgYW4gZXZlbnQgd2Fzbid0IHByZXZlbnRlZCB0aGVuIGV4ZWN1dGUgb3JpZ2luYWwgYWN0aW9ucy5cbiAgICAgICAgICAgIGlmICghZXZlbnQuaXNEZWZhdWx0UHJldmVudGVkKCkpIHtcbiAgICAgICAgICAgICAgJGVsZW1lbnRcbiAgICAgICAgICAgICAgICAvLyBSZW1vdmUgcHJldmVudGlvbiBvZiBkZWZhdWx0IGFjdGlvbnMuXG4gICAgICAgICAgICAgICAgLm9mZihuYXRpdmVFdmVudC5vcmlnaW5hbClcbiAgICAgICAgICAgICAgICAvLyBCcmluZyB0aGUgYWN0aW9uLlxuICAgICAgICAgICAgICAgIC50cmlnZ2VyKG5hdGl2ZUV2ZW50Lm9yaWdpbmFsKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0sXG5cbiAgICByZW1vdmU6IGZ1bmN0aW9uKCkge1xuICAgICAgJCh0aGlzKS5vZmYobmF0aXZlRXZlbnQuc3RhcnQgKyAnICcgKyBuYXRpdmVFdmVudC5lbmQpO1xuICAgIH1cbiAgfTtcblxuICAkLmZuW3NwZWNpYWxFdmVudE5hbWVdID0gZnVuY3Rpb24oZm4pIHtcbiAgICByZXR1cm4gdGhpc1tmbiA/ICdvbicgOiAndHJpZ2dlciddKHNwZWNpYWxFdmVudE5hbWUsIGZuKTtcbiAgfTtcbn0pKGpRdWVyeSwgJ3RhcCcpO1xuIiwiLypcbiAqIFRvdGFsU3RvcmFnZVxuICpcbiAqIENvcHlyaWdodCAoYykgMjAxMiBKYXJlZCBOb3ZhY2sgJiBVcHN0YXRlbWVudCAodXBzdGF0ZW1lbnQuY29tKVxuICogRHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGFuZCBHUEwgbGljZW5zZXM6XG4gKiBodHRwOi8vd3d3Lm9wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL21pdC1saWNlbnNlLnBocFxuICogaHR0cDovL3d3dy5nbnUub3JnL2xpY2Vuc2VzL2dwbC5odG1sXG4gKlxuICogVG90YWwgU3RvcmFnZSBpcyB0aGUgY29uY2VwdHVhbCB0aGUgbG92ZSBjaGlsZCBvZiBqU3RvcmFnZSBieSBBbmRyaXMgUmVpbm1hbiwgXG4gKiBhbmQgQ29va2llIGJ5IEtsYXVzIEhhcnRsIC0tIHRob3VnaCB0aGlzIGlzIG5vdCBjb25uZWN0ZWQgdG8gZWl0aGVyIHByb2plY3QuXG4gKlxuICogQG5hbWUgJC50b3RhbFN0b3JhZ2VcbiAqIEBjYXQgUGx1Z2lucy9Db29raWVcbiAqIEBhdXRob3IgSmFyZWQgTm92YWNrL2phcmVkQHVwc3RhdGVtZW50LmNvbVxuICogQHZlcnNpb24gMS4xLjJcbiAqIEB1cmwgaHR0cDovL3Vwc3RhdGVtZW50LmNvbS9ibG9nLzIwMTIvMDEvanF1ZXJ5LWxvY2FsLXN0b3JhZ2UtZG9uZS1yaWdodC1hbmQtZWFzeS9cbiAqL1xuXG4oZnVuY3Rpb24oYyl7dmFyIGU9d2luZG93LmxvY2FsU3RvcmFnZSxmO2Y9XCJ1bmRlZmluZWRcIj09dHlwZW9mIGV8fFwidW5kZWZpbmVkXCI9PXR5cGVvZiB3aW5kb3cuSlNPTj8hMTohMDtjLnRvdGFsU3RvcmFnZT1mdW5jdGlvbihiLGEpe3JldHVybiBjLnRvdGFsU3RvcmFnZS5pbXBsLmluaXQoYixhKX07Yy50b3RhbFN0b3JhZ2Uuc2V0SXRlbT1mdW5jdGlvbihiLGEpe3JldHVybiBjLnRvdGFsU3RvcmFnZS5pbXBsLnNldEl0ZW0oYixhKX07Yy50b3RhbFN0b3JhZ2UuZ2V0SXRlbT1mdW5jdGlvbihiKXtyZXR1cm4gYy50b3RhbFN0b3JhZ2UuaW1wbC5nZXRJdGVtKGIpfTtjLnRvdGFsU3RvcmFnZS5nZXRBbGw9ZnVuY3Rpb24oKXtyZXR1cm4gYy50b3RhbFN0b3JhZ2UuaW1wbC5nZXRBbGwoKX07Yy50b3RhbFN0b3JhZ2UuZGVsZXRlSXRlbT1mdW5jdGlvbihiKXtyZXR1cm4gYy50b3RhbFN0b3JhZ2UuaW1wbC5kZWxldGVJdGVtKGIpfTtjLnRvdGFsU3RvcmFnZS5pbXBsPXtpbml0OmZ1bmN0aW9uKGIsIGEpe3JldHVyblwidW5kZWZpbmVkXCIhPXR5cGVvZiBhP3RoaXMuc2V0SXRlbShiLGEpOnRoaXMuZ2V0SXRlbShiKX0sc2V0SXRlbTpmdW5jdGlvbihiLGEpe2lmKCFmKXRyeXtyZXR1cm4gYy5jb29raWUoYixhKSxhfWNhdGNoKGQpe2NvbnNvbGUubG9nKFwiTG9jYWwgU3RvcmFnZSBub3Qgc3VwcG9ydGVkIGJ5IHRoaXMgYnJvd3Nlci4gSW5zdGFsbCB0aGUgY29va2llIHBsdWdpbiBvbiB5b3VyIHNpdGUgdG8gdGFrZSBhZHZhbnRhZ2Ugb2YgdGhlIHNhbWUgZnVuY3Rpb25hbGl0eS4gWW91IGNhbiBnZXQgaXQgYXQgaHR0cHM6Ly9naXRodWIuY29tL2NhcmhhcnRsL2pxdWVyeS1jb29raWVcIil9dmFyIGc9SlNPTi5zdHJpbmdpZnkoYSk7ZS5zZXRJdGVtKGIsZyk7cmV0dXJuIHRoaXMucGFyc2VSZXN1bHQoZyl9LGdldEl0ZW06ZnVuY3Rpb24oYil7aWYoIWYpdHJ5e3JldHVybiB0aGlzLnBhcnNlUmVzdWx0KGMuY29va2llKGIpKX1jYXRjaChhKXtyZXR1cm4gbnVsbH1yZXR1cm4gdGhpcy5wYXJzZVJlc3VsdChlLmdldEl0ZW0oYikpfSwgZGVsZXRlSXRlbTpmdW5jdGlvbihiKXtpZighZil0cnl7cmV0dXJuIGMuY29va2llKGIsbnVsbCksITB9Y2F0Y2goYSl7cmV0dXJuITF9ZS5yZW1vdmVJdGVtKGIpO3JldHVybiEwfSxnZXRBbGw6ZnVuY3Rpb24oKXt2YXIgYj1bXTtpZihmKWZvcihkIGluIGUpZC5sZW5ndGgmJmIucHVzaCh7a2V5OmQsdmFsdWU6dGhpcy5wYXJzZVJlc3VsdChlLmdldEl0ZW0oZCkpfSk7ZWxzZSB0cnl7Zm9yKHZhciBhPWRvY3VtZW50LmNvb2tpZS5zcGxpdChcIjtcIiksZD0wO2Q8YS5sZW5ndGg7ZCsrKXt2YXIgZz1hW2RdLnNwbGl0KFwiPVwiKVswXTtiLnB1c2goe2tleTpnLHZhbHVlOnRoaXMucGFyc2VSZXN1bHQoYy5jb29raWUoZykpfSl9fWNhdGNoKGgpe3JldHVybiBudWxsfXJldHVybiBifSxwYXJzZVJlc3VsdDpmdW5jdGlvbihiKXt2YXIgYTt0cnl7YT1KU09OLnBhcnNlKGIpLFwidHJ1ZVwiPT1hJiYoYT0hMCksXCJmYWxzZVwiPT1hJiYoYT0hMSkscGFyc2VGbG9hdChhKT09YSYmXCJvYmplY3RcIiE9dHlwZW9mIGEmJiAoYT1wYXJzZUZsb2F0KGEpKX1jYXRjaChjKXt9cmV0dXJuIGF9fX0pKGpRdWVyeSk7IiwiLyohXG4gKiBqUXVlcnkgVmFsaWRhdGlvbiBQbHVnaW4gdjEuMTMuMVxuICpcbiAqIGh0dHA6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9cbiAqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTQgSsO2cm4gWmFlZmZlcmVyXG4gKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2VcbiAqL1xuKGZ1bmN0aW9uKCBmYWN0b3J5ICkge1xuXHRpZiAoIHR5cGVvZiBkZWZpbmUgPT09IFwiZnVuY3Rpb25cIiAmJiBkZWZpbmUuYW1kICkge1xuXHRcdGRlZmluZSggW1wianF1ZXJ5XCJdLCBmYWN0b3J5ICk7XG5cdH0gZWxzZSB7XG5cdFx0ZmFjdG9yeSggalF1ZXJ5ICk7XG5cdH1cbn0oZnVuY3Rpb24oICQgKSB7XG5cbiQuZXh0ZW5kKCQuZm4sIHtcblx0Ly8gaHR0cDovL2pxdWVyeXZhbGlkYXRpb24ub3JnL3ZhbGlkYXRlL1xuXHR2YWxpZGF0ZTogZnVuY3Rpb24oIG9wdGlvbnMgKSB7XG5cblx0XHQvLyBpZiBub3RoaW5nIGlzIHNlbGVjdGVkLCByZXR1cm4gbm90aGluZzsgY2FuJ3QgY2hhaW4gYW55d2F5XG5cdFx0aWYgKCAhdGhpcy5sZW5ndGggKSB7XG5cdFx0XHRpZiAoIG9wdGlvbnMgJiYgb3B0aW9ucy5kZWJ1ZyAmJiB3aW5kb3cuY29uc29sZSApIHtcblx0XHRcdFx0Y29uc29sZS53YXJuKCBcIk5vdGhpbmcgc2VsZWN0ZWQsIGNhbid0IHZhbGlkYXRlLCByZXR1cm5pbmcgbm90aGluZy5cIiApO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuO1xuXHRcdH1cblxuXHRcdC8vIGNoZWNrIGlmIGEgdmFsaWRhdG9yIGZvciB0aGlzIGZvcm0gd2FzIGFscmVhZHkgY3JlYXRlZFxuXHRcdHZhciB2YWxpZGF0b3IgPSAkLmRhdGEoIHRoaXNbIDAgXSwgXCJ2YWxpZGF0b3JcIiApO1xuXHRcdGlmICggdmFsaWRhdG9yICkge1xuXHRcdFx0cmV0dXJuIHZhbGlkYXRvcjtcblx0XHR9XG5cblx0XHQvLyBBZGQgbm92YWxpZGF0ZSB0YWcgaWYgSFRNTDUuXG5cdFx0dGhpcy5hdHRyKCBcIm5vdmFsaWRhdGVcIiwgXCJub3ZhbGlkYXRlXCIgKTtcblxuXHRcdHZhbGlkYXRvciA9IG5ldyAkLnZhbGlkYXRvciggb3B0aW9ucywgdGhpc1sgMCBdICk7XG5cdFx0JC5kYXRhKCB0aGlzWyAwIF0sIFwidmFsaWRhdG9yXCIsIHZhbGlkYXRvciApO1xuXG5cdFx0aWYgKCB2YWxpZGF0b3Iuc2V0dGluZ3Mub25zdWJtaXQgKSB7XG5cblx0XHRcdHRoaXMudmFsaWRhdGVEZWxlZ2F0ZSggXCI6c3VibWl0XCIsIFwiY2xpY2tcIiwgZnVuY3Rpb24oIGV2ZW50ICkge1xuXHRcdFx0XHRpZiAoIHZhbGlkYXRvci5zZXR0aW5ncy5zdWJtaXRIYW5kbGVyICkge1xuXHRcdFx0XHRcdHZhbGlkYXRvci5zdWJtaXRCdXR0b24gPSBldmVudC50YXJnZXQ7XG5cdFx0XHRcdH1cblx0XHRcdFx0Ly8gYWxsb3cgc3VwcHJlc3NpbmcgdmFsaWRhdGlvbiBieSBhZGRpbmcgYSBjYW5jZWwgY2xhc3MgdG8gdGhlIHN1Ym1pdCBidXR0b25cblx0XHRcdFx0aWYgKCAkKCBldmVudC50YXJnZXQgKS5oYXNDbGFzcyggXCJjYW5jZWxcIiApICkge1xuXHRcdFx0XHRcdHZhbGlkYXRvci5jYW5jZWxTdWJtaXQgPSB0cnVlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gYWxsb3cgc3VwcHJlc3NpbmcgdmFsaWRhdGlvbiBieSBhZGRpbmcgdGhlIGh0bWw1IGZvcm1ub3ZhbGlkYXRlIGF0dHJpYnV0ZSB0byB0aGUgc3VibWl0IGJ1dHRvblxuXHRcdFx0XHRpZiAoICQoIGV2ZW50LnRhcmdldCApLmF0dHIoIFwiZm9ybW5vdmFsaWRhdGVcIiApICE9PSB1bmRlZmluZWQgKSB7XG5cdFx0XHRcdFx0dmFsaWRhdG9yLmNhbmNlbFN1Ym1pdCA9IHRydWU7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHQvLyB2YWxpZGF0ZSB0aGUgZm9ybSBvbiBzdWJtaXRcblx0XHRcdHRoaXMuc3VibWl0KCBmdW5jdGlvbiggZXZlbnQgKSB7XG5cdFx0XHRcdGlmICggdmFsaWRhdG9yLnNldHRpbmdzLmRlYnVnICkge1xuXHRcdFx0XHRcdC8vIHByZXZlbnQgZm9ybSBzdWJtaXQgdG8gYmUgYWJsZSB0byBzZWUgY29uc29sZSBvdXRwdXRcblx0XHRcdFx0XHRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGZ1bmN0aW9uIGhhbmRsZSgpIHtcblx0XHRcdFx0XHR2YXIgaGlkZGVuLCByZXN1bHQ7XG5cdFx0XHRcdFx0aWYgKCB2YWxpZGF0b3Iuc2V0dGluZ3Muc3VibWl0SGFuZGxlciApIHtcblx0XHRcdFx0XHRcdGlmICggdmFsaWRhdG9yLnN1Ym1pdEJ1dHRvbiApIHtcblx0XHRcdFx0XHRcdFx0Ly8gaW5zZXJ0IGEgaGlkZGVuIGlucHV0IGFzIGEgcmVwbGFjZW1lbnQgZm9yIHRoZSBtaXNzaW5nIHN1Ym1pdCBidXR0b25cblx0XHRcdFx0XHRcdFx0aGlkZGVuID0gJCggXCI8aW5wdXQgdHlwZT0naGlkZGVuJy8+XCIgKVxuXHRcdFx0XHRcdFx0XHRcdC5hdHRyKCBcIm5hbWVcIiwgdmFsaWRhdG9yLnN1Ym1pdEJ1dHRvbi5uYW1lIClcblx0XHRcdFx0XHRcdFx0XHQudmFsKCAkKCB2YWxpZGF0b3Iuc3VibWl0QnV0dG9uICkudmFsKCkgKVxuXHRcdFx0XHRcdFx0XHRcdC5hcHBlbmRUbyggdmFsaWRhdG9yLmN1cnJlbnRGb3JtICk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXN1bHQgPSB2YWxpZGF0b3Iuc2V0dGluZ3Muc3VibWl0SGFuZGxlci5jYWxsKCB2YWxpZGF0b3IsIHZhbGlkYXRvci5jdXJyZW50Rm9ybSwgZXZlbnQgKTtcblx0XHRcdFx0XHRcdGlmICggdmFsaWRhdG9yLnN1Ym1pdEJ1dHRvbiApIHtcblx0XHRcdFx0XHRcdFx0Ly8gYW5kIGNsZWFuIHVwIGFmdGVyd2FyZHM7IHRoYW5rcyB0byBuby1ibG9jay1zY29wZSwgaGlkZGVuIGNhbiBiZSByZWZlcmVuY2VkXG5cdFx0XHRcdFx0XHRcdGhpZGRlbi5yZW1vdmUoKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdGlmICggcmVzdWx0ICE9PSB1bmRlZmluZWQgKSB7XG5cdFx0XHRcdFx0XHRcdHJldHVybiByZXN1bHQ7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gcHJldmVudCBzdWJtaXQgZm9yIGludmFsaWQgZm9ybXMgb3IgY3VzdG9tIHN1Ym1pdCBoYW5kbGVyc1xuXHRcdFx0XHRpZiAoIHZhbGlkYXRvci5jYW5jZWxTdWJtaXQgKSB7XG5cdFx0XHRcdFx0dmFsaWRhdG9yLmNhbmNlbFN1Ym1pdCA9IGZhbHNlO1xuXHRcdFx0XHRcdHJldHVybiBoYW5kbGUoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRpZiAoIHZhbGlkYXRvci5mb3JtKCkgKSB7XG5cdFx0XHRcdFx0aWYgKCB2YWxpZGF0b3IucGVuZGluZ1JlcXVlc3QgKSB7XG5cdFx0XHRcdFx0XHR2YWxpZGF0b3IuZm9ybVN1Ym1pdHRlZCA9IHRydWU7XG5cdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHJldHVybiBoYW5kbGUoKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR2YWxpZGF0b3IuZm9jdXNJbnZhbGlkKCk7XG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cblx0XHRyZXR1cm4gdmFsaWRhdG9yO1xuXHR9LFxuXHQvLyBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvdmFsaWQvXG5cdHZhbGlkOiBmdW5jdGlvbigpIHtcblx0XHR2YXIgdmFsaWQsIHZhbGlkYXRvcjtcblxuXHRcdGlmICggJCggdGhpc1sgMCBdICkuaXMoIFwiZm9ybVwiICkgKSB7XG5cdFx0XHR2YWxpZCA9IHRoaXMudmFsaWRhdGUoKS5mb3JtKCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHZhbGlkID0gdHJ1ZTtcblx0XHRcdHZhbGlkYXRvciA9ICQoIHRoaXNbIDAgXS5mb3JtICkudmFsaWRhdGUoKTtcblx0XHRcdHRoaXMuZWFjaCggZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHZhbGlkID0gdmFsaWRhdG9yLmVsZW1lbnQoIHRoaXMgKSAmJiB2YWxpZDtcblx0XHRcdH0pO1xuXHRcdH1cblx0XHRyZXR1cm4gdmFsaWQ7XG5cdH0sXG5cdC8vIGF0dHJpYnV0ZXM6IHNwYWNlIHNlcGFyYXRlZCBsaXN0IG9mIGF0dHJpYnV0ZXMgdG8gcmV0cmlldmUgYW5kIHJlbW92ZVxuXHRyZW1vdmVBdHRyczogZnVuY3Rpb24oIGF0dHJpYnV0ZXMgKSB7XG5cdFx0dmFyIHJlc3VsdCA9IHt9LFxuXHRcdFx0JGVsZW1lbnQgPSB0aGlzO1xuXHRcdCQuZWFjaCggYXR0cmlidXRlcy5zcGxpdCggL1xccy8gKSwgZnVuY3Rpb24oIGluZGV4LCB2YWx1ZSApIHtcblx0XHRcdHJlc3VsdFsgdmFsdWUgXSA9ICRlbGVtZW50LmF0dHIoIHZhbHVlICk7XG5cdFx0XHQkZWxlbWVudC5yZW1vdmVBdHRyKCB2YWx1ZSApO1xuXHRcdH0pO1xuXHRcdHJldHVybiByZXN1bHQ7XG5cdH0sXG5cdC8vIGh0dHA6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9ydWxlcy9cblx0cnVsZXM6IGZ1bmN0aW9uKCBjb21tYW5kLCBhcmd1bWVudCApIHtcblx0XHR2YXIgZWxlbWVudCA9IHRoaXNbIDAgXSxcblx0XHRcdHNldHRpbmdzLCBzdGF0aWNSdWxlcywgZXhpc3RpbmdSdWxlcywgZGF0YSwgcGFyYW0sIGZpbHRlcmVkO1xuXG5cdFx0aWYgKCBjb21tYW5kICkge1xuXHRcdFx0c2V0dGluZ3MgPSAkLmRhdGEoIGVsZW1lbnQuZm9ybSwgXCJ2YWxpZGF0b3JcIiApLnNldHRpbmdzO1xuXHRcdFx0c3RhdGljUnVsZXMgPSBzZXR0aW5ncy5ydWxlcztcblx0XHRcdGV4aXN0aW5nUnVsZXMgPSAkLnZhbGlkYXRvci5zdGF0aWNSdWxlcyggZWxlbWVudCApO1xuXHRcdFx0c3dpdGNoICggY29tbWFuZCApIHtcblx0XHRcdGNhc2UgXCJhZGRcIjpcblx0XHRcdFx0JC5leHRlbmQoIGV4aXN0aW5nUnVsZXMsICQudmFsaWRhdG9yLm5vcm1hbGl6ZVJ1bGUoIGFyZ3VtZW50ICkgKTtcblx0XHRcdFx0Ly8gcmVtb3ZlIG1lc3NhZ2VzIGZyb20gcnVsZXMsIGJ1dCBhbGxvdyB0aGVtIHRvIGJlIHNldCBzZXBhcmF0ZWx5XG5cdFx0XHRcdGRlbGV0ZSBleGlzdGluZ1J1bGVzLm1lc3NhZ2VzO1xuXHRcdFx0XHRzdGF0aWNSdWxlc1sgZWxlbWVudC5uYW1lIF0gPSBleGlzdGluZ1J1bGVzO1xuXHRcdFx0XHRpZiAoIGFyZ3VtZW50Lm1lc3NhZ2VzICkge1xuXHRcdFx0XHRcdHNldHRpbmdzLm1lc3NhZ2VzWyBlbGVtZW50Lm5hbWUgXSA9ICQuZXh0ZW5kKCBzZXR0aW5ncy5tZXNzYWdlc1sgZWxlbWVudC5uYW1lIF0sIGFyZ3VtZW50Lm1lc3NhZ2VzICk7XG5cdFx0XHRcdH1cblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRjYXNlIFwicmVtb3ZlXCI6XG5cdFx0XHRcdGlmICggIWFyZ3VtZW50ICkge1xuXHRcdFx0XHRcdGRlbGV0ZSBzdGF0aWNSdWxlc1sgZWxlbWVudC5uYW1lIF07XG5cdFx0XHRcdFx0cmV0dXJuIGV4aXN0aW5nUnVsZXM7XG5cdFx0XHRcdH1cblx0XHRcdFx0ZmlsdGVyZWQgPSB7fTtcblx0XHRcdFx0JC5lYWNoKCBhcmd1bWVudC5zcGxpdCggL1xccy8gKSwgZnVuY3Rpb24oIGluZGV4LCBtZXRob2QgKSB7XG5cdFx0XHRcdFx0ZmlsdGVyZWRbIG1ldGhvZCBdID0gZXhpc3RpbmdSdWxlc1sgbWV0aG9kIF07XG5cdFx0XHRcdFx0ZGVsZXRlIGV4aXN0aW5nUnVsZXNbIG1ldGhvZCBdO1xuXHRcdFx0XHRcdGlmICggbWV0aG9kID09PSBcInJlcXVpcmVkXCIgKSB7XG5cdFx0XHRcdFx0XHQkKCBlbGVtZW50ICkucmVtb3ZlQXR0ciggXCJhcmlhLXJlcXVpcmVkXCIgKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0XHRyZXR1cm4gZmlsdGVyZWQ7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0ZGF0YSA9ICQudmFsaWRhdG9yLm5vcm1hbGl6ZVJ1bGVzKFxuXHRcdCQuZXh0ZW5kKFxuXHRcdFx0e30sXG5cdFx0XHQkLnZhbGlkYXRvci5jbGFzc1J1bGVzKCBlbGVtZW50ICksXG5cdFx0XHQkLnZhbGlkYXRvci5hdHRyaWJ1dGVSdWxlcyggZWxlbWVudCApLFxuXHRcdFx0JC52YWxpZGF0b3IuZGF0YVJ1bGVzKCBlbGVtZW50ICksXG5cdFx0XHQkLnZhbGlkYXRvci5zdGF0aWNSdWxlcyggZWxlbWVudCApXG5cdFx0KSwgZWxlbWVudCApO1xuXG5cdFx0Ly8gbWFrZSBzdXJlIHJlcXVpcmVkIGlzIGF0IGZyb250XG5cdFx0aWYgKCBkYXRhLnJlcXVpcmVkICkge1xuXHRcdFx0cGFyYW0gPSBkYXRhLnJlcXVpcmVkO1xuXHRcdFx0ZGVsZXRlIGRhdGEucmVxdWlyZWQ7XG5cdFx0XHRkYXRhID0gJC5leHRlbmQoIHsgcmVxdWlyZWQ6IHBhcmFtIH0sIGRhdGEgKTtcblx0XHRcdCQoIGVsZW1lbnQgKS5hdHRyKCBcImFyaWEtcmVxdWlyZWRcIiwgXCJ0cnVlXCIgKTtcblx0XHR9XG5cblx0XHQvLyBtYWtlIHN1cmUgcmVtb3RlIGlzIGF0IGJhY2tcblx0XHRpZiAoIGRhdGEucmVtb3RlICkge1xuXHRcdFx0cGFyYW0gPSBkYXRhLnJlbW90ZTtcblx0XHRcdGRlbGV0ZSBkYXRhLnJlbW90ZTtcblx0XHRcdGRhdGEgPSAkLmV4dGVuZCggZGF0YSwgeyByZW1vdGU6IHBhcmFtIH0pO1xuXHRcdH1cblxuXHRcdHJldHVybiBkYXRhO1xuXHR9XG59KTtcblxuLy8gQ3VzdG9tIHNlbGVjdG9yc1xuJC5leHRlbmQoICQuZXhwclsgXCI6XCIgXSwge1xuXHQvLyBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvYmxhbmstc2VsZWN0b3IvXG5cdGJsYW5rOiBmdW5jdGlvbiggYSApIHtcblx0XHRyZXR1cm4gISQudHJpbSggXCJcIiArICQoIGEgKS52YWwoKSApO1xuXHR9LFxuXHQvLyBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvZmlsbGVkLXNlbGVjdG9yL1xuXHRmaWxsZWQ6IGZ1bmN0aW9uKCBhICkge1xuXHRcdHJldHVybiAhISQudHJpbSggXCJcIiArICQoIGEgKS52YWwoKSApO1xuXHR9LFxuXHQvLyBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvdW5jaGVja2VkLXNlbGVjdG9yL1xuXHR1bmNoZWNrZWQ6IGZ1bmN0aW9uKCBhICkge1xuXHRcdHJldHVybiAhJCggYSApLnByb3AoIFwiY2hlY2tlZFwiICk7XG5cdH1cbn0pO1xuXG4vLyBjb25zdHJ1Y3RvciBmb3IgdmFsaWRhdG9yXG4kLnZhbGlkYXRvciA9IGZ1bmN0aW9uKCBvcHRpb25zLCBmb3JtICkge1xuXHR0aGlzLnNldHRpbmdzID0gJC5leHRlbmQoIHRydWUsIHt9LCAkLnZhbGlkYXRvci5kZWZhdWx0cywgb3B0aW9ucyApO1xuXHR0aGlzLmN1cnJlbnRGb3JtID0gZm9ybTtcblx0dGhpcy5pbml0KCk7XG59O1xuXG4vLyBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvalF1ZXJ5LnZhbGlkYXRvci5mb3JtYXQvXG4kLnZhbGlkYXRvci5mb3JtYXQgPSBmdW5jdGlvbiggc291cmNlLCBwYXJhbXMgKSB7XG5cdGlmICggYXJndW1lbnRzLmxlbmd0aCA9PT0gMSApIHtcblx0XHRyZXR1cm4gZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgYXJncyA9ICQubWFrZUFycmF5KCBhcmd1bWVudHMgKTtcblx0XHRcdGFyZ3MudW5zaGlmdCggc291cmNlICk7XG5cdFx0XHRyZXR1cm4gJC52YWxpZGF0b3IuZm9ybWF0LmFwcGx5KCB0aGlzLCBhcmdzICk7XG5cdFx0fTtcblx0fVxuXHRpZiAoIGFyZ3VtZW50cy5sZW5ndGggPiAyICYmIHBhcmFtcy5jb25zdHJ1Y3RvciAhPT0gQXJyYXkgICkge1xuXHRcdHBhcmFtcyA9ICQubWFrZUFycmF5KCBhcmd1bWVudHMgKS5zbGljZSggMSApO1xuXHR9XG5cdGlmICggcGFyYW1zLmNvbnN0cnVjdG9yICE9PSBBcnJheSApIHtcblx0XHRwYXJhbXMgPSBbIHBhcmFtcyBdO1xuXHR9XG5cdCQuZWFjaCggcGFyYW1zLCBmdW5jdGlvbiggaSwgbiApIHtcblx0XHRzb3VyY2UgPSBzb3VyY2UucmVwbGFjZSggbmV3IFJlZ0V4cCggXCJcXFxce1wiICsgaSArIFwiXFxcXH1cIiwgXCJnXCIgKSwgZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gbjtcblx0XHR9KTtcblx0fSk7XG5cdHJldHVybiBzb3VyY2U7XG59O1xuXG4kLmV4dGVuZCggJC52YWxpZGF0b3IsIHtcblxuXHRkZWZhdWx0czoge1xuXHRcdG1lc3NhZ2VzOiB7fSxcblx0XHRncm91cHM6IHt9LFxuXHRcdHJ1bGVzOiB7fSxcblx0XHRlcnJvckNsYXNzOiBcImVycm9yXCIsXG5cdFx0dmFsaWRDbGFzczogXCJ2YWxpZFwiLFxuXHRcdGVycm9yRWxlbWVudDogXCJsYWJlbFwiLFxuXHRcdGZvY3VzQ2xlYW51cDogZmFsc2UsXG5cdFx0Zm9jdXNJbnZhbGlkOiB0cnVlLFxuXHRcdGVycm9yQ29udGFpbmVyOiAkKCBbXSApLFxuXHRcdGVycm9yTGFiZWxDb250YWluZXI6ICQoIFtdICksXG5cdFx0b25zdWJtaXQ6IHRydWUsXG5cdFx0aWdub3JlOiBcIjpoaWRkZW5cIixcblx0XHRpZ25vcmVUaXRsZTogZmFsc2UsXG5cdFx0b25mb2N1c2luOiBmdW5jdGlvbiggZWxlbWVudCApIHtcblx0XHRcdHRoaXMubGFzdEFjdGl2ZSA9IGVsZW1lbnQ7XG5cblx0XHRcdC8vIEhpZGUgZXJyb3IgbGFiZWwgYW5kIHJlbW92ZSBlcnJvciBjbGFzcyBvbiBmb2N1cyBpZiBlbmFibGVkXG5cdFx0XHRpZiAoIHRoaXMuc2V0dGluZ3MuZm9jdXNDbGVhbnVwICkge1xuXHRcdFx0XHRpZiAoIHRoaXMuc2V0dGluZ3MudW5oaWdobGlnaHQgKSB7XG5cdFx0XHRcdFx0dGhpcy5zZXR0aW5ncy51bmhpZ2hsaWdodC5jYWxsKCB0aGlzLCBlbGVtZW50LCB0aGlzLnNldHRpbmdzLmVycm9yQ2xhc3MsIHRoaXMuc2V0dGluZ3MudmFsaWRDbGFzcyApO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHRoaXMuaGlkZVRoZXNlKCB0aGlzLmVycm9yc0ZvciggZWxlbWVudCApICk7XG5cdFx0XHR9XG5cdFx0fSxcblx0XHRvbmZvY3Vzb3V0OiBmdW5jdGlvbiggZWxlbWVudCApIHtcblx0XHRcdGlmICggIXRoaXMuY2hlY2thYmxlKCBlbGVtZW50ICkgJiYgKCBlbGVtZW50Lm5hbWUgaW4gdGhpcy5zdWJtaXR0ZWQgfHwgIXRoaXMub3B0aW9uYWwoIGVsZW1lbnQgKSApICkge1xuXHRcdFx0XHR0aGlzLmVsZW1lbnQoIGVsZW1lbnQgKTtcblx0XHRcdH1cblx0XHR9LFxuXHRcdG9ua2V5dXA6IGZ1bmN0aW9uKCBlbGVtZW50LCBldmVudCApIHtcblx0XHRcdGlmICggZXZlbnQud2hpY2ggPT09IDkgJiYgdGhpcy5lbGVtZW50VmFsdWUoIGVsZW1lbnQgKSA9PT0gXCJcIiApIHtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fSBlbHNlIGlmICggZWxlbWVudC5uYW1lIGluIHRoaXMuc3VibWl0dGVkIHx8IGVsZW1lbnQgPT09IHRoaXMubGFzdEVsZW1lbnQgKSB7XG5cdFx0XHRcdHRoaXMuZWxlbWVudCggZWxlbWVudCApO1xuXHRcdFx0fVxuXHRcdH0sXG5cdFx0b25jbGljazogZnVuY3Rpb24oIGVsZW1lbnQgKSB7XG5cdFx0XHQvLyBjbGljayBvbiBzZWxlY3RzLCByYWRpb2J1dHRvbnMgYW5kIGNoZWNrYm94ZXNcblx0XHRcdGlmICggZWxlbWVudC5uYW1lIGluIHRoaXMuc3VibWl0dGVkICkge1xuXHRcdFx0XHR0aGlzLmVsZW1lbnQoIGVsZW1lbnQgKTtcblxuXHRcdFx0Ly8gb3Igb3B0aW9uIGVsZW1lbnRzLCBjaGVjayBwYXJlbnQgc2VsZWN0IGluIHRoYXQgY2FzZVxuXHRcdFx0fSBlbHNlIGlmICggZWxlbWVudC5wYXJlbnROb2RlLm5hbWUgaW4gdGhpcy5zdWJtaXR0ZWQgKSB7XG5cdFx0XHRcdHRoaXMuZWxlbWVudCggZWxlbWVudC5wYXJlbnROb2RlICk7XG5cdFx0XHR9XG5cdFx0fSxcblx0XHRoaWdobGlnaHQ6IGZ1bmN0aW9uKCBlbGVtZW50LCBlcnJvckNsYXNzLCB2YWxpZENsYXNzICkge1xuXHRcdFx0aWYgKCBlbGVtZW50LnR5cGUgPT09IFwicmFkaW9cIiApIHtcblx0XHRcdFx0dGhpcy5maW5kQnlOYW1lKCBlbGVtZW50Lm5hbWUgKS5hZGRDbGFzcyggZXJyb3JDbGFzcyApLnJlbW92ZUNsYXNzKCB2YWxpZENsYXNzICk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQkKCBlbGVtZW50ICkuYWRkQ2xhc3MoIGVycm9yQ2xhc3MgKS5yZW1vdmVDbGFzcyggdmFsaWRDbGFzcyApO1xuXHRcdFx0fVxuXHRcdH0sXG5cdFx0dW5oaWdobGlnaHQ6IGZ1bmN0aW9uKCBlbGVtZW50LCBlcnJvckNsYXNzLCB2YWxpZENsYXNzICkge1xuXHRcdFx0aWYgKCBlbGVtZW50LnR5cGUgPT09IFwicmFkaW9cIiApIHtcblx0XHRcdFx0dGhpcy5maW5kQnlOYW1lKCBlbGVtZW50Lm5hbWUgKS5yZW1vdmVDbGFzcyggZXJyb3JDbGFzcyApLmFkZENsYXNzKCB2YWxpZENsYXNzICk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQkKCBlbGVtZW50ICkucmVtb3ZlQ2xhc3MoIGVycm9yQ2xhc3MgKS5hZGRDbGFzcyggdmFsaWRDbGFzcyApO1xuXHRcdFx0fVxuXHRcdH1cblx0fSxcblxuXHQvLyBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvalF1ZXJ5LnZhbGlkYXRvci5zZXREZWZhdWx0cy9cblx0c2V0RGVmYXVsdHM6IGZ1bmN0aW9uKCBzZXR0aW5ncyApIHtcblx0XHQkLmV4dGVuZCggJC52YWxpZGF0b3IuZGVmYXVsdHMsIHNldHRpbmdzICk7XG5cdH0sXG5cblx0bWVzc2FnZXM6IHtcblx0XHRyZXF1aXJlZDogXCJUaGlzIGZpZWxkIGlzIHJlcXVpcmVkLlwiLFxuXHRcdHJlbW90ZTogXCJQbGVhc2UgZml4IHRoaXMgZmllbGQuXCIsXG5cdFx0ZW1haWw6IFwiUGxlYXNlIGVudGVyIGEgdmFsaWQgZW1haWwgYWRkcmVzcy5cIixcblx0XHR1cmw6IFwiUGxlYXNlIGVudGVyIGEgdmFsaWQgVVJMLlwiLFxuXHRcdGRhdGU6IFwiUGxlYXNlIGVudGVyIGEgdmFsaWQgZGF0ZS5cIixcblx0XHRkYXRlSVNPOiBcIlBsZWFzZSBlbnRlciBhIHZhbGlkIGRhdGUgKCBJU08gKS5cIixcblx0XHRudW1iZXI6IFwiUGxlYXNlIGVudGVyIGEgdmFsaWQgbnVtYmVyLlwiLFxuXHRcdGRpZ2l0czogXCJQbGVhc2UgZW50ZXIgb25seSBkaWdpdHMuXCIsXG5cdFx0Y3JlZGl0Y2FyZDogXCJQbGVhc2UgZW50ZXIgYSB2YWxpZCBjcmVkaXQgY2FyZCBudW1iZXIuXCIsXG5cdFx0ZXF1YWxUbzogXCJQbGVhc2UgZW50ZXIgdGhlIHNhbWUgdmFsdWUgYWdhaW4uXCIsXG5cdFx0bWF4bGVuZ3RoOiAkLnZhbGlkYXRvci5mb3JtYXQoIFwiUGxlYXNlIGVudGVyIG5vIG1vcmUgdGhhbiB7MH0gY2hhcmFjdGVycy5cIiApLFxuXHRcdG1pbmxlbmd0aDogJC52YWxpZGF0b3IuZm9ybWF0KCBcIlBsZWFzZSBlbnRlciBhdCBsZWFzdCB7MH0gY2hhcmFjdGVycy5cIiApLFxuXHRcdHJhbmdlbGVuZ3RoOiAkLnZhbGlkYXRvci5mb3JtYXQoIFwiUGxlYXNlIGVudGVyIGEgdmFsdWUgYmV0d2VlbiB7MH0gYW5kIHsxfSBjaGFyYWN0ZXJzIGxvbmcuXCIgKSxcblx0XHRyYW5nZTogJC52YWxpZGF0b3IuZm9ybWF0KCBcIlBsZWFzZSBlbnRlciBhIHZhbHVlIGJldHdlZW4gezB9IGFuZCB7MX0uXCIgKSxcblx0XHRtYXg6ICQudmFsaWRhdG9yLmZvcm1hdCggXCJQbGVhc2UgZW50ZXIgYSB2YWx1ZSBsZXNzIHRoYW4gb3IgZXF1YWwgdG8gezB9LlwiICksXG5cdFx0bWluOiAkLnZhbGlkYXRvci5mb3JtYXQoIFwiUGxlYXNlIGVudGVyIGEgdmFsdWUgZ3JlYXRlciB0aGFuIG9yIGVxdWFsIHRvIHswfS5cIiApXG5cdH0sXG5cblx0YXV0b0NyZWF0ZVJhbmdlczogZmFsc2UsXG5cblx0cHJvdG90eXBlOiB7XG5cblx0XHRpbml0OiBmdW5jdGlvbigpIHtcblx0XHRcdHRoaXMubGFiZWxDb250YWluZXIgPSAkKCB0aGlzLnNldHRpbmdzLmVycm9yTGFiZWxDb250YWluZXIgKTtcblx0XHRcdHRoaXMuZXJyb3JDb250ZXh0ID0gdGhpcy5sYWJlbENvbnRhaW5lci5sZW5ndGggJiYgdGhpcy5sYWJlbENvbnRhaW5lciB8fCAkKCB0aGlzLmN1cnJlbnRGb3JtICk7XG5cdFx0XHR0aGlzLmNvbnRhaW5lcnMgPSAkKCB0aGlzLnNldHRpbmdzLmVycm9yQ29udGFpbmVyICkuYWRkKCB0aGlzLnNldHRpbmdzLmVycm9yTGFiZWxDb250YWluZXIgKTtcblx0XHRcdHRoaXMuc3VibWl0dGVkID0ge307XG5cdFx0XHR0aGlzLnZhbHVlQ2FjaGUgPSB7fTtcblx0XHRcdHRoaXMucGVuZGluZ1JlcXVlc3QgPSAwO1xuXHRcdFx0dGhpcy5wZW5kaW5nID0ge307XG5cdFx0XHR0aGlzLmludmFsaWQgPSB7fTtcblx0XHRcdHRoaXMucmVzZXQoKTtcblxuXHRcdFx0dmFyIGdyb3VwcyA9ICggdGhpcy5ncm91cHMgPSB7fSApLFxuXHRcdFx0XHRydWxlcztcblx0XHRcdCQuZWFjaCggdGhpcy5zZXR0aW5ncy5ncm91cHMsIGZ1bmN0aW9uKCBrZXksIHZhbHVlICkge1xuXHRcdFx0XHRpZiAoIHR5cGVvZiB2YWx1ZSA9PT0gXCJzdHJpbmdcIiApIHtcblx0XHRcdFx0XHR2YWx1ZSA9IHZhbHVlLnNwbGl0KCAvXFxzLyApO1xuXHRcdFx0XHR9XG5cdFx0XHRcdCQuZWFjaCggdmFsdWUsIGZ1bmN0aW9uKCBpbmRleCwgbmFtZSApIHtcblx0XHRcdFx0XHRncm91cHNbIG5hbWUgXSA9IGtleTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9KTtcblx0XHRcdHJ1bGVzID0gdGhpcy5zZXR0aW5ncy5ydWxlcztcblx0XHRcdCQuZWFjaCggcnVsZXMsIGZ1bmN0aW9uKCBrZXksIHZhbHVlICkge1xuXHRcdFx0XHRydWxlc1sga2V5IF0gPSAkLnZhbGlkYXRvci5ub3JtYWxpemVSdWxlKCB2YWx1ZSApO1xuXHRcdFx0fSk7XG5cblx0XHRcdGZ1bmN0aW9uIGRlbGVnYXRlKCBldmVudCApIHtcblx0XHRcdFx0dmFyIHZhbGlkYXRvciA9ICQuZGF0YSggdGhpc1sgMCBdLmZvcm0sIFwidmFsaWRhdG9yXCIgKSxcblx0XHRcdFx0XHRldmVudFR5cGUgPSBcIm9uXCIgKyBldmVudC50eXBlLnJlcGxhY2UoIC9edmFsaWRhdGUvLCBcIlwiICksXG5cdFx0XHRcdFx0c2V0dGluZ3MgPSB2YWxpZGF0b3Iuc2V0dGluZ3M7XG5cdFx0XHRcdGlmICggc2V0dGluZ3NbIGV2ZW50VHlwZSBdICYmICF0aGlzLmlzKCBzZXR0aW5ncy5pZ25vcmUgKSApIHtcblx0XHRcdFx0XHRzZXR0aW5nc1sgZXZlbnRUeXBlIF0uY2FsbCggdmFsaWRhdG9yLCB0aGlzWyAwIF0sIGV2ZW50ICk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdCQoIHRoaXMuY3VycmVudEZvcm0gKVxuXHRcdFx0XHQudmFsaWRhdGVEZWxlZ2F0ZSggXCI6dGV4dCwgW3R5cGU9J3Bhc3N3b3JkJ10sIFt0eXBlPSdmaWxlJ10sIHNlbGVjdCwgdGV4dGFyZWEsIFwiICtcblx0XHRcdFx0XHRcIlt0eXBlPSdudW1iZXInXSwgW3R5cGU9J3NlYXJjaCddICxbdHlwZT0ndGVsJ10sIFt0eXBlPSd1cmwnXSwgXCIgK1xuXHRcdFx0XHRcdFwiW3R5cGU9J2VtYWlsJ10sIFt0eXBlPSdkYXRldGltZSddLCBbdHlwZT0nZGF0ZSddLCBbdHlwZT0nbW9udGgnXSwgXCIgK1xuXHRcdFx0XHRcdFwiW3R5cGU9J3dlZWsnXSwgW3R5cGU9J3RpbWUnXSwgW3R5cGU9J2RhdGV0aW1lLWxvY2FsJ10sIFwiICtcblx0XHRcdFx0XHRcIlt0eXBlPSdyYW5nZSddLCBbdHlwZT0nY29sb3InXSwgW3R5cGU9J3JhZGlvJ10sIFt0eXBlPSdjaGVja2JveCddXCIsXG5cdFx0XHRcdFx0XCJmb2N1c2luIGZvY3Vzb3V0IGtleXVwXCIsIGRlbGVnYXRlKVxuXHRcdFx0XHQvLyBTdXBwb3J0OiBDaHJvbWUsIG9sZElFXG5cdFx0XHRcdC8vIFwic2VsZWN0XCIgaXMgcHJvdmlkZWQgYXMgZXZlbnQudGFyZ2V0IHdoZW4gY2xpY2tpbmcgYSBvcHRpb25cblx0XHRcdFx0LnZhbGlkYXRlRGVsZWdhdGUoXCJzZWxlY3QsIG9wdGlvbiwgW3R5cGU9J3JhZGlvJ10sIFt0eXBlPSdjaGVja2JveCddXCIsIFwiY2xpY2tcIiwgZGVsZWdhdGUpO1xuXG5cdFx0XHRpZiAoIHRoaXMuc2V0dGluZ3MuaW52YWxpZEhhbmRsZXIgKSB7XG5cdFx0XHRcdCQoIHRoaXMuY3VycmVudEZvcm0gKS5iaW5kKCBcImludmFsaWQtZm9ybS52YWxpZGF0ZVwiLCB0aGlzLnNldHRpbmdzLmludmFsaWRIYW5kbGVyICk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIEFkZCBhcmlhLXJlcXVpcmVkIHRvIGFueSBTdGF0aWMvRGF0YS9DbGFzcyByZXF1aXJlZCBmaWVsZHMgYmVmb3JlIGZpcnN0IHZhbGlkYXRpb25cblx0XHRcdC8vIFNjcmVlbiByZWFkZXJzIHJlcXVpcmUgdGhpcyBhdHRyaWJ1dGUgdG8gYmUgcHJlc2VudCBiZWZvcmUgdGhlIGluaXRpYWwgc3VibWlzc2lvbiBodHRwOi8vd3d3LnczLm9yZy9UUi9XQ0FHLVRFQ0hTL0FSSUEyLmh0bWxcblx0XHRcdCQoIHRoaXMuY3VycmVudEZvcm0gKS5maW5kKCBcIltyZXF1aXJlZF0sIFtkYXRhLXJ1bGUtcmVxdWlyZWRdLCAucmVxdWlyZWRcIiApLmF0dHIoIFwiYXJpYS1yZXF1aXJlZFwiLCBcInRydWVcIiApO1xuXHRcdH0sXG5cblx0XHQvLyBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvVmFsaWRhdG9yLmZvcm0vXG5cdFx0Zm9ybTogZnVuY3Rpb24oKSB7XG5cdFx0XHR0aGlzLmNoZWNrRm9ybSgpO1xuXHRcdFx0JC5leHRlbmQoIHRoaXMuc3VibWl0dGVkLCB0aGlzLmVycm9yTWFwICk7XG5cdFx0XHR0aGlzLmludmFsaWQgPSAkLmV4dGVuZCh7fSwgdGhpcy5lcnJvck1hcCApO1xuXHRcdFx0aWYgKCAhdGhpcy52YWxpZCgpICkge1xuXHRcdFx0XHQkKCB0aGlzLmN1cnJlbnRGb3JtICkudHJpZ2dlckhhbmRsZXIoIFwiaW52YWxpZC1mb3JtXCIsIFsgdGhpcyBdKTtcblx0XHRcdH1cblx0XHRcdHRoaXMuc2hvd0Vycm9ycygpO1xuXHRcdFx0cmV0dXJuIHRoaXMudmFsaWQoKTtcblx0XHR9LFxuXG5cdFx0Y2hlY2tGb3JtOiBmdW5jdGlvbigpIHtcblx0XHRcdHRoaXMucHJlcGFyZUZvcm0oKTtcblx0XHRcdGZvciAoIHZhciBpID0gMCwgZWxlbWVudHMgPSAoIHRoaXMuY3VycmVudEVsZW1lbnRzID0gdGhpcy5lbGVtZW50cygpICk7IGVsZW1lbnRzWyBpIF07IGkrKyApIHtcblx0XHRcdFx0dGhpcy5jaGVjayggZWxlbWVudHNbIGkgXSApO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXMudmFsaWQoKTtcblx0XHR9LFxuXG5cdFx0Ly8gaHR0cDovL2pxdWVyeXZhbGlkYXRpb24ub3JnL1ZhbGlkYXRvci5lbGVtZW50L1xuXHRcdGVsZW1lbnQ6IGZ1bmN0aW9uKCBlbGVtZW50ICkge1xuXHRcdFx0dmFyIGNsZWFuRWxlbWVudCA9IHRoaXMuY2xlYW4oIGVsZW1lbnQgKSxcblx0XHRcdFx0Y2hlY2tFbGVtZW50ID0gdGhpcy52YWxpZGF0aW9uVGFyZ2V0Rm9yKCBjbGVhbkVsZW1lbnQgKSxcblx0XHRcdFx0cmVzdWx0ID0gdHJ1ZTtcblxuXHRcdFx0dGhpcy5sYXN0RWxlbWVudCA9IGNoZWNrRWxlbWVudDtcblxuXHRcdFx0aWYgKCBjaGVja0VsZW1lbnQgPT09IHVuZGVmaW5lZCApIHtcblx0XHRcdFx0ZGVsZXRlIHRoaXMuaW52YWxpZFsgY2xlYW5FbGVtZW50Lm5hbWUgXTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdHRoaXMucHJlcGFyZUVsZW1lbnQoIGNoZWNrRWxlbWVudCApO1xuXHRcdFx0XHR0aGlzLmN1cnJlbnRFbGVtZW50cyA9ICQoIGNoZWNrRWxlbWVudCApO1xuXG5cdFx0XHRcdHJlc3VsdCA9IHRoaXMuY2hlY2soIGNoZWNrRWxlbWVudCApICE9PSBmYWxzZTtcblx0XHRcdFx0aWYgKCByZXN1bHQgKSB7XG5cdFx0XHRcdFx0ZGVsZXRlIHRoaXMuaW52YWxpZFsgY2hlY2tFbGVtZW50Lm5hbWUgXTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLmludmFsaWRbIGNoZWNrRWxlbWVudC5uYW1lIF0gPSB0cnVlO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHQvLyBBZGQgYXJpYS1pbnZhbGlkIHN0YXR1cyBmb3Igc2NyZWVuIHJlYWRlcnNcblx0XHRcdCQoIGVsZW1lbnQgKS5hdHRyKCBcImFyaWEtaW52YWxpZFwiLCAhcmVzdWx0ICk7XG5cblx0XHRcdGlmICggIXRoaXMubnVtYmVyT2ZJbnZhbGlkcygpICkge1xuXHRcdFx0XHQvLyBIaWRlIGVycm9yIGNvbnRhaW5lcnMgb24gbGFzdCBlcnJvclxuXHRcdFx0XHR0aGlzLnRvSGlkZSA9IHRoaXMudG9IaWRlLmFkZCggdGhpcy5jb250YWluZXJzICk7XG5cdFx0XHR9XG5cdFx0XHR0aGlzLnNob3dFcnJvcnMoKTtcblx0XHRcdHJldHVybiByZXN1bHQ7XG5cdFx0fSxcblxuXHRcdC8vIGh0dHA6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9WYWxpZGF0b3Iuc2hvd0Vycm9ycy9cblx0XHRzaG93RXJyb3JzOiBmdW5jdGlvbiggZXJyb3JzICkge1xuXHRcdFx0aWYgKCBlcnJvcnMgKSB7XG5cdFx0XHRcdC8vIGFkZCBpdGVtcyB0byBlcnJvciBsaXN0IGFuZCBtYXBcblx0XHRcdFx0JC5leHRlbmQoIHRoaXMuZXJyb3JNYXAsIGVycm9ycyApO1xuXHRcdFx0XHR0aGlzLmVycm9yTGlzdCA9IFtdO1xuXHRcdFx0XHRmb3IgKCB2YXIgbmFtZSBpbiBlcnJvcnMgKSB7XG5cdFx0XHRcdFx0dGhpcy5lcnJvckxpc3QucHVzaCh7XG5cdFx0XHRcdFx0XHRtZXNzYWdlOiBlcnJvcnNbIG5hbWUgXSxcblx0XHRcdFx0XHRcdGVsZW1lbnQ6IHRoaXMuZmluZEJ5TmFtZSggbmFtZSApWyAwIF1cblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0XHQvLyByZW1vdmUgaXRlbXMgZnJvbSBzdWNjZXNzIGxpc3Rcblx0XHRcdFx0dGhpcy5zdWNjZXNzTGlzdCA9ICQuZ3JlcCggdGhpcy5zdWNjZXNzTGlzdCwgZnVuY3Rpb24oIGVsZW1lbnQgKSB7XG5cdFx0XHRcdFx0cmV0dXJuICEoIGVsZW1lbnQubmFtZSBpbiBlcnJvcnMgKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0XHRpZiAoIHRoaXMuc2V0dGluZ3Muc2hvd0Vycm9ycyApIHtcblx0XHRcdFx0dGhpcy5zZXR0aW5ncy5zaG93RXJyb3JzLmNhbGwoIHRoaXMsIHRoaXMuZXJyb3JNYXAsIHRoaXMuZXJyb3JMaXN0ICk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLmRlZmF1bHRTaG93RXJyb3JzKCk7XG5cdFx0XHR9XG5cdFx0fSxcblxuXHRcdC8vIGh0dHA6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9WYWxpZGF0b3IucmVzZXRGb3JtL1xuXHRcdHJlc2V0Rm9ybTogZnVuY3Rpb24oKSB7XG5cdFx0XHRpZiAoICQuZm4ucmVzZXRGb3JtICkge1xuXHRcdFx0XHQkKCB0aGlzLmN1cnJlbnRGb3JtICkucmVzZXRGb3JtKCk7XG5cdFx0XHR9XG5cdFx0XHR0aGlzLnN1Ym1pdHRlZCA9IHt9O1xuXHRcdFx0dGhpcy5sYXN0RWxlbWVudCA9IG51bGw7XG5cdFx0XHR0aGlzLnByZXBhcmVGb3JtKCk7XG5cdFx0XHR0aGlzLmhpZGVFcnJvcnMoKTtcblx0XHRcdHRoaXMuZWxlbWVudHMoKVxuXHRcdFx0XHRcdC5yZW1vdmVDbGFzcyggdGhpcy5zZXR0aW5ncy5lcnJvckNsYXNzIClcblx0XHRcdFx0XHQucmVtb3ZlRGF0YSggXCJwcmV2aW91c1ZhbHVlXCIgKVxuXHRcdFx0XHRcdC5yZW1vdmVBdHRyKCBcImFyaWEtaW52YWxpZFwiICk7XG5cdFx0fSxcblxuXHRcdG51bWJlck9mSW52YWxpZHM6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMub2JqZWN0TGVuZ3RoKCB0aGlzLmludmFsaWQgKTtcblx0XHR9LFxuXG5cdFx0b2JqZWN0TGVuZ3RoOiBmdW5jdGlvbiggb2JqICkge1xuXHRcdFx0LyoganNoaW50IHVudXNlZDogZmFsc2UgKi9cblx0XHRcdHZhciBjb3VudCA9IDAsXG5cdFx0XHRcdGk7XG5cdFx0XHRmb3IgKCBpIGluIG9iaiApIHtcblx0XHRcdFx0Y291bnQrKztcblx0XHRcdH1cblx0XHRcdHJldHVybiBjb3VudDtcblx0XHR9LFxuXG5cdFx0aGlkZUVycm9yczogZnVuY3Rpb24oKSB7XG5cdFx0XHR0aGlzLmhpZGVUaGVzZSggdGhpcy50b0hpZGUgKTtcblx0XHR9LFxuXG5cdFx0aGlkZVRoZXNlOiBmdW5jdGlvbiggZXJyb3JzICkge1xuXHRcdFx0ZXJyb3JzLm5vdCggdGhpcy5jb250YWluZXJzICkudGV4dCggXCJcIiApO1xuXHRcdFx0dGhpcy5hZGRXcmFwcGVyKCBlcnJvcnMgKS5oaWRlKCk7XG5cdFx0fSxcblxuXHRcdHZhbGlkOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLnNpemUoKSA9PT0gMDtcblx0XHR9LFxuXG5cdFx0c2l6ZTogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5lcnJvckxpc3QubGVuZ3RoO1xuXHRcdH0sXG5cblx0XHRmb2N1c0ludmFsaWQ6IGZ1bmN0aW9uKCkge1xuXHRcdFx0aWYgKCB0aGlzLnNldHRpbmdzLmZvY3VzSW52YWxpZCApIHtcblx0XHRcdFx0dHJ5IHtcblx0XHRcdFx0XHQkKCB0aGlzLmZpbmRMYXN0QWN0aXZlKCkgfHwgdGhpcy5lcnJvckxpc3QubGVuZ3RoICYmIHRoaXMuZXJyb3JMaXN0WyAwIF0uZWxlbWVudCB8fCBbXSlcblx0XHRcdFx0XHQuZmlsdGVyKCBcIjp2aXNpYmxlXCIgKVxuXHRcdFx0XHRcdC5mb2N1cygpXG5cdFx0XHRcdFx0Ly8gbWFudWFsbHkgdHJpZ2dlciBmb2N1c2luIGV2ZW50OyB3aXRob3V0IGl0LCBmb2N1c2luIGhhbmRsZXIgaXNuJ3QgY2FsbGVkLCBmaW5kTGFzdEFjdGl2ZSB3b24ndCBoYXZlIGFueXRoaW5nIHRvIGZpbmRcblx0XHRcdFx0XHQudHJpZ2dlciggXCJmb2N1c2luXCIgKTtcblx0XHRcdFx0fSBjYXRjaCAoIGUgKSB7XG5cdFx0XHRcdFx0Ly8gaWdub3JlIElFIHRocm93aW5nIGVycm9ycyB3aGVuIGZvY3VzaW5nIGhpZGRlbiBlbGVtZW50c1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSxcblxuXHRcdGZpbmRMYXN0QWN0aXZlOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBsYXN0QWN0aXZlID0gdGhpcy5sYXN0QWN0aXZlO1xuXHRcdFx0cmV0dXJuIGxhc3RBY3RpdmUgJiYgJC5ncmVwKCB0aGlzLmVycm9yTGlzdCwgZnVuY3Rpb24oIG4gKSB7XG5cdFx0XHRcdHJldHVybiBuLmVsZW1lbnQubmFtZSA9PT0gbGFzdEFjdGl2ZS5uYW1lO1xuXHRcdFx0fSkubGVuZ3RoID09PSAxICYmIGxhc3RBY3RpdmU7XG5cdFx0fSxcblxuXHRcdGVsZW1lbnRzOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciB2YWxpZGF0b3IgPSB0aGlzLFxuXHRcdFx0XHRydWxlc0NhY2hlID0ge307XG5cblx0XHRcdC8vIHNlbGVjdCBhbGwgdmFsaWQgaW5wdXRzIGluc2lkZSB0aGUgZm9ybSAobm8gc3VibWl0IG9yIHJlc2V0IGJ1dHRvbnMpXG5cdFx0XHRyZXR1cm4gJCggdGhpcy5jdXJyZW50Rm9ybSApXG5cdFx0XHQuZmluZCggXCJpbnB1dCwgc2VsZWN0LCB0ZXh0YXJlYVwiIClcblx0XHRcdC5ub3QoIFwiOnN1Ym1pdCwgOnJlc2V0LCA6aW1hZ2UsIFtkaXNhYmxlZF0sIFtyZWFkb25seV1cIiApXG5cdFx0XHQubm90KCB0aGlzLnNldHRpbmdzLmlnbm9yZSApXG5cdFx0XHQuZmlsdGVyKCBmdW5jdGlvbigpIHtcblx0XHRcdFx0aWYgKCAhdGhpcy5uYW1lICYmIHZhbGlkYXRvci5zZXR0aW5ncy5kZWJ1ZyAmJiB3aW5kb3cuY29uc29sZSApIHtcblx0XHRcdFx0XHRjb25zb2xlLmVycm9yKCBcIiVvIGhhcyBubyBuYW1lIGFzc2lnbmVkXCIsIHRoaXMgKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIHNlbGVjdCBvbmx5IHRoZSBmaXJzdCBlbGVtZW50IGZvciBlYWNoIG5hbWUsIGFuZCBvbmx5IHRob3NlIHdpdGggcnVsZXMgc3BlY2lmaWVkXG5cdFx0XHRcdGlmICggdGhpcy5uYW1lIGluIHJ1bGVzQ2FjaGUgfHwgIXZhbGlkYXRvci5vYmplY3RMZW5ndGgoICQoIHRoaXMgKS5ydWxlcygpICkgKSB7XG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0cnVsZXNDYWNoZVsgdGhpcy5uYW1lIF0gPSB0cnVlO1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH0pO1xuXHRcdH0sXG5cblx0XHRjbGVhbjogZnVuY3Rpb24oIHNlbGVjdG9yICkge1xuXHRcdFx0cmV0dXJuICQoIHNlbGVjdG9yIClbIDAgXTtcblx0XHR9LFxuXG5cdFx0ZXJyb3JzOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBlcnJvckNsYXNzID0gdGhpcy5zZXR0aW5ncy5lcnJvckNsYXNzLnNwbGl0KCBcIiBcIiApLmpvaW4oIFwiLlwiICk7XG5cdFx0XHRyZXR1cm4gJCggdGhpcy5zZXR0aW5ncy5lcnJvckVsZW1lbnQgKyBcIi5cIiArIGVycm9yQ2xhc3MsIHRoaXMuZXJyb3JDb250ZXh0ICk7XG5cdFx0fSxcblxuXHRcdHJlc2V0OiBmdW5jdGlvbigpIHtcblx0XHRcdHRoaXMuc3VjY2Vzc0xpc3QgPSBbXTtcblx0XHRcdHRoaXMuZXJyb3JMaXN0ID0gW107XG5cdFx0XHR0aGlzLmVycm9yTWFwID0ge307XG5cdFx0XHR0aGlzLnRvU2hvdyA9ICQoIFtdICk7XG5cdFx0XHR0aGlzLnRvSGlkZSA9ICQoIFtdICk7XG5cdFx0XHR0aGlzLmN1cnJlbnRFbGVtZW50cyA9ICQoIFtdICk7XG5cdFx0fSxcblxuXHRcdHByZXBhcmVGb3JtOiBmdW5jdGlvbigpIHtcblx0XHRcdHRoaXMucmVzZXQoKTtcblx0XHRcdHRoaXMudG9IaWRlID0gdGhpcy5lcnJvcnMoKS5hZGQoIHRoaXMuY29udGFpbmVycyApO1xuXHRcdH0sXG5cblx0XHRwcmVwYXJlRWxlbWVudDogZnVuY3Rpb24oIGVsZW1lbnQgKSB7XG5cdFx0XHR0aGlzLnJlc2V0KCk7XG5cdFx0XHR0aGlzLnRvSGlkZSA9IHRoaXMuZXJyb3JzRm9yKCBlbGVtZW50ICk7XG5cdFx0fSxcblxuXHRcdGVsZW1lbnRWYWx1ZTogZnVuY3Rpb24oIGVsZW1lbnQgKSB7XG5cdFx0XHR2YXIgdmFsLFxuXHRcdFx0XHQkZWxlbWVudCA9ICQoIGVsZW1lbnQgKSxcblx0XHRcdFx0dHlwZSA9IGVsZW1lbnQudHlwZTtcblxuXHRcdFx0aWYgKCB0eXBlID09PSBcInJhZGlvXCIgfHwgdHlwZSA9PT0gXCJjaGVja2JveFwiICkge1xuXHRcdFx0XHRyZXR1cm4gJCggXCJpbnB1dFtuYW1lPSdcIiArIGVsZW1lbnQubmFtZSArIFwiJ106Y2hlY2tlZFwiICkudmFsKCk7XG5cdFx0XHR9IGVsc2UgaWYgKCB0eXBlID09PSBcIm51bWJlclwiICYmIHR5cGVvZiBlbGVtZW50LnZhbGlkaXR5ICE9PSBcInVuZGVmaW5lZFwiICkge1xuXHRcdFx0XHRyZXR1cm4gZWxlbWVudC52YWxpZGl0eS5iYWRJbnB1dCA/IGZhbHNlIDogJGVsZW1lbnQudmFsKCk7XG5cdFx0XHR9XG5cblx0XHRcdHZhbCA9ICRlbGVtZW50LnZhbCgpO1xuXHRcdFx0aWYgKCB0eXBlb2YgdmFsID09PSBcInN0cmluZ1wiICkge1xuXHRcdFx0XHRyZXR1cm4gdmFsLnJlcGxhY2UoL1xcci9nLCBcIlwiICk7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdmFsO1xuXHRcdH0sXG5cblx0XHRjaGVjazogZnVuY3Rpb24oIGVsZW1lbnQgKSB7XG5cdFx0XHRlbGVtZW50ID0gdGhpcy52YWxpZGF0aW9uVGFyZ2V0Rm9yKCB0aGlzLmNsZWFuKCBlbGVtZW50ICkgKTtcblxuXHRcdFx0dmFyIHJ1bGVzID0gJCggZWxlbWVudCApLnJ1bGVzKCksXG5cdFx0XHRcdHJ1bGVzQ291bnQgPSAkLm1hcCggcnVsZXMsIGZ1bmN0aW9uKCBuLCBpICkge1xuXHRcdFx0XHRcdHJldHVybiBpO1xuXHRcdFx0XHR9KS5sZW5ndGgsXG5cdFx0XHRcdGRlcGVuZGVuY3lNaXNtYXRjaCA9IGZhbHNlLFxuXHRcdFx0XHR2YWwgPSB0aGlzLmVsZW1lbnRWYWx1ZSggZWxlbWVudCApLFxuXHRcdFx0XHRyZXN1bHQsIG1ldGhvZCwgcnVsZTtcblxuXHRcdFx0Zm9yICggbWV0aG9kIGluIHJ1bGVzICkge1xuXHRcdFx0XHRydWxlID0geyBtZXRob2Q6IG1ldGhvZCwgcGFyYW1ldGVyczogcnVsZXNbIG1ldGhvZCBdIH07XG5cdFx0XHRcdHRyeSB7XG5cblx0XHRcdFx0XHRyZXN1bHQgPSAkLnZhbGlkYXRvci5tZXRob2RzWyBtZXRob2QgXS5jYWxsKCB0aGlzLCB2YWwsIGVsZW1lbnQsIHJ1bGUucGFyYW1ldGVycyApO1xuXG5cdFx0XHRcdFx0Ly8gaWYgYSBtZXRob2QgaW5kaWNhdGVzIHRoYXQgdGhlIGZpZWxkIGlzIG9wdGlvbmFsIGFuZCB0aGVyZWZvcmUgdmFsaWQsXG5cdFx0XHRcdFx0Ly8gZG9uJ3QgbWFyayBpdCBhcyB2YWxpZCB3aGVuIHRoZXJlIGFyZSBubyBvdGhlciBydWxlc1xuXHRcdFx0XHRcdGlmICggcmVzdWx0ID09PSBcImRlcGVuZGVuY3ktbWlzbWF0Y2hcIiAmJiBydWxlc0NvdW50ID09PSAxICkge1xuXHRcdFx0XHRcdFx0ZGVwZW5kZW5jeU1pc21hdGNoID0gdHJ1ZTtcblx0XHRcdFx0XHRcdGNvbnRpbnVlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRkZXBlbmRlbmN5TWlzbWF0Y2ggPSBmYWxzZTtcblxuXHRcdFx0XHRcdGlmICggcmVzdWx0ID09PSBcInBlbmRpbmdcIiApIHtcblx0XHRcdFx0XHRcdHRoaXMudG9IaWRlID0gdGhpcy50b0hpZGUubm90KCB0aGlzLmVycm9yc0ZvciggZWxlbWVudCApICk7XG5cdFx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKCAhcmVzdWx0ICkge1xuXHRcdFx0XHRcdFx0dGhpcy5mb3JtYXRBbmRBZGQoIGVsZW1lbnQsIHJ1bGUgKTtcblx0XHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0gY2F0Y2ggKCBlICkge1xuXHRcdFx0XHRcdGlmICggdGhpcy5zZXR0aW5ncy5kZWJ1ZyAmJiB3aW5kb3cuY29uc29sZSApIHtcblx0XHRcdFx0XHRcdGNvbnNvbGUubG9nKCBcIkV4Y2VwdGlvbiBvY2N1cnJlZCB3aGVuIGNoZWNraW5nIGVsZW1lbnQgXCIgKyBlbGVtZW50LmlkICsgXCIsIGNoZWNrIHRoZSAnXCIgKyBydWxlLm1ldGhvZCArIFwiJyBtZXRob2QuXCIsIGUgKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0dGhyb3cgZTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0aWYgKCBkZXBlbmRlbmN5TWlzbWF0Y2ggKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblx0XHRcdGlmICggdGhpcy5vYmplY3RMZW5ndGgoIHJ1bGVzICkgKSB7XG5cdFx0XHRcdHRoaXMuc3VjY2Vzc0xpc3QucHVzaCggZWxlbWVudCApO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0fSxcblxuXHRcdC8vIHJldHVybiB0aGUgY3VzdG9tIG1lc3NhZ2UgZm9yIHRoZSBnaXZlbiBlbGVtZW50IGFuZCB2YWxpZGF0aW9uIG1ldGhvZFxuXHRcdC8vIHNwZWNpZmllZCBpbiB0aGUgZWxlbWVudCdzIEhUTUw1IGRhdGEgYXR0cmlidXRlXG5cdFx0Ly8gcmV0dXJuIHRoZSBnZW5lcmljIG1lc3NhZ2UgaWYgcHJlc2VudCBhbmQgbm8gbWV0aG9kIHNwZWNpZmljIG1lc3NhZ2UgaXMgcHJlc2VudFxuXHRcdGN1c3RvbURhdGFNZXNzYWdlOiBmdW5jdGlvbiggZWxlbWVudCwgbWV0aG9kICkge1xuXHRcdFx0cmV0dXJuICQoIGVsZW1lbnQgKS5kYXRhKCBcIm1zZ1wiICsgbWV0aG9kLmNoYXJBdCggMCApLnRvVXBwZXJDYXNlKCkgK1xuXHRcdFx0XHRtZXRob2Quc3Vic3RyaW5nKCAxICkudG9Mb3dlckNhc2UoKSApIHx8ICQoIGVsZW1lbnQgKS5kYXRhKCBcIm1zZ1wiICk7XG5cdFx0fSxcblxuXHRcdC8vIHJldHVybiB0aGUgY3VzdG9tIG1lc3NhZ2UgZm9yIHRoZSBnaXZlbiBlbGVtZW50IG5hbWUgYW5kIHZhbGlkYXRpb24gbWV0aG9kXG5cdFx0Y3VzdG9tTWVzc2FnZTogZnVuY3Rpb24oIG5hbWUsIG1ldGhvZCApIHtcblx0XHRcdHZhciBtID0gdGhpcy5zZXR0aW5ncy5tZXNzYWdlc1sgbmFtZSBdO1xuXHRcdFx0cmV0dXJuIG0gJiYgKCBtLmNvbnN0cnVjdG9yID09PSBTdHJpbmcgPyBtIDogbVsgbWV0aG9kIF0pO1xuXHRcdH0sXG5cblx0XHQvLyByZXR1cm4gdGhlIGZpcnN0IGRlZmluZWQgYXJndW1lbnQsIGFsbG93aW5nIGVtcHR5IHN0cmluZ3Ncblx0XHRmaW5kRGVmaW5lZDogZnVuY3Rpb24oKSB7XG5cdFx0XHRmb3IgKCB2YXIgaSA9IDA7IGkgPCBhcmd1bWVudHMubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0aWYgKCBhcmd1bWVudHNbIGkgXSAhPT0gdW5kZWZpbmVkICkge1xuXHRcdFx0XHRcdHJldHVybiBhcmd1bWVudHNbIGkgXTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHVuZGVmaW5lZDtcblx0XHR9LFxuXG5cdFx0ZGVmYXVsdE1lc3NhZ2U6IGZ1bmN0aW9uKCBlbGVtZW50LCBtZXRob2QgKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5maW5kRGVmaW5lZChcblx0XHRcdFx0dGhpcy5jdXN0b21NZXNzYWdlKCBlbGVtZW50Lm5hbWUsIG1ldGhvZCApLFxuXHRcdFx0XHR0aGlzLmN1c3RvbURhdGFNZXNzYWdlKCBlbGVtZW50LCBtZXRob2QgKSxcblx0XHRcdFx0Ly8gdGl0bGUgaXMgbmV2ZXIgdW5kZWZpbmVkLCBzbyBoYW5kbGUgZW1wdHkgc3RyaW5nIGFzIHVuZGVmaW5lZFxuXHRcdFx0XHQhdGhpcy5zZXR0aW5ncy5pZ25vcmVUaXRsZSAmJiBlbGVtZW50LnRpdGxlIHx8IHVuZGVmaW5lZCxcblx0XHRcdFx0JC52YWxpZGF0b3IubWVzc2FnZXNbIG1ldGhvZCBdLFxuXHRcdFx0XHRcIjxzdHJvbmc+V2FybmluZzogTm8gbWVzc2FnZSBkZWZpbmVkIGZvciBcIiArIGVsZW1lbnQubmFtZSArIFwiPC9zdHJvbmc+XCJcblx0XHRcdCk7XG5cdFx0fSxcblxuXHRcdGZvcm1hdEFuZEFkZDogZnVuY3Rpb24oIGVsZW1lbnQsIHJ1bGUgKSB7XG5cdFx0XHR2YXIgbWVzc2FnZSA9IHRoaXMuZGVmYXVsdE1lc3NhZ2UoIGVsZW1lbnQsIHJ1bGUubWV0aG9kICksXG5cdFx0XHRcdHRoZXJlZ2V4ID0gL1xcJD9cXHsoXFxkKylcXH0vZztcblx0XHRcdGlmICggdHlwZW9mIG1lc3NhZ2UgPT09IFwiZnVuY3Rpb25cIiApIHtcblx0XHRcdFx0bWVzc2FnZSA9IG1lc3NhZ2UuY2FsbCggdGhpcywgcnVsZS5wYXJhbWV0ZXJzLCBlbGVtZW50ICk7XG5cdFx0XHR9IGVsc2UgaWYgKCB0aGVyZWdleC50ZXN0KCBtZXNzYWdlICkgKSB7XG5cdFx0XHRcdG1lc3NhZ2UgPSAkLnZhbGlkYXRvci5mb3JtYXQoIG1lc3NhZ2UucmVwbGFjZSggdGhlcmVnZXgsIFwieyQxfVwiICksIHJ1bGUucGFyYW1ldGVycyApO1xuXHRcdFx0fVxuXHRcdFx0dGhpcy5lcnJvckxpc3QucHVzaCh7XG5cdFx0XHRcdG1lc3NhZ2U6IG1lc3NhZ2UsXG5cdFx0XHRcdGVsZW1lbnQ6IGVsZW1lbnQsXG5cdFx0XHRcdG1ldGhvZDogcnVsZS5tZXRob2Rcblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLmVycm9yTWFwWyBlbGVtZW50Lm5hbWUgXSA9IG1lc3NhZ2U7XG5cdFx0XHR0aGlzLnN1Ym1pdHRlZFsgZWxlbWVudC5uYW1lIF0gPSBtZXNzYWdlO1xuXHRcdH0sXG5cblx0XHRhZGRXcmFwcGVyOiBmdW5jdGlvbiggdG9Ub2dnbGUgKSB7XG5cdFx0XHRpZiAoIHRoaXMuc2V0dGluZ3Mud3JhcHBlciApIHtcblx0XHRcdFx0dG9Ub2dnbGUgPSB0b1RvZ2dsZS5hZGQoIHRvVG9nZ2xlLnBhcmVudCggdGhpcy5zZXR0aW5ncy53cmFwcGVyICkgKTtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0b1RvZ2dsZTtcblx0XHR9LFxuXG5cdFx0ZGVmYXVsdFNob3dFcnJvcnM6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIGksIGVsZW1lbnRzLCBlcnJvcjtcblx0XHRcdGZvciAoIGkgPSAwOyB0aGlzLmVycm9yTGlzdFsgaSBdOyBpKysgKSB7XG5cdFx0XHRcdGVycm9yID0gdGhpcy5lcnJvckxpc3RbIGkgXTtcblx0XHRcdFx0aWYgKCB0aGlzLnNldHRpbmdzLmhpZ2hsaWdodCApIHtcblx0XHRcdFx0XHR0aGlzLnNldHRpbmdzLmhpZ2hsaWdodC5jYWxsKCB0aGlzLCBlcnJvci5lbGVtZW50LCB0aGlzLnNldHRpbmdzLmVycm9yQ2xhc3MsIHRoaXMuc2V0dGluZ3MudmFsaWRDbGFzcyApO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHRoaXMuc2hvd0xhYmVsKCBlcnJvci5lbGVtZW50LCBlcnJvci5tZXNzYWdlICk7XG5cdFx0XHR9XG5cdFx0XHRpZiAoIHRoaXMuZXJyb3JMaXN0Lmxlbmd0aCApIHtcblx0XHRcdFx0dGhpcy50b1Nob3cgPSB0aGlzLnRvU2hvdy5hZGQoIHRoaXMuY29udGFpbmVycyApO1xuXHRcdFx0fVxuXHRcdFx0aWYgKCB0aGlzLnNldHRpbmdzLnN1Y2Nlc3MgKSB7XG5cdFx0XHRcdGZvciAoIGkgPSAwOyB0aGlzLnN1Y2Nlc3NMaXN0WyBpIF07IGkrKyApIHtcblx0XHRcdFx0XHR0aGlzLnNob3dMYWJlbCggdGhpcy5zdWNjZXNzTGlzdFsgaSBdICk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdGlmICggdGhpcy5zZXR0aW5ncy51bmhpZ2hsaWdodCApIHtcblx0XHRcdFx0Zm9yICggaSA9IDAsIGVsZW1lbnRzID0gdGhpcy52YWxpZEVsZW1lbnRzKCk7IGVsZW1lbnRzWyBpIF07IGkrKyApIHtcblx0XHRcdFx0XHR0aGlzLnNldHRpbmdzLnVuaGlnaGxpZ2h0LmNhbGwoIHRoaXMsIGVsZW1lbnRzWyBpIF0sIHRoaXMuc2V0dGluZ3MuZXJyb3JDbGFzcywgdGhpcy5zZXR0aW5ncy52YWxpZENsYXNzICk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdHRoaXMudG9IaWRlID0gdGhpcy50b0hpZGUubm90KCB0aGlzLnRvU2hvdyApO1xuXHRcdFx0dGhpcy5oaWRlRXJyb3JzKCk7XG5cdFx0XHR0aGlzLmFkZFdyYXBwZXIoIHRoaXMudG9TaG93ICkuc2hvdygpO1xuXHRcdH0sXG5cblx0XHR2YWxpZEVsZW1lbnRzOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLmN1cnJlbnRFbGVtZW50cy5ub3QoIHRoaXMuaW52YWxpZEVsZW1lbnRzKCkgKTtcblx0XHR9LFxuXG5cdFx0aW52YWxpZEVsZW1lbnRzOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiAkKCB0aGlzLmVycm9yTGlzdCApLm1hcChmdW5jdGlvbigpIHtcblx0XHRcdFx0cmV0dXJuIHRoaXMuZWxlbWVudDtcblx0XHRcdH0pO1xuXHRcdH0sXG5cblx0XHRzaG93TGFiZWw6IGZ1bmN0aW9uKCBlbGVtZW50LCBtZXNzYWdlICkge1xuXHRcdFx0dmFyIHBsYWNlLCBncm91cCwgZXJyb3JJRCxcblx0XHRcdFx0ZXJyb3IgPSB0aGlzLmVycm9yc0ZvciggZWxlbWVudCApLFxuXHRcdFx0XHRlbGVtZW50SUQgPSB0aGlzLmlkT3JOYW1lKCBlbGVtZW50ICksXG5cdFx0XHRcdGRlc2NyaWJlZEJ5ID0gJCggZWxlbWVudCApLmF0dHIoIFwiYXJpYS1kZXNjcmliZWRieVwiICk7XG5cdFx0XHRpZiAoIGVycm9yLmxlbmd0aCApIHtcblx0XHRcdFx0Ly8gcmVmcmVzaCBlcnJvci9zdWNjZXNzIGNsYXNzXG5cdFx0XHRcdGVycm9yLnJlbW92ZUNsYXNzKCB0aGlzLnNldHRpbmdzLnZhbGlkQ2xhc3MgKS5hZGRDbGFzcyggdGhpcy5zZXR0aW5ncy5lcnJvckNsYXNzICk7XG5cdFx0XHRcdC8vIHJlcGxhY2UgbWVzc2FnZSBvbiBleGlzdGluZyBsYWJlbFxuXHRcdFx0XHRlcnJvci5odG1sKCBtZXNzYWdlICk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBjcmVhdGUgZXJyb3IgZWxlbWVudFxuXHRcdFx0XHRlcnJvciA9ICQoIFwiPFwiICsgdGhpcy5zZXR0aW5ncy5lcnJvckVsZW1lbnQgKyBcIj5cIiApXG5cdFx0XHRcdFx0LmF0dHIoIFwiaWRcIiwgZWxlbWVudElEICsgXCItZXJyb3JcIiApXG5cdFx0XHRcdFx0LmFkZENsYXNzKCB0aGlzLnNldHRpbmdzLmVycm9yQ2xhc3MgKVxuXHRcdFx0XHRcdC5odG1sKCBtZXNzYWdlIHx8IFwiXCIgKTtcblxuXHRcdFx0XHQvLyBNYWludGFpbiByZWZlcmVuY2UgdG8gdGhlIGVsZW1lbnQgdG8gYmUgcGxhY2VkIGludG8gdGhlIERPTVxuXHRcdFx0XHRwbGFjZSA9IGVycm9yO1xuXHRcdFx0XHRpZiAoIHRoaXMuc2V0dGluZ3Mud3JhcHBlciApIHtcblx0XHRcdFx0XHQvLyBtYWtlIHN1cmUgdGhlIGVsZW1lbnQgaXMgdmlzaWJsZSwgZXZlbiBpbiBJRVxuXHRcdFx0XHRcdC8vIGFjdHVhbGx5IHNob3dpbmcgdGhlIHdyYXBwZWQgZWxlbWVudCBpcyBoYW5kbGVkIGVsc2V3aGVyZVxuXHRcdFx0XHRcdHBsYWNlID0gZXJyb3IuaGlkZSgpLnNob3coKS53cmFwKCBcIjxcIiArIHRoaXMuc2V0dGluZ3Mud3JhcHBlciArIFwiLz5cIiApLnBhcmVudCgpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGlmICggdGhpcy5sYWJlbENvbnRhaW5lci5sZW5ndGggKSB7XG5cdFx0XHRcdFx0dGhpcy5sYWJlbENvbnRhaW5lci5hcHBlbmQoIHBsYWNlICk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIHRoaXMuc2V0dGluZ3MuZXJyb3JQbGFjZW1lbnQgKSB7XG5cdFx0XHRcdFx0dGhpcy5zZXR0aW5ncy5lcnJvclBsYWNlbWVudCggcGxhY2UsICQoIGVsZW1lbnQgKSApO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHBsYWNlLmluc2VydEFmdGVyKCBlbGVtZW50ICk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBMaW5rIGVycm9yIGJhY2sgdG8gdGhlIGVsZW1lbnRcblx0XHRcdFx0aWYgKCBlcnJvci5pcyggXCJsYWJlbFwiICkgKSB7XG5cdFx0XHRcdFx0Ly8gSWYgdGhlIGVycm9yIGlzIGEgbGFiZWwsIHRoZW4gYXNzb2NpYXRlIHVzaW5nICdmb3InXG5cdFx0XHRcdFx0ZXJyb3IuYXR0ciggXCJmb3JcIiwgZWxlbWVudElEICk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIGVycm9yLnBhcmVudHMoIFwibGFiZWxbZm9yPSdcIiArIGVsZW1lbnRJRCArIFwiJ11cIiApLmxlbmd0aCA9PT0gMCApIHtcblx0XHRcdFx0XHQvLyBJZiB0aGUgZWxlbWVudCBpcyBub3QgYSBjaGlsZCBvZiBhbiBhc3NvY2lhdGVkIGxhYmVsLCB0aGVuIGl0J3MgbmVjZXNzYXJ5XG5cdFx0XHRcdFx0Ly8gdG8gZXhwbGljaXRseSBhcHBseSBhcmlhLWRlc2NyaWJlZGJ5XG5cblx0XHRcdFx0XHRlcnJvcklEID0gZXJyb3IuYXR0ciggXCJpZFwiICkucmVwbGFjZSggLyg6fFxcLnxcXFt8XFxdKS9nLCBcIlxcXFwkMVwiKTtcblx0XHRcdFx0XHQvLyBSZXNwZWN0IGV4aXN0aW5nIG5vbi1lcnJvciBhcmlhLWRlc2NyaWJlZGJ5XG5cdFx0XHRcdFx0aWYgKCAhZGVzY3JpYmVkQnkgKSB7XG5cdFx0XHRcdFx0XHRkZXNjcmliZWRCeSA9IGVycm9ySUQ7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICggIWRlc2NyaWJlZEJ5Lm1hdGNoKCBuZXcgUmVnRXhwKCBcIlxcXFxiXCIgKyBlcnJvcklEICsgXCJcXFxcYlwiICkgKSApIHtcblx0XHRcdFx0XHRcdC8vIEFkZCB0byBlbmQgb2YgbGlzdCBpZiBub3QgYWxyZWFkeSBwcmVzZW50XG5cdFx0XHRcdFx0XHRkZXNjcmliZWRCeSArPSBcIiBcIiArIGVycm9ySUQ7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdCQoIGVsZW1lbnQgKS5hdHRyKCBcImFyaWEtZGVzY3JpYmVkYnlcIiwgZGVzY3JpYmVkQnkgKTtcblxuXHRcdFx0XHRcdC8vIElmIHRoaXMgZWxlbWVudCBpcyBncm91cGVkLCB0aGVuIGFzc2lnbiB0byBhbGwgZWxlbWVudHMgaW4gdGhlIHNhbWUgZ3JvdXBcblx0XHRcdFx0XHRncm91cCA9IHRoaXMuZ3JvdXBzWyBlbGVtZW50Lm5hbWUgXTtcblx0XHRcdFx0XHRpZiAoIGdyb3VwICkge1xuXHRcdFx0XHRcdFx0JC5lYWNoKCB0aGlzLmdyb3VwcywgZnVuY3Rpb24oIG5hbWUsIHRlc3Rncm91cCApIHtcblx0XHRcdFx0XHRcdFx0aWYgKCB0ZXN0Z3JvdXAgPT09IGdyb3VwICkge1xuXHRcdFx0XHRcdFx0XHRcdCQoIFwiW25hbWU9J1wiICsgbmFtZSArIFwiJ11cIiwgdGhpcy5jdXJyZW50Rm9ybSApXG5cdFx0XHRcdFx0XHRcdFx0XHQuYXR0ciggXCJhcmlhLWRlc2NyaWJlZGJ5XCIsIGVycm9yLmF0dHIoIFwiaWRcIiApICk7XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0aWYgKCAhbWVzc2FnZSAmJiB0aGlzLnNldHRpbmdzLnN1Y2Nlc3MgKSB7XG5cdFx0XHRcdGVycm9yLnRleHQoIFwiXCIgKTtcblx0XHRcdFx0aWYgKCB0eXBlb2YgdGhpcy5zZXR0aW5ncy5zdWNjZXNzID09PSBcInN0cmluZ1wiICkge1xuXHRcdFx0XHRcdGVycm9yLmFkZENsYXNzKCB0aGlzLnNldHRpbmdzLnN1Y2Nlc3MgKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLnNldHRpbmdzLnN1Y2Nlc3MoIGVycm9yLCBlbGVtZW50ICk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdHRoaXMudG9TaG93ID0gdGhpcy50b1Nob3cuYWRkKCBlcnJvciApO1xuXHRcdH0sXG5cblx0XHRlcnJvcnNGb3I6IGZ1bmN0aW9uKCBlbGVtZW50ICkge1xuXHRcdFx0dmFyIG5hbWUgPSB0aGlzLmlkT3JOYW1lKCBlbGVtZW50ICksXG5cdFx0XHRcdGRlc2NyaWJlciA9ICQoIGVsZW1lbnQgKS5hdHRyKCBcImFyaWEtZGVzY3JpYmVkYnlcIiApLFxuXHRcdFx0XHRzZWxlY3RvciA9IFwibGFiZWxbZm9yPSdcIiArIG5hbWUgKyBcIiddLCBsYWJlbFtmb3I9J1wiICsgbmFtZSArIFwiJ10gKlwiO1xuXG5cdFx0XHQvLyBhcmlhLWRlc2NyaWJlZGJ5IHNob3VsZCBkaXJlY3RseSByZWZlcmVuY2UgdGhlIGVycm9yIGVsZW1lbnRcblx0XHRcdGlmICggZGVzY3JpYmVyICkge1xuXHRcdFx0XHRzZWxlY3RvciA9IHNlbGVjdG9yICsgXCIsICNcIiArIGRlc2NyaWJlci5yZXBsYWNlKCAvXFxzKy9nLCBcIiwgI1wiICk7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpc1xuXHRcdFx0XHQuZXJyb3JzKClcblx0XHRcdFx0LmZpbHRlciggc2VsZWN0b3IgKTtcblx0XHR9LFxuXG5cdFx0aWRPck5hbWU6IGZ1bmN0aW9uKCBlbGVtZW50ICkge1xuXHRcdFx0cmV0dXJuIHRoaXMuZ3JvdXBzWyBlbGVtZW50Lm5hbWUgXSB8fCAoIHRoaXMuY2hlY2thYmxlKCBlbGVtZW50ICkgPyBlbGVtZW50Lm5hbWUgOiBlbGVtZW50LmlkIHx8IGVsZW1lbnQubmFtZSApO1xuXHRcdH0sXG5cblx0XHR2YWxpZGF0aW9uVGFyZ2V0Rm9yOiBmdW5jdGlvbiggZWxlbWVudCApIHtcblxuXHRcdFx0Ly8gSWYgcmFkaW8vY2hlY2tib3gsIHZhbGlkYXRlIGZpcnN0IGVsZW1lbnQgaW4gZ3JvdXAgaW5zdGVhZFxuXHRcdFx0aWYgKCB0aGlzLmNoZWNrYWJsZSggZWxlbWVudCApICkge1xuXHRcdFx0XHRlbGVtZW50ID0gdGhpcy5maW5kQnlOYW1lKCBlbGVtZW50Lm5hbWUgKTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gQWx3YXlzIGFwcGx5IGlnbm9yZSBmaWx0ZXJcblx0XHRcdHJldHVybiAkKCBlbGVtZW50ICkubm90KCB0aGlzLnNldHRpbmdzLmlnbm9yZSApWyAwIF07XG5cdFx0fSxcblxuXHRcdGNoZWNrYWJsZTogZnVuY3Rpb24oIGVsZW1lbnQgKSB7XG5cdFx0XHRyZXR1cm4gKCAvcmFkaW98Y2hlY2tib3gvaSApLnRlc3QoIGVsZW1lbnQudHlwZSApO1xuXHRcdH0sXG5cblx0XHRmaW5kQnlOYW1lOiBmdW5jdGlvbiggbmFtZSApIHtcblx0XHRcdHJldHVybiAkKCB0aGlzLmN1cnJlbnRGb3JtICkuZmluZCggXCJbbmFtZT0nXCIgKyBuYW1lICsgXCInXVwiICk7XG5cdFx0fSxcblxuXHRcdGdldExlbmd0aDogZnVuY3Rpb24oIHZhbHVlLCBlbGVtZW50ICkge1xuXHRcdFx0c3dpdGNoICggZWxlbWVudC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpICkge1xuXHRcdFx0Y2FzZSBcInNlbGVjdFwiOlxuXHRcdFx0XHRyZXR1cm4gJCggXCJvcHRpb246c2VsZWN0ZWRcIiwgZWxlbWVudCApLmxlbmd0aDtcblx0XHRcdGNhc2UgXCJpbnB1dFwiOlxuXHRcdFx0XHRpZiAoIHRoaXMuY2hlY2thYmxlKCBlbGVtZW50ICkgKSB7XG5cdFx0XHRcdFx0cmV0dXJuIHRoaXMuZmluZEJ5TmFtZSggZWxlbWVudC5uYW1lICkuZmlsdGVyKCBcIjpjaGVja2VkXCIgKS5sZW5ndGg7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdHJldHVybiB2YWx1ZS5sZW5ndGg7XG5cdFx0fSxcblxuXHRcdGRlcGVuZDogZnVuY3Rpb24oIHBhcmFtLCBlbGVtZW50ICkge1xuXHRcdFx0cmV0dXJuIHRoaXMuZGVwZW5kVHlwZXNbdHlwZW9mIHBhcmFtXSA/IHRoaXMuZGVwZW5kVHlwZXNbdHlwZW9mIHBhcmFtXSggcGFyYW0sIGVsZW1lbnQgKSA6IHRydWU7XG5cdFx0fSxcblxuXHRcdGRlcGVuZFR5cGVzOiB7XG5cdFx0XHRcImJvb2xlYW5cIjogZnVuY3Rpb24oIHBhcmFtICkge1xuXHRcdFx0XHRyZXR1cm4gcGFyYW07XG5cdFx0XHR9LFxuXHRcdFx0XCJzdHJpbmdcIjogZnVuY3Rpb24oIHBhcmFtLCBlbGVtZW50ICkge1xuXHRcdFx0XHRyZXR1cm4gISEkKCBwYXJhbSwgZWxlbWVudC5mb3JtICkubGVuZ3RoO1xuXHRcdFx0fSxcblx0XHRcdFwiZnVuY3Rpb25cIjogZnVuY3Rpb24oIHBhcmFtLCBlbGVtZW50ICkge1xuXHRcdFx0XHRyZXR1cm4gcGFyYW0oIGVsZW1lbnQgKTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0b3B0aW9uYWw6IGZ1bmN0aW9uKCBlbGVtZW50ICkge1xuXHRcdFx0dmFyIHZhbCA9IHRoaXMuZWxlbWVudFZhbHVlKCBlbGVtZW50ICk7XG5cdFx0XHRyZXR1cm4gISQudmFsaWRhdG9yLm1ldGhvZHMucmVxdWlyZWQuY2FsbCggdGhpcywgdmFsLCBlbGVtZW50ICkgJiYgXCJkZXBlbmRlbmN5LW1pc21hdGNoXCI7XG5cdFx0fSxcblxuXHRcdHN0YXJ0UmVxdWVzdDogZnVuY3Rpb24oIGVsZW1lbnQgKSB7XG5cdFx0XHRpZiAoICF0aGlzLnBlbmRpbmdbIGVsZW1lbnQubmFtZSBdICkge1xuXHRcdFx0XHR0aGlzLnBlbmRpbmdSZXF1ZXN0Kys7XG5cdFx0XHRcdHRoaXMucGVuZGluZ1sgZWxlbWVudC5uYW1lIF0gPSB0cnVlO1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHRzdG9wUmVxdWVzdDogZnVuY3Rpb24oIGVsZW1lbnQsIHZhbGlkICkge1xuXHRcdFx0dGhpcy5wZW5kaW5nUmVxdWVzdC0tO1xuXHRcdFx0Ly8gc29tZXRpbWVzIHN5bmNocm9uaXphdGlvbiBmYWlscywgbWFrZSBzdXJlIHBlbmRpbmdSZXF1ZXN0IGlzIG5ldmVyIDwgMFxuXHRcdFx0aWYgKCB0aGlzLnBlbmRpbmdSZXF1ZXN0IDwgMCApIHtcblx0XHRcdFx0dGhpcy5wZW5kaW5nUmVxdWVzdCA9IDA7XG5cdFx0XHR9XG5cdFx0XHRkZWxldGUgdGhpcy5wZW5kaW5nWyBlbGVtZW50Lm5hbWUgXTtcblx0XHRcdGlmICggdmFsaWQgJiYgdGhpcy5wZW5kaW5nUmVxdWVzdCA9PT0gMCAmJiB0aGlzLmZvcm1TdWJtaXR0ZWQgJiYgdGhpcy5mb3JtKCkgKSB7XG5cdFx0XHRcdCQoIHRoaXMuY3VycmVudEZvcm0gKS5zdWJtaXQoKTtcblx0XHRcdFx0dGhpcy5mb3JtU3VibWl0dGVkID0gZmFsc2U7XG5cdFx0XHR9IGVsc2UgaWYgKCF2YWxpZCAmJiB0aGlzLnBlbmRpbmdSZXF1ZXN0ID09PSAwICYmIHRoaXMuZm9ybVN1Ym1pdHRlZCApIHtcblx0XHRcdFx0JCggdGhpcy5jdXJyZW50Rm9ybSApLnRyaWdnZXJIYW5kbGVyKCBcImludmFsaWQtZm9ybVwiLCBbIHRoaXMgXSk7XG5cdFx0XHRcdHRoaXMuZm9ybVN1Ym1pdHRlZCA9IGZhbHNlO1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHRwcmV2aW91c1ZhbHVlOiBmdW5jdGlvbiggZWxlbWVudCApIHtcblx0XHRcdHJldHVybiAkLmRhdGEoIGVsZW1lbnQsIFwicHJldmlvdXNWYWx1ZVwiICkgfHwgJC5kYXRhKCBlbGVtZW50LCBcInByZXZpb3VzVmFsdWVcIiwge1xuXHRcdFx0XHRvbGQ6IG51bGwsXG5cdFx0XHRcdHZhbGlkOiB0cnVlLFxuXHRcdFx0XHRtZXNzYWdlOiB0aGlzLmRlZmF1bHRNZXNzYWdlKCBlbGVtZW50LCBcInJlbW90ZVwiIClcblx0XHRcdH0pO1xuXHRcdH1cblxuXHR9LFxuXG5cdGNsYXNzUnVsZVNldHRpbmdzOiB7XG5cdFx0cmVxdWlyZWQ6IHsgcmVxdWlyZWQ6IHRydWUgfSxcblx0XHRlbWFpbDogeyBlbWFpbDogdHJ1ZSB9LFxuXHRcdHVybDogeyB1cmw6IHRydWUgfSxcblx0XHRkYXRlOiB7IGRhdGU6IHRydWUgfSxcblx0XHRkYXRlSVNPOiB7IGRhdGVJU086IHRydWUgfSxcblx0XHRudW1iZXI6IHsgbnVtYmVyOiB0cnVlIH0sXG5cdFx0ZGlnaXRzOiB7IGRpZ2l0czogdHJ1ZSB9LFxuXHRcdGNyZWRpdGNhcmQ6IHsgY3JlZGl0Y2FyZDogdHJ1ZSB9XG5cdH0sXG5cblx0YWRkQ2xhc3NSdWxlczogZnVuY3Rpb24oIGNsYXNzTmFtZSwgcnVsZXMgKSB7XG5cdFx0aWYgKCBjbGFzc05hbWUuY29uc3RydWN0b3IgPT09IFN0cmluZyApIHtcblx0XHRcdHRoaXMuY2xhc3NSdWxlU2V0dGluZ3NbIGNsYXNzTmFtZSBdID0gcnVsZXM7XG5cdFx0fSBlbHNlIHtcblx0XHRcdCQuZXh0ZW5kKCB0aGlzLmNsYXNzUnVsZVNldHRpbmdzLCBjbGFzc05hbWUgKTtcblx0XHR9XG5cdH0sXG5cblx0Y2xhc3NSdWxlczogZnVuY3Rpb24oIGVsZW1lbnQgKSB7XG5cdFx0dmFyIHJ1bGVzID0ge30sXG5cdFx0XHRjbGFzc2VzID0gJCggZWxlbWVudCApLmF0dHIoIFwiY2xhc3NcIiApO1xuXG5cdFx0aWYgKCBjbGFzc2VzICkge1xuXHRcdFx0JC5lYWNoKCBjbGFzc2VzLnNwbGl0KCBcIiBcIiApLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0aWYgKCB0aGlzIGluICQudmFsaWRhdG9yLmNsYXNzUnVsZVNldHRpbmdzICkge1xuXHRcdFx0XHRcdCQuZXh0ZW5kKCBydWxlcywgJC52YWxpZGF0b3IuY2xhc3NSdWxlU2V0dGluZ3NbIHRoaXMgXSk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH1cblx0XHRyZXR1cm4gcnVsZXM7XG5cdH0sXG5cblx0YXR0cmlidXRlUnVsZXM6IGZ1bmN0aW9uKCBlbGVtZW50ICkge1xuXHRcdHZhciBydWxlcyA9IHt9LFxuXHRcdFx0JGVsZW1lbnQgPSAkKCBlbGVtZW50ICksXG5cdFx0XHR0eXBlID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoIFwidHlwZVwiICksXG5cdFx0XHRtZXRob2QsIHZhbHVlO1xuXG5cdFx0Zm9yICggbWV0aG9kIGluICQudmFsaWRhdG9yLm1ldGhvZHMgKSB7XG5cblx0XHRcdC8vIHN1cHBvcnQgZm9yIDxpbnB1dCByZXF1aXJlZD4gaW4gYm90aCBodG1sNSBhbmQgb2xkZXIgYnJvd3NlcnNcblx0XHRcdGlmICggbWV0aG9kID09PSBcInJlcXVpcmVkXCIgKSB7XG5cdFx0XHRcdHZhbHVlID0gZWxlbWVudC5nZXRBdHRyaWJ1dGUoIG1ldGhvZCApO1xuXHRcdFx0XHQvLyBTb21lIGJyb3dzZXJzIHJldHVybiBhbiBlbXB0eSBzdHJpbmcgZm9yIHRoZSByZXF1aXJlZCBhdHRyaWJ1dGVcblx0XHRcdFx0Ly8gYW5kIG5vbi1IVE1MNSBicm93c2VycyBtaWdodCBoYXZlIHJlcXVpcmVkPVwiXCIgbWFya3VwXG5cdFx0XHRcdGlmICggdmFsdWUgPT09IFwiXCIgKSB7XG5cdFx0XHRcdFx0dmFsdWUgPSB0cnVlO1xuXHRcdFx0XHR9XG5cdFx0XHRcdC8vIGZvcmNlIG5vbi1IVE1MNSBicm93c2VycyB0byByZXR1cm4gYm9vbFxuXHRcdFx0XHR2YWx1ZSA9ICEhdmFsdWU7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR2YWx1ZSA9ICRlbGVtZW50LmF0dHIoIG1ldGhvZCApO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBjb252ZXJ0IHRoZSB2YWx1ZSB0byBhIG51bWJlciBmb3IgbnVtYmVyIGlucHV0cywgYW5kIGZvciB0ZXh0IGZvciBiYWNrd2FyZHMgY29tcGFiaWxpdHlcblx0XHRcdC8vIGFsbG93cyB0eXBlPVwiZGF0ZVwiIGFuZCBvdGhlcnMgdG8gYmUgY29tcGFyZWQgYXMgc3RyaW5nc1xuXHRcdFx0aWYgKCAvbWlufG1heC8udGVzdCggbWV0aG9kICkgJiYgKCB0eXBlID09PSBudWxsIHx8IC9udW1iZXJ8cmFuZ2V8dGV4dC8udGVzdCggdHlwZSApICkgKSB7XG5cdFx0XHRcdHZhbHVlID0gTnVtYmVyKCB2YWx1ZSApO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIHZhbHVlIHx8IHZhbHVlID09PSAwICkge1xuXHRcdFx0XHRydWxlc1sgbWV0aG9kIF0gPSB2YWx1ZTtcblx0XHRcdH0gZWxzZSBpZiAoIHR5cGUgPT09IG1ldGhvZCAmJiB0eXBlICE9PSBcInJhbmdlXCIgKSB7XG5cdFx0XHRcdC8vIGV4Y2VwdGlvbjogdGhlIGpxdWVyeSB2YWxpZGF0ZSAncmFuZ2UnIG1ldGhvZFxuXHRcdFx0XHQvLyBkb2VzIG5vdCB0ZXN0IGZvciB0aGUgaHRtbDUgJ3JhbmdlJyB0eXBlXG5cdFx0XHRcdHJ1bGVzWyBtZXRob2QgXSA9IHRydWU7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0Ly8gbWF4bGVuZ3RoIG1heSBiZSByZXR1cm5lZCBhcyAtMSwgMjE0NzQ4MzY0NyAoIElFICkgYW5kIDUyNDI4OCAoIHNhZmFyaSApIGZvciB0ZXh0IGlucHV0c1xuXHRcdGlmICggcnVsZXMubWF4bGVuZ3RoICYmIC8tMXwyMTQ3NDgzNjQ3fDUyNDI4OC8udGVzdCggcnVsZXMubWF4bGVuZ3RoICkgKSB7XG5cdFx0XHRkZWxldGUgcnVsZXMubWF4bGVuZ3RoO1xuXHRcdH1cblxuXHRcdHJldHVybiBydWxlcztcblx0fSxcblxuXHRkYXRhUnVsZXM6IGZ1bmN0aW9uKCBlbGVtZW50ICkge1xuXHRcdHZhciBtZXRob2QsIHZhbHVlLFxuXHRcdFx0cnVsZXMgPSB7fSwgJGVsZW1lbnQgPSAkKCBlbGVtZW50ICk7XG5cdFx0Zm9yICggbWV0aG9kIGluICQudmFsaWRhdG9yLm1ldGhvZHMgKSB7XG5cdFx0XHR2YWx1ZSA9ICRlbGVtZW50LmRhdGEoIFwicnVsZVwiICsgbWV0aG9kLmNoYXJBdCggMCApLnRvVXBwZXJDYXNlKCkgKyBtZXRob2Quc3Vic3RyaW5nKCAxICkudG9Mb3dlckNhc2UoKSApO1xuXHRcdFx0aWYgKCB2YWx1ZSAhPT0gdW5kZWZpbmVkICkge1xuXHRcdFx0XHRydWxlc1sgbWV0aG9kIF0gPSB2YWx1ZTtcblx0XHRcdH1cblx0XHR9XG5cdFx0cmV0dXJuIHJ1bGVzO1xuXHR9LFxuXG5cdHN0YXRpY1J1bGVzOiBmdW5jdGlvbiggZWxlbWVudCApIHtcblx0XHR2YXIgcnVsZXMgPSB7fSxcblx0XHRcdHZhbGlkYXRvciA9ICQuZGF0YSggZWxlbWVudC5mb3JtLCBcInZhbGlkYXRvclwiICk7XG5cblx0XHRpZiAoIHZhbGlkYXRvci5zZXR0aW5ncy5ydWxlcyApIHtcblx0XHRcdHJ1bGVzID0gJC52YWxpZGF0b3Iubm9ybWFsaXplUnVsZSggdmFsaWRhdG9yLnNldHRpbmdzLnJ1bGVzWyBlbGVtZW50Lm5hbWUgXSApIHx8IHt9O1xuXHRcdH1cblx0XHRyZXR1cm4gcnVsZXM7XG5cdH0sXG5cblx0bm9ybWFsaXplUnVsZXM6IGZ1bmN0aW9uKCBydWxlcywgZWxlbWVudCApIHtcblx0XHQvLyBoYW5kbGUgZGVwZW5kZW5jeSBjaGVja1xuXHRcdCQuZWFjaCggcnVsZXMsIGZ1bmN0aW9uKCBwcm9wLCB2YWwgKSB7XG5cdFx0XHQvLyBpZ25vcmUgcnVsZSB3aGVuIHBhcmFtIGlzIGV4cGxpY2l0bHkgZmFsc2UsIGVnLiByZXF1aXJlZDpmYWxzZVxuXHRcdFx0aWYgKCB2YWwgPT09IGZhbHNlICkge1xuXHRcdFx0XHRkZWxldGUgcnVsZXNbIHByb3AgXTtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXHRcdFx0aWYgKCB2YWwucGFyYW0gfHwgdmFsLmRlcGVuZHMgKSB7XG5cdFx0XHRcdHZhciBrZWVwUnVsZSA9IHRydWU7XG5cdFx0XHRcdHN3aXRjaCAoIHR5cGVvZiB2YWwuZGVwZW5kcyApIHtcblx0XHRcdFx0Y2FzZSBcInN0cmluZ1wiOlxuXHRcdFx0XHRcdGtlZXBSdWxlID0gISEkKCB2YWwuZGVwZW5kcywgZWxlbWVudC5mb3JtICkubGVuZ3RoO1xuXHRcdFx0XHRcdGJyZWFrO1xuXHRcdFx0XHRjYXNlIFwiZnVuY3Rpb25cIjpcblx0XHRcdFx0XHRrZWVwUnVsZSA9IHZhbC5kZXBlbmRzLmNhbGwoIGVsZW1lbnQsIGVsZW1lbnQgKTtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0fVxuXHRcdFx0XHRpZiAoIGtlZXBSdWxlICkge1xuXHRcdFx0XHRcdHJ1bGVzWyBwcm9wIF0gPSB2YWwucGFyYW0gIT09IHVuZGVmaW5lZCA/IHZhbC5wYXJhbSA6IHRydWU7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0ZGVsZXRlIHJ1bGVzWyBwcm9wIF07XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdC8vIGV2YWx1YXRlIHBhcmFtZXRlcnNcblx0XHQkLmVhY2goIHJ1bGVzLCBmdW5jdGlvbiggcnVsZSwgcGFyYW1ldGVyICkge1xuXHRcdFx0cnVsZXNbIHJ1bGUgXSA9ICQuaXNGdW5jdGlvbiggcGFyYW1ldGVyICkgPyBwYXJhbWV0ZXIoIGVsZW1lbnQgKSA6IHBhcmFtZXRlcjtcblx0XHR9KTtcblxuXHRcdC8vIGNsZWFuIG51bWJlciBwYXJhbWV0ZXJzXG5cdFx0JC5lYWNoKFsgXCJtaW5sZW5ndGhcIiwgXCJtYXhsZW5ndGhcIiBdLCBmdW5jdGlvbigpIHtcblx0XHRcdGlmICggcnVsZXNbIHRoaXMgXSApIHtcblx0XHRcdFx0cnVsZXNbIHRoaXMgXSA9IE51bWJlciggcnVsZXNbIHRoaXMgXSApO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHRcdCQuZWFjaChbIFwicmFuZ2VsZW5ndGhcIiwgXCJyYW5nZVwiIF0sIGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHBhcnRzO1xuXHRcdFx0aWYgKCBydWxlc1sgdGhpcyBdICkge1xuXHRcdFx0XHRpZiAoICQuaXNBcnJheSggcnVsZXNbIHRoaXMgXSApICkge1xuXHRcdFx0XHRcdHJ1bGVzWyB0aGlzIF0gPSBbIE51bWJlciggcnVsZXNbIHRoaXMgXVsgMCBdKSwgTnVtYmVyKCBydWxlc1sgdGhpcyBdWyAxIF0gKSBdO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCB0eXBlb2YgcnVsZXNbIHRoaXMgXSA9PT0gXCJzdHJpbmdcIiApIHtcblx0XHRcdFx0XHRwYXJ0cyA9IHJ1bGVzWyB0aGlzIF0ucmVwbGFjZSgvW1xcW1xcXV0vZywgXCJcIiApLnNwbGl0KCAvW1xccyxdKy8gKTtcblx0XHRcdFx0XHRydWxlc1sgdGhpcyBdID0gWyBOdW1iZXIoIHBhcnRzWyAwIF0pLCBOdW1iZXIoIHBhcnRzWyAxIF0gKSBdO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHRpZiAoICQudmFsaWRhdG9yLmF1dG9DcmVhdGVSYW5nZXMgKSB7XG5cdFx0XHQvLyBhdXRvLWNyZWF0ZSByYW5nZXNcblx0XHRcdGlmICggcnVsZXMubWluICE9IG51bGwgJiYgcnVsZXMubWF4ICE9IG51bGwgKSB7XG5cdFx0XHRcdHJ1bGVzLnJhbmdlID0gWyBydWxlcy5taW4sIHJ1bGVzLm1heCBdO1xuXHRcdFx0XHRkZWxldGUgcnVsZXMubWluO1xuXHRcdFx0XHRkZWxldGUgcnVsZXMubWF4O1xuXHRcdFx0fVxuXHRcdFx0aWYgKCBydWxlcy5taW5sZW5ndGggIT0gbnVsbCAmJiBydWxlcy5tYXhsZW5ndGggIT0gbnVsbCApIHtcblx0XHRcdFx0cnVsZXMucmFuZ2VsZW5ndGggPSBbIHJ1bGVzLm1pbmxlbmd0aCwgcnVsZXMubWF4bGVuZ3RoIF07XG5cdFx0XHRcdGRlbGV0ZSBydWxlcy5taW5sZW5ndGg7XG5cdFx0XHRcdGRlbGV0ZSBydWxlcy5tYXhsZW5ndGg7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHJ1bGVzO1xuXHR9LFxuXG5cdC8vIENvbnZlcnRzIGEgc2ltcGxlIHN0cmluZyB0byBhIHtzdHJpbmc6IHRydWV9IHJ1bGUsIGUuZy4sIFwicmVxdWlyZWRcIiB0byB7cmVxdWlyZWQ6dHJ1ZX1cblx0bm9ybWFsaXplUnVsZTogZnVuY3Rpb24oIGRhdGEgKSB7XG5cdFx0aWYgKCB0eXBlb2YgZGF0YSA9PT0gXCJzdHJpbmdcIiApIHtcblx0XHRcdHZhciB0cmFuc2Zvcm1lZCA9IHt9O1xuXHRcdFx0JC5lYWNoKCBkYXRhLnNwbGl0KCAvXFxzLyApLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0dHJhbnNmb3JtZWRbIHRoaXMgXSA9IHRydWU7XG5cdFx0XHR9KTtcblx0XHRcdGRhdGEgPSB0cmFuc2Zvcm1lZDtcblx0XHR9XG5cdFx0cmV0dXJuIGRhdGE7XG5cdH0sXG5cblx0Ly8gaHR0cDovL2pxdWVyeXZhbGlkYXRpb24ub3JnL2pRdWVyeS52YWxpZGF0b3IuYWRkTWV0aG9kL1xuXHRhZGRNZXRob2Q6IGZ1bmN0aW9uKCBuYW1lLCBtZXRob2QsIG1lc3NhZ2UgKSB7XG5cdFx0JC52YWxpZGF0b3IubWV0aG9kc1sgbmFtZSBdID0gbWV0aG9kO1xuXHRcdCQudmFsaWRhdG9yLm1lc3NhZ2VzWyBuYW1lIF0gPSBtZXNzYWdlICE9PSB1bmRlZmluZWQgPyBtZXNzYWdlIDogJC52YWxpZGF0b3IubWVzc2FnZXNbIG5hbWUgXTtcblx0XHRpZiAoIG1ldGhvZC5sZW5ndGggPCAzICkge1xuXHRcdFx0JC52YWxpZGF0b3IuYWRkQ2xhc3NSdWxlcyggbmFtZSwgJC52YWxpZGF0b3Iubm9ybWFsaXplUnVsZSggbmFtZSApICk7XG5cdFx0fVxuXHR9LFxuXG5cdG1ldGhvZHM6IHtcblxuXHRcdC8vIGh0dHA6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9yZXF1aXJlZC1tZXRob2QvXG5cdFx0cmVxdWlyZWQ6IGZ1bmN0aW9uKCB2YWx1ZSwgZWxlbWVudCwgcGFyYW0gKSB7XG5cdFx0XHQvLyBjaGVjayBpZiBkZXBlbmRlbmN5IGlzIG1ldFxuXHRcdFx0aWYgKCAhdGhpcy5kZXBlbmQoIHBhcmFtLCBlbGVtZW50ICkgKSB7XG5cdFx0XHRcdHJldHVybiBcImRlcGVuZGVuY3ktbWlzbWF0Y2hcIjtcblx0XHRcdH1cblx0XHRcdGlmICggZWxlbWVudC5ub2RlTmFtZS50b0xvd2VyQ2FzZSgpID09PSBcInNlbGVjdFwiICkge1xuXHRcdFx0XHQvLyBjb3VsZCBiZSBhbiBhcnJheSBmb3Igc2VsZWN0LW11bHRpcGxlIG9yIGEgc3RyaW5nLCBib3RoIGFyZSBmaW5lIHRoaXMgd2F5XG5cdFx0XHRcdHZhciB2YWwgPSAkKCBlbGVtZW50ICkudmFsKCk7XG5cdFx0XHRcdHJldHVybiB2YWwgJiYgdmFsLmxlbmd0aCA+IDA7XG5cdFx0XHR9XG5cdFx0XHRpZiAoIHRoaXMuY2hlY2thYmxlKCBlbGVtZW50ICkgKSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmdldExlbmd0aCggdmFsdWUsIGVsZW1lbnQgKSA+IDA7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gJC50cmltKCB2YWx1ZSApLmxlbmd0aCA+IDA7XG5cdFx0fSxcblxuXHRcdC8vIGh0dHA6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9lbWFpbC1tZXRob2QvXG5cdFx0ZW1haWw6IGZ1bmN0aW9uKCB2YWx1ZSwgZWxlbWVudCApIHtcblx0XHRcdC8vIEZyb20gaHR0cDovL3d3dy53aGF0d2cub3JnL3NwZWNzL3dlYi1hcHBzL2N1cnJlbnQtd29yay9tdWx0aXBhZ2Uvc3RhdGVzLW9mLXRoZS10eXBlLWF0dHJpYnV0ZS5odG1sI2UtbWFpbC1zdGF0ZS0lMjh0eXBlPWVtYWlsJTI5XG5cdFx0XHQvLyBSZXRyaWV2ZWQgMjAxNC0wMS0xNFxuXHRcdFx0Ly8gSWYgeW91IGhhdmUgYSBwcm9ibGVtIHdpdGggdGhpcyBpbXBsZW1lbnRhdGlvbiwgcmVwb3J0IGEgYnVnIGFnYWluc3QgdGhlIGFib3ZlIHNwZWNcblx0XHRcdC8vIE9yIHVzZSBjdXN0b20gbWV0aG9kcyB0byBpbXBsZW1lbnQgeW91ciBvd24gZW1haWwgdmFsaWRhdGlvblxuXHRcdFx0cmV0dXJuIHRoaXMub3B0aW9uYWwoIGVsZW1lbnQgKSB8fCAvXlthLXpBLVowLTkuISMkJSYnKitcXC89P15fYHt8fX4tXStAW2EtekEtWjAtOV0oPzpbYS16QS1aMC05LV17MCw2MX1bYS16QS1aMC05XSk/KD86XFwuW2EtekEtWjAtOV0oPzpbYS16QS1aMC05LV17MCw2MX1bYS16QS1aMC05XSk/KSokLy50ZXN0KCB2YWx1ZSApO1xuXHRcdH0sXG5cblx0XHQvLyBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvdXJsLW1ldGhvZC9cblx0XHR1cmw6IGZ1bmN0aW9uKCB2YWx1ZSwgZWxlbWVudCApIHtcblx0XHRcdC8vIGNvbnRyaWJ1dGVkIGJ5IFNjb3R0IEdvbnphbGV6OiBodHRwOi8vcHJvamVjdHMuc2NvdHRzcGxheWdyb3VuZC5jb20vaXJpL1xuXHRcdFx0cmV0dXJuIHRoaXMub3B0aW9uYWwoIGVsZW1lbnQgKSB8fCAvXihodHRwcz98cz9mdHApOlxcL1xcLygoKChbYS16XXxcXGR8LXxcXC58X3x+fFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKXwoJVtcXGRhLWZdezJ9KXxbIVxcJCYnXFwoXFwpXFwqXFwrLDs9XXw6KSpAKT8oKChcXGR8WzEtOV1cXGR8MVxcZFxcZHwyWzAtNF1cXGR8MjVbMC01XSlcXC4oXFxkfFsxLTldXFxkfDFcXGRcXGR8MlswLTRdXFxkfDI1WzAtNV0pXFwuKFxcZHxbMS05XVxcZHwxXFxkXFxkfDJbMC00XVxcZHwyNVswLTVdKVxcLihcXGR8WzEtOV1cXGR8MVxcZFxcZHwyWzAtNF1cXGR8MjVbMC01XSkpfCgoKFthLXpdfFxcZHxbXFx1MDBBMC1cXHVEN0ZGXFx1RjkwMC1cXHVGRENGXFx1RkRGMC1cXHVGRkVGXSl8KChbYS16XXxcXGR8W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pKFthLXpdfFxcZHwtfFxcLnxffH58W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pKihbYS16XXxcXGR8W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pKSlcXC4pKygoW2Etel18W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pfCgoW2Etel18W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pKFthLXpdfFxcZHwtfFxcLnxffH58W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pKihbYS16XXxbXFx1MDBBMC1cXHVEN0ZGXFx1RjkwMC1cXHVGRENGXFx1RkRGMC1cXHVGRkVGXSkpKVxcLj8pKDpcXGQqKT8pKFxcLygoKFthLXpdfFxcZHwtfFxcLnxffH58W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pfCglW1xcZGEtZl17Mn0pfFshXFwkJidcXChcXClcXCpcXCssOz1dfDp8QCkrKFxcLygoW2Etel18XFxkfC18XFwufF98fnxbXFx1MDBBMC1cXHVEN0ZGXFx1RjkwMC1cXHVGRENGXFx1RkRGMC1cXHVGRkVGXSl8KCVbXFxkYS1mXXsyfSl8WyFcXCQmJ1xcKFxcKVxcKlxcKyw7PV18OnxAKSopKik/KT8oXFw/KCgoW2Etel18XFxkfC18XFwufF98fnxbXFx1MDBBMC1cXHVEN0ZGXFx1RjkwMC1cXHVGRENGXFx1RkRGMC1cXHVGRkVGXSl8KCVbXFxkYS1mXXsyfSl8WyFcXCQmJ1xcKFxcKVxcKlxcKyw7PV18OnxAKXxbXFx1RTAwMC1cXHVGOEZGXXxcXC98XFw/KSopPygjKCgoW2Etel18XFxkfC18XFwufF98fnxbXFx1MDBBMC1cXHVEN0ZGXFx1RjkwMC1cXHVGRENGXFx1RkRGMC1cXHVGRkVGXSl8KCVbXFxkYS1mXXsyfSl8WyFcXCQmJ1xcKFxcKVxcKlxcKyw7PV18OnxAKXxcXC98XFw/KSopPyQvaS50ZXN0KCB2YWx1ZSApO1xuXHRcdH0sXG5cblx0XHQvLyBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvZGF0ZS1tZXRob2QvXG5cdFx0ZGF0ZTogZnVuY3Rpb24oIHZhbHVlLCBlbGVtZW50ICkge1xuXHRcdFx0cmV0dXJuIHRoaXMub3B0aW9uYWwoIGVsZW1lbnQgKSB8fCAhL0ludmFsaWR8TmFOLy50ZXN0KCBuZXcgRGF0ZSggdmFsdWUgKS50b1N0cmluZygpICk7XG5cdFx0fSxcblxuXHRcdC8vIGh0dHA6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9kYXRlSVNPLW1ldGhvZC9cblx0XHRkYXRlSVNPOiBmdW5jdGlvbiggdmFsdWUsIGVsZW1lbnQgKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5vcHRpb25hbCggZWxlbWVudCApIHx8IC9eXFxkezR9W1xcL1xcLV0oMD9bMS05XXwxWzAxMl0pW1xcL1xcLV0oMD9bMS05XXxbMTJdWzAtOV18M1swMV0pJC8udGVzdCggdmFsdWUgKTtcblx0XHR9LFxuXG5cdFx0Ly8gaHR0cDovL2pxdWVyeXZhbGlkYXRpb24ub3JnL251bWJlci1tZXRob2QvXG5cdFx0bnVtYmVyOiBmdW5jdGlvbiggdmFsdWUsIGVsZW1lbnQgKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5vcHRpb25hbCggZWxlbWVudCApIHx8IC9eLT8oPzpcXGQrfFxcZHsxLDN9KD86LFxcZHszfSkrKT8oPzpcXC5cXGQrKT8kLy50ZXN0KCB2YWx1ZSApO1xuXHRcdH0sXG5cblx0XHQvLyBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvZGlnaXRzLW1ldGhvZC9cblx0XHRkaWdpdHM6IGZ1bmN0aW9uKCB2YWx1ZSwgZWxlbWVudCApIHtcblx0XHRcdHJldHVybiB0aGlzLm9wdGlvbmFsKCBlbGVtZW50ICkgfHwgL15cXGQrJC8udGVzdCggdmFsdWUgKTtcblx0XHR9LFxuXG5cdFx0Ly8gaHR0cDovL2pxdWVyeXZhbGlkYXRpb24ub3JnL2NyZWRpdGNhcmQtbWV0aG9kL1xuXHRcdC8vIGJhc2VkIG9uIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTHVobi9cblx0XHRjcmVkaXRjYXJkOiBmdW5jdGlvbiggdmFsdWUsIGVsZW1lbnQgKSB7XG5cdFx0XHRpZiAoIHRoaXMub3B0aW9uYWwoIGVsZW1lbnQgKSApIHtcblx0XHRcdFx0cmV0dXJuIFwiZGVwZW5kZW5jeS1taXNtYXRjaFwiO1xuXHRcdFx0fVxuXHRcdFx0Ly8gYWNjZXB0IG9ubHkgc3BhY2VzLCBkaWdpdHMgYW5kIGRhc2hlc1xuXHRcdFx0aWYgKCAvW14wLTkgXFwtXSsvLnRlc3QoIHZhbHVlICkgKSB7XG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1cblx0XHRcdHZhciBuQ2hlY2sgPSAwLFxuXHRcdFx0XHRuRGlnaXQgPSAwLFxuXHRcdFx0XHRiRXZlbiA9IGZhbHNlLFxuXHRcdFx0XHRuLCBjRGlnaXQ7XG5cblx0XHRcdHZhbHVlID0gdmFsdWUucmVwbGFjZSggL1xcRC9nLCBcIlwiICk7XG5cblx0XHRcdC8vIEJhc2luZyBtaW4gYW5kIG1heCBsZW5ndGggb25cblx0XHRcdC8vIGh0dHA6Ly9kZXZlbG9wZXIuZWFuLmNvbS9nZW5lcmFsX2luZm8vVmFsaWRfQ3JlZGl0X0NhcmRfVHlwZXNcblx0XHRcdGlmICggdmFsdWUubGVuZ3RoIDwgMTMgfHwgdmFsdWUubGVuZ3RoID4gMTkgKSB7XG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH1cblxuXHRcdFx0Zm9yICggbiA9IHZhbHVlLmxlbmd0aCAtIDE7IG4gPj0gMDsgbi0tKSB7XG5cdFx0XHRcdGNEaWdpdCA9IHZhbHVlLmNoYXJBdCggbiApO1xuXHRcdFx0XHRuRGlnaXQgPSBwYXJzZUludCggY0RpZ2l0LCAxMCApO1xuXHRcdFx0XHRpZiAoIGJFdmVuICkge1xuXHRcdFx0XHRcdGlmICggKCBuRGlnaXQgKj0gMiApID4gOSApIHtcblx0XHRcdFx0XHRcdG5EaWdpdCAtPSA5O1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0XHRuQ2hlY2sgKz0gbkRpZ2l0O1xuXHRcdFx0XHRiRXZlbiA9ICFiRXZlbjtcblx0XHRcdH1cblxuXHRcdFx0cmV0dXJuICggbkNoZWNrICUgMTAgKSA9PT0gMDtcblx0XHR9LFxuXG5cdFx0Ly8gaHR0cDovL2pxdWVyeXZhbGlkYXRpb24ub3JnL21pbmxlbmd0aC1tZXRob2QvXG5cdFx0bWlubGVuZ3RoOiBmdW5jdGlvbiggdmFsdWUsIGVsZW1lbnQsIHBhcmFtICkge1xuXHRcdFx0dmFyIGxlbmd0aCA9ICQuaXNBcnJheSggdmFsdWUgKSA/IHZhbHVlLmxlbmd0aCA6IHRoaXMuZ2V0TGVuZ3RoKCB2YWx1ZSwgZWxlbWVudCApO1xuXHRcdFx0cmV0dXJuIHRoaXMub3B0aW9uYWwoIGVsZW1lbnQgKSB8fCBsZW5ndGggPj0gcGFyYW07XG5cdFx0fSxcblxuXHRcdC8vIGh0dHA6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9tYXhsZW5ndGgtbWV0aG9kL1xuXHRcdG1heGxlbmd0aDogZnVuY3Rpb24oIHZhbHVlLCBlbGVtZW50LCBwYXJhbSApIHtcblx0XHRcdHZhciBsZW5ndGggPSAkLmlzQXJyYXkoIHZhbHVlICkgPyB2YWx1ZS5sZW5ndGggOiB0aGlzLmdldExlbmd0aCggdmFsdWUsIGVsZW1lbnQgKTtcblx0XHRcdHJldHVybiB0aGlzLm9wdGlvbmFsKCBlbGVtZW50ICkgfHwgbGVuZ3RoIDw9IHBhcmFtO1xuXHRcdH0sXG5cblx0XHQvLyBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvcmFuZ2VsZW5ndGgtbWV0aG9kL1xuXHRcdHJhbmdlbGVuZ3RoOiBmdW5jdGlvbiggdmFsdWUsIGVsZW1lbnQsIHBhcmFtICkge1xuXHRcdFx0dmFyIGxlbmd0aCA9ICQuaXNBcnJheSggdmFsdWUgKSA/IHZhbHVlLmxlbmd0aCA6IHRoaXMuZ2V0TGVuZ3RoKCB2YWx1ZSwgZWxlbWVudCApO1xuXHRcdFx0cmV0dXJuIHRoaXMub3B0aW9uYWwoIGVsZW1lbnQgKSB8fCAoIGxlbmd0aCA+PSBwYXJhbVsgMCBdICYmIGxlbmd0aCA8PSBwYXJhbVsgMSBdICk7XG5cdFx0fSxcblxuXHRcdC8vIGh0dHA6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9taW4tbWV0aG9kL1xuXHRcdG1pbjogZnVuY3Rpb24oIHZhbHVlLCBlbGVtZW50LCBwYXJhbSApIHtcblx0XHRcdHJldHVybiB0aGlzLm9wdGlvbmFsKCBlbGVtZW50ICkgfHwgdmFsdWUgPj0gcGFyYW07XG5cdFx0fSxcblxuXHRcdC8vIGh0dHA6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9tYXgtbWV0aG9kL1xuXHRcdG1heDogZnVuY3Rpb24oIHZhbHVlLCBlbGVtZW50LCBwYXJhbSApIHtcblx0XHRcdHJldHVybiB0aGlzLm9wdGlvbmFsKCBlbGVtZW50ICkgfHwgdmFsdWUgPD0gcGFyYW07XG5cdFx0fSxcblxuXHRcdC8vIGh0dHA6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9yYW5nZS1tZXRob2QvXG5cdFx0cmFuZ2U6IGZ1bmN0aW9uKCB2YWx1ZSwgZWxlbWVudCwgcGFyYW0gKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5vcHRpb25hbCggZWxlbWVudCApIHx8ICggdmFsdWUgPj0gcGFyYW1bIDAgXSAmJiB2YWx1ZSA8PSBwYXJhbVsgMSBdICk7XG5cdFx0fSxcblxuXHRcdC8vIGh0dHA6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9lcXVhbFRvLW1ldGhvZC9cblx0XHRlcXVhbFRvOiBmdW5jdGlvbiggdmFsdWUsIGVsZW1lbnQsIHBhcmFtICkge1xuXHRcdFx0Ly8gYmluZCB0byB0aGUgYmx1ciBldmVudCBvZiB0aGUgdGFyZ2V0IGluIG9yZGVyIHRvIHJldmFsaWRhdGUgd2hlbmV2ZXIgdGhlIHRhcmdldCBmaWVsZCBpcyB1cGRhdGVkXG5cdFx0XHQvLyBUT0RPIGZpbmQgYSB3YXkgdG8gYmluZCB0aGUgZXZlbnQganVzdCBvbmNlLCBhdm9pZGluZyB0aGUgdW5iaW5kLXJlYmluZCBvdmVyaGVhZFxuXHRcdFx0dmFyIHRhcmdldCA9ICQoIHBhcmFtICk7XG5cdFx0XHRpZiAoIHRoaXMuc2V0dGluZ3Mub25mb2N1c291dCApIHtcblx0XHRcdFx0dGFyZ2V0LnVuYmluZCggXCIudmFsaWRhdGUtZXF1YWxUb1wiICkuYmluZCggXCJibHVyLnZhbGlkYXRlLWVxdWFsVG9cIiwgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0JCggZWxlbWVudCApLnZhbGlkKCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHZhbHVlID09PSB0YXJnZXQudmFsKCk7XG5cdFx0fSxcblxuXHRcdC8vIGh0dHA6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9yZW1vdGUtbWV0aG9kL1xuXHRcdHJlbW90ZTogZnVuY3Rpb24oIHZhbHVlLCBlbGVtZW50LCBwYXJhbSApIHtcblx0XHRcdGlmICggdGhpcy5vcHRpb25hbCggZWxlbWVudCApICkge1xuXHRcdFx0XHRyZXR1cm4gXCJkZXBlbmRlbmN5LW1pc21hdGNoXCI7XG5cdFx0XHR9XG5cblx0XHRcdHZhciBwcmV2aW91cyA9IHRoaXMucHJldmlvdXNWYWx1ZSggZWxlbWVudCApLFxuXHRcdFx0XHR2YWxpZGF0b3IsIGRhdGE7XG5cblx0XHRcdGlmICghdGhpcy5zZXR0aW5ncy5tZXNzYWdlc1sgZWxlbWVudC5uYW1lIF0gKSB7XG5cdFx0XHRcdHRoaXMuc2V0dGluZ3MubWVzc2FnZXNbIGVsZW1lbnQubmFtZSBdID0ge307XG5cdFx0XHR9XG5cdFx0XHRwcmV2aW91cy5vcmlnaW5hbE1lc3NhZ2UgPSB0aGlzLnNldHRpbmdzLm1lc3NhZ2VzWyBlbGVtZW50Lm5hbWUgXS5yZW1vdGU7XG5cdFx0XHR0aGlzLnNldHRpbmdzLm1lc3NhZ2VzWyBlbGVtZW50Lm5hbWUgXS5yZW1vdGUgPSBwcmV2aW91cy5tZXNzYWdlO1xuXG5cdFx0XHRwYXJhbSA9IHR5cGVvZiBwYXJhbSA9PT0gXCJzdHJpbmdcIiAmJiB7IHVybDogcGFyYW0gfSB8fCBwYXJhbTtcblxuXHRcdFx0aWYgKCBwcmV2aW91cy5vbGQgPT09IHZhbHVlICkge1xuXHRcdFx0XHRyZXR1cm4gcHJldmlvdXMudmFsaWQ7XG5cdFx0XHR9XG5cblx0XHRcdHByZXZpb3VzLm9sZCA9IHZhbHVlO1xuXHRcdFx0dmFsaWRhdG9yID0gdGhpcztcblx0XHRcdHRoaXMuc3RhcnRSZXF1ZXN0KCBlbGVtZW50ICk7XG5cdFx0XHRkYXRhID0ge307XG5cdFx0XHRkYXRhWyBlbGVtZW50Lm5hbWUgXSA9IHZhbHVlO1xuXHRcdFx0JC5hamF4KCAkLmV4dGVuZCggdHJ1ZSwge1xuXHRcdFx0XHR1cmw6IHBhcmFtLFxuXHRcdFx0XHRtb2RlOiBcImFib3J0XCIsXG5cdFx0XHRcdHBvcnQ6IFwidmFsaWRhdGVcIiArIGVsZW1lbnQubmFtZSxcblx0XHRcdFx0ZGF0YVR5cGU6IFwianNvblwiLFxuXHRcdFx0XHRkYXRhOiBkYXRhLFxuXHRcdFx0XHRjb250ZXh0OiB2YWxpZGF0b3IuY3VycmVudEZvcm0sXG5cdFx0XHRcdHN1Y2Nlc3M6IGZ1bmN0aW9uKCByZXNwb25zZSApIHtcblx0XHRcdFx0XHR2YXIgdmFsaWQgPSByZXNwb25zZSA9PT0gdHJ1ZSB8fCByZXNwb25zZSA9PT0gXCJ0cnVlXCIsXG5cdFx0XHRcdFx0XHRlcnJvcnMsIG1lc3NhZ2UsIHN1Ym1pdHRlZDtcblxuXHRcdFx0XHRcdHZhbGlkYXRvci5zZXR0aW5ncy5tZXNzYWdlc1sgZWxlbWVudC5uYW1lIF0ucmVtb3RlID0gcHJldmlvdXMub3JpZ2luYWxNZXNzYWdlO1xuXHRcdFx0XHRcdGlmICggdmFsaWQgKSB7XG5cdFx0XHRcdFx0XHRzdWJtaXR0ZWQgPSB2YWxpZGF0b3IuZm9ybVN1Ym1pdHRlZDtcblx0XHRcdFx0XHRcdHZhbGlkYXRvci5wcmVwYXJlRWxlbWVudCggZWxlbWVudCApO1xuXHRcdFx0XHRcdFx0dmFsaWRhdG9yLmZvcm1TdWJtaXR0ZWQgPSBzdWJtaXR0ZWQ7XG5cdFx0XHRcdFx0XHR2YWxpZGF0b3Iuc3VjY2Vzc0xpc3QucHVzaCggZWxlbWVudCApO1xuXHRcdFx0XHRcdFx0ZGVsZXRlIHZhbGlkYXRvci5pbnZhbGlkWyBlbGVtZW50Lm5hbWUgXTtcblx0XHRcdFx0XHRcdHZhbGlkYXRvci5zaG93RXJyb3JzKCk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGVycm9ycyA9IHt9O1xuXHRcdFx0XHRcdFx0bWVzc2FnZSA9IHJlc3BvbnNlIHx8IHZhbGlkYXRvci5kZWZhdWx0TWVzc2FnZSggZWxlbWVudCwgXCJyZW1vdGVcIiApO1xuXHRcdFx0XHRcdFx0ZXJyb3JzWyBlbGVtZW50Lm5hbWUgXSA9IHByZXZpb3VzLm1lc3NhZ2UgPSAkLmlzRnVuY3Rpb24oIG1lc3NhZ2UgKSA/IG1lc3NhZ2UoIHZhbHVlICkgOiBtZXNzYWdlO1xuXHRcdFx0XHRcdFx0dmFsaWRhdG9yLmludmFsaWRbIGVsZW1lbnQubmFtZSBdID0gdHJ1ZTtcblx0XHRcdFx0XHRcdHZhbGlkYXRvci5zaG93RXJyb3JzKCBlcnJvcnMgKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0cHJldmlvdXMudmFsaWQgPSB2YWxpZDtcblx0XHRcdFx0XHR2YWxpZGF0b3Iuc3RvcFJlcXVlc3QoIGVsZW1lbnQsIHZhbGlkICk7XG5cdFx0XHRcdH1cblx0XHRcdH0sIHBhcmFtICkgKTtcblx0XHRcdHJldHVybiBcInBlbmRpbmdcIjtcblx0XHR9XG5cblx0fVxuXG59KTtcblxuJC5mb3JtYXQgPSBmdW5jdGlvbiBkZXByZWNhdGVkKCkge1xuXHR0aHJvdyBcIiQuZm9ybWF0IGhhcyBiZWVuIGRlcHJlY2F0ZWQuIFBsZWFzZSB1c2UgJC52YWxpZGF0b3IuZm9ybWF0IGluc3RlYWQuXCI7XG59O1xuXG4vLyBhamF4IG1vZGU6IGFib3J0XG4vLyB1c2FnZTogJC5hamF4KHsgbW9kZTogXCJhYm9ydFwiWywgcG9ydDogXCJ1bmlxdWVwb3J0XCJdfSk7XG4vLyBpZiBtb2RlOlwiYWJvcnRcIiBpcyB1c2VkLCB0aGUgcHJldmlvdXMgcmVxdWVzdCBvbiB0aGF0IHBvcnQgKHBvcnQgY2FuIGJlIHVuZGVmaW5lZCkgaXMgYWJvcnRlZCB2aWEgWE1MSHR0cFJlcXVlc3QuYWJvcnQoKVxuXG52YXIgcGVuZGluZ1JlcXVlc3RzID0ge30sXG5cdGFqYXg7XG4vLyBVc2UgYSBwcmVmaWx0ZXIgaWYgYXZhaWxhYmxlICgxLjUrKVxuaWYgKCAkLmFqYXhQcmVmaWx0ZXIgKSB7XG5cdCQuYWpheFByZWZpbHRlcihmdW5jdGlvbiggc2V0dGluZ3MsIF8sIHhociApIHtcblx0XHR2YXIgcG9ydCA9IHNldHRpbmdzLnBvcnQ7XG5cdFx0aWYgKCBzZXR0aW5ncy5tb2RlID09PSBcImFib3J0XCIgKSB7XG5cdFx0XHRpZiAoIHBlbmRpbmdSZXF1ZXN0c1twb3J0XSApIHtcblx0XHRcdFx0cGVuZGluZ1JlcXVlc3RzW3BvcnRdLmFib3J0KCk7XG5cdFx0XHR9XG5cdFx0XHRwZW5kaW5nUmVxdWVzdHNbcG9ydF0gPSB4aHI7XG5cdFx0fVxuXHR9KTtcbn0gZWxzZSB7XG5cdC8vIFByb3h5IGFqYXhcblx0YWpheCA9ICQuYWpheDtcblx0JC5hamF4ID0gZnVuY3Rpb24oIHNldHRpbmdzICkge1xuXHRcdHZhciBtb2RlID0gKCBcIm1vZGVcIiBpbiBzZXR0aW5ncyA/IHNldHRpbmdzIDogJC5hamF4U2V0dGluZ3MgKS5tb2RlLFxuXHRcdFx0cG9ydCA9ICggXCJwb3J0XCIgaW4gc2V0dGluZ3MgPyBzZXR0aW5ncyA6ICQuYWpheFNldHRpbmdzICkucG9ydDtcblx0XHRpZiAoIG1vZGUgPT09IFwiYWJvcnRcIiApIHtcblx0XHRcdGlmICggcGVuZGluZ1JlcXVlc3RzW3BvcnRdICkge1xuXHRcdFx0XHRwZW5kaW5nUmVxdWVzdHNbcG9ydF0uYWJvcnQoKTtcblx0XHRcdH1cblx0XHRcdHBlbmRpbmdSZXF1ZXN0c1twb3J0XSA9IGFqYXguYXBwbHkodGhpcywgYXJndW1lbnRzKTtcblx0XHRcdHJldHVybiBwZW5kaW5nUmVxdWVzdHNbcG9ydF07XG5cdFx0fVxuXHRcdHJldHVybiBhamF4LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG5cdH07XG59XG5cbi8vIHByb3ZpZGVzIGRlbGVnYXRlKHR5cGU6IFN0cmluZywgZGVsZWdhdGU6IFNlbGVjdG9yLCBoYW5kbGVyOiBDYWxsYmFjaykgcGx1Z2luIGZvciBlYXNpZXIgZXZlbnQgZGVsZWdhdGlvblxuLy8gaGFuZGxlciBpcyBvbmx5IGNhbGxlZCB3aGVuICQoZXZlbnQudGFyZ2V0KS5pcyhkZWxlZ2F0ZSksIGluIHRoZSBzY29wZSBvZiB0aGUganF1ZXJ5LW9iamVjdCBmb3IgZXZlbnQudGFyZ2V0XG5cbiQuZXh0ZW5kKCQuZm4sIHtcblx0dmFsaWRhdGVEZWxlZ2F0ZTogZnVuY3Rpb24oIGRlbGVnYXRlLCB0eXBlLCBoYW5kbGVyICkge1xuXHRcdHJldHVybiB0aGlzLmJpbmQodHlwZSwgZnVuY3Rpb24oIGV2ZW50ICkge1xuXHRcdFx0dmFyIHRhcmdldCA9ICQoZXZlbnQudGFyZ2V0KTtcblx0XHRcdGlmICggdGFyZ2V0LmlzKGRlbGVnYXRlKSApIHtcblx0XHRcdFx0cmV0dXJuIGhhbmRsZXIuYXBwbHkodGFyZ2V0LCBhcmd1bWVudHMpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG59KTtcblxufSkpOyIsIi8qXG4vLyDQsNCy0YLQvi3Qs9GA0LjRgtC40L3QsyDRh9Cw0YLQsC5cbnZhciBMQ19BUEkgPSBMQ19BUEkgfHwge307XG5cblxuZnVuY3Rpb24gX0xDX09QRU4oKSB7XG4gICAgTENfQVBJLm9wZW5fY2hhdF93aW5kb3coKTtcbn1cblxuLy8gTENfQVBJLm9uX2FmdGVyX2xvYWQgPSBmdW5jdGlvbigpXG5MQ19BUEkub25fYmVmb3JlX2xvYWQgPSBmdW5jdGlvbigpXG57XG5cbiAgICB2YXIgY3VzdG9tX3ZhcmlhYmxlcyA9IFtcbiAgICAgICB7IG5hbWU6ICd2aXNpdCcsIHZhbHVlOiAnMScgfVxuICAgIF07XG4gICAgTENfQVBJLnNldF9jdXN0b21fdmFyaWFibGVzKGN1c3RvbV92YXJpYWJsZXMpO1xuXG4vLyAgICBjb25zb2xlLmxvZygnTENfQVBJOkJFRk9SRScpO1xuLy8gICAgaWYoIUxDX0FQSS5jaGF0X3dpbmRvd19tYXhpbWl6ZWQoKSkge1xuLy8gICAgICAgIHNldFRpbWVvdXQoIF9MQ19PUEVOLCAxMDAwKjYwKjEwKTsgLy8gMTAwMCAtIDFj0LXQui5cbi8vICAgIH1cblxuLy9cdGlmKExDX0FQSS5jaGF0X3dpbmRvd19tYXhpbWl6ZWQoKSkge1xuLy8gICAgICAgICAgICAvLyBMQ19BUEkuaGlkZV9jaGF0X3dpbmRvdygpO1xuLy8gICAgICAgICAgICBMQ19BUEkubWluaW1pemVfY2hhdF93aW5kb3coKTtcbi8vICAgICAgICB9XG59O1xuXG5MQ19BUEkub25fYWZ0ZXJfbG9hZCA9IGZ1bmN0aW9uKCkge1xuLy8gICAgY29uc29sZS5sb2coJ0xDX0FQSTpBRlRFUicpO1xuXG4gICAgaWYoTENfQVBJLmNoYXRfd2luZG93X21heGltaXplZCgpKSB7XG4vLyAgICAgICAgICAgIC8vIExDX0FQSS5oaWRlX2NoYXRfd2luZG93KCk7XG4gICAgICAgIExDX0FQSS5taW5pbWl6ZV9jaGF0X3dpbmRvdygpO1xuICAgIH1cblxuICAgICBzZXRUaW1lb3V0KCBfTENfT1BFTiwgMTAwMCo2MCoxMCk7IC8vIDEwMDAgLSAxY9C10LouXG59XG4qL1xuXG4kKGZ1bmN0aW9uKCkge1xuICAgICAgICAkKCcuc2VsZWN0X2ludmVyc2UsIC5zZWxlY3QnKS5zZWxlY3RwaWNrZXIoKTtcblxuXHQkKCcuZGJvZHkgPiAucm93ID4gZGl2OmZpcnN0LWNoaWxkJykub24oJ2NsaWNrJywgZnVuY3Rpb24oZXYpIHtcblx0XHR2YXIgJHRoaXMgPSAkKHRoaXMpO1xuXHRcdGlmICgkKGV2LnRhcmdldCkuY2xvc2VzdCgnLnBvcG92ZXInKS5sZW5ndGgpIHJldHVybjtcblx0XHRpZiAoJHRoaXMuaGFzQ2xhc3MoJ2FjdGl2ZScpKSB7XG5cdFx0XHQkdGhpcy5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdCQoJy5kYm9keSA+IC5yb3cgPiBkaXYnKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG5cdFx0XHQkdGhpcy5hZGRDbGFzcygnYWN0aXZlJyk7XG5cdFx0fVxuXHR9KTtcblxuXHQkKHdpbmRvdykuc2Nyb2xsKGZ1bmN0aW9uKCkge1xuXHRcdGlmICgkKHRoaXMpLnNjcm9sbFRvcCgpID4gMTAwKSB7XG5cdFx0XHQkKCcuZ29fdXAnKS5mYWRlSW4oKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0JCgnLmdvX3VwJykuZmFkZU91dCgpO1xuXHRcdH1cblx0fSk7XG5cdC8vIHNjcm9sbCBib2R5IHRvIDBweCBvbiBjbGlja1xuXHQkKCcuZ29fdXAnKS5vbihcImNsaWNrXCIsIGZ1bmN0aW9uKCkge1xuXHRcdCQoJ2JvZHksaHRtbCcpLmFuaW1hdGUoe1xuXHRcdFx0c2Nyb2xsVG9wOiAwXG5cdFx0fSwgODAwKTtcblx0XHRyZXR1cm4gZmFsc2U7XG5cdH0pO1xuXG5cbiAgICAkKCcubGVhcm4tYWJvdXQtbGluaycpLmNsaWNrKGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHZhciBocmVmPSQodGhpcykuYXR0cignaHJlZicpO1xuICAgICAgICB2YXIgdGFyZ2V0PSQoaHJlZik7XG4gICAgICAgIHZhciB0b3A9dGFyZ2V0Lm9mZnNldCgpLnRvcDtcbiAgICAgICAgJCgnaHRtbCxib2R5JykuYW5pbWF0ZSh7XG4gICAgICAgICAgICBzY3JvbGxUb3A6IHRvcFxuICAgICAgICB9LCA4MDApO1xuICAgIH0pO1xuXG4gICAgICAgIC8vIHNjcm9sbCBib2R5IG9uIGNsaWNrXG4gICAgICAgIGlmKCQoJy5nb19ibG9ja19zY3JvbGwnKS5sZW5ndGgpIHtcbiAgICAgICAgICAgJCgnLmdvX2Jsb2NrX3Njcm9sbCcpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBpZCA9ICgkKHRoaXMpLmF0dHIoJ2RhdGEtZ28tYmxvY2snKSkgPyAnIycuJCh0aGlzKS5hdHRyKCdkYXRhLWdvLWJsb2NrJykgOiAoJCh0aGlzKS5hdHRyKCdocmVmJykpID8gJCh0aGlzKS5hdHRyKCdocmVmJykgOiBmYWxzZTtcbiAgICAgICAgICAgICAgICBpZihpZCAmJiAkKCBpZCApLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAkKCdodG1sLCBib2R5JykuYW5pbWF0ZSgge1xuICAgICAgICAgICAgICAgICAgICAgICAgc2Nyb2xsVG9wOiBNYXRoLmNlaWwoICQoIGlkICkub2Zmc2V0KCkudG9wICkgLy8gTWF0aC5jZWlsKCh0YXJnZXRfdG9wICogJCh3aW5kb3cpLm91dGVySGVpZ2h0KHRydWUpKSAvICQoJ2h0bWwsIGJvZHknKS5oZWlnaHQoKSlcbiAgICAgICAgICAgICAgICAgICAgfSwnbGluZWFyJyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgIH0pO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gZ2EgZm9ybVxuICAgICAgICAvLyDQstCw0YDQuNCw0L3RgiAxXG4vLyAgICAgICAgZ2EoZnVuY3Rpb24odHJhY2tlcikge1xuLy8gICAgICAgICAgdmFyIGxpbmtlclBhcmFtID0gdHJhY2tlci5nZXQoJ2xpbmtlclBhcmFtJyk7XG4vLyAgICAgICAgICBjb25zb2xlLmxvZyggbGlua2VyUGFyYW0gKTtcbi8vICAgICAgICB9KTtcblxuICAgICAgIGlmKCQoJ2Zvcm1bbmFtZT1cInByaWNlX3ByZW1pdW1fYm90dG9tXCJdLCBmb3JtW25hbWU9XCJwcmljZV9iYXNpY19ib3R0b21cIl0sIGZvcm1bbmFtZT1cInByaWNlX3ByZW1pdW1cIl0sIGZvcm1bbmFtZT1cInByaWNlX2Jhc2ljXCJdJykubGVuZ3RoKSB7XG4gICAgICAgICQoJ2Zvcm1bbmFtZT1cInByaWNlX3ByZW1pdW1fYm90dG9tXCJdLCBmb3JtW25hbWU9XCJwcmljZV9iYXNpY19ib3R0b21cIl0sIGZvcm1bbmFtZT1cInByaWNlX3ByZW1pdW1cIl0sIGZvcm1bbmFtZT1cInByaWNlX2Jhc2ljXCJdJykuc3VibWl0KGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBnYSgnbGlua2VyOmRlY29yYXRlJywgdGhpcyk7XG4gICAgICAgIH0pO1xuICAgICAgIH1cbn0pO1xuIiwiJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKXsgXG5cbiAgICAvLyBjcmVhdGUgY29va2llXG4gICAgaWYodHlwZW9mICQuY29va2llKCdwb3BVcF9lbWFpbCcpID09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgJC5jb29raWUoJ3BvcFVwX2VtYWlsJywgMCwgeyAgXG4gICAgICAgICAgICBleHBpcmVzOiAxIC8vINGD0YHRgtCw0L3QvtCy0LjRgtGMINC90LAg0YHRg9GC0LrQuCAgXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICAvKlxuICAgICQoJ2h0bWwnKS5tb3VzZWxlYXZlKGZ1bmN0aW9uKCl7XG4gICAgICAgIC8vIGNvbnNvbGUubG9nKCAnT3V0IHdpbmRvd3MhICcsICQuY29va2llKCdwb3BVcF9lbWFpbCcpLCB0eXBlb2YoJC5jb29raWUoJ3BvcFVwX2VtYWlsJykpICk7XG4gICAgICAgIGlmKHR5cGVvZiAkLmNvb2tpZSgncG9wVXBfZW1haWwnKSAhPT0gXCJ1bmRlZmluZWRcIiBcbiAgICAgICAgICAgICAgICAmJiAhcGFyc2VJbnQoICQuY29va2llKCdwb3BVcF9lbWFpbCcpICkpIHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgdmFyICRfcG9wVXAgPSAkKCcuYm94LXBvcFVwJyksXG4gICAgICAgICAgICAgICAgJGJveF9lbWFpbCA9ICRfcG9wVXAuZmluZCgnI2JveC1lbWFpbCcpO1xuXG4gICAgICAgICAgICBpZighJGJveF9lbWFpbC5sZW5ndGgpIHsgXG4gICAgICAgICAgICAgICAgJGJveF9lbWFpbCA9ICRfcG9wVXBcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoIF9odG1sUG9wVXAuYm94X2VtYWlsIClcbiAgICAgICAgICAgICAgICAgICAgICAgIC5maW5kKCcjYm94LWVtYWlsJyk7IFxuICAgICAgICAgICAgfSBcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgJGJveF9lbWFpbC5iUG9wdXAoe1xuICAgICAgICAgICAgICAgICAgICBtb2RhbENsb3NlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBhcHBlbmRpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLjYsXG4gICAgICAgICAgICAgICAgICAgIGZvbGxvdzogW2ZhbHNlLCBmYWxzZV0sIFxuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvblN0eWxlOiAnZml4ZWQnLCAvLydmaXhlZCcgb3IgJ2Fic29sdXRlJ1xuICAgICAgICAgICAgICAgICAgICBvbk9wZW46IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcG9wVXBWYWxpZGF0ZSgpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBjbG9zZUNsYXNzOiAnY2xvc2UnLFxuICAgICAgICAgICAgICAgICAgICBvbkNsb3NlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgfSxcblxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgICQuY29va2llKCdwb3BVcF9lbWFpbCcsIDEpOyAvLyBwb3BVcCBpbm91dCBwdXQgb25lLlxuICAgICAgICB9XG4gICAgICAgIFxuICAgIH0pO1xuICAgICovXG4gICAgXG4gICAgLy8gZm9ybSBwb3BVcFxuICAgICQoJy5ibG9jay1wb3BVcC1jbG9zZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgX3BvcFVwID0gJCh0aGlzKS5wYXJlbnRzKCcucG9wVXAnKSwgJHRoaXMgPSAkKHRoaXMpO1xuICAgICAgICBfcG9wVXAuYlBvcHVwKCkuY2xvc2UoKTtcbiAgICB9KTtcblxufSk7XG5cbmZ1bmN0aW9uIHBvcFVwVmFsaWRhdGUoKSB7XG4gICAgXG4gICAgJCgnZm9ybS5ibG9jay1wb3B1cC1mb3JtJykudmFsaWRhdGUoe1xuICAgICAgICBvbmZvY3Vzb3V0OiBmYWxzZSxcbiAgICAgICAgb25rZXl1cDogZmFsc2UsXG4gICAgICAgIG9uY2xpY2s6IHRydWUsXG4gICAgICAgIG9uc3VibWl0OiB0cnVlLFxuICAgICAgICBmb2N1c0ludmFsaWQ6IGZhbHNlLFxuICAgICAgICBmb2N1c0NsZWFudXA6IGZhbHNlLFxuICAgICAgICBlbWFpbDoge1xuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICBlbWFpbDogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICBtZXNzYWdlczoge1xuICAgICAgICAgICAgZW1haWw6IHtcbiAgICAgICAgICAgICAgICByZXF1aXJlZDogXCJUaGUgRW1haWwgZmllbGQgaXMgZW1wdHlcIixcbiAgICAgICAgICAgICAgICBlbWFpbDogXCJQbGVhc2UgZW50ZXIgY29ycmVjdCBlbWFpbFwiXG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgXG4gICAgICAgIGVycm9yQ2xhc3M6IFwiZXJyb3JcIixcbiAgICAgICAgdmFsaWRDbGFzczogXCJzdWNjZXNzXCIsXG4gICAgICAgIGludmFsaWRIYW5kbGVyOiBmdW5jdGlvbihldmVudCwgdmFsaWRhdG9yKSB7XG4gICAgICAgICAgICBpZigkKCdmb3JtLmJsb2NrLXBvcHVwLWZvcm0gZGl2LmVycm9yJykubGVuZ3RoKVxuICAgICAgICAgICAgICAgICQoJ2Zvcm0uYmxvY2stcG9wdXAtZm9ybSBkaXYuZXJyb3InKS5odG1sKCBcIiBcIiApLmhpZGUoKTtcbiAgICAgICAgfSxcbiAgICAgICAgLy8g0YPQv9GA0LDQstC70LXQvdC40LUg0L7RiNC40LHQutCw0LzQuFxuICAgICAgICBzaG93RXJyb3JzOiBmdW5jdGlvbihlcnJvck1hcCwgZXJyb3JMaXN0KSB7XG4gICAgICAgICAgICB2YXIgbXNnID0gbnVsbDtcbiAgICAgICAgICAgICQuZWFjaChlcnJvckxpc3QsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgIG1zZyA9IHRoaXMubWVzc2FnZSArICc8YnIgLz4nOyB9KTtcbiAgICAgICAgICAgICBcbiAgICAgICAgICAgIGlmKG1zZyAhPT0gbnVsbCkgXG4gICAgICAgICAgICAgICAgJChcImZvcm0uYmxvY2stcG9wdXAtZm9ybSBkaXYuZXJyb3JcIikuaHRtbChtc2cpLnNob3coKTtcbiAgICAgICAgfSxcblxuICAgICAgICBzdWJtaXRIYW5kbGVyOiBmdW5jdGlvbiggZm9ybSApIHsgLy8gc3VibWl0SGFuZGxlclxuICAgICAgICAgICAgdmFyICRmb3JtID0gJChmb3JtKSwgX3BhcmFtcyA9IHBhcnNlUXVlcnkoJGZvcm0uc2VyaWFsaXplQXJyYXkoKSk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmKCQoJ2Zvcm0uYmxvY2stcG9wdXAtZm9ybSBkaXYuZXJyb3InKS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgJCgnZm9ybS5ibG9jay1wb3B1cC1mb3JtIGRpdi5lcnJvcicpLmh0bWwoIFwiIFwiICkuaGlkZSgpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBkaXNhYmxlZCBidXR0b25cbiAgICAgICAgICAgICRmb3JtLmZpbmQoJ2J1dHRvbicpLnByb3AoIFwiZGlzYWJsZWRcIiwgdHJ1ZSApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHZhciBqcVhIUiA9IF9nZXRBSkFYKCBcbiAgICAgICAgICAgICAgICAnaHR0cDovL3B1bXBpYy5jb20vcG9wdXBfZW1haWxfc2VuZC5odG1sJywgXG4gICAgICAgICAgICAgICAgX3BhcmFtcywge1xuICAgICAgICAgICAgICAgICAgICAnZGF0YVR5cGUnOiAnanNvbnAnLFxuICAgICAgICAgICAgICAgICAgICAnY3Jvc3NEb21haW4nOiB0cnVlLFxuICAgICAgICAgICAgICAgIH0gXG4gICAgICAgICAgICApO1xuICAgIFxuICAgICAgICAgICAgaWYodHlwZW9mIGpxWEhSID09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAgICAganFYSFJcbiAgICAgICAgICAgICAgICAuZG9uZShmdW5jdGlvbihkYXRhLCB0ZXh0U3RhdHVzLCBqcVhIUikge1xuICAgICAgICAgICAgICAgICAgICBpZih0ZXh0U3RhdHVzID09ICdzdWNjZXNzJykge1xuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIGRhdGEgKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGRhdGEuZXJyb3IpIHsgXG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBkYXRhLmVycm9yID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2goZGF0YS5lcnJvciwgZnVuY3Rpb24obmFtZSwgdGV4dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9vYmogPSAkZm9ybS5maW5kKCdpbnB1dFtuYW1lPVwiJytuYW1lKydcIl0nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKF9vYmoubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoX29iai5uZXh0KCdsYWJlbCcpLmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX29iai5uZXh0KCkuaHRtbCggdGV4dCApLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJ2Zvcm0uYmxvY2stcG9wdXAtZm9ybSBkaXYuZXJyb3InKS5odG1sKCB0ZXh0ICkuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyQoJzxsYWJlbCBpZD1cIicrbmFtZSsnLWVycm9yXCIgZm9yPVwiJytuYW1lKydcIiBjbGFzcz1cImVycm9yXCI+Jyt0ZXh0Kyc8L2xhYmVsPicpLmluc2VydEFmdGVyKF9vYmopOyBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCdmb3JtLmJsb2NrLXBvcHVwLWZvcm0gZGl2LmVycm9yJykuaHRtbCggZGF0YS5lcnJvciApLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBkaXNhYmxlZCBidXR0b25cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZm9ybS5maW5kKCdidXR0b24nKS5wcm9wKCBcImRpc2FibGVkXCIsIGZhbHNlICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmKGRhdGEuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGdvb2dsZSBhbmFsaXR5Y3NcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBnYSgnc2VuZCcsICdldmVudCcsICdmb3JtJywgJ3N1Ym1pdCcsICdjb21wYXRpYmlsaXR5LXJlcXVlc3Qtc3VjY2VzcycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkX3BvcFVwID0gJCgnLmJveC1wb3BVcCcpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZW1haWxfc3VjY2VzcyA9ICRfcG9wVXAuZmluZCgnI2JveC1lbWFpbC1zdWNjZXNzJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKCEkZW1haWxfc3VjY2Vzcy5sZW5ndGgpIHsgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRlbWFpbF9zdWNjZXNzID0gJF9wb3BVcFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoIF9odG1sUG9wVXAuZW1haWxfc3VjY2VzcyApXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLmZpbmQoJyNib3gtZW1haWwtc3VjY2VzcycpOyBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2xvc2UgcG9wVXBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZigkKCcuYm94LXBvcFVwID4gLnBvcFVwJykuaXMoJzp2aXNpYmxlJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnLmJveC1wb3BVcCA+IC5wb3BVcCcpLmJQb3B1cCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cmFuc2l0aW9uOiAnZmFkZU91dCdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZW1haWxfc3VjY2Vzcy5iUG9wdXAoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWxDbG9zZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZGluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLjYsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb2xsb3c6IFtmYWxzZSwgZmFsc2VdLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uU3R5bGU6ICdmaXhlZCcsIC8vJ2ZpeGVkJyBvciAnYWJzb2x1dGUnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbk9wZW46IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlQ2xhc3M6ICdjbG9zZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvbkNsb3NlOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJ2Zvcm0uYmxvY2stcG9wdXAtZm9ybSBkaXYuZXJyb3InKS5odG1sKCdZb3VyIGVtYWlsIHdhcyBub3Qgc2VudCcpLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdTeXN0ZW0gZXJyb3IgJysgdGV4dFN0YXR1cyArJyEnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGRpc2FibGVkIGJ1dHRvblxuICAgICAgICAgICAgICAgICAgICAgICAgJGZvcm0uZmluZCgnYnV0dG9uJykucHJvcCggXCJkaXNhYmxlZFwiLCBmYWxzZSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC5mYWlsICAoZnVuY3Rpb24oanFYSFIsIHRleHRTdGF0dXMsIGVycm9yVGhyb3duKSB7IFxuICAgICAgICAgICAgICAgICAgICAkKCdmb3JtLmJsb2NrLXBvcHVwLWZvcm0gZGl2LmVycm9yJykuaHRtbCgnWW91ciBlbWFpbCB3YXMgbm90IHNlbnQnKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnU3lzdGVtIGVycm9yIChKU09QOlJFUVVFU1QpIScpO1xuICAgICAgICAgICAgICAgICAgICAvLyBkaXNhYmxlZCBidXR0b25cbiAgICAgICAgICAgICAgICAgICAgJGZvcm0uZmluZCgnYnV0dG9uJykucHJvcCggXCJkaXNhYmxlZFwiLCBmYWxzZSApO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICQoJ2Zvcm0uYmxvY2stcG9wdXAtZm9ybSBkaXYuZXJyb3InKS5odG1sKCdZb3VyIGVtYWlsIHdhcyBub3Qgc2VudCcpLnNob3coKTtcbiAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1N5c3RlbSBlcnJvciAoQ1JFQVRFOk9CSkVDVCkhJyk7XG4gICAgICAgICAgICAgICAgLy8gZGlzYWJsZWQgYnV0dG9uXG4gICAgICAgICAgICAgICAgJGZvcm0uZmluZCgnYnV0dG9uJykucHJvcCggXCJkaXNhYmxlZFwiLCBmYWxzZSApO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLyoganNvblxuICAgICAgICAgICAgdmFyIF9yZXMgPSBnZXRBamF4Rm9ybSgnaHR0cDovL3B1bXBpYy5jb20vcG9wdXBfZW1haWxfc2VuZC5odG1sJywgX3BhcmFtcywge1xuICAgICAgICAgICAgICAgICdkYXRhVHlwZSc6ICdqc29uJyxcbiAgICAgICAgICAgICAgICAnY3Jvc3NEb21haW4nOiB0cnVlLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBpZih0eXBlb2YgX3JlcyA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgICAgICBpZihfcmVzLmVycm9yKSB7IFxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mIF9yZXMuZXJyb3IgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2goX3Jlcy5lcnJvciwgZnVuY3Rpb24obmFtZSwgdGV4dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfb2JqID0gJGZvcm0uZmluZCgnaW5wdXRbbmFtZT1cIicrbmFtZSsnXCJdJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoX29iai5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoX29iai5uZXh0KCdsYWJlbCcpLmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9vYmoubmV4dCgpLmh0bWwoIHRleHQgKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJ2Zvcm0uYmxvY2stcG9wdXAtZm9ybSBkaXYuZXJyb3InKS5odG1sKCB0ZXh0ICkuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8kKCc8bGFiZWwgaWQ9XCInK25hbWUrJy1lcnJvclwiIGZvcj1cIicrbmFtZSsnXCIgY2xhc3M9XCJlcnJvclwiPicrdGV4dCsnPC9sYWJlbD4nKS5pbnNlcnRBZnRlcihfb2JqKTsgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJ2Zvcm0uYmxvY2stcG9wdXAtZm9ybSBkaXYuZXJyb3InKS5odG1sKCBfcmVzLmVycm9yICkuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAvLyBkaXNhYmxlZCBidXR0b25cbiAgICAgICAgICAgICAgICAgICAgJGZvcm0uZmluZCgnYnV0dG9uJykucHJvcCggXCJkaXNhYmxlZFwiLCBmYWxzZSApO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmKF9yZXMuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICAvLyBnb29nbGUgYW5hbGl0eWNzXG4gICAgICAgICAgICAgICAgICAgIC8vIGdhKCdzZW5kJywgJ2V2ZW50JywgJ2Zvcm0nLCAnc3VibWl0JywgJ2NvbXBhdGliaWxpdHktcmVxdWVzdC1zdWNjZXNzJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgXG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY2xvc2UgcG9wVXBcbiAgICAgICAgICAgICAgICAgICAgaWYoJCgnLmJveC1wb3BVcCA+IC5wb3BVcCcpLmlzKCc6dmlzaWJsZScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcuYm94LXBvcFVwID4gI2JveC1lbWFpbCcpLmJQb3B1cCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbjogJ2ZhZGVPdXQnXG4gICAgICAgICAgICAgICAgICAgICAgICB9KS5jbG9zZSgpO1xuICAgICAgICAgICAgICAgICAgICB9ICAgICAgICBcblxuICAgICAgICAgICAgICAgICAgICAkKCcuYm94LXBvcFVwID4gI2JveC1lbWFpbC1zdWNjZXNzJykuYlBvcHVwKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RhbENsb3NlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFwcGVuZGluZzogZmFsc2UsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMC42LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvbGxvdzogW2ZhbHNlLCBmYWxzZV0sIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uU3R5bGU6ICdmaXhlZCcsIC8vJ2ZpeGVkJyBvciAnYWJzb2x1dGUnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25PcGVuOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsb3NlQ2xhc3M6ICdjbG9zZScsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbG9zZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnZm9ybS5ibG9jay1wb3B1cC1mb3JtIGRpdi5lcnJvcicpLmh0bWwoJ1lvdXIgZW1haWwgd2FzIG5vdCBzZW50Jykuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnU3lzdGVtIGVycm9yIScpO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgLy8gZGlzYWJsZWQgYnV0dG9uXG4gICAgICAgICAgICAgICAgICAgICRmb3JtLmZpbmQoJ2J1dHRvbicpLnByb3AoIFwiZGlzYWJsZWRcIiwgZmFsc2UgKTtcbiAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICQoJ2Zvcm0uYmxvY2stcG9wdXAtZm9ybSBkaXYuZXJyb3InKS5odG1sKCdZb3VyIGVtYWlsIHdhcyBub3Qgc2VudCcpLnNob3coKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBkaXNhYmxlZCBidXR0b25cbiAgICAgICAgICAgICAgICAkZm9ybS5maW5kKCdidXR0b24nKS5wcm9wKCBcImRpc2FibGVkXCIsIGZhbHNlICk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgKi9cbiAgICAgICAgICAgICRmb3JtLnRyaWdnZXIoXCJyZXNldFwiKTsgXG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBcbn0iLCIvLyBkZXRlY3RlZCBpbWFnZSBvbmxvYWRcbjsoZnVuY3Rpb24gKCQpIHtcbiAgICAkLmZuLmJpbmRJbWFnZUxvYWQgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgZnVuY3Rpb24gaXNJbWFnZUxvYWRlZChpbWcpIHtcbiAgICAgICAgICAgIC8vINCS0L4g0LLRgNC10LzRjyDRgdC+0LHRi9GC0LjRjyBsb2FkIElFINC4INC00YDRg9Cz0LjQtSDQsdGA0LDRg9C30LXRgNGLINC/0YDQsNCy0LjQu9GM0L3QvlxuICAgICAgICAgICAgLy8g0L7Qv9GA0LXQtNC10LvRj9GO0YIg0YHQvtGB0YLQvtGP0L3QuNC1INC60LDRgNGC0LjQvdC60Lgg0YfQtdGA0LXQtyDQsNGC0YDQuNCx0YPRgiBjb21wbGV0ZS5cbiAgICAgICAgICAgIC8vINCY0YHQutC70Y7Rh9C10L3QuNC1INGB0L7RgdGC0LDQstC70Y/RjtGCIEdlY2tvLWJhc2VkINCx0YDQsNGD0LfQtdGA0YsuXG4gICAgICAgICAgICBpZiAoIWltZy5jb21wbGV0ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vINCi0LXQvCDQvdC1INC80LXQvdC10LUsINGDINC90LjRhSDQtdGB0YLRjCDQtNCy0LAg0L7Rh9C10L3RjCDQv9C+0LvQtdC30L3Ri9GFINGB0LLQvtC50YHRgtCy0LA6IG5hdHVyYWxXaWR0aCDQuCBuYXR1cmFsSGVpZ2h0LlxuICAgICAgICAgICAgLy8g0J7QvdC4INC00LDRjtGCINC40YHRgtC40L3QvdGL0Lkg0YDQsNC30LzQtdGAINC40LfQvtCx0YDQsNC20LXQvdC40Y8uINCV0YHQu9C4INC60LDQutGA0YLQuNC90LrQsCDQtdGJ0LUg0L3QtSDQt9Cw0LPRgNGD0LfQuNC70LDRgdGMLFxuICAgICAgICAgICAgLy8g0YLQviDQvtC90Lgg0LTQvtC70LbQvdGLINCx0YvRgtGMINGA0LDQstC90Ysg0L3Rg9C70Y4uXG4gICAgICAgICAgICBpZiAodHlwZW9mIGltZy5uYXR1cmFsV2lkdGggIT09IFwidW5kZWZpbmVkXCIgJiYgaW1nLm5hdHVyYWxXaWR0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vINCa0LDRgNGC0LjQvdC60LAg0LfQsNCz0YDRg9C20LXQvdCwLlxuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cblxuICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHZhciBlbGUgPSAkKHRoaXMpO1xuICAgICAgICAgICAgaWYgKGVsZS5pcyhcImltZ1wiKSAmJiAkLmlzRnVuY3Rpb24oY2FsbGJhY2spKSB7XG4gICAgICAgICAgICAgICAgZWxlLm9uZShcImxvYWRcIiwgY2FsbGJhY2spO1xuICAgICAgICAgICAgICAgIGlmIChpc0ltYWdlTG9hZGVkKHRoaXMpKSB7XG4gICAgICAgICAgICAgICAgICAgIGVsZS50cmlnZ2VyKFwibG9hZFwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG59KShqUXVlcnkpO1xuXG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpeyBcbiAgICAvKiBjYXBjaGEgcmVzaXplICovXG4gIGlmKCQoJ2Zvcm0gLmJveC1jYXB0Y2hhID4gaW1nJykubGVuZ3RoKSB7IFxuICAgICAgJCgnZm9ybSAuYm94LWNhcHRjaGEgPiBpbWcnKS5iaW5kSW1hZ2VMb2FkKGZ1bmN0aW9uKCkgeyBcbiAgICAgICAgICAgIHZhciBfYmNhcHRjaGEgPSAkKHRoaXMpLnBhcmVudHMoJy5ib3gtY2FwdGNoYScpLCBfYmN3ID0gX2JjYXB0Y2hhLndpZHRoKCksXG4gICAgICAgICAgICBfd2lkdGggPSAkKHRoaXMpLndpZHRoKCksIHdpZHRoID0gJCh0aGlzKS5vdXRlcldpZHRoKHRydWUpLFxuICAgICAgICAgICAgX3VwZGF0ZSA9IF9iY2FwdGNoYS5maW5kKCcudXBkYXRlLWNhcHRjaGEnKTtcbiAgICAgICAgICAgICQodGhpcykuY3NzKHsnd2lkdGgnOiAoX2JjdyAtIDU0KSsncHgnfSk7XG4gICAgICAgICAgICBfdXBkYXRlLmF0dHIoJ2F0dHItd2lkdGgnLCBfYmN3IC0gNTQpO1xuICAgICAgfSk7XG4gIH0gIFxuICAgIFxuICAgIC8qIGltYWdlcyBtb2JpbGUgKi9cbiAgaWYoJCgnI2JveC1jb250ZW50LXBvc3QgaW1nLCAjYmxvY2stY29udGVudCBpbWcnKS5sZW5ndGgpIHtcbiAgICAgIFxuICAgICAgXG4gICAgICAvLyQoJyNib3gtY29udGVudC1wb3N0IGltZycpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAkKCcjYm94LWNvbnRlbnQtcG9zdCBpbWcsICNibG9jay1jb250ZW50IGltZycpLmJpbmRJbWFnZUxvYWQoZnVuY3Rpb24oKSB7ICAgIFxuICAgICAgICAgIFxuICAgICAgICAgIHZhciB3aWR0aCA9ICQodGhpcykuYXR0cignd2lkdGgnKSxcbiAgICAgICAgICAgICAgcGFyZW50ID0gJCh0aGlzKS5jbG9zZXN0KCcud3AtY2FwdGlvbicpLCBcbiAgICAgICAgICAgICAgX2NhcHRpb25fdGV4dCA9IHBhcmVudC5maW5kKCcud3AtY2FwdGlvbi10ZXh0JyksXG4gICAgICAgICAgICAgICAgX3NyYyA9ICQodGhpcykuYXR0cignc3JjJyksXG4gICAgICAgICAgICAgICAgaGVpZ2h0ID0gJCh0aGlzKS5hdHRyKCdoZWlnaHQnKSxcbiAgICAgICAgICAgICAgICBvdXRlcl93aWR0aCA9ICQodGhpcykub3V0ZXJXaWR0aCh0cnVlKSxcbiAgICAgICAgICAgICAgICBwYXJlbnRfb3V0ZXJfd2lkdGggPSBwYXJlbnQub3V0ZXJXaWR0aCh0cnVlKTtcbiAgICAgICAgICBcbiAgICAgICAgICAkKHRoaXMpLmF0dHIoJ2F0dHItd2lkdGgnLCB3aWR0aCkucmVtb3ZlQXR0cignd2lkdGgnKTtcbiAgICAgICAgICAkKHRoaXMpLmF0dHIoJ2F0dHItaGVpZ2h0JywgaGVpZ2h0KS5yZW1vdmVBdHRyKCdoZWlnaHQnKTtcbiAgICAgICAgICAvLyQodGhpcykuYXR0cignc3JjJywgJycpO1xuICAgICAgICAgIFxuICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHdpZHRoLCBoZWlnaHQpO1xuICAgICAgICAgIFxuICAgICAgICAgICQodGhpcykuY3NzKHtcbiAgICAgICAgICAgICAgLy8nYmFja2dyb3VuZCc6ICd1cmwoIFwiJytfc3JjKydcIiApIG5vLXJlcGVhdCcsXG4gICAgICAgICAgICAgICdiYWNrZ3JvdW5kLXNpemUnOiAnY29udGFpbicsXG4gICAgICAgICAgICAgIC8vJ21heC13aWR0aCc6IHdpZHRoKydweCcsIFxuICAgICAgICAgICAgICAnaGVpZ2h0JyA6ICdhdXRvJyxcbiAgICAgICAgICAgICAgJ3dpZHRoJzogJ2F1dG8nLFxuICAgICAgICAgICAgICAnbWF4LWhlaWdodCc6IGhlaWdodCsncHgnLFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIFxuICAgICAgICAgIGlmKHBhcmVudC5sZW5ndGgpXG4gICAgICAgICAgICAgIHBhcmVudC5jc3Moe1xuICAgICAgICAgICAgICAgICAgJ2NsZWFyJzogJ2JvdGgnLFxuICAgICAgICAgICAgICAgICAgJ3dpZHRoJzogJ2F1dG8nLFxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICBcbiAgICAgICAgICAvL2NvbnNvbGUubG9nKCcgLS0tLSBTdGFydCB3aWR0aCAtLS0tLS0tLSAnKTtcbiAgICAgICAgICAvL2NvbnNvbGUubG9nKHBhcmVudF9vdXRlcl93aWR0aCwgb3V0ZXJfd2lkdGgpO1xuICAgICAgICAgIC8vY29uc29sZS5sb2coICctLS0tLS0tLSBlbmQgLS0tLS0tLS0tJyApO1xuICAgICAgICAgIFxuICAgICAgICAgIGlmKF9jYXB0aW9uX3RleHQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgIGlmKHBhcmVudF9vdXRlcl93aWR0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBfY2FwdGlvbl90ZXh0LmNzcyh7XG4gICAgICAgICAgICAgICAgICAnd2lkdGgnOiAnMTAwJScsICBcbiAgICAgICAgICAgICAgICAgICdtYXgtd2lkdGgnOiBwYXJlbnRfb3V0ZXJfd2lkdGgrJ3B4JyxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfSBlbHNlIGlmKG91dGVyX3dpZHRoID4gMCkge1xuICAgICAgICAgICAgICAgICBfY2FwdGlvbl90ZXh0LmNzcyh7XG4gICAgICAgICAgICAgICAgICAgICAnd2lkdGgnOiAnMTAwJScsXG4gICAgICAgICAgICAgICAgICAgICdtYXgtd2lkdGgnOiBvdXRlcl93aWR0aCsncHgnLFxuICAgICAgICAgICAgICAgIH0pOyBcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgICAgXG4gICAgICB9KTtcbiAgICAgIFxuICAgICAgXG4gIH1cbn0pO1xuXG4vLyAud3AtY2FwdGlvblxuJCggd2luZG93ICkucmVzaXplKGZ1bmN0aW9uKCkge1xuICAgIHZhciAkX3dXID0gJCh3aW5kb3cpLndpZHRoKCk7XG4gICAgXG4gICAgLy8gZm9ybS5zZW5kX2ZpbmRfcGhvbmUgLmJveC1jYXB0Y2hhIGltZ1xuICAgIGlmKCQoJ2Zvcm0gLmJveC1jYXB0Y2hhID4gaW1nJykubGVuZ3RoKSB7XG4gICAgICAgICQoJ2Zvcm0gLmJveC1jYXB0Y2hhID4gaW1nJykuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciBfYmNhcHRjaGEgPSAkKHRoaXMpLnBhcmVudHMoJy5ib3gtY2FwdGNoYScpLCBfYmN3ID0gX2JjYXB0Y2hhLndpZHRoKCksXG4gICAgICAgICAgICBfd2lkdGggPSAkKHRoaXMpLndpZHRoKCksIHdpZHRoID0gJCh0aGlzKS5vdXRlcldpZHRoKHRydWUpLFxuICAgICAgICAgICAgX3VwZGF0ZSA9IF9iY2FwdGNoYS5maW5kKCcudXBkYXRlLWNhcHRjaGEnKTtcbiAgICAgICAgICAgICQodGhpcykuY3NzKHsnd2lkdGgnOiAoX2JjdyAtIDU0KSsncHgnfSk7XG4gICAgICAgICAgICBfdXBkYXRlLmF0dHIoJ2F0dHItd2lkdGgnLCBfYmN3IC0gNTQpO1xuICAgICAgICAgICAgXG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICBcbiAgICAvLyBib3gtY29udGVudC1wb3N0XG4gICAgaWYoJCgnI2JveC1jb250ZW50LXBvc3QgaW1nLCAjYmxvY2stY29udGVudCBpbWcnKS5sZW5ndGgpIHtcbiAgICAgICQoJyNib3gtY29udGVudC1wb3N0IGltZywgI2Jsb2NrLWNvbnRlbnQgaW1nJykuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICB2YXIgX2NhcHRpb24gPSAkKHRoaXMpLnBhcmVudHMoJy53cC1jYXB0aW9uJyksIFxuICAgICAgICAgICAgICAgIHdpZHRoID0gJCh0aGlzKS5vdXRlcldpZHRoKHRydWUpLFxuICAgICAgICAgICAgICAgIF9hdHRhY2htZW50VyA9ICQodGhpcykuY2xvc2VzdCgnI2F0dGFjaG1lbnQnKS5vdXRlcldpZHRoKHRydWUpLFxuICAgICAgICAgICAgICAgIF93aWR0aCA9ICQodGhpcykud2lkdGgoKSxcbiAgICAgICAgICAgICAgICBfYXR0clcgPSAkKHRoaXMpLmF0dHIoJ2F0dHItd2lkdGgnKTtcblxuICAgICAgICAgIGlmKF9jYXB0aW9uLmZpbmQoJy53cC1jYXB0aW9uLXRleHQnKS5sZW5ndGgpXG4gICAgICAgICAgICBfY2FwdGlvbi5maW5kKCcud3AtY2FwdGlvbi10ZXh0JykuY3NzKHtcbiAgICAgICAgICAgICAgICAnd2lkdGgnOiB3aWR0aCsncHgnLFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBcbiAgICAgIH0pO1xuICAgIH0gIFxufSk7IiwiJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKXsgXG4vLyAgICB2YXIgJGJ0aCA9ICQoXCIjYmxvY2stdGVjaG5vbG9naWNhbC1oZWFkZXIgLmJveC1oZWRhZXItYm9keVwiKSxcbi8vICAgICAgICBfYmlXID0gJGJ0aC5maW5kKCcuYmxvY2staW1hZ2VzJykud2lkdGgodHJ1ZSksXG4vLyAgICAgICAgX2JpSCA9ICRidGguZmluZCgnLmJsb2NrLWltYWdlcycpLmhlaWdodCh0cnVlKTtcbi8vICAgICAgICBcbi8vICAgIGlmKCQoXCIjYm94LWltZy1saW5lc1wiKS5pcygnOnZpc2libGUnKSkgICAgXG4vLyAgICAgICAgJChcIiNib3gtaW1nLWxpbmVzIGltZ1wiKS5jc3Moeyd3aWR0aCc6IF9iaVcgKydweCcsICdtYXJnaW4tbGVmdCc6ICctJysoX2JpVyAvIDIgKSsncHgnfSk7XG5cbn0pO1xuXG4vLy8vIC53cC1jYXB0aW9uXG4kKCB3aW5kb3cgKS5yZXNpemUoZnVuY3Rpb24oKSB7XG4vLyAgICB2YXIgJF93VyA9ICQod2luZG93KS53aWR0aCgpLFxuLy8gICAgICAgICRfaEggPSAkKHdpbmRvdykuaGVpZ2h0KCksXG4vLyAgICAgICAgJGJ0aCA9ICQoXCIjYmxvY2stdGVjaG5vbG9naWNhbC1oZWFkZXIgLmJveC1oZWRhZXItYm9keVwiKSxcbi8vICAgICAgICBfYmlXID0gJGJ0aC5maW5kKCcuYmxvY2staW1hZ2VzJykub3V0ZXJXaWR0aCh0cnVlKSxcbi8vICAgICAgICBfYmlIID0gJGJ0aC5maW5kKCcuYmxvY2staW1hZ2VzJykub3V0ZXJIZWlnaHQodHJ1ZSksXG4vLyAgICAgICAgXG4vLyAgICAgICAgX2JpSVcgPSBmYWxzZSwgX2JpSUggPSBmYWxzZSxcbi8vICAgICAgICBcbi8vICAgICAgICBfbWwgPSAoNDIgLyBfYmlXKSAqIDEwMCxcbi8vICAgICAgICBfbXQgPSAoMTYgLyBfYmlIKSAqIDEwMDtcbi8vICAgIFxuLy8gICAgICAgIGlmKCQoXCIjYm94LWltZy1saW5lc1wiKS5pcygnOnZpc2libGUnKSlcbi8vICAgICAgICAgICAgJChcIiNib3gtaW1nLWxpbmVzIGltZ1wiKS5jc3Moeyd3aWR0aCc6IChfYmlXIC0gMzApICsncHgnLCAnbWFyZ2luLWxlZnQnOiAnLScrKF9iaVcgLyAyICkrJ3B4J30pO1xuICAgIFxuLy8gICAgY29uc29sZS5sb2coICdXdyA9ICcrJF93VysnIGhIID0gJysgJF9oSCArJyBfYmlXID0gJysgX2JpVyArICcgX2JpSCA9ICcrIF9iaUggKycgX2JpSVcgPSAnKyBfYmlJVyArICcgX2JpSUggPSAnKyBfYmlJSCApO1xuLy8gICAgXG4vLyAgICBpZigkYnRoLmZpbmQoJyNib3gtaW1hZ2UtZWxlbWVudCAuYm94LWltZy1taWRkbGUnKS5pcygnOnZpc2libGUnKSkge1xuLy8gICAgICBfYmlJVyA9ICRidGguZmluZCgnI2JveC1pbWFnZS1lbGVtZW50IC5ib3gtaW1nLW1pZGRsZSBpbWcnKS5vdXRlcldpZHRoKHRydWUpO1xuLy8gICAgICBfYmlJSCA9ICRidGguZmluZCgnI2JveC1pbWFnZS1lbGVtZW50IC5ib3gtaW1nLW1pZGRsZSBpbWcnKS5vdXRlckhlaWdodCh0cnVlKTtcbi8vICAgICAgXG4vLyAgICAgICRidGguZmluZCgnI2JveC1pbWFnZS1lbGVtZW50IC5ib3gtaW1nLW1pZGRsZSBpbWcnKS5jc3Moe1xuLy8gICAgICAgICAgJ21hcmdpbi1sZWZ0JzogX21sKyclJyxcbi8vICAgICAgICAgICdtYXJnaW4tdG9wJzogX210KyclJ1xuLy8gICAgICB9KTtcbi8vICAgICAgXG4vLyAgICB9IGVsc2UgaWYoJGJ0aC5maW5kKCcjYm94LWltYWdlLWVsZW1lbnQgLmJveC1pbWctYmlnJykuaXMoJzp2aXNpYmxlJykpIHtcbi8vICAgICAgX2JpSVcgPSAkYnRoLmZpbmQoJyNib3gtaW1hZ2UtZWxlbWVudCAuYm94LWltZy1iaWcgaW1nJykub3V0ZXJXaWR0aCh0cnVlKTsgXG4vLyAgICAgIF9iaUlIID0gJGJ0aC5maW5kKCcjYm94LWltYWdlLWVsZW1lbnQgLmJveC1pbWctYmlnIGltZycpLm91dGVySGVpZ2h0KHRydWUpO1xuLy8gICAgfSBcbiAgICBcbiAgICBcbiAgICBcbiAgICBcbn0pOyIsIi8vIFRoZSBwbHVnaW4gY29kZVxuKGZ1bmN0aW9uKCQpe1xuICAgICQuZm4uc2Nyb2xsUHVtcGljID0gZnVuY3Rpb24ob3B0aW9ucyl7XG4gICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7XG4gICAgICAgICAgICBvZmZzZXQgPSAkdGhpcy5vZmZzZXQoKTtcbiAgICAgICAgdmFyIF9zdG9wID0gZmFsc2UsIFxuICAgICAgICAgICAgX29iakZseSA9IGZhbHNlLCBcbiAgICAgICAgICAgIGRlZHVnID0gZmFsc2U7IC8vIGRlYnVnaW5nIGNvZGVcbiAgICAgICAgXG4gICAgICAgIHZhciBkZWZhdWx0cyA9IHtcbiAgICAgICAgICAgIFwic3RhcnRcIjogMCxcbiAgICAgICAgICAgIFwic3RvcFwiOiBvZmZzZXQudG9wICsgJHRoaXMuaGVpZ2h0KCksXG4gICAgICAgICAgICBcIl9vYmpGbHlcIjogJy5ib3gtZmx5LWRpc2NvdW50JyxcbiAgICAgICAgICAgIFwicmlnaHRcIjogMCxcbiAgICAgICAgICAgIFwiX3Nob3dcIjogdHJ1ZSxcbiAgICAgICAgICAgIFwiX3NldHRpbmdzXCIgOiB7XG4gICAgICAgICAgICAgICAgJ19yZXNwb25jZSc6IHRydWUsXG4gICAgICAgICAgICAgICAgJ192YWxpZGF0ZSc6IHRydWUsXG4gICAgICAgICAgICAgICAgJ192YWxpZGF0ZU9iaic6IFwiI2Zvcm0tZGlzY291bnQtZmx5XCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBcImFuaW1hdGVcIjoge1xuICAgICAgICAgICAgICAgICd0eXBlJzogJycsIC8vIGZhZGUsIHZpc2libGUsIGJsaW5raW5nXG4gICAgICAgICAgICAgICAgJ3RpbWVTaG93JzogMjAwLFxuICAgICAgICAgICAgICAgICd0aW1lSGlkZSc6IDEwMFxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy9cImNvZWZmXCI6IDAuOTVcbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIGlmKGRlZHVnKVxuICAgICAgICAgICAgY29uc29sZS5sb2coICctLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tIC8vIElOSVQgUExVR0lOIFNDUk9MTCAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tJyApO1xuICAgICAgICBcbiAgICAgICAgdmFyIG9wdHMgPSAkLmV4dGVuZChkZWZhdWx0cywgb3B0aW9ucyk7XG4gICAgICAgICAgICBfb2JqRmx5ID0gKG9wdHMuX29iakZseSkgPyBvcHRzLl9vYmpGbHkgOiBmYWxzZTtcbiAgICAgICAgXG4vLyAgICAgICAgJCh3aW5kb3cpLm9uKCdyZXNpemUnLCBmdW5jdGlvbigpIHsgXG4vLyAgICAgICAgICAgaWYoJCh0aGlzKS53aWR0aCgpID4gODAwKSB7XG4vLyAgICAgICAgICAgICAgICAkdGhpcy5maW5kKCBfb2JqRmx5ICkuY3NzKHsnbWFyZ2luLXJpZ2h0Jzogb3B0cy5yaWdodCsncHgnfSk7XG4vLyAgICAgICAgICAgIH0gZWxzZSB7XG4vLyAgICAgICAgICAgICAgICAkdGhpcy5maW5kKCBfb2JqRmx5ICkuY3NzKHsnbWFyZ2luLXJpZ2h0JzogJzBweCd9KTtcbi8vICAgICAgICAgICAgfVxuLy8gICAgICAgIH0pOyBcblxuICAgICAgICBpZihkZWR1Zykge1xuICAgICAgICAgICAgY29uc29sZS5sb2coICdTQ1JPTEwgU0VUVElOR1M6ICcsIG9wdHMgKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnc3RhcnQgPSAnK29wdHMuc3RhcnQsICdzdG9wID0gJytvcHRzLnN0b3AgKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgXG4gICAgICAgIHZhciBfYW5pbWF0ZSA9IHtcbiAgICAgICAgICAgIGluaXQ6IGZ1bmN0aW9uKCBzaG93ICkge1xuICAgICAgICAgICAgICAgIGlmKHNob3cpIHtcbiAgICAgICAgICAgICAgICAgICAgJHRoaXMuZmluZCggX29iakZseSApLmFkZENsYXNzKCdmaXhlZCcpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICR0aGlzLmZpbmQoIF9vYmpGbHkgKS5yZW1vdmVDbGFzcygnZml4ZWQnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgc3dpdGNoICggb3B0cy5hbmltYXRlLnR5cGUgKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIGZhZGVJbi9PdXRcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAgXCJmYWRlXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihkZWR1ZylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggc2hvdyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihzaG93ICYmICR0aGlzLm5vdCgnOnZpc2libGUnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLnN0b3AodHJ1ZSkucXVldWUoJ2Z4JywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5mYWRlSW4oIG9wdHMuYW5pbWF0ZS50aW1lU2hvdyApLmRlcXVldWUoJ2Z4Jyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKG9wdHMuX3NldHRpbmdzLl92YWxpZGF0ZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoIG9wdHMuX3NldHRpbmdzLl92YWxpZGF0ZU9iaiApLnZhbGlkYXRlKCk7IC8vIGluaXQgdmFsaWRhdGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZighc2hvdyAmJiAkdGhpcy5pcygnOnZpc2libGUnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLnN0b3AodHJ1ZSkucXVldWUoJ2Z4JywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5mYWRlT3V0KCBvcHRzLmFuaW1hdGUudGltZUhpZGUgKS5kZXF1ZXVlKCdmeCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIC8vIHNob3cvaGlkZVxuICAgICAgICAgICAgICAgICAgICBjYXNlICBcInZpc2libGVcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoZGVkdWcpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIHNob3cgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoc2hvdyAmJiAkdGhpcy5ub3QoJzp2aXNpYmxlJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5zdG9wKHRydWUpLnF1ZXVlKCdmeCcsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuc2hvdyggb3B0cy5hbmltYXRlLnRpbWVTaG93ICkuZGVxdWV1ZSgnZngnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYob3B0cy5fc2V0dGluZ3MuX3ZhbGlkYXRlKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCggb3B0cy5fc2V0dGluZ3MuX3ZhbGlkYXRlT2JqICkudmFsaWRhdGUoKTsgLy8gaW5pdCB2YWxpZGF0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmKCFzaG93ICYmICR0aGlzLmlzKCc6dmlzaWJsZScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMuc3RvcCh0cnVlKS5xdWV1ZSgnZngnLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmhpZGUoIG9wdHMuYW5pbWF0ZS50aW1lSGlkZSApLmRlcXVldWUoJ2Z4Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAvLyBvcGFjaXR5XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgIFwiYmxpbmtpbmdcIjpcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGRlZHVnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCBzaG93ICk7XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHNob3cgJiYgJHRoaXMubm90KCc6dmlzaWJsZScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMuc3RvcCh0cnVlKS5xdWV1ZSgnZngnLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmFuaW1hdGUoe29wYWNpdHk6IDF9LCBvcHRzLmFuaW1hdGUudGltZVNob3cgKS5kZXF1ZXVlKCdmeCcpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihvcHRzLl9zZXR0aW5ncy5fdmFsaWRhdGUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCBvcHRzLl9zZXR0aW5ncy5fdmFsaWRhdGVPYmogKS52YWxpZGF0ZSgpOyAvLyBpbml0IHZhbGlkYXRlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYoIXNob3cgJiYgJHRoaXMuaXMoJzp2aXNpYmxlJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5zdG9wKHRydWUpLnF1ZXVlKCdmeCcsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuYW5pbWF0ZSh7b3BhY2l0eTogMH0sIG9wdHMuYW5pbWF0ZS50aW1lSGlkZSApLmRlcXVldWUoJ2Z4Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGRlZHVnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCBzaG93ICk7XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHNob3cgJiYgJHRoaXMubm90KCc6dmlzaWJsZScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMuc3RvcCh0cnVlKS5xdWV1ZSgnZngnLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmFuaW1hdGUoe29wYWNpdHk6IDF9LCBvcHRzLmFuaW1hdGUudGltZVNob3cgKS5kZXF1ZXVlKCdmeCcpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihvcHRzLl9zZXR0aW5ncy5fdmFsaWRhdGUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCBvcHRzLl9zZXR0aW5ncy5fdmFsaWRhdGVPYmogKS52YWxpZGF0ZSgpOyAvLyBpbml0IHZhbGlkYXRlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYoIXNob3cgJiYgJHRoaXMuaXMoJzp2aXNpYmxlJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5zdG9wKHRydWUpLnF1ZXVlKCdmeCcsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuYW5pbWF0ZSh7b3BhY2l0eTogMH0sIG9wdHMuYW5pbWF0ZS50aW1lSGlkZSApLmRlcXVldWUoJ2Z4Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7ICAgIFxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICAgICAgXG4gICAgICAgIC8vIGNsZWFyIGNhY2hlXG4gICAgICAgIGlmKCQod2luZG93KS5oYXNIYW5kbGVycygnc2Nyb2xsJykpIFxuICAgICAgICAgICAgJCh3aW5kb3cpLm9mZignc2Nyb2xsJyk7XG4gICAgICAgIFxuICAgICAgICAkKHdpbmRvdykub24oJ3Njcm9sbCcsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgd2luZG93VG9wID0gJCh3aW5kb3cpLnNjcm9sbFRvcCgpO1xuICAgICAgICAgICAgX3N0b3AgPSAob3B0cy5zdG9wKSA/ICh3aW5kb3dUb3AgPD0gb3B0cy5zdG9wKSA/IHRydWUgOiBmYWxzZSA6IGZhbHNlO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZihkZWR1ZylcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnd2luZG93VG9wID0gJysgd2luZG93VG9wLCAnX3N0b3AgPSAnK19zdG9wKycgb3B0cy5zdGFydCA9ICcrb3B0cy5zdGFydCk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgICBpZigod2luZG93VG9wID49IG9wdHMuc3RhcnQpICYmICFfc3RvcCkge1xuICAgICAgICAgICAgICAgICAvL25ld0Nvb3JkID0gd2luZG93VG9wICogb3B0cy5jb2VmZjtcbiAgICAgICAgICAgICAgICAgLy8gYm94IHJpZ2h0XG4gICAgICAgICAgICAgICAgaWYob3B0cy5yaWdodCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYoJCh3aW5kb3cpLndpZHRoKCkgPiA4MDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLmZpbmQoIF9vYmpGbHkgKS5jc3MoeydtYXJnaW4tcmlnaHQnOiBvcHRzLnJpZ2h0KydweCd9KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLmZpbmQoIF9vYmpGbHkgKS5jc3MoeydtYXJnaW4tcmlnaHQnOiAnMHB4J30pO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gcnVuIGFuaW1hdGVcbiAgICAgICAgICAgICAgICBvcHRzLl9zaG93ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICB9IGVsc2UgaWYoKHdpbmRvd1RvcCA8IG9wdHMuc3RhcnQpIHx8IF9zdG9wKSB7IFxuICAgICAgICAgICAgICAgICAvLyBydW4gYW5pbWF0ZVxuICAgICAgICAgICAgICAgICBvcHRzLl9zaG93ID0gZmFsc2U7ICAgXG4gICAgICAgICAgICAgfVxuICAgICAgICAgICAgIFxuICAgICAgICAgICAgIF9hbmltYXRlLmluaXQoIG9wdHMuX3Nob3cgKTsgLy8gYW5pbWF0ZVxuICAgICAgICAgICAgXG4gICAgICAgIH0pO1xuICAgICAgICBcbiAgICAgICAgXG4gICAgICAgIC8qXG4gICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgJCh3aW5kb3cpLm9uKCdzY3JvbGwnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyggb3B0cy5zdGFydCApO1xuICAgICAgICAgICAgICAgIGlmKG9wdHMuX3NldHRpbmdzLl9yZXNwb25jZSkge1xuICAgICAgICAgICAgICAgICAgICBpZigkKHdpbmRvdykud2lkdGgoKSA8PSA0ODApICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5maW5kKCBfb2JqRmx5ICkucmVtb3ZlQ2xhc3MoJ2ZpeGVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5oaWRlKDUwMCk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgd2luZG93VG9wID0gJCh3aW5kb3cpLnNjcm9sbFRvcCgpO1xuICAgICAgICAgICAgICAgIF9zdG9wID0gKG9wdHMuc3RvcCkgPyAod2luZG93VG9wIDw9IG9wdHMuc3RvcCkgPyB0cnVlIDogZmFsc2UgOiBmYWxzZTsgXG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgaWYoKHdpbmRvd1RvcCA+PSBvcHRzLnN0YXJ0KSAmJiAhX3N0b3ApIHtcbiAgICAgICAgICAgICAgICAgICAgLy9uZXdDb29yZCA9IHdpbmRvd1RvcCAqIG9wdHMuY29lZmY7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAvLyBib3ggcmlnaHRcbiAgICAgICAgICAgICAgICAgICAgaWYob3B0cy5yaWdodCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoJCh3aW5kb3cpLndpZHRoKCkgPiA4MDApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5maW5kKCBfb2JqRmx5ICkuY3NzKHsnbWFyZ2luLXJpZ2h0Jzogb3B0cy5yaWdodCsncHgnfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLmZpbmQoIF9vYmpGbHkgKS5jc3MoeydtYXJnaW4tcmlnaHQnOiAnMHB4J30pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBpZihvcHRzLl9zaG93KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihkZWR1ZylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggb3B0cy5fc2hvdyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMuZmluZCggX29iakZseSApLmFkZENsYXNzKCdmaXhlZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMuc3RvcCh0cnVlKS5xdWV1ZSgnZngnLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuYW5pbWF0ZSh7b3BhY2l0eTogMX0sIDIwMCApLmRlcXVldWUoJ2Z4Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKG9wdHMuX3NldHRpbmdzLl92YWxpZGF0ZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCggb3B0cy5fc2V0dGluZ3MuX3ZhbGlkYXRlT2JqICkudmFsaWRhdGUoKTsgLy8gaW5pdCB2YWxpZGF0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgb3B0cy5fc2hvdyA9IGZhbHNlOyAgXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmKCh3aW5kb3dUb3AgPCBvcHRzLnN0YXJ0KSB8fCBfc3RvcCkge1xuICAgICAgICAgICAgICAgICAgICBpZighb3B0cy5fc2hvdykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoZGVkdWcpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIG9wdHMuX3Nob3cgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLmZpbmQoIF9vYmpGbHkgKS5yZW1vdmVDbGFzcygnZml4ZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLnN0b3AodHJ1ZSkucXVldWUoJ2Z4JywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmFuaW1hdGUoe29wYWNpdHk6IDB9LCAxMDAgKS5kZXF1ZXVlKCdmeCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBvcHRzLl9zaG93ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgaWYoZGVkdWcpXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnd2lkb3dfd2lkdGggPSAnKyQod2luZG93KS53aWR0aCgpKycgd2luZG93VG9wID0nKyB3aW5kb3dUb3ArJyBzdGFydCA9ICcrb3B0cy5zdGFydCApO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgICovXG4gICAgICAgIFxuICAgICAgICBcbiAgICB9O1xufSkoalF1ZXJ5KTsiLCJcbiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCkge1xuXHR2YXIgcHJvZHMgPSB7IGlvczogJ2lvcycsIGFuZHJvaWQ6ICdhbmRyb2lkJywgaW9zSmI6ICdpb3MtamInfSxcblx0XHRcdCRpb3NCdG4gPSAkKCcjZmlsdGVyLScgKyBwcm9kcy5pb3MpLFxuXHRcdFx0JGFuZHJCdG4gPSAkKCcjZmlsdGVyLScgKyBwcm9kcy5hbmRyb2lkKSxcblx0XHRcdCRpb3NKYkJ0biA9ICQoJyNmaWx0ZXItJyArIHByb2RzLmlvc0piKTtcblx0dmFyIHByb2RMaXN0ID0ge1xuXHRcdGlvczogJyNwcm9kLWxpc3QtJyArIHByb2RzLmlvcyxcblx0XHRhbmRyb2lkOiAnI3Byb2QtbGlzdC0nICsgcHJvZHMuYW5kcm9pZCxcblx0XHRpb3NKYjogJyNwcm9kLWxpc3QtJyArIHByb2RzLmlvc0piXG5cdH07XG5cdFxuXHRmdW5jdGlvbiB0b2dnbGVQcm9kTGlzdChwcm9kTGlzdCkge1xuXHRcdHZhciAkcHJvZExpc3QgPSAkKHByb2RMaXN0KVxuXHRcdCRwcm9kTGlzdC5zaWJsaW5ncygpLmZhZGVPdXQoMTIwKS5wcm9taXNlKCkuZG9uZShmdW5jdGlvbiAoKSB7XG5cdFx0XHQkcHJvZExpc3QuZmFkZUluKDEyMClcblx0XHR9KVxuXHR9XG5cdFxuXHQkKCcuZmlsdGVyX2xpc3QnKS5vbignY2xpY2snLCAnbGknLCBmdW5jdGlvbigpIHtcblx0XHQkKCcuZmlsdGVyX2xpc3QgbGkuZmlsdGVyLWFjdGl2ZScpLnJlbW92ZUNsYXNzKCdmaWx0ZXItYWN0aXZlJyk7XG5cdFx0JCh0aGlzKS5hZGRDbGFzcygnZmlsdGVyLWFjdGl2ZScpO1xuXHRcdC8vICQoJ2lucHV0W3R5cGU9Y2hlY2tib3hdW25hbWU9YW5kcm9pZC00MG9mZl0nKS5wcm9wKCdjaGVja2VkJywgZmFsc2UpXG5cdH0pO1xuXHRcblx0JGlvc0J0bi5jbGljayhmdW5jdGlvbigpIHtcblx0XHR2YXIgaW9zQmxvY2sgPSAkKCd0aCcpLmZpbmQoJ1tkYXRhLWluZm8tYmxvY2s9JysgcHJvZHMuaW9zICsnXScpXG5cdFx0aWYgKCEkKHRoaXMpLmhhc0NsYXNzKCdmaWx0ZXItYWN0aXZlJykpIHtcblx0XHRcdHRvZ2dsZVByb2RMaXN0KHByb2RMaXN0Lmlvcyk7XG5cdFx0XHR0b2dnbGVQcm9kTGlzdChpb3NCbG9jayk7XG5cdFx0fVxuXHR9KTtcblx0XG5cdCRpb3NKYkJ0bi5jbGljayhmdW5jdGlvbigpIHtcblx0XHR2YXIgaW9zSmJCbG9jayA9ICQoJ3RoJykuZmluZCgnW2RhdGEtaW5mby1ibG9jaz0nKyBwcm9kcy5pb3NKYiArJ10nKVxuXHRcdGlmICghJCh0aGlzKS5oYXNDbGFzcygnZmlsdGVyLWFjdGl2ZScpKSB7XG5cdFx0XHR0b2dnbGVQcm9kTGlzdChwcm9kTGlzdC5pb3NKYik7XG5cdFx0XHR0b2dnbGVQcm9kTGlzdChpb3NKYkJsb2NrKTtcblx0XHR9XG5cdH0pO1xuXHRcblx0JGFuZHJCdG4uY2xpY2soZnVuY3Rpb24oKSB7XG5cdFx0dmFyIGFuZHJvaWRCbG9jayA9ICQoJ3RoJykuZmluZCgnW2RhdGEtaW5mby1ibG9jaz0nKyBwcm9kcy5hbmRyb2lkICsnXScpXG5cdFx0aWYgKCEkKHRoaXMpLmhhc0NsYXNzKCdmaWx0ZXItYWN0aXZlJykpIHtcblx0XHRcdHRvZ2dsZVByb2RMaXN0KHByb2RMaXN0LmFuZHJvaWQpO1xuXHRcdFx0dG9nZ2xlUHJvZExpc3QoYW5kcm9pZEJsb2NrKTtcblx0XHR9XG5cdH0pO1xuXHRcblx0Ly9zdG9yZVJvdXRlclxuXHQvLyBcdC8vcGFyc2UgVVJMIHBhcmFtc1xuXHQvLyBcdCQudXJsUGFyYW0gPSBmdW5jdGlvbihuYW1lKSB7XG5cdC8vIFx0XHR2YXIgcmVzdWx0cyA9IG5ldyBSZWdFeHAoJ1tcXD8mXScgKyBuYW1lICsgJz0oW14mI10qKScpLmV4ZWMod2luZG93LmxvY2F0aW9uLmhyZWYpO1xuXHQvLyBcdFx0aWYocmVzdWx0cyE9PSBudWxsKSB7XG5cdC8vIFx0XHRcdHJldHVybiByZXN1bHRzWzFdIHx8IDA7XG5cdC8vIFx0XHR9XG5cdC8vIFx0fVxuXHR2YXIgdG9nZ2xlU3RvcmVQYWdlcyA9IGZ1bmN0aW9uKCkge1xuXHR2YXIgaGFzaCA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoO1xuXHRcdGlmKGhhc2gpIHtcblx0XHRcdCQoJy5maWx0ZXJfbGlzdCBsaS5maWx0ZXItYWN0aXZlJykucmVtb3ZlQ2xhc3MoJ2ZpbHRlci1hY3RpdmUnKTtcblx0XHRcdGlmKGhhc2ggPT09ICcjamFpbGJyZWFrJykge1xuXHRcdFx0XHQkaW9zSmJCdG4uYWRkQ2xhc3MoJ2ZpbHRlci1hY3RpdmUnKTtcblx0XHRcdFx0dmFyIGlvc0piQmxvY2sgPSAkKCd0aCcpLmZpbmQoJ1tkYXRhLWluZm8tYmxvY2s9JysgcHJvZHMuaW9zSmIgKyddJylcblx0XHRcdFx0dG9nZ2xlUHJvZExpc3QocHJvZExpc3QuaW9zSmIpO1xuXHRcdFx0XHR0b2dnbGVQcm9kTGlzdChpb3NKYkJsb2NrKTtcblx0XHRcdH1cblx0XHRcdGlmKGhhc2ggPT09ICcjYW5kcm9pZCcpIHtcblx0XHRcdFx0JGFuZHJCdG4uYWRkQ2xhc3MoJ2ZpbHRlci1hY3RpdmUnKTtcblx0XHRcdFx0dmFyIGFuZHJvaWRCbG9jayA9ICQoJ3RoJykuZmluZCgnW2RhdGEtaW5mby1ibG9jaz0nKyBwcm9kcy5hbmRyb2lkICsnXScpXG5cdFx0XHRcdHRvZ2dsZVByb2RMaXN0KHByb2RMaXN0LmFuZHJvaWQpO1xuXHRcdFx0XHR0b2dnbGVQcm9kTGlzdChhbmRyb2lkQmxvY2spO1xuXHRcdFx0fVxuXHRcdH1cblx0fSgpO1xuXHR9KTtcblxuJChmdW5jdGlvbiAoKSB7XG5cdHZhciAkZmlsdGVyQnRucyA9ICQoJy5fZmlsdGVyLWJ0bicpLFxuXHRcdFx0ZmVhdHVyZXNMaXN0ID0gJCgnLl9maWx0ZXItZmVhdHVyZScpLFxuXHRcdFx0dGh1bWJuYWlsID0gJCgnLnRodW1ibmFpbCcpO1xuXHQvLyB2YXIgZmVhdHVyZXNJb3MgPSBmZWF0dXJlc0xpc3QuZmlsdGVyKGZ1bmN0aW9uICgpIHtcblx0Ly8gXHRyZXR1cm4gJCh0aGlzKS5kYXRhKCdmaWx0ZXInKSA9PT0gJ2ljbG91ZCdcblx0Ly8gfSk7XG5cdHZhciBmZWF0dXJlc0piID0gZmVhdHVyZXNMaXN0LmZpbHRlcihmdW5jdGlvbiAoKSB7XG5cdFx0cmV0dXJuICQodGhpcykuZGF0YSgnZmlsdGVyJykgPT09ICdqYWlsYnJlYWsnXG5cdH0pO1xuXHR2YXIgamJJblRodW1ibmFpbHMgPSB0aHVtYm5haWwuZmluZCgnW2RhdGEtZmlsdGVyPWphaWxicmVha10nKTtcblx0dmFyIGlvc0luVGh1bWJuYWlscyA9IHRodW1ibmFpbC5maW5kKCdbZGF0YS1maWx0ZXI9aWNsb3VkXScpO1xuXHRmdW5jdGlvbiBjaGFuZ2VIcmVmKCkge1xuXHRcdHZhciBidXlCdG4gPSAkKCcjYnV5LWJ0bicpLFxuXHRcdFx0XHRkZW1vQnRuID0gJCgnI2RlbW8tYnRuJyksXG5cdFx0XHRcdGRvbWFpbiA9IHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZTtcblx0XHRidXlCdG4uYXR0cignaHJlZicsIGZ1bmN0aW9uIChpLCBvcmlnVmFsdWUpIHtcblx0XHRcdHZhciByZXN1bHQ7XG5cdFx0XHRvcmlnVmFsdWUgPT0gJy9zdG9yZS5odG1sJyA/IHJlc3VsdD0nL3N0b3JlLmh0bWwjamFpbGJyZWFrJyA6IHJlc3VsdD0nL3N0b3JlLmh0bWwnO1xuXHRcdFx0cmV0dXJuIHJlc3VsdDtcblx0XHR9KTtcblx0XHRkZW1vQnRuLmF0dHIoJ2hyZWYnLCBmdW5jdGlvbihpLCBvcmlnVmFsdWUpIHtcblx0XHRcdHZhciByZXN1bHQ7XG5cdFx0XHR0aGlzLnBhdGhuYW1lID09ICcvc2V0RGV2aWNlLzEyNicgPyByZXN1bHQ9J2h0dHA6Ly9kZW1vLicrZG9tYWluKycvc2V0RGV2aWNlLzEyNT9yZWRpcmVjdF91cmw9Y3AvY2FsbHMnIDogcmVzdWx0PSdodHRwOi8vZGVtby4nK2RvbWFpbisnL3NldERldmljZS8xMjY/cmVkaXJlY3RfdXJsPWNwL2NhbGxzJztcblx0XHRcdHJldHVybiBvcmlnVmFsdWUucGF0aG5hbWUgPSByZXN1bHQ7XG5cdFx0fSk7XG5cdH1cblx0XHRmZWF0dXJlc0piLmhpZGUoKTtcblx0XHRqYkluVGh1bWJuYWlscy5oaWRlKCk7XG5cdFx0JGZpbHRlckJ0bnMub24oJ2NsaWNrJywgZnVuY3Rpb24gKCkge1xuXHRcdFx0aWYoISQodGhpcykuaGFzQ2xhc3MoJ2ZpbHRlci1hY3RpdmUnKSkge1xuXHRcdFx0XHRjaGFuZ2VIcmVmKCk7XG5cdFx0XHRcdGZlYXR1cmVzSmIudG9nZ2xlKCk7XG5cdFx0XHRcdGpiSW5UaHVtYm5haWxzLnRvZ2dsZSgpO1xuXHRcdFx0XHRpb3NJblRodW1ibmFpbHMudG9nZ2xlKCk7XG5cdFx0fVxuXHR9KTtcbn0pOyIsInZhciBtb2JpbGVfc2xpZGVyID0gXCI8ZGl2IGNsYXNzPVxcXCJzbGlkZVxcXCI+XCI7XG4gICAgICAgIG1vYmlsZV9zbGlkZXIgKz0gXCI8ZGl2IGNsYXNzPVxcXCJjb2wtc20tMTIgY29sLW1kLTQgY29sLWxnLTQgY29sLXhzLTEyXFxcIj5cIjtcbiAgICAgICAgbW9iaWxlX3NsaWRlciArPSAgICBcIjxpbWcgc3JjPVxcXCJ7aW1nX3NyY31cXFwiIGNsYXNzPVxcXCJ0ZXN0aW1vbmlhbC1waG90b1xcXCI+XCI7XG4gICAgICAgIG1vYmlsZV9zbGlkZXIgKz0gICAgXCI8ZGl2IGNsYXNzPVxcXCJ0ZXN0aW1vbmlhbC10ZXh0XFxcIj57dGV4dH08L2Rpdj5cIjtcbiAgICAgICAgbW9iaWxlX3NsaWRlciArPSBcIjwvZGl2PlwiO1xuICAgIG1vYmlsZV9zbGlkZXIgKz0gXCI8L2Rpdj5cIjtcbiAgICBcbnZhciBvYmpTbGlkZXJNb2JpbGUgPSAkKCcuYnhTbGlkZXJNb2JpbGUnKTtcbnZhciBieFNsaWRlcnMgPSBmYWxzZTtcbnZhciBieFNsaWRlcnNNb2JpbGUgPSBmYWxzZTtcbnZhciBieFNsaWRlcnNQQyA9IGZhbHNlO1xuICAgIFxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKXsgXG4gICAgLy8gLnJlcGxhY2VcbiAgICBcbiAgICBcbiAgICBcbiAgICBpZigkKCcuYnhTbGlkZXJzJykubGVuZ3RoKSB7XG4gICAgXG4vLyAgICAgICAgaWYoJCgnLmJ4U2xpZGVycycpLm5vdCgnLm9ubHktbW9iaWxlLCAub25seS1wYycpKSB7XG4vLyAgICAgICAgICAgIGJ4U2xpZGVycyA9IHJ1blNsaWRlcnMoICQoJy5ieFNsaWRlcnMnKS5ub3QoJy5vbmx5LW1vYmlsZSwgLm9ubHktcGMnKSApO1xuLy8gICAgICAgIH1cbi8vXG4vLyAgICAgICAgaWYoJCgnLmJ4U2xpZGVycy5vbmx5LW1vYmlsZScpLmxlbmd0aClcbi8vICAgICAgICAgICAgYnhTbGlkZXJzTW9iaWxlID0gcnVuU2xpZGVycyggJCgnLmJ4U2xpZGVycy5vbmx5LW1vYmlsZScpICk7IC8vIDp2aXNpYmxlXG4gICAgICAgIFxuICAgICAgICBpZighYnhTbGlkZXJzUEMgJiYgJCgnLmJ4U2xpZGVycy5vbmx5LXBjJykubGVuZ3RoKVxuICAgICAgICAgICAgYnhTbGlkZXJzUEMgPSBydW5TbGlkZXJzKCAkKCcuYnhTbGlkZXJzLm9ubHktcGMnKSApOyAvLyA6dmlzaWJsZVxuXG4gICAgICAgICQod2luZG93KS5vbignbG9hZCByZXNpemUnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYoJCh0aGlzKS53aWR0aCgpIDwgOTkyKSB7XG5cbiAgICAgICAgICAgICAgICBpZighYnhTbGlkZXJzTW9iaWxlICYmICEkKCcuYnhTbGlkZXJNb2JpbGUnKS5maW5kKCcuc2xpZGUnKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgc2xpZGVyTW9iaWxlSW5pdChvYmpTbGlkZXJNb2JpbGUsICQoJy5ieFNsaWRlcnMub25seS1wYycpKTtcbiAgICAgICAgICAgICAgICAgICAgYnhTbGlkZXJzTW9iaWxlID0gcnVuU2xpZGVycyggJCgnLmJ4U2xpZGVyTW9iaWxlJykgKTtcbiAgICAgICAgICAgICAgICB9XG5cbi8vICAgICAgICAgICAgICAgIGlmKGJ4U2xpZGVyc01vYmlsZSAmJiAkKCcuYnhTbGlkZXJzLm9ubHktbW9iaWxlJykubGVuZ3RoKSAvLyAuaXMoJzp2aXNpYmxlJylcbi8vICAgICAgICAgICAgICAgICAgIGJ4U2xpZGVyc01vYmlsZS5yZWxvYWRTbGlkZXIoKTtcblxuLy8gICAgICAgICAgICAgICAgaWYoYnhTbGlkZXJzUEMgJiYgJCgnLmJ4U2xpZGVycy5vbmx5LXBjJykubGVuZ3RoKSAvLyAubm90KCc6dmlzaWJsZScpXG4vLyAgICAgICAgICAgICAgICAgICBieFNsaWRlcnNQQy5kZXN0cm95U2xpZGVyKCk7XG5cbiAgICAgICAgICAgICAgICBpZihieFNsaWRlcnNQQykge1xuICAgICAgICAgICAgICAgICAgIGJ4U2xpZGVyc1BDLmRlc3Ryb3lTbGlkZXIoKTtcbiAgICAgICAgICAgICAgICAgICBieFNsaWRlcnNQQyA9IGZhbHNlO1xuICAgICAgICAgICAgICAgfSAgIFxuXG4gICAgICAgICAgICB9IGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgIGlmKGJ4U2xpZGVyc01vYmlsZSAmJiAkKCcuYnhTbGlkZXJNb2JpbGUnKS5sZW5ndGggJiYgJCgnLmJ4U2xpZGVyTW9iaWxlJykuZmluZCgnLnNsaWRlJykubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICBieFNsaWRlcnNNb2JpbGUuZGVzdHJveVNsaWRlcigpO1xuICAgICAgICAgICAgICAgICAgICAgY2xlYXJTbGlkZXJNb2JpbGUoIG9ialNsaWRlck1vYmlsZSApO1xuICAgICAgICAgICAgICAgICAgICAgYnhTbGlkZXJzTW9iaWxlID0gZmFsc2VcbiAgICAgICAgICAgICAgICAgfSAgICBcbiAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIFxuXG4vLyAgICAgICAgICAgICAgIGlmKGJ4U2xpZGVyc01vYmlsZSAmJiAkKCcuYnhTbGlkZXJzLm9ubHktbW9iaWxlJykubGVuZ3RoKSAvLy5ub3QoJzp2aXNpYmxlJykgXG4vLyAgICAgICAgICAgICAgICAgICBieFNsaWRlcnNNb2JpbGUuZGVzdHJveVNsaWRlcigpO1xuXG4vLyAgICAgICAgICAgICAgICBpZihieFNsaWRlcnNQQyAmJiAkKCcuYnhTbGlkZXJzLm9ubHktcGMnKS5sZW5ndGgpIC8vIC5pcygnOnZpc2libGUnKVxuLy8gICAgICAgICAgICAgICAgICAgYnhTbGlkZXJzUEMucmVsb2FkU2xpZGVyKCk7XG5cbiAgICAgICAgICAgICAgICBpZighYnhTbGlkZXJzUEMpIHtcbiAgICAgICAgICAgICAgICAgICBieFNsaWRlcnNQQyA9IHJ1blNsaWRlcnMoICQoJy5ieFNsaWRlcnMub25seS1wYycpICk7XG4gICAgICAgICAgICAgICB9ICAgXG5cbiAgICAgICAgICAgfSAgIFxuICAgICAgICB9KTtcbiAgICBcbiAgICB9XG4gICAgXG4gICAgaWYoJCgnLnNsaWRlci1pcGFkJykubGVuZ3RoKSB7XG4gICAgICAgICQoJy5zbGlkZXItaXBhZCcpLmJ4U2xpZGVyKHtcbiAgICAgICAgICAgIHNsaWRlV2lkdGg6IDM4NSxcbiAgICAgICAgICAgIG1pblNsaWRlczogMSxcbiAgICAgICAgICAgIGNvbnRyb2xzOiB0cnVlLFxuICAgICAgICAgICAgLy8gbW92ZVNsaWRlczogMSxcbiAgICAgICAgICAgIC8vIHN0YXJ0U2xpZGU6IDIsXG4gICAgICAgICAgICAvLyBtYXhTbGlkZXM6IDEwLFxuICAgICAgICAgICAgLy8gc2xpZGVNYXJnaW46IDEwXG4gICAgICAgICAgICBuZXh0U2VsZWN0b3I6ICcjc2xpZGVyLW5leHQnLFxuICAgICAgICAgICAgcHJldlNlbGVjdG9yOiAnI3NsaWRlci1wcmV2JyxcbiAgICAgICAgICAgIG5leHRUZXh0OiAnJyxcbiAgICAgICAgICAgIHByZXZUZXh0OiAnJyxcbiAgICAgICAgICAgIFxuLy8gICAgICAgICAgICBidWlsZFBhZ2VyOiBudWxsLFxuLy8gICAgICAgICAgICBwYWdlckN1c3RvbTogdHJ1ZSxcbiAgICAgICAgfSk7IFxuICAgIH1cbn0pO1xuXG5mdW5jdGlvbiBzbGlkZXJNb2JpbGVJbml0KCBvYmosIGdldEVsZW10cyApIHtcbiAgICB2YXIgX2h0bWwgPSAnJywgJHJlcyA9IG5ldyBBcnJheTtcbiAgICBpZihpc3NldChvYmopICYmIGlzc2V0KGdldEVsZW10cykpIHtcbiAgICAgICAgZ2V0RWxlbXRzLmZpbmQoJy5zbGlkZScpLmVhY2goZnVuY3Rpb24oaywgdmFsKSB7XG4gICAgICAgICAgICB2YXIgX2l0ZW0gPSAkKHZhbCkuZmluZCgnLmJ4SXRlbScpO1xuICAgICAgICAgICAgaWYoaXNzZXQoX2l0ZW0pKSB7XG4gICAgICAgICAgICAgICAgX2l0ZW0uZWFjaChmdW5jdGlvbihpaywgaXZhbCkge1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAkcmVzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAnc3JjJzogJChpdmFsKS5maW5kKCcudGVzdGltb25pYWwtcGhvdG8nKS5hdHRyKCdzcmMnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgJ3RleHQnOiAkKGl2YWwpLmZpbmQoJy50ZXN0aW1vbmlhbC10ZXh0JykuaHRtbCgpXG4gICAgICAgICAgICAgICAgICAgIH0pOyBcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBcbiAgICBpZigkcmVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgJC5lYWNoKCRyZXMsIGZ1bmN0aW9uKGtleSwgaXRlbSkge1xuICAgICAgICAgICAgaWYoaXRlbS5zcmMgJiYgaXRlbS50ZXh0KSB7XG4gICAgICAgICAgICAgICAgdmFyIF9oSXRlbSA9ICcnO1xuICAgICAgICAgICAgICAgIF9oSXRlbSArPSBtb2JpbGVfc2xpZGVyLnJlcGxhY2UoJ3tpbWdfc3JjfScsIGl0ZW0uc3JjKTtcbiAgICAgICAgICAgICAgICBfaHRtbCArPSBfaEl0ZW0ucmVwbGFjZSgne3RleHR9JywgaXRlbS50ZXh0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIG9iai5odG1sKCBfaHRtbCApO1xuICAgIH1cbiAgICBcbn1cblxuZnVuY3Rpb24gY2xlYXJTbGlkZXJNb2JpbGUob2JqKSB7XG4gICAgaWYoaXNzZXQob2JqKSkgb2JqLmVtcHR5KCk7IFxufVxuXG5mdW5jdGlvbiBydW5TbGlkZXJzKCBvYmogKSB7XG4gICAgcmV0dXJuIG9iai5ieFNsaWRlcih7XG4gICAgICAgIHNsaWRlV2lkdGg6IDExNzAsXG4gICAgICAgIG1pblNsaWRlczogMSxcbiAgICAgICAgY29udHJvbHM6IGZhbHNlLFxuICAgICAgICBcbiAgICAgICAgaW5maW5pdGVMb29wOiBmYWxzZSxcbiAgICAgICAgcmVzcG9uc2l2ZTogdHJ1ZSxcbiAgICAgICAgXG4gICAgICAgIHdyYXBwZXJDbGFzczogJ2J4LXdyYXBwZXItdGVzdGltb25pYWxzJyxcbiAgICAgICAgb25TbGlkZXJMb2FkOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgLy8gYWxlcnQoICQoJy5ieC1jb250cm9scyAuYngtcGFnZXIgPiAuYngtcGFnZXItaXRlbScpLmxlbmd0aCApO1xuICAgICAgICAgICAgaWYoJCgnLmJ4LWNvbnRyb2xzID4gLmJ4LXBhZ2VyID4gLmJ4LXBhZ2VyLWl0ZW0nKS5sZW5ndGggPCAyKSAkKCcuYngtY29udHJvbHMgPiAuYngtcGFnZXIgPiAuYngtcGFnZXItaXRlbScpLmhpZGUoKTsgXG4gICAgICAgIH0sXG4gICAgICAgIG9uU2xpZGVCZWZvcmU6IGZ1bmN0aW9uKCkge1xuXG4gICAgICAgIH0sXG4gICAgICAgIG9uU2xpZGVBZnRlcjogZnVuY3Rpb24oKXtcblxuICAgICAgICB9LFxuICAgIH0pOyBcbiAgIFxufSIsIi8qKipcbiAqIEJ4U2xpZGVyIHY0LjIuMyAtIEZ1bGx5IGxvYWRlZCwgcmVzcG9uc2l2ZSBjb250ZW50IHNsaWRlclxuICogaHR0cDovL2J4c2xpZGVyLmNvbVxuICpcbiAqIENvcHlyaWdodCAyMDE0LCBTdGV2ZW4gV2FuZGVyc2tpIC0gaHR0cDovL3N0ZXZlbndhbmRlcnNraS5jb20gLSBodHRwOi8vYnhjcmVhdGl2ZS5jb21cbiAqIFdyaXR0ZW4gd2hpbGUgZHJpbmtpbmcgQmVsZ2lhbiBhbGVzIGFuZCBsaXN0ZW5pbmcgdG8gamF6elxuICpcbiAqIFJlbGVhc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZSAtIGh0dHA6Ly9vcGVuc291cmNlLm9yZy9saWNlbnNlcy9NSVRcbiAqKiovXG5cbjsoZnVuY3Rpb24oJCl7XG5cblx0dmFyIGRlZmF1bHRzID0ge1xuXG5cdFx0Ly8gR0VORVJBTFxuXHRcdG1vZGU6ICdob3Jpem9udGFsJyxcblx0XHRzbGlkZVNlbGVjdG9yOiAnJyxcblx0XHRpbmZpbml0ZUxvb3A6IHRydWUsXG5cdFx0aGlkZUNvbnRyb2xPbkVuZDogZmFsc2UsXG5cdFx0c3BlZWQ6IDUwMCxcblx0XHRlYXNpbmc6IG51bGwsXG5cdFx0c2xpZGVNYXJnaW46IDAsXG5cdFx0c3RhcnRTbGlkZTogMCxcblx0XHRyYW5kb21TdGFydDogZmFsc2UsXG5cdFx0Y2FwdGlvbnM6IGZhbHNlLFxuXHRcdHRpY2tlcjogZmFsc2UsXG5cdFx0dGlja2VySG92ZXI6IGZhbHNlLFxuXHRcdGFkYXB0aXZlSGVpZ2h0OiBmYWxzZSxcblx0XHRhZGFwdGl2ZUhlaWdodFNwZWVkOiA1MDAsXG5cdFx0dmlkZW86IGZhbHNlLFxuXHRcdHVzZUNTUzogdHJ1ZSxcblx0XHRwcmVsb2FkSW1hZ2VzOiAndmlzaWJsZScsXG5cdFx0cmVzcG9uc2l2ZTogdHJ1ZSxcblx0XHRzbGlkZVpJbmRleDogNTAsXG5cdFx0d3JhcHBlckNsYXNzOiAnYngtd3JhcHBlcicsXG5cblx0XHQvLyBUT1VDSFxuXHRcdHRvdWNoRW5hYmxlZDogdHJ1ZSxcblx0XHRzd2lwZVRocmVzaG9sZDogNTAsXG5cdFx0b25lVG9PbmVUb3VjaDogdHJ1ZSxcblx0XHRwcmV2ZW50RGVmYXVsdFN3aXBlWDogdHJ1ZSxcblx0XHRwcmV2ZW50RGVmYXVsdFN3aXBlWTogZmFsc2UsXG5cblx0XHQvLyBLRVlCT0FSRFxuXHRcdGtleWJvYXJkRW5hYmxlZDogZmFsc2UsXG5cblx0XHQvLyBQQUdFUlxuXHRcdHBhZ2VyOiB0cnVlLFxuXHRcdHBhZ2VyVHlwZTogJ2Z1bGwnLFxuXHRcdHBhZ2VyU2hvcnRTZXBhcmF0b3I6ICcgLyAnLFxuXHRcdHBhZ2VyU2VsZWN0b3I6IG51bGwsXG5cdFx0YnVpbGRQYWdlcjogbnVsbCxcblx0XHRwYWdlckN1c3RvbTogbnVsbCxcblxuXHRcdC8vIENPTlRST0xTXG5cdFx0Y29udHJvbHM6IHRydWUsXG5cdFx0bmV4dFRleHQ6ICdOZXh0Jyxcblx0XHRwcmV2VGV4dDogJ1ByZXYnLFxuXHRcdG5leHRTZWxlY3RvcjogbnVsbCxcblx0XHRwcmV2U2VsZWN0b3I6IG51bGwsXG5cdFx0YXV0b0NvbnRyb2xzOiBmYWxzZSxcblx0XHRzdGFydFRleHQ6ICdTdGFydCcsXG5cdFx0c3RvcFRleHQ6ICdTdG9wJyxcblx0XHRhdXRvQ29udHJvbHNDb21iaW5lOiBmYWxzZSxcblx0XHRhdXRvQ29udHJvbHNTZWxlY3RvcjogbnVsbCxcblxuXHRcdC8vIEFVVE9cblx0XHRhdXRvOiBmYWxzZSxcblx0XHRwYXVzZTogNDAwMCxcblx0XHRhdXRvU3RhcnQ6IHRydWUsXG5cdFx0YXV0b0RpcmVjdGlvbjogJ25leHQnLFxuXHRcdGF1dG9Ib3ZlcjogZmFsc2UsXG5cdFx0YXV0b0RlbGF5OiAwLFxuXHRcdGF1dG9TbGlkZUZvck9uZVBhZ2U6IGZhbHNlLFxuXG5cdFx0Ly8gQ0FST1VTRUxcblx0XHRtaW5TbGlkZXM6IDEsXG5cdFx0bWF4U2xpZGVzOiAxLFxuXHRcdG1vdmVTbGlkZXM6IDAsXG5cdFx0c2xpZGVXaWR0aDogMCxcblxuXHRcdC8vIENBTExCQUNLU1xuXHRcdG9uU2xpZGVyTG9hZDogZnVuY3Rpb24oKXsgcmV0dXJuIHRydWUgfSxcblx0XHRvblNsaWRlQmVmb3JlOiBmdW5jdGlvbigpeyByZXR1cm4gdHJ1ZSB9LFxuXHRcdG9uU2xpZGVBZnRlcjogZnVuY3Rpb24oKXsgcmV0dXJuIHRydWUgfSxcblx0XHRvblNsaWRlTmV4dDogZnVuY3Rpb24oKXsgcmV0dXJuIHRydWUgfSxcblx0XHRvblNsaWRlUHJldjogZnVuY3Rpb24oKXsgcmV0dXJuIHRydWUgfSxcblx0XHRvblNsaWRlclJlc2l6ZTogZnVuY3Rpb24oKXsgcmV0dXJuIHRydWUgfVxuXHR9O1xuXG5cdCQuZm4uYnhTbGlkZXIgPSBmdW5jdGlvbihvcHRpb25zKXtcblxuXHRcdGlmKHRoaXMubGVuZ3RoID09PSAwKXtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0gXG5cblx0XHQvLyBzdXBwb3J0IG11bHRpcGxlIGVsZW1lbnRzXG5cdFx0aWYodGhpcy5sZW5ndGggPiAxKXtcblx0XHRcdHRoaXMuZWFjaChmdW5jdGlvbigpe1xuXHRcdFx0XHQkKHRoaXMpLmJ4U2xpZGVyKG9wdGlvbnMpO1xuXHRcdFx0fSk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9XG5cblx0XHQvLyBjcmVhdGUgYSBuYW1lc3BhY2UgdG8gYmUgdXNlZCB0aHJvdWdob3V0IHRoZSBwbHVnaW5cblx0XHR2YXIgc2xpZGVyID0ge307XG5cdFx0Ly8gc2V0IGEgcmVmZXJlbmNlIHRvIG91ciBzbGlkZXIgZWxlbWVudFxuXHRcdHZhciBlbCA9IHRoaXM7XG5cblx0XHQvKipcblx0XHQgKiBNYWtlcyBzbGlkZXNob3cgcmVzcG9uc2l2ZVxuXHRcdCAqL1xuXHRcdC8vIGZpcnN0IGdldCB0aGUgb3JpZ2luYWwgd2luZG93IGRpbWVucyAodGhhbmtzIGEgbG90IElFKVxuXHRcdHZhciB3aW5kb3dXaWR0aCA9ICQod2luZG93KS53aWR0aCgpO1xuXHRcdHZhciB3aW5kb3dIZWlnaHQgPSAkKHdpbmRvdykuaGVpZ2h0KCk7XG5cblxuXG5cdFx0LyoqXG5cdFx0ICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblx0XHQgKiA9IFBSSVZBVEUgRlVOQ1RJT05TXG5cdFx0ICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblx0XHQgKi9cblxuXHRcdC8qKlxuXHRcdCAqIEluaXRpYWxpemVzIG5hbWVzcGFjZSBzZXR0aW5ncyB0byBiZSB1c2VkIHRocm91Z2hvdXQgcGx1Z2luXG5cdFx0ICovXG5cdFx0dmFyIGluaXQgPSBmdW5jdGlvbigpe1xuXHRcdFx0Ly8gbWVyZ2UgdXNlci1zdXBwbGllZCBvcHRpb25zIHdpdGggdGhlIGRlZmF1bHRzXG5cdFx0XHRzbGlkZXIuc2V0dGluZ3MgPSAkLmV4dGVuZCh7fSwgZGVmYXVsdHMsIG9wdGlvbnMpO1xuXHRcdFx0Ly8gcGFyc2Ugc2xpZGVXaWR0aCBzZXR0aW5nXG5cdFx0XHRzbGlkZXIuc2V0dGluZ3Muc2xpZGVXaWR0aCA9IHBhcnNlSW50KHNsaWRlci5zZXR0aW5ncy5zbGlkZVdpZHRoKTtcblx0XHRcdC8vIHN0b3JlIHRoZSBvcmlnaW5hbCBjaGlsZHJlblxuXHRcdFx0c2xpZGVyLmNoaWxkcmVuID0gZWwuY2hpbGRyZW4oc2xpZGVyLnNldHRpbmdzLnNsaWRlU2VsZWN0b3IpO1xuXHRcdFx0Ly8gY2hlY2sgaWYgYWN0dWFsIG51bWJlciBvZiBzbGlkZXMgaXMgbGVzcyB0aGFuIG1pblNsaWRlcyAvIG1heFNsaWRlc1xuXHRcdFx0aWYoc2xpZGVyLmNoaWxkcmVuLmxlbmd0aCA8IHNsaWRlci5zZXR0aW5ncy5taW5TbGlkZXMpeyBzbGlkZXIuc2V0dGluZ3MubWluU2xpZGVzID0gc2xpZGVyLmNoaWxkcmVuLmxlbmd0aDsgfSBcblx0XHRcdGlmKHNsaWRlci5jaGlsZHJlbi5sZW5ndGggPCBzbGlkZXIuc2V0dGluZ3MubWF4U2xpZGVzKXsgc2xpZGVyLnNldHRpbmdzLm1heFNsaWRlcyA9IHNsaWRlci5jaGlsZHJlbi5sZW5ndGg7IH1cblx0XHRcdC8vIGlmIHJhbmRvbSBzdGFydCwgc2V0IHRoZSBzdGFydFNsaWRlIHNldHRpbmcgdG8gcmFuZG9tIG51bWJlclxuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLnJhbmRvbVN0YXJ0KXsgc2xpZGVyLnNldHRpbmdzLnN0YXJ0U2xpZGUgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBzbGlkZXIuY2hpbGRyZW4ubGVuZ3RoKTsgfVxuXHRcdFx0Ly8gc3RvcmUgYWN0aXZlIHNsaWRlIGluZm9ybWF0aW9uXG5cdFx0XHRzbGlkZXIuYWN0aXZlID0geyBpbmRleDogc2xpZGVyLnNldHRpbmdzLnN0YXJ0U2xpZGUgfTtcblx0XHRcdC8vIHN0b3JlIGlmIHRoZSBzbGlkZXIgaXMgaW4gY2Fyb3VzZWwgbW9kZSAoZGlzcGxheWluZyAvIG1vdmluZyBtdWx0aXBsZSBzbGlkZXMpXG5cdFx0XHRzbGlkZXIuY2Fyb3VzZWwgPSBzbGlkZXIuc2V0dGluZ3MubWluU2xpZGVzID4gMSB8fCBzbGlkZXIuc2V0dGluZ3MubWF4U2xpZGVzID4gMSA/IHRydWUgOiBmYWxzZTtcblx0XHRcdC8vIGlmIGNhcm91c2VsLCBmb3JjZSBwcmVsb2FkSW1hZ2VzID0gJ2FsbCdcblx0XHRcdGlmKHNsaWRlci5jYXJvdXNlbCl7IHNsaWRlci5zZXR0aW5ncy5wcmVsb2FkSW1hZ2VzID0gJ2FsbCc7IH1cblx0XHRcdC8vIGNhbGN1bGF0ZSB0aGUgbWluIC8gbWF4IHdpZHRoIHRocmVzaG9sZHMgYmFzZWQgb24gbWluIC8gbWF4IG51bWJlciBvZiBzbGlkZXNcblx0XHRcdC8vIHVzZWQgdG8gc2V0dXAgYW5kIHVwZGF0ZSBjYXJvdXNlbCBzbGlkZXMgZGltZW5zaW9uc1xuXHRcdFx0c2xpZGVyLm1pblRocmVzaG9sZCA9IChzbGlkZXIuc2V0dGluZ3MubWluU2xpZGVzICogc2xpZGVyLnNldHRpbmdzLnNsaWRlV2lkdGgpICsgKChzbGlkZXIuc2V0dGluZ3MubWluU2xpZGVzIC0gMSkgKiBzbGlkZXIuc2V0dGluZ3Muc2xpZGVNYXJnaW4pO1xuXHRcdFx0c2xpZGVyLm1heFRocmVzaG9sZCA9IChzbGlkZXIuc2V0dGluZ3MubWF4U2xpZGVzICogc2xpZGVyLnNldHRpbmdzLnNsaWRlV2lkdGgpICsgKChzbGlkZXIuc2V0dGluZ3MubWF4U2xpZGVzIC0gMSkgKiBzbGlkZXIuc2V0dGluZ3Muc2xpZGVNYXJnaW4pO1xuXHRcdFx0Ly8gc3RvcmUgdGhlIGN1cnJlbnQgc3RhdGUgb2YgdGhlIHNsaWRlciAoaWYgY3VycmVudGx5IGFuaW1hdGluZywgd29ya2luZyBpcyB0cnVlKVxuXHRcdFx0c2xpZGVyLndvcmtpbmcgPSBmYWxzZTtcblx0XHRcdC8vIGluaXRpYWxpemUgdGhlIGNvbnRyb2xzIG9iamVjdFxuXHRcdFx0c2xpZGVyLmNvbnRyb2xzID0ge307XG5cdFx0XHQvLyBpbml0aWFsaXplIGFuIGF1dG8gaW50ZXJ2YWxcblx0XHRcdHNsaWRlci5pbnRlcnZhbCA9IG51bGw7XG5cdFx0XHQvLyBkZXRlcm1pbmUgd2hpY2ggcHJvcGVydHkgdG8gdXNlIGZvciB0cmFuc2l0aW9uc1xuXHRcdFx0c2xpZGVyLmFuaW1Qcm9wID0gc2xpZGVyLnNldHRpbmdzLm1vZGUgPT09ICd2ZXJ0aWNhbCcgPyAndG9wJyA6ICdsZWZ0Jztcblx0XHRcdC8vIGRldGVybWluZSBpZiBoYXJkd2FyZSBhY2NlbGVyYXRpb24gY2FuIGJlIHVzZWRcblx0XHRcdHNsaWRlci51c2luZ0NTUyA9IHNsaWRlci5zZXR0aW5ncy51c2VDU1MgJiYgc2xpZGVyLnNldHRpbmdzLm1vZGUgIT09ICdmYWRlJyAmJiAoZnVuY3Rpb24oKXtcblx0XHRcdFx0Ly8gY3JlYXRlIG91ciB0ZXN0IGRpdiBlbGVtZW50XG5cdFx0XHRcdHZhciBkaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcblx0XHRcdFx0Ly8gY3NzIHRyYW5zaXRpb24gcHJvcGVydGllc1xuXHRcdFx0XHR2YXIgcHJvcHMgPSBbJ1dlYmtpdFBlcnNwZWN0aXZlJywgJ01velBlcnNwZWN0aXZlJywgJ09QZXJzcGVjdGl2ZScsICdtc1BlcnNwZWN0aXZlJ107XG5cdFx0XHRcdC8vIHRlc3QgZm9yIGVhY2ggcHJvcGVydHlcblx0XHRcdFx0Zm9yKHZhciBpIGluIHByb3BzKXtcblx0XHRcdFx0XHRpZihkaXYuc3R5bGVbcHJvcHNbaV1dICE9PSB1bmRlZmluZWQpe1xuXHRcdFx0XHRcdFx0c2xpZGVyLmNzc1ByZWZpeCA9IHByb3BzW2ldLnJlcGxhY2UoJ1BlcnNwZWN0aXZlJywgJycpLnRvTG93ZXJDYXNlKCk7XG5cdFx0XHRcdFx0XHRzbGlkZXIuYW5pbVByb3AgPSAnLScgKyBzbGlkZXIuY3NzUHJlZml4ICsgJy10cmFuc2Zvcm0nO1xuXHRcdFx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdH0oKSk7XG5cdFx0XHQvLyBpZiB2ZXJ0aWNhbCBtb2RlIGFsd2F5cyBtYWtlIG1heFNsaWRlcyBhbmQgbWluU2xpZGVzIGVxdWFsXG5cdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MubW9kZSA9PT0gJ3ZlcnRpY2FsJyl7IHNsaWRlci5zZXR0aW5ncy5tYXhTbGlkZXMgPSBzbGlkZXIuc2V0dGluZ3MubWluU2xpZGVzOyB9XG5cdFx0XHQvLyBzYXZlIG9yaWdpbmFsIHN0eWxlIGRhdGFcblx0XHRcdGVsLmRhdGEoXCJvcmlnU3R5bGVcIiwgZWwuYXR0cihcInN0eWxlXCIpKTtcblx0XHRcdGVsLmNoaWxkcmVuKHNsaWRlci5zZXR0aW5ncy5zbGlkZVNlbGVjdG9yKS5lYWNoKGZ1bmN0aW9uKCl7XG5cdFx0XHQgICQodGhpcykuZGF0YShcIm9yaWdTdHlsZVwiLCAkKHRoaXMpLmF0dHIoXCJzdHlsZVwiKSk7XG5cdFx0XHR9KTtcblx0XHRcdC8vIHBlcmZvcm0gYWxsIERPTSAvIENTUyBtb2RpZmljYXRpb25zXG5cdFx0XHRzZXR1cCgpO1xuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBQZXJmb3JtcyBhbGwgRE9NIGFuZCBDU1MgbW9kaWZpY2F0aW9uc1xuXHRcdCAqL1xuXHRcdHZhciBzZXR1cCA9IGZ1bmN0aW9uKCl7XG5cdFx0XHQvLyB3cmFwIGVsIGluIGEgd3JhcHBlclxuXHRcdFx0ZWwud3JhcCgnPGRpdiBjbGFzcz1cIicgKyBzbGlkZXIuc2V0dGluZ3Mud3JhcHBlckNsYXNzICsgJ1wiPjxkaXYgY2xhc3M9XCJieC12aWV3cG9ydFwiPjwvZGl2PjwvZGl2PicpO1xuXHRcdFx0Ly8gc3RvcmUgYSBuYW1lc3BhY2UgcmVmZXJlbmNlIHRvIC5ieC12aWV3cG9ydFxuXHRcdFx0c2xpZGVyLnZpZXdwb3J0ID0gZWwucGFyZW50KCk7XG5cdFx0XHQvLyBhZGQgYSBsb2FkaW5nIGRpdiB0byBkaXNwbGF5IHdoaWxlIGltYWdlcyBhcmUgbG9hZGluZ1xuXHRcdFx0c2xpZGVyLmxvYWRlciA9ICQoJzxkaXYgY2xhc3M9XCJieC1sb2FkaW5nXCIgLz4nKTtcblx0XHRcdHNsaWRlci52aWV3cG9ydC5wcmVwZW5kKHNsaWRlci5sb2FkZXIpO1xuXHRcdFx0Ly8gc2V0IGVsIHRvIGEgbWFzc2l2ZSB3aWR0aCwgdG8gaG9sZCBhbnkgbmVlZGVkIHNsaWRlc1xuXHRcdFx0Ly8gYWxzbyBzdHJpcCBhbnkgbWFyZ2luIGFuZCBwYWRkaW5nIGZyb20gZWxcblx0XHRcdGVsLmNzcyh7XG5cdFx0XHRcdHdpZHRoOiBzbGlkZXIuc2V0dGluZ3MubW9kZSA9PT0gJ2hvcml6b250YWwnID8gKHNsaWRlci5jaGlsZHJlbi5sZW5ndGggKiAxMDAwICsgMjE1KSArICclJyA6ICdhdXRvJyxcblx0XHRcdFx0cG9zaXRpb246ICdhYnNvbHV0ZSdcblx0XHRcdH0pO1xuXHRcdFx0Ly8gaWYgdXNpbmcgQ1NTLCBhZGQgdGhlIGVhc2luZyBwcm9wZXJ0eVxuXHRcdFx0aWYoc2xpZGVyLnVzaW5nQ1NTICYmIHNsaWRlci5zZXR0aW5ncy5lYXNpbmcpe1xuXHRcdFx0XHRlbC5jc3MoJy0nICsgc2xpZGVyLmNzc1ByZWZpeCArICctdHJhbnNpdGlvbi10aW1pbmctZnVuY3Rpb24nLCBzbGlkZXIuc2V0dGluZ3MuZWFzaW5nKTtcblx0XHRcdC8vIGlmIG5vdCB1c2luZyBDU1MgYW5kIG5vIGVhc2luZyB2YWx1ZSB3YXMgc3VwcGxpZWQsIHVzZSB0aGUgZGVmYXVsdCBKUyBhbmltYXRpb24gZWFzaW5nIChzd2luZylcblx0XHRcdH1lbHNlIGlmKCFzbGlkZXIuc2V0dGluZ3MuZWFzaW5nKXtcblx0XHRcdFx0c2xpZGVyLnNldHRpbmdzLmVhc2luZyA9ICdzd2luZyc7XG5cdFx0XHR9XG5cdFx0XHR2YXIgc2xpZGVzU2hvd2luZyA9IGdldE51bWJlclNsaWRlc1Nob3dpbmcoKTtcblx0XHRcdC8vIG1ha2UgbW9kaWZpY2F0aW9ucyB0byB0aGUgdmlld3BvcnQgKC5ieC12aWV3cG9ydClcblx0XHRcdHNsaWRlci52aWV3cG9ydC5jc3Moe1xuXHRcdFx0XHR3aWR0aDogJzEwMCUnLFxuXHRcdFx0XHRvdmVyZmxvdzogJ2hpZGRlbicsXG5cdFx0XHRcdHBvc2l0aW9uOiAncmVsYXRpdmUnXG5cdFx0XHR9KTtcblx0XHRcdHNsaWRlci52aWV3cG9ydC5wYXJlbnQoKS5jc3Moe1xuXHRcdFx0XHRtYXhXaWR0aDogZ2V0Vmlld3BvcnRNYXhXaWR0aCgpXG5cdFx0XHR9KTtcblx0XHRcdC8vIG1ha2UgbW9kaWZpY2F0aW9uIHRvIHRoZSB3cmFwcGVyICguYngtd3JhcHBlcilcblx0XHRcdGlmKCFzbGlkZXIuc2V0dGluZ3MucGFnZXIgJiYgIXNsaWRlci5zZXR0aW5ncy5jb250cm9scyl7XG5cdFx0XHRcdHNsaWRlci52aWV3cG9ydC5wYXJlbnQoKS5jc3Moe1xuXHRcdFx0XHRcdG1hcmdpbjogJzAgYXV0byAwcHgnXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdFx0Ly8gYXBwbHkgY3NzIHRvIGFsbCBzbGlkZXIgY2hpbGRyZW5cblx0XHRcdHNsaWRlci5jaGlsZHJlbi5jc3Moe1xuXHRcdFx0XHQnZmxvYXQnOiBzbGlkZXIuc2V0dGluZ3MubW9kZSA9PT0gJ2hvcml6b250YWwnID8gJ2xlZnQnIDogJ25vbmUnLFxuXHRcdFx0XHRsaXN0U3R5bGU6ICdub25lJyxcblx0XHRcdFx0cG9zaXRpb246ICdyZWxhdGl2ZSdcblx0XHRcdH0pO1xuXHRcdFx0Ly8gYXBwbHkgdGhlIGNhbGN1bGF0ZWQgd2lkdGggYWZ0ZXIgdGhlIGZsb2F0IGlzIGFwcGxpZWQgdG8gcHJldmVudCBzY3JvbGxiYXIgaW50ZXJmZXJlbmNlXG5cdFx0XHRzbGlkZXIuY2hpbGRyZW4uY3NzKCd3aWR0aCcsIGdldFNsaWRlV2lkdGgoKSk7XG5cdFx0XHQvLyBpZiBzbGlkZU1hcmdpbiBpcyBzdXBwbGllZCwgYWRkIHRoZSBjc3Ncblx0XHRcdGlmKHNsaWRlci5zZXR0aW5ncy5tb2RlID09PSAnaG9yaXpvbnRhbCcgJiYgc2xpZGVyLnNldHRpbmdzLnNsaWRlTWFyZ2luID4gMCl7IHNsaWRlci5jaGlsZHJlbi5jc3MoJ21hcmdpblJpZ2h0Jywgc2xpZGVyLnNldHRpbmdzLnNsaWRlTWFyZ2luKTsgfVxuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLm1vZGUgPT09ICd2ZXJ0aWNhbCcgJiYgc2xpZGVyLnNldHRpbmdzLnNsaWRlTWFyZ2luID4gMCl7IHNsaWRlci5jaGlsZHJlbi5jc3MoJ21hcmdpbkJvdHRvbScsIHNsaWRlci5zZXR0aW5ncy5zbGlkZU1hcmdpbik7IH1cblx0XHRcdC8vIGlmIFwiZmFkZVwiIG1vZGUsIGFkZCBwb3NpdGlvbmluZyBhbmQgei1pbmRleCBDU1Ncblx0XHRcdGlmKHNsaWRlci5zZXR0aW5ncy5tb2RlID09PSAnZmFkZScpe1xuXHRcdFx0XHRzbGlkZXIuY2hpbGRyZW4uY3NzKHtcblx0XHRcdFx0XHRwb3NpdGlvbjogJ2Fic29sdXRlJyxcblx0XHRcdFx0XHR6SW5kZXg6IDAsXG5cdFx0XHRcdFx0ZGlzcGxheTogJ25vbmUnXG5cdFx0XHRcdH0pO1xuXHRcdFx0XHQvLyBwcmVwYXJlIHRoZSB6LWluZGV4IG9uIHRoZSBzaG93aW5nIGVsZW1lbnRcblx0XHRcdFx0c2xpZGVyLmNoaWxkcmVuLmVxKHNsaWRlci5zZXR0aW5ncy5zdGFydFNsaWRlKS5jc3Moe3pJbmRleDogc2xpZGVyLnNldHRpbmdzLnNsaWRlWkluZGV4LCBkaXNwbGF5OiAnYmxvY2snfSk7XG5cdFx0XHR9XG5cdFx0XHQvLyBjcmVhdGUgYW4gZWxlbWVudCB0byBjb250YWluIGFsbCBzbGlkZXIgY29udHJvbHMgKHBhZ2VyLCBzdGFydCAvIHN0b3AsIGV0Yylcblx0XHRcdHNsaWRlci5jb250cm9scy5lbCA9ICQoJzxkaXYgY2xhc3M9XCJieC1jb250cm9sc1wiIC8+Jyk7XG5cdFx0XHQvLyBpZiBjYXB0aW9ucyBhcmUgcmVxdWVzdGVkLCBhZGQgdGhlbVxuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLmNhcHRpb25zKXsgYXBwZW5kQ2FwdGlvbnMoKTsgfVxuXHRcdFx0Ly8gY2hlY2sgaWYgc3RhcnRTbGlkZSBpcyBsYXN0IHNsaWRlXG5cdFx0XHRzbGlkZXIuYWN0aXZlLmxhc3QgPSBzbGlkZXIuc2V0dGluZ3Muc3RhcnRTbGlkZSA9PT0gZ2V0UGFnZXJRdHkoKSAtIDE7XG5cdFx0XHQvLyBpZiB2aWRlbyBpcyB0cnVlLCBzZXQgdXAgdGhlIGZpdFZpZHMgcGx1Z2luXG5cdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MudmlkZW8peyBlbC5maXRWaWRzKCk7IH1cblx0XHRcdC8vIHNldCB0aGUgZGVmYXVsdCBwcmVsb2FkIHNlbGVjdG9yICh2aXNpYmxlKVxuXHRcdFx0dmFyIHByZWxvYWRTZWxlY3RvciA9IHNsaWRlci5jaGlsZHJlbi5lcShzbGlkZXIuc2V0dGluZ3Muc3RhcnRTbGlkZSk7XG5cdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MucHJlbG9hZEltYWdlcyA9PT0gXCJhbGxcIiB8fCBzbGlkZXIuc2V0dGluZ3MudGlja2VyKXsgcHJlbG9hZFNlbGVjdG9yID0gc2xpZGVyLmNoaWxkcmVuOyB9XG5cdFx0XHQvLyBvbmx5IGNoZWNrIGZvciBjb250cm9sIGFkZGl0aW9uIGlmIG5vdCBpbiBcInRpY2tlclwiIG1vZGVcblx0XHRcdGlmKCFzbGlkZXIuc2V0dGluZ3MudGlja2VyKXtcblx0XHRcdFx0Ly8gaWYgY29udHJvbHMgYXJlIHJlcXVlc3RlZCwgYWRkIHRoZW1cblx0XHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLmNvbnRyb2xzKXsgYXBwZW5kQ29udHJvbHMoKTsgfVxuXHRcdFx0XHQvLyBpZiBhdXRvIGlzIHRydWUsIGFuZCBhdXRvIGNvbnRyb2xzIGFyZSByZXF1ZXN0ZWQsIGFkZCB0aGVtXG5cdFx0XHRcdGlmKHNsaWRlci5zZXR0aW5ncy5hdXRvICYmIHNsaWRlci5zZXR0aW5ncy5hdXRvQ29udHJvbHMpeyBhcHBlbmRDb250cm9sc0F1dG8oKTsgfVxuXHRcdFx0XHQvLyBpZiBwYWdlciBpcyByZXF1ZXN0ZWQsIGFkZCBpdFxuXHRcdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MucGFnZXIpeyBhcHBlbmRQYWdlcigpOyB9XG5cdFx0XHRcdC8vIGlmIGFueSBjb250cm9sIG9wdGlvbiBpcyByZXF1ZXN0ZWQsIGFkZCB0aGUgY29udHJvbHMgd3JhcHBlclxuXHRcdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MuY29udHJvbHMgfHwgc2xpZGVyLnNldHRpbmdzLmF1dG9Db250cm9scyB8fCBzbGlkZXIuc2V0dGluZ3MucGFnZXIpeyBzbGlkZXIudmlld3BvcnQuYWZ0ZXIoc2xpZGVyLmNvbnRyb2xzLmVsKTsgfVxuXHRcdFx0Ly8gaWYgdGlja2VyIG1vZGUsIGRvIG5vdCBhbGxvdyBhIHBhZ2VyXG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRzbGlkZXIuc2V0dGluZ3MucGFnZXIgPSBmYWxzZTtcblx0XHRcdH1cblx0XHRcdGxvYWRFbGVtZW50cyhwcmVsb2FkU2VsZWN0b3IsIHN0YXJ0KTtcblx0XHR9O1xuXG5cdFx0dmFyIGxvYWRFbGVtZW50cyA9IGZ1bmN0aW9uKHNlbGVjdG9yLCBjYWxsYmFjayl7XG5cdFx0XHR2YXIgdG90YWwgPSBzZWxlY3Rvci5maW5kKCdpbWc6bm90KFtzcmM9XCJcIl0pLCBpZnJhbWUnKS5sZW5ndGg7XG5cdFx0XHRpZih0b3RhbCA9PT0gMCl7XG5cdFx0XHRcdGNhbGxiYWNrKCk7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblx0XHRcdHZhciBjb3VudCA9IDA7XG5cdFx0XHRzZWxlY3Rvci5maW5kKCdpbWc6bm90KFtzcmM9XCJcIl0pLCBpZnJhbWUnKS5lYWNoKGZ1bmN0aW9uKCl7XG5cdFx0XHRcdCQodGhpcykub25lKCdsb2FkIGVycm9yJywgZnVuY3Rpb24oKXtcblx0XHRcdFx0ICBpZigrK2NvdW50ID09PSB0b3RhbCl7IGNhbGxiYWNrKCk7IH1cblx0XHRcdFx0fSkuZWFjaChmdW5jdGlvbigpe1xuXHRcdFx0XHQgIGlmKHRoaXMuY29tcGxldGUpeyAkKHRoaXMpLmxvYWQoKTsgfVxuXHRcdFx0XHR9KTtcblx0XHRcdH0pO1xuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBTdGFydCB0aGUgc2xpZGVyXG5cdFx0ICovXG5cdFx0dmFyIHN0YXJ0ID0gZnVuY3Rpb24oKXtcblx0XHRcdC8vIGlmIGluZmluaXRlIGxvb3AsIHByZXBhcmUgYWRkaXRpb25hbCBzbGlkZXNcblx0XHRcdGlmKHNsaWRlci5zZXR0aW5ncy5pbmZpbml0ZUxvb3AgJiYgc2xpZGVyLnNldHRpbmdzLm1vZGUgIT09ICdmYWRlJyAmJiAhc2xpZGVyLnNldHRpbmdzLnRpY2tlcil7XG5cdFx0XHRcdHZhciBzbGljZSA9IHNsaWRlci5zZXR0aW5ncy5tb2RlID09PSAndmVydGljYWwnID8gc2xpZGVyLnNldHRpbmdzLm1pblNsaWRlcyA6IHNsaWRlci5zZXR0aW5ncy5tYXhTbGlkZXM7XG5cdFx0XHRcdHZhciBzbGljZUFwcGVuZCA9IHNsaWRlci5jaGlsZHJlbi5zbGljZSgwLCBzbGljZSkuY2xvbmUodHJ1ZSkuYWRkQ2xhc3MoJ2J4LWNsb25lJyk7XG5cdFx0XHRcdHZhciBzbGljZVByZXBlbmQgPSBzbGlkZXIuY2hpbGRyZW4uc2xpY2UoLXNsaWNlKS5jbG9uZSh0cnVlKS5hZGRDbGFzcygnYngtY2xvbmUnKTtcblx0XHRcdFx0ZWwuYXBwZW5kKHNsaWNlQXBwZW5kKS5wcmVwZW5kKHNsaWNlUHJlcGVuZCk7XG5cdFx0XHR9XG5cdFx0XHQvLyByZW1vdmUgdGhlIGxvYWRpbmcgRE9NIGVsZW1lbnRcblx0XHRcdHNsaWRlci5sb2FkZXIucmVtb3ZlKCk7XG5cdFx0XHQvLyBzZXQgdGhlIGxlZnQgLyB0b3AgcG9zaXRpb24gb2YgXCJlbFwiXG5cdFx0XHRzZXRTbGlkZVBvc2l0aW9uKCk7XG5cdFx0XHQvLyBpZiBcInZlcnRpY2FsXCIgbW9kZSwgYWx3YXlzIHVzZSBhZGFwdGl2ZUhlaWdodCB0byBwcmV2ZW50IG9kZCBiZWhhdmlvclxuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLm1vZGUgPT09ICd2ZXJ0aWNhbCcpeyBzbGlkZXIuc2V0dGluZ3MuYWRhcHRpdmVIZWlnaHQgPSB0cnVlOyB9XG5cdFx0XHQvLyBzZXQgdGhlIHZpZXdwb3J0IGhlaWdodFxuXHRcdFx0c2xpZGVyLnZpZXdwb3J0LmhlaWdodChnZXRWaWV3cG9ydEhlaWdodCgpKTtcblx0XHRcdC8vIG1ha2Ugc3VyZSBldmVyeXRoaW5nIGlzIHBvc2l0aW9uZWQganVzdCByaWdodCAoc2FtZSBhcyBhIHdpbmRvdyByZXNpemUpXG5cdFx0XHRlbC5yZWRyYXdTbGlkZXIoKTtcblx0XHRcdC8vIG9uU2xpZGVyTG9hZCBjYWxsYmFja1xuXHRcdFx0c2xpZGVyLnNldHRpbmdzLm9uU2xpZGVyTG9hZChzbGlkZXIsc2xpZGVyLmFjdGl2ZS5pbmRleCk7XG5cdFx0XHQvLyBzbGlkZXIgaGFzIGJlZW4gZnVsbHkgaW5pdGlhbGl6ZWRcblx0XHRcdHNsaWRlci5pbml0aWFsaXplZCA9IHRydWU7XG5cdFx0XHQvLyBiaW5kIHRoZSByZXNpemUgY2FsbCB0byB0aGUgd2luZG93XG5cdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MucmVzcG9uc2l2ZSl7ICQod2luZG93KS5iaW5kKCdyZXNpemUnLCByZXNpemVXaW5kb3cpOyB9XG5cdFx0XHQvLyBpZiBhdXRvIGlzIHRydWUgYW5kIGhhcyBtb3JlIHRoYW4gMSBwYWdlLCBzdGFydCB0aGUgc2hvd1xuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLmF1dG8gJiYgc2xpZGVyLnNldHRpbmdzLmF1dG9TdGFydCAmJiAoZ2V0UGFnZXJRdHkoKSA+IDEgfHwgc2xpZGVyLnNldHRpbmdzLmF1dG9TbGlkZUZvck9uZVBhZ2UpKXsgaW5pdEF1dG8oKTsgfVxuXHRcdFx0Ly8gaWYgdGlja2VyIGlzIHRydWUsIHN0YXJ0IHRoZSB0aWNrZXJcblx0XHRcdGlmKHNsaWRlci5zZXR0aW5ncy50aWNrZXIpeyBpbml0VGlja2VyKCk7IH1cblx0XHRcdC8vIGlmIHBhZ2VyIGlzIHJlcXVlc3RlZCwgbWFrZSB0aGUgYXBwcm9wcmlhdGUgcGFnZXIgbGluayBhY3RpdmVcblx0XHRcdGlmKHNsaWRlci5zZXR0aW5ncy5wYWdlcil7IHVwZGF0ZVBhZ2VyQWN0aXZlKHNsaWRlci5zZXR0aW5ncy5zdGFydFNsaWRlKTsgfVxuXHRcdFx0Ly8gY2hlY2sgZm9yIGFueSB1cGRhdGVzIHRvIHRoZSBjb250cm9scyAobGlrZSBoaWRlQ29udHJvbE9uRW5kIHVwZGF0ZXMpXG5cdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MuY29udHJvbHMpeyB1cGRhdGVEaXJlY3Rpb25Db250cm9scygpOyB9XG5cdFx0XHQvLyBpZiB0b3VjaEVuYWJsZWQgaXMgdHJ1ZSwgc2V0dXAgdGhlIHRvdWNoIGV2ZW50c1xuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLnRvdWNoRW5hYmxlZCAmJiAhc2xpZGVyLnNldHRpbmdzLnRpY2tlcil7IGluaXRUb3VjaCgpOyB9XG5cdFx0XHQvLyBpZiBrZXlib2FyZEVuYWJsZWQgaXMgdHJ1ZSwgc2V0dXAgdGhlIGtleWJvYXJkIGV2ZW50c1xuXHRcdFx0aWYgKHNsaWRlci5zZXR0aW5ncy5rZXlib2FyZEVuYWJsZWQgJiYgIXNsaWRlci5zZXR0aW5ncy50aWNrZXIpIHsgXG5cdFx0XHRcdCQoZG9jdW1lbnQpLmtleWRvd24oa2V5UHJlc3MpO1xuXHRcdFx0fVxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIHRoZSBjYWxjdWxhdGVkIGhlaWdodCBvZiB0aGUgdmlld3BvcnQsIHVzZWQgdG8gZGV0ZXJtaW5lIGVpdGhlciBhZGFwdGl2ZUhlaWdodCBvciB0aGUgbWF4SGVpZ2h0IHZhbHVlXG5cdFx0ICovXG5cdFx0dmFyIGdldFZpZXdwb3J0SGVpZ2h0ID0gZnVuY3Rpb24oKXtcblx0XHRcdHZhciBoZWlnaHQgPSAwO1xuXHRcdFx0Ly8gZmlyc3QgZGV0ZXJtaW5lIHdoaWNoIGNoaWxkcmVuIChzbGlkZXMpIHNob3VsZCBiZSB1c2VkIGluIG91ciBoZWlnaHQgY2FsY3VsYXRpb25cblx0XHRcdHZhciBjaGlsZHJlbiA9ICQoKTtcblx0XHRcdC8vIGlmIG1vZGUgaXMgbm90IFwidmVydGljYWxcIiBhbmQgYWRhcHRpdmVIZWlnaHQgaXMgZmFsc2UsIGluY2x1ZGUgYWxsIGNoaWxkcmVuXG5cdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MubW9kZSAhPT0gJ3ZlcnRpY2FsJyAmJiAhc2xpZGVyLnNldHRpbmdzLmFkYXB0aXZlSGVpZ2h0KXtcblx0XHRcdFx0Y2hpbGRyZW4gPSBzbGlkZXIuY2hpbGRyZW47XG5cdFx0XHR9ZWxzZXtcblx0XHRcdFx0Ly8gaWYgbm90IGNhcm91c2VsLCByZXR1cm4gdGhlIHNpbmdsZSBhY3RpdmUgY2hpbGRcblx0XHRcdFx0aWYoIXNsaWRlci5jYXJvdXNlbCl7XG5cdFx0XHRcdFx0Y2hpbGRyZW4gPSBzbGlkZXIuY2hpbGRyZW4uZXEoc2xpZGVyLmFjdGl2ZS5pbmRleCk7XG5cdFx0XHRcdC8vIGlmIGNhcm91c2VsLCByZXR1cm4gYSBzbGljZSBvZiBjaGlsZHJlblxuXHRcdFx0XHR9ZWxzZXtcblx0XHRcdFx0XHQvLyBnZXQgdGhlIGluZGl2aWR1YWwgc2xpZGUgaW5kZXhcblx0XHRcdFx0XHR2YXIgY3VycmVudEluZGV4ID0gc2xpZGVyLnNldHRpbmdzLm1vdmVTbGlkZXMgPT09IDEgPyBzbGlkZXIuYWN0aXZlLmluZGV4IDogc2xpZGVyLmFjdGl2ZS5pbmRleCAqIGdldE1vdmVCeSgpO1xuXHRcdFx0XHRcdC8vIGFkZCB0aGUgY3VycmVudCBzbGlkZSB0byB0aGUgY2hpbGRyZW5cblx0XHRcdFx0XHRjaGlsZHJlbiA9IHNsaWRlci5jaGlsZHJlbi5lcShjdXJyZW50SW5kZXgpO1xuXHRcdFx0XHRcdC8vIGN5Y2xlIHRocm91Z2ggdGhlIHJlbWFpbmluZyBcInNob3dpbmdcIiBzbGlkZXNcblx0XHRcdFx0XHRmb3IgKGkgPSAxOyBpIDw9IHNsaWRlci5zZXR0aW5ncy5tYXhTbGlkZXMgLSAxOyBpKyspe1xuXHRcdFx0XHRcdFx0Ly8gaWYgbG9vcGVkIGJhY2sgdG8gdGhlIHN0YXJ0XG5cdFx0XHRcdFx0XHRpZihjdXJyZW50SW5kZXggKyBpID49IHNsaWRlci5jaGlsZHJlbi5sZW5ndGgpe1xuXHRcdFx0XHRcdFx0XHRjaGlsZHJlbiA9IGNoaWxkcmVuLmFkZChzbGlkZXIuY2hpbGRyZW4uZXEoaSAtIDEpKTtcblx0XHRcdFx0XHRcdH1lbHNle1xuXHRcdFx0XHRcdFx0XHRjaGlsZHJlbiA9IGNoaWxkcmVuLmFkZChzbGlkZXIuY2hpbGRyZW4uZXEoY3VycmVudEluZGV4ICsgaSkpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0Ly8gaWYgXCJ2ZXJ0aWNhbFwiIG1vZGUsIGNhbGN1bGF0ZSB0aGUgc3VtIG9mIHRoZSBoZWlnaHRzIG9mIHRoZSBjaGlsZHJlblxuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLm1vZGUgPT09ICd2ZXJ0aWNhbCcpe1xuXHRcdFx0XHRjaGlsZHJlbi5lYWNoKGZ1bmN0aW9uKGluZGV4KXtcblx0XHRcdFx0ICBoZWlnaHQgKz0gJCh0aGlzKS5vdXRlckhlaWdodCgpO1xuXHRcdFx0XHR9KTtcblx0XHRcdFx0Ly8gYWRkIHVzZXItc3VwcGxpZWQgbWFyZ2luc1xuXHRcdFx0XHRpZihzbGlkZXIuc2V0dGluZ3Muc2xpZGVNYXJnaW4gPiAwKXtcblx0XHRcdFx0XHRoZWlnaHQgKz0gc2xpZGVyLnNldHRpbmdzLnNsaWRlTWFyZ2luICogKHNsaWRlci5zZXR0aW5ncy5taW5TbGlkZXMgLSAxKTtcblx0XHRcdFx0fVxuXHRcdFx0Ly8gaWYgbm90IFwidmVydGljYWxcIiBtb2RlLCBjYWxjdWxhdGUgdGhlIG1heCBoZWlnaHQgb2YgdGhlIGNoaWxkcmVuXG5cdFx0XHR9ZWxzZXtcblx0XHRcdFx0aGVpZ2h0ID0gTWF0aC5tYXguYXBwbHkoTWF0aCwgY2hpbGRyZW4ubWFwKGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0cmV0dXJuICQodGhpcykub3V0ZXJIZWlnaHQoZmFsc2UpO1xuXHRcdFx0XHR9KS5nZXQoKSk7XG5cdFx0XHR9XG5cblx0XHRcdGlmKHNsaWRlci52aWV3cG9ydC5jc3MoJ2JveC1zaXppbmcnKSA9PT0gJ2JvcmRlci1ib3gnKXtcblx0XHRcdFx0aGVpZ2h0ICs9XHRwYXJzZUZsb2F0KHNsaWRlci52aWV3cG9ydC5jc3MoJ3BhZGRpbmctdG9wJykpICsgcGFyc2VGbG9hdChzbGlkZXIudmlld3BvcnQuY3NzKCdwYWRkaW5nLWJvdHRvbScpKSArXG5cdFx0XHRcdFx0XHRcdHBhcnNlRmxvYXQoc2xpZGVyLnZpZXdwb3J0LmNzcygnYm9yZGVyLXRvcC13aWR0aCcpKSArIHBhcnNlRmxvYXQoc2xpZGVyLnZpZXdwb3J0LmNzcygnYm9yZGVyLWJvdHRvbS13aWR0aCcpKTtcblx0XHRcdH1lbHNlIGlmKHNsaWRlci52aWV3cG9ydC5jc3MoJ2JveC1zaXppbmcnKSA9PT0gJ3BhZGRpbmctYm94Jyl7XG5cdFx0XHRcdGhlaWdodCArPVx0cGFyc2VGbG9hdChzbGlkZXIudmlld3BvcnQuY3NzKCdwYWRkaW5nLXRvcCcpKSArIHBhcnNlRmxvYXQoc2xpZGVyLnZpZXdwb3J0LmNzcygncGFkZGluZy1ib3R0b20nKSk7XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiBoZWlnaHQ7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgdGhlIGNhbGN1bGF0ZWQgd2lkdGggdG8gYmUgdXNlZCBmb3IgdGhlIG91dGVyIHdyYXBwZXIgLyB2aWV3cG9ydFxuXHRcdCAqL1xuXHRcdHZhciBnZXRWaWV3cG9ydE1heFdpZHRoID0gZnVuY3Rpb24oKXtcblx0XHRcdHZhciB3aWR0aCA9ICcxMDAlJztcblx0XHRcdGlmKHNsaWRlci5zZXR0aW5ncy5zbGlkZVdpZHRoID4gMCl7XG5cdFx0XHRcdGlmKHNsaWRlci5zZXR0aW5ncy5tb2RlID09PSAnaG9yaXpvbnRhbCcpe1xuXHRcdFx0XHRcdHdpZHRoID0gKHNsaWRlci5zZXR0aW5ncy5tYXhTbGlkZXMgKiBzbGlkZXIuc2V0dGluZ3Muc2xpZGVXaWR0aCkgKyAoKHNsaWRlci5zZXR0aW5ncy5tYXhTbGlkZXMgLSAxKSAqIHNsaWRlci5zZXR0aW5ncy5zbGlkZU1hcmdpbik7XG5cdFx0XHRcdH1lbHNle1xuXHRcdFx0XHRcdHdpZHRoID0gc2xpZGVyLnNldHRpbmdzLnNsaWRlV2lkdGg7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdHJldHVybiB3aWR0aDtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0aGUgY2FsY3VsYXRlZCB3aWR0aCB0byBiZSBhcHBsaWVkIHRvIGVhY2ggc2xpZGVcblx0XHQgKi9cblx0XHR2YXIgZ2V0U2xpZGVXaWR0aCA9IGZ1bmN0aW9uKCl7XG5cdFx0XHQvLyBzdGFydCB3aXRoIGFueSB1c2VyLXN1cHBsaWVkIHNsaWRlIHdpZHRoXG5cdFx0XHR2YXIgbmV3RWxXaWR0aCA9IHNsaWRlci5zZXR0aW5ncy5zbGlkZVdpZHRoO1xuXHRcdFx0Ly8gZ2V0IHRoZSBjdXJyZW50IHZpZXdwb3J0IHdpZHRoXG5cdFx0XHR2YXIgd3JhcFdpZHRoID0gc2xpZGVyLnZpZXdwb3J0LndpZHRoKCk7XG5cdFx0XHQvLyBpZiBzbGlkZSB3aWR0aCB3YXMgbm90IHN1cHBsaWVkLCBvciBpcyBsYXJnZXIgdGhhbiB0aGUgdmlld3BvcnQgdXNlIHRoZSB2aWV3cG9ydCB3aWR0aFxuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLnNsaWRlV2lkdGggPT09IDAgfHxcblx0XHRcdFx0KHNsaWRlci5zZXR0aW5ncy5zbGlkZVdpZHRoID4gd3JhcFdpZHRoICYmICFzbGlkZXIuY2Fyb3VzZWwpIHx8XG5cdFx0XHRcdHNsaWRlci5zZXR0aW5ncy5tb2RlID09PSAndmVydGljYWwnKXtcblx0XHRcdFx0bmV3RWxXaWR0aCA9IHdyYXBXaWR0aDtcblx0XHRcdC8vIGlmIGNhcm91c2VsLCB1c2UgdGhlIHRocmVzaG9sZHMgdG8gZGV0ZXJtaW5lIHRoZSB3aWR0aFxuXHRcdFx0fWVsc2UgaWYoc2xpZGVyLnNldHRpbmdzLm1heFNsaWRlcyA+IDEgJiYgc2xpZGVyLnNldHRpbmdzLm1vZGUgPT09ICdob3Jpem9udGFsJyl7XG5cdFx0XHRcdGlmKHdyYXBXaWR0aCA+IHNsaWRlci5tYXhUaHJlc2hvbGQpe1xuXHRcdFx0XHRcdC8vIG5ld0VsV2lkdGggPSAod3JhcFdpZHRoIC0gKHNsaWRlci5zZXR0aW5ncy5zbGlkZU1hcmdpbiAqIChzbGlkZXIuc2V0dGluZ3MubWF4U2xpZGVzIC0gMSkpKSAvIHNsaWRlci5zZXR0aW5ncy5tYXhTbGlkZXM7XG5cdFx0XHRcdH1lbHNlIGlmKHdyYXBXaWR0aCA8IHNsaWRlci5taW5UaHJlc2hvbGQpe1xuXHRcdFx0XHRcdG5ld0VsV2lkdGggPSAod3JhcFdpZHRoIC0gKHNsaWRlci5zZXR0aW5ncy5zbGlkZU1hcmdpbiAqIChzbGlkZXIuc2V0dGluZ3MubWluU2xpZGVzIC0gMSkpKSAvIHNsaWRlci5zZXR0aW5ncy5taW5TbGlkZXM7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdHJldHVybiBuZXdFbFdpZHRoO1xuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIHRoZSBudW1iZXIgb2Ygc2xpZGVzIGN1cnJlbnRseSB2aXNpYmxlIGluIHRoZSB2aWV3cG9ydCAoaW5jbHVkZXMgcGFydGlhbGx5IHZpc2libGUgc2xpZGVzKVxuXHRcdCAqL1xuXHRcdHZhciBnZXROdW1iZXJTbGlkZXNTaG93aW5nID0gZnVuY3Rpb24oKXtcblx0XHRcdHZhciBzbGlkZXNTaG93aW5nID0gMTtcblx0XHRcdGlmKHNsaWRlci5zZXR0aW5ncy5tb2RlID09PSAnaG9yaXpvbnRhbCcgJiYgc2xpZGVyLnNldHRpbmdzLnNsaWRlV2lkdGggPiAwKXtcblx0XHRcdFx0Ly8gaWYgdmlld3BvcnQgaXMgc21hbGxlciB0aGFuIG1pblRocmVzaG9sZCwgcmV0dXJuIG1pblNsaWRlc1xuXHRcdFx0XHRpZihzbGlkZXIudmlld3BvcnQud2lkdGgoKSA8IHNsaWRlci5taW5UaHJlc2hvbGQpe1xuXHRcdFx0XHRcdHNsaWRlc1Nob3dpbmcgPSBzbGlkZXIuc2V0dGluZ3MubWluU2xpZGVzO1xuXHRcdFx0XHQvLyBpZiB2aWV3cG9ydCBpcyBsYXJnZXIgdGhhbiBtYXhUaHJlc2hvbGQsIHJldHVybiBtYXhTbGlkZXNcblx0XHRcdFx0fWVsc2UgaWYoc2xpZGVyLnZpZXdwb3J0LndpZHRoKCkgPiBzbGlkZXIubWF4VGhyZXNob2xkKXtcblx0XHRcdFx0XHRzbGlkZXNTaG93aW5nID0gc2xpZGVyLnNldHRpbmdzLm1heFNsaWRlcztcblx0XHRcdFx0Ly8gaWYgdmlld3BvcnQgaXMgYmV0d2VlbiBtaW4gLyBtYXggdGhyZXNob2xkcywgZGl2aWRlIHZpZXdwb3J0IHdpZHRoIGJ5IGZpcnN0IGNoaWxkIHdpZHRoXG5cdFx0XHRcdH1lbHNle1xuXHRcdFx0XHRcdHZhciBjaGlsZFdpZHRoID0gc2xpZGVyLmNoaWxkcmVuLmZpcnN0KCkud2lkdGgoKSArIHNsaWRlci5zZXR0aW5ncy5zbGlkZU1hcmdpbjtcblx0XHRcdFx0XHRzbGlkZXNTaG93aW5nID0gTWF0aC5mbG9vcigoc2xpZGVyLnZpZXdwb3J0LndpZHRoKCkgK1xuXHRcdFx0XHRcdFx0c2xpZGVyLnNldHRpbmdzLnNsaWRlTWFyZ2luKSAvIGNoaWxkV2lkdGgpO1xuXHRcdFx0XHR9XG5cdFx0XHQvLyBpZiBcInZlcnRpY2FsXCIgbW9kZSwgc2xpZGVzIHNob3dpbmcgd2lsbCBhbHdheXMgYmUgbWluU2xpZGVzXG5cdFx0XHR9ZWxzZSBpZihzbGlkZXIuc2V0dGluZ3MubW9kZSA9PT0gJ3ZlcnRpY2FsJyl7XG5cdFx0XHRcdHNsaWRlc1Nob3dpbmcgPSBzbGlkZXIuc2V0dGluZ3MubWluU2xpZGVzO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHNsaWRlc1Nob3dpbmc7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgdGhlIG51bWJlciBvZiBwYWdlcyAob25lIGZ1bGwgdmlld3BvcnQgb2Ygc2xpZGVzIGlzIG9uZSBcInBhZ2VcIilcblx0XHQgKi9cblx0XHR2YXIgZ2V0UGFnZXJRdHkgPSBmdW5jdGlvbigpe1xuXHRcdFx0dmFyIHBhZ2VyUXR5ID0gMDtcblx0XHRcdC8vIGlmIG1vdmVTbGlkZXMgaXMgc3BlY2lmaWVkIGJ5IHRoZSB1c2VyXG5cdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MubW92ZVNsaWRlcyA+IDApe1xuXHRcdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MuaW5maW5pdGVMb29wKXtcblx0XHRcdFx0XHRwYWdlclF0eSA9IE1hdGguY2VpbChzbGlkZXIuY2hpbGRyZW4ubGVuZ3RoIC8gZ2V0TW92ZUJ5KCkpO1xuXHRcdFx0XHR9ZWxzZXtcblx0XHRcdFx0XHQvLyB1c2UgYSB3aGlsZSBsb29wIHRvIGRldGVybWluZSBwYWdlc1xuXHRcdFx0XHRcdHZhciBicmVha1BvaW50ID0gMDtcblx0XHRcdFx0XHR2YXIgY291bnRlciA9IDA7XG5cdFx0XHRcdFx0Ly8gd2hlbiBicmVha3BvaW50IGdvZXMgYWJvdmUgY2hpbGRyZW4gbGVuZ3RoLCBjb3VudGVyIGlzIHRoZSBudW1iZXIgb2YgcGFnZXNcblx0XHRcdFx0XHR3aGlsZSAoYnJlYWtQb2ludCA8IHNsaWRlci5jaGlsZHJlbi5sZW5ndGgpe1xuXHRcdFx0XHRcdFx0KytwYWdlclF0eTtcblx0XHRcdFx0XHRcdGJyZWFrUG9pbnQgPSBjb3VudGVyICsgZ2V0TnVtYmVyU2xpZGVzU2hvd2luZygpO1xuXHRcdFx0XHRcdFx0Y291bnRlciArPSBzbGlkZXIuc2V0dGluZ3MubW92ZVNsaWRlcyA8PSBnZXROdW1iZXJTbGlkZXNTaG93aW5nKCkgPyBzbGlkZXIuc2V0dGluZ3MubW92ZVNsaWRlcyA6IGdldE51bWJlclNsaWRlc1Nob3dpbmcoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdC8vIGlmIG1vdmVTbGlkZXMgaXMgMCAoYXV0bykgZGl2aWRlIGNoaWxkcmVuIGxlbmd0aCBieSBzaWRlcyBzaG93aW5nLCB0aGVuIHJvdW5kIHVwXG5cdFx0XHR9ZWxzZXtcblx0XHRcdFx0cGFnZXJRdHkgPSBNYXRoLmNlaWwoc2xpZGVyLmNoaWxkcmVuLmxlbmd0aCAvIGdldE51bWJlclNsaWRlc1Nob3dpbmcoKSk7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gcGFnZXJRdHk7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgdGhlIG51bWJlciBvZiBpbmRpdmlkdWFsIHNsaWRlcyBieSB3aGljaCB0byBzaGlmdCB0aGUgc2xpZGVyXG5cdFx0ICovXG5cdFx0dmFyIGdldE1vdmVCeSA9IGZ1bmN0aW9uKCl7XG5cdFx0XHQvLyBpZiBtb3ZlU2xpZGVzIHdhcyBzZXQgYnkgdGhlIHVzZXIgYW5kIG1vdmVTbGlkZXMgaXMgbGVzcyB0aGFuIG51bWJlciBvZiBzbGlkZXMgc2hvd2luZ1xuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLm1vdmVTbGlkZXMgPiAwICYmIHNsaWRlci5zZXR0aW5ncy5tb3ZlU2xpZGVzIDw9IGdldE51bWJlclNsaWRlc1Nob3dpbmcoKSl7XG5cdFx0XHRcdHJldHVybiBzbGlkZXIuc2V0dGluZ3MubW92ZVNsaWRlcztcblx0XHRcdH1cblx0XHRcdC8vIGlmIG1vdmVTbGlkZXMgaXMgMCAoYXV0bylcblx0XHRcdHJldHVybiBnZXROdW1iZXJTbGlkZXNTaG93aW5nKCk7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIFNldHMgdGhlIHNsaWRlcidzIChlbCkgbGVmdCBvciB0b3AgcG9zaXRpb25cblx0XHQgKi9cblx0XHR2YXIgc2V0U2xpZGVQb3NpdGlvbiA9IGZ1bmN0aW9uKCl7XG5cdFx0XHR2YXIgcG9zaXRpb247XG5cdFx0XHQvLyBpZiBsYXN0IHNsaWRlLCBub3QgaW5maW5pdGUgbG9vcCwgYW5kIG51bWJlciBvZiBjaGlsZHJlbiBpcyBsYXJnZXIgdGhhbiBzcGVjaWZpZWQgbWF4U2xpZGVzXG5cdFx0XHRpZihzbGlkZXIuY2hpbGRyZW4ubGVuZ3RoID4gc2xpZGVyLnNldHRpbmdzLm1heFNsaWRlcyAmJiBzbGlkZXIuYWN0aXZlLmxhc3QgJiYgIXNsaWRlci5zZXR0aW5ncy5pbmZpbml0ZUxvb3Ape1xuXHRcdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MubW9kZSA9PT0gJ2hvcml6b250YWwnKXtcblx0XHRcdFx0XHQvLyBnZXQgdGhlIGxhc3QgY2hpbGQncyBwb3NpdGlvblxuXHRcdFx0XHRcdHZhciBsYXN0Q2hpbGQgPSBzbGlkZXIuY2hpbGRyZW4ubGFzdCgpO1xuXHRcdFx0XHRcdHBvc2l0aW9uID0gbGFzdENoaWxkLnBvc2l0aW9uKCk7XG5cdFx0XHRcdFx0Ly8gc2V0IHRoZSBsZWZ0IHBvc2l0aW9uXG5cdFx0XHRcdFx0c2V0UG9zaXRpb25Qcm9wZXJ0eSgtKHBvc2l0aW9uLmxlZnQgLSAoc2xpZGVyLnZpZXdwb3J0LndpZHRoKCkgLSBsYXN0Q2hpbGQub3V0ZXJXaWR0aCgpKSksICdyZXNldCcsIDApO1xuXHRcdFx0XHR9ZWxzZSBpZihzbGlkZXIuc2V0dGluZ3MubW9kZSA9PT0gJ3ZlcnRpY2FsJyl7XG5cdFx0XHRcdFx0Ly8gZ2V0IHRoZSBsYXN0IHNob3dpbmcgaW5kZXgncyBwb3NpdGlvblxuXHRcdFx0XHRcdHZhciBsYXN0U2hvd2luZ0luZGV4ID0gc2xpZGVyLmNoaWxkcmVuLmxlbmd0aCAtIHNsaWRlci5zZXR0aW5ncy5taW5TbGlkZXM7XG5cdFx0XHRcdFx0cG9zaXRpb24gPSBzbGlkZXIuY2hpbGRyZW4uZXEobGFzdFNob3dpbmdJbmRleCkucG9zaXRpb24oKTtcblx0XHRcdFx0XHQvLyBzZXQgdGhlIHRvcCBwb3NpdGlvblxuXHRcdFx0XHRcdHNldFBvc2l0aW9uUHJvcGVydHkoLXBvc2l0aW9uLnRvcCwgJ3Jlc2V0JywgMCk7XG5cdFx0XHRcdH1cblx0XHRcdC8vIGlmIG5vdCBsYXN0IHNsaWRlXG5cdFx0XHR9ZWxzZXtcblx0XHRcdFx0Ly8gZ2V0IHRoZSBwb3NpdGlvbiBvZiB0aGUgZmlyc3Qgc2hvd2luZyBzbGlkZVxuXHRcdFx0XHRwb3NpdGlvbiA9IHNsaWRlci5jaGlsZHJlbi5lcShzbGlkZXIuYWN0aXZlLmluZGV4ICogZ2V0TW92ZUJ5KCkpLnBvc2l0aW9uKCk7XG5cdFx0XHRcdC8vIGNoZWNrIGZvciBsYXN0IHNsaWRlXG5cdFx0XHRcdGlmKHNsaWRlci5hY3RpdmUuaW5kZXggPT09IGdldFBhZ2VyUXR5KCkgLSAxKXsgc2xpZGVyLmFjdGl2ZS5sYXN0ID0gdHJ1ZTsgfVxuXHRcdFx0XHQvLyBzZXQgdGhlIHJlc3BlY3RpdmUgcG9zaXRpb25cblx0XHRcdFx0aWYocG9zaXRpb24gIT09IHVuZGVmaW5lZCl7XG5cdFx0XHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLm1vZGUgPT09ICdob3Jpem9udGFsJyl7IHNldFBvc2l0aW9uUHJvcGVydHkoLXBvc2l0aW9uLmxlZnQsICdyZXNldCcsIDApOyB9XG5cdFx0XHRcdFx0ZWxzZSBpZihzbGlkZXIuc2V0dGluZ3MubW9kZSA9PT0gJ3ZlcnRpY2FsJyl7IHNldFBvc2l0aW9uUHJvcGVydHkoLXBvc2l0aW9uLnRvcCwgJ3Jlc2V0JywgMCk7IH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBTZXRzIHRoZSBlbCdzIGFuaW1hdGluZyBwcm9wZXJ0eSBwb3NpdGlvbiAod2hpY2ggaW4gdHVybiB3aWxsIHNvbWV0aW1lcyBhbmltYXRlIGVsKS5cblx0XHQgKiBJZiB1c2luZyBDU1MsIHNldHMgdGhlIHRyYW5zZm9ybSBwcm9wZXJ0eS4gSWYgbm90IHVzaW5nIENTUywgc2V0cyB0aGUgdG9wIC8gbGVmdCBwcm9wZXJ0eS5cblx0XHQgKlxuXHRcdCAqIEBwYXJhbSB2YWx1ZSAoaW50KVxuXHRcdCAqICAtIHRoZSBhbmltYXRpbmcgcHJvcGVydHkncyB2YWx1ZVxuXHRcdCAqXG5cdFx0ICogQHBhcmFtIHR5cGUgKHN0cmluZykgJ3NsaWRlJywgJ3Jlc2V0JywgJ3RpY2tlcidcblx0XHQgKiAgLSB0aGUgdHlwZSBvZiBpbnN0YW5jZSBmb3Igd2hpY2ggdGhlIGZ1bmN0aW9uIGlzIGJlaW5nXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0gZHVyYXRpb24gKGludClcblx0XHQgKiAgLSB0aGUgYW1vdW50IG9mIHRpbWUgKGluIG1zKSB0aGUgdHJhbnNpdGlvbiBzaG91bGQgb2NjdXB5XG5cdFx0ICpcblx0XHQgKiBAcGFyYW0gcGFyYW1zIChhcnJheSkgb3B0aW9uYWxcblx0XHQgKiAgLSBhbiBvcHRpb25hbCBwYXJhbWV0ZXIgY29udGFpbmluZyBhbnkgdmFyaWFibGVzIHRoYXQgbmVlZCB0byBiZSBwYXNzZWQgaW5cblx0XHQgKi9cblx0XHR2YXIgc2V0UG9zaXRpb25Qcm9wZXJ0eSA9IGZ1bmN0aW9uKHZhbHVlLCB0eXBlLCBkdXJhdGlvbiwgcGFyYW1zKXtcblx0XHRcdC8vIHVzZSBDU1MgdHJhbnNmb3JtXG5cdFx0XHRpZihzbGlkZXIudXNpbmdDU1Mpe1xuXHRcdFx0XHQvLyBkZXRlcm1pbmUgdGhlIHRyYW5zbGF0ZTNkIHZhbHVlXG5cdFx0XHRcdHZhciBwcm9wVmFsdWUgPSBzbGlkZXIuc2V0dGluZ3MubW9kZSA9PT0gJ3ZlcnRpY2FsJyA/ICd0cmFuc2xhdGUzZCgwLCAnICsgdmFsdWUgKyAncHgsIDApJyA6ICd0cmFuc2xhdGUzZCgnICsgdmFsdWUgKyAncHgsIDAsIDApJztcblx0XHRcdFx0Ly8gYWRkIHRoZSBDU1MgdHJhbnNpdGlvbi1kdXJhdGlvblxuXHRcdFx0XHRlbC5jc3MoJy0nICsgc2xpZGVyLmNzc1ByZWZpeCArICctdHJhbnNpdGlvbi1kdXJhdGlvbicsIGR1cmF0aW9uIC8gMTAwMCArICdzJyk7XG5cdFx0XHRcdGlmKHR5cGUgPT09ICdzbGlkZScpe1xuXHRcdFx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHQvLyBzZXQgdGhlIHByb3BlcnR5IHZhbHVlXG5cdFx0XHRcdFx0XHRlbC5jc3Moc2xpZGVyLmFuaW1Qcm9wLCBwcm9wVmFsdWUpO1xuXHRcdFx0XHRcdFx0Ly8gaWYgdmFsdWUgMCwganVzdCB1cGRhdGVcblx0XHRcdFx0XHRcdGlmKHZhbHVlID09PSAwKSB7XG5cdFx0XHRcdFx0XHRcdHVwZGF0ZUFmdGVyU2xpZGVUcmFuc2l0aW9uKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHQvLyBiaW5kIGEgY2FsbGJhY2sgbWV0aG9kIC0gZXhlY3V0ZXMgd2hlbiBDU1MgdHJhbnNpdGlvbiBjb21wbGV0ZXNcblx0XHRcdFx0XHRcdFx0ZWwuYmluZCgndHJhbnNpdGlvbmVuZCB3ZWJraXRUcmFuc2l0aW9uRW5kIG9UcmFuc2l0aW9uRW5kIE1TVHJhbnNpdGlvbkVuZCcsIGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0XHRcdFx0Ly8gdW5iaW5kIHRoZSBjYWxsYmFja1xuXHRcdFx0XHRcdFx0XHRcdGVsLnVuYmluZCgndHJhbnNpdGlvbmVuZCB3ZWJraXRUcmFuc2l0aW9uRW5kIG9UcmFuc2l0aW9uRW5kIE1TVHJhbnNpdGlvbkVuZCcpO1xuXHRcdFx0XHRcdFx0XHRcdHVwZGF0ZUFmdGVyU2xpZGVUcmFuc2l0aW9uKCk7XG5cdFx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH0sIDApO1xuXHRcdFx0XHR9ZWxzZSBpZih0eXBlID09PSAncmVzZXQnKXtcblx0XHRcdFx0XHRlbC5jc3Moc2xpZGVyLmFuaW1Qcm9wLCBwcm9wVmFsdWUpO1xuXHRcdFx0XHR9ZWxzZSBpZih0eXBlID09PSAndGlja2VyJyl7XG5cdFx0XHRcdFx0Ly8gbWFrZSB0aGUgdHJhbnNpdGlvbiB1c2UgJ2xpbmVhcidcblx0XHRcdFx0XHRlbC5jc3MoJy0nICsgc2xpZGVyLmNzc1ByZWZpeCArICctdHJhbnNpdGlvbi10aW1pbmctZnVuY3Rpb24nLCAnbGluZWFyJyk7XG5cdFx0XHRcdFx0ZWwuY3NzKHNsaWRlci5hbmltUHJvcCwgcHJvcFZhbHVlKTtcblx0XHRcdFx0XHQvLyBiaW5kIGEgY2FsbGJhY2sgbWV0aG9kIC0gZXhlY3V0ZXMgd2hlbiBDU1MgdHJhbnNpdGlvbiBjb21wbGV0ZXNcblx0XHRcdFx0XHRlbC5iaW5kKCd0cmFuc2l0aW9uZW5kIHdlYmtpdFRyYW5zaXRpb25FbmQgb1RyYW5zaXRpb25FbmQgTVNUcmFuc2l0aW9uRW5kJywgZnVuY3Rpb24oKXtcblx0XHRcdFx0XHRcdC8vIHVuYmluZCB0aGUgY2FsbGJhY2tcblx0XHRcdFx0XHRcdGVsLnVuYmluZCgndHJhbnNpdGlvbmVuZCB3ZWJraXRUcmFuc2l0aW9uRW5kIG9UcmFuc2l0aW9uRW5kIE1TVHJhbnNpdGlvbkVuZCcpO1xuXHRcdFx0XHRcdFx0Ly8gcmVzZXQgdGhlIHBvc2l0aW9uXG5cdFx0XHRcdFx0XHRzZXRQb3NpdGlvblByb3BlcnR5KHBhcmFtcy5yZXNldFZhbHVlLCAncmVzZXQnLCAwKTtcblx0XHRcdFx0XHRcdC8vIHN0YXJ0IHRoZSBsb29wIGFnYWluXG5cdFx0XHRcdFx0XHR0aWNrZXJMb29wKCk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdC8vIHVzZSBKUyBhbmltYXRlXG5cdFx0XHR9ZWxzZXtcblx0XHRcdFx0dmFyIGFuaW1hdGVPYmogPSB7fTtcblx0XHRcdFx0YW5pbWF0ZU9ialtzbGlkZXIuYW5pbVByb3BdID0gdmFsdWU7XG5cdFx0XHRcdGlmKHR5cGUgPT09ICdzbGlkZScpe1xuXHRcdFx0XHRcdGVsLmFuaW1hdGUoYW5pbWF0ZU9iaiwgZHVyYXRpb24sIHNsaWRlci5zZXR0aW5ncy5lYXNpbmcsIGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0XHR1cGRhdGVBZnRlclNsaWRlVHJhbnNpdGlvbigpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9ZWxzZSBpZih0eXBlID09PSAncmVzZXQnKXtcblx0XHRcdFx0XHRlbC5jc3Moc2xpZGVyLmFuaW1Qcm9wLCB2YWx1ZSk7XG5cdFx0XHRcdH1lbHNlIGlmKHR5cGUgPT09ICd0aWNrZXInKXtcblx0XHRcdFx0XHRlbC5hbmltYXRlKGFuaW1hdGVPYmosIHNwZWVkLCAnbGluZWFyJywgZnVuY3Rpb24oKXtcblx0XHRcdFx0XHRcdHNldFBvc2l0aW9uUHJvcGVydHkocGFyYW1zLnJlc2V0VmFsdWUsICdyZXNldCcsIDApO1xuXHRcdFx0XHRcdFx0Ly8gcnVuIHRoZSByZWN1cnNpdmUgbG9vcCBhZnRlciBhbmltYXRpb25cblx0XHRcdFx0XHRcdHRpY2tlckxvb3AoKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBQb3B1bGF0ZXMgdGhlIHBhZ2VyIHdpdGggcHJvcGVyIGFtb3VudCBvZiBwYWdlc1xuXHRcdCAqL1xuXHRcdHZhciBwb3B1bGF0ZVBhZ2VyID0gZnVuY3Rpb24oKXtcblx0XHRcdHZhciBwYWdlckh0bWwgPSAnJztcblx0XHRcdHZhciBwYWdlclF0eSA9IGdldFBhZ2VyUXR5KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygncGFnZXJRdHkgPSAnKyBwYWdlclF0eSk7XG5cdFx0XHQvLyBsb29wIHRocm91Z2ggZWFjaCBwYWdlciBpdGVtXG5cdFx0XHRmb3IodmFyIGk9MDsgaSA8IHBhZ2VyUXR5OyBpKyspe1xuXHRcdFx0XHR2YXIgbGlua0NvbnRlbnQgPSAnJztcblx0XHRcdFx0Ly8gaWYgYSBidWlsZFBhZ2VyIGZ1bmN0aW9uIGlzIHN1cHBsaWVkLCB1c2UgaXQgdG8gZ2V0IHBhZ2VyIGxpbmsgdmFsdWUsIGVsc2UgdXNlIGluZGV4ICsgMVxuXHRcdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MuYnVpbGRQYWdlciAmJiAkLmlzRnVuY3Rpb24oc2xpZGVyLnNldHRpbmdzLmJ1aWxkUGFnZXIpIHx8IHNsaWRlci5zZXR0aW5ncy5wYWdlckN1c3RvbSl7XG5cdFx0XHRcdFx0bGlua0NvbnRlbnQgPSBzbGlkZXIuc2V0dGluZ3MuYnVpbGRQYWdlcihpKTtcblx0XHRcdFx0XHRzbGlkZXIucGFnZXJFbC5hZGRDbGFzcygnYngtY3VzdG9tLXBhZ2VyJyk7XG5cdFx0XHRcdH1lbHNle1xuXHRcdFx0XHRcdGxpbmtDb250ZW50ID0gaSArIDE7XG5cdFx0XHRcdFx0c2xpZGVyLnBhZ2VyRWwuYWRkQ2xhc3MoJ2J4LWRlZmF1bHQtcGFnZXInKTtcblx0XHRcdFx0fVxuXHRcdFx0XHQvLyB2YXIgbGlua0NvbnRlbnQgPSBzbGlkZXIuc2V0dGluZ3MuYnVpbGRQYWdlciAmJiAkLmlzRnVuY3Rpb24oc2xpZGVyLnNldHRpbmdzLmJ1aWxkUGFnZXIpID8gc2xpZGVyLnNldHRpbmdzLmJ1aWxkUGFnZXIoaSkgOiBpICsgMTtcblx0XHRcdFx0Ly8gYWRkIHRoZSBtYXJrdXAgdG8gdGhlIHN0cmluZ1xuXHRcdFx0XHRwYWdlckh0bWwgKz0gJzxkaXYgY2xhc3M9XCJieC1wYWdlci1pdGVtXCI+PGEgaHJlZj1cIlwiIGRhdGEtc2xpZGUtaW5kZXg9XCInICsgaSArICdcIiBjbGFzcz1cImJ4LXBhZ2VyLWxpbmtcIj4nICsgbGlua0NvbnRlbnQgKyAnPC9hPjwvZGl2Pic7XG5cdFx0XHR9XG5cdFx0XHQvLyBwb3B1bGF0ZSB0aGUgcGFnZXIgZWxlbWVudCB3aXRoIHBhZ2VyIGxpbmtzXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihwYWdlclF0eSA+IDEpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgc2xpZGVyLnBhZ2VyRWwuaHRtbChwYWdlckh0bWwpO1xuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBBcHBlbmRzIHRoZSBwYWdlciB0byB0aGUgY29udHJvbHMgZWxlbWVudFxuXHRcdCAqL1xuXHRcdHZhciBhcHBlbmRQYWdlciA9IGZ1bmN0aW9uKCl7XG5cdFx0XHRpZighc2xpZGVyLnNldHRpbmdzLnBhZ2VyQ3VzdG9tKXtcblx0XHRcdFx0Ly8gY3JlYXRlIHRoZSBwYWdlciBET00gZWxlbWVudFxuXHRcdFx0XHRzbGlkZXIucGFnZXJFbCA9ICQoJzxkaXYgY2xhc3M9XCJieC1wYWdlclwiIC8+Jyk7XG5cdFx0XHRcdC8vIGlmIGEgcGFnZXIgc2VsZWN0b3Igd2FzIHN1cHBsaWVkLCBwb3B1bGF0ZSBpdCB3aXRoIHRoZSBwYWdlclxuXHRcdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MucGFnZXJTZWxlY3Rvcil7XG5cdFx0XHRcdFx0JChzbGlkZXIuc2V0dGluZ3MucGFnZXJTZWxlY3RvcikuaHRtbChzbGlkZXIucGFnZXJFbCk7XG5cdFx0XHRcdC8vIGlmIG5vIHBhZ2VyIHNlbGVjdG9yIHdhcyBzdXBwbGllZCwgYWRkIGl0IGFmdGVyIHRoZSB3cmFwcGVyXG5cdFx0XHRcdH1lbHNle1xuXHRcdFx0XHRcdHNsaWRlci5jb250cm9scy5lbC5hZGRDbGFzcygnYngtaGFzLXBhZ2VyJykuYXBwZW5kKHNsaWRlci5wYWdlckVsKTtcblx0XHRcdFx0fVxuXHRcdFx0XHQvLyBwb3B1bGF0ZSB0aGUgcGFnZXJcblx0XHRcdFx0cG9wdWxhdGVQYWdlcigpO1xuXHRcdFx0fWVsc2V7XG5cdFx0XHRcdHNsaWRlci5wYWdlckVsID0gJChzbGlkZXIuc2V0dGluZ3MucGFnZXJDdXN0b20pO1xuXHRcdFx0fVxuXHRcdFx0Ly8gYXNzaWduIHRoZSBwYWdlciBjbGljayBiaW5kaW5nXG5cdFx0XHRzbGlkZXIucGFnZXJFbC5vbignY2xpY2sgdG91Y2hlbmQnLCAnYScsIGNsaWNrUGFnZXJCaW5kKTtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogQXBwZW5kcyBwcmV2IC8gbmV4dCBjb250cm9scyB0byB0aGUgY29udHJvbHMgZWxlbWVudFxuXHRcdCAqL1xuXHRcdHZhciBhcHBlbmRDb250cm9scyA9IGZ1bmN0aW9uKCl7XG5cdFx0XHRzbGlkZXIuY29udHJvbHMubmV4dCA9ICQoJzxhIGNsYXNzPVwiYngtbmV4dFwiIGhyZWY9XCJcIj4nICsgc2xpZGVyLnNldHRpbmdzLm5leHRUZXh0ICsgJzwvYT4nKTtcblx0XHRcdHNsaWRlci5jb250cm9scy5wcmV2ID0gJCgnPGEgY2xhc3M9XCJieC1wcmV2XCIgaHJlZj1cIlwiPicgKyBzbGlkZXIuc2V0dGluZ3MucHJldlRleHQgKyAnPC9hPicpO1xuXHRcdFx0Ly8gYmluZCBjbGljayBhY3Rpb25zIHRvIHRoZSBjb250cm9sc1xuXHRcdFx0c2xpZGVyLmNvbnRyb2xzLm5leHQuYmluZCgnY2xpY2sgdG91Y2hlbmQnLCBjbGlja05leHRCaW5kKTtcblx0XHRcdHNsaWRlci5jb250cm9scy5wcmV2LmJpbmQoJ2NsaWNrIHRvdWNoZW5kJywgY2xpY2tQcmV2QmluZCk7XG5cdFx0XHQvLyBpZiBuZXh0U2VsZWN0b3Igd2FzIHN1cHBsaWVkLCBwb3B1bGF0ZSBpdFxuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLm5leHRTZWxlY3Rvcil7XG5cdFx0XHRcdCQoc2xpZGVyLnNldHRpbmdzLm5leHRTZWxlY3RvcikuYXBwZW5kKHNsaWRlci5jb250cm9scy5uZXh0KTtcblx0XHRcdH1cblx0XHRcdC8vIGlmIHByZXZTZWxlY3RvciB3YXMgc3VwcGxpZWQsIHBvcHVsYXRlIGl0XG5cdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MucHJldlNlbGVjdG9yKXtcblx0XHRcdFx0JChzbGlkZXIuc2V0dGluZ3MucHJldlNlbGVjdG9yKS5hcHBlbmQoc2xpZGVyLmNvbnRyb2xzLnByZXYpO1xuXHRcdFx0fVxuXHRcdFx0Ly8gaWYgbm8gY3VzdG9tIHNlbGVjdG9ycyB3ZXJlIHN1cHBsaWVkXG5cdFx0XHRpZighc2xpZGVyLnNldHRpbmdzLm5leHRTZWxlY3RvciAmJiAhc2xpZGVyLnNldHRpbmdzLnByZXZTZWxlY3Rvcil7XG5cdFx0XHRcdC8vIGFkZCB0aGUgY29udHJvbHMgdG8gdGhlIERPTVxuXHRcdFx0XHRzbGlkZXIuY29udHJvbHMuZGlyZWN0aW9uRWwgPSAkKCc8ZGl2IGNsYXNzPVwiYngtY29udHJvbHMtZGlyZWN0aW9uXCIgLz4nKTtcblx0XHRcdFx0Ly8gYWRkIHRoZSBjb250cm9sIGVsZW1lbnRzIHRvIHRoZSBkaXJlY3Rpb25FbFxuXHRcdFx0XHRzbGlkZXIuY29udHJvbHMuZGlyZWN0aW9uRWwuYXBwZW5kKHNsaWRlci5jb250cm9scy5wcmV2KS5hcHBlbmQoc2xpZGVyLmNvbnRyb2xzLm5leHQpO1xuXHRcdFx0XHQvLyBzbGlkZXIudmlld3BvcnQuYXBwZW5kKHNsaWRlci5jb250cm9scy5kaXJlY3Rpb25FbCk7XG5cdFx0XHRcdHNsaWRlci5jb250cm9scy5lbC5hZGRDbGFzcygnYngtaGFzLWNvbnRyb2xzLWRpcmVjdGlvbicpLmFwcGVuZChzbGlkZXIuY29udHJvbHMuZGlyZWN0aW9uRWwpO1xuXHRcdFx0fVxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBBcHBlbmRzIHN0YXJ0IC8gc3RvcCBhdXRvIGNvbnRyb2xzIHRvIHRoZSBjb250cm9scyBlbGVtZW50XG5cdFx0ICovXG5cdFx0dmFyIGFwcGVuZENvbnRyb2xzQXV0byA9IGZ1bmN0aW9uKCl7XG5cdFx0XHRzbGlkZXIuY29udHJvbHMuc3RhcnQgPSAkKCc8ZGl2IGNsYXNzPVwiYngtY29udHJvbHMtYXV0by1pdGVtXCI+PGEgY2xhc3M9XCJieC1zdGFydFwiIGhyZWY9XCJcIj4nICsgc2xpZGVyLnNldHRpbmdzLnN0YXJ0VGV4dCArICc8L2E+PC9kaXY+Jyk7XG5cdFx0XHRzbGlkZXIuY29udHJvbHMuc3RvcCA9ICQoJzxkaXYgY2xhc3M9XCJieC1jb250cm9scy1hdXRvLWl0ZW1cIj48YSBjbGFzcz1cImJ4LXN0b3BcIiBocmVmPVwiXCI+JyArIHNsaWRlci5zZXR0aW5ncy5zdG9wVGV4dCArICc8L2E+PC9kaXY+Jyk7XG5cdFx0XHQvLyBhZGQgdGhlIGNvbnRyb2xzIHRvIHRoZSBET01cblx0XHRcdHNsaWRlci5jb250cm9scy5hdXRvRWwgPSAkKCc8ZGl2IGNsYXNzPVwiYngtY29udHJvbHMtYXV0b1wiIC8+Jyk7XG5cdFx0XHQvLyBiaW5kIGNsaWNrIGFjdGlvbnMgdG8gdGhlIGNvbnRyb2xzXG5cdFx0XHRzbGlkZXIuY29udHJvbHMuYXV0b0VsLm9uKCdjbGljaycsICcuYngtc3RhcnQnLCBjbGlja1N0YXJ0QmluZCk7XG5cdFx0XHRzbGlkZXIuY29udHJvbHMuYXV0b0VsLm9uKCdjbGljaycsICcuYngtc3RvcCcsIGNsaWNrU3RvcEJpbmQpO1xuXHRcdFx0Ly8gaWYgYXV0b0NvbnRyb2xzQ29tYmluZSwgaW5zZXJ0IG9ubHkgdGhlIFwic3RhcnRcIiBjb250cm9sXG5cdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MuYXV0b0NvbnRyb2xzQ29tYmluZSl7XG5cdFx0XHRcdHNsaWRlci5jb250cm9scy5hdXRvRWwuYXBwZW5kKHNsaWRlci5jb250cm9scy5zdGFydCk7XG5cdFx0XHQvLyBpZiBhdXRvQ29udHJvbHNDb21iaW5lIGlzIGZhbHNlLCBpbnNlcnQgYm90aCBjb250cm9sc1xuXHRcdFx0fWVsc2V7XG5cdFx0XHRcdHNsaWRlci5jb250cm9scy5hdXRvRWwuYXBwZW5kKHNsaWRlci5jb250cm9scy5zdGFydCkuYXBwZW5kKHNsaWRlci5jb250cm9scy5zdG9wKTtcblx0XHRcdH1cblx0XHRcdC8vIGlmIGF1dG8gY29udHJvbHMgc2VsZWN0b3Igd2FzIHN1cHBsaWVkLCBwb3B1bGF0ZSBpdCB3aXRoIHRoZSBjb250cm9sc1xuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLmF1dG9Db250cm9sc1NlbGVjdG9yKXtcblx0XHRcdFx0JChzbGlkZXIuc2V0dGluZ3MuYXV0b0NvbnRyb2xzU2VsZWN0b3IpLmh0bWwoc2xpZGVyLmNvbnRyb2xzLmF1dG9FbCk7XG5cdFx0XHQvLyBpZiBhdXRvIGNvbnRyb2xzIHNlbGVjdG9yIHdhcyBub3Qgc3VwcGxpZWQsIGFkZCBpdCBhZnRlciB0aGUgd3JhcHBlclxuXHRcdFx0fWVsc2V7XG5cdFx0XHRcdHNsaWRlci5jb250cm9scy5lbC5hZGRDbGFzcygnYngtaGFzLWNvbnRyb2xzLWF1dG8nKS5hcHBlbmQoc2xpZGVyLmNvbnRyb2xzLmF1dG9FbCk7XG5cdFx0XHR9XG5cdFx0XHQvLyB1cGRhdGUgdGhlIGF1dG8gY29udHJvbHNcblx0XHRcdHVwZGF0ZUF1dG9Db250cm9scyhzbGlkZXIuc2V0dGluZ3MuYXV0b1N0YXJ0ID8gJ3N0b3AnIDogJ3N0YXJ0Jyk7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIEFwcGVuZHMgaW1hZ2UgY2FwdGlvbnMgdG8gdGhlIERPTVxuXHRcdCAqL1xuXHRcdHZhciBhcHBlbmRDYXB0aW9ucyA9IGZ1bmN0aW9uKCl7XG5cdFx0XHQvLyBjeWNsZSB0aHJvdWdoIGVhY2ggY2hpbGRcblx0XHRcdHNsaWRlci5jaGlsZHJlbi5lYWNoKGZ1bmN0aW9uKGluZGV4KXtcblx0XHRcdFx0Ly8gZ2V0IHRoZSBpbWFnZSB0aXRsZSBhdHRyaWJ1dGVcblx0XHRcdFx0dmFyIHRpdGxlID0gJCh0aGlzKS5maW5kKCdpbWc6Zmlyc3QnKS5hdHRyKCd0aXRsZScpO1xuXHRcdFx0XHQvLyBhcHBlbmQgdGhlIGNhcHRpb25cblx0XHRcdFx0aWYodGl0bGUgIT09IHVuZGVmaW5lZCAmJiAoJycgKyB0aXRsZSkubGVuZ3RoKXtcblx0XHRcdFx0XHQkKHRoaXMpLmFwcGVuZCgnPGRpdiBjbGFzcz1cImJ4LWNhcHRpb25cIj48c3Bhbj4nICsgdGl0bGUgKyAnPC9zcGFuPjwvZGl2PicpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogQ2xpY2sgbmV4dCBiaW5kaW5nXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0gZSAoZXZlbnQpXG5cdFx0ICogIC0gRE9NIGV2ZW50IG9iamVjdFxuXHRcdCAqL1xuXHRcdHZhciBjbGlja05leHRCaW5kID0gZnVuY3Rpb24oZSl7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRpZiAoc2xpZGVyLmNvbnRyb2xzLmVsLmhhc0NsYXNzKCdkaXNhYmxlZCcpKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblx0XHRcdC8vIGlmIGF1dG8gc2hvdyBpcyBydW5uaW5nLCBzdG9wIGl0XG5cdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MuYXV0byl7IGVsLnN0b3BBdXRvKCk7IH1cblx0XHRcdGVsLmdvVG9OZXh0U2xpZGUoKTtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogQ2xpY2sgcHJldiBiaW5kaW5nXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0gZSAoZXZlbnQpXG5cdFx0ICogIC0gRE9NIGV2ZW50IG9iamVjdFxuXHRcdCAqL1xuXHRcdHZhciBjbGlja1ByZXZCaW5kID0gZnVuY3Rpb24oZSl7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRpZiAoc2xpZGVyLmNvbnRyb2xzLmVsLmhhc0NsYXNzKCdkaXNhYmxlZCcpKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblx0XHRcdC8vIGlmIGF1dG8gc2hvdyBpcyBydW5uaW5nLCBzdG9wIGl0XG5cdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MuYXV0byl7IGVsLnN0b3BBdXRvKCk7IH1cblx0XHRcdGVsLmdvVG9QcmV2U2xpZGUoKTtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogQ2xpY2sgc3RhcnQgYmluZGluZ1xuXHRcdCAqXG5cdFx0ICogQHBhcmFtIGUgKGV2ZW50KVxuXHRcdCAqICAtIERPTSBldmVudCBvYmplY3Rcblx0XHQgKi9cblx0XHR2YXIgY2xpY2tTdGFydEJpbmQgPSBmdW5jdGlvbihlKXtcblx0XHRcdGVsLnN0YXJ0QXV0bygpO1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBDbGljayBzdG9wIGJpbmRpbmdcblx0XHQgKlxuXHRcdCAqIEBwYXJhbSBlIChldmVudClcblx0XHQgKiAgLSBET00gZXZlbnQgb2JqZWN0XG5cdFx0ICovXG5cdFx0dmFyIGNsaWNrU3RvcEJpbmQgPSBmdW5jdGlvbihlKXtcblx0XHRcdGVsLnN0b3BBdXRvKCk7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIENsaWNrIHBhZ2VyIGJpbmRpbmdcblx0XHQgKlxuXHRcdCAqIEBwYXJhbSBlIChldmVudClcblx0XHQgKiAgLSBET00gZXZlbnQgb2JqZWN0XG5cdFx0ICovXG5cdFx0dmFyIGNsaWNrUGFnZXJCaW5kID0gZnVuY3Rpb24oZSl7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRpZiAoc2xpZGVyLmNvbnRyb2xzLmVsLmhhc0NsYXNzKCdkaXNhYmxlZCcpKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblx0XHRcdC8vIGlmIGF1dG8gc2hvdyBpcyBydW5uaW5nLCBzdG9wIGl0XG5cdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MuYXV0byl7IGVsLnN0b3BBdXRvKCk7IH1cblx0XHRcdHZhciBwYWdlckxpbmsgPSAkKGUuY3VycmVudFRhcmdldCk7XG5cdFx0XHRpZihwYWdlckxpbmsuYXR0cignZGF0YS1zbGlkZS1pbmRleCcpICE9PSB1bmRlZmluZWQpe1xuXHRcdFx0XHR2YXIgcGFnZXJJbmRleCA9IHBhcnNlSW50KHBhZ2VyTGluay5hdHRyKCdkYXRhLXNsaWRlLWluZGV4JykpO1xuXHRcdFx0XHQvLyBpZiBjbGlja2VkIHBhZ2VyIGxpbmsgaXMgbm90IGFjdGl2ZSwgY29udGludWUgd2l0aCB0aGUgZ29Ub1NsaWRlIGNhbGxcblx0XHRcdFx0aWYocGFnZXJJbmRleCAhPT0gc2xpZGVyLmFjdGl2ZS5pbmRleCl7IGVsLmdvVG9TbGlkZShwYWdlckluZGV4KTsgfVxuXHRcdFx0fVxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBVcGRhdGVzIHRoZSBwYWdlciBsaW5rcyB3aXRoIGFuIGFjdGl2ZSBjbGFzc1xuXHRcdCAqXG5cdFx0ICogQHBhcmFtIHNsaWRlSW5kZXggKGludClcblx0XHQgKiAgLSBpbmRleCBvZiBzbGlkZSB0byBtYWtlIGFjdGl2ZVxuXHRcdCAqL1xuXHRcdHZhciB1cGRhdGVQYWdlckFjdGl2ZSA9IGZ1bmN0aW9uKHNsaWRlSW5kZXgpe1xuXHRcdFx0Ly8gaWYgXCJzaG9ydFwiIHBhZ2VyIHR5cGVcblx0XHRcdHZhciBsZW4gPSBzbGlkZXIuY2hpbGRyZW4ubGVuZ3RoOyAvLyBuYiBvZiBjaGlsZHJlblxuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLnBhZ2VyVHlwZSA9PT0gJ3Nob3J0Jyl7XG5cdFx0XHRcdGlmKHNsaWRlci5zZXR0aW5ncy5tYXhTbGlkZXMgPiAxKXtcblx0XHRcdFx0XHRsZW4gPSBNYXRoLmNlaWwoc2xpZGVyLmNoaWxkcmVuLmxlbmd0aC9zbGlkZXIuc2V0dGluZ3MubWF4U2xpZGVzKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRzbGlkZXIucGFnZXJFbC5odG1sKCAoc2xpZGVJbmRleCArIDEpICsgc2xpZGVyLnNldHRpbmdzLnBhZ2VyU2hvcnRTZXBhcmF0b3IgKyBsZW4pO1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0XHQvLyByZW1vdmUgYWxsIHBhZ2VyIGFjdGl2ZSBjbGFzc2VzXG5cdFx0XHRzbGlkZXIucGFnZXJFbC5maW5kKCdhJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuXHRcdFx0Ly8gYXBwbHkgdGhlIGFjdGl2ZSBjbGFzcyBmb3IgYWxsIHBhZ2Vyc1xuXHRcdFx0c2xpZGVyLnBhZ2VyRWwuZWFjaChmdW5jdGlvbihpLCBlbCl7ICQoZWwpLmZpbmQoJ2EnKS5lcShzbGlkZUluZGV4KS5hZGRDbGFzcygnYWN0aXZlJyk7IH0pO1xuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBQZXJmb3JtcyBuZWVkZWQgYWN0aW9ucyBhZnRlciBhIHNsaWRlIHRyYW5zaXRpb25cblx0XHQgKi9cblx0XHR2YXIgdXBkYXRlQWZ0ZXJTbGlkZVRyYW5zaXRpb24gPSBmdW5jdGlvbigpe1xuXHRcdFx0Ly8gaWYgaW5maW5pdGUgbG9vcCBpcyB0cnVlXG5cdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MuaW5maW5pdGVMb29wKXtcblx0XHRcdFx0dmFyIHBvc2l0aW9uID0gJyc7XG5cdFx0XHRcdC8vIGZpcnN0IHNsaWRlXG5cdFx0XHRcdGlmKHNsaWRlci5hY3RpdmUuaW5kZXggPT09IDApe1xuXHRcdFx0XHRcdC8vIHNldCB0aGUgbmV3IHBvc2l0aW9uXG5cdFx0XHRcdFx0cG9zaXRpb24gPSBzbGlkZXIuY2hpbGRyZW4uZXEoMCkucG9zaXRpb24oKTtcblx0XHRcdFx0Ly8gY2Fyb3VzZWwsIGxhc3Qgc2xpZGVcblx0XHRcdFx0fWVsc2UgaWYoc2xpZGVyLmFjdGl2ZS5pbmRleCA9PT0gZ2V0UGFnZXJRdHkoKSAtIDEgJiYgc2xpZGVyLmNhcm91c2VsKXtcblx0XHRcdFx0XHRwb3NpdGlvbiA9IHNsaWRlci5jaGlsZHJlbi5lcSgoZ2V0UGFnZXJRdHkoKSAtIDEpICogZ2V0TW92ZUJ5KCkpLnBvc2l0aW9uKCk7XG5cdFx0XHRcdC8vIGxhc3Qgc2xpZGVcblx0XHRcdFx0fWVsc2UgaWYoc2xpZGVyLmFjdGl2ZS5pbmRleCA9PT0gc2xpZGVyLmNoaWxkcmVuLmxlbmd0aCAtIDEpe1xuXHRcdFx0XHRcdHBvc2l0aW9uID0gc2xpZGVyLmNoaWxkcmVuLmVxKHNsaWRlci5jaGlsZHJlbi5sZW5ndGggLSAxKS5wb3NpdGlvbigpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGlmKHBvc2l0aW9uKXtcblx0XHRcdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MubW9kZSA9PT0gJ2hvcml6b250YWwnKXsgc2V0UG9zaXRpb25Qcm9wZXJ0eSgtcG9zaXRpb24ubGVmdCwgJ3Jlc2V0JywgMCk7IH1cblx0XHRcdFx0XHRlbHNlIGlmKHNsaWRlci5zZXR0aW5ncy5tb2RlID09PSAndmVydGljYWwnKXsgc2V0UG9zaXRpb25Qcm9wZXJ0eSgtcG9zaXRpb24udG9wLCAncmVzZXQnLCAwKTsgfVxuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHQvLyBkZWNsYXJlIHRoYXQgdGhlIHRyYW5zaXRpb24gaXMgY29tcGxldGVcblx0XHRcdHNsaWRlci53b3JraW5nID0gZmFsc2U7XG5cdFx0XHQvLyBvblNsaWRlQWZ0ZXIgY2FsbGJhY2tcblx0XHRcdHNsaWRlci5zZXR0aW5ncy5vblNsaWRlQWZ0ZXIoc2xpZGVyLmNoaWxkcmVuLmVxKHNsaWRlci5hY3RpdmUuaW5kZXgpLCBzbGlkZXIub2xkSW5kZXgsIHNsaWRlci5hY3RpdmUuaW5kZXgpO1xuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBVcGRhdGVzIHRoZSBhdXRvIGNvbnRyb2xzIHN0YXRlIChlaXRoZXIgYWN0aXZlLCBvciBjb21iaW5lZCBzd2l0Y2gpXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0gc3RhdGUgKHN0cmluZykgXCJzdGFydFwiLCBcInN0b3BcIlxuXHRcdCAqICAtIHRoZSBuZXcgc3RhdGUgb2YgdGhlIGF1dG8gc2hvd1xuXHRcdCAqL1xuXHRcdHZhciB1cGRhdGVBdXRvQ29udHJvbHMgPSBmdW5jdGlvbihzdGF0ZSl7XG5cdFx0XHQvLyBpZiBhdXRvQ29udHJvbHNDb21iaW5lIGlzIHRydWUsIHJlcGxhY2UgdGhlIGN1cnJlbnQgY29udHJvbCB3aXRoIHRoZSBuZXcgc3RhdGVcblx0XHRcdGlmKHNsaWRlci5zZXR0aW5ncy5hdXRvQ29udHJvbHNDb21iaW5lKXtcblx0XHRcdFx0c2xpZGVyLmNvbnRyb2xzLmF1dG9FbC5odG1sKHNsaWRlci5jb250cm9sc1tzdGF0ZV0pO1xuXHRcdFx0Ly8gaWYgYXV0b0NvbnRyb2xzQ29tYmluZSBpcyBmYWxzZSwgYXBwbHkgdGhlIFwiYWN0aXZlXCIgY2xhc3MgdG8gdGhlIGFwcHJvcHJpYXRlIGNvbnRyb2xcblx0XHRcdH1lbHNle1xuXHRcdFx0XHRzbGlkZXIuY29udHJvbHMuYXV0b0VsLmZpbmQoJ2EnKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG5cdFx0XHRcdHNsaWRlci5jb250cm9scy5hdXRvRWwuZmluZCgnYTpub3QoLmJ4LScgKyBzdGF0ZSArICcpJykuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuXHRcdFx0fVxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBVcGRhdGVzIHRoZSBkaXJlY3Rpb24gY29udHJvbHMgKGNoZWNrcyBpZiBlaXRoZXIgc2hvdWxkIGJlIGhpZGRlbilcblx0XHQgKi9cblx0XHR2YXIgdXBkYXRlRGlyZWN0aW9uQ29udHJvbHMgPSBmdW5jdGlvbigpe1xuXHRcdFx0aWYoZ2V0UGFnZXJRdHkoKSA9PT0gMSl7XG5cdFx0XHRcdHNsaWRlci5jb250cm9scy5wcmV2LmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuXHRcdFx0XHRzbGlkZXIuY29udHJvbHMubmV4dC5hZGRDbGFzcygnZGlzYWJsZWQnKTtcblx0XHRcdH1lbHNlIGlmKCFzbGlkZXIuc2V0dGluZ3MuaW5maW5pdGVMb29wICYmIHNsaWRlci5zZXR0aW5ncy5oaWRlQ29udHJvbE9uRW5kKXtcblx0XHRcdFx0Ly8gaWYgZmlyc3Qgc2xpZGVcblx0XHRcdFx0aWYoc2xpZGVyLmFjdGl2ZS5pbmRleCA9PT0gMCl7XG5cdFx0XHRcdFx0c2xpZGVyLmNvbnRyb2xzLnByZXYuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdFx0XHRcdFx0c2xpZGVyLmNvbnRyb2xzLm5leHQucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdFx0XHRcdC8vIGlmIGxhc3Qgc2xpZGVcblx0XHRcdFx0fWVsc2UgaWYoc2xpZGVyLmFjdGl2ZS5pbmRleCA9PT0gZ2V0UGFnZXJRdHkoKSAtIDEpe1xuXHRcdFx0XHRcdHNsaWRlci5jb250cm9scy5uZXh0LmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuXHRcdFx0XHRcdHNsaWRlci5jb250cm9scy5wcmV2LnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpO1xuXHRcdFx0XHQvLyBpZiBhbnkgc2xpZGUgaW4gdGhlIG1pZGRsZVxuXHRcdFx0XHR9ZWxzZXtcblx0XHRcdFx0XHRzbGlkZXIuY29udHJvbHMucHJldi5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtcblx0XHRcdFx0XHRzbGlkZXIuY29udHJvbHMubmV4dC5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBJbml0aWFsaXplcyB0aGUgYXV0byBwcm9jZXNzXG5cdFx0ICovXG5cdFx0dmFyIGluaXRBdXRvID0gZnVuY3Rpb24oKXtcblx0XHRcdC8vIGlmIGF1dG9EZWxheSB3YXMgc3VwcGxpZWQsIGxhdW5jaCB0aGUgYXV0byBzaG93IHVzaW5nIGEgc2V0VGltZW91dCgpIGNhbGxcblx0XHRcdGlmKHNsaWRlci5zZXR0aW5ncy5hdXRvRGVsYXkgPiAwKXtcblx0XHRcdFx0dmFyIHRpbWVvdXQgPSBzZXRUaW1lb3V0KGVsLnN0YXJ0QXV0bywgc2xpZGVyLnNldHRpbmdzLmF1dG9EZWxheSk7XG5cdFx0XHQvLyBpZiBhdXRvRGVsYXkgd2FzIG5vdCBzdXBwbGllZCwgc3RhcnQgdGhlIGF1dG8gc2hvdyBub3JtYWxseVxuXHRcdFx0fWVsc2V7XG5cdFx0XHRcdGVsLnN0YXJ0QXV0bygpO1xuXG5cdFx0XHRcdC8vYWRkIGZvY3VzIGFuZCBibHVyIGV2ZW50cyB0byBlbnN1cmUgaXRzIHJ1bm5pbmcgaWYgdGltZW91dCBnZXRzIHBhdXNlZFxuXHRcdFx0XHQkKHdpbmRvdykuZm9jdXMoZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0ZWwuc3RhcnRBdXRvKCk7XG5cdFx0XHRcdH0pLmJsdXIoZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0ZWwuc3RvcEF1dG8oKTtcblx0XHRcdFx0fSk7XG5cdFx0XHRcdFxuXG5cdFx0XHR9XG5cdFx0XHQvLyBpZiBhdXRvSG92ZXIgaXMgcmVxdWVzdGVkXG5cdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MuYXV0b0hvdmVyKXtcblx0XHRcdFx0Ly8gb24gZWwgaG92ZXJcblx0XHRcdFx0ZWwuaG92ZXIoZnVuY3Rpb24oKXtcblx0XHRcdFx0XHQvLyBpZiB0aGUgYXV0byBzaG93IGlzIGN1cnJlbnRseSBwbGF5aW5nIChoYXMgYW4gYWN0aXZlIGludGVydmFsKVxuXHRcdFx0XHRcdGlmKHNsaWRlci5pbnRlcnZhbCl7XG5cdFx0XHRcdFx0XHQvLyBzdG9wIHRoZSBhdXRvIHNob3cgYW5kIHBhc3MgdHJ1ZSBhcmd1bWVudCB3aGljaCB3aWxsIHByZXZlbnQgY29udHJvbCB1cGRhdGVcblx0XHRcdFx0XHRcdGVsLnN0b3BBdXRvKHRydWUpO1xuXHRcdFx0XHRcdFx0Ly8gY3JlYXRlIGEgbmV3IGF1dG9QYXVzZWQgdmFsdWUgd2hpY2ggd2lsbCBiZSB1c2VkIGJ5IHRoZSByZWxhdGl2ZSBcIm1vdXNlb3V0XCIgZXZlbnRcblx0XHRcdFx0XHRcdHNsaWRlci5hdXRvUGF1c2VkID0gdHJ1ZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0sIGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0Ly8gaWYgdGhlIGF1dG9QYXVzZWQgdmFsdWUgd2FzIGNyZWF0ZWQgYmUgdGhlIHByaW9yIFwibW91c2VvdmVyXCIgZXZlbnRcblx0XHRcdFx0XHRpZihzbGlkZXIuYXV0b1BhdXNlZCl7XG5cdFx0XHRcdFx0XHQvLyBzdGFydCB0aGUgYXV0byBzaG93IGFuZCBwYXNzIHRydWUgYXJndW1lbnQgd2hpY2ggd2lsbCBwcmV2ZW50IGNvbnRyb2wgdXBkYXRlXG5cdFx0XHRcdFx0XHRlbC5zdGFydEF1dG8odHJ1ZSk7XG5cdFx0XHRcdFx0XHQvLyByZXNldCB0aGUgYXV0b1BhdXNlZCB2YWx1ZVxuXHRcdFx0XHRcdFx0c2xpZGVyLmF1dG9QYXVzZWQgPSBudWxsO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIEluaXRpYWxpemVzIHRoZSB0aWNrZXIgcHJvY2Vzc1xuXHRcdCAqL1xuXHRcdHZhciBpbml0VGlja2VyID0gZnVuY3Rpb24oKXtcblx0XHRcdHZhciBzdGFydFBvc2l0aW9uID0gMDtcblx0XHRcdC8vIGlmIGF1dG9EaXJlY3Rpb24gaXMgXCJuZXh0XCIsIGFwcGVuZCBhIGNsb25lIG9mIHRoZSBlbnRpcmUgc2xpZGVyXG5cdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MuYXV0b0RpcmVjdGlvbiA9PT0gJ25leHQnKXtcblx0XHRcdFx0ZWwuYXBwZW5kKHNsaWRlci5jaGlsZHJlbi5jbG9uZSgpLmFkZENsYXNzKCdieC1jbG9uZScpKTtcblx0XHRcdC8vIGlmIGF1dG9EaXJlY3Rpb24gaXMgXCJwcmV2XCIsIHByZXBlbmQgYSBjbG9uZSBvZiB0aGUgZW50aXJlIHNsaWRlciwgYW5kIHNldCB0aGUgbGVmdCBwb3NpdGlvblxuXHRcdFx0fWVsc2V7XG5cdFx0XHRcdGVsLnByZXBlbmQoc2xpZGVyLmNoaWxkcmVuLmNsb25lKCkuYWRkQ2xhc3MoJ2J4LWNsb25lJykpO1xuXHRcdFx0XHR2YXIgcG9zaXRpb24gPSBzbGlkZXIuY2hpbGRyZW4uZmlyc3QoKS5wb3NpdGlvbigpO1xuXHRcdFx0XHRzdGFydFBvc2l0aW9uID0gc2xpZGVyLnNldHRpbmdzLm1vZGUgPT09ICdob3Jpem9udGFsJyA/IC1wb3NpdGlvbi5sZWZ0IDogLXBvc2l0aW9uLnRvcDtcblx0XHRcdH1cblx0XHRcdHNldFBvc2l0aW9uUHJvcGVydHkoc3RhcnRQb3NpdGlvbiwgJ3Jlc2V0JywgMCk7XG5cdFx0XHQvLyBkbyBub3QgYWxsb3cgY29udHJvbHMgaW4gdGlja2VyIG1vZGVcblx0XHRcdHNsaWRlci5zZXR0aW5ncy5wYWdlciA9IGZhbHNlO1xuXHRcdFx0c2xpZGVyLnNldHRpbmdzLmNvbnRyb2xzID0gZmFsc2U7XG5cdFx0XHRzbGlkZXIuc2V0dGluZ3MuYXV0b0NvbnRyb2xzID0gZmFsc2U7XG5cdFx0XHQvLyBpZiBhdXRvSG92ZXIgaXMgcmVxdWVzdGVkXG5cdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MudGlja2VySG92ZXIpe1xuXHRcdFx0XHRpZihzbGlkZXIudXNpbmdDU1Mpe1xuXHRcdFx0XHRcdHZhciB2YWx1ZTtcblx0XHRcdFx0XHR2YXIgaWR4ID0gc2xpZGVyLnNldHRpbmdzLm1vZGUgPT0gJ2hvcml6b250YWwnID8gNCA6IDU7XG5cdFx0XHRcdFx0c2xpZGVyLnZpZXdwb3J0LmhvdmVyKGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0XHR2YXIgdHJhbnNmb3JtID0gZWwuY3NzKCctJyArIHNsaWRlci5jc3NQcmVmaXggKyAnLXRyYW5zZm9ybScpO1xuXHRcdFx0XHRcdFx0dmFsdWUgPSBwYXJzZUZsb2F0KHRyYW5zZm9ybS5zcGxpdCgnLCcpW2lkeF0pO1xuXHRcdFx0XHRcdFx0c2V0UG9zaXRpb25Qcm9wZXJ0eSh2YWx1ZSwgJ3Jlc2V0JywgMCk7XG5cdFx0XHRcdFx0fSwgZnVuY3Rpb24oKXtcblx0XHRcdFx0XHRcdHZhciB0b3RhbERpbWVucyA9IDA7XG5cdFx0XHRcdFx0XHRzbGlkZXIuY2hpbGRyZW4uZWFjaChmdW5jdGlvbihpbmRleCl7XG5cdFx0XHRcdFx0XHQgIHRvdGFsRGltZW5zICs9IHNsaWRlci5zZXR0aW5ncy5tb2RlID09ICdob3Jpem9udGFsJyA/ICQodGhpcykub3V0ZXJXaWR0aCh0cnVlKSA6ICQodGhpcykub3V0ZXJIZWlnaHQodHJ1ZSk7XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdC8vIGNhbGN1bGF0ZSB0aGUgc3BlZWQgcmF0aW8gKHVzZWQgdG8gZGV0ZXJtaW5lIHRoZSBuZXcgc3BlZWQgdG8gZmluaXNoIHRoZSBwYXVzZWQgYW5pbWF0aW9uKVxuXHRcdFx0XHRcdFx0dmFyIHJhdGlvID0gc2xpZGVyLnNldHRpbmdzLnNwZWVkIC8gdG90YWxEaW1lbnM7XG5cdFx0XHRcdFx0XHQvLyBkZXRlcm1pbmUgd2hpY2ggcHJvcGVydHkgdG8gdXNlXG5cdFx0XHRcdFx0XHR2YXIgcHJvcGVydHkgPSBzbGlkZXIuc2V0dGluZ3MubW9kZSA9PSAnaG9yaXpvbnRhbCcgPyAnbGVmdCcgOiAndG9wJztcblx0XHRcdFx0XHRcdC8vIGNhbGN1bGF0ZSB0aGUgbmV3IHNwZWVkXG5cdFx0XHRcdFx0XHR2YXIgbmV3U3BlZWQgPSByYXRpbyAqICh0b3RhbERpbWVucyAtIChNYXRoLmFicyhwYXJzZUludCh2YWx1ZSkpKSk7XG5cdFx0XHRcdFx0XHR0aWNrZXJMb29wKG5ld1NwZWVkKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHQvLyBvbiBlbCBob3ZlclxuXHRcdFx0XHRcdHNsaWRlci52aWV3cG9ydC5ob3ZlcihmdW5jdGlvbigpe1xuXHRcdFx0XHRcdFx0ZWwuc3RvcCgpO1xuXHRcdFx0XHRcdH0sIGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0XHQvLyBjYWxjdWxhdGUgdGhlIHRvdGFsIHdpZHRoIG9mIGNoaWxkcmVuICh1c2VkIHRvIGNhbGN1bGF0ZSB0aGUgc3BlZWQgcmF0aW8pXG5cdFx0XHRcdFx0XHR2YXIgdG90YWxEaW1lbnMgPSAwO1xuXHRcdFx0XHRcdFx0c2xpZGVyLmNoaWxkcmVuLmVhY2goZnVuY3Rpb24oaW5kZXgpe1xuXHRcdFx0XHRcdFx0ICB0b3RhbERpbWVucyArPSBzbGlkZXIuc2V0dGluZ3MubW9kZSA9PSAnaG9yaXpvbnRhbCcgPyAkKHRoaXMpLm91dGVyV2lkdGgodHJ1ZSkgOiAkKHRoaXMpLm91dGVySGVpZ2h0KHRydWUpO1xuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHQvLyBjYWxjdWxhdGUgdGhlIHNwZWVkIHJhdGlvICh1c2VkIHRvIGRldGVybWluZSB0aGUgbmV3IHNwZWVkIHRvIGZpbmlzaCB0aGUgcGF1c2VkIGFuaW1hdGlvbilcblx0XHRcdFx0XHRcdHZhciByYXRpbyA9IHNsaWRlci5zZXR0aW5ncy5zcGVlZCAvIHRvdGFsRGltZW5zO1xuXHRcdFx0XHRcdFx0Ly8gZGV0ZXJtaW5lIHdoaWNoIHByb3BlcnR5IHRvIHVzZVxuXHRcdFx0XHRcdFx0dmFyIHByb3BlcnR5ID0gc2xpZGVyLnNldHRpbmdzLm1vZGUgPT0gJ2hvcml6b250YWwnID8gJ2xlZnQnIDogJ3RvcCc7XG5cdFx0XHRcdFx0XHQvLyBjYWxjdWxhdGUgdGhlIG5ldyBzcGVlZFxuXHRcdFx0XHRcdFx0dmFyIG5ld1NwZWVkID0gcmF0aW8gKiAodG90YWxEaW1lbnMgLSAoTWF0aC5hYnMocGFyc2VJbnQoZWwuY3NzKHByb3BlcnR5KSkpKSk7XG5cdFx0XHRcdFx0XHR0aWNrZXJMb29wKG5ld1NwZWVkKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0Ly8gc3RhcnQgdGhlIHRpY2tlciBsb29wXG5cdFx0XHR0aWNrZXJMb29wKCk7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIFJ1bnMgYSBjb250aW51b3VzIGxvb3AsIG5ld3MgdGlja2VyLXN0eWxlXG5cdFx0ICovXG5cdFx0dmFyIHRpY2tlckxvb3AgPSBmdW5jdGlvbihyZXN1bWVTcGVlZCl7XG5cdFx0XHRzcGVlZCA9IHJlc3VtZVNwZWVkID8gcmVzdW1lU3BlZWQgOiBzbGlkZXIuc2V0dGluZ3Muc3BlZWQ7XG5cdFx0XHR2YXIgcG9zaXRpb24gPSB7bGVmdDogMCwgdG9wOiAwfTtcblx0XHRcdHZhciByZXNldCA9IHtsZWZ0OiAwLCB0b3A6IDB9O1xuXHRcdFx0Ly8gaWYgXCJuZXh0XCIgYW5pbWF0ZSBsZWZ0IHBvc2l0aW9uIHRvIGxhc3QgY2hpbGQsIHRoZW4gcmVzZXQgbGVmdCB0byAwXG5cdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MuYXV0b0RpcmVjdGlvbiA9PT0gJ25leHQnKXtcblx0XHRcdFx0cG9zaXRpb24gPSBlbC5maW5kKCcuYngtY2xvbmUnKS5maXJzdCgpLnBvc2l0aW9uKCk7XG5cdFx0XHQvLyBpZiBcInByZXZcIiBhbmltYXRlIGxlZnQgcG9zaXRpb24gdG8gMCwgdGhlbiByZXNldCBsZWZ0IHRvIGZpcnN0IG5vbi1jbG9uZSBjaGlsZFxuXHRcdFx0fWVsc2V7XG5cdFx0XHRcdHJlc2V0ID0gc2xpZGVyLmNoaWxkcmVuLmZpcnN0KCkucG9zaXRpb24oKTtcblx0XHRcdH1cblx0XHRcdHZhciBhbmltYXRlUHJvcGVydHkgPSBzbGlkZXIuc2V0dGluZ3MubW9kZSA9PT0gJ2hvcml6b250YWwnID8gLXBvc2l0aW9uLmxlZnQgOiAtcG9zaXRpb24udG9wO1xuXHRcdFx0dmFyIHJlc2V0VmFsdWUgPSBzbGlkZXIuc2V0dGluZ3MubW9kZSA9PT0gJ2hvcml6b250YWwnID8gLXJlc2V0LmxlZnQgOiAtcmVzZXQudG9wO1xuXHRcdFx0dmFyIHBhcmFtcyA9IHtyZXNldFZhbHVlOiByZXNldFZhbHVlfTtcblx0XHRcdHNldFBvc2l0aW9uUHJvcGVydHkoYW5pbWF0ZVByb3BlcnR5LCAndGlja2VyJywgc3BlZWQsIHBhcmFtcyk7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIENoZWNrIGlmIGVsIGlzIG9uIHNjcmVlblxuXHRcdCAqL1xuXHRcdHZhciBpc09uU2NyZWVuID0gZnVuY3Rpb24oZWwpe1xuXHRcdFx0dmFyIHdpbiA9ICQod2luZG93KTtcblx0XHRcdHZhciB2aWV3cG9ydCA9IHtcblx0XHRcdFx0dG9wIDogd2luLnNjcm9sbFRvcCgpLFxuXHRcdFx0XHRsZWZ0IDogd2luLnNjcm9sbExlZnQoKVxuXHRcdFx0fTtcblx0XHRcdHZpZXdwb3J0LnJpZ2h0ID0gdmlld3BvcnQubGVmdCArIHdpbi53aWR0aCgpO1xuXHRcdFx0dmlld3BvcnQuYm90dG9tID0gdmlld3BvcnQudG9wICsgd2luLmhlaWdodCgpO1xuXG5cdFx0XHR2YXIgYm91bmRzID0gZWwub2Zmc2V0KCk7XG5cdFx0XHRib3VuZHMucmlnaHQgPSBib3VuZHMubGVmdCArIGVsLm91dGVyV2lkdGgoKTtcblx0XHRcdGJvdW5kcy5ib3R0b20gPSBib3VuZHMudG9wICsgZWwub3V0ZXJIZWlnaHQoKTtcblxuXHRcdFx0cmV0dXJuICghKHZpZXdwb3J0LnJpZ2h0IDwgYm91bmRzLmxlZnQgfHwgdmlld3BvcnQubGVmdCA+IGJvdW5kcy5yaWdodCB8fCB2aWV3cG9ydC5ib3R0b20gPCBib3VuZHMudG9wIHx8IHZpZXdwb3J0LnRvcCA+IGJvdW5kcy5ib3R0b20pKTtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogSW5pdGlhbGl6ZXMga2V5Ym9hcmQgZXZlbnRzXG5cdFx0ICovXG5cdFx0dmFyIGtleVByZXNzID0gZnVuY3Rpb24oZSl7XG5cdFx0XHR2YXIgYWN0aXZlRWxlbWVudFRhZyA9IGRvY3VtZW50LmFjdGl2ZUVsZW1lbnQudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0dmFyIHRhZ0ZpbHRlcnM9J2lucHV0fHRleHRhcmVhJztcblx0XHRcdHZhciBwID0gbmV3IFJlZ0V4cChhY3RpdmVFbGVtZW50VGFnLFtcImlcIl0pO1xuXHRcdFx0dmFyIHJlc3VsdCA9IHAuZXhlYyh0YWdGaWx0ZXJzKTtcblx0XHRcdGlmIChyZXN1bHQgPT0gbnVsbCAmJiBpc09uU2NyZWVuKGVsKSkge1xuXHRcdFx0XHRpZiAoZS5rZXlDb2RlID09IDM5KSB7XG5cdFx0XHRcdFx0Y2xpY2tOZXh0QmluZChlKTtcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdFx0ZWxzZSBpZiAoZS5rZXlDb2RlID09IDM3KSB7XG5cdFx0XHRcdFx0Y2xpY2tQcmV2QmluZChlKTtcblx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogSW5pdGlhbGl6ZXMgdG91Y2ggZXZlbnRzXG5cdFx0ICovXG5cdFx0dmFyIGluaXRUb3VjaCA9IGZ1bmN0aW9uKCl7XG5cdFx0XHQvLyBpbml0aWFsaXplIG9iamVjdCB0byBjb250YWluIGFsbCB0b3VjaCB2YWx1ZXNcblx0XHRcdHNsaWRlci50b3VjaCA9IHtcblx0XHRcdFx0c3RhcnQ6IHt4OiAwLCB5OiAwfSxcblx0XHRcdFx0ZW5kOiB7eDogMCwgeTogMH1cblx0XHRcdH07XG5cdFx0XHRzbGlkZXIudmlld3BvcnQuYmluZCgndG91Y2hzdGFydCBNU1BvaW50ZXJEb3duIHBvaW50ZXJkb3duJywgb25Ub3VjaFN0YXJ0KTtcblx0XHRcdFxuXHRcdFx0Ly9mb3IgYnJvd3NlcnMgdGhhdCBoYXZlIGltcGxlbWVudGVkIHBvaW50ZXIgZXZlbnRzIGFuZCBmaXJlIGEgY2xpY2sgYWZ0ZXJcblx0XHRcdC8vZXZlcnkgcG9pbnRlcnVwIHJlZ2FyZGxlc3Mgb2Ygd2hldGhlciBwb2ludGVydXAgaXMgb24gc2FtZSBzY3JlZW4gbG9jYXRpb24gYXMgcG9pbnRlcmRvd24gb3Igbm90XG5cdFx0XHRzbGlkZXIudmlld3BvcnQub24oJ2NsaWNrJywgJy5ieHNsaWRlciBhJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRpZiAoc2xpZGVyLnZpZXdwb3J0Lmhhc0NsYXNzKCdjbGljay1kaXNhYmxlZCcpKSB7XG5cdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdHNsaWRlci52aWV3cG9ydC5yZW1vdmVDbGFzcygnY2xpY2stZGlzYWJsZWQnKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIEV2ZW50IGhhbmRsZXIgZm9yIFwidG91Y2hzdGFydFwiXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0gZSAoZXZlbnQpXG5cdFx0ICogIC0gRE9NIGV2ZW50IG9iamVjdFxuXHRcdCAqL1xuXHRcdHZhciBvblRvdWNoU3RhcnQgPSBmdW5jdGlvbihlKXtcblx0XHRcdC8vZGlzYWJsZSBzbGlkZXIgY29udHJvbHMgd2hpbGUgdXNlciBpcyBpbnRlcmFjdGluZyB3aXRoIHNsaWRlcyB0byBhdm9pZCBzbGlkZXIgZnJlZXplIHRoYXQgaGFwcGVucyBvbiB0b3VjaCBkZXZpY2VzIHdoZW4gYSBzbGlkZSBzd2lwZSBoYXBwZW5zIGltbWVkaWF0ZWx5IGFmdGVyIGludGVyYWN0aW5nIHdpdGggc2xpZGVyIGNvbnRyb2xzXG5cdFx0XHRzbGlkZXIuY29udHJvbHMuZWwuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cblx0XHRcdGlmKHNsaWRlci53b3JraW5nKXtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRzbGlkZXIuY29udHJvbHMuZWwucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdFx0XHR9ZWxzZXtcblx0XHRcdFx0Ly8gcmVjb3JkIHRoZSBvcmlnaW5hbCBwb3NpdGlvbiB3aGVuIHRvdWNoIHN0YXJ0c1xuXHRcdFx0XHRzbGlkZXIudG91Y2gub3JpZ2luYWxQb3MgPSBlbC5wb3NpdGlvbigpO1xuXHRcdFx0XHR2YXIgb3JpZyA9IGUub3JpZ2luYWxFdmVudDtcblx0XHRcdFx0dmFyIHRvdWNoUG9pbnRzID0gKHR5cGVvZiBvcmlnLmNoYW5nZWRUb3VjaGVzICE9ICd1bmRlZmluZWQnKSA/IG9yaWcuY2hhbmdlZFRvdWNoZXMgOiBbb3JpZ107XG5cdFx0XHRcdC8vIHJlY29yZCB0aGUgc3RhcnRpbmcgdG91Y2ggeCwgeSBjb29yZGluYXRlc1xuXHRcdFx0XHRzbGlkZXIudG91Y2guc3RhcnQueCA9IHRvdWNoUG9pbnRzWzBdLnBhZ2VYO1xuXHRcdFx0XHRzbGlkZXIudG91Y2guc3RhcnQueSA9IHRvdWNoUG9pbnRzWzBdLnBhZ2VZO1xuXG5cdFx0XHRcdGlmIChzbGlkZXIudmlld3BvcnQuZ2V0KDApLnNldFBvaW50ZXJDYXB0dXJlKSB7XG5cdFx0XHRcdFx0c2xpZGVyLnBvaW50ZXJJZCA9IG9yaWcucG9pbnRlcklkO1xuXHRcdFx0XHRcdHNsaWRlci52aWV3cG9ydC5nZXQoMCkuc2V0UG9pbnRlckNhcHR1cmUoc2xpZGVyLnBvaW50ZXJJZCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0Ly8gYmluZCBhIFwidG91Y2htb3ZlXCIgZXZlbnQgdG8gdGhlIHZpZXdwb3J0XG5cdFx0XHRcdHNsaWRlci52aWV3cG9ydC5iaW5kKCd0b3VjaG1vdmUgTVNQb2ludGVyTW92ZSBwb2ludGVybW92ZScsIG9uVG91Y2hNb3ZlKTtcblx0XHRcdFx0Ly8gYmluZCBhIFwidG91Y2hlbmRcIiBldmVudCB0byB0aGUgdmlld3BvcnRcblx0XHRcdFx0c2xpZGVyLnZpZXdwb3J0LmJpbmQoJ3RvdWNoZW5kIE1TUG9pbnRlclVwIHBvaW50ZXJ1cCcsIG9uVG91Y2hFbmQpO1xuXHRcdFx0XHRzbGlkZXIudmlld3BvcnQuYmluZCgnTVNQb2ludGVyQ2FuY2VsIHBvaW50ZXJjYW5jZWwnLCBvblBvaW50ZXJDYW5jZWwpO1xuXHRcdFx0fVxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBDYW5jZWwgUG9pbnRlciBmb3IgV2luZG93cyBQaG9uZVxuXHRcdCAqXG5cdFx0ICogQHBhcmFtIGUgKGV2ZW50KVxuXHRcdCAqICAtIERPTSBldmVudCBvYmplY3Rcblx0XHQgKi9cblx0XHR2YXIgb25Qb2ludGVyQ2FuY2VsID0gZnVuY3Rpb24oZSkge1xuXHRcdC8qIG9uUG9pbnRlckNhbmNlbCBoYW5kbGVyIGlzIG5lZWRlZCB0byBkZWFsIHdpdGggc2l0dWF0aW9ucyB3aGVuIGEgdG91Y2hlbmRcblx0XHRkb2Vzbid0IGZpcmUgYWZ0ZXIgYSB0b3VjaHN0YXJ0ICh0aGlzIGhhcHBlbnMgb24gd2luZG93cyBwaG9uZXMgb25seSkgKi9cblx0XHRcdHNldFBvc2l0aW9uUHJvcGVydHkoc2xpZGVyLnRvdWNoLm9yaWdpbmFsUG9zLmxlZnQsICdyZXNldCcsIDApO1xuXG5cdFx0XHQvL3JlbW92ZSBoYW5kbGVyc1xuXHRcdFx0c2xpZGVyLmNvbnRyb2xzLmVsLnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpO1xuXHRcdFx0c2xpZGVyLnZpZXdwb3J0LnVuYmluZCgnTVNQb2ludGVyQ2FuY2VsIHBvaW50ZXJjYW5jZWwnLCBvblBvaW50ZXJDYW5jZWwpO1xuXHRcdFx0c2xpZGVyLnZpZXdwb3J0LnVuYmluZCgndG91Y2htb3ZlIE1TUG9pbnRlck1vdmUgcG9pbnRlcm1vdmUnLCBvblRvdWNoTW92ZSk7XG5cdFx0XHRzbGlkZXIudmlld3BvcnQudW5iaW5kKCd0b3VjaGVuZCBNU1BvaW50ZXJVcCBwb2ludGVydXAnLCBvblRvdWNoRW5kKTtcblx0XHRcdGlmIChzbGlkZXIudmlld3BvcnQuZ2V0KDApLnJlbGVhc2VQb2ludGVyQ2FwdHVyZSkge1xuXHRcdFx0XHRzbGlkZXIudmlld3BvcnQuZ2V0KDApLnJlbGVhc2VQb2ludGVyQ2FwdHVyZShzbGlkZXIucG9pbnRlcklkKTtcbiBcdFx0XHR9XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogRXZlbnQgaGFuZGxlciBmb3IgXCJ0b3VjaG1vdmVcIlxuXHRcdCAqXG5cdFx0ICogQHBhcmFtIGUgKGV2ZW50KVxuXHRcdCAqICAtIERPTSBldmVudCBvYmplY3Rcblx0XHQgKi9cblx0XHR2YXIgb25Ub3VjaE1vdmUgPSBmdW5jdGlvbihlKXtcblx0XHRcdHZhciBvcmlnID0gZS5vcmlnaW5hbEV2ZW50O1xuXHRcdFx0dmFyIHRvdWNoUG9pbnRzID0gKHR5cGVvZiBvcmlnLmNoYW5nZWRUb3VjaGVzICE9ICd1bmRlZmluZWQnKSA/IG9yaWcuY2hhbmdlZFRvdWNoZXMgOiBbb3JpZ107XG5cdFx0XHQvLyBpZiBzY3JvbGxpbmcgb24geSBheGlzLCBkbyBub3QgcHJldmVudCBkZWZhdWx0XG5cdFx0XHR2YXIgeE1vdmVtZW50ID0gTWF0aC5hYnModG91Y2hQb2ludHNbMF0ucGFnZVggLSBzbGlkZXIudG91Y2guc3RhcnQueCk7XG5cdFx0XHR2YXIgeU1vdmVtZW50ID0gTWF0aC5hYnModG91Y2hQb2ludHNbMF0ucGFnZVkgLSBzbGlkZXIudG91Y2guc3RhcnQueSk7XG5cdFx0XHQvLyB4IGF4aXMgc3dpcGVcblx0XHRcdGlmKCh4TW92ZW1lbnQgKiAzKSA+IHlNb3ZlbWVudCAmJiBzbGlkZXIuc2V0dGluZ3MucHJldmVudERlZmF1bHRTd2lwZVgpe1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHQvLyB5IGF4aXMgc3dpcGVcblx0XHRcdH1lbHNlIGlmKCh5TW92ZW1lbnQgKiAzKSA+IHhNb3ZlbWVudCAmJiBzbGlkZXIuc2V0dGluZ3MucHJldmVudERlZmF1bHRTd2lwZVkpe1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHR9XG5cdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MubW9kZSAhPT0gJ2ZhZGUnICYmIHNsaWRlci5zZXR0aW5ncy5vbmVUb09uZVRvdWNoKXtcblx0XHRcdFx0dmFyIHZhbHVlID0gMCwgY2hhbmdlID0gMDtcblx0XHRcdFx0Ly8gaWYgaG9yaXpvbnRhbCwgZHJhZyBhbG9uZyB4IGF4aXNcblx0XHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLm1vZGUgPT09ICdob3Jpem9udGFsJyl7XG5cdFx0XHRcdFx0Y2hhbmdlID0gdG91Y2hQb2ludHNbMF0ucGFnZVggLSBzbGlkZXIudG91Y2guc3RhcnQueDtcblx0XHRcdFx0XHR2YWx1ZSA9IHNsaWRlci50b3VjaC5vcmlnaW5hbFBvcy5sZWZ0ICsgY2hhbmdlO1xuXHRcdFx0XHQvLyBpZiB2ZXJ0aWNhbCwgZHJhZyBhbG9uZyB5IGF4aXNcblx0XHRcdFx0fWVsc2V7XG5cdFx0XHRcdFx0Y2hhbmdlID0gdG91Y2hQb2ludHNbMF0ucGFnZVkgLSBzbGlkZXIudG91Y2guc3RhcnQueTtcblx0XHRcdFx0XHR2YWx1ZSA9IHNsaWRlci50b3VjaC5vcmlnaW5hbFBvcy50b3AgKyBjaGFuZ2U7XG5cdFx0XHRcdH1cblx0XHRcdFx0c2V0UG9zaXRpb25Qcm9wZXJ0eSh2YWx1ZSwgJ3Jlc2V0JywgMCk7XG5cdFx0XHR9XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIEV2ZW50IGhhbmRsZXIgZm9yIFwidG91Y2hlbmRcIlxuXHRcdCAqXG5cdFx0ICogQHBhcmFtIGUgKGV2ZW50KVxuXHRcdCAqICAtIERPTSBldmVudCBvYmplY3Rcblx0XHQgKi9cblx0XHR2YXIgb25Ub3VjaEVuZCA9IGZ1bmN0aW9uKGUpe1xuXHRcdFx0c2xpZGVyLnZpZXdwb3J0LnVuYmluZCgndG91Y2htb3ZlIE1TUG9pbnRlck1vdmUgcG9pbnRlcm1vdmUnLCBvblRvdWNoTW92ZSk7XG5cdFx0XHQvL2VuYWJsZSBzbGlkZXIgY29udHJvbHMgYXMgc29vbiBhcyB1c2VyIHN0b3BzIGludGVyYWNpbmcgd2l0aCBzbGlkZXNcblx0XHRcdHNsaWRlci5jb250cm9scy5lbC5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtcblx0XHRcdHZhciBvcmlnID0gZS5vcmlnaW5hbEV2ZW50O1xuXHRcdFx0dmFyIHRvdWNoUG9pbnRzID0gKHR5cGVvZiBvcmlnLmNoYW5nZWRUb3VjaGVzICE9ICd1bmRlZmluZWQnKSA/IG9yaWcuY2hhbmdlZFRvdWNoZXMgOiBbb3JpZ107XG5cdFx0XHR2YXIgdmFsdWUgPSAwO1xuXHRcdFx0dmFyIGRpc3RhbmNlID0gMDtcblx0XHRcdC8vIHJlY29yZCBlbmQgeCwgeSBwb3NpdGlvbnNcblx0XHRcdHNsaWRlci50b3VjaC5lbmQueCA9IHRvdWNoUG9pbnRzWzBdLnBhZ2VYO1xuXHRcdFx0c2xpZGVyLnRvdWNoLmVuZC55ID0gdG91Y2hQb2ludHNbMF0ucGFnZVk7XG5cdFx0XHQvLyBpZiBmYWRlIG1vZGUsIGNoZWNrIGlmIGFic29sdXRlIHggZGlzdGFuY2UgY2xlYXJzIHRoZSB0aHJlc2hvbGRcblx0XHRcdGlmKHNsaWRlci5zZXR0aW5ncy5tb2RlID09PSAnZmFkZScpe1xuXHRcdFx0XHRkaXN0YW5jZSA9IE1hdGguYWJzKHNsaWRlci50b3VjaC5zdGFydC54IC0gc2xpZGVyLnRvdWNoLmVuZC54KTtcblx0XHRcdFx0aWYoZGlzdGFuY2UgPj0gc2xpZGVyLnNldHRpbmdzLnN3aXBlVGhyZXNob2xkKXtcblx0XHRcdFx0XHRpZihzbGlkZXIudG91Y2guc3RhcnQueCA+IHNsaWRlci50b3VjaC5lbmQueCl7XG5cdFx0XHRcdFx0XHRlbC5nb1RvTmV4dFNsaWRlKCk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdGVsLmdvVG9QcmV2U2xpZGUoKTtcblx0XHRcdFx0XHR9IFxuXHRcdFx0XHRcdGVsLnN0b3BBdXRvKCk7XG5cdFx0XHRcdH1cblx0XHRcdC8vIG5vdCBmYWRlIG1vZGVcblx0XHRcdH1lbHNle1xuXHRcdFx0XHQvLyBjYWxjdWxhdGUgZGlzdGFuY2UgYW5kIGVsJ3MgYW5pbWF0ZSBwcm9wZXJ0eVxuXHRcdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MubW9kZSA9PT0gJ2hvcml6b250YWwnKXtcblx0XHRcdFx0XHRkaXN0YW5jZSA9IHNsaWRlci50b3VjaC5lbmQueCAtIHNsaWRlci50b3VjaC5zdGFydC54O1xuXHRcdFx0XHRcdHZhbHVlID0gc2xpZGVyLnRvdWNoLm9yaWdpbmFsUG9zLmxlZnQ7XG5cdFx0XHRcdH1lbHNle1xuXHRcdFx0XHRcdGRpc3RhbmNlID0gc2xpZGVyLnRvdWNoLmVuZC55IC0gc2xpZGVyLnRvdWNoLnN0YXJ0Lnk7XG5cdFx0XHRcdFx0dmFsdWUgPSBzbGlkZXIudG91Y2gub3JpZ2luYWxQb3MudG9wO1xuXHRcdFx0XHR9XG5cdFx0XHRcdC8vIGlmIG5vdCBpbmZpbml0ZSBsb29wIGFuZCBmaXJzdCAvIGxhc3Qgc2xpZGUsIGRvIG5vdCBhdHRlbXB0IGEgc2xpZGUgdHJhbnNpdGlvblxuXHRcdFx0XHRpZighc2xpZGVyLnNldHRpbmdzLmluZmluaXRlTG9vcCAmJiAoKHNsaWRlci5hY3RpdmUuaW5kZXggPT09IDAgJiYgZGlzdGFuY2UgPiAwKSB8fCAoc2xpZGVyLmFjdGl2ZS5sYXN0ICYmIGRpc3RhbmNlIDwgMCkpKXtcblx0XHRcdFx0XHRzZXRQb3NpdGlvblByb3BlcnR5KHZhbHVlLCAncmVzZXQnLCAyMDApO1xuXHRcdFx0XHR9ZWxzZXtcblx0XHRcdFx0XHQvLyBjaGVjayBpZiBkaXN0YW5jZSBjbGVhcnMgdGhyZXNob2xkXG5cdFx0XHRcdFx0aWYoTWF0aC5hYnMoZGlzdGFuY2UpID49IHNsaWRlci5zZXR0aW5ncy5zd2lwZVRocmVzaG9sZCl7XG5cdFx0XHRcdFx0XHRpZihkaXN0YW5jZSA8IDApe1xuXHRcdFx0XHRcdFx0XHRlbC5nb1RvTmV4dFNsaWRlKCk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHRlbC5nb1RvUHJldlNsaWRlKCk7XG5cdFx0XHRcdFx0XHR9IFxuXHRcdFx0XHRcdFx0ZWwuc3RvcEF1dG8oKTtcblx0XHRcdFx0XHR9ZWxzZXtcblx0XHRcdFx0XHRcdC8vIGVsLmFuaW1hdGUocHJvcGVydHksIDIwMCk7XG5cdFx0XHRcdFx0XHRzZXRQb3NpdGlvblByb3BlcnR5KHZhbHVlLCAncmVzZXQnLCAyMDApO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0c2xpZGVyLnZpZXdwb3J0LnVuYmluZCgndG91Y2hlbmQgTVNQb2ludGVyVXAgcG9pbnRlcnVwJywgb25Ub3VjaEVuZCk7XG5cdFx0XHRpZiAoc2xpZGVyLnZpZXdwb3J0LmdldCgwKS5yZWxlYXNlUG9pbnRlckNhcHR1cmUpIHtcblx0XHRcdFx0c2xpZGVyLnZpZXdwb3J0LmdldCgwKS5yZWxlYXNlUG9pbnRlckNhcHR1cmUoc2xpZGVyLnBvaW50ZXJJZCk7XG5cdFx0XHR9XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIFdpbmRvdyByZXNpemUgZXZlbnQgY2FsbGJhY2tcblx0XHQgKi9cblx0XHR2YXIgcmVzaXplV2luZG93ID0gZnVuY3Rpb24oZSl7XG5cdFx0XHQvLyBkb24ndCBkbyBhbnl0aGluZyBpZiBzbGlkZXIgaXNuJ3QgaW5pdGlhbGl6ZWQuXG5cdFx0XHRpZighc2xpZGVyLmluaXRpYWxpemVkKXsgcmV0dXJuOyB9XG5cdFx0XHQvLyBEZWxheSBpZiBzbGlkZXIgd29ya2luZy5cblx0XHRcdGlmIChzbGlkZXIud29ya2luZykge1xuXHRcdFx0XHR3aW5kb3cuc2V0VGltZW91dChyZXNpemVXaW5kb3csIDEwKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdC8vIGdldCB0aGUgbmV3IHdpbmRvdyBkaW1lbnMgKGFnYWluLCB0aGFuayB5b3UgSUUpXG5cdFx0XHRcdHZhciB3aW5kb3dXaWR0aE5ldyA9ICQod2luZG93KS53aWR0aCgpO1xuXHRcdFx0XHR2YXIgd2luZG93SGVpZ2h0TmV3ID0gJCh3aW5kb3cpLmhlaWdodCgpO1xuXHRcdFx0XHQvLyBtYWtlIHN1cmUgdGhhdCBpdCBpcyBhIHRydWUgd2luZG93IHJlc2l6ZVxuXHRcdFx0XHQvLyAqd2UgbXVzdCBjaGVjayB0aGlzIGJlY2F1c2Ugb3VyIGRpbm9zYXVyIGZyaWVuZCBJRSBmaXJlcyBhIHdpbmRvdyByZXNpemUgZXZlbnQgd2hlbiBjZXJ0YWluIERPTSBlbGVtZW50c1xuXHRcdFx0XHQvLyBhcmUgcmVzaXplZC4gQ2FuIHlvdSBqdXN0IGRpZSBhbHJlYWR5Pypcblx0XHRcdFx0aWYod2luZG93V2lkdGggIT09IHdpbmRvd1dpZHRoTmV3IHx8IHdpbmRvd0hlaWdodCAhPT0gd2luZG93SGVpZ2h0TmV3KXtcblx0XHRcdFx0XHQvLyBzZXQgdGhlIG5ldyB3aW5kb3cgZGltZW5zXG5cdFx0XHRcdFx0d2luZG93V2lkdGggPSB3aW5kb3dXaWR0aE5ldztcblx0XHRcdFx0XHR3aW5kb3dIZWlnaHQgPSB3aW5kb3dIZWlnaHROZXc7XG5cdFx0XHRcdFx0Ly8gdXBkYXRlIGFsbCBkeW5hbWljIGVsZW1lbnRzXG5cdFx0XHRcdFx0ZWwucmVkcmF3U2xpZGVyKCk7XG5cdFx0XHRcdFx0Ly8gQ2FsbCB1c2VyIHJlc2l6ZSBoYW5kbGVyXG5cdFx0XHRcdFx0c2xpZGVyLnNldHRpbmdzLm9uU2xpZGVyUmVzaXplLmNhbGwoZWwsIHNsaWRlci5hY3RpdmUuaW5kZXgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cdFx0ICogPSBQVUJMSUMgRlVOQ1RJT05TXG5cdFx0ICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblx0XHQgKi9cblxuXHRcdC8qKlxuXHRcdCAqIFBlcmZvcm1zIHNsaWRlIHRyYW5zaXRpb24gdG8gdGhlIHNwZWNpZmllZCBzbGlkZVxuXHRcdCAqXG5cdFx0ICogQHBhcmFtIHNsaWRlSW5kZXggKGludClcblx0XHQgKiAgLSB0aGUgZGVzdGluYXRpb24gc2xpZGUncyBpbmRleCAoemVyby1iYXNlZClcblx0XHQgKlxuXHRcdCAqIEBwYXJhbSBkaXJlY3Rpb24gKHN0cmluZylcblx0XHQgKiAgLSBJTlRFUk5BTCBVU0UgT05MWSAtIHRoZSBkaXJlY3Rpb24gb2YgdHJhdmVsIChcInByZXZcIiAvIFwibmV4dFwiKVxuXHRcdCAqL1xuXHRcdGVsLmdvVG9TbGlkZSA9IGZ1bmN0aW9uKHNsaWRlSW5kZXgsIGRpcmVjdGlvbil7XG5cdFx0XHQvLyBpZiBwbHVnaW4gaXMgY3VycmVudGx5IGluIG1vdGlvbiwgaWdub3JlIHJlcXVlc3Rcblx0XHRcdGlmKHNsaWRlci53b3JraW5nIHx8IHNsaWRlci5hY3RpdmUuaW5kZXggPT09IHNsaWRlSW5kZXgpeyByZXR1cm47IH1cblx0XHRcdC8vIGRlY2xhcmUgdGhhdCBwbHVnaW4gaXMgaW4gbW90aW9uXG5cdFx0XHRzbGlkZXIud29ya2luZyA9IHRydWU7XG5cdFx0XHQvLyBzdG9yZSB0aGUgb2xkIGluZGV4XG5cdFx0XHRzbGlkZXIub2xkSW5kZXggPSBzbGlkZXIuYWN0aXZlLmluZGV4O1xuXHRcdFx0Ly8gaWYgc2xpZGVJbmRleCBpcyBsZXNzIHRoYW4gemVybywgc2V0IGFjdGl2ZSBpbmRleCB0byBsYXN0IGNoaWxkICh0aGlzIGhhcHBlbnMgZHVyaW5nIGluZmluaXRlIGxvb3ApXG5cdFx0XHRpZihzbGlkZUluZGV4IDwgMCl7XG5cdFx0XHRcdHNsaWRlci5hY3RpdmUuaW5kZXggPSBnZXRQYWdlclF0eSgpIC0gMTtcblx0XHRcdC8vIGlmIHNsaWRlSW5kZXggaXMgZ3JlYXRlciB0aGFuIGNoaWxkcmVuIGxlbmd0aCwgc2V0IGFjdGl2ZSBpbmRleCB0byAwICh0aGlzIGhhcHBlbnMgZHVyaW5nIGluZmluaXRlIGxvb3ApXG5cdFx0XHR9ZWxzZSBpZihzbGlkZUluZGV4ID49IGdldFBhZ2VyUXR5KCkpe1xuXHRcdFx0XHRzbGlkZXIuYWN0aXZlLmluZGV4ID0gMDtcblx0XHRcdC8vIHNldCBhY3RpdmUgaW5kZXggdG8gcmVxdWVzdGVkIHNsaWRlXG5cdFx0XHR9ZWxzZXtcblx0XHRcdFx0c2xpZGVyLmFjdGl2ZS5pbmRleCA9IHNsaWRlSW5kZXg7XG5cdFx0XHR9XG5cdFx0XHQvLyBvblNsaWRlQmVmb3JlLCBvblNsaWRlTmV4dCwgb25TbGlkZVByZXYgY2FsbGJhY2tzXG5cdFx0XHQvLyBBbGxvdyB0cmFuc2l0aW9uIGNhbmNlbGluZyBiYXNlZCBvbiByZXR1cm5lZCB2YWx1ZVxuXHRcdFx0dmFyIHBlcmZvcm1UcmFuc2l0aW9uID0gdHJ1ZTtcblxuXHRcdFx0cGVyZm9ybVRyYW5zaXRpb24gPSBzbGlkZXIuc2V0dGluZ3Mub25TbGlkZUJlZm9yZShzbGlkZXIuY2hpbGRyZW4uZXEoc2xpZGVyLmFjdGl2ZS5pbmRleCksIHNsaWRlci5vbGRJbmRleCwgc2xpZGVyLmFjdGl2ZS5pbmRleCk7XG5cdFx0XHRcblx0XHRcdGlmICggdHlwZW9mKHBlcmZvcm1UcmFuc2l0aW9uKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiAhcGVyZm9ybVRyYW5zaXRpb24gKSB7XG5cdFx0XHRcdHNsaWRlci5hY3RpdmUuaW5kZXggPSBzbGlkZXIub2xkSW5kZXg7IC8vIHJlc3RvcmUgb2xkIGluZGV4XG5cdFx0XHRcdHNsaWRlci53b3JraW5nID0gZmFsc2U7IC8vIGlzIG5vdCBpbiBtb3Rpb25cblx0XHRcdFx0cmV0dXJuO1x0XG5cdFx0XHR9XG5cdFx0XHRpZihkaXJlY3Rpb24gPT09ICduZXh0Jyl7XG5cdFx0XHRcdC8vIFByZXZlbnQgY2FuY2VsaW5nIGluIGZ1dHVyZSBmdW5jdGlvbnMgb3IgbGFjayB0aGVyZS1vZiBmcm9tIG5lZ2F0aW5nIHByZXZpb3VzIGNvbW1hbmRzIHRvIGNhbmNlbFxuXHRcdFx0XHRpZighc2xpZGVyLnNldHRpbmdzLm9uU2xpZGVOZXh0KHNsaWRlci5jaGlsZHJlbi5lcShzbGlkZXIuYWN0aXZlLmluZGV4KSwgc2xpZGVyLm9sZEluZGV4LCBzbGlkZXIuYWN0aXZlLmluZGV4KSl7XG5cdFx0XHRcdFx0cGVyZm9ybVRyYW5zaXRpb24gPSBmYWxzZTtcblx0XHRcdFx0fVxuXHRcdFx0fWVsc2UgaWYoZGlyZWN0aW9uID09PSAncHJldicpe1xuXHRcdFx0XHQvLyBQcmV2ZW50IGNhbmNlbGluZyBpbiBmdXR1cmUgZnVuY3Rpb25zIG9yIGxhY2sgdGhlcmUtb2YgZnJvbSBuZWdhdGluZyBwcmV2aW91cyBjb21tYW5kcyB0byBjYW5jZWxcblx0XHRcdFx0aWYoIXNsaWRlci5zZXR0aW5ncy5vblNsaWRlUHJldihzbGlkZXIuY2hpbGRyZW4uZXEoc2xpZGVyLmFjdGl2ZS5pbmRleCksIHNsaWRlci5vbGRJbmRleCwgc2xpZGVyLmFjdGl2ZS5pbmRleCkpe1xuXHRcdFx0XHRcdHBlcmZvcm1UcmFuc2l0aW9uID0gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly8gSWYgdHJhbnNpdGlvbnMgY2FuY2VsZWQsIHJlc2V0IGFuZCByZXR1cm5cblx0XHRcdGlmICggdHlwZW9mKHBlcmZvcm1UcmFuc2l0aW9uKSAhPT0gXCJ1bmRlZmluZWRcIiAmJiAhcGVyZm9ybVRyYW5zaXRpb24gKSB7XG5cdFx0XHRcdHNsaWRlci5hY3RpdmUuaW5kZXggPSBzbGlkZXIub2xkSW5kZXg7IC8vIHJlc3RvcmUgb2xkIGluZGV4XG5cdFx0XHRcdHNsaWRlci53b3JraW5nID0gZmFsc2U7IC8vIGlzIG5vdCBpbiBtb3Rpb25cblx0XHRcdFx0cmV0dXJuO1x0XG5cdFx0XHR9XG5cblx0XHRcdC8vIGNoZWNrIGlmIGxhc3Qgc2xpZGVcblx0XHRcdHNsaWRlci5hY3RpdmUubGFzdCA9IHNsaWRlci5hY3RpdmUuaW5kZXggPj0gZ2V0UGFnZXJRdHkoKSAtIDE7XG5cdFx0XHQvLyB1cGRhdGUgdGhlIHBhZ2VyIHdpdGggYWN0aXZlIGNsYXNzXG5cdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MucGFnZXIgfHwgc2xpZGVyLnNldHRpbmdzLnBhZ2VyQ3VzdG9tKXsgdXBkYXRlUGFnZXJBY3RpdmUoc2xpZGVyLmFjdGl2ZS5pbmRleCk7IH1cblx0XHRcdC8vIC8vIGNoZWNrIGZvciBkaXJlY3Rpb24gY29udHJvbCB1cGRhdGVcblx0XHRcdGlmKHNsaWRlci5zZXR0aW5ncy5jb250cm9scyl7IHVwZGF0ZURpcmVjdGlvbkNvbnRyb2xzKCk7IH1cblx0XHRcdC8vIGlmIHNsaWRlciBpcyBzZXQgdG8gbW9kZTogXCJmYWRlXCJcblx0XHRcdGlmKHNsaWRlci5zZXR0aW5ncy5tb2RlID09PSAnZmFkZScpe1xuXHRcdFx0XHQvLyBpZiBhZGFwdGl2ZUhlaWdodCBpcyB0cnVlIGFuZCBuZXh0IGhlaWdodCBpcyBkaWZmZXJlbnQgZnJvbSBjdXJyZW50IGhlaWdodCwgYW5pbWF0ZSB0byB0aGUgbmV3IGhlaWdodFxuXHRcdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MuYWRhcHRpdmVIZWlnaHQgJiYgc2xpZGVyLnZpZXdwb3J0LmhlaWdodCgpICE9PSBnZXRWaWV3cG9ydEhlaWdodCgpKXtcblx0XHRcdFx0XHRzbGlkZXIudmlld3BvcnQuYW5pbWF0ZSh7aGVpZ2h0OiBnZXRWaWV3cG9ydEhlaWdodCgpfSwgc2xpZGVyLnNldHRpbmdzLmFkYXB0aXZlSGVpZ2h0U3BlZWQpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdC8vIGZhZGUgb3V0IHRoZSB2aXNpYmxlIGNoaWxkIGFuZCByZXNldCBpdHMgei1pbmRleCB2YWx1ZVxuXHRcdFx0XHRzbGlkZXIuY2hpbGRyZW4uZmlsdGVyKCc6dmlzaWJsZScpLmZhZGVPdXQoc2xpZGVyLnNldHRpbmdzLnNwZWVkKS5jc3Moe3pJbmRleDogMH0pO1xuXHRcdFx0XHQvLyBmYWRlIGluIHRoZSBuZXdseSByZXF1ZXN0ZWQgc2xpZGVcblx0XHRcdFx0c2xpZGVyLmNoaWxkcmVuLmVxKHNsaWRlci5hY3RpdmUuaW5kZXgpLmNzcygnekluZGV4Jywgc2xpZGVyLnNldHRpbmdzLnNsaWRlWkluZGV4KzEpLmZhZGVJbihzbGlkZXIuc2V0dGluZ3Muc3BlZWQsIGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0JCh0aGlzKS5jc3MoJ3pJbmRleCcsIHNsaWRlci5zZXR0aW5ncy5zbGlkZVpJbmRleCk7XG5cdFx0XHRcdFx0dXBkYXRlQWZ0ZXJTbGlkZVRyYW5zaXRpb24oKTtcblx0XHRcdFx0fSk7XG5cdFx0XHQvLyBzbGlkZXIgbW9kZSBpcyBub3QgXCJmYWRlXCJcblx0XHRcdH1lbHNle1xuXHRcdFx0XHQvLyBpZiBhZGFwdGl2ZUhlaWdodCBpcyB0cnVlIGFuZCBuZXh0IGhlaWdodCBpcyBkaWZmZXJlbnQgZnJvbSBjdXJyZW50IGhlaWdodCwgYW5pbWF0ZSB0byB0aGUgbmV3IGhlaWdodFxuXHRcdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MuYWRhcHRpdmVIZWlnaHQgJiYgc2xpZGVyLnZpZXdwb3J0LmhlaWdodCgpICE9PSBnZXRWaWV3cG9ydEhlaWdodCgpKXtcblx0XHRcdFx0XHRzbGlkZXIudmlld3BvcnQuYW5pbWF0ZSh7aGVpZ2h0OiBnZXRWaWV3cG9ydEhlaWdodCgpfSwgc2xpZGVyLnNldHRpbmdzLmFkYXB0aXZlSGVpZ2h0U3BlZWQpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHZhciBtb3ZlQnkgPSAwO1xuXHRcdFx0XHR2YXIgcG9zaXRpb24gPSB7bGVmdDogMCwgdG9wOiAwfTtcblx0XHRcdFx0dmFyIGxhc3RDaGlsZCA9IG51bGw7XG5cdFx0XHRcdC8vIGlmIGNhcm91c2VsIGFuZCBub3QgaW5maW5pdGUgbG9vcFxuXHRcdFx0XHRpZighc2xpZGVyLnNldHRpbmdzLmluZmluaXRlTG9vcCAmJiBzbGlkZXIuY2Fyb3VzZWwgJiYgc2xpZGVyLmFjdGl2ZS5sYXN0KXtcblx0XHRcdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MubW9kZSA9PT0gJ2hvcml6b250YWwnKXtcblx0XHRcdFx0XHRcdC8vIGdldCB0aGUgbGFzdCBjaGlsZCBwb3NpdGlvblxuXHRcdFx0XHRcdFx0bGFzdENoaWxkID0gc2xpZGVyLmNoaWxkcmVuLmVxKHNsaWRlci5jaGlsZHJlbi5sZW5ndGggLSAxKTtcblx0XHRcdFx0XHRcdHBvc2l0aW9uID0gbGFzdENoaWxkLnBvc2l0aW9uKCk7XG5cdFx0XHRcdFx0XHQvLyBjYWxjdWxhdGUgdGhlIHBvc2l0aW9uIG9mIHRoZSBsYXN0IHNsaWRlXG5cdFx0XHRcdFx0XHRtb3ZlQnkgPSBzbGlkZXIudmlld3BvcnQud2lkdGgoKSAtIGxhc3RDaGlsZC5vdXRlcldpZHRoKCk7XG5cdFx0XHRcdFx0fWVsc2V7XG5cdFx0XHRcdFx0XHQvLyBnZXQgbGFzdCBzaG93aW5nIGluZGV4IHBvc2l0aW9uXG5cdFx0XHRcdFx0XHR2YXIgbGFzdFNob3dpbmdJbmRleCA9IHNsaWRlci5jaGlsZHJlbi5sZW5ndGggLSBzbGlkZXIuc2V0dGluZ3MubWluU2xpZGVzO1xuXHRcdFx0XHRcdFx0cG9zaXRpb24gPSBzbGlkZXIuY2hpbGRyZW4uZXEobGFzdFNob3dpbmdJbmRleCkucG9zaXRpb24oKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0Ly8gaG9yaXpvbnRhbCBjYXJvdXNlbCwgZ29pbmcgcHJldmlvdXMgd2hpbGUgb24gZmlyc3Qgc2xpZGUgKGluZmluaXRlTG9vcCBtb2RlKVxuXHRcdFx0XHR9ZWxzZSBpZihzbGlkZXIuY2Fyb3VzZWwgJiYgc2xpZGVyLmFjdGl2ZS5sYXN0ICYmIGRpcmVjdGlvbiA9PT0gJ3ByZXYnKXtcblx0XHRcdFx0XHQvLyBnZXQgdGhlIGxhc3QgY2hpbGQgcG9zaXRpb25cblx0XHRcdFx0XHR2YXIgZXEgPSBzbGlkZXIuc2V0dGluZ3MubW92ZVNsaWRlcyA9PT0gMSA/IHNsaWRlci5zZXR0aW5ncy5tYXhTbGlkZXMgLSBnZXRNb3ZlQnkoKSA6ICgoZ2V0UGFnZXJRdHkoKSAtIDEpICogZ2V0TW92ZUJ5KCkpIC0gKHNsaWRlci5jaGlsZHJlbi5sZW5ndGggLSBzbGlkZXIuc2V0dGluZ3MubWF4U2xpZGVzKTtcblx0XHRcdFx0XHRsYXN0Q2hpbGQgPSBlbC5jaGlsZHJlbignLmJ4LWNsb25lJykuZXEoZXEpO1xuXHRcdFx0XHRcdHBvc2l0aW9uID0gbGFzdENoaWxkLnBvc2l0aW9uKCk7XG5cdFx0XHRcdC8vIGlmIGluZmluaXRlIGxvb3AgYW5kIFwiTmV4dFwiIGlzIGNsaWNrZWQgb24gdGhlIGxhc3Qgc2xpZGVcblx0XHRcdFx0fWVsc2UgaWYoZGlyZWN0aW9uID09PSAnbmV4dCcgJiYgc2xpZGVyLmFjdGl2ZS5pbmRleCA9PT0gMCl7XG5cdFx0XHRcdFx0Ly8gZ2V0IHRoZSBsYXN0IGNsb25lIHBvc2l0aW9uXG5cdFx0XHRcdFx0cG9zaXRpb24gPSBlbC5maW5kKCc+IC5ieC1jbG9uZScpLmVxKHNsaWRlci5zZXR0aW5ncy5tYXhTbGlkZXMpLnBvc2l0aW9uKCk7XG5cdFx0XHRcdFx0c2xpZGVyLmFjdGl2ZS5sYXN0ID0gZmFsc2U7XG5cdFx0XHRcdC8vIG5vcm1hbCBub24temVybyByZXF1ZXN0c1xuXHRcdFx0XHR9ZWxzZSBpZihzbGlkZUluZGV4ID49IDApe1xuXHRcdFx0XHRcdHZhciByZXF1ZXN0RWwgPSBzbGlkZUluZGV4ICogZ2V0TW92ZUJ5KCk7XG5cdFx0XHRcdFx0cG9zaXRpb24gPSBzbGlkZXIuY2hpbGRyZW4uZXEocmVxdWVzdEVsKS5wb3NpdGlvbigpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0XG5cdFx0XHRcdC8qIElmIHRoZSBwb3NpdGlvbiBkb2Vzbid0IGV4aXN0XG5cdFx0XHRcdCAqIChlLmcuIGlmIHlvdSBkZXN0cm95IHRoZSBzbGlkZXIgb24gYSBuZXh0IGNsaWNrKSxcblx0XHRcdFx0ICogaXQgZG9lc24ndCB0aHJvdyBhbiBlcnJvci5cblx0XHRcdFx0ICovXG5cdFx0XHRcdGlmKFwidW5kZWZpbmVkXCIgIT09IHR5cGVvZihwb3NpdGlvbikpe1xuXHRcdFx0XHRcdHZhciB2YWx1ZSA9IHNsaWRlci5zZXR0aW5ncy5tb2RlID09PSAnaG9yaXpvbnRhbCcgPyAtKHBvc2l0aW9uLmxlZnQgLSBtb3ZlQnkpIDogLXBvc2l0aW9uLnRvcDtcblx0XHRcdFx0XHQvLyBwbHVnaW4gdmFsdWVzIHRvIGJlIGFuaW1hdGVkXG5cdFx0XHRcdFx0c2V0UG9zaXRpb25Qcm9wZXJ0eSh2YWx1ZSwgJ3NsaWRlJywgc2xpZGVyLnNldHRpbmdzLnNwZWVkKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBUcmFuc2l0aW9ucyB0byB0aGUgbmV4dCBzbGlkZSBpbiB0aGUgc2hvd1xuXHRcdCAqL1xuXHRcdGVsLmdvVG9OZXh0U2xpZGUgPSBmdW5jdGlvbigpe1xuXHRcdFx0Ly8gaWYgaW5maW5pdGVMb29wIGlzIGZhbHNlIGFuZCBsYXN0IHBhZ2UgaXMgc2hvd2luZywgZGlzcmVnYXJkIGNhbGxcblx0XHRcdGlmKCFzbGlkZXIuc2V0dGluZ3MuaW5maW5pdGVMb29wICYmIHNsaWRlci5hY3RpdmUubGFzdCl7IHJldHVybjsgfVxuXHRcdFx0dmFyIHBhZ2VySW5kZXggPSBwYXJzZUludChzbGlkZXIuYWN0aXZlLmluZGV4KSArIDE7XG5cdFx0XHRlbC5nb1RvU2xpZGUocGFnZXJJbmRleCwgJ25leHQnKTtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogVHJhbnNpdGlvbnMgdG8gdGhlIHByZXYgc2xpZGUgaW4gdGhlIHNob3dcblx0XHQgKi9cblx0XHRlbC5nb1RvUHJldlNsaWRlID0gZnVuY3Rpb24oKXtcblx0XHRcdC8vIGlmIGluZmluaXRlTG9vcCBpcyBmYWxzZSBhbmQgbGFzdCBwYWdlIGlzIHNob3dpbmcsIGRpc3JlZ2FyZCBjYWxsXG5cdFx0XHRpZighc2xpZGVyLnNldHRpbmdzLmluZmluaXRlTG9vcCAmJiBzbGlkZXIuYWN0aXZlLmluZGV4ID09PSAwKXsgcmV0dXJuOyB9XG5cdFx0XHR2YXIgcGFnZXJJbmRleCA9IHBhcnNlSW50KHNsaWRlci5hY3RpdmUuaW5kZXgpIC0gMTtcblx0XHRcdGVsLmdvVG9TbGlkZShwYWdlckluZGV4LCAncHJldicpO1xuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBTdGFydHMgdGhlIGF1dG8gc2hvd1xuXHRcdCAqXG5cdFx0ICogQHBhcmFtIHByZXZlbnRDb250cm9sVXBkYXRlIChib29sZWFuKVxuXHRcdCAqICAtIGlmIHRydWUsIGF1dG8gY29udHJvbHMgc3RhdGUgd2lsbCBub3QgYmUgdXBkYXRlZFxuXHRcdCAqL1xuXHRcdGVsLnN0YXJ0QXV0byA9IGZ1bmN0aW9uKHByZXZlbnRDb250cm9sVXBkYXRlKXtcblx0XHRcdC8vIGlmIGFuIGludGVydmFsIGFscmVhZHkgZXhpc3RzLCBkaXNyZWdhcmQgY2FsbFxuXHRcdFx0aWYoc2xpZGVyLmludGVydmFsKXsgcmV0dXJuOyB9XG5cdFx0XHQvLyBjcmVhdGUgYW4gaW50ZXJ2YWxcblx0XHRcdHNsaWRlci5pbnRlcnZhbCA9IHNldEludGVydmFsKGZ1bmN0aW9uKCl7XG5cdFx0XHRcdGlmKHNsaWRlci5zZXR0aW5ncy5hdXRvRGlyZWN0aW9uID09PSAnbmV4dCcpeyBcblx0XHRcdFx0XHRlbC5nb1RvTmV4dFNsaWRlKCk7IFxuXHRcdFx0XHR9ZWxzZXtcblx0XHRcdFx0XHRlbC5nb1RvUHJldlNsaWRlKCk7XG5cdFx0XHRcdH1cblx0XHRcdH0sIHNsaWRlci5zZXR0aW5ncy5wYXVzZSk7XG5cdFx0XHQvLyBpZiBhdXRvIGNvbnRyb2xzIGFyZSBkaXNwbGF5ZWQgYW5kIHByZXZlbnRDb250cm9sVXBkYXRlIGlzIG5vdCB0cnVlXG5cdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MuYXV0b0NvbnRyb2xzICYmIHByZXZlbnRDb250cm9sVXBkYXRlICE9PSB0cnVlKXsgdXBkYXRlQXV0b0NvbnRyb2xzKCdzdG9wJyk7IH1cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogU3RvcHMgdGhlIGF1dG8gc2hvd1xuXHRcdCAqXG5cdFx0ICogQHBhcmFtIHByZXZlbnRDb250cm9sVXBkYXRlIChib29sZWFuKVxuXHRcdCAqICAtIGlmIHRydWUsIGF1dG8gY29udHJvbHMgc3RhdGUgd2lsbCBub3QgYmUgdXBkYXRlZFxuXHRcdCAqL1xuXHRcdGVsLnN0b3BBdXRvID0gZnVuY3Rpb24ocHJldmVudENvbnRyb2xVcGRhdGUpe1xuXHRcdFx0Ly8gaWYgbm8gaW50ZXJ2YWwgZXhpc3RzLCBkaXNyZWdhcmQgY2FsbFxuXHRcdFx0aWYoIXNsaWRlci5pbnRlcnZhbCl7IHJldHVybjsgfVxuXHRcdFx0Ly8gY2xlYXIgdGhlIGludGVydmFsXG5cdFx0XHRjbGVhckludGVydmFsKHNsaWRlci5pbnRlcnZhbCk7XG5cdFx0XHRzbGlkZXIuaW50ZXJ2YWwgPSBudWxsO1xuXHRcdFx0Ly8gaWYgYXV0byBjb250cm9scyBhcmUgZGlzcGxheWVkIGFuZCBwcmV2ZW50Q29udHJvbFVwZGF0ZSBpcyBub3QgdHJ1ZVxuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLmF1dG9Db250cm9scyAmJiBwcmV2ZW50Q29udHJvbFVwZGF0ZSAhPT0gdHJ1ZSl7IHVwZGF0ZUF1dG9Db250cm9scygnc3RhcnQnKTsgfVxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIGN1cnJlbnQgc2xpZGUgaW5kZXggKHplcm8tYmFzZWQpXG5cdFx0ICovXG5cdFx0ZWwuZ2V0Q3VycmVudFNsaWRlID0gZnVuY3Rpb24oKXtcblx0XHRcdHJldHVybiBzbGlkZXIuYWN0aXZlLmluZGV4O1xuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIGN1cnJlbnQgc2xpZGUgZWxlbWVudFxuXHRcdCAqL1xuXHRcdGVsLmdldEN1cnJlbnRTbGlkZUVsZW1lbnQgPSBmdW5jdGlvbigpe1xuXHRcdFx0cmV0dXJuIHNsaWRlci5jaGlsZHJlbi5lcShzbGlkZXIuYWN0aXZlLmluZGV4KTtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyBudW1iZXIgb2Ygc2xpZGVzIGluIHNob3dcblx0XHQgKi9cblx0XHRlbC5nZXRTbGlkZUNvdW50ID0gZnVuY3Rpb24oKXtcblx0XHRcdHJldHVybiBzbGlkZXIuY2hpbGRyZW4ubGVuZ3RoO1xuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm4gc2xpZGVyLndvcmtpbmcgdmFyaWFibGVcblx0XHQgKi9cblx0XHRlbC5pc1dvcmtpbmcgPSBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiBzbGlkZXIud29ya2luZztcblx0XHR9XG5cblx0XHQvKipcblx0XHQgKiBVcGRhdGUgYWxsIGR5bmFtaWMgc2xpZGVyIGVsZW1lbnRzXG5cdFx0ICovXG5cdFx0ZWwucmVkcmF3U2xpZGVyID0gZnVuY3Rpb24oKXtcblx0XHRcdC8vIHJlc2l6ZSBhbGwgY2hpbGRyZW4gaW4gcmF0aW8gdG8gbmV3IHNjcmVlbiBzaXplXG5cdFx0XHRzbGlkZXIuY2hpbGRyZW4uYWRkKGVsLmZpbmQoJy5ieC1jbG9uZScpKS5vdXRlcldpZHRoKGdldFNsaWRlV2lkdGgoKSk7XG5cdFx0XHQvLyBhZGp1c3QgdGhlIGhlaWdodFxuXHRcdFx0c2xpZGVyLnZpZXdwb3J0LmNzcygnaGVpZ2h0JywgZ2V0Vmlld3BvcnRIZWlnaHQoKSk7XG5cdFx0XHQvLyB1cGRhdGUgdGhlIHNsaWRlIHBvc2l0aW9uXG5cdFx0XHRpZighc2xpZGVyLnNldHRpbmdzLnRpY2tlcikgeyBzZXRTbGlkZVBvc2l0aW9uKCk7IH0gICAgICAgICAgICAgICAgIFxuXHRcdFx0Ly8gaWYgYWN0aXZlLmxhc3Qgd2FzIHRydWUgYmVmb3JlIHRoZSBzY3JlZW4gcmVzaXplLCB3ZSB3YW50XG5cdFx0XHQvLyB0byBrZWVwIGl0IGxhc3Qgbm8gbWF0dGVyIHdoYXQgc2NyZWVuIHNpemUgd2UgZW5kIG9uXG5cdFx0XHRpZiAoc2xpZGVyLmFjdGl2ZS5sYXN0KSB7IHNsaWRlci5hY3RpdmUuaW5kZXggPSBnZXRQYWdlclF0eSgpIC0gMTsgfVxuXHRcdFx0Ly8gaWYgdGhlIGFjdGl2ZSBpbmRleCAocGFnZSkgbm8gbG9uZ2VyIGV4aXN0cyBkdWUgdG8gdGhlIHJlc2l6ZSwgc2ltcGx5IHNldCB0aGUgaW5kZXggYXMgbGFzdFxuXHRcdFx0aWYgKHNsaWRlci5hY3RpdmUuaW5kZXggPj0gZ2V0UGFnZXJRdHkoKSkgeyBzbGlkZXIuYWN0aXZlLmxhc3QgPSB0cnVlOyB9XG5cdFx0XHQvLyBpZiBhIHBhZ2VyIGlzIGJlaW5nIGRpc3BsYXllZCBhbmQgYSBjdXN0b20gcGFnZXIgaXMgbm90IGJlaW5nIHVzZWQsIHVwZGF0ZSBpdFxuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLnBhZ2VyICYmICFzbGlkZXIuc2V0dGluZ3MucGFnZXJDdXN0b20pe1xuXHRcdFx0XHRwb3B1bGF0ZVBhZ2VyKCk7XG5cdFx0XHRcdHVwZGF0ZVBhZ2VyQWN0aXZlKHNsaWRlci5hY3RpdmUuaW5kZXgpO1xuXHRcdFx0fVxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBEZXN0cm95IHRoZSBjdXJyZW50IGluc3RhbmNlIG9mIHRoZSBzbGlkZXIgKHJldmVydCBldmVyeXRoaW5nIGJhY2sgdG8gb3JpZ2luYWwgc3RhdGUpXG5cdFx0ICovXG5cdFx0ZWwuZGVzdHJveVNsaWRlciA9IGZ1bmN0aW9uKCl7XG5cdFx0XHQvLyBkb24ndCBkbyBhbnl0aGluZyBpZiBzbGlkZXIgaGFzIGFscmVhZHkgYmVlbiBkZXN0cm95ZWRcblx0XHRcdGlmKCFzbGlkZXIuaW5pdGlhbGl6ZWQpeyByZXR1cm47IH1cblx0XHRcdHNsaWRlci5pbml0aWFsaXplZCA9IGZhbHNlO1xuXHRcdFx0JCgnLmJ4LWNsb25lJywgdGhpcykucmVtb3ZlKCk7XG5cdFx0XHRzbGlkZXIuY2hpbGRyZW4uZWFjaChmdW5jdGlvbigpe1xuXHRcdFx0XHRpZigkKHRoaXMpLmRhdGEoXCJvcmlnU3R5bGVcIikgIT09IHVuZGVmaW5lZCl7XG5cdFx0XHRcdFx0JCh0aGlzKS5hdHRyKFwic3R5bGVcIiwgJCh0aGlzKS5kYXRhKFwib3JpZ1N0eWxlXCIpKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHQkKHRoaXMpLnJlbW92ZUF0dHIoJ3N0eWxlJyk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdFx0aWYoJCh0aGlzKS5kYXRhKFwib3JpZ1N0eWxlXCIpICE9PSB1bmRlZmluZWQpe1xuXHRcdFx0XHR0aGlzLmF0dHIoXCJzdHlsZVwiLCAkKHRoaXMpLmRhdGEoXCJvcmlnU3R5bGVcIikpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0JCh0aGlzKS5yZW1vdmVBdHRyKCdzdHlsZScpO1xuXHRcdFx0fVxuXHRcdFx0JCh0aGlzKS51bndyYXAoKS51bndyYXAoKTtcblx0XHRcdGlmKHNsaWRlci5jb250cm9scy5lbCl7IHNsaWRlci5jb250cm9scy5lbC5yZW1vdmUoKTsgfVxuXHRcdFx0aWYoc2xpZGVyLmNvbnRyb2xzLm5leHQpeyBzbGlkZXIuY29udHJvbHMubmV4dC5yZW1vdmUoKTsgfVxuXHRcdFx0aWYoc2xpZGVyLmNvbnRyb2xzLnByZXYpeyBzbGlkZXIuY29udHJvbHMucHJldi5yZW1vdmUoKTsgfVxuXHRcdFx0aWYoc2xpZGVyLnBhZ2VyRWwgJiYgc2xpZGVyLnNldHRpbmdzLmNvbnRyb2xzICYmICFzbGlkZXIuc2V0dGluZ3MucGFnZXJDdXN0b20peyBzbGlkZXIucGFnZXJFbC5yZW1vdmUoKTsgfVxuXHRcdFx0JCgnLmJ4LWNhcHRpb24nLCB0aGlzKS5yZW1vdmUoKTtcblx0XHRcdGlmKHNsaWRlci5jb250cm9scy5hdXRvRWwpeyBzbGlkZXIuY29udHJvbHMuYXV0b0VsLnJlbW92ZSgpOyB9XG5cdFx0XHRjbGVhckludGVydmFsKHNsaWRlci5pbnRlcnZhbCk7XG5cdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MucmVzcG9uc2l2ZSl7ICQod2luZG93KS51bmJpbmQoJ3Jlc2l6ZScsIHJlc2l6ZVdpbmRvdyk7IH1cblx0XHRcdGlmKHNsaWRlci5zZXR0aW5ncy5rZXlib2FyZEVuYWJsZWQpeyAkKGRvY3VtZW50KS51bmJpbmQoJ2tleWRvd24nLCBrZXlQcmVzcyk7IH1cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogUmVsb2FkIHRoZSBzbGlkZXIgKHJldmVydCBhbGwgRE9NIGNoYW5nZXMsIGFuZCByZS1pbml0aWFsaXplKVxuXHRcdCAqL1xuXHRcdGVsLnJlbG9hZFNsaWRlciA9IGZ1bmN0aW9uKHNldHRpbmdzKXtcblx0XHRcdGlmKHNldHRpbmdzICE9PSB1bmRlZmluZWQpeyBvcHRpb25zID0gc2V0dGluZ3M7IH1cblx0XHRcdGVsLmRlc3Ryb3lTbGlkZXIoKTtcblx0XHRcdGluaXQoKTtcblx0XHR9O1xuXG5cdFx0aW5pdCgpO1xuXG5cdFx0Ly8gcmV0dXJucyB0aGUgY3VycmVudCBqUXVlcnkgb2JqZWN0XG5cdFx0cmV0dXJuIHRoaXM7XG5cdH07XG5cbn0pKGpRdWVyeSk7XG4iLCIvKipcbiAqIExpZ2h0Ym94IHYyLjcuMVxuICogYnkgTG9rZXNoIERoYWthciAtIGh0dHA6Ly9sb2tlc2hkaGFrYXIuY29tL3Byb2plY3RzL2xpZ2h0Ym94Mi9cbiAqXG4gKiBAbGljZW5zZSBodHRwOi8vY3JlYXRpdmVjb21tb25zLm9yZy9saWNlbnNlcy9ieS8yLjUvXG4gKiAtIEZyZWUgZm9yIHVzZSBpbiBib3RoIHBlcnNvbmFsIGFuZCBjb21tZXJjaWFsIHByb2plY3RzXG4gKiAtIEF0dHJpYnV0aW9uIHJlcXVpcmVzIGxlYXZpbmcgYXV0aG9yIG5hbWUsIGF1dGhvciBsaW5rLCBhbmQgdGhlIGxpY2Vuc2UgaW5mbyBpbnRhY3RcbiAqL1xuXG4oZnVuY3Rpb24oKSB7XG4gIC8vIFVzZSBsb2NhbCBhbGlhc1xuICB2YXIgJCA9IGpRdWVyeTtcblxuICB2YXIgTGlnaHRib3hPcHRpb25zID0gKGZ1bmN0aW9uKCkge1xuICAgIGZ1bmN0aW9uIExpZ2h0Ym94T3B0aW9ucygpIHtcbiAgICAgIHRoaXMuZmFkZUR1cmF0aW9uICAgICAgICAgICAgICAgID0gNTAwO1xuICAgICAgdGhpcy5maXRJbWFnZXNJblZpZXdwb3J0ICAgICAgICAgPSB0cnVlO1xuICAgICAgdGhpcy5yZXNpemVEdXJhdGlvbiAgICAgICAgICAgICAgPSA3MDA7XG4gICAgICB0aGlzLnBvc2l0aW9uRnJvbVRvcCAgICAgICAgICAgICA9IDUwO1xuICAgICAgdGhpcy5zaG93SW1hZ2VOdW1iZXJMYWJlbCAgICAgICAgPSB0cnVlO1xuICAgICAgdGhpcy5hbHdheXNTaG93TmF2T25Ub3VjaERldmljZXMgPSBmYWxzZTtcbiAgICAgIHRoaXMud3JhcEFyb3VuZCAgICAgICAgICAgICAgICAgID0gZmFsc2U7XG4gICAgfVxuICAgIFxuICAgIC8vIENoYW5nZSB0byBsb2NhbGl6ZSB0byBub24tZW5nbGlzaCBsYW5ndWFnZVxuICAgIExpZ2h0Ym94T3B0aW9ucy5wcm90b3R5cGUuYWxidW1MYWJlbCA9IGZ1bmN0aW9uKGN1ckltYWdlTnVtLCBhbGJ1bVNpemUpIHtcbiAgICAgIHJldHVybiBcIkltYWdlIFwiICsgY3VySW1hZ2VOdW0gKyBcIiBvZiBcIiArIGFsYnVtU2l6ZTtcbiAgICB9O1xuXG4gICAgcmV0dXJuIExpZ2h0Ym94T3B0aW9ucztcbiAgfSkoKTtcblxuXG4gIHZhciBMaWdodGJveCA9IChmdW5jdGlvbigpIHtcbiAgICBmdW5jdGlvbiBMaWdodGJveChvcHRpb25zKSB7XG4gICAgICB0aGlzLm9wdGlvbnMgICAgICAgICAgID0gb3B0aW9ucztcbiAgICAgIHRoaXMuYWxidW0gICAgICAgICAgICAgPSBbXTtcbiAgICAgIHRoaXMuY3VycmVudEltYWdlSW5kZXggPSB2b2lkIDA7XG4gICAgICB0aGlzLmluaXQoKTtcbiAgICB9XG5cbiAgICBMaWdodGJveC5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5lbmFibGUoKTtcbiAgICAgIHRoaXMuYnVpbGQoKTtcbiAgICB9O1xuXG4gICAgLy8gTG9vcCB0aHJvdWdoIGFuY2hvcnMgYW5kIGFyZWFtYXBzIGxvb2tpbmcgZm9yIGVpdGhlciBkYXRhLWxpZ2h0Ym94IGF0dHJpYnV0ZXMgb3IgcmVsIGF0dHJpYnV0ZXNcbiAgICAvLyB0aGF0IGNvbnRhaW4gJ2xpZ2h0Ym94Jy4gV2hlbiB0aGVzZSBhcmUgY2xpY2tlZCwgc3RhcnQgbGlnaHRib3guXG4gICAgTGlnaHRib3gucHJvdG90eXBlLmVuYWJsZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgJCgnYm9keScpLm9uKCdjbGljaycsICdhW3JlbF49bGlnaHRib3hdLCBhcmVhW3JlbF49bGlnaHRib3hdLCBhW2RhdGEtbGlnaHRib3hdLCBhcmVhW2RhdGEtbGlnaHRib3hdJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgc2VsZi5zdGFydCgkKGV2ZW50LmN1cnJlbnRUYXJnZXQpKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIC8vIEJ1aWxkIGh0bWwgZm9yIHRoZSBsaWdodGJveCBhbmQgdGhlIG92ZXJsYXkuXG4gICAgLy8gQXR0YWNoIGV2ZW50IGhhbmRsZXJzIHRvIHRoZSBuZXcgRE9NIGVsZW1lbnRzLiBjbGljayBjbGljayBjbGlja1xuICAgIExpZ2h0Ym94LnByb3RvdHlwZS5idWlsZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuICAgICAgJChcIjxkaXYgaWQ9J2xpZ2h0Ym94T3ZlcmxheScgY2xhc3M9J2xpZ2h0Ym94T3ZlcmxheSc+PC9kaXY+PGRpdiBpZD0nbGlnaHRib3gnIGNsYXNzPSdsaWdodGJveCc+PGRpdiBjbGFzcz0nbGItb3V0ZXJDb250YWluZXInPjxkaXYgY2xhc3M9J2xiLWNvbnRhaW5lcic+PGltZyBjbGFzcz0nbGItaW1hZ2UnIHNyYz0nJyAvPjxkaXYgY2xhc3M9J2xiLW5hdic+PGEgY2xhc3M9J2xiLXByZXYnIGhyZWY9JycgPjwvYT48YSBjbGFzcz0nbGItbmV4dCcgaHJlZj0nJyA+PC9hPjwvZGl2PjxkaXYgY2xhc3M9J2xiLWxvYWRlcic+PGEgY2xhc3M9J2xiLWNhbmNlbCc+PC9hPjwvZGl2PjwvZGl2PjwvZGl2PjxkaXYgY2xhc3M9J2xiLWRhdGFDb250YWluZXInPjxkaXYgY2xhc3M9J2xiLWRhdGEnPjxkaXYgY2xhc3M9J2xiLWRldGFpbHMnPjxzcGFuIGNsYXNzPSdsYi1jYXB0aW9uJz48L3NwYW4+PHNwYW4gY2xhc3M9J2xiLW51bWJlcic+PC9zcGFuPjwvZGl2PjxkaXYgY2xhc3M9J2xiLWNsb3NlQ29udGFpbmVyJz48YSBjbGFzcz0nbGItY2xvc2UnPjwvYT48L2Rpdj48L2Rpdj48L2Rpdj48L2Rpdj5cIikuYXBwZW5kVG8oJCgnYm9keScpKTtcbiAgICAgIFxuICAgICAgLy8gQ2FjaGUgalF1ZXJ5IG9iamVjdHNcbiAgICAgIHRoaXMuJGxpZ2h0Ym94ICAgICAgID0gJCgnI2xpZ2h0Ym94Jyk7XG4gICAgICB0aGlzLiRvdmVybGF5ICAgICAgICA9ICQoJyNsaWdodGJveE92ZXJsYXknKTtcbiAgICAgIHRoaXMuJG91dGVyQ29udGFpbmVyID0gdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLW91dGVyQ29udGFpbmVyJyk7XG4gICAgICB0aGlzLiRjb250YWluZXIgICAgICA9IHRoaXMuJGxpZ2h0Ym94LmZpbmQoJy5sYi1jb250YWluZXInKTtcblxuICAgICAgLy8gU3RvcmUgY3NzIHZhbHVlcyBmb3IgZnV0dXJlIGxvb2t1cFxuICAgICAgdGhpcy5jb250YWluZXJUb3BQYWRkaW5nID0gcGFyc2VJbnQodGhpcy4kY29udGFpbmVyLmNzcygncGFkZGluZy10b3AnKSwgMTApO1xuICAgICAgdGhpcy5jb250YWluZXJSaWdodFBhZGRpbmcgPSBwYXJzZUludCh0aGlzLiRjb250YWluZXIuY3NzKCdwYWRkaW5nLXJpZ2h0JyksIDEwKTtcbiAgICAgIHRoaXMuY29udGFpbmVyQm90dG9tUGFkZGluZyA9IHBhcnNlSW50KHRoaXMuJGNvbnRhaW5lci5jc3MoJ3BhZGRpbmctYm90dG9tJyksIDEwKTtcbiAgICAgIHRoaXMuY29udGFpbmVyTGVmdFBhZGRpbmcgPSBwYXJzZUludCh0aGlzLiRjb250YWluZXIuY3NzKCdwYWRkaW5nLWxlZnQnKSwgMTApO1xuICAgICAgXG4gICAgICAvLyBBdHRhY2ggZXZlbnQgaGFuZGxlcnMgdG8gdGhlIG5ld2x5IG1pbnRlZCBET00gZWxlbWVudHNcbiAgICAgIHRoaXMuJG92ZXJsYXkuaGlkZSgpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICBzZWxmLmVuZCgpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9KTtcblxuICAgICAgdGhpcy4kbGlnaHRib3guaGlkZSgpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIGlmICgkKGV2ZW50LnRhcmdldCkuYXR0cignaWQnKSA9PT0gJ2xpZ2h0Ym94Jykge1xuICAgICAgICAgIHNlbGYuZW5kKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuJG91dGVyQ29udGFpbmVyLm9uKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIGlmICgkKGV2ZW50LnRhcmdldCkuYXR0cignaWQnKSA9PT0gJ2xpZ2h0Ym94Jykge1xuICAgICAgICAgIHNlbGYuZW5kKCk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuJGxpZ2h0Ym94LmZpbmQoJy5sYi1wcmV2Jykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmIChzZWxmLmN1cnJlbnRJbWFnZUluZGV4ID09PSAwKSB7XG4gICAgICAgICAgc2VsZi5jaGFuZ2VJbWFnZShzZWxmLmFsYnVtLmxlbmd0aCAtIDEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNlbGYuY2hhbmdlSW1hZ2Uoc2VsZi5jdXJyZW50SW1hZ2VJbmRleCAtIDEpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLiRsaWdodGJveC5maW5kKCcubGItbmV4dCcpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoc2VsZi5jdXJyZW50SW1hZ2VJbmRleCA9PT0gc2VsZi5hbGJ1bS5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgc2VsZi5jaGFuZ2VJbWFnZSgwKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBzZWxmLmNoYW5nZUltYWdlKHNlbGYuY3VycmVudEltYWdlSW5kZXggKyAxKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9KTtcblxuICAgICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLWxvYWRlciwgLmxiLWNsb3NlJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIHNlbGYuZW5kKCk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICAvLyBTaG93IG92ZXJsYXkgYW5kIGxpZ2h0Ym94LiBJZiB0aGUgaW1hZ2UgaXMgcGFydCBvZiBhIHNldCwgYWRkIHNpYmxpbmdzIHRvIGFsYnVtIGFycmF5LlxuICAgIExpZ2h0Ym94LnByb3RvdHlwZS5zdGFydCA9IGZ1bmN0aW9uKCRsaW5rKSB7XG4gICAgICB2YXIgc2VsZiAgICA9IHRoaXM7XG4gICAgICB2YXIgJHdpbmRvdyA9ICQod2luZG93KTtcblxuICAgICAgJHdpbmRvdy5vbigncmVzaXplJywgJC5wcm94eSh0aGlzLnNpemVPdmVybGF5LCB0aGlzKSk7XG5cbiAgICAgICQoJ3NlbGVjdCwgb2JqZWN0LCBlbWJlZCcpLmNzcyh7XG4gICAgICAgIHZpc2liaWxpdHk6IFwiaGlkZGVuXCJcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLnNpemVPdmVybGF5KCk7XG5cbiAgICAgIHRoaXMuYWxidW0gPSBbXTtcbiAgICAgIHZhciBpbWFnZU51bWJlciA9IDA7XG5cbiAgICAgIGZ1bmN0aW9uIGFkZFRvQWxidW0oJGxpbmspIHtcbiAgICAgICAgc2VsZi5hbGJ1bS5wdXNoKHtcbiAgICAgICAgICBsaW5rOiAkbGluay5hdHRyKCdocmVmJyksXG4gICAgICAgICAgdGl0bGU6ICRsaW5rLmF0dHIoJ2RhdGEtdGl0bGUnKSB8fCAkbGluay5hdHRyKCd0aXRsZScpXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBTdXBwb3J0IGJvdGggZGF0YS1saWdodGJveCBhdHRyaWJ1dGUgYW5kIHJlbCBhdHRyaWJ1dGUgaW1wbGVtZW50YXRpb25zXG4gICAgICB2YXIgZGF0YUxpZ2h0Ym94VmFsdWUgPSAkbGluay5hdHRyKCdkYXRhLWxpZ2h0Ym94Jyk7XG4gICAgICB2YXIgJGxpbmtzO1xuXG4gICAgICBpZiAoZGF0YUxpZ2h0Ym94VmFsdWUpIHtcbiAgICAgICAgJGxpbmtzID0gJCgkbGluay5wcm9wKFwidGFnTmFtZVwiKSArICdbZGF0YS1saWdodGJveD1cIicgKyBkYXRhTGlnaHRib3hWYWx1ZSArICdcIl0nKTtcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCAkbGlua3MubGVuZ3RoOyBpID0gKytpKSB7XG4gICAgICAgICAgYWRkVG9BbGJ1bSgkKCRsaW5rc1tpXSkpO1xuICAgICAgICAgIGlmICgkbGlua3NbaV0gPT09ICRsaW5rWzBdKSB7XG4gICAgICAgICAgICBpbWFnZU51bWJlciA9IGk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoJGxpbmsuYXR0cigncmVsJykgPT09ICdsaWdodGJveCcpIHtcbiAgICAgICAgICAvLyBJZiBpbWFnZSBpcyBub3QgcGFydCBvZiBhIHNldFxuICAgICAgICAgIGFkZFRvQWxidW0oJGxpbmspO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIElmIGltYWdlIGlzIHBhcnQgb2YgYSBzZXRcbiAgICAgICAgICAkbGlua3MgPSAkKCRsaW5rLnByb3AoXCJ0YWdOYW1lXCIpICsgJ1tyZWw9XCInICsgJGxpbmsuYXR0cigncmVsJykgKyAnXCJdJyk7XG4gICAgICAgICAgZm9yICh2YXIgaiA9IDA7IGogPCAkbGlua3MubGVuZ3RoOyBqID0gKytqKSB7XG4gICAgICAgICAgICBhZGRUb0FsYnVtKCQoJGxpbmtzW2pdKSk7XG4gICAgICAgICAgICBpZiAoJGxpbmtzW2pdID09PSAkbGlua1swXSkge1xuICAgICAgICAgICAgICBpbWFnZU51bWJlciA9IGo7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgICBcbiAgICAgIC8vIFBvc2l0aW9uIExpZ2h0Ym94XG4gICAgICB2YXIgdG9wICA9ICR3aW5kb3cuc2Nyb2xsVG9wKCkgKyB0aGlzLm9wdGlvbnMucG9zaXRpb25Gcm9tVG9wO1xuICAgICAgdmFyIGxlZnQgPSAkd2luZG93LnNjcm9sbExlZnQoKTtcbiAgICAgIHRoaXMuJGxpZ2h0Ym94LmNzcyh7XG4gICAgICAgIHRvcDogdG9wICsgJ3B4JyxcbiAgICAgICAgbGVmdDogbGVmdCArICdweCdcbiAgICAgIH0pLmZhZGVJbih0aGlzLm9wdGlvbnMuZmFkZUR1cmF0aW9uKTtcblxuICAgICAgdGhpcy5jaGFuZ2VJbWFnZShpbWFnZU51bWJlcik7XG4gICAgfTtcblxuICAgIC8vIEhpZGUgbW9zdCBVSSBlbGVtZW50cyBpbiBwcmVwYXJhdGlvbiBmb3IgdGhlIGFuaW1hdGVkIHJlc2l6aW5nIG9mIHRoZSBsaWdodGJveC5cbiAgICBMaWdodGJveC5wcm90b3R5cGUuY2hhbmdlSW1hZ2UgPSBmdW5jdGlvbihpbWFnZU51bWJlcikge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICB0aGlzLmRpc2FibGVLZXlib2FyZE5hdigpO1xuICAgICAgdmFyICRpbWFnZSA9IHRoaXMuJGxpZ2h0Ym94LmZpbmQoJy5sYi1pbWFnZScpO1xuXG4gICAgICB0aGlzLiRvdmVybGF5LmZhZGVJbih0aGlzLm9wdGlvbnMuZmFkZUR1cmF0aW9uKTtcblxuICAgICAgJCgnLmxiLWxvYWRlcicpLmZhZGVJbignc2xvdycpO1xuICAgICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLWltYWdlLCAubGItbmF2LCAubGItcHJldiwgLmxiLW5leHQsIC5sYi1kYXRhQ29udGFpbmVyLCAubGItbnVtYmVycywgLmxiLWNhcHRpb24nKS5oaWRlKCk7XG5cbiAgICAgIHRoaXMuJG91dGVyQ29udGFpbmVyLmFkZENsYXNzKCdhbmltYXRpbmcnKTtcblxuICAgICAgLy8gV2hlbiBpbWFnZSB0byBzaG93IGlzIHByZWxvYWRlZCwgd2Ugc2VuZCB0aGUgd2lkdGggYW5kIGhlaWdodCB0byBzaXplQ29udGFpbmVyKClcbiAgICAgIHZhciBwcmVsb2FkZXIgPSBuZXcgSW1hZ2UoKTtcbiAgICAgIHByZWxvYWRlci5vbmxvYWQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyICRwcmVsb2FkZXIsIGltYWdlSGVpZ2h0LCBpbWFnZVdpZHRoLCBtYXhJbWFnZUhlaWdodCwgbWF4SW1hZ2VXaWR0aCwgd2luZG93SGVpZ2h0LCB3aW5kb3dXaWR0aDtcbiAgICAgICAgJGltYWdlLmF0dHIoJ3NyYycsIHNlbGYuYWxidW1baW1hZ2VOdW1iZXJdLmxpbmspO1xuXG4gICAgICAgICRwcmVsb2FkZXIgPSAkKHByZWxvYWRlcik7XG5cbiAgICAgICAgJGltYWdlLndpZHRoKHByZWxvYWRlci53aWR0aCk7XG4gICAgICAgICRpbWFnZS5oZWlnaHQocHJlbG9hZGVyLmhlaWdodCk7XG4gICAgICAgIFxuICAgICAgICBpZiAoc2VsZi5vcHRpb25zLmZpdEltYWdlc0luVmlld3BvcnQpIHtcbiAgICAgICAgICAvLyBGaXQgaW1hZ2UgaW5zaWRlIHRoZSB2aWV3cG9ydC5cbiAgICAgICAgICAvLyBUYWtlIGludG8gYWNjb3VudCB0aGUgYm9yZGVyIGFyb3VuZCB0aGUgaW1hZ2UgYW5kIGFuIGFkZGl0aW9uYWwgMTBweCBndXR0ZXIgb24gZWFjaCBzaWRlLlxuXG4gICAgICAgICAgd2luZG93V2lkdGggICAgPSAkKHdpbmRvdykud2lkdGgoKTtcbiAgICAgICAgICB3aW5kb3dIZWlnaHQgICA9ICQod2luZG93KS5oZWlnaHQoKTtcbiAgICAgICAgICBtYXhJbWFnZVdpZHRoICA9IHdpbmRvd1dpZHRoIC0gc2VsZi5jb250YWluZXJMZWZ0UGFkZGluZyAtIHNlbGYuY29udGFpbmVyUmlnaHRQYWRkaW5nIC0gMjA7XG4gICAgICAgICAgbWF4SW1hZ2VIZWlnaHQgPSB3aW5kb3dIZWlnaHQgLSBzZWxmLmNvbnRhaW5lclRvcFBhZGRpbmcgLSBzZWxmLmNvbnRhaW5lckJvdHRvbVBhZGRpbmcgLSAxMjA7XG5cbiAgICAgICAgICAvLyBJcyB0aGVyZSBhIGZpdHRpbmcgaXNzdWU/XG4gICAgICAgICAgaWYgKChwcmVsb2FkZXIud2lkdGggPiBtYXhJbWFnZVdpZHRoKSB8fCAocHJlbG9hZGVyLmhlaWdodCA+IG1heEltYWdlSGVpZ2h0KSkge1xuICAgICAgICAgICAgaWYgKChwcmVsb2FkZXIud2lkdGggLyBtYXhJbWFnZVdpZHRoKSA+IChwcmVsb2FkZXIuaGVpZ2h0IC8gbWF4SW1hZ2VIZWlnaHQpKSB7XG4gICAgICAgICAgICAgIGltYWdlV2lkdGggID0gbWF4SW1hZ2VXaWR0aDtcbiAgICAgICAgICAgICAgaW1hZ2VIZWlnaHQgPSBwYXJzZUludChwcmVsb2FkZXIuaGVpZ2h0IC8gKHByZWxvYWRlci53aWR0aCAvIGltYWdlV2lkdGgpLCAxMCk7XG4gICAgICAgICAgICAgICRpbWFnZS53aWR0aChpbWFnZVdpZHRoKTtcbiAgICAgICAgICAgICAgJGltYWdlLmhlaWdodChpbWFnZUhlaWdodCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBpbWFnZUhlaWdodCA9IG1heEltYWdlSGVpZ2h0O1xuICAgICAgICAgICAgICBpbWFnZVdpZHRoID0gcGFyc2VJbnQocHJlbG9hZGVyLndpZHRoIC8gKHByZWxvYWRlci5oZWlnaHQgLyBpbWFnZUhlaWdodCksIDEwKTtcbiAgICAgICAgICAgICAgJGltYWdlLndpZHRoKGltYWdlV2lkdGgpO1xuICAgICAgICAgICAgICAkaW1hZ2UuaGVpZ2h0KGltYWdlSGVpZ2h0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgc2VsZi5zaXplQ29udGFpbmVyKCRpbWFnZS53aWR0aCgpLCAkaW1hZ2UuaGVpZ2h0KCkpO1xuICAgICAgfTtcblxuICAgICAgcHJlbG9hZGVyLnNyYyAgICAgICAgICA9IHRoaXMuYWxidW1baW1hZ2VOdW1iZXJdLmxpbms7XG4gICAgICB0aGlzLmN1cnJlbnRJbWFnZUluZGV4ID0gaW1hZ2VOdW1iZXI7XG4gICAgfTtcblxuICAgIC8vIFN0cmV0Y2ggb3ZlcmxheSB0byBmaXQgdGhlIHZpZXdwb3J0XG4gICAgTGlnaHRib3gucHJvdG90eXBlLnNpemVPdmVybGF5ID0gZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLiRvdmVybGF5XG4gICAgICAgIC53aWR0aCgkKHdpbmRvdykud2lkdGgoKSlcbiAgICAgICAgLmhlaWdodCgkKGRvY3VtZW50KS5oZWlnaHQoKSk7XG4gICAgfTtcblxuICAgIC8vIEFuaW1hdGUgdGhlIHNpemUgb2YgdGhlIGxpZ2h0Ym94IHRvIGZpdCB0aGUgaW1hZ2Ugd2UgYXJlIHNob3dpbmdcbiAgICBMaWdodGJveC5wcm90b3R5cGUuc2l6ZUNvbnRhaW5lciA9IGZ1bmN0aW9uKGltYWdlV2lkdGgsIGltYWdlSGVpZ2h0KSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICBcbiAgICAgIHZhciBvbGRXaWR0aCAgPSB0aGlzLiRvdXRlckNvbnRhaW5lci5vdXRlcldpZHRoKCk7XG4gICAgICB2YXIgb2xkSGVpZ2h0ID0gdGhpcy4kb3V0ZXJDb250YWluZXIub3V0ZXJIZWlnaHQoKTtcbiAgICAgIHZhciBuZXdXaWR0aCAgPSBpbWFnZVdpZHRoICsgdGhpcy5jb250YWluZXJMZWZ0UGFkZGluZyArIHRoaXMuY29udGFpbmVyUmlnaHRQYWRkaW5nO1xuICAgICAgdmFyIG5ld0hlaWdodCA9IGltYWdlSGVpZ2h0ICsgdGhpcy5jb250YWluZXJUb3BQYWRkaW5nICsgdGhpcy5jb250YWluZXJCb3R0b21QYWRkaW5nO1xuICAgICAgXG4gICAgICBmdW5jdGlvbiBwb3N0UmVzaXplKCkge1xuICAgICAgICBzZWxmLiRsaWdodGJveC5maW5kKCcubGItZGF0YUNvbnRhaW5lcicpLndpZHRoKG5ld1dpZHRoKTtcbiAgICAgICAgc2VsZi4kbGlnaHRib3guZmluZCgnLmxiLXByZXZMaW5rJykuaGVpZ2h0KG5ld0hlaWdodCk7XG4gICAgICAgIHNlbGYuJGxpZ2h0Ym94LmZpbmQoJy5sYi1uZXh0TGluaycpLmhlaWdodChuZXdIZWlnaHQpO1xuICAgICAgICBzZWxmLnNob3dJbWFnZSgpO1xuICAgICAgfVxuXG4gICAgICBpZiAob2xkV2lkdGggIT09IG5ld1dpZHRoIHx8IG9sZEhlaWdodCAhPT0gbmV3SGVpZ2h0KSB7XG4gICAgICAgIHRoaXMuJG91dGVyQ29udGFpbmVyLmFuaW1hdGUoe1xuICAgICAgICAgIHdpZHRoOiBuZXdXaWR0aCxcbiAgICAgICAgICBoZWlnaHQ6IG5ld0hlaWdodFxuICAgICAgICB9LCB0aGlzLm9wdGlvbnMucmVzaXplRHVyYXRpb24sICdzd2luZycsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHBvc3RSZXNpemUoKTtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBwb3N0UmVzaXplKCk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8vIERpc3BsYXkgdGhlIGltYWdlIGFuZCBpdCdzIGRldGFpbHMgYW5kIGJlZ2luIHByZWxvYWQgbmVpZ2hib3JpbmcgaW1hZ2VzLlxuICAgIExpZ2h0Ym94LnByb3RvdHlwZS5zaG93SW1hZ2UgPSBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuJGxpZ2h0Ym94LmZpbmQoJy5sYi1sb2FkZXInKS5oaWRlKCk7XG4gICAgICB0aGlzLiRsaWdodGJveC5maW5kKCcubGItaW1hZ2UnKS5mYWRlSW4oJ3Nsb3cnKTtcbiAgICBcbiAgICAgIHRoaXMudXBkYXRlTmF2KCk7XG4gICAgICB0aGlzLnVwZGF0ZURldGFpbHMoKTtcbiAgICAgIHRoaXMucHJlbG9hZE5laWdoYm9yaW5nSW1hZ2VzKCk7XG4gICAgICB0aGlzLmVuYWJsZUtleWJvYXJkTmF2KCk7XG4gICAgfTtcblxuICAgIC8vIERpc3BsYXkgcHJldmlvdXMgYW5kIG5leHQgbmF2aWdhdGlvbiBpZiBhcHByb3ByaWF0ZS5cbiAgICBMaWdodGJveC5wcm90b3R5cGUudXBkYXRlTmF2ID0gZnVuY3Rpb24oKSB7XG4gICAgICAvLyBDaGVjayB0byBzZWUgaWYgdGhlIGJyb3dzZXIgc3VwcG9ydHMgdG91Y2ggZXZlbnRzLiBJZiBzbywgd2UgdGFrZSB0aGUgY29uc2VydmF0aXZlIGFwcHJvYWNoXG4gICAgICAvLyBhbmQgYXNzdW1lIHRoYXQgbW91c2UgaG92ZXIgZXZlbnRzIGFyZSBub3Qgc3VwcG9ydGVkIGFuZCBhbHdheXMgc2hvdyBwcmV2L25leHQgbmF2aWdhdGlvblxuICAgICAgLy8gYXJyb3dzIGluIGltYWdlIHNldHMuXG4gICAgICB2YXIgYWx3YXlzU2hvd05hdiA9IGZhbHNlO1xuICAgICAgdHJ5IHtcbiAgICAgICAgZG9jdW1lbnQuY3JlYXRlRXZlbnQoXCJUb3VjaEV2ZW50XCIpO1xuICAgICAgICBhbHdheXNTaG93TmF2ID0gKHRoaXMub3B0aW9ucy5hbHdheXNTaG93TmF2T25Ub3VjaERldmljZXMpPyB0cnVlOiBmYWxzZTtcbiAgICAgIH0gY2F0Y2ggKGUpIHt9XG5cbiAgICAgIHRoaXMuJGxpZ2h0Ym94LmZpbmQoJy5sYi1uYXYnKS5zaG93KCk7XG5cbiAgICAgIGlmICh0aGlzLmFsYnVtLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy53cmFwQXJvdW5kKSB7XG4gICAgICAgICAgaWYgKGFsd2F5c1Nob3dOYXYpIHtcbiAgICAgICAgICAgIHRoaXMuJGxpZ2h0Ym94LmZpbmQoJy5sYi1wcmV2LCAubGItbmV4dCcpLmNzcygnb3BhY2l0eScsICcxJyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHRoaXMuJGxpZ2h0Ym94LmZpbmQoJy5sYi1wcmV2LCAubGItbmV4dCcpLnNob3coKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAodGhpcy5jdXJyZW50SW1hZ2VJbmRleCA+IDApIHtcbiAgICAgICAgICAgIHRoaXMuJGxpZ2h0Ym94LmZpbmQoJy5sYi1wcmV2Jykuc2hvdygpO1xuICAgICAgICAgICAgaWYgKGFsd2F5c1Nob3dOYXYpIHtcbiAgICAgICAgICAgICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLXByZXYnKS5jc3MoJ29wYWNpdHknLCAnMScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAodGhpcy5jdXJyZW50SW1hZ2VJbmRleCA8IHRoaXMuYWxidW0ubGVuZ3RoIC0gMSkge1xuICAgICAgICAgICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLW5leHQnKS5zaG93KCk7XG4gICAgICAgICAgICBpZiAoYWx3YXlzU2hvd05hdikge1xuICAgICAgICAgICAgICB0aGlzLiRsaWdodGJveC5maW5kKCcubGItbmV4dCcpLmNzcygnb3BhY2l0eScsICcxJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8vIERpc3BsYXkgY2FwdGlvbiwgaW1hZ2UgbnVtYmVyLCBhbmQgY2xvc2luZyBidXR0b24uXG4gICAgTGlnaHRib3gucHJvdG90eXBlLnVwZGF0ZURldGFpbHMgPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcztcblxuICAgICAgLy8gRW5hYmxlIGFuY2hvciBjbGlja3MgaW4gdGhlIGluamVjdGVkIGNhcHRpb24gaHRtbC5cbiAgICAgIC8vIFRoYW5rcyBOYXRlIFdyaWdodCBmb3IgdGhlIGZpeC4gQGh0dHBzOi8vZ2l0aHViLmNvbS9OYXRlV3JcbiAgICAgIGlmICh0eXBlb2YgdGhpcy5hbGJ1bVt0aGlzLmN1cnJlbnRJbWFnZUluZGV4XS50aXRsZSAhPT0gJ3VuZGVmaW5lZCcgJiYgdGhpcy5hbGJ1bVt0aGlzLmN1cnJlbnRJbWFnZUluZGV4XS50aXRsZSAhPT0gXCJcIikge1xuICAgICAgICB0aGlzLiRsaWdodGJveC5maW5kKCcubGItY2FwdGlvbicpXG4gICAgICAgICAgLmh0bWwodGhpcy5hbGJ1bVt0aGlzLmN1cnJlbnRJbWFnZUluZGV4XS50aXRsZSlcbiAgICAgICAgICAuZmFkZUluKCdmYXN0JylcbiAgICAgICAgICAuZmluZCgnYScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KXtcbiAgICAgICAgICAgIGxvY2F0aW9uLmhyZWYgPSAkKHRoaXMpLmF0dHIoJ2hyZWYnKTtcbiAgICAgICAgICB9KTtcbiAgICAgIH1cbiAgICBcbiAgICAgIGlmICh0aGlzLmFsYnVtLmxlbmd0aCA+IDEgJiYgdGhpcy5vcHRpb25zLnNob3dJbWFnZU51bWJlckxhYmVsKSB7XG4gICAgICAgIHRoaXMuJGxpZ2h0Ym94LmZpbmQoJy5sYi1udW1iZXInKS50ZXh0KHRoaXMub3B0aW9ucy5hbGJ1bUxhYmVsKHRoaXMuY3VycmVudEltYWdlSW5kZXggKyAxLCB0aGlzLmFsYnVtLmxlbmd0aCkpLmZhZGVJbignZmFzdCcpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLW51bWJlcicpLmhpZGUoKTtcbiAgICAgIH1cbiAgICBcbiAgICAgIHRoaXMuJG91dGVyQ29udGFpbmVyLnJlbW92ZUNsYXNzKCdhbmltYXRpbmcnKTtcbiAgICBcbiAgICAgIHRoaXMuJGxpZ2h0Ym94LmZpbmQoJy5sYi1kYXRhQ29udGFpbmVyJykuZmFkZUluKHRoaXMub3B0aW9ucy5yZXNpemVEdXJhdGlvbiwgZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBzZWxmLnNpemVPdmVybGF5KCk7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgLy8gUHJlbG9hZCBwcmV2aW91cyBhbmQgbmV4dCBpbWFnZXMgaW4gc2V0LlxuICAgIExpZ2h0Ym94LnByb3RvdHlwZS5wcmVsb2FkTmVpZ2hib3JpbmdJbWFnZXMgPSBmdW5jdGlvbigpIHtcbiAgICAgIGlmICh0aGlzLmFsYnVtLmxlbmd0aCA+IHRoaXMuY3VycmVudEltYWdlSW5kZXggKyAxKSB7XG4gICAgICAgIHZhciBwcmVsb2FkTmV4dCA9IG5ldyBJbWFnZSgpO1xuICAgICAgICBwcmVsb2FkTmV4dC5zcmMgPSB0aGlzLmFsYnVtW3RoaXMuY3VycmVudEltYWdlSW5kZXggKyAxXS5saW5rO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMuY3VycmVudEltYWdlSW5kZXggPiAwKSB7XG4gICAgICAgIHZhciBwcmVsb2FkUHJldiA9IG5ldyBJbWFnZSgpO1xuICAgICAgICBwcmVsb2FkUHJldi5zcmMgPSB0aGlzLmFsYnVtW3RoaXMuY3VycmVudEltYWdlSW5kZXggLSAxXS5saW5rO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBMaWdodGJveC5wcm90b3R5cGUuZW5hYmxlS2V5Ym9hcmROYXYgPSBmdW5jdGlvbigpIHtcbiAgICAgICQoZG9jdW1lbnQpLm9uKCdrZXl1cC5rZXlib2FyZCcsICQucHJveHkodGhpcy5rZXlib2FyZEFjdGlvbiwgdGhpcykpO1xuICAgIH07XG5cbiAgICBMaWdodGJveC5wcm90b3R5cGUuZGlzYWJsZUtleWJvYXJkTmF2ID0gZnVuY3Rpb24oKSB7XG4gICAgICAkKGRvY3VtZW50KS5vZmYoJy5rZXlib2FyZCcpO1xuICAgIH07XG5cbiAgICBMaWdodGJveC5wcm90b3R5cGUua2V5Ym9hcmRBY3Rpb24gPSBmdW5jdGlvbihldmVudCkge1xuICAgICAgdmFyIEtFWUNPREVfRVNDICAgICAgICA9IDI3O1xuICAgICAgdmFyIEtFWUNPREVfTEVGVEFSUk9XICA9IDM3O1xuICAgICAgdmFyIEtFWUNPREVfUklHSFRBUlJPVyA9IDM5O1xuXG4gICAgICB2YXIga2V5Y29kZSA9IGV2ZW50LmtleUNvZGU7XG4gICAgICB2YXIga2V5ICAgICA9IFN0cmluZy5mcm9tQ2hhckNvZGUoa2V5Y29kZSkudG9Mb3dlckNhc2UoKTtcbiAgICAgIGlmIChrZXljb2RlID09PSBLRVlDT0RFX0VTQyB8fCBrZXkubWF0Y2goL3h8b3xjLykpIHtcbiAgICAgICAgdGhpcy5lbmQoKTtcbiAgICAgIH0gZWxzZSBpZiAoa2V5ID09PSAncCcgfHwga2V5Y29kZSA9PT0gS0VZQ09ERV9MRUZUQVJST1cpIHtcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudEltYWdlSW5kZXggIT09IDApIHtcbiAgICAgICAgICB0aGlzLmNoYW5nZUltYWdlKHRoaXMuY3VycmVudEltYWdlSW5kZXggLSAxKTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbnMud3JhcEFyb3VuZCAmJiB0aGlzLmFsYnVtLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICB0aGlzLmNoYW5nZUltYWdlKHRoaXMuYWxidW0ubGVuZ3RoIC0gMSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAoa2V5ID09PSAnbicgfHwga2V5Y29kZSA9PT0gS0VZQ09ERV9SSUdIVEFSUk9XKSB7XG4gICAgICAgIGlmICh0aGlzLmN1cnJlbnRJbWFnZUluZGV4ICE9PSB0aGlzLmFsYnVtLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICB0aGlzLmNoYW5nZUltYWdlKHRoaXMuY3VycmVudEltYWdlSW5kZXggKyAxKTtcbiAgICAgICAgfSBlbHNlIGlmICh0aGlzLm9wdGlvbnMud3JhcEFyb3VuZCAmJiB0aGlzLmFsYnVtLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICB0aGlzLmNoYW5nZUltYWdlKDApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfTtcblxuICAgIC8vIENsb3NpbmcgdGltZS4gOi0oXG4gICAgTGlnaHRib3gucHJvdG90eXBlLmVuZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5kaXNhYmxlS2V5Ym9hcmROYXYoKTtcbiAgICAgICQod2luZG93KS5vZmYoXCJyZXNpemVcIiwgdGhpcy5zaXplT3ZlcmxheSk7XG4gICAgICB0aGlzLiRsaWdodGJveC5mYWRlT3V0KHRoaXMub3B0aW9ucy5mYWRlRHVyYXRpb24pO1xuICAgICAgdGhpcy4kb3ZlcmxheS5mYWRlT3V0KHRoaXMub3B0aW9ucy5mYWRlRHVyYXRpb24pO1xuICAgICAgJCgnc2VsZWN0LCBvYmplY3QsIGVtYmVkJykuY3NzKHtcbiAgICAgICAgdmlzaWJpbGl0eTogXCJ2aXNpYmxlXCJcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICByZXR1cm4gTGlnaHRib3g7XG5cbiAgfSkoKTtcblxuICAkKGZ1bmN0aW9uKCkge1xuICAgIHZhciBvcHRpb25zICA9IG5ldyBMaWdodGJveE9wdGlvbnMoKTtcbiAgICB2YXIgbGlnaHRib3ggPSBuZXcgTGlnaHRib3gob3B0aW9ucyk7XG4gIH0pO1xuXG59KS5jYWxsKHRoaXMpO1xuIiwiLyohXG4gKiBtb25leS5qcyAvIGZ4KCkgdjAuMlxuICogQ29weXJpZ2h0IDIwMTQgT3BlbiBFeGNoYW5nZSBSYXRlc1xuICpcbiAqIEphdmFTY3JpcHQgbGlicmFyeSBmb3IgcmVhbHRpbWUgY3VycmVuY3kgY29udmVyc2lvbiBhbmQgZXhjaGFuZ2UgcmF0ZSBjYWxjdWxhdGlvbi5cbiAqXG4gKiBGcmVlbHkgZGlzdHJpYnV0YWJsZSB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuXG4gKiBQb3J0aW9ucyBvZiBtb25leS5qcyBhcmUgaW5zcGlyZWQgYnkgb3IgYm9ycm93ZWQgZnJvbSB1bmRlcnNjb3JlLmpzXG4gKlxuICogRm9yIGRldGFpbHMsIGV4YW1wbGVzIGFuZCBkb2N1bWVudGF0aW9uOlxuICogaHR0cDovL29wZW5leGNoYW5nZXJhdGVzLmdpdGh1Yi5pby9tb25leS5qcy9cbiAqL1xuKGZ1bmN0aW9uKHJvb3QsIHVuZGVmaW5lZCkge1xuXG5cdC8vIENyZWF0ZSBhIHNhZmUgcmVmZXJlbmNlIHRvIHRoZSBtb25leS5qcyBvYmplY3QgZm9yIHVzZSBiZWxvdy5cblx0dmFyIGZ4ID0gZnVuY3Rpb24ob2JqKSB7XG5cdFx0cmV0dXJuIG5ldyBmeFdyYXBwZXIob2JqKTtcblx0fTtcblxuXHQvLyBDdXJyZW50IHZlcnNpb24uXG5cdGZ4LnZlcnNpb24gPSAnMC4yJztcblxuXG5cdC8qIC0tLSBTZXR1cCAtLS0gKi9cblxuXHQvLyBmeFNldHVwIGNhbiBiZSBkZWZpbmVkIGJlZm9yZSBsb2FkaW5nIG1vbmV5LmpzLCB0byBzZXQgdGhlIGV4Y2hhbmdlIHJhdGVzIGFuZCB0aGUgYmFzZVxuXHQvLyAoYW5kIGRlZmF1bHQgZnJvbS90bykgY3VycmVuY2llcyAtIG9yIHRoZSByYXRlcyBjYW4gYmUgbG9hZGVkIGluIGxhdGVyIGlmIG5lZWRlZC5cblx0dmFyIGZ4U2V0dXAgPSByb290LmZ4U2V0dXAgfHwge1xuXHRcdHJhdGVzIDoge30sXG5cdFx0YmFzZSA6IFwiXCJcblx0fTtcblxuXHQvLyBPYmplY3QgY29udGFpbmluZyBleGNoYW5nZSByYXRlcyByZWxhdGl2ZSB0byB0aGUgZnguYmFzZSBjdXJyZW5jeSwgZWcgeyBcIkdCUFwiIDogXCIwLjY0XCIgfVxuXHRmeC5yYXRlcyA9IGZ4U2V0dXAucmF0ZXM7XG5cblx0Ly8gRGVmYXVsdCBleGNoYW5nZSByYXRlIGJhc2UgY3VycmVuY3kgKGVnIFwiVVNEXCIpLCB3aGljaCBhbGwgdGhlIGV4Y2hhbmdlIHJhdGVzIGFyZSByZWxhdGl2ZSB0b1xuXHRmeC5iYXNlID0gZnhTZXR1cC5iYXNlO1xuXG5cdC8vIERlZmF1bHQgZnJvbSAvIHRvIGN1cnJlbmNpZXMgZm9yIGNvbnZlcnNpb24gdmlhIGZ4LmNvbnZlcnQoKTpcblx0Znguc2V0dGluZ3MgPSB7XG5cdFx0ZnJvbSA6IGZ4U2V0dXAuZnJvbSB8fCBmeC5iYXNlLFxuXHRcdHRvIDogZnhTZXR1cC50byB8fCBmeC5iYXNlXG5cdH07XG5cblxuXHQvKiAtLS0gQ29udmVyc2lvbiAtLS0gKi9cblxuXHQvLyBUaGUgYmFzZSBmdW5jdGlvbiBvZiB0aGUgbGlicmFyeTogY29udmVydHMgYSB2YWx1ZSBmcm9tIG9uZSBjdXJyZW5jeSB0byBhbm90aGVyXG5cdHZhciBjb252ZXJ0ID0gZnguY29udmVydCA9IGZ1bmN0aW9uKHZhbCwgb3B0cykge1xuXHRcdC8vIENvbnZlcnQgYXJyYXlzIHJlY3Vyc2l2ZWx5XG5cdFx0aWYgKHR5cGVvZiB2YWwgPT09ICdvYmplY3QnICYmIHZhbC5sZW5ndGgpIHtcblx0XHRcdGZvciAodmFyIGkgPSAwOyBpPCB2YWwubGVuZ3RoOyBpKysgKSB7XG5cdFx0XHRcdHZhbFtpXSA9IGNvbnZlcnQodmFsW2ldLCBvcHRzKTtcblx0XHRcdH1cblx0XHRcdHJldHVybiB2YWw7XG5cdFx0fVxuXG5cdFx0Ly8gTWFrZSBzdXJlIHdlIGdvdHMgc29tZSBvcHRzXG5cdFx0b3B0cyA9IG9wdHMgfHwge307XG5cblx0XHQvLyBXZSBuZWVkIHRvIGtub3cgdGhlIGBmcm9tYCBhbmQgYHRvYCBjdXJyZW5jaWVzXG5cdFx0aWYoICFvcHRzLmZyb20gKSBvcHRzLmZyb20gPSBmeC5zZXR0aW5ncy5mcm9tO1xuXHRcdGlmKCAhb3B0cy50byApIG9wdHMudG8gPSBmeC5zZXR0aW5ncy50bztcblxuXHRcdC8vIE11bHRpcGxlIHRoZSB2YWx1ZSBieSB0aGUgZXhjaGFuZ2UgcmF0ZVxuXHRcdHJldHVybiB2YWwgKiBnZXRSYXRlKCBvcHRzLnRvLCBvcHRzLmZyb20gKTtcblx0fTtcblxuXHQvLyBSZXR1cm5zIHRoZSBleGNoYW5nZSByYXRlIHRvIGB0YXJnZXRgIGN1cnJlbmN5IGZyb20gYGJhc2VgIGN1cnJlbmN5XG5cdHZhciBnZXRSYXRlID0gZnVuY3Rpb24odG8sIGZyb20pIHtcblx0XHQvLyBTYXZlIGJ5dGVzIGluIG1pbmlmaWVkIHZlcnNpb25cblx0XHR2YXIgcmF0ZXMgPSBmeC5yYXRlcztcblxuXHRcdC8vIE1ha2Ugc3VyZSB0aGUgYmFzZSByYXRlIGlzIGluIHRoZSByYXRlcyBvYmplY3Q6XG5cdFx0cmF0ZXNbZnguYmFzZV0gPSAxO1xuXG5cdFx0Ly8gVGhyb3cgYW4gZXJyb3IgaWYgZWl0aGVyIHJhdGUgaXNuJ3QgaW4gdGhlIHJhdGVzIGFycmF5XG5cdFx0aWYgKCAhcmF0ZXNbdG9dIHx8ICFyYXRlc1tmcm9tXSApIHRocm93IFwiZnggZXJyb3JcIjtcblxuXHRcdC8vIElmIGBmcm9tYCBjdXJyZW5jeSA9PT0gZnguYmFzZSwgcmV0dXJuIHRoZSBiYXNpYyBleGNoYW5nZSByYXRlIGZvciB0aGUgYHRvYCBjdXJyZW5jeVxuXHRcdGlmICggZnJvbSA9PT0gZnguYmFzZSApIHtcblx0XHRcdHJldHVybiByYXRlc1t0b107XG5cdFx0fVxuXG5cdFx0Ly8gSWYgYHRvYCBjdXJyZW5jeSA9PT0gZnguYmFzZSwgcmV0dXJuIHRoZSBiYXNpYyBpbnZlcnNlIHJhdGUgb2YgdGhlIGBmcm9tYCBjdXJyZW5jeVxuXHRcdGlmICggdG8gPT09IGZ4LmJhc2UgKSB7XG5cdFx0XHRyZXR1cm4gMSAvIHJhdGVzW2Zyb21dO1xuXHRcdH1cblxuXHRcdC8vIE90aGVyd2lzZSwgcmV0dXJuIHRoZSBgdG9gIHJhdGUgbXVsdGlwbGVkIGJ5IHRoZSBpbnZlcnNlIG9mIHRoZSBgZnJvbWAgcmF0ZSB0byBnZXQgdGhlXG5cdFx0Ly8gcmVsYXRpdmUgZXhjaGFuZ2UgcmF0ZSBiZXR3ZWVuIHRoZSB0d28gY3VycmVuY2llc1xuXHRcdHJldHVybiByYXRlc1t0b10gKiAoMSAvIHJhdGVzW2Zyb21dKTtcblx0fTtcblxuXG5cdC8qIC0tLSBPT1Agd3JhcHBlciBhbmQgY2hhaW5pbmcgLS0tICovXG5cblx0Ly8gSWYgZngodmFsKSBpcyBjYWxsZWQgYXMgYSBmdW5jdGlvbiwgaXQgcmV0dXJucyBhIHdyYXBwZWQgb2JqZWN0IHRoYXQgY2FuIGJlIHVzZWQgT08tc3R5bGVcblx0dmFyIGZ4V3JhcHBlciA9IGZ1bmN0aW9uKHZhbCkge1xuXHRcdC8vIEV4cGVyaW1lbnRhbDogcGFyc2Ugc3RyaW5ncyB0byBwdWxsIG91dCBjdXJyZW5jeSBjb2RlIGFuZCB2YWx1ZTpcblx0XHRpZiAoIHR5cGVvZlx0dmFsID09PSBcInN0cmluZ1wiICkge1xuXHRcdFx0dGhpcy5fdiA9IHBhcnNlRmxvYXQodmFsLnJlcGxhY2UoL1teMC05LS5dL2csIFwiXCIpKTtcblx0XHRcdHRoaXMuX2Z4ID0gdmFsLnJlcGxhY2UoLyhbXkEtWmEtel0pL2csIFwiXCIpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLl92ID0gdmFsO1xuXHRcdH1cblx0fTtcblxuXHQvLyBFeHBvc2UgYHdyYXBwZXIucHJvdG90eXBlYCBhcyBgZngucHJvdG90eXBlYFxuXHR2YXIgZnhQcm90byA9IGZ4LnByb3RvdHlwZSA9IGZ4V3JhcHBlci5wcm90b3R5cGU7XG5cblx0Ly8gZngodmFsKS5jb252ZXJ0KG9wdHMpIGRvZXMgdGhlIHNhbWUgdGhpbmcgYXMgZnguY29udmVydCh2YWwsIG9wdHMpXG5cdGZ4UHJvdG8uY29udmVydCA9IGZ1bmN0aW9uKCkge1xuXHRcdHZhciBhcmdzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzKTtcblx0XHRhcmdzLnVuc2hpZnQodGhpcy5fdik7XG5cdFx0cmV0dXJuIGNvbnZlcnQuYXBwbHkoZngsIGFyZ3MpO1xuXHR9O1xuXG5cdC8vIGZ4KHZhbCkuZnJvbShjdXJyZW5jeSkgcmV0dXJucyBhIHdyYXBwZWQgYGZ4YCB3aGVyZSB0aGUgdmFsdWUgaGFzIGJlZW4gY29udmVydGVkIGZyb21cblx0Ly8gYGN1cnJlbmN5YCB0byB0aGUgYGZ4LmJhc2VgIGN1cnJlbmN5LiBTaG91bGQgYmUgZm9sbG93ZWQgYnkgYC50byhvdGhlckN1cnJlbmN5KWBcblx0ZnhQcm90by5mcm9tID0gZnVuY3Rpb24oY3VycmVuY3kpIHtcblx0XHR2YXIgd3JhcHBlZCA9IGZ4KGNvbnZlcnQodGhpcy5fdiwge2Zyb206IGN1cnJlbmN5LCB0bzogZnguYmFzZX0pKTtcblx0XHR3cmFwcGVkLl9meCA9IGZ4LmJhc2U7XG5cdFx0cmV0dXJuIHdyYXBwZWQ7XG5cdH07XG5cblx0Ly8gZngodmFsKS50byhjdXJyZW5jeSkgcmV0dXJucyB0aGUgdmFsdWUsIGNvbnZlcnRlZCBmcm9tIGBmeC5iYXNlYCB0byBgY3VycmVuY3lgXG5cdGZ4UHJvdG8udG8gPSBmdW5jdGlvbihjdXJyZW5jeSkge1xuXHRcdHJldHVybiBjb252ZXJ0KHRoaXMuX3YsIHtmcm9tOiB0aGlzLl9meCA/IHRoaXMuX2Z4IDogZnguc2V0dGluZ3MuZnJvbSwgdG86IGN1cnJlbmN5fSk7XG5cdH07XG5cblxuXHQvKiAtLS0gTW9kdWxlIERlZmluaXRpb24gLS0tICovXG5cblx0Ly8gRXhwb3J0IHRoZSBmeCBvYmplY3QgZm9yIENvbW1vbkpTLiBJZiBiZWluZyBsb2FkZWQgYXMgYW4gQU1EIG1vZHVsZSwgZGVmaW5lIGl0IGFzIHN1Y2guXG5cdC8vIE90aGVyd2lzZSwganVzdCBhZGQgYGZ4YCB0byB0aGUgZ2xvYmFsIG9iamVjdFxuXHRpZiAodHlwZW9mIGV4cG9ydHMgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0aWYgKHR5cGVvZiBtb2R1bGUgIT09ICd1bmRlZmluZWQnICYmIG1vZHVsZS5leHBvcnRzKSB7XG5cdFx0XHRleHBvcnRzID0gbW9kdWxlLmV4cG9ydHMgPSBmeDtcblx0XHR9XG5cdFx0ZXhwb3J0cy5meCA9IGZ4O1xuXHR9IGVsc2UgaWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xuXHRcdC8vIFJldHVybiB0aGUgbGlicmFyeSBhcyBhbiBBTUQgbW9kdWxlOlxuXHRcdGRlZmluZShbXSwgZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gZng7XG5cdFx0fSk7XG5cdH0gZWxzZSB7XG5cdFx0Ly8gVXNlIGZ4Lm5vQ29uZmxpY3QgdG8gcmVzdG9yZSBgZnhgIGJhY2sgdG8gaXRzIG9yaWdpbmFsIHZhbHVlIGJlZm9yZSBtb25leS5qcyBsb2FkZWQuXG5cdFx0Ly8gUmV0dXJucyBhIHJlZmVyZW5jZSB0byB0aGUgbGlicmFyeSdzIGBmeGAgb2JqZWN0OyBlLmcuIGB2YXIgbW9uZXkgPSBmeC5ub0NvbmZsaWN0KCk7YFxuXHRcdGZ4Lm5vQ29uZmxpY3QgPSAoZnVuY3Rpb24ocHJldmlvdXNGeCkge1xuXHRcdFx0cmV0dXJuIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHQvLyBSZXNldCB0aGUgdmFsdWUgb2YgdGhlIHJvb3QncyBgZnhgIHZhcmlhYmxlOlxuXHRcdFx0XHRyb290LmZ4ID0gcHJldmlvdXNGeDtcblx0XHRcdFx0Ly8gRGVsZXRlIHRoZSBub0NvbmZsaWN0IGZ1bmN0aW9uOlxuXHRcdFx0XHRmeC5ub0NvbmZsaWN0ID0gdW5kZWZpbmVkO1xuXHRcdFx0XHQvLyBSZXR1cm4gcmVmZXJlbmNlIHRvIHRoZSBsaWJyYXJ5IHRvIHJlLWFzc2lnbiBpdDpcblx0XHRcdFx0cmV0dXJuIGZ4O1xuXHRcdFx0fTtcblx0XHR9KShyb290LmZ4KTtcblxuXHRcdC8vIERlY2xhcmUgYGZ4YCBvbiB0aGUgcm9vdCAoZ2xvYmFsL3dpbmRvdykgb2JqZWN0OlxuXHRcdHJvb3RbJ2Z4J10gPSBmeDtcblx0fVxuXG5cdC8vIFJvb3Qgd2lsbCBiZSBgd2luZG93YCBpbiBicm93c2VyIG9yIGBnbG9iYWxgIG9uIHRoZSBzZXJ2ZXI6XG59KHRoaXMpKTtcbiIsIi8qPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxyXG4gKiBAbmFtZTogYlBvcHVwXHJcbiAqIEB0eXBlOiBqUXVlcnlcclxuICogQGF1dGhvcjogKGMpIEJqb2VybiBLbGluZ2dhYXJkIC0gQGJrbGluZ2dhYXJkXHJcbiAqIEBkZW1vOiBodHRwOi8vZGluYnJvci5kay9icG9wdXBcclxuICogQHZlcnNpb246IDAuMTAuMFxyXG4gKiBAcmVxdWlyZXMgalF1ZXJ5IDEuNC4zXHJcbiAqPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09Ki9cclxuOyhmdW5jdGlvbigkKSB7XHJcblx0J3VzZSBzdHJpY3QnO1xyXG5cdFxyXG4gICAgJC5mbi5iUG9wdXAgPSBmdW5jdGlvbihvcHRpb25zLCBjYWxsYmFjaykge1xyXG4gICAgICAgIFxyXG4gICAgXHRpZiAoJC5pc0Z1bmN0aW9uKG9wdGlvbnMpKSB7XHJcbiAgICAgICAgICAgIGNhbGxiYWNrIFx0XHQ9IG9wdGlvbnM7XHJcbiAgICAgICAgICAgIG9wdGlvbnMgXHRcdD0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG5cdFx0Ly8gT1BUSU9OU1xyXG4gICAgICAgIHZhciBvIFx0XHRcdFx0PSAkLmV4dGVuZCh7fSwgJC5mbi5iUG9wdXAuZGVmYXVsdHMsIG9wdGlvbnMpO1xyXG5cdFx0XHJcblx0XHQvLyBISURFIFNDUk9MTEJBUj8gIFxyXG4gICAgICAgIGlmICghby5zY3JvbGxCYXIpXHJcbiAgICAgICAgICAgICQoJ2h0bWwnKS5jc3MoJ292ZXJmbG93JywgJ2hpZGRlbicpO1xyXG4gICAgICAgIFxyXG5cdFx0Ly8gVkFSSUFCTEVTXHRcclxuICAgICAgICB2YXIgJHBvcHVwIFx0XHRcdD0gdGhpc1xyXG4gICAgICAgICAgLCAgJHRoaXMgICAgICAgICAgICAgICAgICAgICAgID0gJCh0aGlzKVxyXG4gICAgICAgICAgLCBkIFx0XHRcdFx0PSAkKGRvY3VtZW50KVxyXG4gICAgICAgICAgLCB3IFx0XHRcdFx0PSB3aW5kb3dcclxuXHRcdCAgLCAkd1x0XHRcdFx0PSAkKHcpXHJcbiAgICAgICAgICAsIHdIXHRcdFx0XHQ9IHdpbmRvd0hlaWdodCgpXHJcblx0XHQgICwgd1dcdFx0XHRcdD0gd2luZG93V2lkdGgoKVxyXG4gICAgICAgICAgLCBwcmVmaXhcdFx0XHQ9ICdfX2ItcG9wdXAnXHJcblx0XHQgICwgaXNJT1M2WFx0XHRcdD0gKC9PUyA2KF9cXGQpKy9pKS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpIC8vIFVzZWQgZm9yIGEgdGVtcG9yYXJ5IGZpeCBmb3IgaW9zNiB0aW1lciBidWcgd2hlbiB1c2luZyB6b29tL3Njcm9sbCBcclxuICAgICAgICAgICwgYnVmZmVyXHRcdFx0PSAyMDBcclxuXHRcdCAgLCBwb3B1cHNcdFx0XHQ9IDBcclxuICAgICAgICAgICwgaWRcclxuICAgICAgICAgICwgaW5zaWRlXHJcbiAgICAgICAgICAsIGZpeGVkVlBvc1xyXG4gICAgICAgICAgLCBmaXhlZEhQb3NcclxuICAgICAgICAgICwgZml4ZWRQb3NTdHlsZVxyXG5cdFx0ICAsIHZQb3NcclxuICAgICAgICAgICwgaFBvc1xyXG5cdFx0ICAsIGhlaWdodFxyXG5cdFx0ICAsIHdpZHRoXHJcblx0XHQgICwgZGVib3VuY2VcclxuXHRcdCAgLCBhdXRvQ2xvc2VUT1xyXG5cdFx0O1xyXG5cclxuICAgICAgICAvKiBQVUJMSUMgRlVOQ1RJT04gLSBjYWxsIGl0OiAkKGVsZW1lbnQpLmJQb3B1cCgpLmNsb3NlKCk7Ki9cclxuICAgICAgICAkcG9wdXAuY2xvc2UgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgX2luaXQoKTtcclxuICAgICAgICAgICAgX2Nsb3NlKCk7XHJcbiAgICAgICAgfTtcclxuXHRcdFxyXG4gICAgICAgICRwb3B1cC5yZXBvc2l0aW9uID0gZnVuY3Rpb24oYW5pbWF0ZVNwZWVkKSB7XHJcbiAgICAgICAgICAgIHJlcG9zaXRpb24oYW5pbWF0ZVNwZWVkKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4gJHBvcHVwLmVhY2goZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmICgkKHRoaXMpLmRhdGEoJ2JQb3B1cCcpKSByZXR1cm47IC8qUE9QVVAgYWxyZWFkeSBleGlzdHM/Ki9cclxuICAgICAgICAgICAgaW5pdCgpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBfaW5pdCgpIHtcclxuICAgICAgICAgICAgdHJpZ2dlckNhbGwoby5vbk9wZW4pO1xyXG5cdFx0XHRwb3B1cHMgPSAoJHcuZGF0YSgnYlBvcHVwJykgfHwgMCksIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZCA9IHByZWZpeCArIHBvcHVwcyArICdfXycsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpeGVkVlBvcyA9IG8ucG9zaXRpb25bMV0gIT09ICdhdXRvJywgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpeGVkSFBvcyA9IG8ucG9zaXRpb25bMF0gIT09ICdhdXRvJywgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpeGVkUG9zU3R5bGUgPSBvLnBvc2l0aW9uU3R5bGUgPT09ICdmaXhlZCcsIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBoZWlnaHQgPSAkcG9wdXAub3V0ZXJIZWlnaHQodHJ1ZSksIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aWR0aCA9ICRwb3B1cC5vdXRlcldpZHRoKHRydWUpO1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIG8ubG9hZFVybCA/IGNyZWF0ZUNvbnRlbnQoKSA6IG9wZW4oKTtcclxuICAgICAgICB9O1xyXG4gICAgICAgIFxyXG4gICAgICAgIGZ1bmN0aW9uIF9jbG9zZSgpIHtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIGFsZXJ0KGlkLCAkcG9wdXAuZGF0YSgnaWQnKSwgJHBvcHVwLmRhdGEoJ2JQb3B1cCcpKTtcclxuICAgICAgICAgICAgaWYgKG8ubW9kYWwpIHtcclxuICAgICAgICAgICAgICAgICQoJy5iLW1vZGFsLicraWQpXHJcblx0ICAgICAgICAgICAgICAgIC5mYWRlVG8oby5zcGVlZCwgMCwgZnVuY3Rpb24oKSB7XHJcblx0ICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZSgpO1xyXG5cdCAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBDbGVhbiB1cFxyXG4gICAgICAgICAgICB1bmJpbmRFdmVudHMoKTtcdFxyXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQoYXV0b0Nsb3NlVE8pO1xyXG4gICAgICAgICAgICAvLyBDbG9zZSB0cmFzaXRpb25cclxuICAgICAgICAgICAgZG9UcmFuc2l0aW9uKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7IC8vIFByZXZlbnQgZGVmYXVsdFxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIC8qIEhFTFBFUiBGVU5DVElPTlMgLSBQUklWQVRFKi9cclxuICAgICAgICBmdW5jdGlvbiBpbml0KCkge1xyXG4gICAgICAgICAgICB0cmlnZ2VyQ2FsbChvLm9uT3Blbik7XHJcblx0XHRcdHBvcHVwcyA9ICgkdy5kYXRhKCdiUG9wdXAnKSB8fCAwKSArIDEsIGlkID0gcHJlZml4ICsgcG9wdXBzICsgJ19fJyxmaXhlZFZQb3MgPSBvLnBvc2l0aW9uWzFdICE9PSAnYXV0bycsIGZpeGVkSFBvcyA9IG8ucG9zaXRpb25bMF0gIT09ICdhdXRvJywgZml4ZWRQb3NTdHlsZSA9IG8ucG9zaXRpb25TdHlsZSA9PT0gJ2ZpeGVkJywgaGVpZ2h0ID0gJHBvcHVwLm91dGVySGVpZ2h0KHRydWUpLCB3aWR0aCA9ICRwb3B1cC5vdXRlcldpZHRoKHRydWUpO1xyXG4gICAgICAgICAgICBvLmxvYWRVcmwgPyBjcmVhdGVDb250ZW50KCkgOiBvcGVuKCk7XHJcbiAgICAgICAgfTtcclxuXHRcdFxyXG5cdFx0ZnVuY3Rpb24gY3JlYXRlQ29udGVudCgpIHtcclxuICAgICAgICAgICAgby5jb250ZW50Q29udGFpbmVyID0gJChvLmNvbnRlbnRDb250YWluZXIgfHwgJHBvcHVwKTtcclxuICAgICAgICAgICAgc3dpdGNoIChvLmNvbnRlbnQpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgKCdpZnJhbWUnKTpcclxuXHRcdFx0XHRcdHZhciBpZnJhbWUgPSAkKCc8aWZyYW1lIGNsYXNzPVwiYi1pZnJhbWVcIiAnICsgby5pZnJhbWVBdHRyICsnPjwvaWZyYW1lPicpO1xyXG5cdFx0XHRcdFx0aWZyYW1lLmFwcGVuZFRvKG8uY29udGVudENvbnRhaW5lcik7XHJcblx0XHRcdFx0XHRoZWlnaHQgPSAkcG9wdXAub3V0ZXJIZWlnaHQodHJ1ZSk7XHJcblx0XHRcdFx0XHR3aWR0aCA9ICRwb3B1cC5vdXRlcldpZHRoKHRydWUpO1xyXG5cdFx0XHRcdFx0b3BlbigpO1xyXG5cdFx0XHRcdFx0aWZyYW1lLmF0dHIoJ3NyYycsIG8ubG9hZFVybCk7IC8vIHNldHRpbmcgaWZyYW1lIHNyYyBhZnRlciBvcGVuIGR1ZSBJRTkgYnVnXHJcblx0XHRcdFx0XHR0cmlnZ2VyQ2FsbChvLmxvYWRDYWxsYmFjayk7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcblx0XHRcdFx0Y2FzZSAoJ2ltYWdlJyk6XHJcblx0XHRcdFx0XHRvcGVuKCk7XHJcblx0XHRcdFx0XHQkKCc8aW1nIC8+JylcclxuXHRcdFx0XHRcdFx0LmxvYWQoZnVuY3Rpb24oKSB7XHJcblx0XHRcdFx0XHRcdCAgICB0cmlnZ2VyQ2FsbChvLmxvYWRDYWxsYmFjayk7XHJcblx0XHRcdFx0XHRcdFx0cmVjZW50ZXIoJCh0aGlzKSk7XHJcblx0XHRcdFx0XHQgICAgfSkuYXR0cignc3JjJywgby5sb2FkVXJsKS5oaWRlKCkuYXBwZW5kVG8oby5jb250ZW50Q29udGFpbmVyKTtcclxuXHRcdFx0XHRcdGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgZGVmYXVsdDpcclxuXHRcdFx0XHRcdG9wZW4oKTtcclxuXHRcdFx0XHRcdCQoJzxkaXYgY2xhc3M9XCJiLWFqYXgtd3JhcHBlclwiPjwvZGl2PicpXHJcbiAgICAgICAgICAgICAgICAgICAgXHQubG9hZChvLmxvYWRVcmwsIG8ubG9hZERhdGEsIGZ1bmN0aW9uKHJlc3BvbnNlLCBzdGF0dXMsIHhocikge1xyXG5cdFx0XHRcdFx0XHQgICAgdHJpZ2dlckNhbGwoby5sb2FkQ2FsbGJhY2ssIHN0YXR1cyk7XHJcblx0XHRcdFx0XHRcdFx0cmVjZW50ZXIoJCh0aGlzKSk7XHJcblx0XHRcdFx0XHRcdH0pLmhpZGUoKS5hcHBlbmRUbyhvLmNvbnRlbnRDb250YWluZXIpO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcblx0XHRmdW5jdGlvbiBvcGVuKCl7XHJcblx0XHRcdC8vIE1PREFMIE9WRVJMQVlcclxuICAgICAgICAgICAgaWYgKG8ubW9kYWwpIHtcclxuICAgICAgICAgICAgICAgICQoJzxkaXYgY2xhc3M9XCJiLW1vZGFsICcraWQrJ1wiPjwvZGl2PicpXHJcbiAgICAgICAgICAgICAgICAuY3NzKHtiYWNrZ3JvdW5kQ29sb3I6IG8ubW9kYWxDb2xvciwgcG9zaXRpb246ICdmaXhlZCcsIHRvcDogMCwgcmlnaHQ6MCwgYm90dG9tOjAsIGxlZnQ6IDAsIG9wYWNpdHk6IDAsIHpJbmRleDogby56SW5kZXggKyBwb3B1cHN9KVxyXG4gICAgICAgICAgICAgICAgLmFwcGVuZFRvKG8uYXBwZW5kVG8pXHJcbiAgICAgICAgICAgICAgICAuZmFkZVRvKG8uc3BlZWQsIG8ub3BhY2l0eSk7XHJcbiAgICAgICAgICAgIH1cclxuXHRcdFx0XHJcblx0XHRcdC8vIFBPUFVQXHJcblx0XHRcdGNhbGNQb3NpdGlvbigpO1xyXG4gICAgICAgICAgICAkcG9wdXBcclxuXHRcdFx0XHQuZGF0YSgnYlBvcHVwJywgbykuZGF0YSgnaWQnLGlkKVxyXG5cdFx0XHRcdC5jc3MoeyBcclxuXHRcdFx0XHRcdCAgJ2xlZnQnOiBvLnRyYW5zaXRpb24gPT0gJ3NsaWRlSW4nIHx8IG8udHJhbnNpdGlvbiA9PSAnc2xpZGVCYWNrJyA/IChvLnRyYW5zaXRpb24gPT0gJ3NsaWRlQmFjaycgPyBkLnNjcm9sbExlZnQoKSArIHdXIDogKGhQb3MgKyB3aWR0aCkgKi0xKSA6IGdldExlZnRQb3MoISghby5mb2xsb3dbMF0gJiYgZml4ZWRIUG9zIHx8IGZpeGVkUG9zU3R5bGUpKVxyXG5cdFx0XHRcdFx0LCAncG9zaXRpb24nOiBvLnBvc2l0aW9uU3R5bGUgfHwgJ2Fic29sdXRlJ1xyXG5cdFx0XHRcdFx0LCAndG9wJzogby50cmFuc2l0aW9uID09ICdzbGlkZURvd24nIHx8IG8udHJhbnNpdGlvbiA9PSAnc2xpZGVVcCcgPyAoby50cmFuc2l0aW9uID09ICdzbGlkZVVwJyA/IGQuc2Nyb2xsVG9wKCkgKyB3SCA6IHZQb3MgKyBoZWlnaHQgKiAtMSkgOiBnZXRUb3BQb3MoISghby5mb2xsb3dbMV0gJiYgZml4ZWRWUG9zIHx8IGZpeGVkUG9zU3R5bGUpKVxyXG5cdFx0XHRcdFx0LCAnei1pbmRleCc6IG8uekluZGV4ICsgcG9wdXBzICsgMSBcclxuXHRcdFx0XHR9KS5lYWNoKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBcdFx0aWYoby5hcHBlbmRpbmcpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmFwcGVuZFRvKG8uYXBwZW5kVG8pO1xyXG4gICAgICAgICAgICBcdFx0fVxyXG4gICAgICAgIFx0XHR9KTtcclxuXHRcdFx0ZG9UcmFuc2l0aW9uKHRydWUpO1x0XHJcblx0XHR9O1xyXG5cdFx0XHJcbiAgICAgICAgZnVuY3Rpb24gY2xvc2UoKSB7XHJcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGlkLCAkcG9wdXAuZGF0YSgnaWQnKSwgJHBvcHVwLmRhdGEoJ2JQb3B1cCcpKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIC8vIGFsZXJ0KGlkLCAkcG9wdXAuZGF0YSgnaWQnKSwgJHBvcHVwLmRhdGEoJ2JQb3B1cCcpKTtcclxuICAgICAgICAgICAgaWYgKG8ubW9kYWwpIHtcclxuICAgICAgICAgICAgICAgICQoJy5iLW1vZGFsLicrJHBvcHVwLmRhdGEoJ2lkJykpXHJcblx0ICAgICAgICAgICAgICAgIC5mYWRlVG8oby5zcGVlZCwgMCwgZnVuY3Rpb24oKSB7XHJcblx0ICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZSgpO1xyXG5cdCAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBDbGVhbiB1cFxyXG4gICAgICAgICAgICB1bmJpbmRFdmVudHMoKTtcdFxyXG4gICAgICAgICAgICBjbGVhclRpbWVvdXQoYXV0b0Nsb3NlVE8pO1xyXG4gICAgICAgICAgICAvLyBDbG9zZSB0cmFzaXRpb25cclxuICAgICAgICAgICAgZG9UcmFuc2l0aW9uKCk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7IC8vIFByZXZlbnQgZGVmYXVsdFxyXG4gICAgICAgIH07XHJcblx0XHRcclxuXHRcdGZ1bmN0aW9uIHJlcG9zaXRpb24oYW5pbWF0ZVNwZWVkKXtcclxuICAgICAgICAgICAgd0ggPSB3aW5kb3dIZWlnaHQoKTtcclxuICBcdFx0ICAgIHdXID0gd2luZG93V2lkdGgoKTtcclxuXHRcdFx0aW5zaWRlID0gaW5zaWRlV2luZG93KCk7XHJcbiAgICAgICAgICAgXHRpZihpbnNpZGUpe1xyXG5cdFx0XHRcdGNsZWFyVGltZW91dChkZWJvdW5jZSk7XHJcblx0XHRcdFx0ZGVib3VuY2UgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7XHJcblx0XHRcdFx0XHRjYWxjUG9zaXRpb24oKTtcclxuXHRcdFx0XHRcdGFuaW1hdGVTcGVlZCA9IGFuaW1hdGVTcGVlZCB8fCBvLmZvbGxvd1NwZWVkO1xyXG5cdFx0XHRcdFx0JHBvcHVwXHJcbiAgICAgICAgICAgICAgICAgICAgICAgXHQuZGVxdWV1ZSgpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgXHQuZWFjaChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgXHRpZihmaXhlZFBvc1N0eWxlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBcdCQodGhpcykuY3NzKHsgJ2xlZnQnOiBoUG9zLCAndG9wJzogdlBvcyB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgXHR9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIFx0ZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcdCQodGhpcykuYW5pbWF0ZSh7ICdsZWZ0Jzogby5mb2xsb3dbMF0gPyBnZXRMZWZ0UG9zKHRydWUpIDogJ2F1dG8nLCAndG9wJzogby5mb2xsb3dbMV0gPyBnZXRUb3BQb3ModHJ1ZSkgOiAnYXV0bycgfSwgYW5pbWF0ZVNwZWVkLCBvLmZvbGxvd0Vhc2luZyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgIFx0fVxyXG4gICAgICAgICAgICAgICAgICAgICAgIFx0fSk7XHJcblx0XHRcdFx0fSwgNTApO1x0XHRcdFx0XHRcclxuICAgICAgICAgICBcdH1cclxuXHRcdH07XHJcblx0XHRcclxuXHRcdC8vRWtzcGVyaW1lbnRhbFxyXG5cdFx0ZnVuY3Rpb24gcmVjZW50ZXIoY29udGVudCl7XHJcblx0XHRcdHZhciBfd2lkdGggPSBjb250ZW50LndpZHRoKCksIF9oZWlnaHQgPSBjb250ZW50LmhlaWdodCgpLCBjc3MgPSB7fTtcclxuXHRcdFx0by5jb250ZW50Q29udGFpbmVyLmNzcyh7aGVpZ2h0Ol9oZWlnaHQsd2lkdGg6X3dpZHRofSk7XHJcblx0XHRcdFxyXG5cdFx0XHRpZiAoX2hlaWdodCA+PSAkcG9wdXAuaGVpZ2h0KCkpe1xyXG5cdFx0XHRcdGNzcy5oZWlnaHQgPSAkcG9wdXAuaGVpZ2h0KCk7XHJcblx0XHRcdH1cclxuXHRcdFx0aWYoX3dpZHRoID49ICRwb3B1cC53aWR0aCgpKXtcclxuXHRcdFx0XHRjc3Mud2lkdGggPSAkcG9wdXAud2lkdGgoKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRoZWlnaHQgPSAkcG9wdXAub3V0ZXJIZWlnaHQodHJ1ZSlcclxuXHRcdFx0LCB3aWR0aCA9ICRwb3B1cC5vdXRlcldpZHRoKHRydWUpO1xyXG5cdFx0XHRcdFxyXG5cdFx0XHRjYWxjUG9zaXRpb24oKTtcclxuXHRcdFx0by5jb250ZW50Q29udGFpbmVyLmNzcyh7aGVpZ2h0OidhdXRvJyx3aWR0aDonYXV0byd9KTtcdFx0XHJcblx0XHRcdFxyXG5cdFx0XHRjc3MubGVmdCA9IGdldExlZnRQb3MoISghby5mb2xsb3dbMF0gJiYgZml4ZWRIUG9zIHx8IGZpeGVkUG9zU3R5bGUpKSxcclxuXHRcdFx0Y3NzLnRvcCA9IGdldFRvcFBvcyghKCFvLmZvbGxvd1sxXSAmJiBmaXhlZFZQb3MgfHwgZml4ZWRQb3NTdHlsZSkpO1xyXG5cdFx0XHRcclxuXHRcdFx0JHBvcHVwXHJcblx0XHRcdFx0LmFuaW1hdGUoXHJcblx0XHRcdFx0XHRjc3NcclxuXHRcdFx0XHRcdCwgMjUwXHJcblx0XHRcdFx0XHQsIGZ1bmN0aW9uKCkgeyBcclxuXHRcdFx0XHRcdFx0Y29udGVudC5zaG93KCk7XHJcblx0XHRcdFx0XHRcdGluc2lkZSA9IGluc2lkZVdpbmRvdygpO1xyXG5cdFx0XHRcdFx0fVxyXG5cdFx0XHRcdCk7XHJcblx0XHR9O1xyXG5cdFx0XHJcbiAgICAgICAgZnVuY3Rpb24gYmluZEV2ZW50cygpIHtcclxuICAgICAgICAgICAgJHcuZGF0YSgnYlBvcHVwJywgcG9wdXBzKTtcclxuXHRcdFx0JHBvcHVwLmRlbGVnYXRlKCcuYkNsb3NlLCAuJyArIG8uY2xvc2VDbGFzcywgJ2NsaWNrLicraWQsIGNsb3NlKTsgLy8gbGVnYWN5LCBzdGlsbCBzdXBwb3J0aW5nIHRoZSBjbG9zZSBjbGFzcyBiQ2xvc2VcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGlmIChvLm1vZGFsQ2xvc2UpIHtcclxuICAgICAgICAgICAgICAgICQoJy5iLW1vZGFsLicraWQpLmNzcygnY3Vyc29yJywgJ3BvaW50ZXInKS5iaW5kKCdjbGljaycsIGNsb3NlKTtcclxuICAgICAgICAgICAgfVxyXG5cdFx0XHRcclxuXHRcdFx0Ly8gVGVtcG9yYXJ5IGRpc2FibGluZyBzY3JvbGwvcmVzaXplIGV2ZW50cyBvbiBkZXZpY2VzIHdpdGggSU9TNitcclxuXHRcdFx0Ly8gZHVlIHRvIGEgYnVnIHdoZXJlIGV2ZW50cyBhcmUgZHJvcHBlZCBhZnRlciBwaW5jaCB0byB6b29tXHJcbiAgICAgICAgICAgIGlmICghaXNJT1M2WCAmJiAoby5mb2xsb3dbMF0gfHwgby5mb2xsb3dbMV0pKSB7XHJcbiAgICAgICAgICAgICAgICR3LmJpbmQoJ3Njcm9sbC4nK2lkLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIFx0aWYoaW5zaWRlKXtcclxuICAgICAgICAgICAgICAgICAgICBcdCRwb3B1cFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBcdC5kZXF1ZXVlKClcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5hbmltYXRlKHsgJ2xlZnQnOiBvLmZvbGxvd1swXSA/IGdldExlZnRQb3MoIWZpeGVkUG9zU3R5bGUpIDogJ2F1dG8nLCAndG9wJzogby5mb2xsb3dbMV0gPyBnZXRUb3BQb3MoIWZpeGVkUG9zU3R5bGUpIDogJ2F1dG8nIH0sIG8uZm9sbG93U3BlZWQsIG8uZm9sbG93RWFzaW5nKTtcclxuXHRcdFx0XHRcdCB9ICBcclxuICAgICAgICAgICAgXHR9KS5iaW5kKCdyZXNpemUuJytpZCwgZnVuY3Rpb24oKSB7XHJcblx0XHQgICAgICAgICAgICByZXBvc2l0aW9uKCk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoby5lc2NDbG9zZSkge1xyXG4gICAgICAgICAgICAgICAgZC5iaW5kKCdrZXlkb3duLicraWQsIGZ1bmN0aW9uKGUpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoZS53aGljaCA9PSAyNykgeyAgLy9lc2NhcGVcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2UoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblx0XHRcclxuICAgICAgICBmdW5jdGlvbiB1bmJpbmRFdmVudHMoKSB7XHJcbiAgICAgICAgICAgIGlmICghby5zY3JvbGxCYXIpIHtcclxuICAgICAgICAgICAgICAgICQoJ2h0bWwnKS5jc3MoJ292ZXJmbG93JywgJ2F1dG8nKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAkKCcuYi1tb2RhbC4nK2lkKS51bmJpbmQoJ2NsaWNrJyk7XHJcbiAgICAgICAgICAgIGQudW5iaW5kKCdrZXlkb3duLicraWQpO1xyXG4gICAgICAgICAgICAkdy51bmJpbmQoJy4nK2lkKS5kYXRhKCdiUG9wdXAnLCAoJHcuZGF0YSgnYlBvcHVwJyktMSA+IDApID8gJHcuZGF0YSgnYlBvcHVwJyktMSA6IG51bGwpO1xyXG4gICAgICAgICAgICAkcG9wdXAudW5kZWxlZ2F0ZSgnLmJDbG9zZSwgLicgKyBvLmNsb3NlQ2xhc3MsICdjbGljay4nK2lkLCBjbG9zZSkuZGF0YSgnYlBvcHVwJywgbnVsbCk7XHJcbiAgICAgICAgfTtcclxuXHRcdFxyXG5cdFx0ZnVuY3Rpb24gZG9UcmFuc2l0aW9uKG9wZW4pIHtcclxuXHRcdFx0c3dpdGNoIChvcGVuID8gby50cmFuc2l0aW9uIDogby50cmFuc2l0aW9uQ2xvc2UgfHwgby50cmFuc2l0aW9uKSB7XHJcblx0XHRcdCAgIGNhc2UgXCJzbGlkZUluXCI6XHJcblx0XHRcdFx0ICAgXHRhbmltYXRlKHtcclxuXHRcdFx0XHQgICBcdFx0bGVmdDogb3BlbiA/IGdldExlZnRQb3MoISghby5mb2xsb3dbMF0gJiYgZml4ZWRIUG9zIHx8IGZpeGVkUG9zU3R5bGUpKSA6IGQuc2Nyb2xsTGVmdCgpIC0gKHdpZHRoIHx8ICRwb3B1cC5vdXRlcldpZHRoKHRydWUpKSAtIGJ1ZmZlclxyXG5cdFx0XHRcdCAgIFx0fSk7XHJcblx0XHRcdCAgICAgIFx0YnJlYWs7XHJcblx0XHRcdCAgIGNhc2UgXCJzbGlkZUJhY2tcIjpcclxuXHRcdFx0XHQgICBcdGFuaW1hdGUoe1xyXG5cdFx0XHRcdCAgIFx0XHRsZWZ0OiBvcGVuID8gZ2V0TGVmdFBvcyghKCFvLmZvbGxvd1swXSAmJiBmaXhlZEhQb3MgfHwgZml4ZWRQb3NTdHlsZSkpIDogZC5zY3JvbGxMZWZ0KCkgKyB3VyArIGJ1ZmZlclxyXG5cdFx0XHRcdCAgIFx0fSk7XHJcblx0XHRcdCAgICAgIFx0YnJlYWs7XHJcblx0XHRcdCAgIGNhc2UgXCJzbGlkZURvd25cIjpcclxuXHRcdFx0XHQgICBcdGFuaW1hdGUoe1xyXG5cdFx0XHRcdCAgIFx0XHR0b3A6IG9wZW4gPyBnZXRUb3BQb3MoISghby5mb2xsb3dbMV0gJiYgZml4ZWRWUG9zIHx8IGZpeGVkUG9zU3R5bGUpKSA6IGQuc2Nyb2xsVG9wKCkgLSAoaGVpZ2h0IHx8ICRwb3B1cC5vdXRlckhlaWdodCh0cnVlKSkgLSBidWZmZXJcclxuXHRcdFx0XHQgICBcdH0pO1xyXG5cdFx0XHQgICAgICBcdGJyZWFrO1xyXG5cdFx0ICAgXHRcdGNhc2UgXCJzbGlkZVVwXCI6XHJcblx0XHRcdFx0XHRhbmltYXRlKHtcclxuXHRcdFx0XHRcdFx0dG9wOiBvcGVuID8gZ2V0VG9wUG9zKCEoIW8uZm9sbG93WzFdICYmIGZpeGVkVlBvcyB8fCBmaXhlZFBvc1N0eWxlKSkgOiBkLnNjcm9sbFRvcCgpICsgd0ggKyBidWZmZXJcclxuXHRcdFx0XHRcdH0pO1xyXG5cdFx0ICAgICAgXHQgIFx0YnJlYWs7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNhc2UgXCJmYWRlT3V0XCI6IFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLmhpZGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkcG9wdXAuc3RvcCgpLmZhZGVPdXQoby5zcGVlZCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHRcdFx0ICAgZGVmYXVsdDpcclxuXHRcdFx0ICAgXHQgIFx0Ly9IYXJkdHlwaW5nIDEgYW5kIDAgdG8gZW5zdXJlIG9wYWNpdHkgMSBhbmQgbm90IDAuOTk5OTk5OFxyXG5cdFx0XHRcdCAgXHQkcG9wdXAuc3RvcCgpLmZhZGVUbyhvLnNwZWVkLCBvcGVuID8gMSA6IDAsIGZ1bmN0aW9uKCl7b25Db21wbGV0ZUNhbGxiYWNrKG9wZW4pO30pO1xyXG5cdFx0XHR9XHJcblx0XHRcdFxyXG5cdFx0XHRmdW5jdGlvbiBhbmltYXRlKGNzcyl7XHJcblx0XHRcdCAgXHQkcG9wdXBcclxuXHRcdFx0XHRcdC5jc3Moe2Rpc3BsYXk6ICdibG9jaycsb3BhY2l0eTogMX0pXHJcblx0XHRcdFx0XHQuYW5pbWF0ZShjc3MsIG8uc3BlZWQsIG8uZWFzaW5nLCBmdW5jdGlvbigpeyBvbkNvbXBsZXRlQ2FsbGJhY2sob3Blbik7IH0pO1xyXG5cdFx0XHR9O1xyXG5cdFx0fTtcclxuXHRcdFxyXG5cdFx0XHJcblx0XHRmdW5jdGlvbiBvbkNvbXBsZXRlQ2FsbGJhY2sob3Blbil7XHJcblx0XHRcdGlmKG9wZW4pe1xyXG5cdFx0XHRcdGJpbmRFdmVudHMoKTtcclxuXHQgICAgICAgICAgICB0cmlnZ2VyQ2FsbChjYWxsYmFjayk7XHJcblx0XHRcdFx0aWYoby5hdXRvQ2xvc2Upe1xyXG5cdFx0XHRcdFx0YXV0b0Nsb3NlVE8gPSBzZXRUaW1lb3V0KGNsb3NlLCBvLmF1dG9DbG9zZSk7XHJcblx0XHRcdFx0fVxyXG5cdFx0XHR9IGVsc2Uge1xyXG5cdFx0XHRcdCRwb3B1cC5oaWRlKCk7XHJcblx0XHRcdFx0dHJpZ2dlckNhbGwoby5vbkNsb3NlKTtcclxuXHRcdFx0XHRpZiAoby5sb2FkVXJsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgby5jb250ZW50Q29udGFpbmVyLmVtcHR5KCk7XHJcblx0XHRcdFx0XHQkcG9wdXAuY3NzKHtoZWlnaHQ6ICdhdXRvJywgd2lkdGg6ICdhdXRvJ30pO1xyXG4gICAgICAgICAgICAgICAgfVx0XHRcclxuXHRcdFx0fVxyXG5cdFx0fTtcclxuXHRcdFxyXG5cdFx0ZnVuY3Rpb24gZ2V0TGVmdFBvcyhpbmNsdWRlU2Nyb2xsKXtcclxuXHRcdFx0cmV0dXJuIGluY2x1ZGVTY3JvbGwgPyBoUG9zICsgZC5zY3JvbGxMZWZ0KCkgOiBoUG9zO1xyXG5cdFx0fTtcclxuXHRcdFxyXG5cdFx0ZnVuY3Rpb24gZ2V0VG9wUG9zKGluY2x1ZGVTY3JvbGwpe1xyXG5cdFx0XHRyZXR1cm4gaW5jbHVkZVNjcm9sbCA/IHZQb3MgKyBkLnNjcm9sbFRvcCgpIDogdlBvcztcclxuXHRcdH07XHJcblx0XHRcclxuXHRcdGZ1bmN0aW9uIHRyaWdnZXJDYWxsKGZ1bmMsIGFyZykge1xyXG5cdFx0XHQkLmlzRnVuY3Rpb24oZnVuYykgJiYgZnVuYy5jYWxsKCRwb3B1cCwgYXJnKTtcclxuXHRcdH07XHJcblx0XHRcclxuICAgICAgIFx0ZnVuY3Rpb24gY2FsY1Bvc2l0aW9uKCl7XHJcblx0XHRcdHZQb3MgXHRcdD0gZml4ZWRWUG9zID8gby5wb3NpdGlvblsxXSA6IE1hdGgubWF4KDAsICgod0gtICRwb3B1cC5vdXRlckhlaWdodCh0cnVlKSkgLyAyKSAtIG8uYW1zbClcclxuXHRcdFx0LCBoUG9zIFx0XHQ9IGZpeGVkSFBvcyA/IG8ucG9zaXRpb25bMF0gOiAod1cgLSAkcG9wdXAub3V0ZXJXaWR0aCh0cnVlKSkgLyAyXHJcblx0XHRcdCwgaW5zaWRlIFx0PSBpbnNpZGVXaW5kb3coKTtcclxuXHRcdH07XHJcblx0XHRcclxuICAgICAgICBmdW5jdGlvbiBpbnNpZGVXaW5kb3coKXtcclxuICAgICAgICAgICAgcmV0dXJuIHdIID4gJHBvcHVwLm91dGVySGVpZ2h0KHRydWUpICYmIHdXID4gJHBvcHVwLm91dGVyV2lkdGgodHJ1ZSk7XHJcbiAgICAgICAgfTtcclxuXHRcdFxyXG5cdFx0ZnVuY3Rpb24gd2luZG93SGVpZ2h0KCl7XHJcblx0XHRcdHJldHVybiB3LmlubmVySGVpZ2h0IHx8ICR3LmhlaWdodCgpO1xyXG5cdFx0fTtcclxuXHRcdFxyXG5cdFx0ZnVuY3Rpb24gd2luZG93V2lkdGgoKXtcclxuXHRcdFx0cmV0dXJuIHcuaW5uZXJXaWR0aCB8fCAkdy53aWR0aCgpO1xyXG5cdFx0fTtcclxuICAgIH07XHJcblxyXG5cdC8qIERFRkFVTFQgVkFMVUVTICovXHJcbiAgICAkLmZuLmJQb3B1cC5kZWZhdWx0cyA9IHtcclxuICAgICAgICAgIGFtc2w6IFx0XHRcdDUwXHJcbiAgICAgICAgLCBhcHBlbmRpbmc6IFx0XHR0cnVlXHJcbiAgICAgICAgLCBhcHBlbmRUbzogXHRcdCdib2R5J1xyXG5cdFx0LCBhdXRvQ2xvc2U6XHRcdGZhbHNlXHJcbiAgICAgICAgLCBjbG9zZUNsYXNzOiBcdFx0J2ItY2xvc2UnXHJcbiAgICAgICAgLCBjb250ZW50OiBcdFx0XHQnYWpheCcgLy8gYWpheCwgaWZyYW1lIG9yIGltYWdlXHJcbiAgICAgICAgLCBjb250ZW50Q29udGFpbmVyOiBmYWxzZVxyXG5cdFx0LCBlYXNpbmc6IFx0XHRcdCdzd2luZydcclxuICAgICAgICAsIGVzY0Nsb3NlOiBcdFx0dHJ1ZVxyXG4gICAgICAgICwgZm9sbG93OiBcdFx0XHRbdHJ1ZSwgdHJ1ZV0gLy8geCwgeVxyXG5cdFx0LCBmb2xsb3dFYXNpbmc6IFx0J3N3aW5nJ1xyXG4gICAgICAgICwgZm9sbG93U3BlZWQ6IFx0XHQ1MDBcclxuXHRcdCwgaWZyYW1lQXR0cjogXHRcdCdzY3JvbGxpbmc9XCJub1wiIGZyYW1lYm9yZGVyPVwiMFwiJ1xyXG5cdFx0LCBsb2FkQ2FsbGJhY2s6IFx0ZmFsc2VcclxuXHRcdCwgbG9hZERhdGE6IFx0XHRmYWxzZVxyXG4gICAgICAgICwgbG9hZFVybDogXHRcdFx0ZmFsc2VcclxuICAgICAgICAsIG1vZGFsOiBcdFx0XHR0cnVlXHJcbiAgICAgICAgLCBtb2RhbENsb3NlOiBcdFx0dHJ1ZVxyXG4gICAgICAgICwgbW9kYWxDb2xvcjogXHRcdCcjMDAwJ1xyXG4gICAgICAgICwgb25DbG9zZTogXHRcdFx0ZmFsc2VcclxuICAgICAgICAsIG9uT3BlbjogXHRcdFx0ZmFsc2VcclxuICAgICAgICAsIG9wYWNpdHk6IFx0XHRcdDAuN1xyXG4gICAgICAgICwgcG9zaXRpb246IFx0XHRbJ2F1dG8nLCAnYXV0byddIC8vIHgsIHksXHJcbiAgICAgICAgLCBwb3NpdGlvblN0eWxlOiBcdCdhYnNvbHV0ZScvLyBhYnNvbHV0ZSBvciBmaXhlZFxyXG4gICAgICAgICwgc2Nyb2xsQmFyOiBcdFx0dHJ1ZVxyXG5cdFx0LCBzcGVlZDogXHRcdFx0MjUwIC8vIG9wZW4gJiBjbG9zZSBzcGVlZFxyXG5cdFx0LCB0cmFuc2l0aW9uOlx0XHQnZmFkZUluJyAvL3RyYW5zaXRpb25zOiBmYWRlSW4sIHNsaWRlRG93biwgc2xpZGVJbiwgc2xpZGVCYWNrXHJcblx0XHQsIHRyYW5zaXRpb25DbG9zZTpcdGZhbHNlXHJcbiAgICAgICAgLCB6SW5kZXg6IFx0XHRcdDk5OTcgLy8gcG9wdXAgZ2V0cyB6LWluZGV4IDk5OTksIG1vZGFsIG92ZXJsYXkgOTk5OFxyXG4gICAgfTtcclxufSkoalF1ZXJ5KTtcclxuIiwiLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqIGpxdWVyeS5hdXRvZml4X2FueXRoaW5nLmpzIHYxXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogQ29weXJpZ2h0IDIwMTMgUGV0ZSBSb2p3b25nc3VyaXlhLlxuICogaHR0cDovL3d3dy50aGVwZXRlZGVzaWduLmNvbVxuICpcbiAqIEZpeCBwb3NpdGlvbiBvZiBhbnl0aGluZyBvbiB5b3VyIHdlYnNpdGUgYXV0b21hdGljYWxseVxuICogd2l0aCBvbmUganMgY2FsbFxuICpcbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9wZWFjaGFuYW5yL2F1dG9maXhfYW55dGhpbmdcbiAqXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cbiFmdW5jdGlvbigkKXtcbiAgXG4gIHZhciBkZWZhdWx0cyA9IHtcbiAgICBjdXN0b21PZmZzZXQ6IGZhbHNlLFxuICAgIG1hbnVhbDogZmFsc2UsXG4gICAgb25seUluQ29udGFpbmVyOiB0cnVlXG5cdH07XG5cbiAgJC5mbi5hdXRvZml4X2FueXRoaW5nID0gZnVuY3Rpb24ob3B0aW9ucyl7XG4gICAgdmFyIHNldHRpbmdzID0gJC5leHRlbmQoe30sIGRlZmF1bHRzLCBvcHRpb25zKSxcbiAgICAgICAgZWwgPSAkKHRoaXMpLFxuICAgICAgICBjdXJwb3MgPSBlbC5wb3NpdGlvbigpLFxuICAgICAgICBvZmZzZXQgPSBzZXR0aW5ncy5jdXN0b21PZmZzZXQsXG4gICAgICAgIHBvcyA9IGVsLm9mZnNldCgpO1xuICAgICAgICBcbiAgICBlbC5hZGRDbGFzcyhcImF1dG9maXhfc2JcIikgIFxuICAgIFxuICAgICQuZm4ubWFudWFsZml4ID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgZWwgPSAkKHRoaXMpLFxuICAgICAgICAgIHBvcyA9IGVsLm9mZnNldCgpO1xuICAgICAgaWYgKGVsLmhhc0NsYXNzKFwiZml4ZWRcIikpIHtcbiAgICAgICAgZWwucmVtb3ZlQ2xhc3MoXCJmaXhlZFwiKVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZWwuYWRkQ2xhc3MoXCJmaXhlZFwiKS5jc3Moe1xuICAgICAgICAgIHRvcDogMCxcbiAgICAgICAgICBsZWZ0OiBwb3MubGVmdCxcbiAgICAgICAgICByaWdodDogXCJhdXRvXCIsXG4gICAgICAgICAgYm90dG9tOiBcImF1dG9cIlxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIFxuICAgIH1cbiAgICBcbiAgICBmaXhBbGwgPSBmdW5jdGlvbihlbCwgc2V0dGluZ3MsIGN1cnBvcywgcG9zKXtcbiAgICAgIGlmIChzZXR0aW5ncy5jdXN0b21PZmZzZXQgPT0gZmFsc2UpIG9mZnNldCA9ICBlbC5wYXJlbnQoKS5vZmZzZXQoKS50b3BcbiAgICAgIGlmKCQoZG9jdW1lbnQpLnNjcm9sbFRvcCgpID4gb2Zmc2V0ICYmICQoZG9jdW1lbnQpLnNjcm9sbFRvcCgpIDw9IChlbC5wYXJlbnQoKS5oZWlnaHQoKSArIChvZmZzZXQgLSAkKHdpbmRvdykuaGVpZ2h0KCkpKSkgIHtcbiAgICAgICAgICBlbC5yZW1vdmVDbGFzcyhcImJvdHRvbVwiKS5hZGRDbGFzcyhcImZpeGVkXCIpLmNzcyh7XG4gICAgICAgICAgICB0b3A6IDAsXG4gICAgICAgICAgICBsZWZ0OiBwb3MubGVmdCxcbiAgICAgICAgICAgIHJpZ2h0OiBcImF1dG9cIixcbiAgICAgICAgICAgIGJvdHRvbTogXCJhdXRvXCJcbiAgICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmKCQoZG9jdW1lbnQpLnNjcm9sbFRvcCgpID4gb2Zmc2V0KSB7XG4gICAgICAgICAgaWYgKHNldHRpbmdzLm9ubHlJbkNvbnRhaW5lciA9PSB0cnVlICkge1xuICAgICAgICAgICAgaWYoJChkb2N1bWVudCkuc2Nyb2xsVG9wKCkgPiAoZWwucGFyZW50KCkuaGVpZ2h0KCkgLSAkKHdpbmRvdykuaGVpZ2h0KCkpKSB7XG4gICAgICAgICAgICAgIGVsLmFkZENsYXNzKFwiYm90dG9tIGZpeGVkXCIpLnJlbW92ZUF0dHIoICdzdHlsZScgKS5jc3Moe1xuICAgICAgICAgICAgICAgIGxlZnQ6IGN1cnBvcy5sZWZ0XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfWVsc2Uge1xuICAgICAgICAgICAgICBlbC5yZW1vdmVDbGFzcyhcImJvdHRvbSBmaXhlZFwiKS5yZW1vdmVBdHRyKCAnc3R5bGUnICk7XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZWwucmVtb3ZlQ2xhc3MoXCJib3R0b20gZml4ZWRcIikucmVtb3ZlQXR0ciggJ3N0eWxlJyApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgXG4gICAgfVxuICAgIGlmIChzZXR0aW5ncy5tYW51YWwgPT0gZmFsc2UpIHtcbiAgICAgICQod2luZG93KS5zY3JvbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgIGZpeEFsbChlbCwgc2V0dGluZ3MsIGN1cnBvcywgcG9zKVxuICAgICAgfSk7XG4gICAgfVxuICAgIFxuXG4gIH1cbn0od2luZG93LmpRdWVyeSk7XG5cbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS45LjJcblxuLyoqXG5AbGljZW5zZSBTdGlja3kta2l0IHYxLjEuMiB8IFdURlBMIHwgTGVhZiBDb3Jjb3JhbiAyMDE1IHwgaHR0cDovL2xlYWZvLm5ldFxuICovXG4oZnVuY3Rpb24oKSB7XG4gIHZhciAkLCB3aW47XG5cbiAgJCA9IHRoaXMualF1ZXJ5IHx8IHdpbmRvdy5qUXVlcnk7XG5cbiAgd2luID0gJCh3aW5kb3cpO1xuXG4gICQuZm4uc3RpY2tfaW5fcGFyZW50ID0gZnVuY3Rpb24ob3B0cykge1xuICAgIHZhciBkb2MsIGVsbSwgZW5hYmxlX2JvdHRvbWluZywgZm4sIGksIGlubmVyX3Njcm9sbGluZywgbGVuLCBtYW51YWxfc3BhY2VyLCBvZmZzZXRfdG9wLCBvdXRlcl93aWR0aCwgcGFyZW50X3NlbGVjdG9yLCByZWNhbGNfZXZlcnksIHN0aWNreV9jbGFzcztcbiAgICBpZiAob3B0cyA9PSBudWxsKSB7XG4gICAgICBvcHRzID0ge307XG4gICAgfVxuICAgIHN0aWNreV9jbGFzcyA9IG9wdHMuc3RpY2t5X2NsYXNzLCBpbm5lcl9zY3JvbGxpbmcgPSBvcHRzLmlubmVyX3Njcm9sbGluZywgcmVjYWxjX2V2ZXJ5ID0gb3B0cy5yZWNhbGNfZXZlcnksIHBhcmVudF9zZWxlY3RvciA9IG9wdHMucGFyZW50LCBvZmZzZXRfdG9wID0gb3B0cy5vZmZzZXRfdG9wLCBtYW51YWxfc3BhY2VyID0gb3B0cy5zcGFjZXIsIGVuYWJsZV9ib3R0b21pbmcgPSBvcHRzLmJvdHRvbWluZztcbiAgICBpZiAob2Zmc2V0X3RvcCA9PSBudWxsKSB7XG4gICAgICBvZmZzZXRfdG9wID0gMDtcbiAgICB9XG4gICAgaWYgKHBhcmVudF9zZWxlY3RvciA9PSBudWxsKSB7XG4gICAgICBwYXJlbnRfc2VsZWN0b3IgPSB2b2lkIDA7XG4gICAgfVxuICAgIGlmIChpbm5lcl9zY3JvbGxpbmcgPT0gbnVsbCkge1xuICAgICAgaW5uZXJfc2Nyb2xsaW5nID0gdHJ1ZTtcbiAgICB9XG4gICAgaWYgKHN0aWNreV9jbGFzcyA9PSBudWxsKSB7XG4gICAgICBzdGlja3lfY2xhc3MgPSBcImlzX3N0dWNrXCI7XG4gICAgfVxuICAgIGRvYyA9ICQoZG9jdW1lbnQpO1xuICAgIGlmIChlbmFibGVfYm90dG9taW5nID09IG51bGwpIHtcbiAgICAgIGVuYWJsZV9ib3R0b21pbmcgPSB0cnVlO1xuICAgIH1cbiAgICBvdXRlcl93aWR0aCA9IGZ1bmN0aW9uKGVsKSB7XG4gICAgICB2YXIgX2VsLCBjb21wdXRlZCwgdztcbiAgICAgIGlmICh3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZSkge1xuICAgICAgICBfZWwgPSBlbFswXTtcbiAgICAgICAgY29tcHV0ZWQgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZShlbFswXSk7XG4gICAgICAgIHcgPSBwYXJzZUZsb2F0KGNvbXB1dGVkLmdldFByb3BlcnR5VmFsdWUoXCJ3aWR0aFwiKSkgKyBwYXJzZUZsb2F0KGNvbXB1dGVkLmdldFByb3BlcnR5VmFsdWUoXCJtYXJnaW4tbGVmdFwiKSkgKyBwYXJzZUZsb2F0KGNvbXB1dGVkLmdldFByb3BlcnR5VmFsdWUoXCJtYXJnaW4tcmlnaHRcIikpO1xuICAgICAgICBpZiAoY29tcHV0ZWQuZ2V0UHJvcGVydHlWYWx1ZShcImJveC1zaXppbmdcIikgIT09IFwiYm9yZGVyLWJveFwiKSB7XG4gICAgICAgICAgdyArPSBwYXJzZUZsb2F0KGNvbXB1dGVkLmdldFByb3BlcnR5VmFsdWUoXCJib3JkZXItbGVmdC13aWR0aFwiKSkgKyBwYXJzZUZsb2F0KGNvbXB1dGVkLmdldFByb3BlcnR5VmFsdWUoXCJib3JkZXItcmlnaHQtd2lkdGhcIikpICsgcGFyc2VGbG9hdChjb21wdXRlZC5nZXRQcm9wZXJ0eVZhbHVlKFwicGFkZGluZy1sZWZ0XCIpKSArIHBhcnNlRmxvYXQoY29tcHV0ZWQuZ2V0UHJvcGVydHlWYWx1ZShcInBhZGRpbmctcmlnaHRcIikpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiB3O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIGVsLm91dGVyV2lkdGgodHJ1ZSk7XG4gICAgICB9XG4gICAgfTtcbiAgICBmbiA9IGZ1bmN0aW9uKGVsbSwgcGFkZGluZ19ib3R0b20sIHBhcmVudF90b3AsIHBhcmVudF9oZWlnaHQsIHRvcCwgaGVpZ2h0LCBlbF9mbG9hdCwgZGV0YWNoZWQpIHtcbiAgICAgIHZhciBib3R0b21lZCwgZGV0YWNoLCBmaXhlZCwgbGFzdF9wb3MsIGxhc3Rfc2Nyb2xsX2hlaWdodCwgb2Zmc2V0LCBwYXJlbnQsIHJlY2FsYywgcmVjYWxjX2FuZF90aWNrLCByZWNhbGNfY291bnRlciwgc3BhY2VyLCB0aWNrO1xuICAgICAgaWYgKGVsbS5kYXRhKFwic3RpY2t5X2tpdFwiKSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBlbG0uZGF0YShcInN0aWNreV9raXRcIiwgdHJ1ZSk7XG4gICAgICBsYXN0X3Njcm9sbF9oZWlnaHQgPSBkb2MuaGVpZ2h0KCk7XG4gICAgICBwYXJlbnQgPSBlbG0ucGFyZW50KCk7XG4gICAgICBpZiAocGFyZW50X3NlbGVjdG9yICE9IG51bGwpIHtcbiAgICAgICAgcGFyZW50ID0gcGFyZW50LmNsb3Nlc3QocGFyZW50X3NlbGVjdG9yKTtcbiAgICAgIH1cbiAgICAgIGlmICghcGFyZW50Lmxlbmd0aCkge1xuICAgICAgICB0aHJvdyBcImZhaWxlZCB0byBmaW5kIHN0aWNrIHBhcmVudFwiO1xuICAgICAgfVxuICAgICAgZml4ZWQgPSBmYWxzZTtcbiAgICAgIGJvdHRvbWVkID0gZmFsc2U7XG4gICAgICBzcGFjZXIgPSBtYW51YWxfc3BhY2VyICE9IG51bGwgPyBtYW51YWxfc3BhY2VyICYmIGVsbS5jbG9zZXN0KG1hbnVhbF9zcGFjZXIpIDogJChcIjxkaXYgLz5cIik7XG4gICAgICBpZiAoc3BhY2VyKSB7XG4gICAgICAgIHNwYWNlci5jc3MoJ3Bvc2l0aW9uJywgZWxtLmNzcygncG9zaXRpb24nKSk7XG4gICAgICB9XG4gICAgICByZWNhbGMgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGJvcmRlcl90b3AsIHBhZGRpbmdfdG9wLCByZXN0b3JlO1xuICAgICAgICBpZiAoZGV0YWNoZWQpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgbGFzdF9zY3JvbGxfaGVpZ2h0ID0gZG9jLmhlaWdodCgpO1xuICAgICAgICBib3JkZXJfdG9wID0gcGFyc2VJbnQocGFyZW50LmNzcyhcImJvcmRlci10b3Atd2lkdGhcIiksIDEwKTtcbiAgICAgICAgcGFkZGluZ190b3AgPSBwYXJzZUludChwYXJlbnQuY3NzKFwicGFkZGluZy10b3BcIiksIDEwKTtcbiAgICAgICAgcGFkZGluZ19ib3R0b20gPSBwYXJzZUludChwYXJlbnQuY3NzKFwicGFkZGluZy1ib3R0b21cIiksIDEwKTtcbiAgICAgICAgcGFyZW50X3RvcCA9IHBhcmVudC5vZmZzZXQoKS50b3AgKyBib3JkZXJfdG9wICsgcGFkZGluZ190b3A7XG4gICAgICAgIHBhcmVudF9oZWlnaHQgPSBwYXJlbnQuaGVpZ2h0KCk7XG4gICAgICAgIGlmIChmaXhlZCkge1xuICAgICAgICAgIGZpeGVkID0gZmFsc2U7XG4gICAgICAgICAgYm90dG9tZWQgPSBmYWxzZTtcbiAgICAgICAgICBpZiAobWFudWFsX3NwYWNlciA9PSBudWxsKSB7XG4gICAgICAgICAgICBlbG0uaW5zZXJ0QWZ0ZXIoc3BhY2VyKTtcbiAgICAgICAgICAgIHNwYWNlci5kZXRhY2goKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWxtLmNzcyh7XG4gICAgICAgICAgICBwb3NpdGlvbjogXCJcIixcbiAgICAgICAgICAgIHRvcDogXCJcIixcbiAgICAgICAgICAgIHdpZHRoOiBcIlwiLFxuICAgICAgICAgICAgYm90dG9tOiBcIlwiXG4gICAgICAgICAgfSkucmVtb3ZlQ2xhc3Moc3RpY2t5X2NsYXNzKTtcbiAgICAgICAgICByZXN0b3JlID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICB0b3AgPSBlbG0ub2Zmc2V0KCkudG9wIC0gKHBhcnNlSW50KGVsbS5jc3MoXCJtYXJnaW4tdG9wXCIpLCAxMCkgfHwgMCkgLSBvZmZzZXRfdG9wO1xuICAgICAgICBoZWlnaHQgPSBlbG0ub3V0ZXJIZWlnaHQodHJ1ZSk7XG4gICAgICAgIGVsX2Zsb2F0ID0gZWxtLmNzcyhcImZsb2F0XCIpO1xuICAgICAgICBpZiAoc3BhY2VyKSB7XG4gICAgICAgICAgc3BhY2VyLmNzcyh7XG4gICAgICAgICAgICB3aWR0aDogb3V0ZXJfd2lkdGgoZWxtKSxcbiAgICAgICAgICAgIGhlaWdodDogaGVpZ2h0LFxuICAgICAgICAgICAgZGlzcGxheTogZWxtLmNzcyhcImRpc3BsYXlcIiksXG4gICAgICAgICAgICBcInZlcnRpY2FsLWFsaWduXCI6IGVsbS5jc3MoXCJ2ZXJ0aWNhbC1hbGlnblwiKSxcbiAgICAgICAgICAgIFwiZmxvYXRcIjogZWxfZmxvYXRcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocmVzdG9yZSkge1xuICAgICAgICAgIHJldHVybiB0aWNrKCk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICByZWNhbGMoKTtcbiAgICAgIGlmIChoZWlnaHQgPT09IHBhcmVudF9oZWlnaHQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgbGFzdF9wb3MgPSB2b2lkIDA7XG4gICAgICBvZmZzZXQgPSBvZmZzZXRfdG9wO1xuICAgICAgcmVjYWxjX2NvdW50ZXIgPSByZWNhbGNfZXZlcnk7XG4gICAgICB0aWNrID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHZhciBjc3MsIGRlbHRhLCByZWNhbGNlZCwgc2Nyb2xsLCB3aWxsX2JvdHRvbSwgd2luX2hlaWdodDtcbiAgICAgICAgaWYgKGRldGFjaGVkKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIHJlY2FsY2VkID0gZmFsc2U7XG4gICAgICAgIGlmIChyZWNhbGNfY291bnRlciAhPSBudWxsKSB7XG4gICAgICAgICAgcmVjYWxjX2NvdW50ZXIgLT0gMTtcbiAgICAgICAgICBpZiAocmVjYWxjX2NvdW50ZXIgPD0gMCkge1xuICAgICAgICAgICAgcmVjYWxjX2NvdW50ZXIgPSByZWNhbGNfZXZlcnk7XG4gICAgICAgICAgICByZWNhbGMoKTtcbiAgICAgICAgICAgIHJlY2FsY2VkID0gdHJ1ZTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFyZWNhbGNlZCAmJiBkb2MuaGVpZ2h0KCkgIT09IGxhc3Rfc2Nyb2xsX2hlaWdodCkge1xuICAgICAgICAgIHJlY2FsYygpO1xuICAgICAgICAgIHJlY2FsY2VkID0gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgICBzY3JvbGwgPSB3aW4uc2Nyb2xsVG9wKCk7XG4gICAgICAgIGlmIChsYXN0X3BvcyAhPSBudWxsKSB7XG4gICAgICAgICAgZGVsdGEgPSBzY3JvbGwgLSBsYXN0X3BvcztcbiAgICAgICAgfVxuICAgICAgICBsYXN0X3BvcyA9IHNjcm9sbDtcbiAgICAgICAgaWYgKGZpeGVkKSB7XG4gICAgICAgICAgaWYgKGVuYWJsZV9ib3R0b21pbmcpIHtcbiAgICAgICAgICAgIHdpbGxfYm90dG9tID0gc2Nyb2xsICsgaGVpZ2h0ICsgb2Zmc2V0ID4gcGFyZW50X2hlaWdodCArIHBhcmVudF90b3A7XG4gICAgICAgICAgICBpZiAoYm90dG9tZWQgJiYgIXdpbGxfYm90dG9tKSB7XG4gICAgICAgICAgICAgIGJvdHRvbWVkID0gZmFsc2U7XG4gICAgICAgICAgICAgIGVsbS5jc3Moe1xuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBcImZpeGVkXCIsXG4gICAgICAgICAgICAgICAgYm90dG9tOiBcIlwiLFxuICAgICAgICAgICAgICAgIHRvcDogb2Zmc2V0XG4gICAgICAgICAgICAgIH0pLnRyaWdnZXIoXCJzdGlja3lfa2l0OnVuYm90dG9tXCIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoc2Nyb2xsIDwgdG9wKSB7XG4gICAgICAgICAgICBmaXhlZCA9IGZhbHNlO1xuICAgICAgICAgICAgb2Zmc2V0ID0gb2Zmc2V0X3RvcDtcbiAgICAgICAgICAgIGlmIChtYW51YWxfc3BhY2VyID09IG51bGwpIHtcbiAgICAgICAgICAgICAgaWYgKGVsX2Zsb2F0ID09PSBcImxlZnRcIiB8fCBlbF9mbG9hdCA9PT0gXCJyaWdodFwiKSB7XG4gICAgICAgICAgICAgICAgZWxtLmluc2VydEFmdGVyKHNwYWNlcik7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgc3BhY2VyLmRldGFjaCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY3NzID0ge1xuICAgICAgICAgICAgICBwb3NpdGlvbjogXCJcIixcbiAgICAgICAgICAgICAgd2lkdGg6IFwiXCIsXG4gICAgICAgICAgICAgIHRvcDogXCJcIlxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIGVsbS5jc3MoY3NzKS5yZW1vdmVDbGFzcyhzdGlja3lfY2xhc3MpLnRyaWdnZXIoXCJzdGlja3lfa2l0OnVuc3RpY2tcIik7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChpbm5lcl9zY3JvbGxpbmcpIHtcbiAgICAgICAgICAgIHdpbl9oZWlnaHQgPSB3aW4uaGVpZ2h0KCk7XG4gICAgICAgICAgICBpZiAoaGVpZ2h0ICsgb2Zmc2V0X3RvcCA+IHdpbl9oZWlnaHQpIHtcbiAgICAgICAgICAgICAgaWYgKCFib3R0b21lZCkge1xuICAgICAgICAgICAgICAgIG9mZnNldCAtPSBkZWx0YTtcbiAgICAgICAgICAgICAgICBvZmZzZXQgPSBNYXRoLm1heCh3aW5faGVpZ2h0IC0gaGVpZ2h0LCBvZmZzZXQpO1xuICAgICAgICAgICAgICAgIG9mZnNldCA9IE1hdGgubWluKG9mZnNldF90b3AsIG9mZnNldCk7XG4gICAgICAgICAgICAgICAgaWYgKGZpeGVkKSB7XG4gICAgICAgICAgICAgICAgICBlbG0uY3NzKHtcbiAgICAgICAgICAgICAgICAgICAgdG9wOiBvZmZzZXQgKyBcInB4XCJcbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBpZiAoc2Nyb2xsID4gdG9wKSB7XG4gICAgICAgICAgICBmaXhlZCA9IHRydWU7XG4gICAgICAgICAgICBjc3MgPSB7XG4gICAgICAgICAgICAgIHBvc2l0aW9uOiBcImZpeGVkXCIsXG4gICAgICAgICAgICAgIHRvcDogb2Zmc2V0XG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgY3NzLndpZHRoID0gZWxtLmNzcyhcImJveC1zaXppbmdcIikgPT09IFwiYm9yZGVyLWJveFwiID8gZWxtLm91dGVyV2lkdGgoKSArIFwicHhcIiA6IGVsbS53aWR0aCgpICsgXCJweFwiO1xuICAgICAgICAgICAgZWxtLmNzcyhjc3MpLmFkZENsYXNzKHN0aWNreV9jbGFzcyk7XG4gICAgICAgICAgICBpZiAobWFudWFsX3NwYWNlciA9PSBudWxsKSB7XG4gICAgICAgICAgICAgIGVsbS5hZnRlcihzcGFjZXIpO1xuICAgICAgICAgICAgICBpZiAoZWxfZmxvYXQgPT09IFwibGVmdFwiIHx8IGVsX2Zsb2F0ID09PSBcInJpZ2h0XCIpIHtcbiAgICAgICAgICAgICAgICBzcGFjZXIuYXBwZW5kKGVsbSk7XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsbS50cmlnZ2VyKFwic3RpY2t5X2tpdDpzdGlja1wiKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGZpeGVkICYmIGVuYWJsZV9ib3R0b21pbmcpIHtcbiAgICAgICAgICBpZiAod2lsbF9ib3R0b20gPT0gbnVsbCkge1xuICAgICAgICAgICAgd2lsbF9ib3R0b20gPSBzY3JvbGwgKyBoZWlnaHQgKyBvZmZzZXQgPiBwYXJlbnRfaGVpZ2h0ICsgcGFyZW50X3RvcDtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKCFib3R0b21lZCAmJiB3aWxsX2JvdHRvbSkge1xuICAgICAgICAgICAgYm90dG9tZWQgPSB0cnVlO1xuICAgICAgICAgICAgaWYgKHBhcmVudC5jc3MoXCJwb3NpdGlvblwiKSA9PT0gXCJzdGF0aWNcIikge1xuICAgICAgICAgICAgICBwYXJlbnQuY3NzKHtcbiAgICAgICAgICAgICAgICBwb3NpdGlvbjogXCJyZWxhdGl2ZVwiXG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmV0dXJuIGVsbS5jc3Moe1xuICAgICAgICAgICAgICBwb3NpdGlvbjogXCJhYnNvbHV0ZVwiLFxuICAgICAgICAgICAgICBib3R0b206IHBhZGRpbmdfYm90dG9tLFxuICAgICAgICAgICAgICB0b3A6IFwiYXV0b1wiXG4gICAgICAgICAgICB9KS50cmlnZ2VyKFwic3RpY2t5X2tpdDpib3R0b21cIik7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgcmVjYWxjX2FuZF90aWNrID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJlY2FsYygpO1xuICAgICAgICByZXR1cm4gdGljaygpO1xuICAgICAgfTtcbiAgICAgIGRldGFjaCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBkZXRhY2hlZCA9IHRydWU7XG4gICAgICAgIHdpbi5vZmYoXCJ0b3VjaG1vdmVcIiwgdGljayk7XG4gICAgICAgIHdpbi5vZmYoXCJzY3JvbGxcIiwgdGljayk7XG4gICAgICAgIHdpbi5vZmYoXCJyZXNpemVcIiwgcmVjYWxjX2FuZF90aWNrKTtcbiAgICAgICAgJChkb2N1bWVudC5ib2R5KS5vZmYoXCJzdGlja3lfa2l0OnJlY2FsY1wiLCByZWNhbGNfYW5kX3RpY2spO1xuICAgICAgICBlbG0ub2ZmKFwic3RpY2t5X2tpdDpkZXRhY2hcIiwgZGV0YWNoKTtcbiAgICAgICAgZWxtLnJlbW92ZURhdGEoXCJzdGlja3lfa2l0XCIpO1xuICAgICAgICBlbG0uY3NzKHtcbiAgICAgICAgICBwb3NpdGlvbjogXCJcIixcbiAgICAgICAgICBib3R0b206IFwiXCIsXG4gICAgICAgICAgdG9wOiBcIlwiLFxuICAgICAgICAgIHdpZHRoOiBcIlwiXG4gICAgICAgIH0pO1xuICAgICAgICBwYXJlbnQucG9zaXRpb24oXCJwb3NpdGlvblwiLCBcIlwiKTtcbiAgICAgICAgaWYgKGZpeGVkKSB7XG4gICAgICAgICAgaWYgKG1hbnVhbF9zcGFjZXIgPT0gbnVsbCkge1xuICAgICAgICAgICAgaWYgKGVsX2Zsb2F0ID09PSBcImxlZnRcIiB8fCBlbF9mbG9hdCA9PT0gXCJyaWdodFwiKSB7XG4gICAgICAgICAgICAgIGVsbS5pbnNlcnRBZnRlcihzcGFjZXIpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgc3BhY2VyLnJlbW92ZSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm4gZWxtLnJlbW92ZUNsYXNzKHN0aWNreV9jbGFzcyk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICB3aW4ub24oXCJ0b3VjaG1vdmVcIiwgdGljayk7XG4gICAgICB3aW4ub24oXCJzY3JvbGxcIiwgdGljayk7XG4gICAgICB3aW4ub24oXCJyZXNpemVcIiwgcmVjYWxjX2FuZF90aWNrKTtcbiAgICAgICQoZG9jdW1lbnQuYm9keSkub24oXCJzdGlja3lfa2l0OnJlY2FsY1wiLCByZWNhbGNfYW5kX3RpY2spO1xuICAgICAgZWxtLm9uKFwic3RpY2t5X2tpdDpkZXRhY2hcIiwgZGV0YWNoKTtcbiAgICAgIHJldHVybiBzZXRUaW1lb3V0KHRpY2ssIDApO1xuICAgIH07XG4gICAgZm9yIChpID0gMCwgbGVuID0gdGhpcy5sZW5ndGg7IGkgPCBsZW47IGkrKykge1xuICAgICAgZWxtID0gdGhpc1tpXTtcbiAgICAgIGZuKCQoZWxtKSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG59KS5jYWxsKHRoaXMpO1xuIiwiLyoqXG4gKiBqUXVlcnkgc3luY1RyYW5zbGl0IHBsdWdpblxuICpcbiAqIENvcHlyaWdodCAoYykgMjAwOSBTbml0a28gUm9tYW5cbiAqIER1YWwgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCAoTUlULUxJQ0VOU0UudHh0KVxuICogYW5kIEdQTCAoR1BMLUxJQ0VOU0UudHh0KSBsaWNlbnNlcy5cbiAqXG4gKiBAYXV0aG9yIFx0Um9tYW4gU25pdGtvIHNub3djb3JlLm5ldEBnbWFpbC5jb21cbiAqIEBsaW5rIGh0dHA6Ly9zbm93Y29yZS5uZXQvXG4gKiBAdmVyc2lvbiAwLjAuN1xuICovXG47KGZ1bmN0aW9uKCQpe1xuICAgICQuZm4uc3luY1RyYW5zbGl0ID0gZnVuY3Rpb24ob3B0aW9ucykge1xuICAgICAgICB2YXIgb3B0cyA9ICQuZXh0ZW5kKHt9LCAkLmZuLnN5bmNUcmFuc2xpdC5kZWZhdWx0cywgb3B0aW9ucyk7XG4gICAgICAgIGlmKG9wdHMuc3RydHIpIHtcbiAgICAgICAgICAgIHJldHVybiAkLmZuLnN5bmNUcmFuc2xpdC5zdHJ0ciggb3B0cyApO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJHRoaXMgPSAkKHRoaXMpO1xuICAgICAgICAgICAgdmFyIG8gPSAkLm1ldGEgPyAkLmV4dGVuZCh7fSwgb3B0cywgJHRoaXMuZGF0YSgpKSA6IG9wdHM7XG4gICAgICAgICAgICB2YXIgJGRlc3RpbmF0aW9uID0gJCgnIycgKyBvcHRzLmRlc3RpbmF0aW9uKTtcbiAgICAgICAgICAgIG8uZGVzdGluYXRpb25PYmplY3QgPSAkZGVzdGluYXRpb247XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIElFIGFsd2F5cyBzdWNrcyA6KVxuICAgICAgICAgICAgaWYgKCFBcnJheS5pbmRleE9mKSB7XG4gICAgICAgICAgICAgICAgQXJyYXkucHJvdG90eXBlLmluZGV4T2YgPSBmdW5jdGlvbihvYmopIHtcbiAgICAgICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodGhpc1tpXSA9PSBvYmopIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gaTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gLTE7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgXG4gICAgICAgICAgICAkdGhpcy5rZXl1cChmdW5jdGlvbigpe1xuICAgICAgICAgICAgXHR2YXIgc3RyID0gJCh0aGlzKS52YWwoKTtcbiAgICAgICAgICAgIFx0dmFyIHJlc3VsdCA9ICcnO1xuICAgICAgICAgICAgXHRmb3IgKHZhciBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgXHRcdHJlc3VsdCArPSAkLmZuLnN5bmNUcmFuc2xpdC50cmFuc2xpdGVyYXRlKHN0ci5jaGFyQXQoaSksIG8pXG4gICAgICAgICAgICBcdH1cbiAgICAgICAgICAgIFx0dmFyIHJlZ0V4cCA9IG5ldyBSZWdFeHAoJ1snICsgby51cmxTZXBhcmF0b3IgKyAnXXsyLH0nLCAnZycpO1xuICAgICAgICAgICAgXHRyZXN1bHQgPSByZXN1bHQucmVwbGFjZShyZWdFeHAsIG8udXJsU2VwYXJhdG9yKTtcbiAgICAgICAgICAgIFx0JGRlc3RpbmF0aW9uLnZhbChyZXN1bHQpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBcbiAgICBcbiAgICAkLmZuLnN5bmNUcmFuc2xpdC5zdHJ0ciA9IGZ1bmN0aW9uKG9wdHMpIHtcbiAgICAgICAgdmFyIHRleHQgPSAob3B0cy5fdGV4dCkgPyBvcHRzLl90ZXh0IDogJyc7XG5cbiAgICAgICAgdmFyIHJlc3VsdCA9ICcnO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRleHQubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICByZXN1bHQgKz0gJC5mbi5zeW5jVHJhbnNsaXQudHJhbnNsaXRlcmF0ZSh0ZXh0LmNoYXJBdChpKSwgb3B0cyk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHJlZ0V4cCA9IG5ldyBSZWdFeHAoJ1snICsgb3B0cy51cmxTZXBhcmF0b3IgKyAnXXsyLH0nLCAnZycpO1xuICAgICAgICByZXN1bHQgPSByZXN1bHQucmVwbGFjZShyZWdFeHAsIG9wdHMudXJsU2VwYXJhdG9yKTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9XG4gICAgXG4gICAgLyoqXG4gICAgICogVHJhbnNsaXRlcmF0ZSBjaGFyYWN0ZXJcbiAgICAgKiBAcGFyYW0ge1N0cmluZ30gY2hhcmFjdGVyXG4gICAgICogQHBhcmFtIHtPYmplY3R9IG9wdHNcbiAgICAgKi9cbiAgICAkLmZuLnN5bmNUcmFuc2xpdC50cmFuc2xpdGVyYXRlID0gZnVuY3Rpb24oY2hhciwgb3B0cykge1xuICAgIFx0dmFyIGNoYXJJc0xvd2VyQ2FzZSA9IHRydWUsIHRyQ2hhcjtcbiAgICBcdGlmIChjaGFyLnRvTG93ZXJDYXNlKCkgIT0gY2hhcikge1xuICAgIFx0XHRjaGFySXNMb3dlckNhc2UgPSBmYWxzZTtcbiAgICBcdH1cbiAgICBcdFxuICAgIFx0Y2hhciA9IGNoYXIudG9Mb3dlckNhc2UoKTtcbiAgICBcdFxuICAgIFx0dmFyIGluZGV4ID0gb3B0cy5kaWN0T3JpZ2luYWwuaW5kZXhPZihjaGFyKTtcbiAgICBcdGlmIChpbmRleCA9PSAtMSkge1xuICAgIFx0XHR0ckNoYXIgPSBjaGFyO1xuICAgIFx0fSBlbHNlIHtcbiAgICBcdFx0dHJDaGFyID0gb3B0cy5kaWN0VHJhbnNsYXRlW2luZGV4XTtcbiAgICBcdH1cbiAgICBcdFxuICAgIFx0aWYgKG9wdHMudHlwZSA9PSAndXJsJykge1xuXHQgICAgXHR2YXIgY29kZSA9IHRyQ2hhci5jaGFyQ29kZUF0KDApO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGlmKHRyQ2hhciA9PSAnLicpIHsgcmV0dXJuICcuJzsgfSAvLyBmaXgg0YLQvtGH0LrQsFxuICAgICAgICAgICAgICAgIFxuXHQgICAgXHRpZiAoY29kZSA+PSAzMyAgJiYgY29kZSA8PSA0NyAmJiBjb2RlICE9IDQ1XG5cdCAgICBcdFx0fHwgY29kZSA+PSA1OCAgJiYgY29kZSA8PSA2NFxuXHQgICAgXHRcdHx8IGNvZGUgPj0gOTEgICYmIGNvZGUgPD0gOTZcblx0ICAgIFx0XHR8fCBjb2RlID49IDEyMyAmJiBjb2RlIDw9IDEyNlxuXHQgICAgXHRcdHx8IGNvZGUgPj0gMTA3MlxuXHQgICAgXHQpIHtcblx0ICAgIFx0XHRyZXR1cm4gJyc7XG5cdCAgICBcdH1cblx0ICAgIFx0aWYgKHRyQ2hhciA9PSAnICcgfHwgdHJDaGFyID09ICctJykge1xuXHQgICAgXHRcdHJldHVybiBvcHRzLnVybFNlcGFyYXRvcjtcblx0ICAgIFx0fVxuICAgIFx0fVxuICAgIFx0XG4gICAgXHRpZiAob3B0cy5jYXNlU3R5bGUgPT0gJ3VwcGVyJykge1xuICAgIFx0XHRyZXR1cm4gdHJDaGFyLnRvVXBwZXJDYXNlKCk7XG4gICAgXHR9IGVsc2UgaWYgKG9wdHMuY2FzZVN0eWxlID09ICdub3JtYWwnKSB7XG4gICAgXHRcdGlmIChjaGFySXNMb3dlckNhc2UpIHtcbiAgICBcdFx0XHRyZXR1cm4gdHJDaGFyLnRvTG93ZXJDYXNlKCk7XG4gICAgXHRcdH0gZWxzZSB7XG4gICAgXHRcdFx0cmV0dXJuIHRyQ2hhci50b1VwcGVyQ2FzZSgpO1xuICAgIFx0XHR9XG4gICAgXHR9XG5cdCAgICByZXR1cm4gdHJDaGFyO1xuICAgIH07XG4gICAgXG4gICAgLyoqXG4gICAgICogRGVmYXVsdCBvcHRpb25zXG4gICAgICovXG4gICAgJC5mbi5zeW5jVHJhbnNsaXQuZGVmYXVsdHMgPSB7XG4gICAgICAgIC8qKlxuICAgICAgICAgKiBEaWN0aW9uYXJpZXNcbiAgICAgICAgICovXG4gICAgICAgIGRpY3RPcmlnaW5hbDogIFsn0LAnLCAn0LEnLCAn0LInLCAn0LMnLCAn0LQnLCAn0LUnLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ9GRJywgJ9C2JywgJ9C3JywgJ9C4JywgJ9C5JywgJ9C6JyxcbiAgICAgICAgICAgICAgICAgICAgICAgICfQuycsICfQvCcsICfQvScsICfQvicsICfQvycsICfRgCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAn0YEnLCAn0YInLCAn0YMnLCAn0YQnLCAn0YUnLCAn0YYnLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ9GHJywgJ9GIJywgJ9GJJywgJ9GKJywgJ9GLJywgJ9GMJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICfRjScsICfRjicsICfRjycsXG4gICAgICAgICAgICAgICAgICAgICAgICAn0ZYnLCAn0ZQnLCAn0ZcnLCAn0pEnXG4gICAgICAgICAgICAgICAgICAgICAgICBdLFxuICAgICAgICBkaWN0VHJhbnNsYXRlOiBbJ2EnLCAnYicsICd2JywgJ2cnLCAnZCcsICdlJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICdlJywgJ3poJywneicsICdpJywgJ2onLCAnaycsXG4gICAgICAgICAgICAgICAgICAgICAgICAnbCcsICdtJywgJ24nLCAnbycsICdwJywgJ3InLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ3MnLCAndCcsICd1JywgJ2YnLCAnaCcsICd0cycsXG4gICAgICAgICAgICAgICAgICAgICAgICAnY2gnLCdzaCcsJ3NjaCcsICcnLCAneScsICcnLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2UnLCAnanUnLCAnamEnLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2knLCAnamUnLCAnamknLCAnZydcbiAgICAgICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgIFxuICAgICAgICAvKlxuICAgICAgICAgKiBDYXNlIHRyYW5zZm9ybWF0aW9uOiBub3JtYWwsIGxvd2VyLCB1cHBlclxuICAgICAgICAgKi9cbiAgICAgICAgY2FzZVN0eWxlOiAnbG93ZXInLFxuICAgICAgICBcbiAgICAgICAgLypcbiAgICAgICAgICogV29yZHMgc2VwYXJhdG9yIGluIHVybFxuICAgICAgICAgKi9cbiAgICAgICAgdXJsU2VwYXJhdG9yOiAnLScsXG4gICAgICAgIFxuICAgICAgICAvKlxuICAgICAgICAgKiBUcmFuc2xpdGVyYXRpb24gdHlwZTogcmF3IG9yIHVybFxuICAgICAgICAgKiAgICB1cmwgLSB1c2VkIGZvciB0cmFuc2xpdGVyYXRpbmcgdGV4dCBpbnRvIHVybCBzbHVnXG4gICAgICAgICAqICAgIHJhdyAtIHJhdyB0cmFuc2xpdGVyYXRpb24gKHdpdGggc3BlY2lhbCBjaGFyYWN0ZXJzKVxuICAgICAgICAgKi9cbiAgICAgICAgdHlwZTogJ3VybCdcbiAgICB9O1xufSkoalF1ZXJ5KTsiLCIkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpeyBcbiAgICB2YXIgX2VtYWlsID0gbmV3IFN0cmluZygkKFwiLmJveC1mb3JtLXN1YnNjcmliZSA+IGZvcm0gaW5wdXQuZW1haWxcIikuYXR0cihcIm5hbWVcIikpO1xuICAgICQoJy5ib3gtZm9ybS1zdWJzY3JpYmUgPiBmb3JtJykudmFsaWRhdGUoe1xuICAgICAgICBvbmZvY3Vzb3V0OiBmYWxzZSxcbiAgICAgICAgb25rZXl1cDogZmFsc2UsXG4gICAgICAgIG9uY2xpY2s6IHRydWUsXG4gICAgICAgIG9uc3VibWl0OiB0cnVlLFxuICAgICAgICBmb2N1c0ludmFsaWQ6IGZhbHNlLFxuICAgICAgICBmb2N1c0NsZWFudXA6IGZhbHNlLCAgICAgICAgXG4gICAgICAgIF9lbWFpbDoge1xuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICBlbWFpbDogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICBtZXNzYWdlczoge1xuICAgICAgICAgICAgX2VtYWlsOiB7XG4gICAgICAgICAgICAgICAgcmVxdWlyZWQ6ICdUaGUgRW1haWwgZmllbGQgaXMgZW1wdHknLFxuICAgICAgICAgICAgICAgIGVtYWlsOiAnV2XigJlsbCBuZXZlciBzaGFyZSB5b3VyIGVtYWlsIGFkcmVzcyBhbmQgeW91IGNhbiBvcHQgb3V0IGF0IGFueSB0aW1lLCB3ZSBwcm9taXNlLidcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcblxuICAgICAgICBlcnJvckNsYXNzOiAnYmxvY2stZXJyb3InLFxuICAgICAgICB2YWxpZENsYXNzOiAnc3VjY2VzcycsXG4gICAgICAgIGludmFsaWRIYW5kbGVyOiBmdW5jdGlvbihldmVudCwgdmFsaWRhdG9yKSB7XG4gICAgICAgICAgICBpZigkKCcuYm94LWZvcm0tc3Vic2NyaWJlID4gZm9ybSAuYmxvY2stZXJyb3InKS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgJCgnLmJveC1mb3JtLXN1YnNjcmliZSA+IGZvcm0gLmJsb2NrLWVycm9yJykuaHRtbCggJyAnICkuaGlkZSgpO1xuICAgICAgICB9LFxuICAgICAgICAvLyDRg9C/0YDQsNCy0LvQtdC90LjQtSDQvtGI0LjQsdC60LDQvNC4XG4gICAgICAgIHNob3dFcnJvcnM6IGZ1bmN0aW9uKGVycm9yTWFwLCBlcnJvckxpc3QpIHtcbiAgICAgICAgICAgIHZhciBtc2cgPSAnJztcbiAgICAgICAgICAgICQuZWFjaChlcnJvckxpc3QsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgaWYodGhpcy5tZXNzYWdlKSBcbiAgICAgICAgICAgICAgICAgICAgbXNnICs9IHRoaXMubWVzc2FnZSArICc8YnIgLz4nOyBcbiAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYobXNnICE9PSAnJykgXG4gICAgICAgICAgICAgICAgJCgnLmJveC1mb3JtLXN1YnNjcmliZSA+IGZvcm0gLmJsb2NrLWVycm9yJykuaHRtbChtc2cpLnNob3coKTtcbiAgICAgICAgfSxcbiAgICB9KTtcbn0pOyAgICBcbiIsIi8qIFxuICogVG8gY2hhbmdlIHRoaXMgbGljZW5zZSBoZWFkZXIsIGNob29zZSBMaWNlbnNlIEhlYWRlcnMgaW4gUHJvamVjdCBQcm9wZXJ0aWVzLlxuICogVG8gY2hhbmdlIHRoaXMgdGVtcGxhdGUgZmlsZSwgY2hvb3NlIFRvb2xzIHwgVGVtcGxhdGVzXG4gKiBhbmQgb3BlbiB0aGUgdGVtcGxhdGUgaW4gdGhlIGVkaXRvci5cbiAqL1xuXG5mdW5jdGlvbiBpc3NldChlbGVtZW50KSB7XG4gICAgaWYodHlwZW9mIGVsZW1lbnQgIT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgcmV0dXJuIGVsZW1lbnQubGVuZ3RoID4gMDtcbiAgICB9IGVsc2VcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xufVxuXG4vKlxuICogcGFyY2UgdXJsXG4gKiovXG5mdW5jdGlvbiBwYXJzZVVybFF1ZXJ5KCkge1xuICAgIHZhciBkYXRhID0ge307XG4gICAgaWYobG9jYXRpb24uc2VhcmNoKSB7XG4gICAgICAgIHZhciBwYWlyID0gKGxvY2F0aW9uLnNlYXJjaC5zdWJzdHIoMSkpLnNwbGl0KCcmJyk7XG4gICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBwYWlyLmxlbmd0aDsgaSArKykge1xuICAgICAgICAgICAgdmFyIHBhcmFtID0gcGFpcltpXS5zcGxpdCgnPScpO1xuICAgICAgICAgICAgZGF0YVtwYXJhbVswXV0gPSBwYXJhbVsxXTtcbiAgICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZGF0YTtcbn1cblxuLypcbiAqIHBhcmNlIHN0cmluZyBzZXJpbGl6ZVxuICoqL1xuZnVuY3Rpb24gcGFyc2VRdWVyeSggc3RyICkge1xuICAgIHZhciBkYXRhID0ge307XG4gICAgaWYodHlwZW9mIHN0ciA9PSAnc3RyaW5nJykge1xuICAgICAgICB2YXIgcGFpciA9IChzdHIpLnNwbGl0KCcmJyk7XG4gICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBwYWlyLmxlbmd0aDsgaSArKykge1xuICAgICAgICAgICAgdmFyIHBhcmFtID0gcGFpcltpXS5zcGxpdCgnPScpO1xuICAgICAgICAgICAgZGF0YVtwYXJhbVswXV0gPSBwYXJhbVsxXTtcbiAgICAgICAgfVxuICAgIH0gZWxzZSBpZih0eXBlb2Ygc3RyID09ICdvYmplY3QnKSB7XG4gICAgICAgICQuZWFjaChzdHIsIGZ1bmN0aW9uKF9rLCBfdmFsKSB7XG4gICAgICAgICAgICBpZihfdmFsLm5hbWUpXG4gICAgICAgICAgICAgICAgZGF0YVsgX3ZhbC5uYW1lIF0gPSAoX3ZhbC52YWx1ZSkgPyBfdmFsLnZhbHVlIDogbnVsbDtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiBkYXRhO1xufVxuXG4vKlxuICogQWpheCBmdW5jdGlvbi5cbiAqIHJldHVybiBqc29uIHJlc3VsdFxuICoqL1xuZnVuY3Rpb24gZ2V0QWpheEZvcm0ocGF0aCwgcGFyYW1zLCBvcHRpb25zKSB7XG4gIFxuICAgIGlmKCFvcHRpb25zKSBvcHRpb25zID0ge307XG4gICAgXG4gICAgdmFyIHNldHRpbmdzID0gJC5leHRlbmQoIHtcbiAgICAgICAgJ2RhdGFUeXBlJzogJ2pzb24nLFxuICAgICAgICAnYXN5bmMnOiBmYWxzZSxcbiAgICAgICAgJ2Nyb3NzRG9tYWluJzogZmFsc2UsXG4gICAgICAgICd0eXBlJzogJ1BPU1QnLFxuICAgICAgICAnY2FjaGUnOiB0cnVlXG4gICAgfSwgb3B0aW9ucyB8fCB7fSk7XG4gICAgXG4gICAgY29uc29sZS5sb2coIHNldHRpbmdzICk7XG4gICAgXG4gICAgaWYoIXBhdGgpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2VudGVyIHVybCBBSkFYIScpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgdmFyIHJlcyA9ICQuYWpheCh7XG4gICAgICAgICAgICAgICAgICAgIHVybDogcGF0aCxcbiAgICAgICAgICAgICAgICAgICAgZGF0YVR5cGU6IHNldHRpbmdzLmRhdGFUeXBlLFxuICAgICAgICAgICAgICAgICAgICBhc3luYzogc2V0dGluZ3MuYXN5bmMsXG4gICAgICAgICAgICAgICAgICAgIGNyb3NzRG9tYWluOiBzZXR0aW5ncy5jcm9zc0RvbWFpbixcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogc2V0dGluZ3MudHlwZSxcbiAgICAgICAgICAgICAgICAgICAgY2FjaGU6IHNldHRpbmdzLmNhY2hlLFxuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZGF0YToge1xuICAgICAgICAgICAgICAgICAgICAgICAgcGFyYW1zOiBwYXJhbXMgXG4gICAgICAgICAgICAgICAgICAgIH1cblx0XHR9KS5yZXNwb25zZVRleHQ7XG4gICAgICAgICAgICAgICAgXG4gICAgY29uc29sZS5sb2cocmVzKTsgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBcbiAgICByZXMgPSBldmFsKCdbJytyZXMrJ10nKTtcbiAgICB2YXIgb2JqID0gcmVzWzBdO1xuICAgIHJldHVybiBvYmo7XG59XG5cbi8qXG4gKiBKU09OUFxuICogXG4gKi9cbmZ1bmN0aW9uIF9nZXRBSkFYKCBwYXRoLCBwYXJhbXMsIG9wdGlvbnMgKSB7XG4gICBpZighb3B0aW9ucykgb3B0aW9ucyA9IHt9O1xuICAgIFxuICAgIHZhciBzZXR0aW5ncyA9ICQuZXh0ZW5kKCB7XG4gICAgICAgICdkYXRhVHlwZSc6ICdqc29ucCcsXG4gICAgICAgICdqc29ucCc6IFwiY2FsbGJhY2tcIixcbiAgICAgICAgJ2FzeW5jJzogZmFsc2UsXG4gICAgICAgICdjcm9zc0RvbWFpbic6IGZhbHNlLFxuICAgICAgICAndHlwZSc6ICdQT1NUJyxcbiAgICAgICAgJ2NhY2hlJzogdHJ1ZVxuICAgIH0sIG9wdGlvbnMgfHwge30pO1xuICAgIFxuICAgIGNvbnNvbGUubG9nKCBzZXR0aW5ncyApO1xuICAgIFxuICAgIGlmKCFwYXRoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdlbnRlciB1cmwgQUpBWCEnKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfSAgIFxuXG4gICAgcmV0dXJuICQuYWpheCh7IFxuICAgICAgICB0eXBlOiBzZXR0aW5ncy50eXBlLFxuICAgICAgICBhc3luYzogc2V0dGluZ3MuYXN5bmMsXG4gICAgICAgIHVybDogcGF0aCxcbiAgICAgICAgZGF0YTogeyBcbiAgICAgICAgICAgcGFyYW1zOiBwYXJhbXMgXG4gICAgICAgIH0sXG4gICAgICAgIGRhdGFUeXBlOiBzZXR0aW5ncy5kYXRhVHlwZSxcbiAgICAgICAganNvbnA6IHNldHRpbmdzLmpzb25wLFxuICAgICAgICBjcm9zc0RvbWFpbjogc2V0dGluZ3MuY3Jvc3NEb21haW4sXG4gICAgICAgIGNhY2hlOiBzZXR0aW5ncy5jYWNoZSxcbiAgICB9KTtcbn0iLCIvKiFcbiAqIEJvb3RzdHJhcCBZb3VUdWJlIFBvcHVwIFBsYXllciBQbHVnaW5cbiAqIGF1dGhvcjogRWRpaSBTaGFkb3dcbiAqL1xuKGZ1bmN0aW9uICgkKSB7XG4gIHZhciAkWW91VHViZU1vZGFsID0gbnVsbCxcbiAgICAkWW91VHViZU1vZGFsRGlhbG9nID0gbnVsbCxcbiAgICAkWW91VHViZU1vZGFsVGl0bGUgPSBudWxsLFxuICAgICRZb3VUdWJlTW9kYWxCb2R5ID0gbnVsbCxcbiAgICBtYXJnaW4gPSA1LFxuICAgIG1ldGhvZHM7XG5cbiAgLy9QbHVnaW4gbWV0aG9kc1xuICBtZXRob2RzID0ge1xuICAgIC8vaW5pdGlhbGl6ZSBwbHVnaW5cbiAgICBpbml0OiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgb3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCAkLmZuLllvdVR1YmVNb2RhbC5kZWZhdWx0cywgb3B0aW9ucyk7XG5cbiAgICAgIC8vIGluaXRpYWxpemUgWW91VHViZSBQbGF5ZXIgTW9kYWxcbiAgICAgIGlmICgkWW91VHViZU1vZGFsID09IG51bGwpIHtcbiAgICAgICAgJFlvdVR1YmVNb2RhbCA9ICQoJzxkaXYgY2xhc3M9XCJtb2RhbCAnICsgb3B0aW9ucy5jc3NDbGFzcyArICdcIiBpZD1cIllvdVR1YmVNb2RhbFwiIHJvbGU9XCJkaWFsb2dcIiBhcmlhLWhpZGRlbj1cInRydWVcIj4nKTsgLy8gZmFkZVxuICAgICAgICBcbiAgICAgICAgXG4gICAgICAgIHZhciBtb2RhbENvbnRlbnQgPSAnPGRpdiBjbGFzcz1cIm1vZGFsLWRpYWxvZ1wiIGlkPVwiWW91VHViZU1vZGFsRGlhbG9nXCI+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cIm1vZGFsLWNvbnRlbnRcIiBpZD1cIllvdVR1YmVNb2RhbENvbnRlbnRcIj4nICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwidmlkZW8td3JhcHBlclwiPicgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cInZpZGVvLWlubmVyXCI+JytcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBkYXRhLWRpc21pc3M9XCJtb2RhbFwiIGFyaWEtaGlkZGVuPVwidHJ1ZVwiIGNsYXNzPVwidmlkZW8tY2xvc2UgY2xvc2VcIj48L2J1dHRvbj4nK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cIm1vZGFsLWJvZHlcIiBpZD1cIllvdVR1YmVNb2RhbEJvZHlcIj48L2Rpdj4nICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nKyBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JysgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvZGl2PicgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nO1xuICAgICAgICBcbiAgICAgICAgXG4vLyAgICAgICAgdmFyIG1vZGFsQ29udGVudCA9ICc8ZGl2IGNsYXNzPVwibW9kYWwtZGlhbG9nXCIgaWQ9XCJZb3VUdWJlTW9kYWxEaWFsb2dcIj4nICtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJtb2RhbC1jb250ZW50XCIgaWQ9XCJZb3VUdWJlTW9kYWxDb250ZW50XCI+JyArXG4vLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJtb2RhbC1oZWFkZXJcIj4nICtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cImNsb3NlXCIgZGF0YS1kaXNtaXNzPVwibW9kYWxcIj4mdGltZXM7PC9idXR0b24+JyArXG4vLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGg0IGNsYXNzPVwibW9kYWwtdGl0bGVcIiBpZD1cIllvdVR1YmVNb2RhbFRpdGxlXCI+PC9oND4nICtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JyArXG4vLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJtb2RhbC1ib2R5XCIgaWQ9XCJZb3VUdWJlTW9kYWxCb2R5XCIgc3R5bGU9XCJwYWRkaW5nOjA7XCI+PC9kaXY+JyArXG4vLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nICtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nO1xuICAgICAgICAkWW91VHViZU1vZGFsLmh0bWwobW9kYWxDb250ZW50KS5oaWRlKCkuYXBwZW5kVG8oJ2JvZHknKTtcbiAgICAgICAgJFlvdVR1YmVNb2RhbERpYWxvZyA9ICQoXCIjWW91VHViZU1vZGFsRGlhbG9nXCIpO1xuICAgICAgICAkWW91VHViZU1vZGFsVGl0bGUgPSAkKFwiI1lvdVR1YmVNb2RhbFRpdGxlXCIpO1xuICAgICAgICAkWW91VHViZU1vZGFsQm9keSA9ICQoXCIjWW91VHViZU1vZGFsQm9keVwiKTtcbiAgICAgICAgJFlvdVR1YmVNb2RhbC5tb2RhbCh7XG4gICAgICAgICAgc2hvdzogZmFsc2VcbiAgICAgICAgfSkub24oJ2hpZGUuYnMubW9kYWwnLCByZXNldE1vZGFsQm9keSk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgb2JqID0gJCh0aGlzKTtcbiAgICAgICAgdmFyIGRhdGEgPSBvYmouZGF0YSgnWW91VHViZScpO1xuICAgICAgICBpZiAoIWRhdGEpIHsgLy9jaGVjayBpZiBldmVudCBpcyBhbHJlYWR5IGFzc2lnbmVkXG4gICAgICAgICAgb2JqLmRhdGEoJ1lvdVR1YmUnLCB7XG4gICAgICAgICAgICB0YXJnZXQ6IG9ialxuICAgICAgICAgIH0pO1xuICAgICAgICAgICQob2JqKS5iaW5kKCdjbGljay5Zb3VUdWJlTW9kYWwnLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgIHZhciB5b3V0dWJlSWQgPSBvcHRpb25zLnlvdXR1YmVJZDtcbiAgICAgICAgICAgIGlmICgkLnRyaW0oeW91dHViZUlkKSA9PSAnJyAmJiBvYmouaXMoXCJhXCIpKSB7XG4gICAgICAgICAgICAgIHlvdXR1YmVJZCA9IGdldFlvdVR1YmVJZEZyb21Vcmwob2JqLmF0dHIoXCJocmVmXCIpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICgkLnRyaW0oeW91dHViZUlkKSA9PSAnJyB8fCB5b3V0dWJlSWQgPT09IGZhbHNlKSB7XG4gICAgICAgICAgICAgIHlvdXR1YmVJZCA9IG9iai5hdHRyKG9wdGlvbnMuaWRBdHRyaWJ1dGUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHZpZGVvVGl0bGUgPSAkLnRyaW0ob3B0aW9ucy50aXRsZSk7XG4gICAgICAgICAgICBpZiAodmlkZW9UaXRsZSA9PSAnJykge1xuICAgICAgICAgICAgICBpZiAob3B0aW9ucy51c2VZb3VUdWJlVGl0bGUpIHNldFlvdVR1YmVUaXRsZSh5b3V0dWJlSWQpO1xuICAgICAgICAgICAgICBlbHNlIHZpZGVvVGl0bGUgPSBvYmouYXR0cigndGl0bGUnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICh2aWRlb1RpdGxlKSB7XG4gICAgICAgICAgICAgIHNldE1vZGFsVGl0bGUodmlkZW9UaXRsZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJlc2l6ZU1vZGFsKG9wdGlvbnMud2lkdGgpO1xuXG4gICAgICAgICAgICAvL1NldHVwIFlvdVR1YmUgTW9kYWxcbiAgICAgICAgICAgIHZhciBZb3VUdWJlVVJMID0gZ2V0WW91VHViZVVybCh5b3V0dWJlSWQsIG9wdGlvbnMpO1xuICAgICAgICAgICAgdmFyIFlvdVR1YmVQbGF5ZXJJZnJhbWUgPSBnZXRZb3VUdWJlUGxheWVyKFlvdVR1YmVVUkwsIG9wdGlvbnMud2lkdGgsIG9wdGlvbnMuaGVpZ2h0KTtcbiAgICAgICAgICAgICRZb3VUdWJlTW9kYWxCb2R5LmNzcyh7J21heC13aWR0aCc6IG9wdGlvbnMud2lkdGgsICdoZWlnaHQnOiBvcHRpb25zLmhlaWdodH0pO1xuICAgICAgICAgICAgc2V0TW9kYWxCb2R5KFlvdVR1YmVQbGF5ZXJJZnJhbWUpO1xuICAgICAgICAgICAgJFlvdVR1YmVNb2RhbC5tb2RhbCgnc2hvdycpO1xuXG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9LFxuICAgIGRlc3Ryb3k6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAkKHRoaXMpLnVuYmluZChcIi5Zb3VUdWJlTW9kYWxcIikucmVtb3ZlRGF0YSgnWW91VHViZScpO1xuICAgICAgfSk7XG4gICAgfVxuICB9O1xuXG4gIGZ1bmN0aW9uIHNldE1vZGFsVGl0bGUodGl0bGUpIHtcbiAgICAkWW91VHViZU1vZGFsVGl0bGUuaHRtbCgkLnRyaW0odGl0bGUpKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNldE1vZGFsQm9keShjb250ZW50KSB7XG4gICAgJFlvdVR1YmVNb2RhbEJvZHkuaHRtbChjb250ZW50KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlc2V0TW9kYWxCb2R5KCkge1xuICAgIHNldE1vZGFsVGl0bGUoJycpO1xuICAgIHNldE1vZGFsQm9keSgnJyk7XG4gIH1cblxuICBmdW5jdGlvbiByZXNpemVNb2RhbCh3KSB7XG4vLyAgICAkWW91VHViZU1vZGFsRGlhbG9nLmNzcyh7XG4vLyAgICAgICdtYXgtd2lkdGgnOiB3ICsgKG1hcmdpbiAqIDIpXG4vLyAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldFlvdVR1YmVVcmwoeW91dHViZUlkLCBvcHRpb25zKSB7XG4gICAgcmV0dXJuIFtcIi8vd3d3LnlvdXR1YmUuY29tL2VtYmVkL1wiLCB5b3V0dWJlSWQsIFwiP3JlbD0wJnNob3dzZWFyY2g9MCZhdXRvaGlkZT1cIiwgb3B0aW9ucy5hdXRvaGlkZSxcbiAgICAgIFwiJmF1dG9wbGF5PVwiLCBvcHRpb25zLmF1dG9wbGF5LCBcIiZjb250cm9scz1cIiwgb3B0aW9ucy5jb250cm9scywgXCImZnM9XCIsIG9wdGlvbnMuZnMsIFwiJmxvb3A9XCIsIG9wdGlvbnMubG9vcCxcbiAgICAgIFwiJnNob3dpbmZvPVwiLCBvcHRpb25zLnNob3dpbmZvLCBcIiZjb2xvcj1cIiwgb3B0aW9ucy5jb2xvciwgXCImdGhlbWU9XCIsIG9wdGlvbnMudGhlbWUsIFwiJndtb2RlPXRyYW5zcGFyZW50XCJcbiAgICBdLmpvaW4oJycpO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0WW91VHViZVBsYXllcihVUkwsIHdpZHRoLCBoZWlnaHQpIHtcbiAgICByZXR1cm4gWyc8aWZyYW1lIHRpdGxlPVwiWW91VHViZSB2aWRlbyBwbGF5ZXJcIiB3aWR0aD1cIicsIHdpZHRoLCAnXCIgaGVpZ2h0PVwiJywgaGVpZ2h0LCAnXCIgJyxcbiAgICAgICdzdHlsZT1cIm1hcmdpbjowOyBwYWRkaW5nOjA7IGJveC1zaXppbmc6Ym9yZGVyLWJveDsgYm9yZGVyOjA7IC13ZWJraXQtYm9yZGVyLXJhZGl1czo1cHg7IC1tb3otYm9yZGVyLXJhZGl1czo1cHg7IGJvcmRlci1yYWRpdXM6NXB4OyBtYXJnaW46JywgKG1hcmdpbiAtIDEpLCAncHg7XCIgJyxcbiAgICAgICdzcmM9XCInLCBVUkwsICdcIiBmcmFtZWJvcmRlcj1cIjBcIiBhbGxvd2Z1bGxzY3JlZW4gc2VhbWxlc3M+PC9pZnJhbWU+J1xuICAgIF0uam9pbignJyk7XG4gIH1cblxuICBmdW5jdGlvbiBzZXRZb3VUdWJlVGl0bGUoeW91dHViZUlkKSB7XG4gICAgJC5hamF4KHtcbiAgICAgIHVybDogd2luZG93LmxvY2F0aW9uLnByb3RvY29sICsgJy8vcXVlcnkueWFob29hcGlzLmNvbS92MS9wdWJsaWMveXFsJyxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgcTogXCJzZWxlY3QgKiBmcm9tIGpzb24gd2hlcmUgdXJsID0naHR0cDovL3d3dy55b3V0dWJlLmNvbS9vZW1iZWQ/dXJsPWh0dHA6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1cIiArIHlvdXR1YmVJZCArIFwiJmZvcm1hdD1qc29uJ1wiLFxuICAgICAgICBmb3JtYXQ6IFwianNvblwiXG4gICAgICB9LFxuICAgICAgZGF0YVR5cGU6IFwianNvbnBcIixcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS5xdWVyeSAmJiBkYXRhLnF1ZXJ5LnJlc3VsdHMgJiYgZGF0YS5xdWVyeS5yZXN1bHRzLmpzb24pIHtcbiAgICAgICAgICAgIHNldE1vZGFsVGl0bGUoZGF0YS5xdWVyeS5yZXN1bHRzLmpzb24udGl0bGUpO1xuICAgICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldFlvdVR1YmVJZEZyb21VcmwoeW91dHViZVVybCkge1xuICAgIHZhciByZWdFeHAgPSAvXi4qKHlvdXR1LmJlXFwvfHZcXC98dVxcL1xcd1xcL3xlbWJlZFxcL3x3YXRjaFxcP3Y9KShbXiNcXCZcXD9dKikuKi87XG4gICAgdmFyIG1hdGNoID0geW91dHViZVVybC5tYXRjaChyZWdFeHApO1xuICAgIGlmIChtYXRjaCAmJiBtYXRjaFsyXS5sZW5ndGggPT0gMTEpIHtcbiAgICAgIHJldHVybiBtYXRjaFsyXTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gICQuZm4uWW91VHViZU1vZGFsID0gZnVuY3Rpb24gKG1ldGhvZCkge1xuICAgIGlmIChtZXRob2RzW21ldGhvZF0pIHtcbiAgICAgIHJldHVybiBtZXRob2RzW21ldGhvZF0uYXBwbHkodGhpcywgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgbWV0aG9kID09PSAnb2JqZWN0JyB8fCAhbWV0aG9kKSB7XG4gICAgICByZXR1cm4gbWV0aG9kcy5pbml0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgfSBlbHNlIHtcbiAgICAgICQuZXJyb3IoJ01ldGhvZCAnICsgbWV0aG9kICsgJyBkb2VzIG5vdCBleGlzdCBvbiBCb290c3RyYXAuWW91VHViZU1vZGFsJyk7XG4gICAgfVxuICB9O1xuXG4gIC8vZGVmYXVsdCBjb25maWd1cmF0aW9uXG4gICQuZm4uWW91VHViZU1vZGFsLmRlZmF1bHRzID0ge1xuICAgIHlvdXR1YmVJZDogJycsXG4gICAgdGl0bGU6ICcnLFxuICAgIHVzZVlvdVR1YmVUaXRsZTogdHJ1ZSxcbiAgICBpZEF0dHJpYnV0ZTogJ3JlbCcsXG4gICAgY3NzQ2xhc3M6ICdZb3VUdWJlTW9kYWwnLFxuICAgIHdpZHRoOiA2NDAsXG4gICAgaGVpZ2h0OiA0ODAsXG4gICAgYXV0b2hpZGU6IDIsXG4gICAgYXV0b3BsYXk6IDEsXG4gICAgY29sb3I6ICdyZWQnLFxuICAgIGNvbnRyb2xzOiAxLFxuICAgIGZzOiAxLFxuICAgIGxvb3A6IDAsXG4gICAgc2hvd2luZm86IDAsXG4gICAgdGhlbWU6ICdsaWdodCdcbiAgfTtcbn0pKGpRdWVyeSk7XG4iLCIvKiFcbiAqIEJvb3RzdHJhcCBZb3VUdWJlIFBvcHVwIFBsYXllciBQbHVnaW5cbiAqIGh0dHA6Ly9sYWIuYWJoaW5heXJhdGhvcmUuY29tL2Jvb3RzdHJhcC15b3V0dWJlL1xuICogaHR0cHM6Ly9naXRodWIuY29tL2FiaGluYXlyYXRob3JlL0Jvb3RzdHJhcC1Zb3V0dWJlLVBvcHVwLVBsYXllci1QbHVnaW5cbiAqL1xuIWZ1bmN0aW9uKG8pe2Z1bmN0aW9uIHQodCl7aC5odG1sKG8udHJpbSh0KSl9ZnVuY3Rpb24gZShvKXtiLmh0bWwobyl9ZnVuY3Rpb24gdSgpe3QoXCJcIiksZShcIlwiKX1mdW5jdGlvbiBhKG8pe2MuY3NzKHt3aWR0aDpvKzIqbX0pfWZ1bmN0aW9uIGkobyx0KXtyZXR1cm5bXCIvL3d3dy55b3V0dWJlLmNvbS9lbWJlZC9cIixvLFwiP3JlbD0wJnNob3dzZWFyY2g9MCZhdXRvaGlkZT1cIix0LmF1dG9oaWRlLFwiJmF1dG9wbGF5PVwiLHQuYXV0b3BsYXksXCImY29udHJvbHM9XCIsdC5jb250cm9scyxcIiZmcz1cIix0LmZzLFwiJmxvb3A9XCIsdC5sb29wLFwiJnNob3dpbmZvPVwiLHQuc2hvd2luZm8sXCImY29sb3I9XCIsdC5jb2xvcixcIiZ0aGVtZT1cIix0LnRoZW1lLFwiJndtb2RlPXRyYW5zcGFyZW50XCJdLmpvaW4oXCJcIil9ZnVuY3Rpb24gbChvLHQsZSl7cmV0dXJuWyc8aWZyYW1lIHRpdGxlPVwiWW91VHViZSB2aWRlbyBwbGF5ZXJcIiB3aWR0aD1cIicsdCwnXCIgaGVpZ2h0PVwiJyxlLCdcIiAnLCdzdHlsZT1cIm1hcmdpbjowOyBwYWRkaW5nOjA7IGJveC1zaXppbmc6Ym9yZGVyLWJveDsgYm9yZGVyOjA7IC13ZWJraXQtYm9yZGVyLXJhZGl1czo1cHg7IC1tb3otYm9yZGVyLXJhZGl1czo1cHg7IGJvcmRlci1yYWRpdXM6NXB4OyBtYXJnaW46JyxtLTEsJ3B4O1wiICcsJ3NyYz1cIicsbywnXCIgZnJhbWVib3JkZXI9XCIwXCIgYWxsb3dmdWxsc2NyZWVuIHNlYW1sZXNzPjwvaWZyYW1lPiddLmpvaW4oXCJcIil9ZnVuY3Rpb24gZChlKXtvLmFqYXgoe3VybDp3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wrXCIvL3F1ZXJ5LnlhaG9vYXBpcy5jb20vdjEvcHVibGljL3lxbFwiLGRhdGE6e3E6XCJzZWxlY3QgKiBmcm9tIGpzb24gd2hlcmUgdXJsID0naHR0cDovL3d3dy55b3V0dWJlLmNvbS9vZW1iZWQ/dXJsPWh0dHA6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1cIitlK1wiJmZvcm1hdD1qc29uJ1wiLGZvcm1hdDpcImpzb25cIn0sZGF0YVR5cGU6XCJqc29ucFwiLHN1Y2Nlc3M6ZnVuY3Rpb24obyl7byYmby5xdWVyeSYmby5xdWVyeS5yZXN1bHRzJiZvLnF1ZXJ5LnJlc3VsdHMuanNvbiYmdChvLnF1ZXJ5LnJlc3VsdHMuanNvbi50aXRsZSl9fSl9ZnVuY3Rpb24gcihvKXt2YXIgdD0vXi4qKHlvdXR1LmJlXFwvfHZcXC98dVxcL1xcd1xcL3xlbWJlZFxcL3x3YXRjaFxcP3Y9KShbXiNcXCZcXD9dKikuKi8sZT1vLm1hdGNoKHQpO3JldHVybiBlJiYxMT09ZVsyXS5sZW5ndGg/ZVsyXTohMX12YXIgbixzPW51bGwsYz1udWxsLGg9bnVsbCxiPW51bGwsbT01O249e2luaXQ6ZnVuY3Rpb24obil7aWYobj1vLmV4dGVuZCh7fSxvLmZuLllvdVR1YmVNb2RhbC5kZWZhdWx0cyxuKSxudWxsPT1zKXtzPW8oJzxkaXYgY2xhc3M9XCJtb2RhbCBmYWRlICcrbi5jc3NDbGFzcysnXCIgaWQ9XCJZb3VUdWJlTW9kYWxcIiByb2xlPVwiZGlhbG9nXCIgYXJpYS1oaWRkZW49XCJ0cnVlXCI+Jyk7dmFyIG09JzxkaXYgY2xhc3M9XCJtb2RhbC1kaWFsb2dcIiBpZD1cIllvdVR1YmVNb2RhbERpYWxvZ1wiPjxkaXYgY2xhc3M9XCJtb2RhbC1jb250ZW50XCIgaWQ9XCJZb3VUdWJlTW9kYWxDb250ZW50XCI+PGRpdiBjbGFzcz1cIm1vZGFsLWhlYWRlclwiPjxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiY2xvc2VcIiBkYXRhLWRpc21pc3M9XCJtb2RhbFwiPiZ0aW1lczs8L2J1dHRvbj48aDQgY2xhc3M9XCJtb2RhbC10aXRsZVwiIGlkPVwiWW91VHViZU1vZGFsVGl0bGVcIj48L2g0PjwvZGl2PjxkaXYgY2xhc3M9XCJtb2RhbC1ib2R5XCIgaWQ9XCJZb3VUdWJlTW9kYWxCb2R5XCIgc3R5bGU9XCJwYWRkaW5nOjA7XCI+PC9kaXY+PC9kaXY+PC9kaXY+JztzLmh0bWwobSkuaGlkZSgpLmFwcGVuZFRvKFwiYm9keVwiKSxjPW8oXCIjWW91VHViZU1vZGFsRGlhbG9nXCIpLGg9byhcIiNZb3VUdWJlTW9kYWxUaXRsZVwiKSxiPW8oXCIjWW91VHViZU1vZGFsQm9keVwiKSxzLm1vZGFsKHtzaG93OiExfSkub24oXCJoaWRlLmJzLm1vZGFsXCIsdSl9cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciB1PW8odGhpcyksYz11LmRhdGEoXCJZb3VUdWJlXCIpO2N8fCh1LmRhdGEoXCJZb3VUdWJlXCIse3RhcmdldDp1fSksbyh1KS5iaW5kKFwiY2xpY2suWW91VHViZU1vZGFsXCIsZnVuY3Rpb24oYyl7dmFyIGg9bi55b3V0dWJlSWQ7XCJcIj09by50cmltKGgpJiZ1LmlzKFwiYVwiKSYmKGg9cih1LmF0dHIoXCJocmVmXCIpKSksKFwiXCI9PW8udHJpbShoKXx8aD09PSExKSYmKGg9dS5hdHRyKG4uaWRBdHRyaWJ1dGUpKTt2YXIgYj1vLnRyaW0obi50aXRsZSk7XCJcIj09YiYmKG4udXNlWW91VHViZVRpdGxlP2QoaCk6Yj11LmF0dHIoXCJ0aXRsZVwiKSksYiYmdChiKSxhKG4ud2lkdGgpO3ZhciBtPWkoaCxuKSxmPWwobSxuLndpZHRoLG4uaGVpZ2h0KTtlKGYpLHMubW9kYWwoXCJzaG93XCIpLGMucHJldmVudERlZmF1bHQoKX0pKX0pfSxkZXN0cm95OmZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe28odGhpcykudW5iaW5kKFwiLllvdVR1YmVNb2RhbFwiKS5yZW1vdmVEYXRhKFwiWW91VHViZVwiKX0pfX0sby5mbi5Zb3VUdWJlTW9kYWw9ZnVuY3Rpb24odCl7cmV0dXJuIG5bdF0/blt0XS5hcHBseSh0aGlzLEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywxKSk6XCJvYmplY3RcIiE9dHlwZW9mIHQmJnQ/dm9pZCBvLmVycm9yKFwiTWV0aG9kIFwiK3QrXCIgZG9lcyBub3QgZXhpc3Qgb24gQm9vdHN0cmFwLllvdVR1YmVNb2RhbFwiKTpuLmluaXQuYXBwbHkodGhpcyxhcmd1bWVudHMpfSxvLmZuLllvdVR1YmVNb2RhbC5kZWZhdWx0cz17eW91dHViZUlkOlwiXCIsdGl0bGU6XCJcIix1c2VZb3VUdWJlVGl0bGU6ITAsaWRBdHRyaWJ1dGU6XCJyZWxcIixjc3NDbGFzczpcIllvdVR1YmVNb2RhbFwiLHdpZHRoOjY0MCxoZWlnaHQ6NDgwLGF1dG9oaWRlOjIsYXV0b3BsYXk6MSxjb2xvcjpcInJlZFwiLGNvbnRyb2xzOjEsZnM6MSxsb29wOjAsc2hvd2luZm86MCx0aGVtZTpcImxpZ2h0XCJ9fShqUXVlcnkpO1xuIiwiLyohXG4gKiBCb290c3RyYXAgWW91VHViZSBQb3B1cCBQbGF5ZXIgUGx1Z2luXG4gKiBodHRwOi8vbGFiLmFiaGluYXlyYXRob3JlLmNvbS9ib290c3RyYXAteW91dHViZS9cbiAqIGh0dHBzOi8vZ2l0aHViLmNvbS9hYmhpbmF5cmF0aG9yZS9Cb290c3RyYXAtWW91dHViZS1Qb3B1cC1QbGF5ZXItUGx1Z2luXG4gKi9cbihmdW5jdGlvbiAoJCkge1xuICB2YXIgJFlvdVR1YmVNb2RhbCA9IG51bGwsXG4gICAgJFlvdVR1YmVNb2RhbERpYWxvZyA9IG51bGwsXG4gICAgJFlvdVR1YmVNb2RhbFRpdGxlID0gbnVsbCxcbiAgICAkWW91VHViZU1vZGFsQm9keSA9IG51bGwsXG4gICAgbWFyZ2luID0gNSxcbiAgICBtZXRob2RzO1xuXG4gIC8vUGx1Z2luIG1ldGhvZHNcbiAgbWV0aG9kcyA9IHtcbiAgICAvL2luaXRpYWxpemUgcGx1Z2luXG4gICAgaW5pdDogZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgIG9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgJC5mbi5Zb3VUdWJlTW9kYWwuZGVmYXVsdHMsIG9wdGlvbnMpO1xuXG4gICAgICAvLyBpbml0aWFsaXplIFlvdVR1YmUgUGxheWVyIE1vZGFsXG4gICAgICBpZiAoJFlvdVR1YmVNb2RhbCA9PSBudWxsKSB7XG4gICAgICAgICRZb3VUdWJlTW9kYWwgPSAkKCc8ZGl2IGNsYXNzPVwibW9kYWwgZmFkZSAnICsgb3B0aW9ucy5jc3NDbGFzcyArICdcIiBpZD1cIllvdVR1YmVNb2RhbFwiIHJvbGU9XCJkaWFsb2dcIiBhcmlhLWhpZGRlbj1cInRydWVcIj4nKTtcbiAgICAgICAgdmFyIG1vZGFsQ29udGVudCA9ICc8ZGl2IGNsYXNzPVwibW9kYWwtZGlhbG9nXCIgaWQ9XCJZb3VUdWJlTW9kYWxEaWFsb2dcIj4nICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwibW9kYWwtY29udGVudFwiIGlkPVwiWW91VHViZU1vZGFsQ29udGVudFwiPicgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cIm1vZGFsLWhlYWRlclwiPicgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8YnV0dG9uIHR5cGU9XCJidXR0b25cIiBjbGFzcz1cImNsb3NlXCIgZGF0YS1kaXNtaXNzPVwibW9kYWxcIj4mdGltZXM7PC9idXR0b24+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxoNCBjbGFzcz1cIm1vZGFsLXRpdGxlXCIgaWQ9XCJZb3VUdWJlTW9kYWxUaXRsZVwiPjwvaDQ+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJtb2RhbC1ib2R5XCIgaWQ9XCJZb3VUdWJlTW9kYWxCb2R5XCIgc3R5bGU9XCJwYWRkaW5nOjA7XCI+PC9kaXY+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvZGl2Pic7XG4gICAgICAgICRZb3VUdWJlTW9kYWwuaHRtbChtb2RhbENvbnRlbnQpLmhpZGUoKS5hcHBlbmRUbygnYm9keScpO1xuICAgICAgICAkWW91VHViZU1vZGFsRGlhbG9nID0gJChcIiNZb3VUdWJlTW9kYWxEaWFsb2dcIik7XG4gICAgICAgICRZb3VUdWJlTW9kYWxUaXRsZSA9ICQoXCIjWW91VHViZU1vZGFsVGl0bGVcIik7XG4gICAgICAgICRZb3VUdWJlTW9kYWxCb2R5ID0gJChcIiNZb3VUdWJlTW9kYWxCb2R5XCIpO1xuICAgICAgICAkWW91VHViZU1vZGFsLm1vZGFsKHtcbiAgICAgICAgICBzaG93OiBmYWxzZVxuICAgICAgICB9KS5vbignaGlkZS5icy5tb2RhbCcsIHJlc2V0TW9kYWxCb2R5KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBvYmogPSAkKHRoaXMpO1xuICAgICAgICB2YXIgZGF0YSA9IG9iai5kYXRhKCdZb3VUdWJlJyk7XG4gICAgICAgIGlmICghZGF0YSkgeyAvL2NoZWNrIGlmIGV2ZW50IGlzIGFscmVhZHkgYXNzaWduZWRcbiAgICAgICAgICBvYmouZGF0YSgnWW91VHViZScsIHtcbiAgICAgICAgICAgIHRhcmdldDogb2JqXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgJChvYmopLmJpbmQoJ2NsaWNrLllvdVR1YmVNb2RhbCcsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgdmFyIHlvdXR1YmVJZCA9IG9wdGlvbnMueW91dHViZUlkO1xuICAgICAgICAgICAgaWYgKCQudHJpbSh5b3V0dWJlSWQpID09ICcnICYmIG9iai5pcyhcImFcIikpIHtcbiAgICAgICAgICAgICAgeW91dHViZUlkID0gZ2V0WW91VHViZUlkRnJvbVVybChvYmouYXR0cihcImhyZWZcIikpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCQudHJpbSh5b3V0dWJlSWQpID09ICcnIHx8IHlvdXR1YmVJZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgeW91dHViZUlkID0gb2JqLmF0dHIob3B0aW9ucy5pZEF0dHJpYnV0ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgdmlkZW9UaXRsZSA9ICQudHJpbShvcHRpb25zLnRpdGxlKTtcbiAgICAgICAgICAgIGlmICh2aWRlb1RpdGxlID09ICcnKSB7XG4gICAgICAgICAgICAgIGlmIChvcHRpb25zLnVzZVlvdVR1YmVUaXRsZSkgc2V0WW91VHViZVRpdGxlKHlvdXR1YmVJZCk7XG4gICAgICAgICAgICAgIGVsc2UgdmlkZW9UaXRsZSA9IG9iai5hdHRyKCd0aXRsZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHZpZGVvVGl0bGUpIHtcbiAgICAgICAgICAgICAgc2V0TW9kYWxUaXRsZSh2aWRlb1RpdGxlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmVzaXplTW9kYWwob3B0aW9ucy53aWR0aCk7XG5cbiAgICAgICAgICAgIC8vU2V0dXAgWW91VHViZSBNb2RhbFxuICAgICAgICAgICAgdmFyIFlvdVR1YmVVUkwgPSBnZXRZb3VUdWJlVXJsKHlvdXR1YmVJZCwgb3B0aW9ucyk7XG4gICAgICAgICAgICB2YXIgWW91VHViZVBsYXllcklmcmFtZSA9IGdldFlvdVR1YmVQbGF5ZXIoWW91VHViZVVSTCwgb3B0aW9ucy53aWR0aCwgb3B0aW9ucy5oZWlnaHQpO1xuICAgICAgICAgICAgc2V0TW9kYWxCb2R5KFlvdVR1YmVQbGF5ZXJJZnJhbWUpO1xuICAgICAgICAgICAgJFlvdVR1YmVNb2RhbC5tb2RhbCgnc2hvdycpO1xuXG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9LFxuICAgIGRlc3Ryb3k6IGZ1bmN0aW9uICgpIHtcbiAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAkKHRoaXMpLnVuYmluZChcIi5Zb3VUdWJlTW9kYWxcIikucmVtb3ZlRGF0YSgnWW91VHViZScpO1xuICAgICAgfSk7XG4gICAgfVxuICB9O1xuXG4gIGZ1bmN0aW9uIHNldE1vZGFsVGl0bGUodGl0bGUpIHtcbiAgICAkWW91VHViZU1vZGFsVGl0bGUuaHRtbCgkLnRyaW0odGl0bGUpKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNldE1vZGFsQm9keShjb250ZW50KSB7XG4gICAgJFlvdVR1YmVNb2RhbEJvZHkuaHRtbChjb250ZW50KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlc2V0TW9kYWxCb2R5KCkge1xuICAgIHNldE1vZGFsVGl0bGUoJycpO1xuICAgIHNldE1vZGFsQm9keSgnJyk7XG4gIH1cblxuICBmdW5jdGlvbiByZXNpemVNb2RhbCh3KSB7XG4gICAgJFlvdVR1YmVNb2RhbERpYWxvZy5jc3Moe1xuICAgICAgd2lkdGg6IHcgKyAobWFyZ2luICogMilcbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldFlvdVR1YmVVcmwoeW91dHViZUlkLCBvcHRpb25zKSB7XG4gICAgcmV0dXJuIFtcIi8vd3d3LnlvdXR1YmUuY29tL2VtYmVkL1wiLCB5b3V0dWJlSWQsIFwiP3JlbD0wJnNob3dzZWFyY2g9MCZhdXRvaGlkZT1cIiwgb3B0aW9ucy5hdXRvaGlkZSxcbiAgICAgIFwiJmF1dG9wbGF5PVwiLCBvcHRpb25zLmF1dG9wbGF5LCBcIiZjb250cm9scz1cIiwgb3B0aW9ucy5jb250cm9scywgXCImZnM9XCIsIG9wdGlvbnMuZnMsIFwiJmxvb3A9XCIsIG9wdGlvbnMubG9vcCxcbiAgICAgIFwiJnNob3dpbmZvPVwiLCBvcHRpb25zLnNob3dpbmZvLCBcIiZjb2xvcj1cIiwgb3B0aW9ucy5jb2xvciwgXCImdGhlbWU9XCIsIG9wdGlvbnMudGhlbWUsIFwiJndtb2RlPXRyYW5zcGFyZW50XCJcbiAgICBdLmpvaW4oJycpO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0WW91VHViZVBsYXllcihVUkwsIHdpZHRoLCBoZWlnaHQpIHtcbiAgICByZXR1cm4gWyc8aWZyYW1lIHRpdGxlPVwiWW91VHViZSB2aWRlbyBwbGF5ZXJcIiB3aWR0aD1cIicsIHdpZHRoLCAnXCIgaGVpZ2h0PVwiJywgaGVpZ2h0LCAnXCIgJyxcbiAgICAgICdzdHlsZT1cIm1hcmdpbjowOyBwYWRkaW5nOjA7IGJveC1zaXppbmc6Ym9yZGVyLWJveDsgYm9yZGVyOjA7IC13ZWJraXQtYm9yZGVyLXJhZGl1czo1cHg7IC1tb3otYm9yZGVyLXJhZGl1czo1cHg7IGJvcmRlci1yYWRpdXM6NXB4OyBtYXJnaW46JywgKG1hcmdpbiAtIDEpLCAncHg7XCIgJyxcbiAgICAgICdzcmM9XCInLCBVUkwsICdcIiBmcmFtZWJvcmRlcj1cIjBcIiBhbGxvd2Z1bGxzY3JlZW4gc2VhbWxlc3M+PC9pZnJhbWU+J1xuICAgIF0uam9pbignJyk7XG4gIH1cblxuICBmdW5jdGlvbiBzZXRZb3VUdWJlVGl0bGUoeW91dHViZUlkKSB7XG4gICAgJC5hamF4KHtcbiAgICAgIHVybDogd2luZG93LmxvY2F0aW9uLnByb3RvY29sICsgJy8vcXVlcnkueWFob29hcGlzLmNvbS92MS9wdWJsaWMveXFsJyxcbiAgICAgIGRhdGE6IHtcbiAgICAgICAgcTogXCJzZWxlY3QgKiBmcm9tIGpzb24gd2hlcmUgdXJsID0naHR0cDovL3d3dy55b3V0dWJlLmNvbS9vZW1iZWQ/dXJsPWh0dHA6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1cIiArIHlvdXR1YmVJZCArIFwiJmZvcm1hdD1qc29uJ1wiLFxuICAgICAgICBmb3JtYXQ6IFwianNvblwiXG4gICAgICB9LFxuICAgICAgZGF0YVR5cGU6IFwianNvbnBcIixcbiAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uIChkYXRhKSB7XG4gICAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS5xdWVyeSAmJiBkYXRhLnF1ZXJ5LnJlc3VsdHMgJiYgZGF0YS5xdWVyeS5yZXN1bHRzLmpzb24pIHtcbiAgICAgICAgICAgIHNldE1vZGFsVGl0bGUoZGF0YS5xdWVyeS5yZXN1bHRzLmpzb24udGl0bGUpO1xuICAgICAgICAgIH1cbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGZ1bmN0aW9uIGdldFlvdVR1YmVJZEZyb21VcmwoeW91dHViZVVybCkge1xuICAgIHZhciByZWdFeHAgPSAvXi4qKHlvdXR1LmJlXFwvfHZcXC98dVxcL1xcd1xcL3xlbWJlZFxcL3x3YXRjaFxcP3Y9KShbXiNcXCZcXD9dKikuKi87XG4gICAgdmFyIG1hdGNoID0geW91dHViZVVybC5tYXRjaChyZWdFeHApO1xuICAgIGlmIChtYXRjaCAmJiBtYXRjaFsyXS5sZW5ndGggPT0gMTEpIHtcbiAgICAgIHJldHVybiBtYXRjaFsyXTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfVxuXG4gICQuZm4uWW91VHViZU1vZGFsID0gZnVuY3Rpb24gKG1ldGhvZCkge1xuICAgIGlmIChtZXRob2RzW21ldGhvZF0pIHtcbiAgICAgIHJldHVybiBtZXRob2RzW21ldGhvZF0uYXBwbHkodGhpcywgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2YgbWV0aG9kID09PSAnb2JqZWN0JyB8fCAhbWV0aG9kKSB7XG4gICAgICByZXR1cm4gbWV0aG9kcy5pbml0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgfSBlbHNlIHtcbiAgICAgICQuZXJyb3IoJ01ldGhvZCAnICsgbWV0aG9kICsgJyBkb2VzIG5vdCBleGlzdCBvbiBCb290c3RyYXAuWW91VHViZU1vZGFsJyk7XG4gICAgfVxuICB9O1xuXG4gIC8vZGVmYXVsdCBjb25maWd1cmF0aW9uXG4gICQuZm4uWW91VHViZU1vZGFsLmRlZmF1bHRzID0ge1xuICAgIHlvdXR1YmVJZDogJycsXG4gICAgdGl0bGU6ICcnLFxuICAgIHVzZVlvdVR1YmVUaXRsZTogdHJ1ZSxcbiAgICBpZEF0dHJpYnV0ZTogJ3JlbCcsXG4gICAgY3NzQ2xhc3M6ICdZb3VUdWJlTW9kYWwnLFxuICAgIHdpZHRoOiA2NDAsXG4gICAgaGVpZ2h0OiA0ODAsXG4gICAgYXV0b2hpZGU6IDIsXG4gICAgYXV0b3BsYXk6IDEsXG4gICAgY29sb3I6ICdyZWQnLFxuICAgIGNvbnRyb2xzOiAxLFxuICAgIGZzOiAxLFxuICAgIGxvb3A6IDAsXG4gICAgc2hvd2luZm86IDAsXG4gICAgdGhlbWU6ICdsaWdodCdcbiAgfTtcbn0pKGpRdWVyeSk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
