/*!
 * ZeroClipboard
 * The ZeroClipboard library provides an easy way to copy text to the clipboard using an invisible Adobe Flash movie and a JavaScript interface.
 * Copyright (c) 2009-2015 Jon Rohan, James M. Greene
 * Licensed MIT
 * http://zeroclipboard.org/
 * v2.3.0-beta.1
 */
!function(a,b){"use strict";var c,d,e,f=a,g=f.document,h=f.navigator,i=f.setTimeout,j=f.clearTimeout,k=f.setInterval,l=f.clearInterval,m=f.getComputedStyle,n=f.encodeURIComponent,o=f.ActiveXObject,p=f.Error,q=f.Number.parseInt||f.parseInt,r=f.Number.parseFloat||f.parseFloat,s=f.Number.isNaN||f.isNaN,t=f.Date.now,u=f.Object.keys,v=f.Object.defineProperty,w=f.Object.prototype.hasOwnProperty,x=f.Array.prototype.slice,y=function(){var a=function(a){return a};if("function"==typeof f.wrap&&"function"==typeof f.unwrap)try{var b=g.createElement("div"),c=f.unwrap(b);1===b.nodeType&&c&&1===c.nodeType&&(a=f.unwrap)}catch(d){}return a}(),z=function(a){return x.call(a,0)},A=function(){var a,c,d,e,f,g,h=z(arguments),i=h[0]||{};for(a=1,c=h.length;c>a;a++)if(null!=(d=h[a]))for(e in d)w.call(d,e)&&(f=i[e],g=d[e],i!==g&&g!==b&&(i[e]=g));return i},B=function(a){var b,c,d,e;if("object"!=typeof a||null==a||"number"==typeof a.nodeType)b=a;else if("number"==typeof a.length)for(b=[],c=0,d=a.length;d>c;c++)w.call(a,c)&&(b[c]=B(a[c]));else{b={};for(e in a)w.call(a,e)&&(b[e]=B(a[e]))}return b},C=function(a,b){for(var c={},d=0,e=b.length;e>d;d++)b[d]in a&&(c[b[d]]=a[b[d]]);return c},D=function(a,b){var c={};for(var d in a)-1===b.indexOf(d)&&(c[d]=a[d]);return c},E=function(a){if(a)for(var b in a)w.call(a,b)&&delete a[b];return a},F=function(a,b){if(a&&1===a.nodeType&&a.ownerDocument&&b&&(1===b.nodeType&&b.ownerDocument&&b.ownerDocument===a.ownerDocument||9===b.nodeType&&!b.ownerDocument&&b===a.ownerDocument))do{if(a===b)return!0;a=a.parentNode}while(a);return!1},G=function(a){var b;return"string"==typeof a&&a&&(b=a.split("#")[0].split("?")[0],b=a.slice(0,a.lastIndexOf("/")+1)),b},H=function(a){var b,c;return"string"==typeof a&&a&&(c=a.match(/^(?:|[^:@]*@|.+\)@(?=http[s]?|file)|.+?\s+(?: at |@)(?:[^:\(]+ )*[\(]?)((?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/),c&&c[1]?b=c[1]:(c=a.match(/\)@((?:http[s]?|file):\/\/[\/]?.+?\/[^:\)]*?)(?::\d+)(?::\d+)?/),c&&c[1]&&(b=c[1]))),b},I=function(){var a,b;try{throw new p}catch(c){b=c}return b&&(a=b.sourceURL||b.fileName||H(b.stack)),a},J=function(){var a,c,d;if(g.currentScript&&(a=g.currentScript.src))return a;if(c=g.getElementsByTagName("script"),1===c.length)return c[0].src||b;if("readyState"in c[0])for(d=c.length;d--;)if("interactive"===c[d].readyState&&(a=c[d].src))return a;return"loading"===g.readyState&&(a=c[c.length-1].src)?a:(a=I())?a:b},K=function(){var a,c,d,e=g.getElementsByTagName("script");for(a=e.length;a--;){if(!(d=e[a].src)){c=null;break}if(d=G(d),null==c)c=d;else if(c!==d){c=null;break}}return c||b},L=function(){var a=G(J())||K()||"";return a+"ZeroClipboard.swf"},M=function(){var a=/win(dows|[\s]?(nt|me|ce|xp|vista|[\d]+))/i;return!!h&&(a.test(h.appVersion||"")||a.test(h.platform||"")||-1!==(h.userAgent||"").indexOf("Windows"))},N=function(){return null==a.opener&&(!!a.top&&a!=a.top||!!a.parent&&a!=a.parent)}(),O={bridge:null,version:"0.0.0",pluginType:"unknown",disabled:null,outdated:null,sandboxed:null,unavailable:null,degraded:null,deactivated:null,overdue:null,ready:null},P="11.0.0",Q={},R={},S=null,T=0,U=0,V={ready:"Flash communication is established",error:{"flash-disabled":"Flash is disabled or not installed. May also be attempting to run Flash in a sandboxed iframe, which is impossible.","flash-outdated":"Flash is too outdated to support ZeroClipboard","flash-sandboxed":"Attempting to run Flash in a sandboxed iframe, which is impossible","flash-unavailable":"Flash is unable to communicate bidirectionally with JavaScript","flash-degraded":"Flash is unable to preserve data fidelity when communicating with JavaScript","flash-deactivated":"Flash is too outdated for your browser and/or is configured as click-to-activate.\nThis may also mean that the ZeroClipboard SWF object could not be loaded, so please check your `swfPath` configuration and/or network connectivity.\nMay also be attempting to run Flash in a sandboxed iframe, which is impossible.","flash-overdue":"Flash communication was established but NOT within the acceptable time limit","version-mismatch":"ZeroClipboard JS version number does not match ZeroClipboard SWF version number","clipboard-error":"At least one error was thrown while ZeroClipboard was attempting to inject your data into the clipboard","config-mismatch":"ZeroClipboard configuration does not match Flash's reality","swf-not-found":"The ZeroClipboard SWF object could not be loaded, so please check your `swfPath` configuration and/or network connectivity"}},W=["flash-unavailable","flash-degraded","flash-overdue","version-mismatch","config-mismatch","clipboard-error"],X=["flash-disabled","flash-outdated","flash-sandboxed","flash-unavailable","flash-degraded","flash-deactivated","flash-overdue"],Y=new RegExp("^flash-("+X.map(function(a){return a.replace(/^flash-/,"")}).join("|")+")$"),Z=new RegExp("^flash-("+X.slice(1).map(function(a){return a.replace(/^flash-/,"")}).join("|")+")$"),$={swfPath:L(),trustedDomains:a.location.host?[a.location.host]:[],cacheBust:!0,forceEnhancedClipboard:!1,flashLoadTimeout:3e4,autoActivate:!0,bubbleEvents:!0,fixLineEndings:!0,containerId:"global-zeroclipboard-html-bridge",containerClass:"global-zeroclipboard-container",swfObjectId:"global-zeroclipboard-flash-bridge",hoverClass:"zeroclipboard-is-hover",activeClass:"zeroclipboard-is-active",forceHandCursor:!1,title:null,zIndex:999999999},_=function(a){if("object"==typeof a&&null!==a)for(var b in a)if(w.call(a,b))if(/^(?:forceHandCursor|title|zIndex|bubbleEvents|fixLineEndings)$/.test(b))$[b]=a[b];else if(null==O.bridge)if("containerId"===b||"swfObjectId"===b){if(!oa(a[b]))throw new Error("The specified `"+b+"` value is not valid as an HTML4 Element ID");$[b]=a[b]}else $[b]=a[b];{if("string"!=typeof a||!a)return B($);if(w.call($,a))return $[a]}},aa=function(){return Va(),{browser:C(h,["userAgent","platform","appName","appVersion"]),flash:D(O,["bridge"]),zeroclipboard:{version:Xa.version,config:Xa.config()}}},ba=function(){return!!(O.disabled||O.outdated||O.sandboxed||O.unavailable||O.degraded||O.deactivated)},ca=function(a,d){var e,f,g,h={};if("string"==typeof a&&a)g=a.toLowerCase().split(/\s+/);else if("object"==typeof a&&a&&"undefined"==typeof d)for(e in a)w.call(a,e)&&"string"==typeof e&&e&&"function"==typeof a[e]&&Xa.on(e,a[e]);if(g&&g.length){for(e=0,f=g.length;f>e;e++)a=g[e].replace(/^on/,""),h[a]=!0,Q[a]||(Q[a]=[]),Q[a].push(d);if(h.ready&&O.ready&&Xa.emit({type:"ready"}),h.error){for(e=0,f=X.length;f>e;e++)if(O[X[e].replace(/^flash-/,"")]===!0){Xa.emit({type:"error",name:X[e]});break}c!==b&&Xa.version!==c&&Xa.emit({type:"error",name:"version-mismatch",jsVersion:Xa.version,swfVersion:c})}}return Xa},da=function(a,b){var c,d,e,f,g;if(0===arguments.length)f=u(Q);else if("string"==typeof a&&a)f=a.split(/\s+/);else if("object"==typeof a&&a&&"undefined"==typeof b)for(c in a)w.call(a,c)&&"string"==typeof c&&c&&"function"==typeof a[c]&&Xa.off(c,a[c]);if(f&&f.length)for(c=0,d=f.length;d>c;c++)if(a=f[c].toLowerCase().replace(/^on/,""),g=Q[a],g&&g.length)if(b)for(e=g.indexOf(b);-1!==e;)g.splice(e,1),e=g.indexOf(b,e);else g.length=0;return Xa},ea=function(a){var b;return b="string"==typeof a&&a?B(Q[a])||null:B(Q)},fa=function(a){var b,c,d;return a=pa(a),a&&!wa(a)?"ready"===a.type&&O.overdue===!0?Xa.emit({type:"error",name:"flash-overdue"}):(b=A({},a),ua.call(this,b),"copy"===a.type&&(d=Ea(R),c=d.data,S=d.formatMap),c):void 0},ga=function(){var a=O.sandboxed;if(Va(),"boolean"!=typeof O.ready&&(O.ready=!1),O.sandboxed!==a&&O.sandboxed===!0)O.ready=!1,Xa.emit({type:"error",name:"flash-sandboxed"});else if(!Xa.isFlashUnusable()&&null===O.bridge){var b=$.flashLoadTimeout;"number"==typeof b&&b>=0&&(T=i(function(){"boolean"!=typeof O.deactivated&&(O.deactivated=!0),O.deactivated===!0&&Xa.emit({type:"error",name:"flash-deactivated"})},b)),O.overdue=!1,Ca()}},ha=function(){Xa.clearData(),Xa.blur(),Xa.emit("destroy"),Da(),Xa.off()},ia=function(a,b){var c;if("object"==typeof a&&a&&"undefined"==typeof b)c=a,Xa.clearData();else{if("string"!=typeof a||!a)return;c={},c[a]=b}for(var d in c)"string"==typeof d&&d&&w.call(c,d)&&"string"==typeof c[d]&&c[d]&&(R[d]=Ua(c[d]))},ja=function(a){"undefined"==typeof a?(E(R),S=null):"string"==typeof a&&w.call(R,a)&&delete R[a]},ka=function(a){return"undefined"==typeof a?B(R):"string"==typeof a&&w.call(R,a)?R[a]:void 0},la=function(a){if(a&&1===a.nodeType){d&&(Ma(d,$.activeClass),d!==a&&Ma(d,$.hoverClass)),d=a,La(a,$.hoverClass);var b=a.getAttribute("title")||$.title;if("string"==typeof b&&b){var c=Ba(O.bridge);c&&c.setAttribute("title",b)}var e=$.forceHandCursor===!0||"pointer"===Na(a,"cursor");Sa(e),Ra()}},ma=function(){var a=Ba(O.bridge);a&&(a.removeAttribute("title"),a.style.left="0px",a.style.top="-9999px",a.style.width="1px",a.style.height="1px"),d&&(Ma(d,$.hoverClass),Ma(d,$.activeClass),d=null)},na=function(){return d||null},oa=function(a){return"string"==typeof a&&a&&/^[A-Za-z][A-Za-z0-9_:\-\.]*$/.test(a)},pa=function(a){var b;if("string"==typeof a&&a?(b=a,a={}):"object"==typeof a&&a&&"string"==typeof a.type&&a.type&&(b=a.type),b){b=b.toLowerCase(),!a.target&&(/^(copy|aftercopy|_click)$/.test(b)||"error"===b&&"clipboard-error"===a.name)&&(a.target=e),A(a,{type:b,target:a.target||d||null,relatedTarget:a.relatedTarget||null,currentTarget:O&&O.bridge||null,timeStamp:a.timeStamp||t()||null});var c=V[a.type];return"error"===a.type&&a.name&&c&&(c=c[a.name]),c&&(a.message=c),"ready"===a.type&&A(a,{target:null,version:O.version}),"error"===a.type&&(Y.test(a.name)&&A(a,{target:null,minimumVersion:P}),Z.test(a.name)&&A(a,{version:O.version})),"copy"===a.type&&(a.clipboardData={setData:Xa.setData,clearData:Xa.clearData}),"aftercopy"===a.type&&(a=Fa(a,S)),a.target&&!a.relatedTarget&&(a.relatedTarget=qa(a.target)),ra(a)}},qa=function(a){var b=a&&a.getAttribute&&a.getAttribute("data-clipboard-target");return b?g.getElementById(b):null},ra=function(a){if(a&&/^_(?:click|mouse(?:over|out|down|up|move))$/.test(a.type)){var c=a.target,d="_mouseover"===a.type&&a.relatedTarget?a.relatedTarget:b,e="_mouseout"===a.type&&a.relatedTarget?a.relatedTarget:b,h=Oa(c),i=f.screenLeft||f.screenX||0,j=f.screenTop||f.screenY||0,k=g.body.scrollLeft+g.documentElement.scrollLeft,l=g.body.scrollTop+g.documentElement.scrollTop,m=h.left+("number"==typeof a._stageX?a._stageX:0),n=h.top+("number"==typeof a._stageY?a._stageY:0),o=m-k,p=n-l,q=i+o,r=j+p,s="number"==typeof a.movementX?a.movementX:0,t="number"==typeof a.movementY?a.movementY:0;delete a._stageX,delete a._stageY,A(a,{srcElement:c,fromElement:d,toElement:e,screenX:q,screenY:r,pageX:m,pageY:n,clientX:o,clientY:p,x:o,y:p,movementX:s,movementY:t,offsetX:0,offsetY:0,layerX:0,layerY:0})}return a},sa=function(a){var b=a&&"string"==typeof a.type&&a.type||"";return!/^(?:(?:before)?copy|destroy)$/.test(b)},ta=function(a,b,c,d){d?i(function(){a.apply(b,c)},0):a.apply(b,c)},ua=function(a){if("object"==typeof a&&a&&a.type){var b=sa(a),c=Q["*"]||[],d=Q[a.type]||[],e=c.concat(d);if(e&&e.length){var g,h,i,j,k,l=this;for(g=0,h=e.length;h>g;g++)i=e[g],j=l,"string"==typeof i&&"function"==typeof f[i]&&(i=f[i]),"object"==typeof i&&i&&"function"==typeof i.handleEvent&&(j=i,i=i.handleEvent),"function"==typeof i&&(k=A({},a),ta(i,j,[k],b))}return this}},va=function(a){var b=null;return(N===!1||a&&"error"===a.type&&a.name&&-1!==W.indexOf(a.name))&&(b=!1),b},wa=function(a){var b=a.target||d||null,f="swf"===a._source;switch(delete a._source,a.type){case"error":var g="flash-sandboxed"===a.name||va(a);"boolean"==typeof g&&(O.sandboxed=g),-1!==X.indexOf(a.name)?A(O,{disabled:"flash-disabled"===a.name,outdated:"flash-outdated"===a.name,unavailable:"flash-unavailable"===a.name,degraded:"flash-degraded"===a.name,deactivated:"flash-deactivated"===a.name,overdue:"flash-overdue"===a.name,ready:!1}):"version-mismatch"===a.name&&(c=a.swfVersion,A(O,{disabled:!1,outdated:!1,unavailable:!1,degraded:!1,deactivated:!1,overdue:!1,ready:!1})),Qa();break;case"ready":c=a.swfVersion;var h=O.deactivated===!0;A(O,{disabled:!1,outdated:!1,sandboxed:!1,unavailable:!1,degraded:!1,deactivated:!1,overdue:h,ready:!h}),Qa();break;case"beforecopy":e=b;break;case"copy":var i,j,k=a.relatedTarget;!R["text/html"]&&!R["text/plain"]&&k&&(j=k.value||k.outerHTML||k.innerHTML)&&(i=k.value||k.textContent||k.innerText)?(a.clipboardData.clearData(),a.clipboardData.setData("text/plain",i),j!==i&&a.clipboardData.setData("text/html",j)):!R["text/plain"]&&a.target&&(i=a.target.getAttribute("data-clipboard-text"))&&(a.clipboardData.clearData(),a.clipboardData.setData("text/plain",i));break;case"aftercopy":xa(a),Xa.clearData(),b&&b!==Ka()&&b.focus&&b.focus();break;case"_mouseover":Xa.focus(b),$.bubbleEvents===!0&&f&&(b&&b!==a.relatedTarget&&!F(a.relatedTarget,b)&&ya(A({},a,{type:"mouseenter",bubbles:!1,cancelable:!1})),ya(A({},a,{type:"mouseover"})));break;case"_mouseout":Xa.blur(),$.bubbleEvents===!0&&f&&(b&&b!==a.relatedTarget&&!F(a.relatedTarget,b)&&ya(A({},a,{type:"mouseleave",bubbles:!1,cancelable:!1})),ya(A({},a,{type:"mouseout"})));break;case"_mousedown":La(b,$.activeClass),$.bubbleEvents===!0&&f&&ya(A({},a,{type:a.type.slice(1)}));break;case"_mouseup":Ma(b,$.activeClass),$.bubbleEvents===!0&&f&&ya(A({},a,{type:a.type.slice(1)}));break;case"_click":e=null,$.bubbleEvents===!0&&f&&ya(A({},a,{type:a.type.slice(1)}));break;case"_mousemove":$.bubbleEvents===!0&&f&&ya(A({},a,{type:a.type.slice(1)}))}return/^_(?:click|mouse(?:over|out|down|up|move))$/.test(a.type)?!0:void 0},xa=function(a){if(a.errors&&a.errors.length>0){var b=B(a);A(b,{type:"error",name:"clipboard-error"}),delete b.success,i(function(){Xa.emit(b)},0)}},ya=function(a){if(a&&"string"==typeof a.type&&a){var b,c=a.target||null,d=c&&c.ownerDocument||g,e={view:d.defaultView||f,canBubble:!0,cancelable:!0,detail:"click"===a.type?1:0,button:"number"==typeof a.which?a.which-1:"number"==typeof a.button?a.button:d.createEvent?0:1},h=A(e,a);c&&d.createEvent&&c.dispatchEvent&&(h=[h.type,h.canBubble,h.cancelable,h.view,h.detail,h.screenX,h.screenY,h.clientX,h.clientY,h.ctrlKey,h.altKey,h.shiftKey,h.metaKey,h.button,h.relatedTarget],b=d.createEvent("MouseEvents"),b.initMouseEvent&&(b.initMouseEvent.apply(b,h),b._source="js",c.dispatchEvent(b)))}},za=function(){var a=$.flashLoadTimeout;if("number"==typeof a&&a>=0){var b=Math.min(1e3,a/10),c=$.swfObjectId+"_fallbackContent";U=k(function(){var a=g.getElementById(c);Pa(a)&&(Qa(),O.deactivated=null,Xa.emit({type:"error",name:"swf-not-found"}))},b)}},Aa=function(){var a=g.createElement("div");return a.id=$.containerId,a.className=$.containerClass,a.style.position="absolute",a.style.left="0px",a.style.top="-9999px",a.style.width="1px",a.style.height="1px",a.style.zIndex=""+Ta($.zIndex),a},Ba=function(a){for(var b=a&&a.parentNode;b&&"OBJECT"===b.nodeName&&b.parentNode;)b=b.parentNode;return b||null},Ca=function(){var a,b=O.bridge,c=Ba(b);if(!b){var d=Ja(f.location.host,$),e="never"===d?"none":"all",h=Ha(A({jsVersion:Xa.version},$)),i=$.swfPath+Ga($.swfPath,$);c=Aa();var j=g.createElement("div");c.appendChild(j),g.body.appendChild(c);var k=g.createElement("div"),l="activex"===O.pluginType;k.innerHTML='<object id="'+$.swfObjectId+'" name="'+$.swfObjectId+'" width="100%" height="100%" '+(l?'classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"':'type="application/x-shockwave-flash" data="'+i+'"')+">"+(l?'<param name="movie" value="'+i+'"/>':"")+'<param name="allowScriptAccess" value="'+d+'"/><param name="allowNetworking" value="'+e+'"/><param name="menu" value="false"/><param name="wmode" value="transparent"/><param name="flashvars" value="'+h+'"/><div id="'+$.swfObjectId+'_fallbackContent">&nbsp;</div></object>',b=k.firstChild,k=null,y(b).ZeroClipboard=Xa,c.replaceChild(b,j),za()}return b||(b=g[$.swfObjectId],b&&(a=b.length)&&(b=b[a-1]),!b&&c&&(b=c.firstChild)),O.bridge=b||null,b},Da=function(){var a=O.bridge;if(a){var d=Ba(a);d&&("activex"===O.pluginType&&"readyState"in a?(a.style.display="none",function e(){if(4===a.readyState){for(var b in a)"function"==typeof a[b]&&(a[b]=null);a.parentNode&&a.parentNode.removeChild(a),d.parentNode&&d.parentNode.removeChild(d)}else i(e,10)}()):(a.parentNode&&a.parentNode.removeChild(a),d.parentNode&&d.parentNode.removeChild(d))),Qa(),O.ready=null,O.bridge=null,O.deactivated=null,c=b}},Ea=function(a){var b={},c={};if("object"==typeof a&&a){for(var d in a)if(d&&w.call(a,d)&&"string"==typeof a[d]&&a[d])switch(d.toLowerCase()){case"text/plain":case"text":case"air:text":case"flash:text":b.text=a[d],c.text=d;break;case"text/html":case"html":case"air:html":case"flash:html":b.html=a[d],c.html=d;break;case"application/rtf":case"text/rtf":case"rtf":case"richtext":case"air:rtf":case"flash:rtf":b.rtf=a[d],c.rtf=d}return{data:b,formatMap:c}}},Fa=function(a,b){if("object"!=typeof a||!a||"object"!=typeof b||!b)return a;var c={};for(var d in a)if(w.call(a,d))if("errors"===d){c[d]=a[d]?a[d].slice():[];for(var e=0,f=c[d].length;f>e;e++)c[d][e].format=b[c[d][e].format]}else if("success"!==d&&"data"!==d)c[d]=a[d];else{c[d]={};var g=a[d];for(var h in g)h&&w.call(g,h)&&w.call(b,h)&&(c[d][b[h]]=g[h])}return c},Ga=function(a,b){var c=null==b||b&&b.cacheBust===!0;return c?(-1===a.indexOf("?")?"?":"&")+"noCache="+t():""},Ha=function(a){var b,c,d,e,g="",h=[];if(a.trustedDomains&&("string"==typeof a.trustedDomains?e=[a.trustedDomains]:"object"==typeof a.trustedDomains&&"length"in a.trustedDomains&&(e=a.trustedDomains)),e&&e.length)for(b=0,c=e.length;c>b;b++)if(w.call(e,b)&&e[b]&&"string"==typeof e[b]){if(d=Ia(e[b]),!d)continue;if("*"===d){h.length=0,h.push(d);break}h.push.apply(h,[d,"//"+d,f.location.protocol+"//"+d])}return h.length&&(g+="trustedOrigins="+n(h.join(","))),a.forceEnhancedClipboard===!0&&(g+=(g?"&":"")+"forceEnhancedClipboard=true"),"string"==typeof a.swfObjectId&&a.swfObjectId&&(g+=(g?"&":"")+"swfObjectId="+n(a.swfObjectId)),"string"==typeof a.jsVersion&&a.jsVersion&&(g+=(g?"&":"")+"jsVersion="+n(a.jsVersion)),g},Ia=function(a){if(null==a||""===a)return null;if(a=a.replace(/^\s+|\s+$/g,""),""===a)return null;var b=a.indexOf("//");a=-1===b?a:a.slice(b+2);var c=a.indexOf("/");return a=-1===c?a:-1===b||0===c?null:a.slice(0,c),a&&".swf"===a.slice(-4).toLowerCase()?null:a||null},Ja=function(){var a=function(a){var b,c,d,e=[];if("string"==typeof a&&(a=[a]),"object"!=typeof a||!a||"number"!=typeof a.length)return e;for(b=0,c=a.length;c>b;b++)if(w.call(a,b)&&(d=Ia(a[b]))){if("*"===d){e.length=0,e.push("*");break}-1===e.indexOf(d)&&e.push(d)}return e};return function(b,c){var d=Ia(c.swfPath);null===d&&(d=b);var e=a(c.trustedDomains),f=e.length;if(f>0){if(1===f&&"*"===e[0])return"always";if(-1!==e.indexOf(b))return 1===f&&b===d?"sameDomain":"always"}return"never"}}(),Ka=function(){try{return g.activeElement}catch(a){return null}},La=function(a,b){var c,d,e,f=[];if("string"==typeof b&&b&&(f=b.split(/\s+/)),a&&1===a.nodeType&&f.length>0){for(e=(" "+(a.className||"")+" ").replace(/[\t\r\n\f]/g," "),c=0,d=f.length;d>c;c++)-1===e.indexOf(" "+f[c]+" ")&&(e+=f[c]+" ");e=e.replace(/^\s+|\s+$/g,""),e!==a.className&&(a.className=e)}return a},Ma=function(a,b){var c,d,e,f=[];if("string"==typeof b&&b&&(f=b.split(/\s+/)),a&&1===a.nodeType&&f.length>0&&a.className){for(e=(" "+a.className+" ").replace(/[\t\r\n\f]/g," "),c=0,d=f.length;d>c;c++)e=e.replace(" "+f[c]+" "," ");e=e.replace(/^\s+|\s+$/g,""),e!==a.className&&(a.className=e)}return a},Na=function(a,b){var c=m(a,null).getPropertyValue(b);return"cursor"!==b||c&&"auto"!==c||"A"!==a.nodeName?c:"pointer"},Oa=function(a){var b={left:0,top:0,width:0,height:0};if(a.getBoundingClientRect){var c=a.getBoundingClientRect(),d=f.pageXOffset,e=f.pageYOffset,h=g.documentElement.clientLeft||0,i=g.documentElement.clientTop||0,j=0,k=0;if("relative"===Na(g.body,"position")){var l=g.body.getBoundingClientRect(),m=g.documentElement.getBoundingClientRect();j=l.left-m.left||0,k=l.top-m.top||0}b.left=c.left+d-h-j,b.top=c.top+e-i-k,b.width="width"in c?c.width:c.right-c.left,b.height="height"in c?c.height:c.bottom-c.top}return b},Pa=function(a){if(!a)return!1;var b=m(a,null);if(!b)return!1;var c=r(b.height)>0,d=r(b.width)>0,e=r(b.top)>=0,f=r(b.left)>=0,g=c&&d&&e&&f,h=g?null:Oa(a),i="none"!==b.display&&"collapse"!==b.visibility&&(g||!!h&&(c||h.height>0)&&(d||h.width>0)&&(e||h.top>=0)&&(f||h.left>=0));return i},Qa=function(){j(T),T=0,l(U),U=0},Ra=function(){var a;if(d&&(a=Ba(O.bridge))){var b=Oa(d);A(a.style,{width:b.width+"px",height:b.height+"px",top:b.top+"px",left:b.left+"px",zIndex:""+Ta($.zIndex)})}},Sa=function(a){O.ready===!0&&(O.bridge&&"function"==typeof O.bridge.setHandCursor?O.bridge.setHandCursor(a):O.ready=!1)},Ta=function(a){if(/^(?:auto|inherit)$/.test(a))return a;var b;return"number"!=typeof a||s(a)?"string"==typeof a&&(b=Ta(q(a,10))):b=a,"number"==typeof b?b:"auto"},Ua=function(a){var b=/(\r\n|\r|\n)/g;return"string"==typeof a&&$.fixLineEndings===!0&&(M()?/((^|[^\r])\n|\r([^\n]|$))/.test(a)&&(a=a.replace(b,"\r\n")):/\r/.test(a)&&(a=a.replace(b,"\n"))),a},Va=function(b){var c,d,e,f=O.sandboxed,g=null;if(b=b===!0,N===!1)g=!1;else{try{d=a.frameElement||null}catch(h){e={name:h.name,message:h.message}}if(d&&1===d.nodeType&&"IFRAME"===d.nodeName)try{g=d.hasAttribute("sandbox")}catch(h){g=null}else{try{c=document.domain||null}catch(h){c=null}(null===c||e&&"SecurityError"===e.name&&/(^|[\s\(\[@])sandbox(es|ed|ing|[\s\.,!\)\]@]|$)/.test(e.message.toLowerCase()))&&(g=!0)}}return O.sandboxed=g,f===g||b||Wa(o),g},Wa=function(a){function b(a){var b=a.match(/[\d]+/g);return b.length=3,b.join(".")}function c(a){return!!a&&(a=a.toLowerCase())&&(/^(pepflashplayer\.dll|libpepflashplayer\.so|pepperflashplayer\.plugin)$/.test(a)||"chrome.plugin"===a.slice(-13))}function d(a){a&&(i=!0,a.version&&(l=b(a.version)),!l&&a.description&&(l=b(a.description)),a.filename&&(k=c(a.filename)))}var e,f,g,i=!1,j=!1,k=!1,l="";if(h.plugins&&h.plugins.length)e=h.plugins["Shockwave Flash"],d(e),h.plugins["Shockwave Flash 2.0"]&&(i=!0,l="2.0.0.11");else if(h.mimeTypes&&h.mimeTypes.length)g=h.mimeTypes["application/x-shockwave-flash"],e=g&&g.enabledPlugin,d(e);else if("undefined"!=typeof a){j=!0;try{f=new a("ShockwaveFlash.ShockwaveFlash.7"),i=!0,l=b(f.GetVariable("$version"))}catch(m){try{f=new a("ShockwaveFlash.ShockwaveFlash.6"),i=!0,l="6.0.21"}catch(n){try{f=new a("ShockwaveFlash.ShockwaveFlash"),i=!0,l=b(f.GetVariable("$version"))}catch(o){j=!1}}}}O.disabled=i!==!0,O.outdated=l&&r(l)<r(P),O.version=l||"0.0.0",O.pluginType=k?"pepper":j?"activex":i?"netscape":"unknown"};Wa(o),Va(!0);var Xa=function(){return this instanceof Xa?void("function"==typeof Xa._createClient&&Xa._createClient.apply(this,z(arguments))):new Xa};v(Xa,"version",{value:"2.3.0-beta.1",writable:!1,configurable:!0,enumerable:!0}),Xa.config=function(){return _.apply(this,z(arguments))},Xa.state=function(){return aa.apply(this,z(arguments))},Xa.isFlashUnusable=function(){return ba.apply(this,z(arguments))},Xa.on=function(){return ca.apply(this,z(arguments))},Xa.off=function(){return da.apply(this,z(arguments))},Xa.handlers=function(){return ea.apply(this,z(arguments))},Xa.emit=function(){return fa.apply(this,z(arguments))},Xa.create=function(){return ga.apply(this,z(arguments))},Xa.destroy=function(){return ha.apply(this,z(arguments))},Xa.setData=function(){return ia.apply(this,z(arguments))},Xa.clearData=function(){return ja.apply(this,z(arguments))},Xa.getData=function(){return ka.apply(this,z(arguments))},Xa.focus=Xa.activate=function(){return la.apply(this,z(arguments))},Xa.blur=Xa.deactivate=function(){return ma.apply(this,z(arguments))},Xa.activeElement=function(){return na.apply(this,z(arguments))};var Ya=0,Za={},$a=0,_a={},ab={};A($,{autoActivate:!0});var bb=function(a){var b=this;b.id=""+Ya++,Za[b.id]={instance:b,elements:[],handlers:{}},a&&b.clip(a),Xa.on("*",function(a){return b.emit(a)}),Xa.on("destroy",function(){b.destroy()}),Xa.create()},cb=function(a,d){var e,f,g,h={},i=Za[this.id],j=i&&i.handlers;if(!i)throw new Error("Attempted to add new listener(s) to a destroyed ZeroClipboard client instance");if("string"==typeof a&&a)g=a.toLowerCase().split(/\s+/);else if("object"==typeof a&&a&&"undefined"==typeof d)for(e in a)w.call(a,e)&&"string"==typeof e&&e&&"function"==typeof a[e]&&this.on(e,a[e]);if(g&&g.length){for(e=0,f=g.length;f>e;e++)a=g[e].replace(/^on/,""),h[a]=!0,j[a]||(j[a]=[]),j[a].push(d);if(h.ready&&O.ready&&this.emit({type:"ready",client:this}),h.error){for(e=0,f=X.length;f>e;e++)if(O[X[e].replace(/^flash-/,"")]){this.emit({type:"error",name:X[e],client:this});break}c!==b&&Xa.version!==c&&this.emit({type:"error",name:"version-mismatch",jsVersion:Xa.version,swfVersion:c})}}return this},db=function(a,b){var c,d,e,f,g,h=Za[this.id],i=h&&h.handlers;if(!i)return this;if(0===arguments.length)f=u(i);else if("string"==typeof a&&a)f=a.split(/\s+/);else if("object"==typeof a&&a&&"undefined"==typeof b)for(c in a)w.call(a,c)&&"string"==typeof c&&c&&"function"==typeof a[c]&&this.off(c,a[c]);if(f&&f.length)for(c=0,d=f.length;d>c;c++)if(a=f[c].toLowerCase().replace(/^on/,""),g=i[a],g&&g.length)if(b)for(e=g.indexOf(b);-1!==e;)g.splice(e,1),e=g.indexOf(b,e);else g.length=0;return this},eb=function(a){var b=null,c=Za[this.id]&&Za[this.id].handlers;return c&&(b="string"==typeof a&&a?c[a]?c[a].slice(0):[]:B(c)),b},fb=function(a){if(kb.call(this,a)){"object"==typeof a&&a&&"string"==typeof a.type&&a.type&&(a=A({},a));var b=A({},pa(a),{client:this});lb.call(this,b)}return this},gb=function(a){if(!Za[this.id])throw new Error("Attempted to clip element(s) to a destroyed ZeroClipboard client instance");a=mb(a);for(var b=0;b<a.length;b++)if(w.call(a,b)&&a[b]&&1===a[b].nodeType){a[b].zcClippingId?-1===_a[a[b].zcClippingId].indexOf(this.id)&&_a[a[b].zcClippingId].push(this.id):(a[b].zcClippingId="zcClippingId_"+$a++,_a[a[b].zcClippingId]=[this.id],$.autoActivate===!0&&nb(a[b]));var c=Za[this.id]&&Za[this.id].elements;-1===c.indexOf(a[b])&&c.push(a[b])}return this},hb=function(a){var b=Za[this.id];if(!b)return this;var c,d=b.elements;a="undefined"==typeof a?d.slice(0):mb(a);for(var e=a.length;e--;)if(w.call(a,e)&&a[e]&&1===a[e].nodeType){for(c=0;-1!==(c=d.indexOf(a[e],c));)d.splice(c,1);var f=_a[a[e].zcClippingId];if(f){for(c=0;-1!==(c=f.indexOf(this.id,c));)f.splice(c,1);0===f.length&&($.autoActivate===!0&&ob(a[e]),delete a[e].zcClippingId)}}return this},ib=function(){var a=Za[this.id];return a&&a.elements?a.elements.slice(0):[]},jb=function(){Za[this.id]&&(this.unclip(),this.off(),delete Za[this.id])},kb=function(a){if(!a||!a.type)return!1;if(a.client&&a.client!==this)return!1;var b=Za[this.id],c=b&&b.elements,d=!!c&&c.length>0,e=!a.target||d&&-1!==c.indexOf(a.target),f=a.relatedTarget&&d&&-1!==c.indexOf(a.relatedTarget),g=a.client&&a.client===this;return b&&(e||f||g)?!0:!1},lb=function(a){var b=Za[this.id];if("object"==typeof a&&a&&a.type&&b){var c=sa(a),d=b&&b.handlers["*"]||[],e=b&&b.handlers[a.type]||[],g=d.concat(e);if(g&&g.length){var h,i,j,k,l,m=this;for(h=0,i=g.length;i>h;h++)j=g[h],k=m,"string"==typeof j&&"function"==typeof f[j]&&(j=f[j]),"object"==typeof j&&j&&"function"==typeof j.handleEvent&&(k=j,j=j.handleEvent),"function"==typeof j&&(l=A({},a),ta(j,k,[l],c))}}},mb=function(a){return"string"==typeof a&&(a=[]),"number"!=typeof a.length?[a]:a},nb=function(a){if(a&&1===a.nodeType){var b=function(a){(a||(a=f.event))&&("js"!==a._source&&(a.stopImmediatePropagation(),a.preventDefault()),delete a._source)},c=function(c){(c||(c=f.event))&&(b(c),Xa.focus(a))};a.addEventListener("mouseover",c,!1),a.addEventListener("mouseout",b,!1),a.addEventListener("mouseenter",b,!1),a.addEventListener("mouseleave",b,!1),a.addEventListener("mousemove",b,!1),ab[a.zcClippingId]={mouseover:c,mouseout:b,mouseenter:b,mouseleave:b,mousemove:b}}},ob=function(a){if(a&&1===a.nodeType){var b=ab[a.zcClippingId];if("object"==typeof b&&b){for(var c,d,e=["move","leave","enter","out","over"],f=0,g=e.length;g>f;f++)c="mouse"+e[f],d=b[c],"function"==typeof d&&a.removeEventListener(c,d,!1);delete ab[a.zcClippingId]}}};Xa._createClient=function(){bb.apply(this,z(arguments))},Xa.prototype.on=function(){return cb.apply(this,z(arguments))},Xa.prototype.off=function(){return db.apply(this,z(arguments))},Xa.prototype.handlers=function(){return eb.apply(this,z(arguments))},Xa.prototype.emit=function(){return fb.apply(this,z(arguments))},Xa.prototype.clip=function(){return gb.apply(this,z(arguments))},Xa.prototype.unclip=function(){return hb.apply(this,z(arguments))},Xa.prototype.elements=function(){return ib.apply(this,z(arguments))},Xa.prototype.destroy=function(){return jb.apply(this,z(arguments))},Xa.prototype.setText=function(a){if(!Za[this.id])throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");return Xa.setData("text/plain",a),this},Xa.prototype.setHtml=function(a){if(!Za[this.id])throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");return Xa.setData("text/html",a),this},Xa.prototype.setRichText=function(a){if(!Za[this.id])throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");return Xa.setData("application/rtf",a),this},Xa.prototype.setData=function(){if(!Za[this.id])throw new Error("Attempted to set pending clipboard data from a destroyed ZeroClipboard client instance");return Xa.setData.apply(this,z(arguments)),this},Xa.prototype.clearData=function(){if(!Za[this.id])throw new Error("Attempted to clear pending clipboard data from a destroyed ZeroClipboard client instance");return Xa.clearData.apply(this,z(arguments)),this},Xa.prototype.getData=function(){if(!Za[this.id])throw new Error("Attempted to get pending clipboard data from a destroyed ZeroClipboard client instance");return Xa.getData.apply(this,z(arguments))},"function"==typeof define&&define.amd?define(function(){return Xa}):"object"==typeof module&&module&&"object"==typeof module.exports&&module.exports?module.exports=Xa:a.ZeroClipboard=Xa}(function(){return this||window}());
//# sourceMappingURL=ZeroClipboard.min.map
/* ========================================================================
 * Bootstrap: affix.js v3.2.0
 * http://getbootstrap.com/javascript/#affix
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+ function($) {
	'use strict';
	// AFFIX CLASS DEFINITION
	// ======================

	var Affix = function(element, options) {
		this.options = $.extend({}, Affix.DEFAULTS, options)

		this.$target = $(this.options.target)
			.on('scroll.bs.affix.data-api', $.proxy(this.checkPosition, this))
			.on('click.bs.affix.data-api', $.proxy(this.checkPositionWithEventLoop, this))

		this.$element = $(element)
		this.affixed =
			this.unpin =
			this.pinnedOffset = null

		this.checkPosition()
	}

	Affix.VERSION = '3.2.0'

	Affix.RESET = 'affix affix-top affix-bottom'

	Affix.DEFAULTS = {
		offset: 0,
		target: window
	}

	Affix.prototype.getPinnedOffset = function() {
		if (this.pinnedOffset) return this.pinnedOffset
		this.$element.removeClass(Affix.RESET).addClass('affix')
		var scrollTop = this.$target.scrollTop()
		var position = this.$element.offset()
		return (this.pinnedOffset = position.top - scrollTop)
	}

	Affix.prototype.checkPositionWithEventLoop = function() {
		setTimeout($.proxy(this.checkPosition, this), 1)
	}

	Affix.prototype.checkPosition = function() {
		if (!this.$element.is(':visible')) return

		var scrollHeight = $(document).height()
		var scrollTop = this.$target.scrollTop()
		var position = this.$element.offset()
		var offset = this.options.offset
		var offsetTop = offset.top
		var offsetBottom = offset.bottom

		if (typeof offset != 'object') offsetBottom = offsetTop = offset
		if (typeof offsetTop == 'function') offsetTop = offset.top(this.$element)
		if (typeof offsetBottom == 'function') offsetBottom = offset.bottom(this.$element)

		var affix = this.unpin != null && (scrollTop + this.unpin <= position.top) ? false :
			offsetBottom != null && (position.top + this.$element.height() >= scrollHeight - offsetBottom) ? 'bottom' :
			offsetTop != null && (scrollTop <= offsetTop) ? 'top' : false

		if (this.affixed === affix) return
		if (this.unpin != null) this.$element.css('top', '')

		var affixType = 'affix' + (affix ? '-' + affix : '')
		var e = $.Event(affixType + '.bs.affix')

		this.$element.trigger(e)

		if (e.isDefaultPrevented()) return

		this.affixed = affix
		this.unpin = affix == 'bottom' ? this.getPinnedOffset() : null

		this.$element
			.removeClass(Affix.RESET)
			.addClass(affixType)
			.trigger($.Event(affixType.replace('affix', 'affixed')))

		if (affix == 'bottom') {
			this.$element.offset({
				top: scrollHeight - this.$element.height() - offsetBottom
			})
		}
	}


	// AFFIX PLUGIN DEFINITION
	// =======================

	function Plugin(option) {
		return this.each(function() {
			var $this = $(this)
			var data = $this.data('bs.affix')
			var options = typeof option == 'object' && option

			if (!data) $this.data('bs.affix', (data = new Affix(this, options)))
			if (typeof option == 'string') data[option]()
		})
	}

	var old = $.fn.affix

	$.fn.affix = Plugin
	$.fn.affix.Constructor = Affix


	// AFFIX NO CONFLICT
	// =================

	$.fn.affix.noConflict = function() {
		$.fn.affix = old
		return this
	}


	// AFFIX DATA-API
	// ==============

	$(window).on('load', function() {
		$('[data-spy="affix"]').each(function() {
			var $spy = $(this)
			var data = $spy.data()

			data.offset = data.offset || {}

			if (data.offsetBottom) data.offset.bottom = data.offsetBottom
			if (data.offsetTop) data.offset.top = data.offsetTop

			Plugin.call($spy, data)
		})
	})

}(jQuery);

/* ========================================================================
 * Bootstrap: alert.js v3.2.0
 * http://getbootstrap.com/javascript/#alerts
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+ function($) {
	'use strict';

	// ALERT CLASS DEFINITION
	// ======================

	var dismiss = '[data-dismiss="alert"]'
	var Alert = function(el) {
		$(el).on('click', dismiss, this.close)
	}

	Alert.VERSION = '3.2.0'

	Alert.prototype.close = function(e) {
		var $this = $(this)
		var selector = $this.attr('data-target')

		if (!selector) {
			selector = $this.attr('href')
			selector = selector && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
		}

		var $parent = $(selector)

		if (e) e.preventDefault()

		if (!$parent.length) {
			$parent = $this.hasClass('alert') ? $this : $this.parent()
		}

		$parent.trigger(e = $.Event('close.bs.alert'))

		if (e.isDefaultPrevented()) return

		$parent.removeClass('in')

		function removeElement() {
			// detach from parent, fire event then clean up data
			$parent.detach().trigger('closed.bs.alert').remove()
		}

		$.support.transition && $parent.hasClass('fade') ?
			$parent
			.one('bsTransitionEnd', removeElement)
			.emulateTransitionEnd(150) :
			removeElement()
	}


	// ALERT PLUGIN DEFINITION
	// =======================

	function Plugin(option) {
		return this.each(function() {
			var $this = $(this)
			var data = $this.data('bs.alert')

			if (!data) $this.data('bs.alert', (data = new Alert(this)))
			if (typeof option == 'string') data[option].call($this)
		})
	}

	var old = $.fn.alert

	$.fn.alert = Plugin
	$.fn.alert.Constructor = Alert


	// ALERT NO CONFLICT
	// =================

	$.fn.alert.noConflict = function() {
		$.fn.alert = old
		return this
	}


	// ALERT DATA-API
	// ==============

	$(document).on('click.bs.alert.data-api', dismiss, Alert.prototype.close)

}(jQuery);

/* ========================================================================
 * Bootstrap: button.js v3.2.0
 * http://getbootstrap.com/javascript/#buttons
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+ function($) {
	'use strict';

	// BUTTON PUBLIC CLASS DEFINITION
	// ==============================

	var Button = function(element, options) {
		this.$element = $(element)
		this.options = $.extend({}, Button.DEFAULTS, options)
		this.isLoading = false
	}

	Button.VERSION = '3.2.0'

	Button.DEFAULTS = {
		loadingText: 'loading...'
	}

	Button.prototype.setState = function(state) {
		var d = 'disabled'
		var $el = this.$element
		var val = $el.is('input') ? 'val' : 'html'
		var data = $el.data()

		state = state + 'Text'

		if (data.resetText == null) $el.data('resetText', $el[val]())

		$el[val](data[state] == null ? this.options[state] : data[state])

		// push to event loop to allow forms to submit
		setTimeout($.proxy(function() {
			if (state == 'loadingText') {
				this.isLoading = true
				$el.addClass(d).attr(d, d)
			} else if (this.isLoading) {
				this.isLoading = false
				$el.removeClass(d).removeAttr(d)
			}
		}, this), 0)
	}

	Button.prototype.toggle = function() {
		var changed = true
		var $parent = this.$element.closest('[data-toggle="buttons"]')

		if ($parent.length) {
			var $input = this.$element.find('input')
			if ($input.prop('type') == 'radio') {
				if ($input.prop('checked') && this.$element.hasClass('active')) changed = false
				else $parent.find('.active').removeClass('active')
			}
			if (changed) $input.prop('checked', !this.$element.hasClass('active')).trigger('change')
		}

		if (changed) this.$element.toggleClass('active')
	}


	// BUTTON PLUGIN DEFINITION
	// ========================

	function Plugin(option) {
		return this.each(function() {
			var $this = $(this)
			var data = $this.data('bs.button')
			var options = typeof option == 'object' && option

			if (!data) $this.data('bs.button', (data = new Button(this, options)))

			if (option == 'toggle') data.toggle()
			else if (option) data.setState(option)
		})
	}

	var old = $.fn.button

	$.fn.button = Plugin
	$.fn.button.Constructor = Button


	// BUTTON NO CONFLICT
	// ==================

	$.fn.button.noConflict = function() {
		$.fn.button = old
		return this
	}


	// BUTTON DATA-API
	// ===============

	$(document).on('click.bs.button.data-api', '[data-toggle^="button"]', function(e) {
		var $btn = $(e.target)
		if (!$btn.hasClass('btn')) $btn = $btn.closest('.btn')
		Plugin.call($btn, 'toggle')
		e.preventDefault()
	})

}(jQuery);

/* ========================================================================
 * Bootstrap: carousel.js v3.2.0
 * http://getbootstrap.com/javascript/#carousel
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+ function($) {
	'use strict';

	// CAROUSEL CLASS DEFINITION
	// =========================

	var Carousel = function(element, options) {
		this.$element = $(element).on('keydown.bs.carousel', $.proxy(this.keydown, this))
		this.$indicators = this.$element.find('.carousel-indicators')
		this.options = options
		this.paused =
			this.sliding =
			this.interval =
			this.$active =
			this.$items = null

		this.options.pause == 'hover' && this.$element
			.on('mouseenter.bs.carousel', $.proxy(this.pause, this))
			.on('mouseleave.bs.carousel', $.proxy(this.cycle, this))
	}

	Carousel.VERSION = '3.2.0'

	Carousel.DEFAULTS = {
		interval: 5000,
		pause: 'hover',
		wrap: true
	}

	Carousel.prototype.keydown = function(e) {
		switch (e.which) {
			case 37:
				this.prev();
				break
			case 39:
				this.next();
				break
			default:
				return
		}

		e.preventDefault()
	}

	Carousel.prototype.cycle = function(e) {
		e || (this.paused = false)

		this.interval && clearInterval(this.interval)

		this.options.interval && !this.paused && (this.interval = setInterval($.proxy(this.next, this), this.options.interval))

		return this
	}

	Carousel.prototype.getItemIndex = function(item) {
		this.$items = item.parent().children('.item')
		return this.$items.index(item || this.$active)
	}

	Carousel.prototype.to = function(pos) {
		var that = this
		var activeIndex = this.getItemIndex(this.$active = this.$element.find('.item.active'))

		if (pos > (this.$items.length - 1) || pos < 0) return

		if (this.sliding) return this.$element.one('slid.bs.carousel', function() {
				that.to(pos)
			}) // yes, "slid"
		if (activeIndex == pos) return this.pause().cycle()

		return this.slide(pos > activeIndex ? 'next' : 'prev', $(this.$items[pos]))
	}

	Carousel.prototype.pause = function(e) {
		e || (this.paused = true)

		if (this.$element.find('.next, .prev').length && $.support.transition) {
			this.$element.trigger($.support.transition.end)
			this.cycle(true)
		}

		this.interval = clearInterval(this.interval)

		return this
	}

	Carousel.prototype.next = function() {
		if (this.sliding) return
		return this.slide('next')
	}

	Carousel.prototype.prev = function() {
		if (this.sliding) return
		return this.slide('prev')
	}

	Carousel.prototype.slide = function(type, next) {
		var $active = this.$element.find('.item.active')
		var $next = next || $active[type]()
		var isCycling = this.interval
		var direction = type == 'next' ? 'left' : 'right'
		var fallback = type == 'next' ? 'first' : 'last'
		var that = this

		if (!$next.length) {
			if (!this.options.wrap) return
			$next = this.$element.find('.item')[fallback]()
		}

		if ($next.hasClass('active')) return (this.sliding = false)

		var relatedTarget = $next[0]
		var slideEvent = $.Event('slide.bs.carousel', {
			relatedTarget: relatedTarget,
			direction: direction
		})
		this.$element.trigger(slideEvent)
		if (slideEvent.isDefaultPrevented()) return

		this.sliding = true

		isCycling && this.pause()

		if (this.$indicators.length) {
			this.$indicators.find('.active').removeClass('active')
			var $nextIndicator = $(this.$indicators.children()[this.getItemIndex($next)])
			$nextIndicator && $nextIndicator.addClass('active')
		}

		var slidEvent = $.Event('slid.bs.carousel', {
				relatedTarget: relatedTarget,
				direction: direction
			}) // yes, "slid"
		if ($.support.transition && this.$element.hasClass('slide')) {
			$next.addClass(type)
			$next[0].offsetWidth // force reflow
			$active.addClass(direction)
			$next.addClass(direction)
			$active
				.one('bsTransitionEnd', function() {
					$next.removeClass([type, direction].join(' ')).addClass('active')
					$active.removeClass(['active', direction].join(' '))
					that.sliding = false
					setTimeout(function() {
						that.$element.trigger(slidEvent)
					}, 0)
				})
				.emulateTransitionEnd($active.css('transition-duration').slice(0, -1) * 1000)
		} else {
			$active.removeClass('active')
			$next.addClass('active')
			this.sliding = false
			this.$element.trigger(slidEvent)
		}

		isCycling && this.cycle()

		return this
	}


	// CAROUSEL PLUGIN DEFINITION
	// ==========================

	function Plugin(option) {
		return this.each(function() {
			var $this = $(this)
			var data = $this.data('bs.carousel')
			var options = $.extend({}, Carousel.DEFAULTS, $this.data(), typeof option == 'object' && option)
			var action = typeof option == 'string' ? option : options.slide

			if (!data) $this.data('bs.carousel', (data = new Carousel(this, options)))
			if (typeof option == 'number') data.to(option)
			else if (action) data[action]()
			else if (options.interval) data.pause().cycle()
		})
	}

	var old = $.fn.carousel

	$.fn.carousel = Plugin
	$.fn.carousel.Constructor = Carousel


	// CAROUSEL NO CONFLICT
	// ====================

	$.fn.carousel.noConflict = function() {
		$.fn.carousel = old
		return this
	}


	// CAROUSEL DATA-API
	// =================

	$(document).on('click.bs.carousel.data-api', '[data-slide], [data-slide-to]', function(e) {
		var href
		var $this = $(this)
		var $target = $($this.attr('data-target') || (href = $this.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '')) // strip for ie7
		if (!$target.hasClass('carousel')) return
		var options = $.extend({}, $target.data(), $this.data())
		var slideIndex = $this.attr('data-slide-to')
		if (slideIndex) options.interval = false

		Plugin.call($target, options)

		if (slideIndex) {
			$target.data('bs.carousel').to(slideIndex)
		}

		e.preventDefault()
	})

	$(window).on('load', function() {
		$('[data-ride="carousel"]').each(function() {
			var $carousel = $(this)
			Plugin.call($carousel, $carousel.data())
		})
	})

}(jQuery);

/* ========================================================================
 * Bootstrap: collapse.js v3.2.0
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+ function($) {
	'use strict';

	// COLLAPSE PUBLIC CLASS DEFINITION
	// ================================

	var Collapse = function(element, options) {
		this.$element = $(element)
		this.options = $.extend({}, Collapse.DEFAULTS, options)
		this.transitioning = null

		if (this.options.parent) this.$parent = $(this.options.parent)
		if (this.options.toggle) this.toggle()
	}

	Collapse.VERSION = '3.2.0'

	Collapse.DEFAULTS = {
		toggle: true
	}

	Collapse.prototype.dimension = function() {
		var hasWidth = this.$element.hasClass('width')
		return hasWidth ? 'width' : 'height'
	}

	Collapse.prototype.show = function() {
		if (this.transitioning || this.$element.hasClass('in')) return

		var startEvent = $.Event('show.bs.collapse')
		this.$element.trigger(startEvent)
		if (startEvent.isDefaultPrevented()) return

		var actives = this.$parent && this.$parent.find('> .panel > .in')

		if (actives && actives.length) {
			var hasData = actives.data('bs.collapse')
			if (hasData && hasData.transitioning) return
			Plugin.call(actives, 'hide')
			hasData || actives.data('bs.collapse', null)
		}

		var dimension = this.dimension()

		this.$element
			.removeClass('collapse')
			.addClass('collapsing')[dimension](0)

		this.transitioning = 1

		var complete = function() {
			this.$element
				.removeClass('collapsing')
				.addClass('collapse in')[dimension]('')
			this.transitioning = 0
			this.$element
				.trigger('shown.bs.collapse')
		}

		if (!$.support.transition) return complete.call(this)

		var scrollSize = $.camelCase(['scroll', dimension].join('-'))

		this.$element
			.one('bsTransitionEnd', $.proxy(complete, this))
			.emulateTransitionEnd(350)[dimension](this.$element[0][scrollSize])
	}

	Collapse.prototype.hide = function() {
		if (this.transitioning || !this.$element.hasClass('in')) return

		var startEvent = $.Event('hide.bs.collapse')
		this.$element.trigger(startEvent)
		if (startEvent.isDefaultPrevented()) return

		var dimension = this.dimension()

		this.$element[dimension](this.$element[dimension]())[0].offsetHeight

		this.$element
			.addClass('collapsing')
			.removeClass('collapse')
			.removeClass('in')

		this.transitioning = 1

		var complete = function() {
			this.transitioning = 0
			this.$element
				.trigger('hidden.bs.collapse')
				.removeClass('collapsing')
				.addClass('collapse')
		}

		if (!$.support.transition) return complete.call(this)

		this.$element[dimension](0)
			.one('bsTransitionEnd', $.proxy(complete, this))
			.emulateTransitionEnd(350)
	}

	Collapse.prototype.toggle = function() {
		this[this.$element.hasClass('in') ? 'hide' : 'show']()
	}


	// COLLAPSE PLUGIN DEFINITION
	// ==========================

	function Plugin(option) {
		return this.each(function() {
			var $this = $(this)
			var data = $this.data('bs.collapse')
			var options = $.extend({}, Collapse.DEFAULTS, $this.data(), typeof option == 'object' && option)

			if (!data && options.toggle && option == 'show') option = !option
			if (!data) $this.data('bs.collapse', (data = new Collapse(this, options)))
			if (typeof option == 'string') data[option]()
		})
	}

	var old = $.fn.collapse

	$.fn.collapse = Plugin
	$.fn.collapse.Constructor = Collapse


	// COLLAPSE NO CONFLICT
	// ====================

	$.fn.collapse.noConflict = function() {
		$.fn.collapse = old
		return this
	}


	// COLLAPSE DATA-API
	// =================

	$(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function(e) {
		var href
		var $this = $(this)
		var target = $this.attr('data-target') || e.preventDefault() || (href = $this.attr('href')) && href.replace(/.*(?=#[^\s]+$)/, '') // strip for ie7
		var $target = $(target)
		var data = $target.data('bs.collapse')
		var option = data ? 'toggle' : $this.data()
		var parent = $this.attr('data-parent')
		var $parent = parent && $(parent)

		if (!data || !data.transitioning) {
			if ($parent) $parent.find('[data-toggle="collapse"][data-parent="' + parent + '"]').not($this).addClass('collapsed')
			$this[$target.hasClass('in') ? 'addClass' : 'removeClass']('collapsed')
		}

		Plugin.call($target, option)
	})

}(jQuery);

/* ========================================================================
 * Bootstrap: dropdown.js v3.2.0
 * http://getbootstrap.com/javascript/#dropdowns
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+ function($) {
	'use strict';

	// DROPDOWN CLASS DEFINITION
	// =========================

	var backdrop = '.dropdown-backdrop'
	var toggle = '[data-toggle="dropdown"]'
	var Dropdown = function(element) {
		$(element).on('click.bs.dropdown', this.toggle)
	}

	Dropdown.VERSION = '3.2.0'

	Dropdown.prototype.toggle = function(e) {
		var $this = $(this)

		if ($this.is('.disabled, :disabled')) return

		var $parent = getParent($this)
		var isActive = $parent.hasClass('open')

		clearMenus()

		if (!isActive) {
			if ('ontouchstart' in document.documentElement && !$parent.closest('.navbar-nav').length) {
				// if mobile we use a backdrop because click events don't delegate
				$('<div class="dropdown-backdrop"/>').insertAfter($(this)).on('click', clearMenus)
			}

			var relatedTarget = {
				relatedTarget: this
			}
			$parent.trigger(e = $.Event('show.bs.dropdown', relatedTarget))

			if (e.isDefaultPrevented()) return

			$this.trigger('focus')

			$parent
				.toggleClass('open')
				.trigger('shown.bs.dropdown', relatedTarget)
		}

		return false
	}

	Dropdown.prototype.keydown = function(e) {
		if (!/(38|40|27)/.test(e.keyCode)) return

		var $this = $(this)

		e.preventDefault()
		e.stopPropagation()

		if ($this.is('.disabled, :disabled')) return

		var $parent = getParent($this)
		var isActive = $parent.hasClass('open')

		if (!isActive || (isActive && e.keyCode == 27)) {
			if (e.which == 27) $parent.find(toggle).trigger('focus')
			return $this.trigger('click')
		}

		var desc = ' li:not(.divider):visible a'
		var $items = $parent.find('[role="menu"]' + desc + ', [role="listbox"]' + desc)

		if (!$items.length) return

		var index = $items.index($items.filter(':focus'))

		if (e.keyCode == 38 && index > 0) index-- // up
			if (e.keyCode == 40 && index < $items.length - 1) index++ // down
				if (!~index) index = 0

		$items.eq(index).trigger('focus')
	}

	function clearMenus(e) {
		if (e && e.which === 3) return
		$(backdrop).remove()
		$(toggle).each(function() {
			var $parent = getParent($(this))
			var relatedTarget = {
				relatedTarget: this
			}
			if (!$parent.hasClass('open')) return
			$parent.trigger(e = $.Event('hide.bs.dropdown', relatedTarget))
			if (e.isDefaultPrevented()) return
			$parent.removeClass('open').trigger('hidden.bs.dropdown', relatedTarget)
		})
	}

	function getParent($this) {
		var selector = $this.attr('data-target')

		if (!selector) {
			selector = $this.attr('href')
			selector = selector && /#[A-Za-z]/.test(selector) && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
		}

		var $parent = selector && $(selector)

		return $parent && $parent.length ? $parent : $this.parent()
	}


	// DROPDOWN PLUGIN DEFINITION
	// ==========================

	function Plugin(option) {
		return this.each(function() {
			var $this = $(this)
			var data = $this.data('bs.dropdown')

			if (!data) $this.data('bs.dropdown', (data = new Dropdown(this)))
			if (typeof option == 'string') data[option].call($this)
		})
	}

	var old = $.fn.dropdown

	$.fn.dropdown = Plugin
	$.fn.dropdown.Constructor = Dropdown


	// DROPDOWN NO CONFLICT
	// ====================

	$.fn.dropdown.noConflict = function() {
		$.fn.dropdown = old
		return this
	}


	// APPLY TO STANDARD DROPDOWN ELEMENTS
	// ===================================

	$(document)
		.on('click.bs.dropdown.data-api', clearMenus)
		.on('click.bs.dropdown.data-api', '.dropdown form', function(e) {
			e.stopPropagation()
		})
		.on('click.bs.dropdown.data-api', toggle, Dropdown.prototype.toggle)
		.on('keydown.bs.dropdown.data-api', toggle + ', [role="menu"], [role="listbox"]', Dropdown.prototype.keydown)

}(jQuery);

/* ========================================================================
 * Bootstrap: tab.js v3.2.0
 * http://getbootstrap.com/javascript/#tabs
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+ function($) {
	'use strict';

	// TAB CLASS DEFINITION
	// ====================

	var Tab = function(element) {
		this.element = $(element)
	}

	Tab.VERSION = '3.2.0'

	Tab.prototype.show = function() {
		var $this = this.element
		var $ul = $this.closest('ul:not(.dropdown-menu)')
		var selector = $this.data('target')

		if (!selector) {
			selector = $this.attr('href')
			selector = selector && selector.replace(/.*(?=#[^\s]*$)/, '') // strip for ie7
		}

		if ($this.parent('li').hasClass('active')) return

		var previous = $ul.find('.active:last a')[0]
		var e = $.Event('show.bs.tab', {
			relatedTarget: previous
		})

		$this.trigger(e)

		if (e.isDefaultPrevented()) return

		var $target = $(selector)

		this.activate($this.closest('li'), $ul)
		this.activate($target, $target.parent(), function() {
			$this.trigger({
				type: 'shown.bs.tab',
				relatedTarget: previous
			})
		})
	}

	Tab.prototype.activate = function(element, container, callback) {
		var $active = container.find('> .active')
		var transition = callback && $.support.transition && $active.hasClass('fade')

		function next() {
			$active
				.removeClass('active')
				.find('> .dropdown-menu > .active')
				.removeClass('active')

			element.addClass('active')

			if (transition) {
				element[0].offsetWidth // reflow for transition
				element.addClass('in')
			} else {
				element.removeClass('fade')
			}

			if (element.parent('.dropdown-menu')) {
				element.closest('li.dropdown').addClass('active')
			}

			callback && callback()
		}

		transition ?
			$active
			.one('bsTransitionEnd', next)
			.emulateTransitionEnd(150) :
			next()

		$active.removeClass('in')
	}


	// TAB PLUGIN DEFINITION
	// =====================

	function Plugin(option) {
		return this.each(function() {
			var $this = $(this)
			var data = $this.data('bs.tab')

			if (!data) $this.data('bs.tab', (data = new Tab(this)))
			if (typeof option == 'string') data[option]()
		})
	}

	var old = $.fn.tab

	$.fn.tab = Plugin
	$.fn.tab.Constructor = Tab


	// TAB NO CONFLICT
	// ===============

	$.fn.tab.noConflict = function() {
		$.fn.tab = old
		return this
	}


	// TAB DATA-API
	// ============

	$(document).on('click.bs.tab.data-api', '[data-toggle="tab"], [data-toggle="pill"]', function(e) {
		e.preventDefault()
		Plugin.call($(this), 'show')
	})

}(jQuery);

/* ========================================================================
 * Bootstrap: transition.js v3.2.0
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+ function($) {
	'use strict';

	// CSS TRANSITION SUPPORT (Shoutout: http://www.modernizr.com/)
	// ============================================================

	function transitionEnd() {
		var el = document.createElement('bootstrap')

		var transEndEventNames = {
			WebkitTransition: 'webkitTransitionEnd',
			MozTransition: 'transitionend',
			OTransition: 'oTransitionEnd otransitionend',
			transition: 'transitionend'
		}

		for (var name in transEndEventNames) {
			if (el.style[name] !== undefined) {
				return {
					end: transEndEventNames[name]
				}
			}
		}

		return false // explicit for ie8 (  ._.)
	}

	// http://blog.alexmaccaw.com/css-transitions
	$.fn.emulateTransitionEnd = function(duration) {
		var called = false
		var $el = this
		$(this).one('bsTransitionEnd', function() {
			called = true
		})
		var callback = function() {
			if (!called) $($el).trigger($.support.transition.end)
		}
		setTimeout(callback, duration)
		return this
	}

	$(function() {
		$.support.transition = transitionEnd()

		if (!$.support.transition) return

		$.event.special.bsTransitionEnd = {
			bindType: $.support.transition.end,
			delegateType: $.support.transition.end,
			handle: function(e) {
				if ($(e.target).is(this)) return e.handleObj.handler.apply(this, arguments)
			}
		}
	})

}(jQuery);

/* ========================================================================
 * Bootstrap: scrollspy.js v3.2.0
 * http://getbootstrap.com/javascript/#scrollspy
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+ function($) {
	'use strict';

	// SCROLLSPY CLASS DEFINITION
	// ==========================

	function ScrollSpy(element, options) {
		var process = $.proxy(this.process, this)

		this.$body = $('body')
		this.$scrollElement = $(element).is('body') ? $(window) : $(element)
		this.options = $.extend({}, ScrollSpy.DEFAULTS, options)
		this.selector = (this.options.target || '') + ' .nav li > a'
		this.offsets = []
		this.targets = []
		this.activeTarget = null
		this.scrollHeight = 0

		this.$scrollElement.on('scroll.bs.scrollspy', process)
		this.refresh()
		this.process()
	}

	ScrollSpy.VERSION = '3.2.0'

	ScrollSpy.DEFAULTS = {
		offset: 10
	}

	ScrollSpy.prototype.getScrollHeight = function() {
		return this.$scrollElement[0].scrollHeight || Math.max(this.$body[0].scrollHeight, document.documentElement.scrollHeight)
	}

	ScrollSpy.prototype.refresh = function() {
		var offsetMethod = 'offset'
		var offsetBase = 0

		if (!$.isWindow(this.$scrollElement[0])) {
			offsetMethod = 'position'
			offsetBase = this.$scrollElement.scrollTop()
		}

		this.offsets = []
		this.targets = []
		this.scrollHeight = this.getScrollHeight()

		var self = this

		this.$body
			.find(this.selector)
			.map(function() {
				var $el = $(this)
				var href = $el.data('target') || $el.attr('href')
				var $href = /^#./.test(href) && $(href)

				return ($href && $href.length && $href.is(':visible') && [
					[$href[offsetMethod]().top + offsetBase, href]
				]) || null
			})
			.sort(function(a, b) {
				return a[0] - b[0]
			})
			.each(function() {
				self.offsets.push(this[0])
				self.targets.push(this[1])
			})
	}

	ScrollSpy.prototype.process = function() {
		var scrollTop = this.$scrollElement.scrollTop() + this.options.offset
		var scrollHeight = this.getScrollHeight()
		var maxScroll = this.options.offset + scrollHeight - this.$scrollElement.height()
		var offsets = this.offsets
		var targets = this.targets
		var activeTarget = this.activeTarget
		var i

		if (this.scrollHeight != scrollHeight) {
			this.refresh()
		}

		if (scrollTop >= maxScroll) {
			return activeTarget != (i = targets[targets.length - 1]) && this.activate(i)
		}

		if (activeTarget && scrollTop <= offsets[0]) {
			return activeTarget != (i = targets[0]) && this.activate(i)
		}

		for (i = offsets.length; i--;) {
			activeTarget != targets[i] && scrollTop >= offsets[i] && (!offsets[i + 1] || scrollTop <= offsets[i + 1]) && this.activate(targets[i])
		}
	}

	ScrollSpy.prototype.activate = function(target) {
		this.activeTarget = target

		$(this.selector)
			.parentsUntil(this.options.target, '.active')
			.removeClass('active')

		var selector = this.selector +
			'[data-target="' + target + '"],' +
			this.selector + '[href="' + target + '"]'

		var active = $(selector)
			.parents('li')
			.addClass('active')

		if (active.parent('.dropdown-menu').length) {
			active = active
				.closest('li.dropdown')
				.addClass('active')
		}

		active.trigger('activate.bs.scrollspy')
	}


	// SCROLLSPY PLUGIN DEFINITION
	// ===========================

	function Plugin(option) {
		return this.each(function() {
			var $this = $(this)
			var data = $this.data('bs.scrollspy')
			var options = typeof option == 'object' && option

			if (!data) $this.data('bs.scrollspy', (data = new ScrollSpy(this, options)))
			if (typeof option == 'string') data[option]()
		})
	}

	var old = $.fn.scrollspy

	$.fn.scrollspy = Plugin
	$.fn.scrollspy.Constructor = ScrollSpy


	// SCROLLSPY NO CONFLICT
	// =====================

	$.fn.scrollspy.noConflict = function() {
		$.fn.scrollspy = old
		return this
	}


	// SCROLLSPY DATA-API
	// ==================

	$(window).on('load.bs.scrollspy.data-api', function() {
		$('[data-spy="scroll"]').each(function() {
			var $spy = $(this)
			Plugin.call($spy, $spy.data())
		})
	})

}(jQuery);

/* ========================================================================
 * Bootstrap: modal.js v3.2.0
 * http://getbootstrap.com/javascript/#modals
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+ function($) {
	'use strict';

	// MODAL CLASS DEFINITION
	// ======================

	var Modal = function(element, options) {
		this.options = options
		this.$body = $(document.body)
		this.$element = $(element)
		this.$backdrop =
			this.isShown = null
		this.scrollbarWidth = 0

		if (this.options.remote) {
			this.$element
				.find('.modal-content')
				.load(this.options.remote, $.proxy(function() {
					this.$element.trigger('loaded.bs.modal')
				}, this))
		}
	}

	Modal.VERSION = '3.2.0'

	Modal.DEFAULTS = {
		backdrop: true,
		keyboard: true,
		show: true
	}

	Modal.prototype.toggle = function(_relatedTarget) {
		return this.isShown ? this.hide() : this.show(_relatedTarget)
	}

	Modal.prototype.show = function(_relatedTarget) {
		var that = this
		var e = $.Event('show.bs.modal', {
			relatedTarget: _relatedTarget
		})

		this.$element.trigger(e)

		if (this.isShown || e.isDefaultPrevented()) return

		this.isShown = true

		this.checkScrollbar()
		this.$body.addClass('modal-open')

		this.setScrollbar()
		this.escape()

		this.$element.on('click.dismiss.bs.modal', '[data-dismiss="modal"]', $.proxy(this.hide, this))

		this.backdrop(function() {
			var transition = $.support.transition && that.$element.hasClass('fade')

			if (!that.$element.parent().length) {
				that.$element.appendTo(that.$body) // don't move modals dom position
			}

			that.$element
				.show()
				.scrollTop(0)

			if (transition) {
				that.$element[0].offsetWidth // force reflow
			}

			that.$element
				.addClass('in')
				.attr('aria-hidden', false)

			that.enforceFocus()

			var e = $.Event('shown.bs.modal', {
				relatedTarget: _relatedTarget
			})

			transition ?
				that.$element.find('.modal-dialog') // wait for modal to slide in
			.one('bsTransitionEnd', function() {
				that.$element.trigger('focus').trigger(e)
			})
				.emulateTransitionEnd(300) :
				that.$element.trigger('focus').trigger(e)
		})
	}

	Modal.prototype.hide = function(e) {
		if (e) e.preventDefault()

		e = $.Event('hide.bs.modal')

		this.$element.trigger(e)

		if (!this.isShown || e.isDefaultPrevented()) return

		this.isShown = false

		this.$body.removeClass('modal-open')

		this.resetScrollbar()
		this.escape()

		$(document).off('focusin.bs.modal')

		this.$element
			.removeClass('in')
			.attr('aria-hidden', true)
			.off('click.dismiss.bs.modal')

		$.support.transition && this.$element.hasClass('fade') ?
			this.$element
			.one('bsTransitionEnd', $.proxy(this.hideModal, this))
			.emulateTransitionEnd(300) :
			this.hideModal()
	}

	Modal.prototype.enforceFocus = function() {
		$(document)
			.off('focusin.bs.modal') // guard against infinite focus loop
		.on('focusin.bs.modal', $.proxy(function(e) {
			if (this.$element[0] !== e.target && !this.$element.has(e.target).length) {
				this.$element.trigger('focus')
			}
		}, this))
	}

	Modal.prototype.escape = function() {
		if (this.isShown && this.options.keyboard) {
			this.$element.on('keyup.dismiss.bs.modal', $.proxy(function(e) {
				e.which == 27 && this.hide()
			}, this))
		} else if (!this.isShown) {
			this.$element.off('keyup.dismiss.bs.modal')
		}
	}

	Modal.prototype.hideModal = function() {
		var that = this
		this.$element.hide()
		this.backdrop(function() {
			that.$element.trigger('hidden.bs.modal')
		})
	}

	Modal.prototype.removeBackdrop = function() {
		this.$backdrop && this.$backdrop.remove()
		this.$backdrop = null
	}

	Modal.prototype.backdrop = function(callback) {
		var that = this
		var animate = this.$element.hasClass('fade') ? 'fade' : ''

		if (this.isShown && this.options.backdrop) {
			var doAnimate = $.support.transition && animate

			this.$backdrop = $('<div class="modal-backdrop ' + animate + '" />')
				.appendTo(this.$body)

			this.$element.on('click.dismiss.bs.modal', $.proxy(function(e) {
				if (e.target !== e.currentTarget) return
				this.options.backdrop == 'static' ? this.$element[0].focus.call(this.$element[0]) : this.hide.call(this)
			}, this))

			if (doAnimate) this.$backdrop[0].offsetWidth // force reflow

			this.$backdrop.addClass('in')

			if (!callback) return

			doAnimate ?
				this.$backdrop
				.one('bsTransitionEnd', callback)
				.emulateTransitionEnd(150) :
				callback()

		} else if (!this.isShown && this.$backdrop) {
			this.$backdrop.removeClass('in')

			var callbackRemove = function() {
				that.removeBackdrop()
				callback && callback()
			}
			$.support.transition && this.$element.hasClass('fade') ?
				this.$backdrop
				.one('bsTransitionEnd', callbackRemove)
				.emulateTransitionEnd(150) :
				callbackRemove()

		} else if (callback) {
			callback()
		}
	}

	Modal.prototype.checkScrollbar = function() {
		if (document.body.clientWidth >= window.innerWidth) return
		this.scrollbarWidth = this.scrollbarWidth || this.measureScrollbar()
	}

	Modal.prototype.setScrollbar = function() {
		var bodyPad = parseInt((this.$body.css('padding-right') || 0), 10)
		if (this.scrollbarWidth) this.$body.css('padding-right', bodyPad + this.scrollbarWidth)
	}

	Modal.prototype.resetScrollbar = function() {
		this.$body.css('padding-right', '')
	}

	Modal.prototype.measureScrollbar = function() { // thx walsh
		var scrollDiv = document.createElement('div')
		scrollDiv.className = 'modal-scrollbar-measure'
		this.$body.append(scrollDiv)
		var scrollbarWidth = scrollDiv.offsetWidth - scrollDiv.clientWidth
		this.$body[0].removeChild(scrollDiv)
		return scrollbarWidth
	}


	// MODAL PLUGIN DEFINITION
	// =======================

	function Plugin(option, _relatedTarget) {
		return this.each(function() {
			var $this = $(this)
			var data = $this.data('bs.modal')
			var options = $.extend({}, Modal.DEFAULTS, $this.data(), typeof option == 'object' && option)

			if (!data) $this.data('bs.modal', (data = new Modal(this, options)))
			if (typeof option == 'string') data[option](_relatedTarget)
			else if (options.show) data.show(_relatedTarget)
		})
	}

	var old = $.fn.modal

	$.fn.modal = Plugin
	$.fn.modal.Constructor = Modal


	// MODAL NO CONFLICT
	// =================

	$.fn.modal.noConflict = function() {
		$.fn.modal = old
		return this
	}


	// MODAL DATA-API
	// ==============

	$(document).on('click.bs.modal.data-api', '[data-toggle="modal"]', function(e) {
		var $this = $(this)
		var href = $this.attr('href')
		var $target = $($this.attr('data-target') || (href && href.replace(/.*(?=#[^\s]+$)/, ''))) // strip for ie7
		var option = $target.data('bs.modal') ? 'toggle' : $.extend({
			remote: !/#/.test(href) && href
		}, $target.data(), $this.data())

		if ($this.is('a')) e.preventDefault()

		$target.one('show.bs.modal', function(showEvent) {
			if (showEvent.isDefaultPrevented()) return // only register focus restorer if modal will actually get shown
			$target.one('hidden.bs.modal', function() {
				$this.is(':visible') && $this.trigger('focus')
			})
		})
		Plugin.call($target, option, this)
	})

}(jQuery);

/* ========================================================================
 * Bootstrap: tooltip.js v3.2.0
 * http://getbootstrap.com/javascript/#tooltip
 * Inspired by the original jQuery.tipsy by Jason Frame
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+ function($) {
	'use strict';

	// TOOLTIP PUBLIC CLASS DEFINITION
	// ===============================

	var Tooltip = function(element, options) {
		this.type =
			this.options =
			this.enabled =
			this.timeout =
			this.hoverState =
			this.$element = null

		this.init('tooltip', element, options)
	}

	Tooltip.VERSION = '3.2.0'

	Tooltip.DEFAULTS = {
		animation: true,
		placement: 'top',
		selector: false,
		template: '<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',
		trigger: 'hover focus',
		title: '',
		delay: 0,
		html: false,
		container: false,
		viewport: {
			selector: 'body',
			padding: 0
		}
	}

	Tooltip.prototype.init = function(type, element, options) {
		this.enabled = true
		this.type = type
		this.$element = $(element)
		this.options = this.getOptions(options)
		this.$viewport = this.options.viewport && $(this.options.viewport.selector || this.options.viewport)

		var triggers = this.options.trigger.split(' ')

		for (var i = triggers.length; i--;) {
			var trigger = triggers[i]

			if (trigger == 'click') {
				this.$element.on('click.' + this.type, this.options.selector, $.proxy(this.toggle, this))
			} else if (trigger != 'manual') {
				var eventIn = trigger == 'hover' ? 'mouseenter' : 'focusin'
				var eventOut = trigger == 'hover' ? 'mouseleave' : 'focusout'

				this.$element.on(eventIn + '.' + this.type, this.options.selector, $.proxy(this.enter, this))
				this.$element.on(eventOut + '.' + this.type, this.options.selector, $.proxy(this.leave, this))
			}
		}

		this.options.selector ?
			(this._options = $.extend({}, this.options, {
			trigger: 'manual',
			selector: ''
		})) :
			this.fixTitle()
	}

	Tooltip.prototype.getDefaults = function() {
		return Tooltip.DEFAULTS
	}

	Tooltip.prototype.getOptions = function(options) {
		options = $.extend({}, this.getDefaults(), this.$element.data(), options)

		if (options.delay && typeof options.delay == 'number') {
			options.delay = {
				show: options.delay,
				hide: options.delay
			}
		}

		return options
	}

	Tooltip.prototype.getDelegateOptions = function() {
		var options = {}
		var defaults = this.getDefaults()

		this._options && $.each(this._options, function(key, value) {
			if (defaults[key] != value) options[key] = value
		})

		return options
	}

	Tooltip.prototype.enter = function(obj) {
		var self = obj instanceof this.constructor ?
			obj : $(obj.currentTarget).data('bs.' + this.type)

		if (!self) {
			self = new this.constructor(obj.currentTarget, this.getDelegateOptions())
			$(obj.currentTarget).data('bs.' + this.type, self)
		}

		clearTimeout(self.timeout)

		self.hoverState = 'in'

		if (!self.options.delay || !self.options.delay.show) return self.show()

		self.timeout = setTimeout(function() {
			if (self.hoverState == 'in') self.show()
		}, self.options.delay.show)
	}

	Tooltip.prototype.leave = function(obj) {
		var self = obj instanceof this.constructor ?
			obj : $(obj.currentTarget).data('bs.' + this.type)

		if (!self) {
			self = new this.constructor(obj.currentTarget, this.getDelegateOptions())
			$(obj.currentTarget).data('bs.' + this.type, self)
		}

		clearTimeout(self.timeout)

		self.hoverState = 'out'

		if (!self.options.delay || !self.options.delay.hide) return self.hide()

		self.timeout = setTimeout(function() {
			if (self.hoverState == 'out') self.hide()
		}, self.options.delay.hide)
	}

	Tooltip.prototype.show = function() {
		var e = $.Event('show.bs.' + this.type)

		if (this.hasContent() && this.enabled) {
			this.$element.trigger(e)

			var inDom = $.contains(document.documentElement, this.$element[0])
			if (e.isDefaultPrevented() || !inDom) return
			var that = this

			var $tip = this.tip()

			var tipId = this.getUID(this.type)

			this.setContent()
			$tip.attr('id', tipId)
			this.$element.attr('aria-describedby', tipId)

			if (this.options.animation) $tip.addClass('fade')

			var placement = typeof this.options.placement == 'function' ?
				this.options.placement.call(this, $tip[0], this.$element[0]) :
				this.options.placement

			var autoToken = /\s?auto?\s?/i
			var autoPlace = autoToken.test(placement)
			if (autoPlace) placement = placement.replace(autoToken, '') || 'top'

			$tip
				.detach()
				.css({
					top: 0,
					left: 0,
					display: 'block'
				})
				.addClass(placement)
				.data('bs.' + this.type, this)

			this.options.container ? $tip.appendTo(this.options.container) : $tip.insertAfter(this.$element)

			var pos = this.getPosition()
			var actualWidth = $tip[0].offsetWidth
			var actualHeight = $tip[0].offsetHeight

			if (autoPlace) {
				var orgPlacement = placement
				var $parent = this.$element.parent()
				var parentDim = this.getPosition($parent)

				placement = placement == 'bottom' && pos.top + pos.height + actualHeight - parentDim.scroll > parentDim.height ? 'top' :
					placement == 'top' && pos.top - parentDim.scroll - actualHeight < 0 ? 'bottom' :
					placement == 'right' && pos.right + actualWidth > parentDim.width ? 'left' :
					placement == 'left' && pos.left - actualWidth < parentDim.left ? 'right' :
					placement

				$tip
					.removeClass(orgPlacement)
					.addClass(placement)
			}

			var calculatedOffset = this.getCalculatedOffset(placement, pos, actualWidth, actualHeight)

			this.applyPlacement(calculatedOffset, placement)

			var complete = function() {
				that.$element.trigger('shown.bs.' + that.type)
				that.hoverState = null
			}

			$.support.transition && this.$tip.hasClass('fade') ?
				$tip
				.one('bsTransitionEnd', complete)
				.emulateTransitionEnd(150) :
				complete()
		}
	}

	Tooltip.prototype.applyPlacement = function(offset, placement) {
		var $tip = this.tip()
		var width = $tip[0].offsetWidth
		var height = $tip[0].offsetHeight

		// manually read margins because getBoundingClientRect includes difference
		var marginTop = parseInt($tip.css('margin-top'), 10)
		var marginLeft = parseInt($tip.css('margin-left'), 10)

		// we must check for NaN for ie 8/9
		if (isNaN(marginTop)) marginTop = 0
		if (isNaN(marginLeft)) marginLeft = 0

		offset.top = offset.top + marginTop
		offset.left = offset.left + marginLeft

		// $.fn.offset doesn't round pixel values
		// so we use setOffset directly with our own function B-0
		$.offset.setOffset($tip[0], $.extend({
			using: function(props) {
				$tip.css({
					top: Math.round(props.top),
					left: Math.round(props.left)
				})
			}
		}, offset), 0)

		$tip.addClass('in')

		// check to see if placing tip in new offset caused the tip to resize itself
		var actualWidth = $tip[0].offsetWidth
		var actualHeight = $tip[0].offsetHeight

		if (placement == 'top' && actualHeight != height) {
			offset.top = offset.top + height - actualHeight
		}

		var delta = this.getViewportAdjustedDelta(placement, offset, actualWidth, actualHeight)

		if (delta.left) offset.left += delta.left
		else offset.top += delta.top

		var arrowDelta = delta.left ? delta.left * 2 - width + actualWidth : delta.top * 2 - height + actualHeight
		var arrowPosition = delta.left ? 'left' : 'top'
		var arrowOffsetPosition = delta.left ? 'offsetWidth' : 'offsetHeight'

		$tip.offset(offset)
		this.replaceArrow(arrowDelta, $tip[0][arrowOffsetPosition], arrowPosition)
	}

	Tooltip.prototype.replaceArrow = function(delta, dimension, position) {
		this.arrow().css(position, delta ? (50 * (1 - delta / dimension) + '%') : '')
	}

	Tooltip.prototype.setContent = function() {
		var $tip = this.tip()
		var title = this.getTitle()

		$tip.find('.tooltip-inner')[this.options.html ? 'html' : 'text'](title)
		$tip.removeClass('fade in top bottom left right')
	}

	Tooltip.prototype.hide = function() {
		var that = this
		var $tip = this.tip()
		var e = $.Event('hide.bs.' + this.type)

		this.$element.removeAttr('aria-describedby')

		function complete() {
			if (that.hoverState != 'in') $tip.detach()
			that.$element.trigger('hidden.bs.' + that.type)
		}

		this.$element.trigger(e)

		if (e.isDefaultPrevented()) return

		$tip.removeClass('in')

		$.support.transition && this.$tip.hasClass('fade') ?
			$tip
			.one('bsTransitionEnd', complete)
			.emulateTransitionEnd(150) :
			complete()

		this.hoverState = null

		return this
	}

	Tooltip.prototype.fixTitle = function() {
		var $e = this.$element
		if ($e.attr('title') || typeof($e.attr('data-original-title')) != 'string') {
			$e.attr('data-original-title', $e.attr('title') || '').attr('title', '')
		}
	}

	Tooltip.prototype.hasContent = function() {
		return this.getTitle()
	}

	Tooltip.prototype.getPosition = function($element) {
		$element = $element || this.$element
		var el = $element[0]
		var isBody = el.tagName == 'BODY'
		return $.extend({}, (typeof el.getBoundingClientRect == 'function') ? el.getBoundingClientRect() : null, {
			scroll: isBody ? document.documentElement.scrollTop || document.body.scrollTop : $element.scrollTop(),
			width: isBody ? $(window).width() : $element.outerWidth(),
			height: isBody ? $(window).height() : $element.outerHeight()
		}, isBody ? {
			top: 0,
			left: 0
		} : $element.offset())
	}

	Tooltip.prototype.getCalculatedOffset = function(placement, pos, actualWidth, actualHeight) {
		return placement == 'bottom' ? {
				top: pos.top + pos.height,
				left: pos.left + pos.width / 2 - actualWidth / 2
			} :
			placement == 'top' ? {
				top: pos.top - actualHeight,
				left: pos.left + pos.width / 2 - actualWidth / 2
			} :
			placement == 'left' ? {
				top: pos.top + pos.height / 2 - actualHeight / 2,
				left: pos.left - actualWidth
			} :
			/* placement == 'right' */
			{
				top: pos.top + pos.height / 2 - actualHeight / 2,
				left: pos.left + pos.width
			}

	}

	Tooltip.prototype.getViewportAdjustedDelta = function(placement, pos, actualWidth, actualHeight) {
		var delta = {
			top: 0,
			left: 0
		}
		if (!this.$viewport) return delta

		var viewportPadding = this.options.viewport && this.options.viewport.padding || 0
		var viewportDimensions = this.getPosition(this.$viewport)

		if (/right|left/.test(placement)) {
			var topEdgeOffset = pos.top - viewportPadding - viewportDimensions.scroll
			var bottomEdgeOffset = pos.top + viewportPadding - viewportDimensions.scroll + actualHeight
			if (topEdgeOffset < viewportDimensions.top) { // top overflow
				delta.top = viewportDimensions.top - topEdgeOffset
			} else if (bottomEdgeOffset > viewportDimensions.top + viewportDimensions.height) { // bottom overflow
				delta.top = viewportDimensions.top + viewportDimensions.height - bottomEdgeOffset
			}
		} else {
			var leftEdgeOffset = pos.left - viewportPadding
			var rightEdgeOffset = pos.left + viewportPadding + actualWidth
			if (leftEdgeOffset < viewportDimensions.left) { // left overflow
				delta.left = viewportDimensions.left - leftEdgeOffset
			} else if (rightEdgeOffset > viewportDimensions.width) { // right overflow
				delta.left = viewportDimensions.left + viewportDimensions.width - rightEdgeOffset
			}
		}

		return delta
	}

	Tooltip.prototype.getTitle = function() {
		var title
		var $e = this.$element
		var o = this.options

		title = $e.attr('data-original-title') || (typeof o.title == 'function' ? o.title.call($e[0]) : o.title)

		return title
	}

	Tooltip.prototype.getUID = function(prefix) {
		do prefix += ~~(Math.random() * 1000000)
		while (document.getElementById(prefix))
		return prefix
	}

	Tooltip.prototype.tip = function() {
		return (this.$tip = this.$tip || $(this.options.template))
	}

	Tooltip.prototype.arrow = function() {
		return (this.$arrow = this.$arrow || this.tip().find('.tooltip-arrow'))
	}

	Tooltip.prototype.validate = function() {
		if (!this.$element[0].parentNode) {
			this.hide()
			this.$element = null
			this.options = null
		}
	}

	Tooltip.prototype.enable = function() {
		this.enabled = true
	}

	Tooltip.prototype.disable = function() {
		this.enabled = false
	}

	Tooltip.prototype.toggleEnabled = function() {
		this.enabled = !this.enabled
	}

	Tooltip.prototype.toggle = function(e) {
		var self = this
		if (e) {
			self = $(e.currentTarget).data('bs.' + this.type)
			if (!self) {
				self = new this.constructor(e.currentTarget, this.getDelegateOptions())
				$(e.currentTarget).data('bs.' + this.type, self)
			}
		}

		self.tip().hasClass('in') ? self.leave(self) : self.enter(self)
	}

	Tooltip.prototype.destroy = function() {
		clearTimeout(this.timeout)
		this.hide().$element.off('.' + this.type).removeData('bs.' + this.type)
	}


	// TOOLTIP PLUGIN DEFINITION
	// =========================

	function Plugin(option) {
		return this.each(function() {
			var $this = $(this)
			var data = $this.data('bs.tooltip')
			var options = typeof option == 'object' && option

			if (!data && option == 'destroy') return
			if (!data) $this.data('bs.tooltip', (data = new Tooltip(this, options)))
			if (typeof option == 'string') data[option]()
		})
	}

	var old = $.fn.tooltip

	$.fn.tooltip = Plugin
	$.fn.tooltip.Constructor = Tooltip


	// TOOLTIP NO CONFLICT
	// ===================

	$.fn.tooltip.noConflict = function() {
		$.fn.tooltip = old
		return this
	}

}(jQuery);

/* ========================================================================
 * Bootstrap: popover.js v3.2.0
 * http://getbootstrap.com/javascript/#popovers
 * ========================================================================
 * Copyright 2011-2014 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */


+ function($) {
	'use strict';

	// POPOVER PUBLIC CLASS DEFINITION
	// ===============================

	var Popover = function(element, options) {
		this.init('popover', element, options)
	}

	if (!$.fn.tooltip) throw new Error('Popover requires tooltip.js')

	Popover.VERSION = '3.2.0'

	Popover.DEFAULTS = $.extend({}, $.fn.tooltip.Constructor.DEFAULTS, {
		placement: 'right',
		trigger: 'click',
		content: '',
		template: '<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'
	})


	// NOTE: POPOVER EXTENDS tooltip.js
	// ================================

	Popover.prototype = $.extend({}, $.fn.tooltip.Constructor.prototype)

	Popover.prototype.constructor = Popover

	Popover.prototype.getDefaults = function() {
		return Popover.DEFAULTS
	}

	Popover.prototype.setContent = function() {
		var $tip = this.tip()
		var title = this.getTitle()
		var content = this.getContent()

		$tip.find('.popover-title')[this.options.html ? 'html' : 'text'](title)
		$tip.find('.popover-content').empty()[ // we use append for html objects to maintain js events
			this.options.html ? (typeof content == 'string' ? 'html' : 'append') : 'text'
		](content)

		$tip.removeClass('fade top bottom left right in')

		// IE8 doesn't accept hiding via the `:empty` pseudo selector, we have to do
		// this manually by checking the contents.
		if (!$tip.find('.popover-title').html()) $tip.find('.popover-title').hide()
	}

	Popover.prototype.hasContent = function() {
		return this.getTitle() || this.getContent()
	}

	Popover.prototype.getContent = function() {
		var $e = this.$element
		var o = this.options

		return $e.attr('data-content') || (typeof o.content == 'function' ?
			o.content.call($e[0]) :
			o.content)
	}

	Popover.prototype.arrow = function() {
		return (this.$arrow = this.$arrow || this.tip().find('.arrow'))
	}

	Popover.prototype.tip = function() {
		if (!this.$tip) this.$tip = $(this.options.template)
		return this.$tip
	}


	// POPOVER PLUGIN DEFINITION
	// =========================

	function Plugin(option) {
		return this.each(function() {
			var $this = $(this)
			var data = $this.data('bs.popover')
			var options = typeof option == 'object' && option

			if (!data && option == 'destroy') return
			if (!data) $this.data('bs.popover', (data = new Popover(this, options)))
			if (typeof option == 'string') data[option]()
		})
	}

	var old = $.fn.popover

	$.fn.popover = Plugin
	$.fn.popover.Constructor = Popover


	// POPOVER NO CONFLICT
	// ===================

	$.fn.popover.noConflict = function() {
		$.fn.popover = old
		return this
	}

}(jQuery);

/*************************************************************************************************************!
 * Bootstrap-select v1.6.2 (http://silviomoreto.github.io/bootstrap-select/)
 *
 * Copyright 2013-2014 bootstrap-select
 * Licensed under MIT (https://github.com/silviomoreto/bootstrap-select/blob/master/LICENSE)
 */
(function($) {
	'use strict';

	// Case insensitive search
	$.expr[':'].icontains = function(obj, index, meta) {
		return icontains($(obj).text(), meta[3]);
	};

	// Case and accent insensitive search
	$.expr[':'].aicontains = function(obj, index, meta) {
		return icontains($(obj).data('normalizedText') || $(obj).text(), meta[3]);
	};

	/**
	 * Actual implementation of the case insensitive search.
	 * @access private
	 * @param {String} haystack
	 * @param {String} needle
	 * @returns {boolean}
	 */
	function icontains(haystack, needle) {
		return haystack.toUpperCase().indexOf(needle.toUpperCase()) > -1;
	}

	/**
	 * Remove all diatrics from the given text.
	 * @access private
	 * @param {String} text
	 * @returns {String}
	 */
	function normalizeToBase(text) {
		var rExps = [{
			re: /[\xC0-\xC6]/g,
			ch: "A"
		}, {
			re: /[\xE0-\xE6]/g,
			ch: "a"
		}, {
			re: /[\xC8-\xCB]/g,
			ch: "E"
		}, {
			re: /[\xE8-\xEB]/g,
			ch: "e"
		}, {
			re: /[\xCC-\xCF]/g,
			ch: "I"
		}, {
			re: /[\xEC-\xEF]/g,
			ch: "i"
		}, {
			re: /[\xD2-\xD6]/g,
			ch: "O"
		}, {
			re: /[\xF2-\xF6]/g,
			ch: "o"
		}, {
			re: /[\xD9-\xDC]/g,
			ch: "U"
		}, {
			re: /[\xF9-\xFC]/g,
			ch: "u"
		}, {
			re: /[\xC7-\xE7]/g,
			ch: "c"
		}, {
			re: /[\xD1]/g,
			ch: "N"
		}, {
			re: /[\xF1]/g,
			ch: "n"
		}];
		$.each(rExps, function() {
			text = text.replace(this.re, this.ch);
		});
		return text;
	}

	var Selectpicker = function(element, options, e) {
		if (e) {
			e.stopPropagation();
			e.preventDefault();
		}

		this.$element = $(element);
		this.$newElement = null;
		this.$button = null;
		this.$menu = null;
		this.$lis = null;
		this.options = options;

		// If we have no title yet, try to pull it from the html title attribute (jQuery doesnt' pick it up as it's not a
		// data-attribute)
		if (this.options.title === null) {
			this.options.title = this.$element.attr('title');
		}

		//Expose public methods
		this.val = Selectpicker.prototype.val;
		this.render = Selectpicker.prototype.render;
		this.refresh = Selectpicker.prototype.refresh;
		this.setStyle = Selectpicker.prototype.setStyle;
		this.selectAll = Selectpicker.prototype.selectAll;
		this.deselectAll = Selectpicker.prototype.deselectAll;
		this.destroy = Selectpicker.prototype.remove;
		this.remove = Selectpicker.prototype.remove;
		this.show = Selectpicker.prototype.show;
		this.hide = Selectpicker.prototype.hide;

		this.init();
	};

	Selectpicker.VERSION = '1.6.2';

	// part of this is duplicated in i18n/defaults-en_US.js. Make sure to update both.
	Selectpicker.DEFAULTS = {
		noneSelectedText: 'Nothing selected',
		noneResultsText: 'No results match',
		countSelectedText: function(numSelected, numTotal) {
			return (numSelected == 1) ? "{0} item selected" : "{0} items selected";
		},
		maxOptionsText: function(numAll, numGroup) {
			var arr = [];

			arr[0] = (numAll == 1) ? 'Limit reached ({n} item max)' : 'Limit reached ({n} items max)';
			arr[1] = (numGroup == 1) ? 'Group limit reached ({n} item max)' : 'Group limit reached ({n} items max)';

			return arr;
		},
		selectAllText: 'Select All',
		deselectAllText: 'Deselect All',
		multipleSeparator: ', ',
		style: 'btn-select',
		size: 'auto',
		title: 'string',
		selectedTextFormat: 'values',
		width: false,
		container: false,
		hideDisabled: false,
		showSubtext: false,
		showIcon: true,
		showContent: true,
		dropupAuto: true,
		header: false,
		liveSearch: false,
		actionsBox: false,
		iconBase: 'glyphicon',
		tickIcon: 'glyphicon-ok',
		maxOptions: false,
		mobile: false,
		selectOnTab: false,
		dropdownAlignRight: false,
		searchAccentInsensitive: false
	};

	Selectpicker.prototype = {

		constructor: Selectpicker,

		init: function() {
			var that = this,
				id = this.$element.attr('id');

			this.$element.hide();
			this.multiple = this.$element.prop('multiple');
			this.autofocus = this.$element.prop('autofocus');
			this.$newElement = this.createView();
			this.$element.after(this.$newElement);
			this.$menu = this.$newElement.find('> .dropdown-menu');
			this.$button = this.$newElement.find('> button');
			this.$searchbox = this.$newElement.find('input');

			if (this.options.dropdownAlignRight)
				this.$menu.addClass('dropdown-menu-right');

			if (typeof id !== 'undefined') {
				this.$button.attr('data-id', id);
				$('label[for="' + id + '"]').click(function(e) {
					e.preventDefault();
					that.$button.focus();
				});
			}

			this.checkDisabled();
			this.clickListener();
			if (this.options.liveSearch) this.liveSearchListener();
			this.render();
			this.liHeight();
			this.setStyle();
			this.setWidth();
			if (this.options.container) this.selectPosition();
			this.$menu.data('this', this);
			this.$newElement.data('this', this);
			if (this.options.mobile) this.mobile();
		},

		createDropdown: function() {
			// Options
			// If we are multiple, then add the show-tick class by default
			var multiple = this.multiple ? ' show-tick' : '',
				inputGroup = this.$element.parent().hasClass('input-group') ? ' input-group-btn' : '',
				autofocus = this.autofocus ? ' autofocus' : '',
				btnSize = this.$element.parents().hasClass('form-group-lg') ? ' btn-lg' : (this.$element.parents().hasClass('form-group-sm') ? ' btn-sm' : '');
			// Elements
			var header = this.options.header ? '<div class="popover-title"><button type="button" class="close" aria-hidden="true">&times;</button>' + this.options.header + '</div>' : '';
			var searchbox = this.options.liveSearch ? '<div class="bs-searchbox"><input type="text" class="input-block-level form-control" autocomplete="off" /></div>' : '';
			var actionsbox = this.options.actionsBox ? '<div class="bs-actionsbox">' +
				'<div class="btn-group btn-block">' +
				'<button class="actions-btn bs-select-all btn btn-sm btn-default">' +
				this.options.selectAllText +
				'</button>' +
				'<button class="actions-btn bs-deselect-all btn btn-sm btn-default">' +
				this.options.deselectAllText +
				'</button>' +
				'</div>' +
				'</div>' : '';
			var drop =
				'<div class="btn-group bootstrap-select' + multiple + inputGroup + '">' +
				'<button type="button" class="btn dropdown-toggle selectpicker' + btnSize + '" data-toggle="dropdown"' + autofocus + '>' +
				'<span class="filter-option pull-left"></span>&nbsp;' +
				'<span class="caret"></span>' +
				'</button>' +
				'<div class="dropdown-menu open">' +
				header +
				searchbox +
				actionsbox +
				'<ul class="dropdown-menu inner selectpicker" role="menu">' +
				'</ul>' +
				'</div>' +
				'</div>';

			return $(drop);
		},

		createView: function() {
			var $drop = this.createDropdown();
			var $li = this.createLi();
			$drop.find('ul').append($li);
			return $drop;
		},

		reloadLi: function() {
			//Remove all children.
			this.destroyLi();
			//Re build
			var $li = this.createLi();
			this.$menu.find('ul').append($li);
		},

		destroyLi: function() {
			this.$menu.find('li').remove();
		},

		createLi: function() {
			var that = this,
				_li = [],
				optID = 0;

			// Helper functions
			/**
			 * @param content
			 * @param [index]
			 * @param [classes]
			 * @returns {string}
			 */
			var generateLI = function(content, index, classes) {
				return '<li' +
					(typeof classes !== 'undefined' ? ' class="' + classes + '"' : '') +
					(typeof index !== 'undefined' | null === index ? ' data-original-index="' + index + '"' : '') +
					'>' + content + '</li>';
			};

			/**
			 * @param text
			 * @param [classes]
			 * @param [inline]
			 * @param [optgroup]
			 * @returns {string}
			 */
			var generateA = function(text, classes, inline, optgroup) {
				var normText = normalizeToBase($.trim($("<div/>").html(text).text()).replace(/\s\s+/g, ' '));
				return '<a tabindex="0"' +
					(typeof classes !== 'undefined' ? ' class="' + classes + '"' : '') +
					(typeof inline !== 'undefined' ? ' style="' + inline + '"' : '') +
					(typeof optgroup !== 'undefined' ? 'data-optgroup="' + optgroup + '"' : '') +
					' data-normalized-text="' + normText + '"' +
					'>' + text +
					'<span class="' + that.options.iconBase + ' ' + that.options.tickIcon + ' check-mark"></span>' +
					'</a>';
			};

			this.$element.find('option').each(function() {
				var $this = $(this);

				// Get the class and text for the option
				var optionClass = $this.attr('class') || '',
					inline = $this.attr('style'),
					text = $this.data('content') ? $this.data('content') : $this.html(),
					subtext = typeof $this.data('subtext') !== 'undefined' ? '<small class="muted text-muted">' + $this.data('subtext') + '</small>' : '',
					icon = typeof $this.data('icon') !== 'undefined' ? '<span class="' + that.options.iconBase + ' ' + $this.data('icon') + '"></span> ' : '',
					isDisabled = $this.is(':disabled') || $this.parent().is(':disabled'),
					index = $this[0].index;
				if (icon !== '' && isDisabled) {
					icon = '<span>' + icon + '</span>';
				}

				if (!$this.data('content')) {
					// Prepend any icon and append any subtext to the main text.
					text = icon + '<span class="text">' + text + subtext + '</span>';
				}

				if (that.options.hideDisabled && isDisabled) {
					return;
				}

				if ($this.parent().is('optgroup') && $this.data('divider') !== true) {
					if ($this.index() === 0) { // Is it the first option of the optgroup?
						optID += 1;

						// Get the opt group label
						var label = $this.parent().attr('label');
						var labelSubtext = typeof $this.parent().data('subtext') !== 'undefined' ? '<small class="muted text-muted">' + $this.parent().data('subtext') + '</small>' : '';
						var labelIcon = $this.parent().data('icon') ? '<span class="' + that.options.iconBase + ' ' + $this.parent().data('icon') + '"></span> ' : '';
						label = labelIcon + '<span class="text">' + label + labelSubtext + '</span>';

						if (index !== 0 && _li.length > 0) { // Is it NOT the first option of the select && are there elements in the dropdown?
							_li.push(generateLI('', null, 'divider'));
						}

						_li.push(generateLI(label, null, 'dropdown-header'));
					}

					_li.push(generateLI(generateA(text, 'opt ' + optionClass, inline, optID), index));
				} else if ($this.data('divider') === true) {
					_li.push(generateLI('', index, 'divider'));
				} else if ($this.data('hidden') === true) {
					_li.push(generateLI(generateA(text, optionClass, inline), index, 'hide is-hidden'));
				} else {
					_li.push(generateLI(generateA(text, optionClass, inline), index));
				}
			});

			//If we are not multiple, we don't have a selected item, and we don't have a title, select the first element so something is set in the button
			if (!this.multiple && this.$element.find('option:selected').length === 0 && !this.options.title) {
				this.$element.find('option').eq(0).prop('selected', true).attr('selected', 'selected');
			}

			return $(_li.join(''));
		},

		findLis: function() {
			if (this.$lis == null) this.$lis = this.$menu.find('li');
			return this.$lis;
		},

		/**
		 * @param [updateLi] defaults to true
		 */
		render: function(updateLi) {
			var that = this;

			//Update the LI to match the SELECT
			if (updateLi !== false) {
				this.$element.find('option').each(function(index) {
					that.setDisabled(index, $(this).is(':disabled') || $(this).parent().is(':disabled'));
					that.setSelected(index, $(this).is(':selected'));
				});
			}

			this.tabIndex();
			var notDisabled = this.options.hideDisabled ? ':not([disabled])' : '';
			var selectedItems = this.$element.find('option:selected' + notDisabled).map(function() {
				var $this = $(this);
				var icon = $this.data('icon') && that.options.showIcon ? '<i class="' + that.options.iconBase + ' ' + $this.data('icon') + '"></i> ' : '';
				var subtext;
				if (that.options.showSubtext && $this.attr('data-subtext') && !that.multiple) {
					subtext = ' <small class="muted text-muted">' + $this.data('subtext') + '</small>';
				} else {
					subtext = '';
				}
				if ($this.data('content') && that.options.showContent) {
					return $this.data('content');
				} else if (typeof $this.attr('title') !== 'undefined') {
					return $this.attr('title');
				} else {
					return icon + $this.html() + subtext;
				}
			}).toArray();

			//Fixes issue in IE10 occurring when no default option is selected and at least one option is disabled
			//Convert all the values into a comma delimited string
			var title = !this.multiple ? selectedItems[0] : selectedItems.join(this.options.multipleSeparator);

			//If this is multi select, and the selectText type is count, the show 1 of 2 selected etc..
			if (this.multiple && this.options.selectedTextFormat.indexOf('count') > -1) {
				var max = this.options.selectedTextFormat.split('>');
				if ((max.length > 1 && selectedItems.length > max[1]) || (max.length == 1 && selectedItems.length >= 2)) {
					notDisabled = this.options.hideDisabled ? ', [disabled]' : '';
					var totalCount = this.$element.find('option').not('[data-divider="true"], [data-hidden="true"]' + notDisabled).length,
						tr8nText = (typeof this.options.countSelectedText === 'function') ? this.options.countSelectedText(selectedItems.length, totalCount) : this.options.countSelectedText;
					title = tr8nText.replace('{0}', selectedItems.length.toString()).replace('{1}', totalCount.toString());
				}
			}

			this.options.title = this.$element.attr('title');

			if (this.options.selectedTextFormat == 'static') {
				title = this.options.title;
			}

			//If we dont have a title, then use the default, or if nothing is set at all, use the not selected text
			if (!title) {
				title = typeof this.options.title !== 'undefined' ? this.options.title : this.options.noneSelectedText;
			}

			this.$button.attr('title', $.trim($("<div/>").html(title).text()).replace(/\s\s+/g, ' '));
			this.$newElement.find('.filter-option').html(title);
		},

		/**
		 * @param [style]
		 * @param [status]
		 */
		setStyle: function(style, status) {
			if (this.$element.attr('class')) {
				this.$newElement.addClass(this.$element.attr('class').replace(/selectpicker|mobile-device|validate\[.*\]/gi, ''));
			}

			var buttonClass = style ? style : this.options.style;

			if (status == 'add') {
				this.$button.addClass(buttonClass);
			} else if (status == 'remove') {
				this.$button.removeClass(buttonClass);
			} else {
				this.$button.removeClass(this.options.style);
				this.$button.addClass(buttonClass);
			}
		},

		liHeight: function() {
			if (this.options.size === false) return;

			var $selectClone = this.$menu.parent().clone().find('> .dropdown-toggle').prop('autofocus', false).end().appendTo('body'),
				$menuClone = $selectClone.addClass('open').find('> .dropdown-menu'),
				liHeight = $menuClone.find('li').not('.divider').not('.dropdown-header').filter(':visible').children('a').outerHeight(),
				headerHeight = this.options.header ? $menuClone.find('.popover-title').outerHeight() : 0,
				searchHeight = this.options.liveSearch ? $menuClone.find('.bs-searchbox').outerHeight() : 0,
				actionsHeight = this.options.actionsBox ? $menuClone.find('.bs-actionsbox').outerHeight() : 0;

			$selectClone.remove();

			this.$newElement
				.data('liHeight', liHeight)
				.data('headerHeight', headerHeight)
				.data('searchHeight', searchHeight)
				.data('actionsHeight', actionsHeight);
		},

		setSize: function() {
			this.findLis();
			var that = this,
				menu = this.$menu,
				menuInner = menu.find('.inner'),
				selectHeight = this.$newElement.outerHeight(),
				liHeight = this.$newElement.data('liHeight'),
				headerHeight = this.$newElement.data('headerHeight'),
				searchHeight = this.$newElement.data('searchHeight'),
				actionsHeight = this.$newElement.data('actionsHeight'),
				divHeight = this.$lis.filter('.divider').outerHeight(true),
				menuPadding = parseInt(menu.css('padding-top')) +
				parseInt(menu.css('padding-bottom')) +
				parseInt(menu.css('border-top-width')) +
				parseInt(menu.css('border-bottom-width')),
				notDisabled = this.options.hideDisabled ? ', .disabled' : '',
				$window = $(window),
				menuExtras = menuPadding + parseInt(menu.css('margin-top')) + parseInt(menu.css('margin-bottom')) + 2,
				menuHeight,
				selectOffsetTop,
				selectOffsetBot,
				posVert = function() {
					// JQuery defines a scrollTop function, but in pure JS it's a property
					//noinspection JSValidateTypes
					selectOffsetTop = that.$newElement.offset().top - $window.scrollTop();
					selectOffsetBot = $window.height() - selectOffsetTop - selectHeight;
				};
			posVert();
			if (this.options.header) menu.css('padding-top', 0);

			if (this.options.size == 'auto') {
				var getSize = function() {
					var minHeight,
						lisVis = that.$lis.not('.hide');

					posVert();
					menuHeight = selectOffsetBot - menuExtras;

					if (that.options.dropupAuto) {
						that.$newElement.toggleClass('dropup', (selectOffsetTop > selectOffsetBot) && ((menuHeight - menuExtras) < menu.height()));
					}
					if (that.$newElement.hasClass('dropup')) {
						menuHeight = selectOffsetTop - menuExtras;
					}

					if ((lisVis.length + lisVis.filter('.dropdown-header').length) > 3) {
						minHeight = liHeight * 3 + menuExtras - 2;
					} else {
						minHeight = 0;
					}

					menu.css({
						'max-height': menuHeight + 'px',
						'overflow': 'hidden',
						'min-height': minHeight + headerHeight + searchHeight + actionsHeight + 'px'
					});
					menuInner.css({
						'max-height': menuHeight - headerHeight - searchHeight - actionsHeight - menuPadding + 'px',
						'overflow-y': 'auto',
						'min-height': Math.max(minHeight - menuPadding, 0) + 'px'
					});
				};
				getSize();
				this.$searchbox.off('input.getSize propertychange.getSize').on('input.getSize propertychange.getSize', getSize);
				$(window).off('resize.getSize').on('resize.getSize', getSize);
				$(window).off('scroll.getSize').on('scroll.getSize', getSize);
			} else if (this.options.size && this.options.size != 'auto' && menu.find('li' + notDisabled).length > this.options.size) {
				var optIndex = this.$lis.not('.divider' + notDisabled).find(' > *').slice(0, this.options.size).last().parent().index();
				var divLength = this.$lis.slice(0, optIndex + 1).filter('.divider').length;
				menuHeight = liHeight * this.options.size + divLength * divHeight + menuPadding;
				if (that.options.dropupAuto) {
					//noinspection JSUnusedAssignment
					this.$newElement.toggleClass('dropup', (selectOffsetTop > selectOffsetBot) && (menuHeight < menu.height()));
				}
				menu.css({
					'max-height': menuHeight + headerHeight + searchHeight + actionsHeight + 'px',
					'overflow': 'hidden'
				});
				menuInner.css({
					'max-height': menuHeight - menuPadding + 'px',
					'overflow-y': 'auto'
				});
			}
		},

		setWidth: function() {
			if (this.options.width == 'auto') {
				this.$menu.css('min-width', '0');

				// Get correct width if element hidden
				var selectClone = this.$newElement.clone().appendTo('body');
				var ulWidth = selectClone.find('> .dropdown-menu').css('width');
				var btnWidth = selectClone.css('width', 'auto').find('> button').css('width');
				selectClone.remove();

				// Set width to whatever's larger, button title or longest option
				this.$newElement.css('width', Math.max(parseInt(ulWidth), parseInt(btnWidth)) + 'px');
			} else if (this.options.width == 'fit') {
				// Remove inline min-width so width can be changed from 'auto'
				this.$menu.css('min-width', '');
				this.$newElement.css('width', '').addClass('fit-width');
			} else if (this.options.width) {
				// Remove inline min-width so width can be changed from 'auto'
				this.$menu.css('min-width', '');
				this.$newElement.css('width', this.options.width);
			} else {
				// Remove inline min-width/width so width can be changed
				this.$menu.css('min-width', '');
				this.$newElement.css('width', '');
			}
			// Remove fit-width class if width is changed programmatically
			if (this.$newElement.hasClass('fit-width') && this.options.width !== 'fit') {
				this.$newElement.removeClass('fit-width');
			}
		},

		selectPosition: function() {
			var that = this,
				drop = '<div />',
				$drop = $(drop),
				pos,
				actualHeight,
				getPlacement = function($element) {
					$drop.addClass($element.attr('class').replace(/form-control/gi, '')).toggleClass('dropup', $element.hasClass('dropup'));
					pos = $element.offset();
					actualHeight = $element.hasClass('dropup') ? 0 : $element[0].offsetHeight;
					$drop.css({
						'top': pos.top + actualHeight,
						'left': pos.left,
						'width': $element[0].offsetWidth,
						'position': 'absolute'
					});
				};
			this.$newElement.on('click', function() {
				if (that.isDisabled()) {
					return;
				}
				getPlacement($(this));
				$drop.appendTo(that.options.container);
				$drop.toggleClass('open', !$(this).hasClass('open'));
				$drop.append(that.$menu);
			});
			$(window).resize(function() {
				getPlacement(that.$newElement);
			});
			$(window).on('scroll', function() {
				getPlacement(that.$newElement);
			});
			$('html').on('click', function(e) {
				if ($(e.target).closest(that.$newElement).length < 1) {
					$drop.removeClass('open');
				}
			});
		},

		setSelected: function(index, selected) {
			this.findLis();
			this.$lis.filter('[data-original-index="' + index + '"]').toggleClass('selected', selected);
		},

		setDisabled: function(index, disabled) {
			this.findLis();
			if (disabled) {
				this.$lis.filter('[data-original-index="' + index + '"]').addClass('disabled').find('a').attr('href', '#').attr('tabindex', -1);
			} else {
				this.$lis.filter('[data-original-index="' + index + '"]').removeClass('disabled').find('a').removeAttr('href').attr('tabindex', 0);
			}
		},

		isDisabled: function() {
			return this.$element.is(':disabled');
		},

		checkDisabled: function() {
			var that = this;

			if (this.isDisabled()) {
				this.$button.addClass('disabled').attr('tabindex', -1);
			} else {
				if (this.$button.hasClass('disabled')) {
					this.$button.removeClass('disabled');
				}

				if (this.$button.attr('tabindex') == -1) {
					if (!this.$element.data('tabindex')) this.$button.removeAttr('tabindex');
				}
			}

			this.$button.click(function() {
				return !that.isDisabled();
			});
		},

		tabIndex: function() {
			if (this.$element.is('[tabindex]')) {
				this.$element.data('tabindex', this.$element.attr('tabindex'));
				this.$button.attr('tabindex', this.$element.data('tabindex'));
			}
		},

		clickListener: function() {
			var that = this;

			this.$newElement.on('touchstart.dropdown', '.dropdown-menu', function(e) {
				e.stopPropagation();
			});

			this.$newElement.on('click', function() {
				that.setSize();
				if (!that.options.liveSearch && !that.multiple) {
					setTimeout(function() {
						that.$menu.find('.selected a').focus();
					}, 10);
				}
			});

			this.$menu.on('click', 'li a', function(e) {
				var $this = $(this),
					clickedIndex = $this.parent().data('originalIndex'),
					prevValue = that.$element.val(),
					prevIndex = that.$element.prop('selectedIndex');

				// Don't close on multi choice menu
				if (that.multiple) {
					e.stopPropagation();
				}

				e.preventDefault();

				//Don't run if we have been disabled
				if (!that.isDisabled() && !$this.parent().hasClass('disabled')) {
					var $options = that.$element.find('option'),
						$option = $options.eq(clickedIndex),
						state = $option.prop('selected'),
						$optgroup = $option.parent('optgroup'),
						maxOptions = that.options.maxOptions,
						maxOptionsGrp = $optgroup.data('maxOptions') || false;

					if (!that.multiple) { // Deselect all others if not multi select box
						$options.prop('selected', false);
						$option.prop('selected', true);
						that.$menu.find('.selected').removeClass('selected');
						that.setSelected(clickedIndex, true);
					} else { // Toggle the one we have chosen if we are multi select.
						$option.prop('selected', !state);
						that.setSelected(clickedIndex, !state);
						$this.blur();

						if ((maxOptions !== false) || (maxOptionsGrp !== false)) {
							var maxReached = maxOptions < $options.filter(':selected').length,
								maxReachedGrp = maxOptionsGrp < $optgroup.find('option:selected').length;

							if ((maxOptions && maxReached) || (maxOptionsGrp && maxReachedGrp)) {
								if (maxOptions && maxOptions == 1) {
									$options.prop('selected', false);
									$option.prop('selected', true);
									that.$menu.find('.selected').removeClass('selected');
									that.setSelected(clickedIndex, true);
								} else if (maxOptionsGrp && maxOptionsGrp == 1) {
									$optgroup.find('option:selected').prop('selected', false);
									$option.prop('selected', true);
									var optgroupID = $this.data('optgroup');

									that.$menu.find('.selected').has('a[data-optgroup="' + optgroupID + '"]').removeClass('selected');

									that.setSelected(clickedIndex, true);
								} else {
									var maxOptionsArr = (typeof that.options.maxOptionsText === 'function') ?
										that.options.maxOptionsText(maxOptions, maxOptionsGrp) : that.options.maxOptionsText,
										maxTxt = maxOptionsArr[0].replace('{n}', maxOptions),
										maxTxtGrp = maxOptionsArr[1].replace('{n}', maxOptionsGrp),
										$notify = $('<div class="notify"></div>');
									// If {var} is set in array, replace it
									/** @deprecated */
									if (maxOptionsArr[2]) {
										maxTxt = maxTxt.replace('{var}', maxOptionsArr[2][maxOptions > 1 ? 0 : 1]);
										maxTxtGrp = maxTxtGrp.replace('{var}', maxOptionsArr[2][maxOptionsGrp > 1 ? 0 : 1]);
									}

									$option.prop('selected', false);

									that.$menu.append($notify);

									if (maxOptions && maxReached) {
										$notify.append($('<div>' + maxTxt + '</div>'));
										that.$element.trigger('maxReached.bs.select');
									}

									if (maxOptionsGrp && maxReachedGrp) {
										$notify.append($('<div>' + maxTxtGrp + '</div>'));
										that.$element.trigger('maxReachedGrp.bs.select');
									}

									setTimeout(function() {
										that.setSelected(clickedIndex, false);
									}, 10);

									$notify.delay(750).fadeOut(300, function() {
										$(this).remove();
									});
								}
							}
						}
					}

					if (!that.multiple) {
						that.$button.focus();
					} else if (that.options.liveSearch) {
						that.$searchbox.focus();
					}

					// Trigger select 'change'
					if ((prevValue != that.$element.val() && that.multiple) || (prevIndex != that.$element.prop('selectedIndex') && !that.multiple)) {
						that.$element.change();
					}
				}
			});

			this.$menu.on('click', 'li.disabled a, .popover-title, .popover-title :not(.close)', function(e) {
				if (e.target == this) {
					e.preventDefault();
					e.stopPropagation();
					if (!that.options.liveSearch) {
						that.$button.focus();
					} else {
						that.$searchbox.focus();
					}
				}
			});

			this.$menu.on('click', 'li.divider, li.dropdown-header', function(e) {
				e.preventDefault();
				e.stopPropagation();
				if (!that.options.liveSearch) {
					that.$button.focus();
				} else {
					that.$searchbox.focus();
				}
			});

			this.$menu.on('click', '.popover-title .close', function() {
				that.$button.focus();
			});

			this.$searchbox.on('click', function(e) {
				e.stopPropagation();
			});


			this.$menu.on('click', '.actions-btn', function(e) {
				if (that.options.liveSearch) {
					that.$searchbox.focus();
				} else {
					that.$button.focus();
				}

				e.preventDefault();
				e.stopPropagation();

				if ($(this).is('.bs-select-all')) {
					that.selectAll();
				} else {
					that.deselectAll();
				}
				that.$element.change();
			});

			this.$element.change(function() {
				that.render(false);
			});
		},

		liveSearchListener: function() {
			var that = this,
				no_results = $('<li class="no-results"></li>');

			this.$newElement.on('click.dropdown.data-api', function() {
				that.$menu.find('.active').removeClass('active');
				if (!!that.$searchbox.val()) {
					that.$searchbox.val('');
					that.$lis.not('.is-hidden').removeClass('hide');
					if (!!no_results.parent().length) no_results.remove();
				}
				if (!that.multiple) that.$menu.find('.selected').addClass('active');
				setTimeout(function() {
					that.$searchbox.focus();
				}, 10);
			});

			this.$searchbox.on('input propertychange', function() {
				if (that.$searchbox.val()) {

					if (that.options.searchAccentInsensitive) {
						that.$lis.not('.is-hidden').removeClass('hide').find('a').not(':aicontains(' + normalizeToBase(that.$searchbox.val()) + ')').parent().addClass('hide');
					} else {
						that.$lis.not('.is-hidden').removeClass('hide').find('a').not(':icontains(' + that.$searchbox.val() + ')').parent().addClass('hide');
					}

					if (!that.$menu.find('li').filter(':visible:not(.no-results)').length) {
						if (!!no_results.parent().length) no_results.remove();
						no_results.html(that.options.noneResultsText + ' "' + that.$searchbox.val() + '"').show();
						that.$menu.find('li').last().after(no_results);
					} else if (!!no_results.parent().length) {
						no_results.remove();
					}

				} else {
					that.$lis.not('.is-hidden').removeClass('hide');
					if (!!no_results.parent().length) no_results.remove();
				}

				that.$menu.find('li.active').removeClass('active');
				that.$menu.find('li').filter(':visible:not(.divider)').eq(0).addClass('active').find('a').focus();
				$(this).focus();
			});
		},

		val: function(value) {
			if (typeof value !== 'undefined') {
				this.$element.val(value);
				this.render();

				return this.$element;
			} else {
				return this.$element.val();
			}
		},

		selectAll: function() {
			this.findLis();
			this.$lis.not('.divider').not('.disabled').not('.selected').filter(':visible').find('a').click();
		},

		deselectAll: function() {
			this.findLis();
			this.$lis.not('.divider').not('.disabled').filter('.selected').filter(':visible').find('a').click();
		},

		keydown: function(e) {
			var $this = $(this),
				$parent = ($this.is('input')) ? $this.parent().parent() : $this.parent(),
				$items,
				that = $parent.data('this'),
				index,
				next,
				first,
				last,
				prev,
				nextPrev,
				prevIndex,
				isActive,
				keyCodeMap = {
					32: ' ',
					48: '0',
					49: '1',
					50: '2',
					51: '3',
					52: '4',
					53: '5',
					54: '6',
					55: '7',
					56: '8',
					57: '9',
					59: ';',
					65: 'a',
					66: 'b',
					67: 'c',
					68: 'd',
					69: 'e',
					70: 'f',
					71: 'g',
					72: 'h',
					73: 'i',
					74: 'j',
					75: 'k',
					76: 'l',
					77: 'm',
					78: 'n',
					79: 'o',
					80: 'p',
					81: 'q',
					82: 'r',
					83: 's',
					84: 't',
					85: 'u',
					86: 'v',
					87: 'w',
					88: 'x',
					89: 'y',
					90: 'z',
					96: '0',
					97: '1',
					98: '2',
					99: '3',
					100: '4',
					101: '5',
					102: '6',
					103: '7',
					104: '8',
					105: '9'
				};

			if (that.options.liveSearch) $parent = $this.parent().parent();

			if (that.options.container) $parent = that.$menu;

			$items = $('[role=menu] li a', $parent);

			isActive = that.$menu.parent().hasClass('open');

			if (!isActive && /([0-9]|[A-z])/.test(String.fromCharCode(e.keyCode))) {
				if (!that.options.container) {
					that.setSize();
					that.$menu.parent().addClass('open');
					isActive = true;
				} else {
					that.$newElement.trigger('click');
				}
				that.$searchbox.focus();
			}

			if (that.options.liveSearch) {
				if (/(^9$|27)/.test(e.keyCode.toString(10)) && isActive && that.$menu.find('.active').length === 0) {
					e.preventDefault();
					that.$menu.parent().removeClass('open');
					that.$button.focus();
				}
				$items = $('[role=menu] li:not(.divider):not(.dropdown-header):visible', $parent);
				if (!$this.val() && !/(38|40)/.test(e.keyCode.toString(10))) {
					if ($items.filter('.active').length === 0) {
						if (that.options.searchAccentInsensitive) {
							$items = that.$newElement.find('li').filter(':aicontains(' + normalizeToBase(keyCodeMap[e.keyCode]) + ')');
						} else {
							$items = that.$newElement.find('li').filter(':icontains(' + keyCodeMap[e.keyCode] + ')');
						}
					}
				}
			}

			if (!$items.length) return;

			if (/(38|40)/.test(e.keyCode.toString(10))) {
				index = $items.index($items.filter(':focus'));
				first = $items.parent(':not(.disabled):visible').first().index();
				last = $items.parent(':not(.disabled):visible').last().index();
				next = $items.eq(index).parent().nextAll(':not(.disabled):visible').eq(0).index();
				prev = $items.eq(index).parent().prevAll(':not(.disabled):visible').eq(0).index();
				nextPrev = $items.eq(next).parent().prevAll(':not(.disabled):visible').eq(0).index();

				if (that.options.liveSearch) {
					$items.each(function(i) {
						if ($(this).is(':not(.disabled)')) {
							$(this).data('index', i);
						}
					});
					index = $items.index($items.filter('.active'));
					first = $items.filter(':not(.disabled):visible').first().data('index');
					last = $items.filter(':not(.disabled):visible').last().data('index');
					next = $items.eq(index).nextAll(':not(.disabled):visible').eq(0).data('index');
					prev = $items.eq(index).prevAll(':not(.disabled):visible').eq(0).data('index');
					nextPrev = $items.eq(next).prevAll(':not(.disabled):visible').eq(0).data('index');
				}

				prevIndex = $this.data('prevIndex');

				if (e.keyCode == 38) {
					if (that.options.liveSearch) index -= 1;
					if (index != nextPrev && index > prev) index = prev;
					if (index < first) index = first;
					if (index == prevIndex) index = last;
				}

				if (e.keyCode == 40) {
					if (that.options.liveSearch) index += 1;
					if (index == -1) index = 0;
					if (index != nextPrev && index < next) index = next;
					if (index > last) index = last;
					if (index == prevIndex) index = first;
				}

				$this.data('prevIndex', index);

				if (!that.options.liveSearch) {
					$items.eq(index).focus();
				} else {
					e.preventDefault();
					if (!$this.is('.dropdown-toggle')) {
						$items.removeClass('active');
						$items.eq(index).addClass('active').find('a').focus();
						$this.focus();
					}
				}

			} else if (!$this.is('input')) {
				var keyIndex = [],
					count,
					prevKey;

				$items.each(function() {
					if ($(this).parent().is(':not(.disabled)')) {
						if ($.trim($(this).text().toLowerCase()).substring(0, 1) == keyCodeMap[e.keyCode]) {
							keyIndex.push($(this).parent().index());
						}
					}
				});

				count = $(document).data('keycount');
				count++;
				$(document).data('keycount', count);

				prevKey = $.trim($(':focus').text().toLowerCase()).substring(0, 1);

				if (prevKey != keyCodeMap[e.keyCode]) {
					count = 1;
					$(document).data('keycount', count);
				} else if (count >= keyIndex.length) {
					$(document).data('keycount', 0);
					if (count > keyIndex.length) count = 1;
				}

				$items.eq(keyIndex[count - 1]).focus();
			}

			// Select focused option if "Enter", "Spacebar" or "Tab" (when selectOnTab is true) are pressed inside the menu.
			if ((/(13|32)/.test(e.keyCode.toString(10)) || (/(^9$)/.test(e.keyCode.toString(10)) && that.options.selectOnTab)) && isActive) {
				if (!/(32)/.test(e.keyCode.toString(10))) e.preventDefault();
				if (!that.options.liveSearch) {
					$(':focus').click();
				} else if (!/(32)/.test(e.keyCode.toString(10))) {
					that.$menu.find('.active a').click();
					$this.focus();
				}
				$(document).data('keycount', 0);
			}

			if ((/(^9$|27)/.test(e.keyCode.toString(10)) && isActive && (that.multiple || that.options.liveSearch)) || (/(27)/.test(e.keyCode.toString(10)) && !isActive)) {
				that.$menu.parent().removeClass('open');
				that.$button.focus();
			}
		},

		mobile: function() {
			this.$element.addClass('mobile-device').appendTo(this.$newElement);
			if (this.options.container) this.$menu.hide();
		},

		refresh: function() {
			this.$lis = null;
			this.reloadLi();
			this.render();
			this.setWidth();
			this.setStyle();
			this.checkDisabled();
			this.liHeight();
		},

		update: function() {
			this.reloadLi();
			this.setWidth();
			this.setStyle();
			this.checkDisabled();
			this.liHeight();
		},

		hide: function() {
			this.$newElement.hide();
		},

		show: function() {
			this.$newElement.show();
		},

		remove: function() {
			this.$newElement.remove();
			this.$element.remove();
		}
	};

	// SELECTPICKER PLUGIN DEFINITION
	// ==============================
	function Plugin(option, event) {
		// get the args of the outer function..
		var args = arguments;
		// The arguments of the function are explicitly re-defined from the argument list, because the shift causes them
		// to get lost
		//noinspection JSDuplicatedDeclaration
		var _option = option,
			option = args[0],
			event = args[1];
		[].shift.apply(args);

		// This fixes a bug in the js implementation on android 2.3 #715
		if (typeof option == 'undefined') {
			option = _option;
		}

		var value;
		var chain = this.each(function() {
			var $this = $(this);
			if ($this.is('select')) {
				var data = $this.data('selectpicker'),
					options = typeof option == 'object' && option;

				if (!data) {
					var config = $.extend({}, Selectpicker.DEFAULTS, $.fn.selectpicker.defaults || {}, $this.data(), options);
					$this.data('selectpicker', (data = new Selectpicker(this, config, event)));
				} else if (options) {
					for (var i in options) {
						if (options.hasOwnProperty(i)) {
							data.options[i] = options[i];
						}
					}
				}

				if (typeof option == 'string') {
					if (data[option] instanceof Function) {
						value = data[option].apply(data, args);
					} else {
						value = data.options[option];
					}
				}
			}
		});

		if (typeof value !== 'undefined') {
			//noinspection JSUnusedAssignment
			return value;
		} else {
			return chain;
		}
	}

	var old = $.fn.selectpicker;
	$.fn.selectpicker = Plugin;
	$.fn.selectpicker.Constructor = Selectpicker;

	// SELECTPICKER NO CONFLICT
	// ========================
	$.fn.selectpicker.noConflict = function() {
		$.fn.selectpicker = old;
		return this;
	};

	$(document)
		.data('keycount', 0)
		.on('keydown', '.bootstrap-select [data-toggle=dropdown], .bootstrap-select [role=menu], .bs-searchbox input', Selectpicker.prototype.keydown)
		.on('focusin.modal', '.bootstrap-select [data-toggle=dropdown], .bootstrap-select [role=menu], .bs-searchbox input', function(e) {
			e.stopPropagation();
		});

	// SELECTPICKER DATA-API
	// =====================
	$(window).on('load.bs.select.data-api', function() {
		$('.selectpicker').each(function() {
			var $selectpicker = $(this);
			Plugin.call($selectpicker, $selectpicker.data());
		})
	});

})(jQuery);

function detectIE() {
    var ua = window.navigator.userAgent;

    var msie = ua.indexOf('MSIE ');
    if (msie > 0) {
        // IE 10 or older => return version number
        return parseInt(ua.substring(msie + 5, ua.indexOf('.', msie)), 10);
    }

    var trident = ua.indexOf('Trident/');
    if (trident > 0) {
        // IE 11 => return version number
        var rv = ua.indexOf('rv:');
        return parseInt(ua.substring(rv + 3, ua.indexOf('.', rv)), 10);
    }

    var edge = ua.indexOf('Edge/');
    if (edge > 0) {
       // IE 12 => return version number
       return parseInt(ua.substring(edge + 5, ua.indexOf('.', edge)), 10);
    }

    // other browser
    return false;
}

(function($){
    $(function(){

        //var $copy = $('div.SPA_printcontact').clone();
        var $body = $('body');

        //$copy.insertAfter('#printdate');

        if($.browser.msie || detectIE()) {
            $body.addClass('msie ie'+detectIE());
            //var userAgent = userAgent.substring(0,userAgent.indexOf('.'));
            //var version = userAgent;
            //$body.addClass('msie ie' + version);
            
            //alert('IE');
        } else if($.browser.webkit) {
            $body.addClass('webkit');
        } else if($.browser.mozilla) {
            $body.addClass('mozilla');
        }

    });
}(jQuery));


/*!
* Detectizr v@VERSION
* http://barisaydinoglu.github.com/Detectizr/
*
* Written by Baris Aydinoglu (http://baris.aydinoglu.info) - Copyright 2012
* Released under the MIT license
*
* Date: @DATE
*/

//$(function() {
//    
//	$('._forward_pricing').on("click",function(){
//            _ga_generated( $(this) );   
//            // redirect store
//            document.location = domain + '/store.html';	
//	});
//        
//        $('.ga-click').on('click', function(event) {
//            //event.preventDefault();
//            _ga_generated( $(this) );
//            //return true;
//        });
//
//});
//
//function _ga_generated( $(this) ) {
//    var _ga_label_button = false,
//        _ga_type_button = false,
//        _ga_event = false;
//
//    _ga_event = ($(this).attr('ga-event')) ? $(this).attr('ga-event') : false;
//    _ga_type_button = ($(this).attr('ga-type-button')) ? $(this).attr('ga-type-button') : 'buy button';
//    _ga_label_button = ($(this).attr('ga-label-button')) ? $.trim( $(this).attr('ga-label-button').toLowerCase() ).replace(/\s/g,'-') : false;
//
//    if(_ga_event && _ga_type_button && _ga_label_button) {
//        ga('send', 'event', _ga_type_button, _ga_event, _ga_label_button);
//    } 
//}

function google_analitycs_click( category, action, label ) {
    if(action && category && label) {
        ga('send', 'event', category, action, label);
    }
}

function TrackEventGA(Category, Action, Label, Value) {
    "use strict";
    if (typeof (_gaq) !== "undefined") {
        _gaq.push(['_trackEvent', Category, Action, Label, Value]);
    } else if (typeof (ga) !== "undefined") {
        ga('send', 'event', Category, Action, Label, Value);
    }
}

$(function() {
    $('.ga-action-click').on('click', function() {
           var _ga_action = ($(this).attr('ga-action')) ? $(this).attr('ga-action') : false,
               _ga_category = ($(this).attr('ga-category')) ? $(this).attr('ga-category') : false,
               _ga_label = ($(this).attr('ga-label')) ? $.trim( $(this).attr('ga-label').toLowerCase() ).replace(/\s/g,'-') : false;
        
        if(_ga_action && _ga_category && _ga_label) {
            // ga('send', 'event', _ga_category, _ga_action, _ga_label);
            TrackEventGA(_ga_category, _ga_action, _ga_label);
        }
        
    });
    
    $('.ga-action-submit').on('click', function() { // closest('form'). submit
        var _b = $(this), _form = $(this).closest('form');  // .find('.ga-action-submit')
        var _ga_action = (_b.attr('ga-action')) ? _b.attr('ga-action') : false,
           _ga_category = (_b.attr('ga-category')) ? _b.attr('ga-category') : false,
           _ga_page = (_b.attr('ga-page')) ? _b.attr('ga-page') : '',
           _ga_label = (_b.attr('ga-label')) ? $.trim( _b.attr('ga-label').toLowerCase() ).replace(/\s/g,'-') : false;
        
        if(_ga_action && _ga_category && _ga_label) {
            ga('send', 'page', _ga_page);
            ga('send', 'pageview', _ga_page);
            // ga('set', 'referrer', 'http://pumpic.com');
            ga('send', 'event', _ga_category, _ga_action, _ga_label, {
                'page': _ga_page,
                '_trackPageview': _ga_page, 
                'hitCallback': function() {
                    _form.submit();
                }
            });

            return !(ga.hasOwnProperty('loaded') && ga.loaded === true);
        } else {
            return true;
        }
    });
    
});


currencyHandler = {
    afterLoad: function(rates){
        $.each($('input.data-price'), function(i, priceTag){
            var usdPrice = $(priceTag).data('price-usd');
            
            if (typeof usdPrice !== 'undefined') {
                $.each(['gbp', 'eur', 'cad', 'aud'], function(i, currency){

                    if(rates[currency.toUpperCase()]){
                        var priceInCurrency = Number((1 / rates[currency.toUpperCase()]) * usdPrice).toFixed(2);
                        $(priceTag).attr('data-price-' + currency, priceInCurrency);
                        
                    }

                });
            }
            
            var doublePrice = $(priceTag).data('data-offer-price-usd');
            
            if (typeof doublePrice !== 'undefined') {
                $.each(['gbp', 'eur', 'cad', 'aud'], function(i, currency){

                    if(rates[currency.toUpperCase()]){
                        var priceInCurrency = Number((1 / rates[currency.toUpperCase()]) * doublePrice).toFixed(2);
                        $(priceTag).attr('data-offer-price-' + currency, priceInCurrency);
                        
                    }

                });
            }
        });
        $('input.data-price:checked').change();
    },
    onChange: function(currentCurrency){
        $('input.data-price')
            .attr('data-cur', currentCurrency)
            .filter(':checked')
            .change();
    }
};

(function( $ ){
      // var _dataObj = ($("body").hasClass("ie8")) ? document.body : window;
      var $this = {}, $rates = {}, $_html = "";
      
      var $_settings = {
          'debug': false,
          'api_key': '', // app_id=
          // 'host': '/currency.html',
          'currBase': 'USD',
          'currCode': { 'usd' : '$', 
                        'eur' :'€', 
                        'gbp' : '£',
                        'cad' : '$',
                        'aud' : '$'},
          'filter': {
              'iso': ['USD','EUR','GBP','CAD','AUD']
           },
          'rates': {}, // list currance rates
          'convert': {
              'from': false,
              'to': false,
          },
          'ajax': {
              'dataType': 'json',
              'type': 'POST',
              'crossDomain': true,
              'data': {
              }
          }, 
          'onOpen': false,
      }  
    
      // detected method
      var methods = {
        init : function( options ) { 
            methods._die('Load init! *Curr');
            
            $this = $(this);
            // set filters
            methods.setSettings( options );
            
            // set rates
            methods.setRates();
                
            methods._die('Rates ...');    
            methods._die( $_settings.rates );   
            
            // init money
            var rates = methods._initMoney();
            
            methods.triggerCall($_settings.onOpen, rates);
            return $(this);
        }, // set init
        
        setSettings: function(options) {
            if(typeof options !== "undefined") {
                $_settings = $.extend( $_settings, options || {});
            }
        },
        
        setRates: function( $_obj ) {
            if(typeof $_obj !== "undefined" ) {
                $_settings.rates = $_obj;
            } else if($rates = methods._json()) {
                $_settings.rates = $rates; 
            }
        },
        
        triggerCall: function(func, arg) {
                $.isFunction(func) && func.call(this, arg);
        },
        
        _die: function(msg) {
            if($_settings.debug)
                console.log( msg );
        },
        
        /* ==== init cookie ====== */
        _clearCookie: function( key ) {
            if($.cookie( key )) {
                $.removeCookie( key, { path: '/' });
            }
        },

        setCookie: function(key, value) {
            $.cookie(key, value, { expires: 7, path: '/' });
        },

        getCookie: function( key ) {
            if($.cookie(key)) {
                return $.cookie(key); 
            } else
                return false;
        },
        
        /* ==== init data cahce ====== */
        _clearCach: function(key) {
//            if( $("body").hasClass("ie8") ) { 
//                if(key) {
//                    jQuery.data( document.body, key, false);
//                } else {
//                    jQuery.data( document.body, '_result', false);
//                }
//            } else {
                if(key) {
                    jQuery.data( window, key, false);
                } else {
                    jQuery.data( window, '_result', false);
                }    
//            }    
        },
        setCach: function(key, params) {
            key = (!key) ? "_result" : key;
            
            if(params) {
//                if( $("body").hasClass("ie8") ) { 
//                    return jQuery.data( document.body, key, params );
//                } else {
                    return jQuery.data( window, key, params);
//                }
            } else {
//                if( $("body").hasClass("ie8") ) { 
//                    return jQuery.data( document.body, key);
//                } else {
                    return jQuery.data( window, key);
//                }    
            }
            
        }, // set cahce
        
        getCach: function(key) {
//            if( $("body").hasClass("ie8") ) {
//                if(jQuery.data( document.body, key))
//                    return jQuery.data( document.body, key);
//                else
//                    return false;
//            } else {
                if(jQuery.data( window, key))
                    return jQuery.data( window, key);
                else
                    return false;
//            }
        },
        
        /* ajax */
        _json: function(_data) {
            methods._die('Load json curr..');
            var _url = '', result = {};
            
            
            
//            _data = (_data) ? _data : {
//                '_base': $_settings.currBase, // set Base currance
//                '_filter': $_settings.filter // set filter in iso
//            }; 
//            
//            if( $("body").hasClass("ie8") || $("body").hasClass("ie9") ) { 
//                methods._die('Load ie8 or ie9 ...');
//                // fix for ie8
//                var responce = $.ajax({
//                   type: $_settings.ajax.type,
//                   url: $_settings.host,
//                   processData: true,
//                   async: false,
//                   cache: false,
//                   data: $.extend(_data, $_settings.ajax.data),
//                   dataType: "json",
//                   success: function () {
//                   }
//                }).responseText;
//                responce = eval('['+responce+']');
//                methods.setCach('_ajax', responce[0]); // .responseJSON
//                
//            } else {
//                $.ajax({ 
//                    type: $_settings.ajax.type,
//                    async: false,
//                    cache: false,
//                    url: $_settings.host,
//                    data: $.extend(_data, $_settings.ajax.data),
//                    dataType: $_settings.ajax.dataType,
//                    crossDomain: $_settings.ajax.crossDomain
//                }).done(function(responce) {
//                    methods._die( 'Responce..' );
//                    methods._die( responce );
//                    if(responce) {
//
//                         methods._die( responce );
//                        methods.setCach('_ajax', responce); // .responseJSON 
//                    }
//                });
//            }

            if(isset($rand) && !methods.getCach('_ajax')) methods.setCach('_ajax', $rand);

            methods._die( 'getCache...' );
            methods._die( methods.getCach('_ajax') );
            return result = methods.getCach('_ajax');
            
        },
        
        // money math
        _initMoney: function( data ) {
            var _rates = {};
            if($_settings.rates) {
                $.each($_settings.rates, function(key, val) {
                    if(val.iso)
                        _rates[ val.iso.toUpperCase() ] = parseFloat( val.rates );
                });
            }
            
            methods._die(  _rates   );
            
            // init money
            fx.rates = (_rates) ? _rates : data.rates;
            fx.base = ($_settings.currBase) ? $_settings.currBase : data.base;
            return _rates;
        },
        
        _convert: function( pricing, from, to ) {
            if(!pricing) return null;
            
            var _settings = {
                from: (from) ? from.toUpperCase() : false,
                to: (to) ? to.toUpperCase() : false,
            };
            
            return fx.convert(pricing, _settings);
        },
        
        bindEvent: function() {
            // click 
            if($this.find('.store-flags, .store-link-currancy-flag').length)
                $this.find('.store-flags, .store-link-currancy-flag').on('click', function(event) {
                   event.preventDefault();
                   var curr_convert = $(this).attr('attr-rates-iso');
                   
                   
                   if(methods.getCach('currISO') && curr_convert) {
                       if(methods.getCach('currISO') != curr_convert) {
                           methods.setCach('currISO', curr_convert);
                       } 
                   } else {
                        methods.setCach('currISO', curr_convert);
                    }
                   
                   // status
                   $this.find('.store-flags, .store-link-currancy-flag').each(function() {
                       if($(this).hasClass('active')) {
                         $(this).removeClass('active');
                       } 
                   }); 
                   
                   $(this).addClass('active'); 
                    
                   // event 
                    methods.afterEvent();
                    // alert( methods._convert(100, $_settings.currBase, curr_convert || $_settings.currBase) ); // 'USD', 'EUR' 
                   return false;
                });
        },
        
        unbindEvent: function() {
            $this.find('.store-flags, .store-link-currancy-flag').off('click');
        },
        
        // show create html list rates
        show: function() {
            var status = [];
             methods._die( $_settings.rates );
             
            if($_settings.rates) {
                $_html += '<span>Currency:</span>';
                //$_html += '<ul class="clearfix">'; 
                $.each($_settings.rates, function(key, val) {
                    status[ key ] = (val.iso.toUpperCase() == $_settings.currBase) ? 'active' : ''; 
                    //$_html += '<li><span class="store-flags flag-'+val.iso+' '+status[ key ]+'" attr-rates-iso="'+val.iso+'" attr-rates-id="'+val.id+'"></span></li>'; // '+val.iso.toUpperCase()+'
                    $_html += '<a class="store-link-currancy-flag '+status[ key ]+'" attr-rates-iso="'+val.iso+'" attr-rates-id="'+val.id+'" href="#"><i class="ico-flag-'+val.iso+'"></i><span>'+val.iso.toUpperCase()+'</span></a>';
                });
                //$_html += '</ul>';
                
                $this.html( $_html );
                
                methods.beforeEvent(); // setup default
                methods.bindEvent();
            }
            
        },
        
        // beforeEvent
        beforeEvent: function() {
            $('.box-currence').each(function() {
                var _symbol = $(this).find('div.symbol'),
                    _iso = _symbol.attr('attr-iso');
               if(!_iso.length) _symbol.attr('attr-iso', $_settings.currBase);
               if(!_symbol.length) _symbol.text( $_settings.currCode[ $_settings.currBase.toLowerCase() ] );
            });
        },
        
        // afterEvent
        afterEvent: function() {
          currencyHandler.onChange(methods.getCach('currISO'));
          
          $.each($('.box-currence'), function(i, boxCurr) {
    
              methods._die(  $(boxCurr)   );
              
              var _symbol = $( boxCurr ).find('div.symbol'), 
                  _price = $( boxCurr ).find('div.curr'),
                  symbol = (_symbol) ? _symbol.text() : false, 
                  price = (_price) ? _price.text() : false,
                  iso = (_price) ? _symbol.attr('attr-iso') : false;
                  
                  methods._die(  'afterEvent...'   );
                  methods._die(  symbol   );
                  methods._die(  price   );
                  methods._die(  iso   );
                 
              if(price) {
                  _price.html( methods._convert( parseFloat(price), 
                                                 methods.getCach('currISO') || $_settings.currBase,   
                                                iso
                                            ).toFixed(2)  ); // ).toFixed(2)
                  _symbol.attr('attr-iso', methods.getCach('currISO'));   
                  _symbol.text( $_settings.currCode[ methods.getCach('currISO').toLowerCase() ] )
              }
              
              
          });  
          
        },
        
        run : function( params ) {
            methods._die( params );
            methods._die( 'Rates init' );
            methods._die( $_settings.rates );
        },
      };

      // constructor
      $.fn.currancy = function( method, type ) {
         
        // логика вызова метода
        if ( methods[method] ) {
            return methods[ method ].apply( this, Array.prototype.slice.call( arguments, 1 ));
        } else if ( typeof method === 'object' || ! method ) {
          methods.init.apply( this, arguments ); 
          if(typeof type !== "undefined" && methods[type]) {
              return methods[type].apply( this, Array.prototype.slice.call( arguments, 1 ));
          } 
//          else {
//              return methods.init.apply( this, arguments );
//          }
        } else {
          $.error( 'Метод с именем ' +  method + ' не существует для jQuery.tooltip' );
        }
        
        
      };

})( jQuery ); 

$(document).ready(function(){ 
    
   if($('.list-currencies').length) {
      $('.list-currencies').currancy({
          onOpen: function(rates) {
              currencyHandler.afterLoad(rates);
          }
      },'show');
   }
   
});
/*
 * 	Easy Tooltip 1.0 - jQuery plugin
 *	written by Alen Grakalic	
 *	http://cssglobe.com/post/4380/easy-tooltip--jquery-plugin
 *
 *	Copyright (c) 2009 Alen Grakalic (http://cssglobe.com)
 *	Dual licensed under the MIT (MIT-LICENSE.txt)
 *	and GPL (GPL-LICENSE.txt) licenses.
 *
 *	Built for jQuery library
 *	http://jquery.com
 *
 */
 
(function($) {

	$.fn.easyTooltip = function(options){
	  
		// default configuration properties
		var defaults = {	
			xOffset: 10,		
			yOffset: 25,
			tooltipId: "easyTooltip",
			clickRemove: false,
			content: "",
			useElement: ""
		}; 
			
		var options = $.extend(defaults, options);  
		var content;
				
		this.each(function() {  				
			var title = $(this).attr("title");				
			$(this).hover(function(e){											 							   
				content = (options.content != "") ? options.content : title;
				content = (options.useElement != "") ? $("#" + options.useElement).html() : content;
				$(this).attr("title","");									  				
				if (content != "" && content != undefined){			
					$("body").append("<div id='"+ options.tooltipId +"'>"+ content +"</div>");		
					$("#" + options.tooltipId)
						.css("position","absolute")
						.css("top",(e.pageY - options.yOffset) + "px")
						.css("left",(e.pageX + options.xOffset) + "px")						
						.css("display","none")
						.fadeIn("fast")
				}
			},
			function(){	
				$("#" + options.tooltipId).remove();
				$(this).attr("title",title);
			});	
			$(this).mousemove(function(e){
				$("#" + options.tooltipId)
					.css("top",(e.pageY - options.yOffset) + "px")
					.css("left",(e.pageX + options.xOffset) + "px")					
			});	
			if(options.clickRemove){
				$(this).mousedown(function(e){
					$("#" + options.tooltipId).remove();
					$(this).attr("title",title);
				});				
			}
		});
	  
	};

})(jQuery);

var d = document;
var safari = (navigator.userAgent.toLowerCase().indexOf('safari') != -1) ? true : false;
var gebtn = function(parEl,child) { return parEl.getElementsByTagName(child); };
onload = function() {
	
	var body = gebtn(d,'body')[0];
	body.className = body.className && body.className != '' ? body.className + ' has-js' : 'has-js';
	
	if (!d.getElementById || !d.createTextNode) return;
	var ls = gebtn(d,'label');
	for (var i = 0; i < ls.length; i++) {
		var l = ls[i];
		if (l.className.indexOf('label_') == -1) continue;
		var inp = gebtn(l,'input')[0];
		if (l.className == 'label_check') {
			l.className = (safari && inp.checked == true || inp.checked) ? 'label_check c_on' : 'label_check c_off';
			l.onclick = check_it;
		};
		if (l.className == 'label_radio') {
			l.className = (safari && inp.checked == true || inp.checked) ? 'label_radio r_on' : 'label_radio r_off';
			l.onclick = turn_radio;
		};
	};
};
var check_it = function() {
	var inp = gebtn(this,'input')[0];
	if (this.className == 'label_check c_off' || (!safari && inp.checked)) {
		this.className = 'label_check c_on';
		if (safari) inp.click();
	} else {
		this.className = 'label_check c_off';
		if (safari) inp.click();
	};
};
var turn_radio = function() {
	var inp = gebtn(this,'input')[0];
	if (this.className == 'label_radio r_off' || inp.checked) {
		var ls = gebtn(this.parentNode,'label');
		for (var i = 0; i < ls.length; i++) {
			var l = ls[i];
			if (l.className.indexOf('label_radio') == -1)  continue;
			l.className = 'label_radio r_off';
		};
		this.className = 'label_radio r_on';
		if (safari) inp.click();
	} else {
		this.className = 'label_radio r_off';
		if (safari) inp.click();
	};
};
$(document).ready(function(){ 

    // create cookie
    if(typeof $.cookie('fly_features') == "undefined") {
        $.cookie('fly_features', 0, {  
            expires: 1 // установить на сутки  
        });
    }
    
    
    $(window).scroll(function() {
            if ($(this).scrollTop() > 100 && 
                    typeof $.cookie('fly_features') !== "undefined" &&
                    !parseInt( $.cookie('fly_features') ) ) {
                    $('#fly_features').fadeIn();
            } else {
                    $('#fly_features').fadeOut();
            }
    });
    
//    if(typeof $.cookie('fly_features') !== "undefined" 
//                && !parseInt( $.cookie('fly_features') )) {
//            $('#fly_features').css({'display': 'inline-block'});
//    }
    
    if($('.fly_close').length) {
        $('.fly_close').on('click', function() {
            $(this).parent().hide();
            if(typeof $.cookie('fly_features') !== "undefined" 
                && !parseInt( $.cookie('fly_features') )) {
                $.cookie('fly_features', 1);
            }
            
            return false;
        });
    }
});


// fix ie8 - 10
var alertFallback = false;
if (typeof console === "undefined" || typeof console.log === "undefined") {
    console = {};
    if (alertFallback) {
        console.log = function (msg) {
            alert(msg);
        };
    } else {
        console.log = function () {
        };
    }
}

(function ($) {
	
	var $_result = {
        '_plans': false,
        '_mobile': false
    };
    var $this = {};

    var _settings = {
        'plan': false,
        'mobile': false
    }

    // detected method
    var methods = {
        init: function (options) {

            // set filters
            if (typeof options.filters !== "undefined") {
                _settings.plans = (options.filters.plans) ? options.filters.plans : null;
                _settings.mobile = (options.filters.mobile) ? options.filters.mobile : null;
            }

            return $(this);
        }, // set init

        _clearCach: function (key) {
            if (key) {
                jQuery.data(window, key, false);
            } else {
                jQuery.data(window, '_result', false);
                jQuery.data(window, '_plans', false);
                jQuery.data(window, '_mobile', false);
            }

        },
        _cach: function (params, key) {
            key = (!key) ? "_result" : key;
            if (params) {
                return jQuery.data(window, key, params);
            } else {
                return jQuery.data(window, key);
            }
        }, // set cahce

        _plans: function ( ) {
            if (_settings.plans) {
                var _res = [];
                $.each($this, function (key, item_obj) {
                    var $_item = $(item_obj);
                    var $use_plans = $_item.attr('attr-use-plan').split('|');

                    if ($.inArray(_settings.plans, $use_plans) != -1) {
                        _res[$_item.index()] = $_item.index();
                    }
                });

                methods._cach(_res, "_plans");
            } else {
                methods._clearCach('_plans');
                console.log('Not enter filters Plans (*settings)!');
            }


        }, // set plans filters

        _mobile: function () {
            if (_settings.mobile) {
                var _res = [];
                if (!$_result._plans) {
                    $.each(_settings.mobile, function (_type, _status) {
                        if (_status == true) {
                            $.each($this, function (key, item_obj) {
                                var $_item = $(item_obj);
                                if ($_item.find('.box-filter-mobile i.icon-' + _type + '').is('.supported')) {
                                    _res[ $_item.index() ] = $_item.index();
                                }

                            });
                        }
                    });
                } else {
                    $.each($this, function (key, item_obj) {
                        var $_item = $(item_obj);
                        if ($.inArray($_item.index(), $_result._plans) != -1) {
                            $.each(_settings.mobile, function (_type, _status) {
                                if (_status == true) {
                                    if ($_item.find('.box-filter-mobile i.icon-' + _type + '').is('.supported'))
                                        _res[ $_item.index() ] = $_item.index();
                                }
                            });
                        }
                    });
                }

                methods._cach(_res, "_mobile");
            } else {
                methods._clearCach('_mobile');
                console.log('Not enter filters mobile (*settings)!');
            }

        }, // set mobile filters
        _run: function (obj) {
            if (!obj.length) {
                console.log('Not detected Objects!');
                return;
            }

            $this = obj;

            methods._plans(); // detected plans
            $_result._plans = methods._cach(false, "_plans"); // get params plans in cache

            if (typeof $_result._plans === "undefined")
                console.log('Not enter plans filters!');
            methods._mobile(); // detected filters mobile
            $_result._mobile = methods._cach(false, "_mobile"); // get params mobile in cache
            if (typeof $_result._mobile === "undefined")
                console.log('Not enter mobile filter!');
            methods._visible($_result); // show/hide elements
        },
        _visible: function (arr_index) {
            if ($this.length > 0) {
                if (typeof arr_index._plans !== "undefined" && arr_index._plans.length > 0) {
                    $.each($this, function (key, item_obj) {
                        var $_item = $(item_obj);
                        if (arr_index._plans.length > 0) {
                            // set plans
                            if ($.inArray($_item.index(), arr_index._plans) != -1) {
                                if ($_item.hasClass('hide'))
                                    $_item.removeClass('hide');
                                $_item.addClass('show');
                            } else {
                                if ($_item.hasClass('show'))
                                    $_item.removeClass('show')
                                $_item.addClass('hide');
                            }
                        }

                    }); // show/hide elements plans

                    // filter mobile in plans
                    if (arr_index._mobile.length > 0 && typeof arr_index._mobile !== "undefined") {
                        $.each($this, function (key, item_obj) {
                            var $_item = $(item_obj);
                            if ($.inArray($_item.index(), arr_index._mobile) != -1) {
                                if ($_item.hasClass('hide'))
                                    $_item.removeClass('hide');
                                $_item.addClass('show');
                            } else {
                                if ($_item.hasClass('show'))
                                    $_item.removeClass('show')
                                $_item.addClass('hide');
                            }
                        });
                    } // show/hide mobile in plans


                } // filters plans

                else if (!arr_index._plans.length
                        && typeof arr_index._mobile !== "undefined"
                        && arr_index._mobile.length > 0) {

                    $.each($this, function (key, item_obj) {
                        var $_item = $(item_obj);
                        if ($.inArray($_item.index(), arr_index._mobile) != -1) {
                            if ($_item.hasClass('hide'))
                                $_item.removeClass('hide');
                            $_item.addClass('show');
                        } else {
                            if ($_item.hasClass('show'))
                                $_item.removeClass('show')
                            $_item.addClass('hide');
                        }
                    });
                } // all mobile filters
                else {

                    $.each($this, function (key, item_obj) {
                        var $_item = $(item_obj);
                        if ($_item.hasClass('hide'))
                            $_item.removeClass('hide');
                        $_item.addClass('show');
                    });
                }

            }
        },
        show: function () {
            return methods._run($(this));
        },
        update: function (content) {
            // !!!
        }
    };

    // constructor
    $.fn.tabPumpic = function (method) {

        // логика вызова метода
        if (methods[method]) {
            return methods[ method ].apply(this, Array.prototype.slice.call(arguments, 1));
        } else if (typeof method === 'object' || !method) {
            return methods.init.apply(this, arguments);
        } else {
            $.error('Метод с именем ' + method + ' не существует для jQuery.tooltip');
        }


    };

})(jQuery);

// globa variable
$data_hash = [];

var _htmlPopUp = {
    'boxStatusAuth': '<div id="box-status-auth" class="popUp"><div><label class="title gold">Hello!<i class="close small"></i></label></div>'
            + '<p class="info">You have just logged into Pumpic.com, enjoy your time with us or go straight to your <a class="a-default" href="https://cp.pumpic.com">account</a>.</p>'
            + '</div>',
    'boxStatusRegistration': '<div id="box-status-registration" class="popUp">'
            + '<div><label class="title gold">Hello!<i class="close small"></i></label></div>'
            + '<p class="info">You have just registered in Pumpic.com, enjoy your time with us or go straight to your <a class="a-default" href="https://cp.pumpic.com">account</a>.</p>'
            + '</div>',
    'boxStatusFreeTrialRegistration': '<div id="box-status-free-trial-registration" class="popUp">'
            + '<div><label class="title gold">Thank you for signing up!<i class="close small"></i></label></div>'
            + '<p class="info">The email with registration details was sent to ' + UserLogin + '.<br /> You can go straight to your <a class="a-default" href="https://cp.pumpic.com">Personal Account</a> now.</p>'
            + '</div>',
    'email_success': '<div id="box-email-success" class="popUp">'
            + '<div><label class="title gold"> Thank you! <i class="close small"></i></label></div>'
            + '<div class="info text-center"> Your discount code will be sent to you soon.'
            + '<form><div><a href="#" class="button-red btn-default block-popUp-close">Close</a></div></form>'
            + '</div></div>',
    'box_email': '<div id="box-email" class="popUp">'
            + '<div><label class="title gold"> <b>10%</b> off<i class="close small"></i></label></div>'
            + '<div class="info text-center">Want to get <a class="a-default" href="#">10% discount</a> right now?<br />Subscribe to our specail promo!'
            + '<form class="block-popup-form text-center">'
            + '<div><input id="email" class="required" type="email" name="email" value="" placeholder="email" />'
            + '<div id="email-error" class="error"></div></div><div><button class="button-red btn-default">Save 10% today</button></div>'
            + '</form></div></div>',
};

// anchor
jQuery(function () {
    jQuery(window).hashchange(function () {
        if (document.location.hash == '')
            return;
        var hash = location.hash.split('#');
        if (hash.length > 1) {
            $data_hash = hash[1];
            hashchange_onLoadInit();

            // if($('.box-anchor #'+hash[1]).length)
            //if(typeof $('.box-anchor #'+hash[1]) == "object")
            //    $('html, body').animate({scrollTop: $('.box-anchor #'+hash[1]).offset().top}, 800);
        }

    });
    jQuery(window).hashchange();
});

// init cookies
function cookie_init() {
//    if(!getCookie('popUp')) {
//        $.cookie('popUp', false, {
//                        expires: 7,
//                        path: '/'
//                    });
//    }

    // save cookie screen window
    if (!getCookie('_screen')) {
        $.cookie('_screen', $(window).width() + 'x' + $(window).height(), {expires: 7, path: '/', domain: '.pumpic.com'});
    }

}

function copy_to_clipboard_init() {
    var client = new ZeroClipboard($(".copy-to-clipboard"));

    client.on("copy", function (event) {
        var clipboard = event.clipboardData;
        clipboard.setData("text/plain", $('.copy-this').val());
    });

    client.on('aftercopy', function (event) {
        $('.copy-done').show().fadeOut(1500);
    });

}

function cookie_clear() {
    if ($.cookie('popUp')) {
        $.removeCookie('popUp', {path: '/'});
    }
}

function setCookie(name, value) {
    $.cookie(name, value, {expires: 7, path: '/'});
}

function getCookie(name) {
    if ($.cookie(name)) {
        return $.cookie(name);
    } else
        return false;
}

// init hashchange ( init bPopUp )
function hashchange_onLoadInit() {

}

function hashchange_AfterInit() {
    var _data = _parceHash($data_hash);
    var $_popUp = $('.box-popUp'),
            $auth = $_popUp.find('#box-status-auth'),
            $registration = $_popUp.find('#box-status-registration'),
            $trial_registration = $_popUp.find('#box-status-free-trial-registration');
    // init bPopUp
    if (isset(_data['popUp']) && _hasUser == 'true') {

        if (_data['popUp'] == "auth") { // && !getCookie('popUp')
            // google analitycs
            ga('send', 'event', 'form', 'submit', 'login-success');

            if (!$auth.length) {
                $auth = $_popUp
                        .append(_htmlPopUp.boxStatusAuth)
                        .find('#box-status-auth');
            }

            // login status ok
            if (isset($auth)) {
                var title = $auth.find('.title')
                        , content = $auth.find('.info');
                $auth.bPopup({
                    modalClose: true,
                    opacity: 0.6,
                    follow: [false, false],
                    positionStyle: 'fixed', //'fixed' or 'absolute'
                    onOpen: function () {
                        //content.html('TEST POPUP element!');
                    },
                    closeClass: 'close',
                    onClose: function () {
                        // setCookie('popUp', true);
                        //content.empty();
                    },
                });
            }
        }

        if (_data['popUp'] == "registration") { // && !getCookie('popUp')
            // google analitycs
            ga('send', 'event', 'form', 'submit', 'registration-success');

            if (!$registration.length) {
                $registration = $_popUp
                        .append(_htmlPopUp.boxStatusRegistration)
                        .find('#box-status-registration');
            }

            // login status ok
            if (isset($registration)) {
                var title = $registration.find('.title')
                        , content = $registration.find('.info');
                $registration.bPopup({
                    modalClose: true,
                    opacity: 0.6,
                    follow: [false, false],
                    positionStyle: 'fixed', //'fixed' or 'absolute'
                    onOpen: function () {
                        //content.html('TEST POPUP element!');
                    },
                    closeClass: 'close',
                    onClose: function () {
                        // setCookie('popUp', true);
                        //content.empty();
                    },
                });
            }
        }

        //free-trial-registration
        if (_data['popUp'] == "free-trial-registration") { // && !getCookie('popUp')
            if (!$trial_registration.length) {
                $trial_registration = $_popUp
                        .append(_htmlPopUp.boxStatusFreeTrialRegistration)
                        .find('#box-status-free-trial-registration');
            }
            // login status ok
            if (isset($trial_registration)) {
                var title = $trial_registration.find('.title')
                        , content = $trial_registration.find('.info');

                $trial_registration.bPopup({
                    modalClose: true,
                    opacity: 0.6,
                    follow: [false, false],
                    positionStyle: 'fixed',
                    onOpen: function () {

                        // google analitycs
                        ga('send', 'event', 'trial', 'popup', 'free-trial-registration-success');

                    },
                    closeClass: 'close',
                    onClose: function () {
                    },
                });
            }
        }

    }
}

function _parceHash(hash) {
    var _data = {};
    if (hash.length) {
        var pair = (hash).split('&');
        for (var i = 0; i < pair.length; i++) {
            var param = pair[i].split('=');
            _data[param[0]] = param[1];
        }
    }
    return _data;
}


function isset(element) {
    if (typeof element != 'undefined') {
        return element.length > 0;
    } else
        return false;
}

// toggleClicked
jQuery.fn.clickToggle = function (a, b) {
    var ab = [b, a];
    function cb() {
        ab[this._tog ^= 1].call(this);
        return false;
    }
    return this.on("click", cb);
};

/*
 (function($) {
 $.fn.clickToggle = function(func1, func2) {
 var funcs = [func1, func2];
 this.data('toggleclicked', 0);
 this.click(function(event) {
 event.preventDefault();
 var data = $(this).data();
 var tc = data.toggleclicked;
 $.proxy(funcs[tc], this)();
 data.toggleclicked = (tc + 1) % 2;
 return false;
 });
 return this;
 };
 }(jQuery));
 */

/*
 * parce url
 **/
function parseUrlQuery() {
    var data = {};
    if (location.search) {
        var pair = (location.search.substr(1)).split('&');
        for (var i = 0; i < pair.length; i++) {
            var param = pair[i].split('=');
            data[param[0]] = param[1];
        }
    }
    return data;
}


function clickActive(obj, _this) {
    if ($(obj).length > 0) {
        $.each($(obj), function (key, val) {
            if ($(val).hasClass('active'))
                $(val).removeClass('active');
        }); // clear all active
        _this.addClass('active');
    }
}

/*
 * parce string serilize
 **/
function parseQuery(str) {
    var data = {};
    if (typeof str == 'string') {
        var pair = (str).split('&');
        for (var i = 0; i < pair.length; i++) {
            var param = pair[i].split('=');
            data[param[0]] = param[1];
        }
    } else if (typeof str == 'object') {
        $.each(str, function (_k, _val) {
            if (_val.name)
                data[ _val.name ] = (_val.value) ? _val.value : null;
        });
    }
    return data;
}


/*
 * Ajax function.
 * return json result
 **/
function getAjaxForm(path, params, options) {

    if (!options)
        options = {};

    var settings = $.extend({
        'dataType': 'json',
        'async': false,
        'crossDomain': false,
        'type': 'POST',
        'cache': true
    }, options || {});


    if (!path) {
        return null;
    }
    var res = $.ajax({
        url: path,
        dataType: settings.dataType,
        async: settings.async,
        crossDomain: settings.crossDomain,
        type: settings.type,
        cache: settings.cache,
        success: function () {

        },
        complete: function () {
        },
        data: {
            params: params
        }
    }).responseText;

    console.log(res);

    res = eval('[' + res + ']');
    var obj = res[0];
    return obj;
}

/*
 * JSONP
 *
 */
function _getAJAX(path, params, options) {
    if (!options)
        options = {};

    var settings = $.extend({
        'dataType': 'jsonp',
        'jsonp': "callback",
        'async': false,
        'crossDomain': false,
        'type': 'POST',
        'cache': true
    }, options || {});

    console.log(settings);

    if (!path) {
        console.log('enter url AJAX!');
        return null;
    }

    return $.ajax({
        type: settings.type,
        async: settings.async,
        url: path,
        data: {
            params: params
        },
        dataType: settings.dataType,
        jsonp: settings.jsonp,
        crossDomain: settings.crossDomain,
        cache: settings.cache,
    });
}

/*
 *
 * @param {type} $_msg
 * @returns {undefined}
 */
function getJsonp(_data) {
    if (typeof _data != 'object') {
        die('Data not object!');
        return;
    }
    var baseUrl = "http://a.pumpic.dev/index.php";
    return $.ajax({
        type: "GET",
        async: false,
        url: baseUrl,
        data: _data,
        dataType: "jsonp",
        jsonp: "callback",
        crossDomain: true
    });

}


/*
 *
 * @param {type} $_msg
 * @returns {undefined}
 */
function reloadCaptcha(obj, error) {
    if (!obj.length)
        return false;
    var _form = obj.parents('form');
    var _src = '/captcha.html?' + Math.random();
    if ($(obj).attr('attr-width') && $(obj).attr('attr-height')) {
        _src = '/captcha.html?width=' + $(obj).attr('attr-width') + '&height=' + $(obj).attr('attr-height') + '&' + Math.random();
    }
    $('.box-captcha').find('#img-captcha').attr('src', _src);

    if (error)
        _form.find('input[name="captcha"]').focus();
}

/*
 * Display error massenge
 * @param {type} $_msg
 * @returns {undefined}
 */
function die($_msg) {
    console.log($_msg);
}

$(document).ready(function () {

    $rs_width = false;
    $(window).resize(function () {
        $rs_width = $(window).width()
    });

    if (!$rs_width) {
        $rs_width = $(window).width();
    }

    cookie_init();

    copy_to_clipboard_init();

    $.data(window, "filters", false); // init clear cache

    var filters = {
        'plans': false,
        'mobile': {
            'apple': false,
            'android': false,
            'blackberry': false
        }
    }; // init settings

    // activate tab
    if (window.location.hash.length) {
        var hash = window.location.hash,
                $button = $('a[href="' + hash + '"]');
        if ($button.length && $(hash).length) {
            $button.attr('data-toggled', 'on');
            $button.parent().addClass('active');
            $('.box_category>ul>li').hide();
            $(hash).show();
        }
    }

    // faceboock share

//    $.ajaxSetup({ cache: true });
//    $.getScript('//connect.facebook.net/en_US/sdk.js', function(){
//        FB.init({
//            // appId: '{your-app-id}',
//            version: 'v2.4' // or v2.0, v2.1, v2.2, v2.3
//        });
//        //$('#loginbutton,#feedbutton').removeAttr('disabled');
//        // FB.getLoginStatus(updateStatusCallback);
//    });

    function fb_share() {
        // facebook share dialog
        FB.ui({
            method: 'feed',
            name: "Your Page Title",
            link: "https://www.webniraj.com/link-to-page/",
            picture: "https://stackexchange.com/users/flair/557969.png",
            caption: "Some description here"
        }, function (response) {
            // do nothing
        });

    }



    $('.share_list a').click(function (e) {
        e.preventDefault();

        // facebook
//        if($(this).hasClass('share-facebook')) {
//           window.open("http://www.facebook.com/sharer/sharer.php?s=100&p[url]="+encodeURIComponent(window.location)+"&p[images][0]=http://pumpic.com/images/socials/social-icon.jpg&p[title]=Mobile Phone Security Measures&p[summary]=How to protect children from online predators, cyberbullies, 18+ content, and identity theft. Pumpic gathered essential information on mobile phone safety practice. Learn more to keep kids safe.",
//           'Share',
//           'height=300,width=500');
//           // fb_share();
//        } else {

//        console.log( $(this).data('location') + encodeURIComponent(window.location) );
        if (isset($(this).data('location')) && $(this).data('location').length) {

            var media = '';
            if (isset($(this).data('media')) && $(this).data('media').length)
                media = '&media=' + $(this).data('media');

            window.open($(this).data('location') + encodeURIComponent(window.location) + media, 'Share', 'height=300,width=500');
        }

        //}
        return false
    });

    $('.box-plans, .box-phone').on('click', function (event) {
        event.preventDefault();
        filters = (!$.data(window, "filters")) ? filters : $.data(window, "filters");
        var _rel = $(this).attr('rel');

        if ($(this).hasClass('active')) {
            $(this).removeClass('active');

            if ($(this).is('.box-plans')) {
                filters.plans = false;
            } else if ($(this).is('.box-phone')) {
                for (key in filters.mobile) {
                    filters.mobile[key] = false;
                }
            }

        } else {
            if ($(this).is('.box-plans')) {
                clickActive('.box-plans', $(this));
                filters.plans = _rel;
            } else if ($(this).is('.box-phone')) {
                clickActive('.box-phone', $(this));
                // clear all params (after click in mobile)
                for (key in filters.mobile) {
                    filters.mobile[key] = false;
                }

                if (typeof filters.mobile[_rel] !== "undefined")
                    filters.mobile[_rel] = true;
            }
        }

        console.log('save cashe filter...');
        $.data(window, "filters", filters); // save in result locale cache
        console.log('end...');

        console.log('init Plugins Tabs...');
        $('.box-body-filters').tabPumpic({
            'filters': filters
        }).tabPumpic('show');
        console.log('end...');

        return false;
    });

    if ($('#item-stickybar').length) {
        // $("#item-stickybar").trigger("sticky_kit:detach");
        // $("#item-stickybar").stick_in_parent();


        $('.list_category > li').each(function (key, val) {
            $('#item-stickybar.stickybar-' + key).stick_in_parent();
            console.log('key = ' + key);
        });


//        $("#item-stickybar").each(function(key, val) {
//            console.log(key);
//            $(this).stick_in_parent();
//        });

//        $("#item-stickybar").stick_in_parent({
//        parent: "#items-stickybar",
//        spacer: "#item-stickybar"
//      });
    }

    if ($('#block-stickybar').length) {
        $('#block-stickybar').stick_in_parent();
    }

    if ($('.list_category > li > a[data-toggled="on"]').length) {
        $.each($('.list_category > li > a[data-toggled="on"]'), function () {
            $('.box_category > ul > li').hide();
            if ($(this).parent().hasClass('active')) {
                var _hash = $(this).attr('href').split('#');
                console.log(_hash[1]);
                if (_hash.length) {
                    $('.box_category > ul > li').find('#' + _hash[1]).closest('li').show();
                }
            }
        });
    }


    //check if link is with hash
    var currUrl = window.location.hash;
    if(currUrl) {
      $('.list_category > li:first-child').removeClass('active')
    }
    function offsetAnchor() {
        if(location.hash.length !== 0) {
            window.scrollTo(window.scrollX, window.scrollY - 90);
        }
    }

    // This will capture hash changes while on the page
    $(window).on("hashchange",offsetAnchor);

    // This is here so that when you enter the page with a hash,
    // it can provide the offset in that case too. Having a timeout
    // seems necessary to allow the browser to jump to the anchor first.
    window.setTimeout(offsetAnchor, 1);
    // choose categoey
    //$('.list_category > li:first-child').addClass('active');
    $('.list_category > li > a').on('click', function (event) {
        //event.preventDefault();
        var _hash = $(this).attr('href').split('#'),
                _index = $(this).closest('li').index(),
                $holder = $(this).parent().parent();

        // console.log('index = '+_index);

        var store_history = $holder.attr('save-state');

        if (typeof store_history !== typeof undefined && store_history !== false) {
            window.location.hash = $(this).attr('href');
        }

        // clear all active
        $.each($('.list_category > li').not(":eq(" + _index + ")"), function () {
            if ($(this).hasClass('active'))
                $(this).removeClass('active');

            if ($(this).children('a').attr('data-toggled') == 'on') {
                $(this).children('a').attr('data-toggled', 'off');
            }
        }); // clear active

        // all add attr off

        if (!$(this).attr('data-toggled') || $(this).attr('data-toggled') == 'off') {
            $(this).attr('data-toggled', 'on');

            $(".list_category").each(function (key, value) {
                if ($(this).find("li:eq(" + _index + ")").length)
                    $(this).find("li:eq(" + _index + ")").addClass('active');
            });

            $('.box_category > ul > li').hide();

            if (_hash.length > 1) {
                if (_hash[1] == 'all') {
                    $('.box_category > ul > li').show();
                } else {
                    $('.box_category > ul > li').find('#' + _hash[1]).closest('li').show();
                }

                if ($('.box_category > ul > li').find('#' + _hash[1]).length) {
                    // $('html, body').animate({
                    //     scrollTop: Math.ceil($('.box_category > ul > li').find('#' + _hash[1]).offset().top) // Math.ceil((target_top * $(window).outerHeight(true)) / $('html, body').height())
                    // }, 'linear');
                }

            }

        }
        else if ($(this).attr('data-toggled') == 'on') {
            $(this).attr('data-toggled', 'off');

            $(".list_category").each(function (key, value) {
                if ($(this).find("li:eq(" + _index + ")").hasClass('active'))
                    $(this).find("li:eq(" + _index + ")").removeClass('active');
            });

            $('.box_category > ul > li').show();
        }

        // $('#item-stickybar').trigger("sticky_kit:recalc");

        return false;
    });

//
//     $('.list_category > li > a').on('click', function(event) {
//         event.preventDefault();
//         var _hash = $(this).attr('href').split('#');
//
//         $.each($('.list_category > li'), function() {
//            if($(this).hasClass('active'))
//                $(this).removeClass('active');
//         }); // clear active
//
//         if($(this).parent().hasClass('active')) {
//             $(this).parent().removeClass('active');
//             $('.box_category > ul > li').show();
//         } else {
//             $(this).parent().addClass('active');
//             $('.box_category > ul > li').hide();
//             if(_hash.length > 1) {
//                if(_hash[1] == 'all') {
//                    $('.box_category > ul > li').show();
//                } else {
//                    $('.box_category > ul > li').find('#'+_hash[1]).closest('li').show();
//                }
//
//
//             }
//         }
//
//         return false;
//     });

    // якори
    $('a.anchor').on("click", function (e) {
        e.preventDefault();
        var anchor = $(this).attr('href').split('#');
        if (anchor.length > 1) {
            $('html, body').stop().animate({
                scrollTop: $('.box-anchor #' + anchor[1]).offset().top
            }, 1000);
        }


        return false;
    });


//   $('.search-category').on('click', function(e) {
//       e.preventDefault();
//       var _os = $(this).attr('attr_os');
//       if( _os) {
//           $.fn.PumpicList('search', {
//               'search_method': 'getPhonesByOS',
//               '_method': 'getCountOS',
//               '_query': _os
//           });
//       }
//
//       return false;
//   });

    // compatibility tooltip in device
    if ($('.mobile_tooltip').length) {
        $('.mobile_tooltip').easyTooltip();
    }

    // focus
    if ($('.form-discount').length) {
        var elements = $(".form-discount input[type!='submit'], .form-discount textarea, .form-discount select");
        elements.focus(function () {
            $(this).addClass('highlight');
        });
        elements.blur(function () {
            $(this).removeClass('highlight');
        });
    }

    if ($('.box-form').length) {
        var elements = $(".box-form input[type!='submit'], .box-form textarea, .box-form select");
        elements.focus(function () {
            $(this).addClass('highlight');
        });
        elements.blur(function () {
            $(this).removeClass('highlight');
        });
    }


    // compatibility_form
    var validator_send_find_phone = $('form[name="send_find_phone"]').validate({
        onfocusout: false,
        onkeyup: false,
        onclick: true,
        onsubmit: true,
        focusInvalid: false,
        focusCleanup: false,
        debug: false,
        'device-model': {
            required: true
        },
        'captcha': {
            required: true
        },
        email: {
            required: true,
            email: true
        },
        name: {
            required: true
        },
        messages: {
            'captcha': "Invalid CAPTCHA.", // The CAPTCHA field is empty.
            name: "The Name field is empty",
            'device-model': "The Device Model field is empty",
            email: {
                required: "The Email field is empty",
                email: "Invalid email format"
            }
        },
        errorClass: "invalid",
        validClass: "success",
        invalidHandler: function (event, validator) {
            if ($('form[name="send_find_phone"] span.info').length)
                $('form[name="send_find_phone"] span.info').html(" ").hide();

            if ($('form[name="send_find_phone"] .fatal-error').length)
                $('form[name="send_find_phone"] .fatal-error').html(" ").hide();

            if ($('form[name="send_find_phone"] label.error, form[name="send_find_phone"] label.invalid').length)
                $('form[name="send_find_phone"] label.error, form[name="send_find_phone"] label.invalid').remove();
        },
        // управление ошибками
        showErrors: function (errorMap, errorList) {
            var _form = $('form[name="send_find_phone"]');
            var msg = null;

            $.each(errorList, function (key, value) {
                if (value.element) {
                    var name = _form.find(value.element).attr('name');
                    // console.log( name );
                    _form.find(value.element).after('<label id="' + name + '-error" for="' + name + '" class="invalid">' + value.message + '</label>');
                    _form.find(value.element).next().show();
                }
            });
        },
        submitHandler: function (form) {
            if ($('form[name="send_find_phone"] span.info').length)
                $('form[name="send_find_phone"] span.info').html(" ").hide();

            if ($('form[name="send_find_phone"] .fatal-error').length)
                $('form[name="send_find_phone"] .fatal-error').html(" ").hide();

            if ($('form[name="send_find_phone"] label.error, form[name="send_find_phone"] label.invalid').length)
                $('form[name="send_find_phone"] label.error, form[name="send_find_phone"] label.invalid').remove();

            var $form = $(form);
            var _params = parseQuery($form.serializeArray());

            var _response = getAjaxForm('/compatibility_send.html', _params);
            if (_response.result) {
                var _res = _response.result;
                if (_res.error) {

                    if (typeof _res.error === 'object') {
                        $.each(_res.error, function (name, text) {
                            var _obj = $form.find('input[name="' + name + '"]');

                            if (_obj.length) {

                                if (_obj.next('label').length) {
                                    _obj.next().html(text).show();
                                } else {
                                    $('<label id="' + name + '-error" for="' + name + '" class="invalid">' + text + '</label>').insertAfter(_obj);
                                }
                            }
                        });
                    } else {
                        $('form[name="send_find_phone"] .fatal-error').html(_res.error);
                    }

                    reloadCaptcha($form.find('.box-captcha > img'), true); // reload captcha
                    return false;
                } else if (_res.success) {
                    $('form[name="send_find_phone"] span.info').html(_res.success).css({'display': 'inline-block'});

                    // scrollTo block info
                    var target_top = $('form[name="send_find_phone"] span.info').offset().top;
                    $('html, body').animate({
                        scrollTop: Math.ceil(target_top) // Math.ceil((target_top * $(window).outerHeight(true)) / $('html, body').height())
                    }, 'linear');

                    console.log(target_top, Math.ceil((target_top * $(window).outerHeight(true)) / $('html, body').height()));

                    // google analitycs
                    ga('send', 'event', 'form', 'submit', 'compatibility-request-success');

                } else {
                    $('form[name="send_find_phone"] .fatal-error').html('Your email was not sent');
                    reloadCaptcha($form.find('.box-captcha > img'), true); // reload captcha
                    return false;
                }

            } else {
                $('form[name="send_find_phone"] .fatal-error').html('Your email was not sent');
                reloadCaptcha($form.find('.box-captcha > img'), true); // reload captcha
                return false;
            }

            reloadCaptcha($form.find('.box-captcha > img'), false); // reload captcha
            $form.trigger("reset");

            // return false;
        }
    });

    // clear info in focus
    $('form[name="send_find_phone"] input, form[name="send_find_phone"] textarea').focus(function () {
        //if($('form[name="send_find_phone"] span.info').length)
        //    $('form[name="send_find_phone"] span.info').html( " " ).hide();
        //if($('form[name="send_find_phone"] .fatal-error').length)
        //    $('form[name="send_find_phone"] .fatal-error').html( " " ).hide();
        //if($('form[name="send_find_phone"] label.error, form[name="send_find_phone"] label.invalid').length)
        //    $('form[name="send_find_phone"] label.error, form[name="send_find_phone"] label.invalid').remove();
    });

    // compatibility_form
    var validator_send_mobile_operators_find_phone = $('form[name="send_mobile_operators_find_phone"]').validate({
        onfocusout: false,
        onkeyup: false,
        onclick: true,
        onsubmit: true,
        focusInvalid: false,
        focusCleanup: false,
        debug: false,
        'carrier': {
            required: true
        },
        'captcha': {
            required: true
        },
        email: {
            required: true,
            email: true
        },
        messages: {
            'captcha': "Invalid CAPTCHA.", // The CAPTCHA field is empty.
            name: "The Device Model field is empty",
            email: {
                required: "The Email field is empty",
                email: "Invalid email format"
            }
        },
        errorClass: "invalid",
        validClass: "success",
        invalidHandler: function (event, validator) {
            if ($('form[name="send_mobile_operators_find_phone"] span.info').length)
                $('form[name="send_mobile_operators_find_phone"] span.info').html(" ").hide();

            if ($('form[name="send_mobile_operators_find_phone"] .fatal-error').length)
                $('form[name="send_mobile_operators_find_phone"] .fatal-error').html(" ").hide();

            if ($('form[name="send_mobile_operators_find_phone"] label.error, form[name="send_mobile_operators_find_phone"] label.invalid').length)
                $('form[name="send_mobile_operators_find_phone"] label.error, form[name="send_mobile_operators_find_phone"] label.invalid').remove();
        },
        // управление ошибками
        showErrors: function (errorMap, errorList) {
            var _form = $('form[name="send_mobile_operators_find_phone"]');
            var msg = null;

            $.each(errorList, function (key, value) {
                if (value.element) {
                    var name = _form.find(value.element).attr('name');
                    // console.log( name );
                    _form.find(value.element).after('<label id="' + name + '-error" for="' + name + '" class="invalid">' + value.message + '</label>');
                    _form.find(value.element).next().show();
                }
            });
        },
        submitHandler: function (form) {
            if ($('form[name="send_mobile_operators_find_phone"] span.info').length)
                $('form[name="send_mobile_operators_find_phone"] span.info').html(" ").hide();

            if ($('form[name="send_mobile_operators_find_phone"] .fatal-error').length)
                $('form[name="send_mobile_operators_find_phone"] .fatal-error').html(" ").hide();

            if ($('form[name="send_mobile_operators_find_phone"] label.error, form[name="send_mobile_operators_find_phone"] label.invalid').length)
                $('form[name="send_mobile_operators_find_phone"] label.error, form[name="send_mobile_operators_find_phone"] label.invalid').remove();

            var $form = $(form);
            var _params = parseQuery($form.serializeArray());

            var _response = getAjaxForm('/gps-wireless-tracking-phone.html', _params);
            if (_response.result) {
                var _res = _response.result;
                if (_res.error) {

                    if (typeof _res.error === 'object') {
                        $.each(_res.error, function (name, text) {
                            var _obj = $form.find('input[name="' + name + '"]');

                            if (_obj.length) {

                                if (_obj.next('label').length) {
                                    _obj.next().html(text).show();
                                } else {
                                    $('<label id="' + name + '-error" for="' + name + '" class="invalid">' + text + '</label>').insertAfter(_obj);
                                }
                            }
                        });
                    } else {
                        $('form[name="send_mobile_operators_find_phone"] .fatal-error').html(_res.error);
                    }

                    reloadCaptcha($form.find('.box-captcha > img'), true); // reload captcha
                    return false;
                } else if (_res.success) {
                    $('form[name="send_mobile_operators_find_phone"] span.info').html(_res.success).css({'display': 'inline-block'});

                    // scrollTo block info
                    var target_top = $('form[name="send_mobile_operators_find_phone"] span.info').offset().top;
                    $('html, body').animate({
                        scrollTop: Math.ceil(target_top) // Math.ceil((target_top * $(window).outerHeight(true)) / $('html, body').height())
                    }, 'linear');

                    // console.log( target_top, Math.ceil((target_top * $(window).outerHeight(true)) / $('html, body').height()) );

                    // google analitycs
                    ga('send', 'event', 'form', 'submit', 'mobile-operators-request-success');

                } else {
                    $('form[name="send_mobile_operators_find_phone"] .fatal-error').html('Your email was not sent');
                    reloadCaptcha($form.find('.box-captcha > img'), true); // reload captcha
                    return false;
                }

            } else {
                $('form[name="send_mobile_operators_find_phone"] .fatal-error').html('Your email was not sent');
                reloadCaptcha($form.find('.box-captcha > img'), true); // reload captcha
                return false;
            }

            reloadCaptcha($form.find('.box-captcha > img'), false); // reload captcha
            $form.trigger("reset");

            // return false;
        }
    });

    // clear info in focus
    $('form[name="send_mobile_operators_find_phone"] input, form[name="send_mobile_operators_find_phone"] textarea').focus(function () {
        //if($('form[name="send_mobile_operators_find_phone"] span.info').length)
        //    $('form[name="send_mobile_operators_find_phone"] span.info').html( " " ).hide();
        //if($('form[name="send_mobile_operators_find_phone"] .fatal-error').length)
        //    $('form[name="send_mobile_operators_find_phone"] .fatal-error').html( " " ).hide();
        //if($('form[name="send_mobile_operators_find_phone"] label.error, form[name="send_mobile_operators_find_phone"] label.invalid').length)
        //    $('form[name="send_mobile_operators_find_phone"] label.error, form[name="send_mobile_operators_find_phone"] label.invalid').remove();
    });


    // validator faq (form-faq-send)
    var validator_form_faq = $('form.form-faq-send').validate({
        onfocusout: false,
        focusInvalid: false,
        'name': {
            required: true
        },
        'question': {
            required: true
        },
        email: {
            required: true,
            email: true
        },
        messages: {
            name: "The Name field is empty",
            question: 'The Question field is empty',
            email: {
                required: "The Email field is empty",
                email: "Invalid email format"
            },
        },
        errorClass: "invalid",
        validClass: "success",
        invalidHandler: function (event, validator) {
            if ($('form.form-faq-send span.info').length)
                $('form.form-faq-send span.info').html(" ").hide();

            if ($('form.form-faq-send .fatal-error').length)
                $('form.form-faq-send .fatal-error').html(" ").hide();
        },
        submitHandler: function (form) {
            if ($('form.form-faq-send span.info').length)
                $('form.form-faq-send span.info').html(" ").hide();

            if ($('form.form-faq-send .fatal-error').length)
                $('form.form-faq-send .fatal-error').html(" ").hide();

            var $form = $(form);
            var _params = parseQuery($form.serializeArray());

            var _response = getAjaxForm('/faq_send.html', _params);
            if (_response.result) {
                var _res = _response.result;
                if (_res.error) {
                    if (typeof _res.error === 'object') {
                        $.each(_res.error, function (name, text) {
                            var _obj = $form.find('input[name="' + name + '"]');
                            if (_obj.length) {
                                if (_obj.next('label').length)
                                    _obj.next().html(text).show();
                                else
                                    $('<label id="' + name + '-error" for="' + name + '" class="invalid">' + text + '</label>').insertAfter(_obj);
                            }
                        });
                    } else {
                        $('form.form-faq-send .fatal-error').html(_res.error);
                    }


                    return false;
                } else if (_res.success) {
                    $('form.form-faq-send span.info').html(_res.success).css({'display': 'inline-block'});

                    // google analitycs
                    ga('send', 'event', 'form', 'submit', 'faq-request-success');

                } else {
                    $('form.form-faq-send .fatal-error').html('Your email was not sent');
                    console.log('System error!');
                    return false;
                }

            } else {
                $('form.form-faq-send .fatal-error').html('Your email was not sent');
                console.log('Can not get params in ajax!');
                return false;
            }


            $form.trigger("reset");
        }
    });

    // clear info in focus
    $('form.form-faq-send input, form.form-faq-send textarea').focus(function () {
//        if($('form.form-faq-send span.info').length)
//            $('form.form-faq-send span.info').html( " " ).hide();
//        if($('form.form-faq-send .fatal-error').length)
//            $('form.form-faq-send .fatal-error').html( " " ).hide();
//        if($('form.form-faq-send label.error, form.form-faq-send label.invalid').length)
//            $('form.form-faq-send label.error, form.form-faq-send label.invalid').remove();
    });



    /* validate contact us */
    $('form.form-contact-us select')
            .change(function () {
                var _selected = false;
                $('form.form-contact-us #wos').val('');
                $(this).find("option:selected").each(function () {
                    _selected = $(this).val();
                });

                if (_selected && _selected != '0') {
                    $('form.form-contact-us #wos').val(_selected).valid();
                }
                // $(this).selectpicker('hide');
            })
            .change();


    var validator_contact_us = $('form.form-contact-us').validate({
        onfocusout: false,
        onkeyup: false,
        onclick: true,
        onsubmit: true,
        focusInvalid: false,
        focusCleanup: false,
        debug: false,
        ignore: "not:hidden",
        'name': {
            required: true
        },
        'description': {
            required: true
        },
        wos: {
            required: true
        },
        email: {
            required: true,
            email: true
        },
        'captcha': {
            required: true,
        },
        messages: {
            'captcha': "Invalid CAPTCHA.", // The CAPTCHA field is empty.
            name: "The Name field is empty",
            description: 'The Question field is empty',
            wos: 'The field Choose your OS is empty',
            email: {
                required: "The Email field is empty",
                email: "Invalid email format"
            },
        },
        errorClass: "invalid",
        validClass: "success",
        invalidHandler: function (event, validator) {
            if ($('form.form-contact-us span.info').length)
                $('form.form-contact-us span.info').html(" ").hide();

            if ($('form.form-contact-us .fatal-error').length)
                $('form.form-contact-us .fatal-error').html(" ").hide();

            if ($('form.form-contact-us label.error, form.form-contact-us label.invalid').length)
                $('form.form-contact-us label.error, form.form-contact-us label.invalid').remove();
        },
        // управление ошибками
        showErrors: function (errorMap, errorList) {
            var _form = $('form.form-contact-us');
            var msg = null;

            $.each(errorList, function (key, value) {
                if (value.element) {
                    var name = _form.find(value.element).attr('name');
                    // console.log( name );
                    _form.find(value.element).after('<label id="' + name + '-error" for="' + name + '" class="invalid">' + value.message + '</label>');
                    _form.find(value.element).next().show();
                }
            });
        },
        submitHandler: function (form) {
            if ($('form.form-contact-us span.info').length)
                $('form.form-contact-us span.info').html(" ").hide();

            if ($('form.form-contact-us .fatal-error').length)
                $('form.form-contact-us .fatal-error').html(" ").hide();

            if ($('form.form-contact-us label.error, form.form-contact-us label.invalid').length)
                $('form.form-contact-us label.error, form.form-contact-us label.invalid').remove();

            var $form = $(form);
            var _params = parseQuery($form.serializeArray());


            var _response = getAjaxForm('/contact_us_send.html', _params);
            if (_response.result) {

                var _res = _response.result;
                if (_res.error) {

                    if (typeof _res.error === 'object') {
                        $.each(_res.error, function (name, text) {
                            var _obj = $form.find('input[name="' + name + '"]');
                            if (_obj.length) {
                                if (_obj.next('label').length)
                                    _obj.next().html(text).show();
                                else
                                    $('<label id="' + name + '-error" for="' + name + '" class="invalid">' + text + '</label>').insertAfter(_obj);
                            }
                        });
                    } else {
                        $('form.form-contact-us .fatal-error').html(_res.error);
                    }

                    reloadCaptcha($form.find('.box-captcha > img'), true); // reload captcha
                    return false;
                } else if (_res.success) {

                    $('form.form-contact-us span.info')
                            .html(_res.success)
                            .css({'display': 'inline-block'});

                    // scrollTo block info
                    var target_top = $('form.form-contact-us span.info').offset().top;
                    $('html, body').animate({
                        scrollTop: Math.ceil((target_top * $(window).outerHeight(true)) / $('html, body').height())
                    }, 'linear');

                    // google analitycs
                    ga('send', 'event', 'form', 'submit', 'contact-request-success');

                } else {
                    $('form.form-contact-us .fatal-error').html('Your email was not sent');
                    reloadCaptcha($form.find('.box-captcha > img'), true); // reload captcha
                    return false;
                }

            } else {
                $('form.form-contact-us .fatal-error').html('Your email was not sent');
                reloadCaptcha($form.find('.box-captcha > img'), true); // reload captcha
                return false;
            }

            reloadCaptcha($form.find('.box-captcha > img')); // reload captcha
            $form.trigger("reset");
        }
    });

//    $('form.form-contact-us"]').on('submit', function() {
//       alert('ok!');
//        return false;
//    });

    $('form.form-contact-us input, form.form-contact-us textarea').focus(function () {
//        if($('form.form-contact-us span.info').length)
//            $('form.form-contact-us span.info').html( " " ).hide();
//        if($('form.form-contact-us .fatal-error').length)
//            $('form.form-contact-us .fatal-error').html( " " ).hide();
//        if($('form.form-contact-us label.error, form.form-contact-us label.invalid').length)
//            $('form.form-contact-us label.error, form.form-contact-us label.invalid').remove();
    });

    /* validate faq form */
    $('form.form-faq select')
            .change(function () {
                var _selected = false;
                $('form.form-faq #wos').val('');
                $(this).find("option:selected").each(function () {
                    _selected = $(this).val();
                });

                if (_selected && _selected != '0') {
                    $('form.form-faq #wos').val(_selected).valid();
                }
                // $(this).selectpicker('hide');
            })
            .change();


    var validator_contact_us = $('form.form-faq').validate({
        onfocusout: false,
        onkeyup: false,
        onclick: true,
        onsubmit: true,
        focusInvalid: false,
        focusCleanup: false,
        debug: false,
        ignore: "not:hidden",
        'name': {
            required: true
        },
        'description': {
            required: true
        },
        wos: {
            required: true
        },
        email: {
            required: true,
            email: true
        },
        'captcha': {
            required: true,
        },
        messages: {
            'captcha': "Invalid CAPTCHA.", // The CAPTCHA field is empty.
            name: "The Name field is empty",
            description: 'The Question field is empty',
            wos: 'The field Choose your OS is empty',
            email: {
                required: "The Email field is empty",
                email: "Invalid email format"
            },
        },
        errorClass: "invalid",
        validClass: "success",
        invalidHandler: function (event, validator) {
            if ($('form.form-faq span.info').length)
                $('form.form-faq span.info').html(" ").hide();

            if ($('form.form-faq .fatal-error').length)
                $('form.form-faq .fatal-error').html(" ").hide();

            if ($('form.form-faq label.error, form.form-faq label.invalid').length)
                $('form.form-faq label.error, form.form-faq label.invalid').remove();
        },
        // управление ошибками
        showErrors: function (errorMap, errorList) {
            var _form = $('form.form-faq');
            var msg = null;

            $.each(errorList, function (key, value) {
                if (value.element) {
                    var name = _form.find(value.element).attr('name');
                    // console.log( name );
                    _form.find(value.element).after('<label id="' + name + '-error" for="' + name + '" class="invalid">' + value.message + '</label>');
                    _form.find(value.element).next().show();
                }
            });
        },
        submitHandler: function (form) {
            if ($('form.form-faq span.info').length)
                $('form.form-faq span.info').html(" ").hide();

            if ($('form.form-faq .fatal-error').length)
                $('form.form-faq .fatal-error').html(" ").hide();

            if ($('form.form-faq label.error, form.form-faq label.invalid').length)
                $('form.form-faq label.error, form.form-faq label.invalid').remove();

            var $form = $(form);
            var _params = parseQuery($form.serializeArray());


            var _response = getAjaxForm('/faq.html', _params);
            if (_response.result) {

                var _res = _response.result;
                if (_res.error) {

                    if (typeof _res.error === 'object') {
                        $.each(_res.error, function (name, text) {
                            var _obj = $form.find('input[name="' + name + '"]');
                            if (_obj.length) {
                                if (_obj.next('label').length)
                                    _obj.next().html(text).show();
                                else
                                    $('<label id="' + name + '-error" for="' + name + '" class="invalid">' + text + '</label>').insertAfter(_obj);
                            }
                        });
                    } else {
                        $('form.form-faq .fatal-error').html(_res.error);
                    }

                    reloadCaptcha($form.find('.box-captcha > img'), true); // reload captcha
                    return false;
                } else if (_res.success) {

                    $('form.form-faq span.info')
                            .html(_res.success)
                            .css({'display': 'inline-block'});

                    // scrollTo block info
                    var target_top = $('form.form-faq span.info').offset().top;
                    $('html, body').animate({
                        scrollTop: Math.ceil((target_top * $(window).outerHeight(true)) / $('html, body').height())
                    }, 'linear');

                    // google analitycs
                    ga('send', 'event', 'form', 'submit', 'contact-request-success');

                } else {
                    $('form.form-faq .fatal-error').html('Your email was not sent');
                    reloadCaptcha($form.find('.box-captcha > img'), true); // reload captcha
                    return false;
                }

            } else {
                $('form.form-faq .fatal-error').html('Your email was not sent');
                reloadCaptcha($form.find('.box-captcha > img'), true); // reload captcha
                return false;
            }

            reloadCaptcha($form.find('.box-captcha > img')); // reload captcha
            $form.trigger("reset");
        }
    });


    // validate form
    //if($(".box-form").length) {
    //    $(".box-form").validate();
    // }
    /* ------- form login ------ */
    if ($('form[name="form-login"]').length) {
        $('form[name="form-login"]').validate({
            onfocusout: false,
            onkeyup: false,
            onclick: true,
            onsubmit: true,
            focusInvalid: false,
            focusCleanup: false,
            messages: {
                'password': "The Password field is empty.",
                'email': {
                    required: "The Email field is empty.",
                    email: "Invalid email format."
                },
                errorClass: "error",
            },
            invalidHandler: function (event, validator) {
                if ($('form[name="form-login"] label.error').length)
                    $('form[name="form-login"] label.error').remove();

                if ($('form[name="form-login"] div.box-error')) {
                    $('form[name="form-login"] div.box-error').addClass('hide');
                }
            },
            // управление ошибками
            showErrors: function (errorMap, errorList) {
                var _form = $('form[name="form-login"]');
                var msg = null;

                $.each(errorList, function (key, value) {
                    if (value.element) {
                        _form.find(value.element).after('<label class="error">' + value.message + '</label>');
                        _form.find(value.element).next().show();
                    }
                });
            },
        });
    }

    /* ------- form-registration ------ */
    if ($('form[name="form-registration"]').length) {
        $('form[name="form-registration"]').validate({
            onfocusout: false,
            onkeyup: false,
            onclick: true,
            onsubmit: true,
            focusInvalid: false,
            focusCleanup: false,
            messages: {
                'captcha': "Invalid CAPTCHA.", // The CAPTCHA field is empty.
                'email': {
                    required: "The Email field is empty.",
                    email: "Invalid email format."
                },
                errorClass: "error",
            },
            invalidHandler: function (event, validator) {
                if ($('form[name="form-registration"] label.error').length)
                    $('form[name="form-registration"] label.error').remove();

                if ($('form[name="form-registration"] div.box-error')) {
                    $('form[name="form-registration"] div.box-error').addClass('hide');
                }
            },
            // управление ошибками
            showErrors: function (errorMap, errorList) {
                var _form = $('form[name="form-registration"]');
                var msg = null;

                $.each(errorList, function (key, value) {
                    if (value.element) {
                        _form.find(value.element).after('<label class="error">' + value.message + '</label>');
                        _form.find(value.element).next().show();
                    }
                });
            },
        });
    }

    /* ------- form-free-trial-registration ------ */
    if ($('form[name="free_trial_registration"]').length) {
        $('form[name="free_trial_registration"]').validate({
            onfocusout: false,
            onkeyup: false,
            onclick: true,
            onsubmit: true,
            focusInvalid: false,
            focusCleanup: false,
            messages: {
                'captcha': "Invalid CAPTCHA.", // The CAPTCHA field is empty.
                'name': {
                    required: "The Name field is empty.",
                },
                'email': {
                    required: "The Email field is empty.",
                    email: "Invalid email format."
                },
                errorClass: "error",
            },
            invalidHandler: function (event, validator) {
                if ($('form[name="free_trial_registration"] #block-fields label.error').length)
                    $('form[name="free_trial_registration"] #block-fields label.error').remove();

                if ($('form[name="free_trial_registration"] div.box-error')) {
                    $('form[name="free_trial_registration"] div.box-error').addClass('hide');
                }
            },
            // управление ошибками
            showErrors: function (errorMap, errorList) {
                var fileds = $('form[name="free_trial_registration"] #block-fields');
                var msg = null;

                $.each(errorList, function (key, value) {
                    // console.log(key, value);
                    if (value.element) {
                        fileds.find(value.element).after('<label class="error">' + value.message + '</label>').show();
                    }
                });
            },
        });
    }

    /* ------- form-restore ------ */
    if ($('form[name="form-restore"]').length) {
        $('form[name="form-restore"]').validate({
            onfocusout: false,
            onkeyup: false,
            onclick: true,
            onsubmit: true,
            focusInvalid: false,
            focusCleanup: false,
            debug: false,
            messages: {
                'email': {
                    required: "The Email field is empty.",
                    email: "Invalid email format."
                },
                errorClass: "error",
            },
            invalidHandler: function (event, validator) {
                if ($('form[name="form-restore"] label.error').length)
                    $('form[name="form-restore"] label.error').remove();

                if ($('form[name="form-restore"] div.box-error')) {
                    $('form[name="form-restore"] div.box-error').addClass('hide');
                }
            },
            // управление ошибками
            showErrors: function (errorMap, errorList) {
                var _form = $('form[name="form-restore"]');
                var msg = null;

                $.each(errorList, function (key, value) {
                    if (value.element) {
                        _form.find(value.element).after('<label class="error">' + value.message + '</label>');
                        _form.find(value.element).next().show();
                    }
                });
            },
        });
    }

    /* ----- form discount ----- */
    if ($('#form-discount').length) {
        $('#form-discount').validate({
            onfocusout: false,
            onkeyup: false,
            onclick: true,
            onsubmit: true,
            focusInvalid: false,
            focusCleanup: false,
            messages: {
                'captcha': "Invalid CAPTCHA.", // The CAPTCHA field is empty.
                'discount[name]': "The Name field is empty.",
                'discount[email]': {
                    required: "The Password field is empty.",
                    email: "Invalid email format."
                },
                errorClass: "error",
            },
            invalidHandler: function (event, validator) {
                if ($('#form-discount label.error').length)
                    $('#form-discount label.error').remove();

                if ($('#form-discount div.box-error')) {
                    $('#form-discount div.box-error').addClass('hide');
                }
            },
            // управление ошибками
            showErrors: function (errorMap, errorList) {
                var _form = $('#form-discount');
                var msg = null;

                $.each(errorList, function (key, value) {
                    if (value.element) {
                        _form.find(value.element).after('<label class="error">' + value.message + '</label>');
                        _form.find(value.element).next().show();
                    }
                });
            },
        });
    }

    /**
     * CAPACHA
     */
    if ($('.box-captcha').length) {
        $('.update-captcha, .a-update-captcha').on('click', function (event) {
            event.preventDefault();
            reloadCaptcha($(this), true);
//           var _src = '/captcha.html?'+Math.random();
//           if($(this).attr('attr-width') && $(this).attr('attr-height')) {
//               _src = '/captcha.html?width='+$(this).attr('attr-width')+'&height='+$(this).attr('attr-height')+'&'+Math.random();
//           }
//
//           $('.box-captcha').find('#img-captcha').attr('src', _src);
//           $('form[name="form-registration"], form[name="free_trial_registration"]').find('input[name="captcha"]').focus();
            return false;
        });
    }

    
    // switch features Android basic
    $('.show_basic_features._android-f a').toggle(
            function (event) {
                event.preventDefault();
                $('.basic_fe._android-f').css("margin-top", "10px");
                $('.basic_fe._android-f').show();
                $('.basic_wr .show-f._android-f').hide();
                $('.basic_wr .hide-f._android-f').show();
            }, function (event) {
        event.preventDefault();
        $('.basic_fe._android-f').css("margin-top", "90px");
        $('.basic_fe._android-f').hide();
				$('.basic_wr .show-f._android-f').show();
				$('.basic_wr .hide-f._android-f').hide();
				});
	
    // switch features Android premium
    $('.show_premium_features._android-f a').toggle(
            function (event) {
                event.preventDefault();
                $('.premium_fe._android-f').css("margin-top", "10px");
                $('.premium_fe._android-f').show();
                $('.premium_wr .show-f._android-f').hide();
                $('.premium_wr .hide-f._android-f').show();
            }, function (event) {
        event.preventDefault();
        $('.premium_fe._android-f').css("margin-top", "90px");
        $('.premium_fe._android-f').hide();
				$('.premium_wr .show-f._android-f').show();
				$('.premium_wr .hide-f._android-f').hide();
				});
	
		// switch features iOS
    $('.show_premium_features._icloud-f a').toggle(
            function (event) {
                event.preventDefault();
                $('.premium_fe._icloud-f').css("margin-top", "10px");
                $('.premium_fe._icloud-f').show();
                $('.show-f._icloud-f').hide();
                $('.hide-f._icloud-f').show();
                $('.prod-icloud.prod-2').show();
            }, function (event) {
        event.preventDefault();
        $('.premium_fe._icloud-f').css("margin-top", "90px");
        $('.premium_fe._icloud-f').hide();
        $('.show-f._icloud-f').show();
        $('.hide-f._icloud-f').hide();
        $('.prod-icloud.prod-2').hide();
        }
    );
		// switch features Jailbreak
    $('.show_premium_features._jailbreak-f a').toggle(
            function (event) {
                event.preventDefault();
                $('.premium_fe._jailbreak-f').css("margin-top", "10px");
                $('.premium_fe._jailbreak-f').show();
                $('.show-f._jailbreak-f').hide();
                $('.hide-f._jailbreak-f').show();
                $('._prod-icloud.prod-2._jailbreak-f').show();
            }, function (event) {
        event.preventDefault();
        $('.premium_fe._jailbreak-f').css("margin-top", "90px");
        $('.premium_fe._jailbreak-f').hide();
        $('.show-f._jailbreak-f').show();
        $('.hide-f._jailbreak-f').hide();
        $('.prod-icloud.prod-2._jailbreak-f').hide();
        }
    );
    $("input[name='optionsRadios']").each(function () {
        //console.log(this.getAttribute("checked"));
        if (this.getAttribute("checked")) {
            // alert($(this).val());

            $(this).parent('.label_radio').addClass('r_on');
            $(this).parent('.label_radio').removeClass('r_off');
            $(this).parents('form').children('.product_price').val($(this).val());
        }
    });
    
    // function stickyHeader(header, currentPos) {
    //     window.addEventListener('scroll', function (e) {
    //         var distanceY = window.pageYOffset || document.documentElement.scrollTop;
    //
    //         if (distanceY > currentPos) {
    //             header.addClass("sticky");
    //         }
    //         else {
    //             header.removeClass("sticky");
    //         }
    //     });
    // }
    //
    // var myheader = $("#save_1");
    // console.log(myheader)
    // stickyHeader(myheader, myheader.offset.top());
    /*$("input[name='optionsRadios']").filter(':checked').each(function(){

     var curr  = $(this);



     curr.parent('.label_radio').removeClass('r_off');
     curr.parent('.label_radio').addClass('r_on');

     curr.parents('form').children('.product_price').val(curr.val());

     });   */
    /* hashchange_AfterInit */

    hashchange_AfterInit();

    /* fix features desine chrome */
    if ($('#viber-whatsapp-skype').length) {
        if ($.browser.webkit) {
            $('#viber-whatsapp-skype').removeClass('w30p').addClass('w16p');
            // alert( "This is WebKit!" );
        } else
            $('#viber-whatsapp-skype').removeClass('w16p').addClass('w30p');
    }

// ga click
// faq
    $('form[name="form-faq"] button.event-submit').click(function () {
        ga('send', 'event', 'form', 'submit', 'faq-request');
    });

// login
    $('form[name="form-login"] .button-sumbit button').click(function () {
        ga('send', 'event', 'form', 'submit', 'login');
    });

// restore
    $('form[name="form-restore"] .button-sumbit button').click(function () {
        ga('send', 'event', 'form', 'submit', 'restore');
    });

// registration
    $('form[name="form-registration"] .button-sumbit button').click(function () {
        ga('send', 'event', 'form', 'submit', 'registration');
    });

// contact-us
    $('form[name="send-mail-contact-us"] button.event-submit').click(function () {
        ga('send', 'event', 'form', 'submit', 'contact-request');
    });

// compatibility
    $('form[name="send_find_phone"] button.event-submit').click(function () {
        ga('send', 'event', 'form', 'submit', 'compatibility-request');
    });



    // scroll (fly-box)
    if ($('.fly-box').length) {
        $('.fly-box').scrollPumpic({
            'start': 1000,
            'stop': 0,
            'animate': {
                'type': 'visible', // fade, visible, blinking
                'timeShow': 50,
                'timeHide': 50
            }
        }); //"coeff":1.15
    }

    // fly block
    if ($('.fly-box-buttons').length) {
        $(window).on('load resize', function () {
            var $offcetTop = Math.round($('.fly-position').offset().top);
            if (typeof $.data(document, '_scrollButtons_' + $(this).width()) == "undefined"
                    || $.data(document, '_scrollButtons_' + $(this).width()) != $offcetTop) {
                $.data(document, '_scrollButtons_' + $(this).width(), $offcetTop);
            }

            // console.log( $offcetTop, $.data(document, '_scrollButtons_'+$(this).width()) );

            if ($.data(document, '_scrollButtons_' + $(this).width())) {
                $('.fly-box-buttons').scrollPumpic({
                    '_objFly': '.block-fly',
                    'start': $.data(document, '_scrollButtons_' + $(this).width()),
                    'stop': 0,
                    'right': 300,
                    '_settings': {
                        '_responce': false,
                        '_validate': false
                    },
                    'animate': {
                        'type': 'blinking', // fade, visible, blinking
                        'timeShow': 30,
                        'timeHide': 50
                    }
                }); //"coeff":1.15
            }

        });
    }

    // tabs compatibility
    $('#temp-1 .bc-tabs .item-tab a, #temp-1 .bc-tabs .item-tab span, #temp-2 > ul > li > a, #temp-2 > ul > li > span').on('click', function () {
        // clear all active
        var _itab = $(this).parent(),
                _this = $(this),
                _data_cat_id = _itab.attr('data-cat-id');
        $.each($('#temp-1 .bc-tabs .item-tab, #temp-2 > ul > li, #temp-1 #tab-content > div'), function (key, val) {
            if ($(val).hasClass('active'))
                $(val).removeClass('active');
        });

        if (!_itab.hasClass('active')) {
            $('#temp-1 .bc-tabs section > div[data-cat-id="' + _data_cat_id + '"], #temp-2 > ul > li[data-cat-id="' + _data_cat_id + '"]').addClass('active');
            $('#temp-1 #tab-content > div[data-cat-id="' + _data_cat_id + '"]').addClass('active');
        }

        // clear all items
//            $.each($('#temp-2 > ul > li ul'), function(key, value) {
//                $(value).slideUp();
//            });

//      if($('#temp-2 > ul > li ul').is(':visible')) {
//          $('#temp-2 > ul > li ul').slideUp('slow');
//      }

        if (_itab.children('ul').is(':not(visible)')) {
            _itab.children('ul').slideDown('slow', function () {

                $.each($('#temp-2 > ul > li').not(':eq(' + $(this).parent().index() + ')').children('ul'), function (key, value) {
                    $(value).slideUp();
                });

                // scroll to active
                $('html, body').stop().animate({
                    scrollTop: _this.offset().top
                }, 1000);
            });
        }



    });


    // mobile operators
    if ($('.toggle-mobile-operators').length) {
        $('.toggle-mobile-operators').on('click', function (event) {
            event.preventDefault();
            $.each($('#mobile-operators .item-operators'), function (key, value) {
                if ($(value).hasClass('hide')) {
                    $(value).removeClass('hide').addClass('show');
                }
            });
            $(this).parent().hide();
            return false;
        });
    }



    // hovers
    $('.box-video-constructors .block-video-button > .box-hover').hover(
            function () {
                // console.log( $rs_width );
                if ($rs_width > 992) // !$rs_width ||
                    $(this).find('.hover-video-buttons').show();
            }, function () {
        if ($rs_width > 992) // !$rs_width ||
            $(this).find('.hover-video-buttons').hide();
    }
    );


    // bootstrap clic popUp
    if ($(".youtube").length) {
        $(".youtube").YouTubeModal({
            autoplay: 1,
            autohide: 1,
            width: 820,
            height: 520,
            theme: 'darck'
        });
    }

    // sticky
    if ($('.sticky').length) {

        $(window).on('scroll', function () {
            var windowTop = $(window).scrollTop();
            if (windowTop > 68) {
                $('.sticky').addClass('fixed');
            } else {
                $('.sticky').removeClass('fixed');
            }
        });


//        var sticky = document.querySelector('.sticky');
//        var origOffsetY = (!sticky.offsetTop) ? 68 : sticky.offsetTop;
//
//        function onScroll(e) {
//            window.scrollY >= origOffsetY ? sticky.classList.add('fixed') :
//                                          sticky.classList.remove('fixed');
//
//            console.log(window.scrollY+' = '+ origOffsetY);
//        }
//
//        document.addEventListener('scroll', onScroll);
    }
    /*$(".blocks-sticky").autofix_anything({
     customOffset: false, // You can define custom offset for when you want the container to be fixed. This option takes the number of pixels from the top of the page. The default value is false which the plugin will automatically fix the container when the it is in the viewport
     manual: false, // Toggle this to true if you wish to manually fix containers with the public method. Default value is false
     onlyInContainer: true // Set this to false if you don't want the fixed container to limit itself to the parent's container.
     });
     */

    /*
     if($(".phone-sticky").length) {

     if($(".phone-sticky").is(':visible')) {

     $(window).on('scroll', function() {
     var windowTop = $(window).scrollTop();
     if(windowTop > 68) {
     $(".phone-sticky").css({'position': 'fixed'});
     } else {
     $(".phone-sticky").css({'position': 'static'});
     }
     });

     }

     }
     */

    /*
     $('a#openBtnVideo').click(function(e){
     e.preventDefault();
     var src = $(this).attr('data-src');
     var height = $(this).attr('data-height') || 520;
     var width = $(this).attr('data-width') || 820;

     var p_w = parseInt( width ) + 15;
     var p_h = parseInt( height ) + 25;

     // $("#myModal .modal-dialog").css({'max-width': p_w+'px'}); // 'height': p_h+'px'
     $("#myModal .modal-body").css({'max-width': width+'px', 'height': height+'px'});

     $("#myModal iframe").attr({ 'height': height,
     'width': width});

     $('#myModal').on('shown.bs.modal', function (e) {
     $("#myModal iframe").attr({'src':src});
     });

     $('#myModal').on('hidden.bs.modal', function (e) {
     $("#myModal iframe").attr({'src': '#'});
     });

     $('#myModal').modal({show:true});
     return false;
     });

     $('#myModal').on('shown.bs.modal', function (e) {
     });
     $('#myModal').on('hidden.bs.modal', function (e) {
     });
     */


//    $('a#openBtnVideo').on('click', function(e) {
//        var src = $(this).attr('data-src');
//        var height = $(this).attr('data-height') || 520;
//        var width = $(this).attr('data-width') || 820;
//
//        var p_w = parseInt( width ) + 15;
//        var p_h = parseInt( height ) + 25;
//
//        $("#myModal .modal-dialog").css({'width': p_w+'px', 'height': p_h+'px'});
//        $("#myModal .modal-body").css({'width': width+'px', 'height': height+'px'});
//        $("#myModal iframe").attr({'src':src,
//                               'height': height,
//                               'width': width});
//    });



//    $(window).on('load resize', function() {
//         console.log($(this).width());
//    });


    // countries
    $("#c-features .row-list > li, .b-how-it-work h3.weight-normal, #block-compatibility-table .table-body > div > p").matchHeight();

    if ($('.match-height').length)
        $('.match-height').matchHeight();

//    if($('#b-recommended-by .main-block > .b-item').length)
//        $('#b-recommended-by .main-block > .b-item').matchHeight();

    $.fn.matchHeight._beforeUpdate = function (event, groups) {

        // do something before any updates are applied
    }

    $.fn.matchHeight._afterUpdate = function (event, groups) {
        /*
         if($('#b-recommended-by .main-block > .b-item').length)
         $('#b-recommended-by .main-block > .b-item').find('lable.title').css({'line-height': $('#b-recommended-by .main-block > .b-item').height()+'px'});
         */
        // do something after all updates are applied
    }

    if ($('.box_category .minus, .box_category .plus').length) {
        $('.box_category .minus, .box_category .plus').on('click', function () {
            $(this).parent('div').find('.collapse').collapse('toggle');
        });
    }

    $('.collapse').on('shown.bs.collapse', function (e) {
        console.log('Show');
        if ($(this).parent('div').find('i.plus')) {
            $(this).parent('div').find('i.plus').removeClass('plus').addClass('minus');
        }
    });
    $('.collapse').on('hidden.bs.collapse', function (e) {
        if ($(this).parent('div').find('i.minus')) {
            $(this).parent('div').find('i.minus').removeClass('minus').addClass('plus');
        }
    });

//    $(document).on('click.bs.collapse.data-api', '[data-toggle="collapse"]', function(e) {
//       var _class = $(this).parent().attr('class');
//       if(_class == 'plus') {
//           $(this).parent('div.plus').attr('class', 'minus'); // removeClass('plus').addClass('minus');
//       } else if(_class == 'minus') {
//           $(this).parent('div.minus').attr('class', 'plus'); //.removeClass('minus').addClass('plus');
//       }
//
//    });

    if ($('.block-child-location-tracking .feature').length) {
        $(window).on("load resize orientationchange", function (a) {
            if ($(this).width() > 992) {
                $('.block-child-location-tracking .feature').each(function (key, item) {
                    $(item).css({"display": "inline-block", 'width': 'auto'});
                    $(item).css({"width": ($(item).width() + 81) + "px"});
                    $(item).css({"display": "block", 'margin': '0 auto'});
                });
            } else {
                $('.block-child-location-tracking .feature').each(function (key, item) {
                    $(item).css({"display": "block", 'margin': '0 auto', 'width': 'auto'});
                });
            }
        });
    }


    // якори для липкого меню
    $('a.anchor-menu-fly').on("click", function (e) {
        e.preventDefault();
        var anchor = $(this).attr('href').split('#');
        if (anchor.length > 1) {
            var _top = $('#' + anchor[1]).offset().top - $('#block-stickybar').height();
            $('html, body').stop().animate({
                scrollTop: _top + 'px'
            }, 1000);
        }

        return false;
    });

    if ($('.buy-form-with-offer').size()) {
        var symbols = {usd: '$', eur: '€', gbp: '£', cad: '$', aud: '$'};

        var updateRadio = function (input) {
            var $form = $(input).closest('form');

            var data = $(input).data();

            var offerEnabled = $form.find('input[type=checkbox][name=android-40off][data-group=' + data.group + ']').is(':checked');
            var $options = $('.buy-form-with-offer').find('input[type=radio][data-group=' + data.group + '][data-period=' + data.period + ']');

            $options.each(function () {
                var optionData = $(this).data();

                $productField = $(this).closest('form').find('input.product_price');

                if (offerEnabled) {
                    $productField.val(optionData.offerProduct);
                } else {
                    $productField.val(optionData.product);
                }

                $(this).closest('ul').find('label')
                        .removeClass('r_on')
                        .addClass('r_off');

                $(this).closest('label')
                        .addClass('r_on')
                        .removeClass('r_off');
            });

            if (typeof data.target != 'undefined') {

                var currentValue = $(input).attr('data-price-' + data.cur) / Number(data.period);

                if (offerEnabled) {
                    currentValue = $(input).attr('data-offer-price-' + data.cur) / Number(data.period);
                }

                var displayValue = (Math.floor(currentValue * 100) / 100).toFixed(2);

                $(data.target).html(displayValue)
                        .prev('div.symbol')
                        .html(symbols[data.cur] ? symbols[data.cur] : '');
            }
        };

        var updateCheckbox = function (input) {
            var data = $(input).data();

            var offerEnabled = $(input).is(":checked");

            var $checkboxes = $('.buy-form-with-offer').find('input[type=checkbox][data-group=' + data.group + ']');

            $checkboxes.each(function () {
                var $form = $(this).closest('form');

                if (offerEnabled) {
                    if (!$(this).is(":checked")) {
                        $(this).prop('checked', offerEnabled);
                    }

                    $('.wr_pack_' + data.group).hide();
                    $('.wr_pack_double_' + data.group).show();
                    $form.find('.offer_old_price').show();
                    $form.find('.package_price').hide();
                    $form.find('.package_offer_price').show();
                } else {
                    if ($(this).is(":checked")) {
                        $(this).prop('checked', offerEnabled);
                    }

                    $('.wr_pack_double_' + data.group).hide();
                    $('.wr_pack_' + data.group).show();
                    $form.find('.offer_old_price').hide();
                    $form.find('.package_offer_price').hide();
                    $form.find('.package_price').show();
                }
            });

            $(input).closest('form').find('input[type=radio]:checked').each(function () {
                updateRadio(this);
            });
        };

        $('.buy-form-with-offer input[type=radio]:checked').each(function () {
            updateRadio(this);
        });

        $('.buy-form-with-offer label').has('input[type=radio]').click(function (e) {
            if (e.target.tagName != 'INPUT') {
                return;
            }

            $input = $(this).find('input:first');
            updateRadio($input);
        });

        $('.buy-form-with-offer input[type=checkbox]').change(function(){
            updateCheckbox(this);
        });
    } else if ($('.buy-form').size()) {
        var symbols = {usd: '$', eur: '€', gbp: '£', cad: '$', aud: '$'};

        var updateRadio = function (input) {
            var data = $(input).data();

            var $inputs = $('.buy-form').find('input[data-period=' + data.period + '][data-group=' + data.group + ']');

            $inputs.each(function () {
                $productField = $(this).closest('form').find('input.product_price');

                $productField.val($(this).val());

                $(this).closest('ul').find('label')
                        .removeClass('r_on')
                        .addClass('r_off');

                $(this).closest('label')
                        .addClass('r_on')
                        .removeClass('r_off');
            });

            if (typeof data.target != 'undefined') {
                var currentValue = $(input).attr('data-price-' + data.cur) / Number(data.period);

                currentValue = (Math.floor(currentValue * 100) / 100).toFixed(2);

                $(data.target).html(currentValue)
                        .prev('div.symbol')
                        .html(symbols[data.cur] ? symbols[data.cur] : '');
            }
        };

        $('.buy-form input:checked').each(function () {
            updateRadio(this);
        });

        $('.buy-form label').click(function (e) {
            if (e.target.tagName != 'INPUT') {
                return;
            }

            updateRadio($(this).find('input:first'));
        });
    }
    $("input[data-checkboxes=android-40off-main]").click(function(){
        $('input[name=android-40off]').attr('checked', this.checked);
        // if($("input[name=android-40off]").length == $("input[name=android-40off]:checked").length) {
        //     $("input[name=android-40off]").attr("checked", "checked");
        // } else {
        //     $("input[name=android-40off]").removeAttr("checked");
        // }
        var $inputs = $("input[name=android-40off]")
        //console.log($inputs)
        $.each($inputs, function() {updateCheckbox(this)})
    });
	
	//sticky header

});

/*
 * jQuery hashchange event - v1.3 - 7/21/2010
 * http://benalman.com/projects/jquery-hashchange-plugin/
 * 
 * Copyright (c) 2010 "Cowboy" Ben Alman
 * Dual licensed under the MIT and GPL licenses.
 * http://benalman.com/about/license/
 */
(function($,e,b){var c="hashchange",h=document,f,g=$.event.special,i=h.documentMode,d="on"+c in e&&(i===b||i>7);function a(j){j=j||location.href;return"#"+j.replace(/^[^#]*#?(.*)$/,"$1")}$.fn[c]=function(j){return j?this.bind(c,j):this.trigger(c)};$.fn[c].delay=50;g[c]=$.extend(g[c],{setup:function(){if(d){return false}$(f.start)},teardown:function(){if(d){return false}$(f.stop)}});f=(function(){var j={},p,m=a(),k=function(q){return q},l=k,o=k;j.start=function(){p||n()};j.stop=function(){p&&clearTimeout(p);p=b};function n(){var r=a(),q=o(m);if(r!==m){l(m=r,q);$(e).trigger(c)}else{if(q!==m){location.href=location.href.replace(/#.*/,"")+q}}p=setTimeout(n,$.fn[c].delay)}$.support.msie&&!d&&(function(){var q,r;j.start=function(){if(!q){r=$.fn[c].src;r=r&&r+a();q=$('<iframe tabindex="-1" title="empty"/>').hide().one("load",function(){r||l(a());n()}).attr("src",r||"javascript:0").insertAfter("body")[0].contentWindow;h.onpropertychange=function(){try{if(event.propertyName==="title"){q.document.title=h.title}}catch(s){}}}};j.stop=k;o=function(){return a(q.location.href)};l=function(v,s){var u=q.document,t=$.fn[c].domain;if(v!==s){u.title=h.title;u.open();t&&u.write('<script>document.domain="'+t+'"<\/script>');u.close();q.location.hash=v}}})();return j})()})(jQuery,this);
/*!
 * jQuery Cookie Plugin v1.3.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2013 Klaus Hartl
 * Released under the MIT license
 */
(function (factory) {
	if (typeof define === 'function' && define.amd) {
		// AMD. Register as anonymous module.
		define(['jquery'], factory);
	} else {
		// Browser globals.
		factory(jQuery);
	}
}(function ($) {

	var pluses = /\+/g;

	function raw(s) {
		return s;
	}

	function decoded(s) {
		return decodeURIComponent(s.replace(pluses, ' '));
	}

	function converted(s) {
		if (s.indexOf('"') === 0) {
			// This is a quoted cookie as according to RFC2068, unescape
			s = s.slice(1, -1).replace(/\\"/g, '"').replace(/\\\\/g, '\\');
		}
		try {
			return config.json ? JSON.parse(s) : s;
		} catch(er) {}
	}

	var config = $.cookie = function (key, value, options) {

		// write
		if (value !== undefined) {
			options = $.extend({}, config.defaults, options);

			if (typeof options.expires === 'number') {
				var days = options.expires, t = options.expires = new Date();
				t.setDate(t.getDate() + days);
			}

			value = config.json ? JSON.stringify(value) : String(value);

			return (document.cookie = [
				config.raw ? key : encodeURIComponent(key),
				'=',
				config.raw ? value : encodeURIComponent(value),
				options.expires ? '; expires=' + options.expires.toUTCString() : '', // use expires attribute, max-age is not supported by IE
				options.path    ? '; path=' + options.path : '',
				options.domain  ? '; domain=' + options.domain : '',
				options.secure  ? '; secure' : ''
			].join(''));
		}

		// read
		var decode = config.raw ? raw : decoded;
		var cookies = document.cookie.split('; ');
		var result = key ? undefined : {};
		for (var i = 0, l = cookies.length; i < l; i++) {
			var parts = cookies[i].split('=');
			var name = decode(parts.shift());
			var cookie = decode(parts.join('='));

			if (key && key === name) {
				result = converted(cookie);
				break;
			}

			if (!key) {
				result[name] = converted(cookie);
			}
		}

		return result;
	};

	config.defaults = {};

	$.removeCookie = function (key, options) {
		if ($.cookie(key) !== undefined) {
			// Must not alter options, thus extending a fresh object...
			$.cookie(key, '', $.extend({}, options, { expires: -1 }));
			return true;
		}
		return false;
	};

}));

//http://stackoverflow.com/questions/12214654/jquery-1-8-find-event-handlers
//http://james.padolsey.com/javascript/debug-jquery-events-with-listhandlers/
// $('*').listHandlers('*');
// $('a').listHandlers('onclick');
$(document).ready(function(){
    $.fn.listHandlers = function(events) {
        this.each(function(i){
            var elem = this,
            // dEvents = $(this).data('events');
            dEvents = $._data($(this).get(0), "events");
            if (!dEvents) {return;}
            $.each(dEvents, function(name, handler){
                if((new RegExp('^(' + (events === '*' ? '.+' : events.replace(',','|').replace(/^on/i,'')) + ')$' ,'i')).test(name)) {
                    $.each(handler,
                        function(i,handler){
                        //console.info(elem);
                        console.info(elem, '\n' + i + ': [' + name + '] : ' + handler.handler );
                    });
                }
            });
        });
    };
    
    $.fn.hasHandlers = function(events,selector) {
        var result=false;
        this.each(function(i){
            var elem = this;
            dEvents = $._data($(this).get(0), "events");
            if (!dEvents) {return false;}
            $.each(dEvents, function(name, handler){
                if((new RegExp('^(' + (events === '*' ? '.+' : events.replace(',','|').replace(/^on/i,'')) + ')$' ,'i')).test(name)) {
                $.each(handler,
                    function(i,handler){
                        if (handler.selector===selector)
                        result=true;
                });
            }
            });
        });
        return result;
    };
}); 
/**
* jquery.matchHeight-min.js master
* http://brm.io/jquery-match-height/
* License: MIT
*/
(function(c){var n=-1,f=-1,g=function(a){return parseFloat(a)||0},r=function(a){var b=null,d=[];c(a).each(function(){var a=c(this),k=a.offset().top-g(a.css("margin-top")),l=0<d.length?d[d.length-1]:null;null===l?d.push(a):1>=Math.floor(Math.abs(b-k))?d[d.length-1]=l.add(a):d.push(a);b=k});return d},p=function(a){var b={byRow:!0,property:"height",target:null,remove:!1};if("object"===typeof a)return c.extend(b,a);"boolean"===typeof a?b.byRow=a:"remove"===a&&(b.remove=!0);return b},b=c.fn.matchHeight=
function(a){a=p(a);if(a.remove){var e=this;this.css(a.property,"");c.each(b._groups,function(a,b){b.elements=b.elements.not(e)});return this}if(1>=this.length&&!a.target)return this;b._groups.push({elements:this,options:a});b._apply(this,a);return this};b._groups=[];b._throttle=80;b._maintainScroll=!1;b._beforeUpdate=null;b._afterUpdate=null;b._apply=function(a,e){var d=p(e),h=c(a),k=[h],l=c(window).scrollTop(),f=c("html").outerHeight(!0),m=h.parents().filter(":hidden");m.each(function(){var a=c(this);
a.data("style-cache",a.attr("style"))});m.css("display","block");d.byRow&&!d.target&&(h.each(function(){var a=c(this),b=a.css("display");"inline-block"!==b&&"inline-flex"!==b&&(b="block");a.data("style-cache",a.attr("style"));a.css({display:b,"padding-top":"0","padding-bottom":"0","margin-top":"0","margin-bottom":"0","border-top-width":"0","border-bottom-width":"0",height:"100px"})}),k=r(h),h.each(function(){var a=c(this);a.attr("style",a.data("style-cache")||"")}));c.each(k,function(a,b){var e=c(b),
f=0;if(d.target)f=d.target.outerHeight(!1);else{if(d.byRow&&1>=e.length){e.css(d.property,"");return}e.each(function(){var a=c(this),b=a.css("display");"inline-block"!==b&&"inline-flex"!==b&&(b="block");b={display:b};b[d.property]="";a.css(b);a.outerHeight(!1)>f&&(f=a.outerHeight(!1));a.css("display","")})}e.each(function(){var a=c(this),b=0;d.target&&a.is(d.target)||("border-box"!==a.css("box-sizing")&&(b+=g(a.css("border-top-width"))+g(a.css("border-bottom-width")),b+=g(a.css("padding-top"))+g(a.css("padding-bottom"))),
a.css(d.property,f-b+"px"))})});m.each(function(){var a=c(this);a.attr("style",a.data("style-cache")||null)});b._maintainScroll&&c(window).scrollTop(l/f*c("html").outerHeight(!0));return this};b._applyDataApi=function(){var a={};c("[data-match-height], [data-mh]").each(function(){var b=c(this),d=b.attr("data-mh")||b.attr("data-match-height");a[d]=d in a?a[d].add(b):b});c.each(a,function(){this.matchHeight(!0)})};var q=function(a){b._beforeUpdate&&b._beforeUpdate(a,b._groups);c.each(b._groups,function(){b._apply(this.elements,
this.options)});b._afterUpdate&&b._afterUpdate(a,b._groups)};b._update=function(a,e){if(e&&"resize"===e.type){var d=c(window).width();if(d===n)return;n=d}a?-1===f&&(f=setTimeout(function(){q(e);f=-1},b._throttle)):q(e)};c(b._applyDataApi);c(window).bind("load",function(a){b._update(!1,a)});c(window).bind("resize orientationchange",function(a){b._update(!0,a)})})(jQuery);
/**
* simplePagination.js v1.6
* A simple jQuery pagination plugin.
* http://flaviusmatis.github.com/simplePagination.js/
*
* Copyright 2012, Flavius Matis
* Released under the MIT license.
* http://flaviusmatis.github.com/license.html
*/

(function($){

	var methods = {
		init: function(options) {
			var o = $.extend({
				items: 1,
				itemsOnPage: 1,
				pages: 0,
				displayedPages: 5,
				edges: 2,
				currentPage: 0,
				hrefTextPrefix: '#page=',
				hrefTextSuffix: '',
				prevText: 'Prev',
				nextText: 'Next',
				ellipseText: '&hellip;',
				cssStyle: 'light-theme',
				labelMap: [],
				selectOnClick: true,
				nextAtFront: false,
				invertPageOrder: false,
				useStartEdge : true,
				useEndEdge : true,
				onPageClick: function(pageNumber, event) {
					// Callback triggered when a page is clicked
					// Page number is given as an optional parameter
				},
				onInit: function() {
					// Callback triggered immediately after initialization
				}
			}, options || {});

			var self = this;

			o.pages = o.pages ? o.pages : Math.ceil(o.items / o.itemsOnPage) ? Math.ceil(o.items / o.itemsOnPage) : 1;
			if (o.currentPage)
				o.currentPage = o.currentPage - 1;
			else
				o.currentPage = !o.invertPageOrder ? 0 : o.pages - 1;
			o.halfDisplayed = o.displayedPages / 2;

			this.each(function() {
				self.addClass(o.cssStyle + ' simple-pagination').data('pagination', o);
				methods._draw.call(self);
			});

			o.onInit();

			return this;
		},

		selectPage: function(page) {
			methods._selectPage.call(this, page - 1);
			return this;
		},

		prevPage: function() {
			var o = this.data('pagination');
			if (!o.invertPageOrder) {
				if (o.currentPage > 0) {
					methods._selectPage.call(this, o.currentPage - 1);
				}
			} else {
				if (o.currentPage < o.pages - 1) {
					methods._selectPage.call(this, o.currentPage + 1);
				}
			}
			return this;
		},

		nextPage: function() {
			var o = this.data('pagination');
			if (!o.invertPageOrder) {
				if (o.currentPage < o.pages - 1) {
					methods._selectPage.call(this, o.currentPage + 1);
				}
			} else {
				if (o.currentPage > 0) {
					methods._selectPage.call(this, o.currentPage - 1);
				}
			}
			return this;
		},

		getPagesCount: function() {
			return this.data('pagination').pages;
		},

		getCurrentPage: function () {
			return this.data('pagination').currentPage + 1;
		},

		destroy: function(){
			this.empty();
			return this;
		},

		drawPage: function (page) {
			var o = this.data('pagination');
			o.currentPage = page - 1;
			this.data('pagination', o);
			methods._draw.call(this);
			return this;
		},

		redraw: function(){
			methods._draw.call(this);
			return this;
		},

		disable: function(){
			var o = this.data('pagination');
			o.disabled = true;
			this.data('pagination', o);
			methods._draw.call(this);
			return this;
		},

		enable: function(){
			var o = this.data('pagination');
			o.disabled = false;
			this.data('pagination', o);
			methods._draw.call(this);
			return this;
		},

		updateItems: function (newItems) {
			var o = this.data('pagination');
			o.items = newItems;
			o.pages = methods._getPages(o);
			this.data('pagination', o);
			methods._draw.call(this);
		},

		updateItemsOnPage: function (itemsOnPage) {
			var o = this.data('pagination');
			o.itemsOnPage = itemsOnPage;
			o.pages = methods._getPages(o);
			this.data('pagination', o);
			methods._selectPage.call(this, 0);
			return this;
		},

		_draw: function() {
			var	o = this.data('pagination'),
				interval = methods._getInterval(o),
				i,
				tagName;

			methods.destroy.call(this);
			
			tagName = (typeof this.prop === 'function') ? this.prop('tagName') : this.attr('tagName');

			var $panel = tagName === 'UL' ? this : $('<ul class="pagination"></ul>').appendTo(this);

			// Generate Prev link
			if (o.prevText) {
				methods._appendItem.call(this, !o.invertPageOrder ? o.currentPage - 1 : o.currentPage + 1, {text: o.prevText, classes: 'prev'});
			}

			// Generate Next link (if option set for at front)
			if (o.nextText && o.nextAtFront) {
				methods._appendItem.call(this, !o.invertPageOrder ? o.currentPage + 1 : o.currentPage - 1, {text: o.nextText, classes: 'next'});
			}

			// Generate start edges
			if (!o.invertPageOrder) {
				if (interval.start > 0 && o.edges > 0) {
					if(o.useStartEdge) {
						var end = Math.min(o.edges, interval.start);
						for (i = 0; i < end; i++) {
							methods._appendItem.call(this, i);
						}
					}
					if (o.edges < interval.start && (interval.start - o.edges != 1)) {
						$panel.append('<li class="disabled"><span class="ellipse">' + o.ellipseText + '</span></li>');
					} else if (interval.start - o.edges == 1) {
						methods._appendItem.call(this, o.edges);
					}
				}
			} else {
				if (interval.end < o.pages && o.edges > 0) {
					if(o.useStartEdge) {
						var begin = Math.max(o.pages - o.edges, interval.end);
						for (i = o.pages - 1; i >= begin; i--) {
							methods._appendItem.call(this, i);
						}
					}

					if (o.pages - o.edges > interval.end && (o.pages - o.edges - interval.end != 1)) {
						$panel.append('<li class="disabled"><span class="ellipse">' + o.ellipseText + '</span></li>');
					} else if (o.pages - o.edges - interval.end == 1) {
						methods._appendItem.call(this, interval.end);
					}
				}
			}

			// Generate interval links
			if (!o.invertPageOrder) {
				for (i = interval.start; i < interval.end; i++) {
					methods._appendItem.call(this, i);
				}
			} else {
				for (i = interval.end - 1; i >= interval.start; i--) {
					methods._appendItem.call(this, i);
				}
			}

			// Generate end edges
			if (!o.invertPageOrder) {
				if (interval.end < o.pages && o.edges > 0) {
					if (o.pages - o.edges > interval.end && (o.pages - o.edges - interval.end != 1)) {
						$panel.append('<li class="disabled"><span class="ellipse">' + o.ellipseText + '</span></li>');
					} else if (o.pages - o.edges - interval.end == 1) {
						methods._appendItem.call(this, interval.end);
					}
					if(o.useEndEdge) {
						var begin = Math.max(o.pages - o.edges, interval.end);
						for (i = begin; i < o.pages; i++) {
							methods._appendItem.call(this, i);
						}
					}
				}
			} else {
				if (interval.start > 0 && o.edges > 0) {
					if (o.edges < interval.start && (interval.start - o.edges != 1)) {
						$panel.append('<li class="disabled"><span class="ellipse">' + o.ellipseText + '</span></li>');
					} else if (interval.start - o.edges == 1) {
						methods._appendItem.call(this, o.edges);
					}

					if(o.useEndEdge) {
						var end = Math.min(o.edges, interval.start);
						for (i = end - 1; i >= 0; i--) {
							methods._appendItem.call(this, i);
						}
					}
				}
			}

			// Generate Next link (unless option is set for at front)
			if (o.nextText && !o.nextAtFront) {
				methods._appendItem.call(this, !o.invertPageOrder ? o.currentPage + 1 : o.currentPage - 1, {text: o.nextText, classes: 'next'});
			}
		},

		_getPages: function(o) {
			var pages = Math.ceil(o.items / o.itemsOnPage);
			return pages || 1;
		},

		_getInterval: function(o) {
			return {
				start: Math.ceil(o.currentPage > o.halfDisplayed ? Math.max(Math.min(o.currentPage - o.halfDisplayed, (o.pages - o.displayedPages)), 0) : 0),
				end: Math.ceil(o.currentPage > o.halfDisplayed ? Math.min(o.currentPage + o.halfDisplayed, o.pages) : Math.min(o.displayedPages, o.pages))
			};
		},

		_appendItem: function(pageIndex, opts) {
			var self = this, options, $link, o = self.data('pagination'), $linkWrapper = $('<li></li>'), $ul = self.find('ul');

			pageIndex = pageIndex < 0 ? 0 : (pageIndex < o.pages ? pageIndex : o.pages - 1);

			options = {
				text: pageIndex + 1,
				classes: ''
			};

			if (o.labelMap.length && o.labelMap[pageIndex]) {
				options.text = o.labelMap[pageIndex];
			}

			options = $.extend(options, opts || {});

			if (pageIndex == o.currentPage || o.disabled) {
				if (o.disabled) {
					$linkWrapper.addClass('disabled');
				} else {
					$linkWrapper.addClass('active');
				}
				$link = $('<span class="current">' + (options.text) + '</span>');
			} else {
				$link = $('<a href="' + o.hrefTextPrefix + (pageIndex + 1) + o.hrefTextSuffix + '" class="page-link">' + (options.text) + '</a>');
				$link.click(function(event){
					return methods._selectPage.call(self, pageIndex, event);
				});
			}

			if (options.classes) {
				$link.addClass(options.classes);
			}

			$linkWrapper.append($link);

			if ($ul.length) {
				$ul.append($linkWrapper);
			} else {
				self.append($linkWrapper);
			}
		},

		_selectPage: function(pageIndex, event) {
			var o = this.data('pagination');
			o.currentPage = pageIndex;
			if (o.selectOnClick) {
				methods._draw.call(this);
			}
			return o.onPageClick(pageIndex + 1, event);
		}

	};

	$.fn.pagination = function(method) {

		// Method calling logic
		if (methods[method] && method.charAt(0) != '_') {
			return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
		} else if (typeof method === 'object' || !method) {
			return methods.init.apply(this, arguments);
		} else {
			$.error('Method ' +  method + ' does not exist on jQuery.pagination');
		}

	};

})(jQuery);

/*
 * TotalStorage
 *
 * Copyright (c) 2012 Jared Novack & Upstatement (upstatement.com)
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 * Total Storage is the conceptual the love child of jStorage by Andris Reinman, 
 * and Cookie by Klaus Hartl -- though this is not connected to either project.
 *
 * @name $.totalStorage
 * @cat Plugins/Cookie
 * @author Jared Novack/jared@upstatement.com
 * @version 1.1.2
 * @url http://upstatement.com/blog/2012/01/jquery-local-storage-done-right-and-easy/
 */

(function(c){var e=window.localStorage,f;f="undefined"==typeof e||"undefined"==typeof window.JSON?!1:!0;c.totalStorage=function(b,a){return c.totalStorage.impl.init(b,a)};c.totalStorage.setItem=function(b,a){return c.totalStorage.impl.setItem(b,a)};c.totalStorage.getItem=function(b){return c.totalStorage.impl.getItem(b)};c.totalStorage.getAll=function(){return c.totalStorage.impl.getAll()};c.totalStorage.deleteItem=function(b){return c.totalStorage.impl.deleteItem(b)};c.totalStorage.impl={init:function(b, a){return"undefined"!=typeof a?this.setItem(b,a):this.getItem(b)},setItem:function(b,a){if(!f)try{return c.cookie(b,a),a}catch(d){console.log("Local Storage not supported by this browser. Install the cookie plugin on your site to take advantage of the same functionality. You can get it at https://github.com/carhartl/jquery-cookie")}var g=JSON.stringify(a);e.setItem(b,g);return this.parseResult(g)},getItem:function(b){if(!f)try{return this.parseResult(c.cookie(b))}catch(a){return null}return this.parseResult(e.getItem(b))}, deleteItem:function(b){if(!f)try{return c.cookie(b,null),!0}catch(a){return!1}e.removeItem(b);return!0},getAll:function(){var b=[];if(f)for(d in e)d.length&&b.push({key:d,value:this.parseResult(e.getItem(d))});else try{for(var a=document.cookie.split(";"),d=0;d<a.length;d++){var g=a[d].split("=")[0];b.push({key:g,value:this.parseResult(c.cookie(g))})}}catch(h){return null}return b},parseResult:function(b){var a;try{a=JSON.parse(b),"true"==a&&(a=!0),"false"==a&&(a=!1),parseFloat(a)==a&&"object"!=typeof a&& (a=parseFloat(a))}catch(c){}return a}}})(jQuery);
/*!
 * jQuery Validation Plugin v1.13.1
 *
 * http://jqueryvalidation.org/
 *
 * Copyright (c) 2014 Jörn Zaefferer
 * Released under the MIT license
 */
(function( factory ) {
	if ( typeof define === "function" && define.amd ) {
		define( ["jquery"], factory );
	} else {
		factory( jQuery );
	}
}(function( $ ) {

$.extend($.fn, {
	// http://jqueryvalidation.org/validate/
	validate: function( options ) {

		// if nothing is selected, return nothing; can't chain anyway
		if ( !this.length ) {
			if ( options && options.debug && window.console ) {
				console.warn( "Nothing selected, can't validate, returning nothing." );
			}
			return;
		}

		// check if a validator for this form was already created
		var validator = $.data( this[ 0 ], "validator" );
		if ( validator ) {
			return validator;
		}

		// Add novalidate tag if HTML5.
		this.attr( "novalidate", "novalidate" );

		validator = new $.validator( options, this[ 0 ] );
		$.data( this[ 0 ], "validator", validator );

		if ( validator.settings.onsubmit ) {

			this.validateDelegate( ":submit", "click", function( event ) {
				if ( validator.settings.submitHandler ) {
					validator.submitButton = event.target;
				}
				// allow suppressing validation by adding a cancel class to the submit button
				if ( $( event.target ).hasClass( "cancel" ) ) {
					validator.cancelSubmit = true;
				}

				// allow suppressing validation by adding the html5 formnovalidate attribute to the submit button
				if ( $( event.target ).attr( "formnovalidate" ) !== undefined ) {
					validator.cancelSubmit = true;
				}
			});

			// validate the form on submit
			this.submit( function( event ) {
				if ( validator.settings.debug ) {
					// prevent form submit to be able to see console output
					event.preventDefault();
				}
				function handle() {
					var hidden, result;
					if ( validator.settings.submitHandler ) {
						if ( validator.submitButton ) {
							// insert a hidden input as a replacement for the missing submit button
							hidden = $( "<input type='hidden'/>" )
								.attr( "name", validator.submitButton.name )
								.val( $( validator.submitButton ).val() )
								.appendTo( validator.currentForm );
						}
						result = validator.settings.submitHandler.call( validator, validator.currentForm, event );
						if ( validator.submitButton ) {
							// and clean up afterwards; thanks to no-block-scope, hidden can be referenced
							hidden.remove();
						}
						if ( result !== undefined ) {
							return result;
						}
						return false;
					}
					return true;
				}

				// prevent submit for invalid forms or custom submit handlers
				if ( validator.cancelSubmit ) {
					validator.cancelSubmit = false;
					return handle();
				}
				if ( validator.form() ) {
					if ( validator.pendingRequest ) {
						validator.formSubmitted = true;
						return false;
					}
					return handle();
				} else {
					validator.focusInvalid();
					return false;
				}
			});
		}

		return validator;
	},
	// http://jqueryvalidation.org/valid/
	valid: function() {
		var valid, validator;

		if ( $( this[ 0 ] ).is( "form" ) ) {
			valid = this.validate().form();
		} else {
			valid = true;
			validator = $( this[ 0 ].form ).validate();
			this.each( function() {
				valid = validator.element( this ) && valid;
			});
		}
		return valid;
	},
	// attributes: space separated list of attributes to retrieve and remove
	removeAttrs: function( attributes ) {
		var result = {},
			$element = this;
		$.each( attributes.split( /\s/ ), function( index, value ) {
			result[ value ] = $element.attr( value );
			$element.removeAttr( value );
		});
		return result;
	},
	// http://jqueryvalidation.org/rules/
	rules: function( command, argument ) {
		var element = this[ 0 ],
			settings, staticRules, existingRules, data, param, filtered;

		if ( command ) {
			settings = $.data( element.form, "validator" ).settings;
			staticRules = settings.rules;
			existingRules = $.validator.staticRules( element );
			switch ( command ) {
			case "add":
				$.extend( existingRules, $.validator.normalizeRule( argument ) );
				// remove messages from rules, but allow them to be set separately
				delete existingRules.messages;
				staticRules[ element.name ] = existingRules;
				if ( argument.messages ) {
					settings.messages[ element.name ] = $.extend( settings.messages[ element.name ], argument.messages );
				}
				break;
			case "remove":
				if ( !argument ) {
					delete staticRules[ element.name ];
					return existingRules;
				}
				filtered = {};
				$.each( argument.split( /\s/ ), function( index, method ) {
					filtered[ method ] = existingRules[ method ];
					delete existingRules[ method ];
					if ( method === "required" ) {
						$( element ).removeAttr( "aria-required" );
					}
				});
				return filtered;
			}
		}

		data = $.validator.normalizeRules(
		$.extend(
			{},
			$.validator.classRules( element ),
			$.validator.attributeRules( element ),
			$.validator.dataRules( element ),
			$.validator.staticRules( element )
		), element );

		// make sure required is at front
		if ( data.required ) {
			param = data.required;
			delete data.required;
			data = $.extend( { required: param }, data );
			$( element ).attr( "aria-required", "true" );
		}

		// make sure remote is at back
		if ( data.remote ) {
			param = data.remote;
			delete data.remote;
			data = $.extend( data, { remote: param });
		}

		return data;
	}
});

// Custom selectors
$.extend( $.expr[ ":" ], {
	// http://jqueryvalidation.org/blank-selector/
	blank: function( a ) {
		return !$.trim( "" + $( a ).val() );
	},
	// http://jqueryvalidation.org/filled-selector/
	filled: function( a ) {
		return !!$.trim( "" + $( a ).val() );
	},
	// http://jqueryvalidation.org/unchecked-selector/
	unchecked: function( a ) {
		return !$( a ).prop( "checked" );
	}
});

// constructor for validator
$.validator = function( options, form ) {
	this.settings = $.extend( true, {}, $.validator.defaults, options );
	this.currentForm = form;
	this.init();
};

// http://jqueryvalidation.org/jQuery.validator.format/
$.validator.format = function( source, params ) {
	if ( arguments.length === 1 ) {
		return function() {
			var args = $.makeArray( arguments );
			args.unshift( source );
			return $.validator.format.apply( this, args );
		};
	}
	if ( arguments.length > 2 && params.constructor !== Array  ) {
		params = $.makeArray( arguments ).slice( 1 );
	}
	if ( params.constructor !== Array ) {
		params = [ params ];
	}
	$.each( params, function( i, n ) {
		source = source.replace( new RegExp( "\\{" + i + "\\}", "g" ), function() {
			return n;
		});
	});
	return source;
};

$.extend( $.validator, {

	defaults: {
		messages: {},
		groups: {},
		rules: {},
		errorClass: "error",
		validClass: "valid",
		errorElement: "label",
		focusCleanup: false,
		focusInvalid: true,
		errorContainer: $( [] ),
		errorLabelContainer: $( [] ),
		onsubmit: true,
		ignore: ":hidden",
		ignoreTitle: false,
		onfocusin: function( element ) {
			this.lastActive = element;

			// Hide error label and remove error class on focus if enabled
			if ( this.settings.focusCleanup ) {
				if ( this.settings.unhighlight ) {
					this.settings.unhighlight.call( this, element, this.settings.errorClass, this.settings.validClass );
				}
				this.hideThese( this.errorsFor( element ) );
			}
		},
		onfocusout: function( element ) {
			if ( !this.checkable( element ) && ( element.name in this.submitted || !this.optional( element ) ) ) {
				this.element( element );
			}
		},
		onkeyup: function( element, event ) {
			if ( event.which === 9 && this.elementValue( element ) === "" ) {
				return;
			} else if ( element.name in this.submitted || element === this.lastElement ) {
				this.element( element );
			}
		},
		onclick: function( element ) {
			// click on selects, radiobuttons and checkboxes
			if ( element.name in this.submitted ) {
				this.element( element );

			// or option elements, check parent select in that case
			} else if ( element.parentNode.name in this.submitted ) {
				this.element( element.parentNode );
			}
		},
		highlight: function( element, errorClass, validClass ) {
			if ( element.type === "radio" ) {
				this.findByName( element.name ).addClass( errorClass ).removeClass( validClass );
			} else {
				$( element ).addClass( errorClass ).removeClass( validClass );
			}
		},
		unhighlight: function( element, errorClass, validClass ) {
			if ( element.type === "radio" ) {
				this.findByName( element.name ).removeClass( errorClass ).addClass( validClass );
			} else {
				$( element ).removeClass( errorClass ).addClass( validClass );
			}
		}
	},

	// http://jqueryvalidation.org/jQuery.validator.setDefaults/
	setDefaults: function( settings ) {
		$.extend( $.validator.defaults, settings );
	},

	messages: {
		required: "This field is required.",
		remote: "Please fix this field.",
		email: "Please enter a valid email address.",
		url: "Please enter a valid URL.",
		date: "Please enter a valid date.",
		dateISO: "Please enter a valid date ( ISO ).",
		number: "Please enter a valid number.",
		digits: "Please enter only digits.",
		creditcard: "Please enter a valid credit card number.",
		equalTo: "Please enter the same value again.",
		maxlength: $.validator.format( "Please enter no more than {0} characters." ),
		minlength: $.validator.format( "Please enter at least {0} characters." ),
		rangelength: $.validator.format( "Please enter a value between {0} and {1} characters long." ),
		range: $.validator.format( "Please enter a value between {0} and {1}." ),
		max: $.validator.format( "Please enter a value less than or equal to {0}." ),
		min: $.validator.format( "Please enter a value greater than or equal to {0}." )
	},

	autoCreateRanges: false,

	prototype: {

		init: function() {
			this.labelContainer = $( this.settings.errorLabelContainer );
			this.errorContext = this.labelContainer.length && this.labelContainer || $( this.currentForm );
			this.containers = $( this.settings.errorContainer ).add( this.settings.errorLabelContainer );
			this.submitted = {};
			this.valueCache = {};
			this.pendingRequest = 0;
			this.pending = {};
			this.invalid = {};
			this.reset();

			var groups = ( this.groups = {} ),
				rules;
			$.each( this.settings.groups, function( key, value ) {
				if ( typeof value === "string" ) {
					value = value.split( /\s/ );
				}
				$.each( value, function( index, name ) {
					groups[ name ] = key;
				});
			});
			rules = this.settings.rules;
			$.each( rules, function( key, value ) {
				rules[ key ] = $.validator.normalizeRule( value );
			});

			function delegate( event ) {
				var validator = $.data( this[ 0 ].form, "validator" ),
					eventType = "on" + event.type.replace( /^validate/, "" ),
					settings = validator.settings;
				if ( settings[ eventType ] && !this.is( settings.ignore ) ) {
					settings[ eventType ].call( validator, this[ 0 ], event );
				}
			}
			$( this.currentForm )
				.validateDelegate( ":text, [type='password'], [type='file'], select, textarea, " +
					"[type='number'], [type='search'] ,[type='tel'], [type='url'], " +
					"[type='email'], [type='datetime'], [type='date'], [type='month'], " +
					"[type='week'], [type='time'], [type='datetime-local'], " +
					"[type='range'], [type='color'], [type='radio'], [type='checkbox']",
					"focusin focusout keyup", delegate)
				// Support: Chrome, oldIE
				// "select" is provided as event.target when clicking a option
				.validateDelegate("select, option, [type='radio'], [type='checkbox']", "click", delegate);

			if ( this.settings.invalidHandler ) {
				$( this.currentForm ).bind( "invalid-form.validate", this.settings.invalidHandler );
			}

			// Add aria-required to any Static/Data/Class required fields before first validation
			// Screen readers require this attribute to be present before the initial submission http://www.w3.org/TR/WCAG-TECHS/ARIA2.html
			$( this.currentForm ).find( "[required], [data-rule-required], .required" ).attr( "aria-required", "true" );
		},

		// http://jqueryvalidation.org/Validator.form/
		form: function() {
			this.checkForm();
			$.extend( this.submitted, this.errorMap );
			this.invalid = $.extend({}, this.errorMap );
			if ( !this.valid() ) {
				$( this.currentForm ).triggerHandler( "invalid-form", [ this ]);
			}
			this.showErrors();
			return this.valid();
		},

		checkForm: function() {
			this.prepareForm();
			for ( var i = 0, elements = ( this.currentElements = this.elements() ); elements[ i ]; i++ ) {
				this.check( elements[ i ] );
			}
			return this.valid();
		},

		// http://jqueryvalidation.org/Validator.element/
		element: function( element ) {
			var cleanElement = this.clean( element ),
				checkElement = this.validationTargetFor( cleanElement ),
				result = true;

			this.lastElement = checkElement;

			if ( checkElement === undefined ) {
				delete this.invalid[ cleanElement.name ];
			} else {
				this.prepareElement( checkElement );
				this.currentElements = $( checkElement );

				result = this.check( checkElement ) !== false;
				if ( result ) {
					delete this.invalid[ checkElement.name ];
				} else {
					this.invalid[ checkElement.name ] = true;
				}
			}
			// Add aria-invalid status for screen readers
			$( element ).attr( "aria-invalid", !result );

			if ( !this.numberOfInvalids() ) {
				// Hide error containers on last error
				this.toHide = this.toHide.add( this.containers );
			}
			this.showErrors();
			return result;
		},

		// http://jqueryvalidation.org/Validator.showErrors/
		showErrors: function( errors ) {
			if ( errors ) {
				// add items to error list and map
				$.extend( this.errorMap, errors );
				this.errorList = [];
				for ( var name in errors ) {
					this.errorList.push({
						message: errors[ name ],
						element: this.findByName( name )[ 0 ]
					});
				}
				// remove items from success list
				this.successList = $.grep( this.successList, function( element ) {
					return !( element.name in errors );
				});
			}
			if ( this.settings.showErrors ) {
				this.settings.showErrors.call( this, this.errorMap, this.errorList );
			} else {
				this.defaultShowErrors();
			}
		},

		// http://jqueryvalidation.org/Validator.resetForm/
		resetForm: function() {
			if ( $.fn.resetForm ) {
				$( this.currentForm ).resetForm();
			}
			this.submitted = {};
			this.lastElement = null;
			this.prepareForm();
			this.hideErrors();
			this.elements()
					.removeClass( this.settings.errorClass )
					.removeData( "previousValue" )
					.removeAttr( "aria-invalid" );
		},

		numberOfInvalids: function() {
			return this.objectLength( this.invalid );
		},

		objectLength: function( obj ) {
			/* jshint unused: false */
			var count = 0,
				i;
			for ( i in obj ) {
				count++;
			}
			return count;
		},

		hideErrors: function() {
			this.hideThese( this.toHide );
		},

		hideThese: function( errors ) {
			errors.not( this.containers ).text( "" );
			this.addWrapper( errors ).hide();
		},

		valid: function() {
			return this.size() === 0;
		},

		size: function() {
			return this.errorList.length;
		},

		focusInvalid: function() {
			if ( this.settings.focusInvalid ) {
				try {
					$( this.findLastActive() || this.errorList.length && this.errorList[ 0 ].element || [])
					.filter( ":visible" )
					.focus()
					// manually trigger focusin event; without it, focusin handler isn't called, findLastActive won't have anything to find
					.trigger( "focusin" );
				} catch ( e ) {
					// ignore IE throwing errors when focusing hidden elements
				}
			}
		},

		findLastActive: function() {
			var lastActive = this.lastActive;
			return lastActive && $.grep( this.errorList, function( n ) {
				return n.element.name === lastActive.name;
			}).length === 1 && lastActive;
		},

		elements: function() {
			var validator = this,
				rulesCache = {};

			// select all valid inputs inside the form (no submit or reset buttons)
			return $( this.currentForm )
			.find( "input, select, textarea" )
			.not( ":submit, :reset, :image, [disabled], [readonly]" )
			.not( this.settings.ignore )
			.filter( function() {
				if ( !this.name && validator.settings.debug && window.console ) {
					console.error( "%o has no name assigned", this );
				}

				// select only the first element for each name, and only those with rules specified
				if ( this.name in rulesCache || !validator.objectLength( $( this ).rules() ) ) {
					return false;
				}

				rulesCache[ this.name ] = true;
				return true;
			});
		},

		clean: function( selector ) {
			return $( selector )[ 0 ];
		},

		errors: function() {
			var errorClass = this.settings.errorClass.split( " " ).join( "." );
			return $( this.settings.errorElement + "." + errorClass, this.errorContext );
		},

		reset: function() {
			this.successList = [];
			this.errorList = [];
			this.errorMap = {};
			this.toShow = $( [] );
			this.toHide = $( [] );
			this.currentElements = $( [] );
		},

		prepareForm: function() {
			this.reset();
			this.toHide = this.errors().add( this.containers );
		},

		prepareElement: function( element ) {
			this.reset();
			this.toHide = this.errorsFor( element );
		},

		elementValue: function( element ) {
			var val,
				$element = $( element ),
				type = element.type;

			if ( type === "radio" || type === "checkbox" ) {
				return $( "input[name='" + element.name + "']:checked" ).val();
			} else if ( type === "number" && typeof element.validity !== "undefined" ) {
				return element.validity.badInput ? false : $element.val();
			}

			val = $element.val();
			if ( typeof val === "string" ) {
				return val.replace(/\r/g, "" );
			}
			return val;
		},

		check: function( element ) {
			element = this.validationTargetFor( this.clean( element ) );

			var rules = $( element ).rules(),
				rulesCount = $.map( rules, function( n, i ) {
					return i;
				}).length,
				dependencyMismatch = false,
				val = this.elementValue( element ),
				result, method, rule;

			for ( method in rules ) {
				rule = { method: method, parameters: rules[ method ] };
				try {

					result = $.validator.methods[ method ].call( this, val, element, rule.parameters );

					// if a method indicates that the field is optional and therefore valid,
					// don't mark it as valid when there are no other rules
					if ( result === "dependency-mismatch" && rulesCount === 1 ) {
						dependencyMismatch = true;
						continue;
					}
					dependencyMismatch = false;

					if ( result === "pending" ) {
						this.toHide = this.toHide.not( this.errorsFor( element ) );
						return;
					}

					if ( !result ) {
						this.formatAndAdd( element, rule );
						return false;
					}
				} catch ( e ) {
					if ( this.settings.debug && window.console ) {
						console.log( "Exception occurred when checking element " + element.id + ", check the '" + rule.method + "' method.", e );
					}
					throw e;
				}
			}
			if ( dependencyMismatch ) {
				return;
			}
			if ( this.objectLength( rules ) ) {
				this.successList.push( element );
			}
			return true;
		},

		// return the custom message for the given element and validation method
		// specified in the element's HTML5 data attribute
		// return the generic message if present and no method specific message is present
		customDataMessage: function( element, method ) {
			return $( element ).data( "msg" + method.charAt( 0 ).toUpperCase() +
				method.substring( 1 ).toLowerCase() ) || $( element ).data( "msg" );
		},

		// return the custom message for the given element name and validation method
		customMessage: function( name, method ) {
			var m = this.settings.messages[ name ];
			return m && ( m.constructor === String ? m : m[ method ]);
		},

		// return the first defined argument, allowing empty strings
		findDefined: function() {
			for ( var i = 0; i < arguments.length; i++) {
				if ( arguments[ i ] !== undefined ) {
					return arguments[ i ];
				}
			}
			return undefined;
		},

		defaultMessage: function( element, method ) {
			return this.findDefined(
				this.customMessage( element.name, method ),
				this.customDataMessage( element, method ),
				// title is never undefined, so handle empty string as undefined
				!this.settings.ignoreTitle && element.title || undefined,
				$.validator.messages[ method ],
				"<strong>Warning: No message defined for " + element.name + "</strong>"
			);
		},

		formatAndAdd: function( element, rule ) {
			var message = this.defaultMessage( element, rule.method ),
				theregex = /\$?\{(\d+)\}/g;
			if ( typeof message === "function" ) {
				message = message.call( this, rule.parameters, element );
			} else if ( theregex.test( message ) ) {
				message = $.validator.format( message.replace( theregex, "{$1}" ), rule.parameters );
			}
			this.errorList.push({
				message: message,
				element: element,
				method: rule.method
			});

			this.errorMap[ element.name ] = message;
			this.submitted[ element.name ] = message;
		},

		addWrapper: function( toToggle ) {
			if ( this.settings.wrapper ) {
				toToggle = toToggle.add( toToggle.parent( this.settings.wrapper ) );
			}
			return toToggle;
		},

		defaultShowErrors: function() {
			var i, elements, error;
			for ( i = 0; this.errorList[ i ]; i++ ) {
				error = this.errorList[ i ];
				if ( this.settings.highlight ) {
					this.settings.highlight.call( this, error.element, this.settings.errorClass, this.settings.validClass );
				}
				this.showLabel( error.element, error.message );
			}
			if ( this.errorList.length ) {
				this.toShow = this.toShow.add( this.containers );
			}
			if ( this.settings.success ) {
				for ( i = 0; this.successList[ i ]; i++ ) {
					this.showLabel( this.successList[ i ] );
				}
			}
			if ( this.settings.unhighlight ) {
				for ( i = 0, elements = this.validElements(); elements[ i ]; i++ ) {
					this.settings.unhighlight.call( this, elements[ i ], this.settings.errorClass, this.settings.validClass );
				}
			}
			this.toHide = this.toHide.not( this.toShow );
			this.hideErrors();
			this.addWrapper( this.toShow ).show();
		},

		validElements: function() {
			return this.currentElements.not( this.invalidElements() );
		},

		invalidElements: function() {
			return $( this.errorList ).map(function() {
				return this.element;
			});
		},

		showLabel: function( element, message ) {
			var place, group, errorID,
				error = this.errorsFor( element ),
				elementID = this.idOrName( element ),
				describedBy = $( element ).attr( "aria-describedby" );
			if ( error.length ) {
				// refresh error/success class
				error.removeClass( this.settings.validClass ).addClass( this.settings.errorClass );
				// replace message on existing label
				error.html( message );
			} else {
				// create error element
				error = $( "<" + this.settings.errorElement + ">" )
					.attr( "id", elementID + "-error" )
					.addClass( this.settings.errorClass )
					.html( message || "" );

				// Maintain reference to the element to be placed into the DOM
				place = error;
				if ( this.settings.wrapper ) {
					// make sure the element is visible, even in IE
					// actually showing the wrapped element is handled elsewhere
					place = error.hide().show().wrap( "<" + this.settings.wrapper + "/>" ).parent();
				}
				if ( this.labelContainer.length ) {
					this.labelContainer.append( place );
				} else if ( this.settings.errorPlacement ) {
					this.settings.errorPlacement( place, $( element ) );
				} else {
					place.insertAfter( element );
				}

				// Link error back to the element
				if ( error.is( "label" ) ) {
					// If the error is a label, then associate using 'for'
					error.attr( "for", elementID );
				} else if ( error.parents( "label[for='" + elementID + "']" ).length === 0 ) {
					// If the element is not a child of an associated label, then it's necessary
					// to explicitly apply aria-describedby

					errorID = error.attr( "id" ).replace( /(:|\.|\[|\])/g, "\\$1");
					// Respect existing non-error aria-describedby
					if ( !describedBy ) {
						describedBy = errorID;
					} else if ( !describedBy.match( new RegExp( "\\b" + errorID + "\\b" ) ) ) {
						// Add to end of list if not already present
						describedBy += " " + errorID;
					}
					$( element ).attr( "aria-describedby", describedBy );

					// If this element is grouped, then assign to all elements in the same group
					group = this.groups[ element.name ];
					if ( group ) {
						$.each( this.groups, function( name, testgroup ) {
							if ( testgroup === group ) {
								$( "[name='" + name + "']", this.currentForm )
									.attr( "aria-describedby", error.attr( "id" ) );
							}
						});
					}
				}
			}
			if ( !message && this.settings.success ) {
				error.text( "" );
				if ( typeof this.settings.success === "string" ) {
					error.addClass( this.settings.success );
				} else {
					this.settings.success( error, element );
				}
			}
			this.toShow = this.toShow.add( error );
		},

		errorsFor: function( element ) {
			var name = this.idOrName( element ),
				describer = $( element ).attr( "aria-describedby" ),
				selector = "label[for='" + name + "'], label[for='" + name + "'] *";

			// aria-describedby should directly reference the error element
			if ( describer ) {
				selector = selector + ", #" + describer.replace( /\s+/g, ", #" );
			}
			return this
				.errors()
				.filter( selector );
		},

		idOrName: function( element ) {
			return this.groups[ element.name ] || ( this.checkable( element ) ? element.name : element.id || element.name );
		},

		validationTargetFor: function( element ) {

			// If radio/checkbox, validate first element in group instead
			if ( this.checkable( element ) ) {
				element = this.findByName( element.name );
			}

			// Always apply ignore filter
			return $( element ).not( this.settings.ignore )[ 0 ];
		},

		checkable: function( element ) {
			return ( /radio|checkbox/i ).test( element.type );
		},

		findByName: function( name ) {
			return $( this.currentForm ).find( "[name='" + name + "']" );
		},

		getLength: function( value, element ) {
			switch ( element.nodeName.toLowerCase() ) {
			case "select":
				return $( "option:selected", element ).length;
			case "input":
				if ( this.checkable( element ) ) {
					return this.findByName( element.name ).filter( ":checked" ).length;
				}
			}
			return value.length;
		},

		depend: function( param, element ) {
			return this.dependTypes[typeof param] ? this.dependTypes[typeof param]( param, element ) : true;
		},

		dependTypes: {
			"boolean": function( param ) {
				return param;
			},
			"string": function( param, element ) {
				return !!$( param, element.form ).length;
			},
			"function": function( param, element ) {
				return param( element );
			}
		},

		optional: function( element ) {
			var val = this.elementValue( element );
			return !$.validator.methods.required.call( this, val, element ) && "dependency-mismatch";
		},

		startRequest: function( element ) {
			if ( !this.pending[ element.name ] ) {
				this.pendingRequest++;
				this.pending[ element.name ] = true;
			}
		},

		stopRequest: function( element, valid ) {
			this.pendingRequest--;
			// sometimes synchronization fails, make sure pendingRequest is never < 0
			if ( this.pendingRequest < 0 ) {
				this.pendingRequest = 0;
			}
			delete this.pending[ element.name ];
			if ( valid && this.pendingRequest === 0 && this.formSubmitted && this.form() ) {
				$( this.currentForm ).submit();
				this.formSubmitted = false;
			} else if (!valid && this.pendingRequest === 0 && this.formSubmitted ) {
				$( this.currentForm ).triggerHandler( "invalid-form", [ this ]);
				this.formSubmitted = false;
			}
		},

		previousValue: function( element ) {
			return $.data( element, "previousValue" ) || $.data( element, "previousValue", {
				old: null,
				valid: true,
				message: this.defaultMessage( element, "remote" )
			});
		}

	},

	classRuleSettings: {
		required: { required: true },
		email: { email: true },
		url: { url: true },
		date: { date: true },
		dateISO: { dateISO: true },
		number: { number: true },
		digits: { digits: true },
		creditcard: { creditcard: true }
	},

	addClassRules: function( className, rules ) {
		if ( className.constructor === String ) {
			this.classRuleSettings[ className ] = rules;
		} else {
			$.extend( this.classRuleSettings, className );
		}
	},

	classRules: function( element ) {
		var rules = {},
			classes = $( element ).attr( "class" );

		if ( classes ) {
			$.each( classes.split( " " ), function() {
				if ( this in $.validator.classRuleSettings ) {
					$.extend( rules, $.validator.classRuleSettings[ this ]);
				}
			});
		}
		return rules;
	},

	attributeRules: function( element ) {
		var rules = {},
			$element = $( element ),
			type = element.getAttribute( "type" ),
			method, value;

		for ( method in $.validator.methods ) {

			// support for <input required> in both html5 and older browsers
			if ( method === "required" ) {
				value = element.getAttribute( method );
				// Some browsers return an empty string for the required attribute
				// and non-HTML5 browsers might have required="" markup
				if ( value === "" ) {
					value = true;
				}
				// force non-HTML5 browsers to return bool
				value = !!value;
			} else {
				value = $element.attr( method );
			}

			// convert the value to a number for number inputs, and for text for backwards compability
			// allows type="date" and others to be compared as strings
			if ( /min|max/.test( method ) && ( type === null || /number|range|text/.test( type ) ) ) {
				value = Number( value );
			}

			if ( value || value === 0 ) {
				rules[ method ] = value;
			} else if ( type === method && type !== "range" ) {
				// exception: the jquery validate 'range' method
				// does not test for the html5 'range' type
				rules[ method ] = true;
			}
		}

		// maxlength may be returned as -1, 2147483647 ( IE ) and 524288 ( safari ) for text inputs
		if ( rules.maxlength && /-1|2147483647|524288/.test( rules.maxlength ) ) {
			delete rules.maxlength;
		}

		return rules;
	},

	dataRules: function( element ) {
		var method, value,
			rules = {}, $element = $( element );
		for ( method in $.validator.methods ) {
			value = $element.data( "rule" + method.charAt( 0 ).toUpperCase() + method.substring( 1 ).toLowerCase() );
			if ( value !== undefined ) {
				rules[ method ] = value;
			}
		}
		return rules;
	},

	staticRules: function( element ) {
		var rules = {},
			validator = $.data( element.form, "validator" );

		if ( validator.settings.rules ) {
			rules = $.validator.normalizeRule( validator.settings.rules[ element.name ] ) || {};
		}
		return rules;
	},

	normalizeRules: function( rules, element ) {
		// handle dependency check
		$.each( rules, function( prop, val ) {
			// ignore rule when param is explicitly false, eg. required:false
			if ( val === false ) {
				delete rules[ prop ];
				return;
			}
			if ( val.param || val.depends ) {
				var keepRule = true;
				switch ( typeof val.depends ) {
				case "string":
					keepRule = !!$( val.depends, element.form ).length;
					break;
				case "function":
					keepRule = val.depends.call( element, element );
					break;
				}
				if ( keepRule ) {
					rules[ prop ] = val.param !== undefined ? val.param : true;
				} else {
					delete rules[ prop ];
				}
			}
		});

		// evaluate parameters
		$.each( rules, function( rule, parameter ) {
			rules[ rule ] = $.isFunction( parameter ) ? parameter( element ) : parameter;
		});

		// clean number parameters
		$.each([ "minlength", "maxlength" ], function() {
			if ( rules[ this ] ) {
				rules[ this ] = Number( rules[ this ] );
			}
		});
		$.each([ "rangelength", "range" ], function() {
			var parts;
			if ( rules[ this ] ) {
				if ( $.isArray( rules[ this ] ) ) {
					rules[ this ] = [ Number( rules[ this ][ 0 ]), Number( rules[ this ][ 1 ] ) ];
				} else if ( typeof rules[ this ] === "string" ) {
					parts = rules[ this ].replace(/[\[\]]/g, "" ).split( /[\s,]+/ );
					rules[ this ] = [ Number( parts[ 0 ]), Number( parts[ 1 ] ) ];
				}
			}
		});

		if ( $.validator.autoCreateRanges ) {
			// auto-create ranges
			if ( rules.min != null && rules.max != null ) {
				rules.range = [ rules.min, rules.max ];
				delete rules.min;
				delete rules.max;
			}
			if ( rules.minlength != null && rules.maxlength != null ) {
				rules.rangelength = [ rules.minlength, rules.maxlength ];
				delete rules.minlength;
				delete rules.maxlength;
			}
		}

		return rules;
	},

	// Converts a simple string to a {string: true} rule, e.g., "required" to {required:true}
	normalizeRule: function( data ) {
		if ( typeof data === "string" ) {
			var transformed = {};
			$.each( data.split( /\s/ ), function() {
				transformed[ this ] = true;
			});
			data = transformed;
		}
		return data;
	},

	// http://jqueryvalidation.org/jQuery.validator.addMethod/
	addMethod: function( name, method, message ) {
		$.validator.methods[ name ] = method;
		$.validator.messages[ name ] = message !== undefined ? message : $.validator.messages[ name ];
		if ( method.length < 3 ) {
			$.validator.addClassRules( name, $.validator.normalizeRule( name ) );
		}
	},

	methods: {

		// http://jqueryvalidation.org/required-method/
		required: function( value, element, param ) {
			// check if dependency is met
			if ( !this.depend( param, element ) ) {
				return "dependency-mismatch";
			}
			if ( element.nodeName.toLowerCase() === "select" ) {
				// could be an array for select-multiple or a string, both are fine this way
				var val = $( element ).val();
				return val && val.length > 0;
			}
			if ( this.checkable( element ) ) {
				return this.getLength( value, element ) > 0;
			}
			return $.trim( value ).length > 0;
		},

		// http://jqueryvalidation.org/email-method/
		email: function( value, element ) {
			// From http://www.whatwg.org/specs/web-apps/current-work/multipage/states-of-the-type-attribute.html#e-mail-state-%28type=email%29
			// Retrieved 2014-01-14
			// If you have a problem with this implementation, report a bug against the above spec
			// Or use custom methods to implement your own email validation
			return this.optional( element ) || /^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test( value );
		},

		// http://jqueryvalidation.org/url-method/
		url: function( value, element ) {
			// contributed by Scott Gonzalez: http://projects.scottsplayground.com/iri/
			return this.optional( element ) || /^(https?|s?ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test( value );
		},

		// http://jqueryvalidation.org/date-method/
		date: function( value, element ) {
			return this.optional( element ) || !/Invalid|NaN/.test( new Date( value ).toString() );
		},

		// http://jqueryvalidation.org/dateISO-method/
		dateISO: function( value, element ) {
			return this.optional( element ) || /^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/.test( value );
		},

		// http://jqueryvalidation.org/number-method/
		number: function( value, element ) {
			return this.optional( element ) || /^-?(?:\d+|\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test( value );
		},

		// http://jqueryvalidation.org/digits-method/
		digits: function( value, element ) {
			return this.optional( element ) || /^\d+$/.test( value );
		},

		// http://jqueryvalidation.org/creditcard-method/
		// based on http://en.wikipedia.org/wiki/Luhn/
		creditcard: function( value, element ) {
			if ( this.optional( element ) ) {
				return "dependency-mismatch";
			}
			// accept only spaces, digits and dashes
			if ( /[^0-9 \-]+/.test( value ) ) {
				return false;
			}
			var nCheck = 0,
				nDigit = 0,
				bEven = false,
				n, cDigit;

			value = value.replace( /\D/g, "" );

			// Basing min and max length on
			// http://developer.ean.com/general_info/Valid_Credit_Card_Types
			if ( value.length < 13 || value.length > 19 ) {
				return false;
			}

			for ( n = value.length - 1; n >= 0; n--) {
				cDigit = value.charAt( n );
				nDigit = parseInt( cDigit, 10 );
				if ( bEven ) {
					if ( ( nDigit *= 2 ) > 9 ) {
						nDigit -= 9;
					}
				}
				nCheck += nDigit;
				bEven = !bEven;
			}

			return ( nCheck % 10 ) === 0;
		},

		// http://jqueryvalidation.org/minlength-method/
		minlength: function( value, element, param ) {
			var length = $.isArray( value ) ? value.length : this.getLength( value, element );
			return this.optional( element ) || length >= param;
		},

		// http://jqueryvalidation.org/maxlength-method/
		maxlength: function( value, element, param ) {
			var length = $.isArray( value ) ? value.length : this.getLength( value, element );
			return this.optional( element ) || length <= param;
		},

		// http://jqueryvalidation.org/rangelength-method/
		rangelength: function( value, element, param ) {
			var length = $.isArray( value ) ? value.length : this.getLength( value, element );
			return this.optional( element ) || ( length >= param[ 0 ] && length <= param[ 1 ] );
		},

		// http://jqueryvalidation.org/min-method/
		min: function( value, element, param ) {
			return this.optional( element ) || value >= param;
		},

		// http://jqueryvalidation.org/max-method/
		max: function( value, element, param ) {
			return this.optional( element ) || value <= param;
		},

		// http://jqueryvalidation.org/range-method/
		range: function( value, element, param ) {
			return this.optional( element ) || ( value >= param[ 0 ] && value <= param[ 1 ] );
		},

		// http://jqueryvalidation.org/equalTo-method/
		equalTo: function( value, element, param ) {
			// bind to the blur event of the target in order to revalidate whenever the target field is updated
			// TODO find a way to bind the event just once, avoiding the unbind-rebind overhead
			var target = $( param );
			if ( this.settings.onfocusout ) {
				target.unbind( ".validate-equalTo" ).bind( "blur.validate-equalTo", function() {
					$( element ).valid();
				});
			}
			return value === target.val();
		},

		// http://jqueryvalidation.org/remote-method/
		remote: function( value, element, param ) {
			if ( this.optional( element ) ) {
				return "dependency-mismatch";
			}

			var previous = this.previousValue( element ),
				validator, data;

			if (!this.settings.messages[ element.name ] ) {
				this.settings.messages[ element.name ] = {};
			}
			previous.originalMessage = this.settings.messages[ element.name ].remote;
			this.settings.messages[ element.name ].remote = previous.message;

			param = typeof param === "string" && { url: param } || param;

			if ( previous.old === value ) {
				return previous.valid;
			}

			previous.old = value;
			validator = this;
			this.startRequest( element );
			data = {};
			data[ element.name ] = value;
			$.ajax( $.extend( true, {
				url: param,
				mode: "abort",
				port: "validate" + element.name,
				dataType: "json",
				data: data,
				context: validator.currentForm,
				success: function( response ) {
					var valid = response === true || response === "true",
						errors, message, submitted;

					validator.settings.messages[ element.name ].remote = previous.originalMessage;
					if ( valid ) {
						submitted = validator.formSubmitted;
						validator.prepareElement( element );
						validator.formSubmitted = submitted;
						validator.successList.push( element );
						delete validator.invalid[ element.name ];
						validator.showErrors();
					} else {
						errors = {};
						message = response || validator.defaultMessage( element, "remote" );
						errors[ element.name ] = previous.message = $.isFunction( message ) ? message( value ) : message;
						validator.invalid[ element.name ] = true;
						validator.showErrors( errors );
					}
					previous.valid = valid;
					validator.stopRequest( element, valid );
				}
			}, param ) );
			return "pending";
		}

	}

});

$.format = function deprecated() {
	throw "$.format has been deprecated. Please use $.validator.format instead.";
};

// ajax mode: abort
// usage: $.ajax({ mode: "abort"[, port: "uniqueport"]});
// if mode:"abort" is used, the previous request on that port (port can be undefined) is aborted via XMLHttpRequest.abort()

var pendingRequests = {},
	ajax;
// Use a prefilter if available (1.5+)
if ( $.ajaxPrefilter ) {
	$.ajaxPrefilter(function( settings, _, xhr ) {
		var port = settings.port;
		if ( settings.mode === "abort" ) {
			if ( pendingRequests[port] ) {
				pendingRequests[port].abort();
			}
			pendingRequests[port] = xhr;
		}
	});
} else {
	// Proxy ajax
	ajax = $.ajax;
	$.ajax = function( settings ) {
		var mode = ( "mode" in settings ? settings : $.ajaxSettings ).mode,
			port = ( "port" in settings ? settings : $.ajaxSettings ).port;
		if ( mode === "abort" ) {
			if ( pendingRequests[port] ) {
				pendingRequests[port].abort();
			}
			pendingRequests[port] = ajax.apply(this, arguments);
			return pendingRequests[port];
		}
		return ajax.apply(this, arguments);
	};
}

// provides delegate(type: String, delegate: Selector, handler: Callback) plugin for easier event delegation
// handler is only called when $(event.target).is(delegate), in the scope of the jquery-object for event.target

$.extend($.fn, {
	validateDelegate: function( delegate, type, handler ) {
		return this.bind(type, function( event ) {
			var target = $(event.target);
			if ( target.is(delegate) ) {
				return handler.apply(target, arguments);
			}
		});
	}
});

}));
/*
// авто-гритинг чата.
var LC_API = LC_API || {};


function _LC_OPEN() {
    LC_API.open_chat_window();
}

// LC_API.on_after_load = function()
LC_API.on_before_load = function()
{

    var custom_variables = [
       { name: 'visit', value: '1' }
    ];
    LC_API.set_custom_variables(custom_variables);

//    console.log('LC_API:BEFORE');
//    if(!LC_API.chat_window_maximized()) {
//        setTimeout( _LC_OPEN, 1000*60*10); // 1000 - 1cек.
//    }

//	if(LC_API.chat_window_maximized()) {
//            // LC_API.hide_chat_window();
//            LC_API.minimize_chat_window();
//        }
};

LC_API.on_after_load = function() {
//    console.log('LC_API:AFTER');

    if(LC_API.chat_window_maximized()) {
//            // LC_API.hide_chat_window();
        LC_API.minimize_chat_window();
    }

     setTimeout( _LC_OPEN, 1000*60*10); // 1000 - 1cек.
}
*/

$(function() {
        $('.select_inverse, .select').selectpicker();

	$('.dbody > .row > div:first-child').on('click', function(ev) {
		var $this = $(this);
		if ($(ev.target).closest('.popover').length) return;
		if ($this.hasClass('active')) {
			$this.removeClass('active');
		} else {
			$('.dbody > .row > div').removeClass('active');
			$this.addClass('active');
		}
	});

	$(window).scroll(function() {
		if ($(this).scrollTop() > 100) {
			$('.go_up').fadeIn();
		} else {
			$('.go_up').fadeOut();
		}
	});
	// scroll body to 0px on click
	$('.go_up').on("click", function() {
		$('body,html').animate({
			scrollTop: 0
		}, 800);
		return false;
	});


    $('.learn-about-link').click(function(event) {
        event.preventDefault();
        var href=$(this).attr('href');
        var target=$(href);
        var top=target.offset().top;
        $('html,body').animate({
            scrollTop: top
        }, 800);
    });

        // scroll body on click
        if($('.go_block_scroll').length) {
           $('.go_block_scroll').on('click', function() {
                var id = ($(this).attr('data-go-block')) ? '#'.$(this).attr('data-go-block') : ($(this).attr('href')) ? $(this).attr('href') : false;
                if(id && $( id ).length) {
                    $('html, body').animate( {
                        scrollTop: Math.ceil( $( id ).offset().top ) // Math.ceil((target_top * $(window).outerHeight(true)) / $('html, body').height())
                    },'linear');
                    return false;
                }
           });
        }

        // ga form
        // вариант 1
//        ga(function(tracker) {
//          var linkerParam = tracker.get('linkerParam');
//          console.log( linkerParam );
//        });

       if($('form[name="price_premium_bottom"], form[name="price_basic_bottom"], form[name="price_premium"], form[name="price_basic"]').length) {
        $('form[name="price_premium_bottom"], form[name="price_basic_bottom"], form[name="price_premium"], form[name="price_basic"]').submit(function(){
            ga('linker:decorate', this);
        });
       }
});

$(document).ready(function(){ 

    // create cookie
    if(typeof $.cookie('popUp_email') == "undefined") {
        $.cookie('popUp_email', 0, {  
            expires: 1 // установить на сутки  
        });
    }
    
    /*
    $('html').mouseleave(function(){
        // console.log( 'Out windows! ', $.cookie('popUp_email'), typeof($.cookie('popUp_email')) );
        if(typeof $.cookie('popUp_email') !== "undefined" 
                && !parseInt( $.cookie('popUp_email') )) {
            
            var $_popUp = $('.box-popUp'),
                $box_email = $_popUp.find('#box-email');

            if(!$box_email.length) { 
                $box_email = $_popUp
                        .append( _htmlPopUp.box_email )
                        .find('#box-email'); 
            } 
            
            $box_email.bPopup({
                    modalClose: true,
                    appending: false,
                    opacity: 0.6,
                    follow: [false, false], 
                    positionStyle: 'fixed', //'fixed' or 'absolute'
                    onOpen: function() {
                        popUpValidate();
                    },
                    closeClass: 'close',
                    onClose: function() {
                    },

            });
            
            $.cookie('popUp_email', 1); // popUp inout put one.
        }
        
    });
    */
    
    // form popUp
    $('.block-popUp-close').on('click', function() {
        var _popUp = $(this).parents('.popUp'), $this = $(this);
        _popUp.bPopup().close();
    });

});

function popUpValidate() {
    
    $('form.block-popup-form').validate({
        onfocusout: false,
        onkeyup: false,
        onclick: true,
        onsubmit: true,
        focusInvalid: false,
        focusCleanup: false,
        email: {
            required: true,
            email: true
        },
        messages: {
            email: {
                required: "The Email field is empty",
                email: "Please enter correct email"
            }
        },
       
        errorClass: "error",
        validClass: "success",
        invalidHandler: function(event, validator) {
            if($('form.block-popup-form div.error').length)
                $('form.block-popup-form div.error').html( " " ).hide();
        },
        // управление ошибками
        showErrors: function(errorMap, errorList) {
            var msg = null;
            $.each(errorList, function(){
                 msg = this.message + '<br />'; });
             
            if(msg !== null) 
                $("form.block-popup-form div.error").html(msg).show();
        },

        submitHandler: function( form ) { // submitHandler
            var $form = $(form), _params = parseQuery($form.serializeArray());
            
            if($('form.block-popup-form div.error').length)
                $('form.block-popup-form div.error').html( " " ).hide();
            
            // disabled button
            $form.find('button').prop( "disabled", true );
            
            
            var jqXHR = _getAJAX( 
                'http://pumpic.com/popup_email_send.html', 
                _params, {
                    'dataType': 'jsonp',
                    'crossDomain': true,
                } 
            );
    
            if(typeof jqXHR == 'object') {
                jqXHR
                .done(function(data, textStatus, jqXHR) {
                    if(textStatus == 'success') {
                        console.log( data );
                
                        if(data.error) { 
                    
                            if(typeof data.error === 'object') {
                                $.each(data.error, function(name, text) {
                                    var _obj = $form.find('input[name="'+name+'"]');
                                    if(_obj.length) {
                                        if(_obj.next('label').length)
                                            _obj.next().html( text ).show();
                                        else
                                            $('form.block-popup-form div.error').html( text ).show();
                                            //$('<label id="'+name+'-error" for="'+name+'" class="error">'+text+'</label>').insertAfter(_obj); 
                                    }
                                  });
                            } else {
                                $('form.block-popup-form div.error').html( data.error ).show();
                            }

                            // disabled button
                            $form.find('button').prop( "disabled", false );
                            return false;
                        } else if(data.success) {
                            // google analitycs
                            // ga('send', 'event', 'form', 'submit', 'compatibility-request-success');
                            var $_popUp = $('.box-popUp'),
                                $email_success = $_popUp.find('#box-email-success');
                                
                            if(!$email_success.length) { 
                                $email_success = $_popUp
                                        .append( _htmlPopUp.email_success )
                                        .find('#box-email-success'); 
                            }
                            
                            // close popUp
                            if($('.box-popUp > .popUp').is(':visible')) {
                                $('.box-popUp > .popUp').bPopup({
                                    transition: 'fadeOut'
                                }).close();
                            }

                            $email_success.bPopup({
                                    modalClose: true,
                                    appending: false,
                                    opacity: 0.6,
                                    follow: [false, false], 
                                    positionStyle: 'fixed', //'fixed' or 'absolute'
                                    onOpen: function() {
                                    },
                                    closeClass: 'close',
                                    onClose: function() {
                                    },
                            });
                        }
                        
                    } else {
                        $('form.block-popup-form div.error').html('Your email was not sent').show();
                        console.log('System error '+ textStatus +'!');
                        // disabled button
                        $form.find('button').prop( "disabled", false );
                         return false;
                        }
                })
                .fail  (function(jqXHR, textStatus, errorThrown) { 
                    $('form.block-popup-form div.error').html('Your email was not sent').show();
                     console.log('System error (JSOP:REQUEST)!');
                    // disabled button
                    $form.find('button').prop( "disabled", false );
                    return false;
                });
            } else {
                $('form.block-popup-form div.error').html('Your email was not sent').show();
                 console.log('System error (CREATE:OBJECT)!');
                // disabled button
                $form.find('button').prop( "disabled", false );
                return false;
            }
            
            /* json
            var _res = getAjaxForm('http://pumpic.com/popup_email_send.html', _params, {
                'dataType': 'json',
                'crossDomain': true,
            });
            if(typeof _res === 'object') {
                if(_res.error) { 
                    
                    if(typeof _res.error === 'object') {
                        $.each(_res.error, function(name, text) {
                            var _obj = $form.find('input[name="'+name+'"]');
                            if(_obj.length) {
                                if(_obj.next('label').length)
                                    _obj.next().html( text ).show();
                                else
                                    $('form.block-popup-form div.error').html( text ).show();
                                    //$('<label id="'+name+'-error" for="'+name+'" class="error">'+text+'</label>').insertAfter(_obj); 
                            }
                          });
                    } else {
                        $('form.block-popup-form div.error').html( _res.error ).show();
                    }
                    
                    // disabled button
                    $form.find('button').prop( "disabled", false );
                    return false;
                } else if(_res.success) {
                    // google analitycs
                    // ga('send', 'event', 'form', 'submit', 'compatibility-request-success');

                    

                    // close popUp
                    if($('.box-popUp > .popUp').is(':visible')) {
                        $('.box-popUp > #box-email').bPopup({
                            transition: 'fadeOut'
                        }).close();
                    }        

                    $('.box-popUp > #box-email-success').bPopup({
                            modalClose: true,
                            appending: false,
                            opacity: 0.6,
                            follow: [false, false], 
                            positionStyle: 'fixed', //'fixed' or 'absolute'
                            onOpen: function() {
                            },
                            closeClass: 'close',
                            onClose: function() {
                            },
                    });
                } else {
                    $('form.block-popup-form div.error').html('Your email was not sent').show();
                    console.log('System error!');
                    
                    // disabled button
                    $form.find('button').prop( "disabled", false );
                     return false;
                }
            } else {
                $('form.block-popup-form div.error').html('Your email was not sent').show();
                
                // disabled button
                $form.find('button').prop( "disabled", false );
                return false;
            }
            */
            $form.trigger("reset"); 
        }
    });
    
}
// detected image onload
;(function ($) {
    $.fn.bindImageLoad = function (callback) {
        function isImageLoaded(img) {
            // Во время события load IE и другие браузеры правильно
            // определяют состояние картинки через атрибут complete.
            // Исключение составляют Gecko-based браузеры.
            if (!img.complete) {
                return false;
            }
            // Тем не менее, у них есть два очень полезных свойства: naturalWidth и naturalHeight.
            // Они дают истинный размер изображения. Если какртинка еще не загрузилась,
            // то они должны быть равны нулю.
            if (typeof img.naturalWidth !== "undefined" && img.naturalWidth === 0) {
                return false;
            }
            // Картинка загружена.
            return true;
        }

        return this.each(function () {
            var ele = $(this);
            if (ele.is("img") && $.isFunction(callback)) {
                ele.one("load", callback);
                if (isImageLoaded(this)) {
                    ele.trigger("load");
                }
            }
        });
    };
})(jQuery);

$(document).ready(function(){ 
    /* capcha resize */
  if($('form .box-captcha > img').length) { 
      $('form .box-captcha > img').bindImageLoad(function() { 
            var _bcaptcha = $(this).parents('.box-captcha'), _bcw = _bcaptcha.width(),
            _width = $(this).width(), width = $(this).outerWidth(true),
            _update = _bcaptcha.find('.update-captcha');
            $(this).css({'width': (_bcw - 54)+'px'});
            _update.attr('attr-width', _bcw - 54);
      });
  }  
    
    /* images mobile */
  if($('#box-content-post img, #block-content img').length) {
      
      
      //$('#box-content-post img').each(function() {
      $('#box-content-post img, #block-content img').bindImageLoad(function() {    
          
          var width = $(this).attr('width'),
              parent = $(this).closest('.wp-caption'), 
              _caption_text = parent.find('.wp-caption-text'),
                _src = $(this).attr('src'),
                height = $(this).attr('height'),
                outer_width = $(this).outerWidth(true),
                parent_outer_width = parent.outerWidth(true);
          
          $(this).attr('attr-width', width).removeAttr('width');
          $(this).attr('attr-height', height).removeAttr('height');
          //$(this).attr('src', '');
          
          // console.log(width, height);
          
          $(this).css({
              //'background': 'url( "'+_src+'" ) no-repeat',
              'background-size': 'contain',
              //'max-width': width+'px', 
              'height' : 'auto',
              'width': 'auto',
              'max-height': height+'px',
          });
          
          if(parent.length)
              parent.css({
                  'clear': 'both',
                  'width': 'auto',
              });
          
          //console.log(' ---- Start width -------- ');
          //console.log(parent_outer_width, outer_width);
          //console.log( '-------- end ---------' );
          
          if(_caption_text.length) {
              if(parent_outer_width > 0) {
                _caption_text.css({
                  'width': '100%',  
                  'max-width': parent_outer_width+'px',
                });
              } else if(outer_width > 0) {
                 _caption_text.css({
                     'width': '100%',
                    'max-width': outer_width+'px',
                }); 
              }
          }
        
          
      });
      
      
  }
});

// .wp-caption
$( window ).resize(function() {
    var $_wW = $(window).width();
    
    // form.send_find_phone .box-captcha img
    if($('form .box-captcha > img').length) {
        $('form .box-captcha > img').each(function() {
            var _bcaptcha = $(this).parents('.box-captcha'), _bcw = _bcaptcha.width(),
            _width = $(this).width(), width = $(this).outerWidth(true),
            _update = _bcaptcha.find('.update-captcha');
            $(this).css({'width': (_bcw - 54)+'px'});
            _update.attr('attr-width', _bcw - 54);
            
        });
    }
    
    
    // box-content-post
    if($('#box-content-post img, #block-content img').length) {
      $('#box-content-post img, #block-content img').each(function() {
          var _caption = $(this).parents('.wp-caption'), 
                width = $(this).outerWidth(true),
                _attachmentW = $(this).closest('#attachment').outerWidth(true),
                _width = $(this).width(),
                _attrW = $(this).attr('attr-width');

          if(_caption.find('.wp-caption-text').length)
            _caption.find('.wp-caption-text').css({
                'width': width+'px',
            });
            
      });
    }  
});
$(document).ready(function(){ 
//    var $bth = $("#block-technological-header .box-hedaer-body"),
//        _biW = $bth.find('.block-images').width(true),
//        _biH = $bth.find('.block-images').height(true);
//        
//    if($("#box-img-lines").is(':visible'))    
//        $("#box-img-lines img").css({'width': _biW +'px', 'margin-left': '-'+(_biW / 2 )+'px'});

});

//// .wp-caption
$( window ).resize(function() {
//    var $_wW = $(window).width(),
//        $_hH = $(window).height(),
//        $bth = $("#block-technological-header .box-hedaer-body"),
//        _biW = $bth.find('.block-images').outerWidth(true),
//        _biH = $bth.find('.block-images').outerHeight(true),
//        
//        _biIW = false, _biIH = false,
//        
//        _ml = (42 / _biW) * 100,
//        _mt = (16 / _biH) * 100;
//    
//        if($("#box-img-lines").is(':visible'))
//            $("#box-img-lines img").css({'width': (_biW - 30) +'px', 'margin-left': '-'+(_biW / 2 )+'px'});
    
//    console.log( 'Ww = '+$_wW+' hH = '+ $_hH +' _biW = '+ _biW + ' _biH = '+ _biH +' _biIW = '+ _biIW + ' _biIH = '+ _biIH );
//    
//    if($bth.find('#box-image-element .box-img-middle').is(':visible')) {
//      _biIW = $bth.find('#box-image-element .box-img-middle img').outerWidth(true);
//      _biIH = $bth.find('#box-image-element .box-img-middle img').outerHeight(true);
//      
//      $bth.find('#box-image-element .box-img-middle img').css({
//          'margin-left': _ml+'%',
//          'margin-top': _mt+'%'
//      });
//      
//    } else if($bth.find('#box-image-element .box-img-big').is(':visible')) {
//      _biIW = $bth.find('#box-image-element .box-img-big img').outerWidth(true); 
//      _biIH = $bth.find('#box-image-element .box-img-big img').outerHeight(true);
//    } 
    
    
    
    
});
// The plugin code
(function($){
    $.fn.scrollPumpic = function(options){
        var $this = $(this);
            offset = $this.offset();
        var _stop = false, 
            _objFly = false, 
            dedug = false; // debuging code
        
        var defaults = {
            "start": 0,
            "stop": offset.top + $this.height(),
            "_objFly": '.box-fly-discount',
            "right": 0,
            "_show": true,
            "_settings" : {
                '_responce': true,
                '_validate': true,
                '_validateObj': "#form-discount-fly"
            },
            "animate": {
                'type': '', // fade, visible, blinking
                'timeShow': 200,
                'timeHide': 100
            }
            //"coeff": 0.95
        };
        
        if(dedug)
            console.log( '---------------------------- // INIT PLUGIN SCROLL ----------------------------' );
        
        var opts = $.extend(defaults, options);
            _objFly = (opts._objFly) ? opts._objFly : false;
        
//        $(window).on('resize', function() { 
//           if($(this).width() > 800) {
//                $this.find( _objFly ).css({'margin-right': opts.right+'px'});
//            } else {
//                $this.find( _objFly ).css({'margin-right': '0px'});
//            }
//        }); 

        if(dedug) {
            console.log( 'SCROLL SETTINGS: ', opts );
            console.log( 'start = '+opts.start, 'stop = '+opts.stop );
        }
        
        
        var _animate = {
            init: function( show ) {
                if(show) {
                    $this.find( _objFly ).addClass('fixed');
                } else {
                    $this.find( _objFly ).removeClass('fixed');
                }
                
                switch ( opts.animate.type ) {
                    // fadeIn/Out
                    case  "fade":
                        if(dedug)
                            console.log( show );
                        
                        if(show && $this.not(':visible')) {
                            $this.stop(true).queue('fx', function(){
                                $(this).fadeIn( opts.animate.timeShow ).dequeue('fx');

                                 if(opts._settings._validate)
                                    $( opts._settings._validateObj ).validate(); // init validate
                            });
                        } else if(!show && $this.is(':visible')) {
                            $this.stop(true).queue('fx', function(){
                                $(this).fadeOut( opts.animate.timeHide ).dequeue('fx');
                            });
                        }
                    break;
                    
                    // show/hide
                    case  "visible":
                        
                        if(dedug)
                            console.log( show );
                        
                        if(show && $this.not(':visible')) {
                            $this.stop(true).queue('fx', function(){
                                $(this).show( opts.animate.timeShow ).dequeue('fx');

                                 if(opts._settings._validate)
                                    $( opts._settings._validateObj ).validate(); // init validate
                            });
                        } else if(!show && $this.is(':visible')) {
                            $this.stop(true).queue('fx', function(){
                                $(this).hide( opts.animate.timeHide ).dequeue('fx');
                            });
                        }
                        
                    break;
                    
                    // opacity
                    case  "blinking":
                        if(dedug)
                            console.log( show );
                        
                        if(show && $this.not(':visible')) {
                            $this.stop(true).queue('fx', function(){
                                $(this).animate({opacity: 1}, opts.animate.timeShow ).dequeue('fx');

                                 if(opts._settings._validate)
                                    $( opts._settings._validateObj ).validate(); // init validate
                            });
                        } else if(!show && $this.is(':visible')) {
                            $this.stop(true).queue('fx', function(){
                                $(this).animate({opacity: 0}, opts.animate.timeHide ).dequeue('fx');
                            });
                        }
                        
                        
                    break;
                    
                    default:
                        
                        if(dedug)
                            console.log( show );
                        
                        if(show && $this.not(':visible')) {
                            $this.stop(true).queue('fx', function(){
                                $(this).animate({opacity: 1}, opts.animate.timeShow ).dequeue('fx');

                                 if(opts._settings._validate)
                                    $( opts._settings._validateObj ).validate(); // init validate
                            });
                        } else if(!show && $this.is(':visible')) {
                            $this.stop(true).queue('fx', function(){
                                $(this).animate({opacity: 0}, opts.animate.timeHide ).dequeue('fx');
                            });
                        }
                        
                    break;    
                }
            }
        };
        
        // clear cache
        if($(window).hasHandlers('scroll')) 
            $(window).off('scroll');
        
        $(window).on('scroll', function() {
            windowTop = $(window).scrollTop();
            _stop = (opts.stop) ? (windowTop <= opts.stop) ? true : false : false;
            
            if(dedug)
                console.log('windowTop = '+ windowTop, '_stop = '+_stop+' opts.start = '+opts.start);
            
             if((windowTop >= opts.start) && !_stop) {
                 //newCoord = windowTop * opts.coeff;
                 // box right
                if(opts.right > 0) {
                    if($(window).width() > 800) {
                        $this.find( _objFly ).css({'margin-right': opts.right+'px'});
                    } else {
                        $this.find( _objFly ).css({'margin-right': '0px'});
                    }
                }
               
                // run animate
                opts._show = true;
                
             } else if((windowTop < opts.start) || _stop) { 
                 // run animate
                 opts._show = false;   
             }
             
             _animate.init( opts._show ); // animate
            
        });
        
        
        /*
        return this.each(function(){
            
            $(window).on('scroll', function() {
                
                // console.log( opts.start );
                if(opts._settings._responce) {
                    if($(window).width() <= 480)  {
                        $this.find( _objFly ).removeClass('fixed');
                        $this.hide(500);
                        return;
                    }
                }
                
                windowTop = $(window).scrollTop();
                _stop = (opts.stop) ? (windowTop <= opts.stop) ? true : false : false; 
                
                if((windowTop >= opts.start) && !_stop) {
                    //newCoord = windowTop * opts.coeff;
                    
                    // box right
                    if(opts.right > 0) {
                        
                        if($(window).width() > 800) {
                            $this.find( _objFly ).css({'margin-right': opts.right+'px'});
                        } else {
                            $this.find( _objFly ).css({'margin-right': '0px'});
                        }
                    }
                    
                    if(opts._show) {
                        if(dedug)
                            console.log( opts._show );
                        $this.find( _objFly ).addClass('fixed');
                        $this.stop(true).queue('fx', function(){
                            $(this).animate({opacity: 1}, 200 ).dequeue('fx');
                             if(opts._settings._validate)
                                $( opts._settings._validateObj ).validate(); // init validate
                        });
                      opts._show = false;  
                    }
                    
                } else if((windowTop < opts.start) || _stop) {
                    if(!opts._show) {
                        if(dedug)
                            console.log( opts._show );
                        $this.find( _objFly ).removeClass('fixed');
                        $this.stop(true).queue('fx', function(){
                            $(this).animate({opacity: 0}, 100 ).dequeue('fx');
                        });
                        opts._show = true;
                    }
                    
                }
                
                if(dedug)
                    console.log( 'widow_width = '+$(window).width()+' windowTop ='+ windowTop+' start = '+opts.start );
                
                
                
                    
            });
        });
        
        */
        
        
    };
})(jQuery);

$(document).ready(function() {
	var prods = { ios: 'ios', android: 'android', iosJb: 'ios-jb'},
			$iosBtn = $('#filter-' + prods.ios),
			$andrBtn = $('#filter-' + prods.android),
			$iosJbBtn = $('#filter-' + prods.iosJb);
	var prodList = {
		ios: '#prod-list-' + prods.ios,
		android: '#prod-list-' + prods.android,
		iosJb: '#prod-list-' + prods.iosJb
	};
	
	function toggleProdList(prodList) {
		var $prodList = $(prodList)
		$prodList.siblings().fadeOut(120).promise().done(function () {
			$prodList.fadeIn(120)
		})
	}
	
	$('.filter_list').on('click', 'li', function() {
		$('.filter_list li.filter-active').removeClass('filter-active');
		$(this).addClass('filter-active');
		// $('input[type=checkbox][name=android-40off]').prop('checked', false)
	});
	
	$iosBtn.click(function() {
		var iosBlock = $('th').find('[data-info-block='+ prods.ios +']')
		if (!$(this).hasClass('filter-active')) {
			toggleProdList(prodList.ios);
			toggleProdList(iosBlock);
		}
	});
	
	$iosJbBtn.click(function() {
		var iosJbBlock = $('th').find('[data-info-block='+ prods.iosJb +']')
		if (!$(this).hasClass('filter-active')) {
			toggleProdList(prodList.iosJb);
			toggleProdList(iosJbBlock);
		}
	});
	
	$andrBtn.click(function() {
		var androidBlock = $('th').find('[data-info-block='+ prods.android +']')
		if (!$(this).hasClass('filter-active')) {
			toggleProdList(prodList.android);
			toggleProdList(androidBlock);
		}
	});
	
});
var mobile_slider = "<div class=\"slide\">";
        mobile_slider += "<div class=\"col-sm-12 col-md-4 col-lg-4 col-xs-12\">";
        mobile_slider +=    "<img src=\"{img_src}\" class=\"testimonial-photo\">";
        mobile_slider +=    "<div class=\"testimonial-text\">{text}</div>";
        mobile_slider += "</div>";
    mobile_slider += "</div>";
    
var objSliderMobile = $('.bxSliderMobile');
var bxSliders = false;
var bxSlidersMobile = false;
var bxSlidersPC = false;
    
$(document).ready(function(){ 
    // .replace
    
    
    
    if($('.bxSliders').length) {
    
//        if($('.bxSliders').not('.only-mobile, .only-pc')) {
//            bxSliders = runSliders( $('.bxSliders').not('.only-mobile, .only-pc') );
//        }
//
//        if($('.bxSliders.only-mobile').length)
//            bxSlidersMobile = runSliders( $('.bxSliders.only-mobile') ); // :visible
        
        if(!bxSlidersPC && $('.bxSliders.only-pc').length)
            bxSlidersPC = runSliders( $('.bxSliders.only-pc') ); // :visible

        $(window).on('load resize', function() {
            
            if($(this).width() < 992) {

                if(!bxSlidersMobile && !$('.bxSliderMobile').find('.slide').length) {
                    sliderMobileInit(objSliderMobile, $('.bxSliders.only-pc'));
                    bxSlidersMobile = runSliders( $('.bxSliderMobile') );
                }

//                if(bxSlidersMobile && $('.bxSliders.only-mobile').length) // .is(':visible')
//                   bxSlidersMobile.reloadSlider();

//                if(bxSlidersPC && $('.bxSliders.only-pc').length) // .not(':visible')
//                   bxSlidersPC.destroySlider();

                if(bxSlidersPC) {
                   bxSlidersPC.destroySlider();
                   bxSlidersPC = false;
               }   

            } else {

                 if(bxSlidersMobile && $('.bxSliderMobile').length && $('.bxSliderMobile').find('.slide').length) {
                     bxSlidersMobile.destroySlider();
                     clearSliderMobile( objSliderMobile );
                     bxSlidersMobile = false
                 }    
                 
                    

//               if(bxSlidersMobile && $('.bxSliders.only-mobile').length) //.not(':visible') 
//                   bxSlidersMobile.destroySlider();

//                if(bxSlidersPC && $('.bxSliders.only-pc').length) // .is(':visible')
//                   bxSlidersPC.reloadSlider();

                if(!bxSlidersPC) {
                   bxSlidersPC = runSliders( $('.bxSliders.only-pc') );
               }   

           }   
        });
    
    }
    
    if($('.slider-ipad').length) {
        $('.slider-ipad').bxSlider({
            slideWidth: 385,
            minSlides: 1,
            controls: true,
            // moveSlides: 1,
            // startSlide: 2,
            // maxSlides: 10,
            // slideMargin: 10
            nextSelector: '#slider-next',
            prevSelector: '#slider-prev',
            nextText: '',
            prevText: '',
            
//            buildPager: null,
//            pagerCustom: true,
        }); 
    }
});

function sliderMobileInit( obj, getElemts ) {
    var _html = '', $res = new Array;
    if(isset(obj) && isset(getElemts)) {
        getElemts.find('.slide').each(function(k, val) {
            var _item = $(val).find('.bxItem');
            if(isset(_item)) {
                _item.each(function(ik, ival) {
                    
                   $res.push({
                       'src': $(ival).find('.testimonial-photo').attr('src'),
                       'text': $(ival).find('.testimonial-text').html()
                    }); 
                    
                });
            }
        });
    }
    
    if($res.length > 0) {
        $.each($res, function(key, item) {
            if(item.src && item.text) {
                var _hItem = '';
                _hItem += mobile_slider.replace('{img_src}', item.src);
                _html += _hItem.replace('{text}', item.text);
            }
        });
        obj.html( _html );
    }
    
}

function clearSliderMobile(obj) {
    if(isset(obj)) obj.empty(); 
}

function runSliders( obj ) {
    return obj.bxSlider({
        slideWidth: 1170,
        minSlides: 1,
        controls: false,
        
        infiniteLoop: false,
        responsive: true,
        
        wrapperClass: 'bx-wrapper-testimonials',
        onSliderLoad: function(){
            // alert( $('.bx-controls .bx-pager > .bx-pager-item').length );
            if($('.bx-controls > .bx-pager > .bx-pager-item').length < 2) $('.bx-controls > .bx-pager > .bx-pager-item').hide(); 
        },
        onSlideBefore: function() {

        },
        onSlideAfter: function(){

        },
    }); 
   
}
/***
 * BxSlider v4.2.3 - Fully loaded, responsive content slider
 * http://bxslider.com
 *
 * Copyright 2014, Steven Wanderski - http://stevenwanderski.com - http://bxcreative.com
 * Written while drinking Belgian ales and listening to jazz
 *
 * Released under the MIT license - http://opensource.org/licenses/MIT
 ***/

;(function($){

	var defaults = {

		// GENERAL
		mode: 'horizontal',
		slideSelector: '',
		infiniteLoop: true,
		hideControlOnEnd: false,
		speed: 500,
		easing: null,
		slideMargin: 0,
		startSlide: 0,
		randomStart: false,
		captions: false,
		ticker: false,
		tickerHover: false,
		adaptiveHeight: false,
		adaptiveHeightSpeed: 500,
		video: false,
		useCSS: true,
		preloadImages: 'visible',
		responsive: true,
		slideZIndex: 50,
		wrapperClass: 'bx-wrapper',

		// TOUCH
		touchEnabled: true,
		swipeThreshold: 50,
		oneToOneTouch: true,
		preventDefaultSwipeX: true,
		preventDefaultSwipeY: false,

		// KEYBOARD
		keyboardEnabled: false,

		// PAGER
		pager: true,
		pagerType: 'full',
		pagerShortSeparator: ' / ',
		pagerSelector: null,
		buildPager: null,
		pagerCustom: null,

		// CONTROLS
		controls: true,
		nextText: 'Next',
		prevText: 'Prev',
		nextSelector: null,
		prevSelector: null,
		autoControls: false,
		startText: 'Start',
		stopText: 'Stop',
		autoControlsCombine: false,
		autoControlsSelector: null,

		// AUTO
		auto: false,
		pause: 4000,
		autoStart: true,
		autoDirection: 'next',
		autoHover: false,
		autoDelay: 0,
		autoSlideForOnePage: false,

		// CAROUSEL
		minSlides: 1,
		maxSlides: 1,
		moveSlides: 0,
		slideWidth: 0,

		// CALLBACKS
		onSliderLoad: function(){ return true },
		onSlideBefore: function(){ return true },
		onSlideAfter: function(){ return true },
		onSlideNext: function(){ return true },
		onSlidePrev: function(){ return true },
		onSliderResize: function(){ return true }
	};

	$.fn.bxSlider = function(options){

		if(this.length === 0){
			return this;
		} 

		// support multiple elements
		if(this.length > 1){
			this.each(function(){
				$(this).bxSlider(options);
			});
			return this;
		}

		// create a namespace to be used throughout the plugin
		var slider = {};
		// set a reference to our slider element
		var el = this;

		/**
		 * Makes slideshow responsive
		 */
		// first get the original window dimens (thanks a lot IE)
		var windowWidth = $(window).width();
		var windowHeight = $(window).height();



		/**
		 * ===================================================================================
		 * = PRIVATE FUNCTIONS
		 * ===================================================================================
		 */

		/**
		 * Initializes namespace settings to be used throughout plugin
		 */
		var init = function(){
			// merge user-supplied options with the defaults
			slider.settings = $.extend({}, defaults, options);
			// parse slideWidth setting
			slider.settings.slideWidth = parseInt(slider.settings.slideWidth);
			// store the original children
			slider.children = el.children(slider.settings.slideSelector);
			// check if actual number of slides is less than minSlides / maxSlides
			if(slider.children.length < slider.settings.minSlides){ slider.settings.minSlides = slider.children.length; } 
			if(slider.children.length < slider.settings.maxSlides){ slider.settings.maxSlides = slider.children.length; }
			// if random start, set the startSlide setting to random number
			if(slider.settings.randomStart){ slider.settings.startSlide = Math.floor(Math.random() * slider.children.length); }
			// store active slide information
			slider.active = { index: slider.settings.startSlide };
			// store if the slider is in carousel mode (displaying / moving multiple slides)
			slider.carousel = slider.settings.minSlides > 1 || slider.settings.maxSlides > 1 ? true : false;
			// if carousel, force preloadImages = 'all'
			if(slider.carousel){ slider.settings.preloadImages = 'all'; }
			// calculate the min / max width thresholds based on min / max number of slides
			// used to setup and update carousel slides dimensions
			slider.minThreshold = (slider.settings.minSlides * slider.settings.slideWidth) + ((slider.settings.minSlides - 1) * slider.settings.slideMargin);
			slider.maxThreshold = (slider.settings.maxSlides * slider.settings.slideWidth) + ((slider.settings.maxSlides - 1) * slider.settings.slideMargin);
			// store the current state of the slider (if currently animating, working is true)
			slider.working = false;
			// initialize the controls object
			slider.controls = {};
			// initialize an auto interval
			slider.interval = null;
			// determine which property to use for transitions
			slider.animProp = slider.settings.mode === 'vertical' ? 'top' : 'left';
			// determine if hardware acceleration can be used
			slider.usingCSS = slider.settings.useCSS && slider.settings.mode !== 'fade' && (function(){
				// create our test div element
				var div = document.createElement('div');
				// css transition properties
				var props = ['WebkitPerspective', 'MozPerspective', 'OPerspective', 'msPerspective'];
				// test for each property
				for(var i in props){
					if(div.style[props[i]] !== undefined){
						slider.cssPrefix = props[i].replace('Perspective', '').toLowerCase();
						slider.animProp = '-' + slider.cssPrefix + '-transform';
						return true;
					}
				}
				return false;
			}());
			// if vertical mode always make maxSlides and minSlides equal
			if(slider.settings.mode === 'vertical'){ slider.settings.maxSlides = slider.settings.minSlides; }
			// save original style data
			el.data("origStyle", el.attr("style"));
			el.children(slider.settings.slideSelector).each(function(){
			  $(this).data("origStyle", $(this).attr("style"));
			});
			// perform all DOM / CSS modifications
			setup();
		};

		/**
		 * Performs all DOM and CSS modifications
		 */
		var setup = function(){
			// wrap el in a wrapper
			el.wrap('<div class="' + slider.settings.wrapperClass + '"><div class="bx-viewport"></div></div>');
			// store a namespace reference to .bx-viewport
			slider.viewport = el.parent();
			// add a loading div to display while images are loading
			slider.loader = $('<div class="bx-loading" />');
			slider.viewport.prepend(slider.loader);
			// set el to a massive width, to hold any needed slides
			// also strip any margin and padding from el
			el.css({
				width: slider.settings.mode === 'horizontal' ? (slider.children.length * 1000 + 215) + '%' : 'auto',
				position: 'absolute'
			});
			// if using CSS, add the easing property
			if(slider.usingCSS && slider.settings.easing){
				el.css('-' + slider.cssPrefix + '-transition-timing-function', slider.settings.easing);
			// if not using CSS and no easing value was supplied, use the default JS animation easing (swing)
			}else if(!slider.settings.easing){
				slider.settings.easing = 'swing';
			}
			var slidesShowing = getNumberSlidesShowing();
			// make modifications to the viewport (.bx-viewport)
			slider.viewport.css({
				width: '100%',
				overflow: 'hidden',
				position: 'relative'
			});
			slider.viewport.parent().css({
				maxWidth: getViewportMaxWidth()
			});
			// make modification to the wrapper (.bx-wrapper)
			if(!slider.settings.pager && !slider.settings.controls){
				slider.viewport.parent().css({
					margin: '0 auto 0px'
				});
			}
			// apply css to all slider children
			slider.children.css({
				'float': slider.settings.mode === 'horizontal' ? 'left' : 'none',
				listStyle: 'none',
				position: 'relative'
			});
			// apply the calculated width after the float is applied to prevent scrollbar interference
			slider.children.css('width', getSlideWidth());
			// if slideMargin is supplied, add the css
			if(slider.settings.mode === 'horizontal' && slider.settings.slideMargin > 0){ slider.children.css('marginRight', slider.settings.slideMargin); }
			if(slider.settings.mode === 'vertical' && slider.settings.slideMargin > 0){ slider.children.css('marginBottom', slider.settings.slideMargin); }
			// if "fade" mode, add positioning and z-index CSS
			if(slider.settings.mode === 'fade'){
				slider.children.css({
					position: 'absolute',
					zIndex: 0,
					display: 'none'
				});
				// prepare the z-index on the showing element
				slider.children.eq(slider.settings.startSlide).css({zIndex: slider.settings.slideZIndex, display: 'block'});
			}
			// create an element to contain all slider controls (pager, start / stop, etc)
			slider.controls.el = $('<div class="bx-controls" />');
			// if captions are requested, add them
			if(slider.settings.captions){ appendCaptions(); }
			// check if startSlide is last slide
			slider.active.last = slider.settings.startSlide === getPagerQty() - 1;
			// if video is true, set up the fitVids plugin
			if(slider.settings.video){ el.fitVids(); }
			// set the default preload selector (visible)
			var preloadSelector = slider.children.eq(slider.settings.startSlide);
			if(slider.settings.preloadImages === "all" || slider.settings.ticker){ preloadSelector = slider.children; }
			// only check for control addition if not in "ticker" mode
			if(!slider.settings.ticker){
				// if controls are requested, add them
				if(slider.settings.controls){ appendControls(); }
				// if auto is true, and auto controls are requested, add them
				if(slider.settings.auto && slider.settings.autoControls){ appendControlsAuto(); }
				// if pager is requested, add it
				if(slider.settings.pager){ appendPager(); }
				// if any control option is requested, add the controls wrapper
				if(slider.settings.controls || slider.settings.autoControls || slider.settings.pager){ slider.viewport.after(slider.controls.el); }
			// if ticker mode, do not allow a pager
			} else {
				slider.settings.pager = false;
			}
			loadElements(preloadSelector, start);
		};

		var loadElements = function(selector, callback){
			var total = selector.find('img:not([src=""]), iframe').length;
			if(total === 0){
				callback();
				return;
			}
			var count = 0;
			selector.find('img:not([src=""]), iframe').each(function(){
				$(this).one('load error', function(){
				  if(++count === total){ callback(); }
				}).each(function(){
				  if(this.complete){ $(this).load(); }
				});
			});
		};

		/**
		 * Start the slider
		 */
		var start = function(){
			// if infinite loop, prepare additional slides
			if(slider.settings.infiniteLoop && slider.settings.mode !== 'fade' && !slider.settings.ticker){
				var slice = slider.settings.mode === 'vertical' ? slider.settings.minSlides : slider.settings.maxSlides;
				var sliceAppend = slider.children.slice(0, slice).clone(true).addClass('bx-clone');
				var slicePrepend = slider.children.slice(-slice).clone(true).addClass('bx-clone');
				el.append(sliceAppend).prepend(slicePrepend);
			}
			// remove the loading DOM element
			slider.loader.remove();
			// set the left / top position of "el"
			setSlidePosition();
			// if "vertical" mode, always use adaptiveHeight to prevent odd behavior
			if(slider.settings.mode === 'vertical'){ slider.settings.adaptiveHeight = true; }
			// set the viewport height
			slider.viewport.height(getViewportHeight());
			// make sure everything is positioned just right (same as a window resize)
			el.redrawSlider();
			// onSliderLoad callback
			slider.settings.onSliderLoad(slider,slider.active.index);
			// slider has been fully initialized
			slider.initialized = true;
			// bind the resize call to the window
			if(slider.settings.responsive){ $(window).bind('resize', resizeWindow); }
			// if auto is true and has more than 1 page, start the show
			if(slider.settings.auto && slider.settings.autoStart && (getPagerQty() > 1 || slider.settings.autoSlideForOnePage)){ initAuto(); }
			// if ticker is true, start the ticker
			if(slider.settings.ticker){ initTicker(); }
			// if pager is requested, make the appropriate pager link active
			if(slider.settings.pager){ updatePagerActive(slider.settings.startSlide); }
			// check for any updates to the controls (like hideControlOnEnd updates)
			if(slider.settings.controls){ updateDirectionControls(); }
			// if touchEnabled is true, setup the touch events
			if(slider.settings.touchEnabled && !slider.settings.ticker){ initTouch(); }
			// if keyboardEnabled is true, setup the keyboard events
			if (slider.settings.keyboardEnabled && !slider.settings.ticker) { 
				$(document).keydown(keyPress);
			}
		};

		/**
		 * Returns the calculated height of the viewport, used to determine either adaptiveHeight or the maxHeight value
		 */
		var getViewportHeight = function(){
			var height = 0;
			// first determine which children (slides) should be used in our height calculation
			var children = $();
			// if mode is not "vertical" and adaptiveHeight is false, include all children
			if(slider.settings.mode !== 'vertical' && !slider.settings.adaptiveHeight){
				children = slider.children;
			}else{
				// if not carousel, return the single active child
				if(!slider.carousel){
					children = slider.children.eq(slider.active.index);
				// if carousel, return a slice of children
				}else{
					// get the individual slide index
					var currentIndex = slider.settings.moveSlides === 1 ? slider.active.index : slider.active.index * getMoveBy();
					// add the current slide to the children
					children = slider.children.eq(currentIndex);
					// cycle through the remaining "showing" slides
					for (i = 1; i <= slider.settings.maxSlides - 1; i++){
						// if looped back to the start
						if(currentIndex + i >= slider.children.length){
							children = children.add(slider.children.eq(i - 1));
						}else{
							children = children.add(slider.children.eq(currentIndex + i));
						}
					}
				}
			}
			// if "vertical" mode, calculate the sum of the heights of the children
			if(slider.settings.mode === 'vertical'){
				children.each(function(index){
				  height += $(this).outerHeight();
				});
				// add user-supplied margins
				if(slider.settings.slideMargin > 0){
					height += slider.settings.slideMargin * (slider.settings.minSlides - 1);
				}
			// if not "vertical" mode, calculate the max height of the children
			}else{
				height = Math.max.apply(Math, children.map(function(){
					return $(this).outerHeight(false);
				}).get());
			}

			if(slider.viewport.css('box-sizing') === 'border-box'){
				height +=	parseFloat(slider.viewport.css('padding-top')) + parseFloat(slider.viewport.css('padding-bottom')) +
							parseFloat(slider.viewport.css('border-top-width')) + parseFloat(slider.viewport.css('border-bottom-width'));
			}else if(slider.viewport.css('box-sizing') === 'padding-box'){
				height +=	parseFloat(slider.viewport.css('padding-top')) + parseFloat(slider.viewport.css('padding-bottom'));
			}

			return height;
		};

		/**
		 * Returns the calculated width to be used for the outer wrapper / viewport
		 */
		var getViewportMaxWidth = function(){
			var width = '100%';
			if(slider.settings.slideWidth > 0){
				if(slider.settings.mode === 'horizontal'){
					width = (slider.settings.maxSlides * slider.settings.slideWidth) + ((slider.settings.maxSlides - 1) * slider.settings.slideMargin);
				}else{
					width = slider.settings.slideWidth;
				}
			}
			return width;
		};

		/**
		 * Returns the calculated width to be applied to each slide
		 */
		var getSlideWidth = function(){
			// start with any user-supplied slide width
			var newElWidth = slider.settings.slideWidth;
			// get the current viewport width
			var wrapWidth = slider.viewport.width();
			// if slide width was not supplied, or is larger than the viewport use the viewport width
			if(slider.settings.slideWidth === 0 ||
				(slider.settings.slideWidth > wrapWidth && !slider.carousel) ||
				slider.settings.mode === 'vertical'){
				newElWidth = wrapWidth;
			// if carousel, use the thresholds to determine the width
			}else if(slider.settings.maxSlides > 1 && slider.settings.mode === 'horizontal'){
				if(wrapWidth > slider.maxThreshold){
					// newElWidth = (wrapWidth - (slider.settings.slideMargin * (slider.settings.maxSlides - 1))) / slider.settings.maxSlides;
				}else if(wrapWidth < slider.minThreshold){
					newElWidth = (wrapWidth - (slider.settings.slideMargin * (slider.settings.minSlides - 1))) / slider.settings.minSlides;
				}
			}
			return newElWidth;
		};

		/**
		 * Returns the number of slides currently visible in the viewport (includes partially visible slides)
		 */
		var getNumberSlidesShowing = function(){
			var slidesShowing = 1;
			if(slider.settings.mode === 'horizontal' && slider.settings.slideWidth > 0){
				// if viewport is smaller than minThreshold, return minSlides
				if(slider.viewport.width() < slider.minThreshold){
					slidesShowing = slider.settings.minSlides;
				// if viewport is larger than maxThreshold, return maxSlides
				}else if(slider.viewport.width() > slider.maxThreshold){
					slidesShowing = slider.settings.maxSlides;
				// if viewport is between min / max thresholds, divide viewport width by first child width
				}else{
					var childWidth = slider.children.first().width() + slider.settings.slideMargin;
					slidesShowing = Math.floor((slider.viewport.width() +
						slider.settings.slideMargin) / childWidth);
				}
			// if "vertical" mode, slides showing will always be minSlides
			}else if(slider.settings.mode === 'vertical'){
				slidesShowing = slider.settings.minSlides;
			}
			return slidesShowing;
		};

		/**
		 * Returns the number of pages (one full viewport of slides is one "page")
		 */
		var getPagerQty = function(){
			var pagerQty = 0;
			// if moveSlides is specified by the user
			if(slider.settings.moveSlides > 0){
				if(slider.settings.infiniteLoop){
					pagerQty = Math.ceil(slider.children.length / getMoveBy());
				}else{
					// use a while loop to determine pages
					var breakPoint = 0;
					var counter = 0;
					// when breakpoint goes above children length, counter is the number of pages
					while (breakPoint < slider.children.length){
						++pagerQty;
						breakPoint = counter + getNumberSlidesShowing();
						counter += slider.settings.moveSlides <= getNumberSlidesShowing() ? slider.settings.moveSlides : getNumberSlidesShowing();
					}
				}
			// if moveSlides is 0 (auto) divide children length by sides showing, then round up
			}else{
				pagerQty = Math.ceil(slider.children.length / getNumberSlidesShowing());
			}
			return pagerQty;
		};

		/**
		 * Returns the number of individual slides by which to shift the slider
		 */
		var getMoveBy = function(){
			// if moveSlides was set by the user and moveSlides is less than number of slides showing
			if(slider.settings.moveSlides > 0 && slider.settings.moveSlides <= getNumberSlidesShowing()){
				return slider.settings.moveSlides;
			}
			// if moveSlides is 0 (auto)
			return getNumberSlidesShowing();
		};

		/**
		 * Sets the slider's (el) left or top position
		 */
		var setSlidePosition = function(){
			var position;
			// if last slide, not infinite loop, and number of children is larger than specified maxSlides
			if(slider.children.length > slider.settings.maxSlides && slider.active.last && !slider.settings.infiniteLoop){
				if(slider.settings.mode === 'horizontal'){
					// get the last child's position
					var lastChild = slider.children.last();
					position = lastChild.position();
					// set the left position
					setPositionProperty(-(position.left - (slider.viewport.width() - lastChild.outerWidth())), 'reset', 0);
				}else if(slider.settings.mode === 'vertical'){
					// get the last showing index's position
					var lastShowingIndex = slider.children.length - slider.settings.minSlides;
					position = slider.children.eq(lastShowingIndex).position();
					// set the top position
					setPositionProperty(-position.top, 'reset', 0);
				}
			// if not last slide
			}else{
				// get the position of the first showing slide
				position = slider.children.eq(slider.active.index * getMoveBy()).position();
				// check for last slide
				if(slider.active.index === getPagerQty() - 1){ slider.active.last = true; }
				// set the respective position
				if(position !== undefined){
					if(slider.settings.mode === 'horizontal'){ setPositionProperty(-position.left, 'reset', 0); }
					else if(slider.settings.mode === 'vertical'){ setPositionProperty(-position.top, 'reset', 0); }
				}
			}
		};

		/**
		 * Sets the el's animating property position (which in turn will sometimes animate el).
		 * If using CSS, sets the transform property. If not using CSS, sets the top / left property.
		 *
		 * @param value (int)
		 *  - the animating property's value
		 *
		 * @param type (string) 'slide', 'reset', 'ticker'
		 *  - the type of instance for which the function is being
		 *
		 * @param duration (int)
		 *  - the amount of time (in ms) the transition should occupy
		 *
		 * @param params (array) optional
		 *  - an optional parameter containing any variables that need to be passed in
		 */
		var setPositionProperty = function(value, type, duration, params){
			// use CSS transform
			if(slider.usingCSS){
				// determine the translate3d value
				var propValue = slider.settings.mode === 'vertical' ? 'translate3d(0, ' + value + 'px, 0)' : 'translate3d(' + value + 'px, 0, 0)';
				// add the CSS transition-duration
				el.css('-' + slider.cssPrefix + '-transition-duration', duration / 1000 + 's');
				if(type === 'slide'){
					setTimeout(function() {
						// set the property value
						el.css(slider.animProp, propValue);
						// if value 0, just update
						if(value === 0) {
							updateAfterSlideTransition();
						} else {
							// bind a callback method - executes when CSS transition completes
							el.bind('transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd', function(){
								// unbind the callback
								el.unbind('transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd');
								updateAfterSlideTransition();
							});
						}
					}, 0);
				}else if(type === 'reset'){
					el.css(slider.animProp, propValue);
				}else if(type === 'ticker'){
					// make the transition use 'linear'
					el.css('-' + slider.cssPrefix + '-transition-timing-function', 'linear');
					el.css(slider.animProp, propValue);
					// bind a callback method - executes when CSS transition completes
					el.bind('transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd', function(){
						// unbind the callback
						el.unbind('transitionend webkitTransitionEnd oTransitionEnd MSTransitionEnd');
						// reset the position
						setPositionProperty(params.resetValue, 'reset', 0);
						// start the loop again
						tickerLoop();
					});
				}
			// use JS animate
			}else{
				var animateObj = {};
				animateObj[slider.animProp] = value;
				if(type === 'slide'){
					el.animate(animateObj, duration, slider.settings.easing, function(){
						updateAfterSlideTransition();
					});
				}else if(type === 'reset'){
					el.css(slider.animProp, value);
				}else if(type === 'ticker'){
					el.animate(animateObj, speed, 'linear', function(){
						setPositionProperty(params.resetValue, 'reset', 0);
						// run the recursive loop after animation
						tickerLoop();
					});
				}
			}
		};

		/**
		 * Populates the pager with proper amount of pages
		 */
		var populatePager = function(){
			var pagerHtml = '';
			var pagerQty = getPagerQty();
                        // console.log('pagerQty = '+ pagerQty);
			// loop through each pager item
			for(var i=0; i < pagerQty; i++){
				var linkContent = '';
				// if a buildPager function is supplied, use it to get pager link value, else use index + 1
				if(slider.settings.buildPager && $.isFunction(slider.settings.buildPager) || slider.settings.pagerCustom){
					linkContent = slider.settings.buildPager(i);
					slider.pagerEl.addClass('bx-custom-pager');
				}else{
					linkContent = i + 1;
					slider.pagerEl.addClass('bx-default-pager');
				}
				// var linkContent = slider.settings.buildPager && $.isFunction(slider.settings.buildPager) ? slider.settings.buildPager(i) : i + 1;
				// add the markup to the string
				pagerHtml += '<div class="bx-pager-item"><a href="" data-slide-index="' + i + '" class="bx-pager-link">' + linkContent + '</a></div>';
			}
			// populate the pager element with pager links
                        if(pagerQty > 1)
                            slider.pagerEl.html(pagerHtml);
		};

		/**
		 * Appends the pager to the controls element
		 */
		var appendPager = function(){
			if(!slider.settings.pagerCustom){
				// create the pager DOM element
				slider.pagerEl = $('<div class="bx-pager" />');
				// if a pager selector was supplied, populate it with the pager
				if(slider.settings.pagerSelector){
					$(slider.settings.pagerSelector).html(slider.pagerEl);
				// if no pager selector was supplied, add it after the wrapper
				}else{
					slider.controls.el.addClass('bx-has-pager').append(slider.pagerEl);
				}
				// populate the pager
				populatePager();
			}else{
				slider.pagerEl = $(slider.settings.pagerCustom);
			}
			// assign the pager click binding
			slider.pagerEl.on('click touchend', 'a', clickPagerBind);
		};

		/**
		 * Appends prev / next controls to the controls element
		 */
		var appendControls = function(){
			slider.controls.next = $('<a class="bx-next" href="">' + slider.settings.nextText + '</a>');
			slider.controls.prev = $('<a class="bx-prev" href="">' + slider.settings.prevText + '</a>');
			// bind click actions to the controls
			slider.controls.next.bind('click touchend', clickNextBind);
			slider.controls.prev.bind('click touchend', clickPrevBind);
			// if nextSelector was supplied, populate it
			if(slider.settings.nextSelector){
				$(slider.settings.nextSelector).append(slider.controls.next);
			}
			// if prevSelector was supplied, populate it
			if(slider.settings.prevSelector){
				$(slider.settings.prevSelector).append(slider.controls.prev);
			}
			// if no custom selectors were supplied
			if(!slider.settings.nextSelector && !slider.settings.prevSelector){
				// add the controls to the DOM
				slider.controls.directionEl = $('<div class="bx-controls-direction" />');
				// add the control elements to the directionEl
				slider.controls.directionEl.append(slider.controls.prev).append(slider.controls.next);
				// slider.viewport.append(slider.controls.directionEl);
				slider.controls.el.addClass('bx-has-controls-direction').append(slider.controls.directionEl);
			}
		};

		/**
		 * Appends start / stop auto controls to the controls element
		 */
		var appendControlsAuto = function(){
			slider.controls.start = $('<div class="bx-controls-auto-item"><a class="bx-start" href="">' + slider.settings.startText + '</a></div>');
			slider.controls.stop = $('<div class="bx-controls-auto-item"><a class="bx-stop" href="">' + slider.settings.stopText + '</a></div>');
			// add the controls to the DOM
			slider.controls.autoEl = $('<div class="bx-controls-auto" />');
			// bind click actions to the controls
			slider.controls.autoEl.on('click', '.bx-start', clickStartBind);
			slider.controls.autoEl.on('click', '.bx-stop', clickStopBind);
			// if autoControlsCombine, insert only the "start" control
			if(slider.settings.autoControlsCombine){
				slider.controls.autoEl.append(slider.controls.start);
			// if autoControlsCombine is false, insert both controls
			}else{
				slider.controls.autoEl.append(slider.controls.start).append(slider.controls.stop);
			}
			// if auto controls selector was supplied, populate it with the controls
			if(slider.settings.autoControlsSelector){
				$(slider.settings.autoControlsSelector).html(slider.controls.autoEl);
			// if auto controls selector was not supplied, add it after the wrapper
			}else{
				slider.controls.el.addClass('bx-has-controls-auto').append(slider.controls.autoEl);
			}
			// update the auto controls
			updateAutoControls(slider.settings.autoStart ? 'stop' : 'start');
		};

		/**
		 * Appends image captions to the DOM
		 */
		var appendCaptions = function(){
			// cycle through each child
			slider.children.each(function(index){
				// get the image title attribute
				var title = $(this).find('img:first').attr('title');
				// append the caption
				if(title !== undefined && ('' + title).length){
					$(this).append('<div class="bx-caption"><span>' + title + '</span></div>');
				}
			});
		};

		/**
		 * Click next binding
		 *
		 * @param e (event)
		 *  - DOM event object
		 */
		var clickNextBind = function(e){
			e.preventDefault();
			if (slider.controls.el.hasClass('disabled')) {
				return;
			}
			// if auto show is running, stop it
			if(slider.settings.auto){ el.stopAuto(); }
			el.goToNextSlide();
		};

		/**
		 * Click prev binding
		 *
		 * @param e (event)
		 *  - DOM event object
		 */
		var clickPrevBind = function(e){
			e.preventDefault();
			if (slider.controls.el.hasClass('disabled')) {
				return;
			}
			// if auto show is running, stop it
			if(slider.settings.auto){ el.stopAuto(); }
			el.goToPrevSlide();
		};

		/**
		 * Click start binding
		 *
		 * @param e (event)
		 *  - DOM event object
		 */
		var clickStartBind = function(e){
			el.startAuto();
			e.preventDefault();
		};

		/**
		 * Click stop binding
		 *
		 * @param e (event)
		 *  - DOM event object
		 */
		var clickStopBind = function(e){
			el.stopAuto();
			e.preventDefault();
		};

		/**
		 * Click pager binding
		 *
		 * @param e (event)
		 *  - DOM event object
		 */
		var clickPagerBind = function(e){
			e.preventDefault();
			if (slider.controls.el.hasClass('disabled')) {
				return;
			}
			// if auto show is running, stop it
			if(slider.settings.auto){ el.stopAuto(); }
			var pagerLink = $(e.currentTarget);
			if(pagerLink.attr('data-slide-index') !== undefined){
				var pagerIndex = parseInt(pagerLink.attr('data-slide-index'));
				// if clicked pager link is not active, continue with the goToSlide call
				if(pagerIndex !== slider.active.index){ el.goToSlide(pagerIndex); }
			}
		};

		/**
		 * Updates the pager links with an active class
		 *
		 * @param slideIndex (int)
		 *  - index of slide to make active
		 */
		var updatePagerActive = function(slideIndex){
			// if "short" pager type
			var len = slider.children.length; // nb of children
			if(slider.settings.pagerType === 'short'){
				if(slider.settings.maxSlides > 1){
					len = Math.ceil(slider.children.length/slider.settings.maxSlides);
				}
				slider.pagerEl.html( (slideIndex + 1) + slider.settings.pagerShortSeparator + len);
				return;
			}
			// remove all pager active classes
			slider.pagerEl.find('a').removeClass('active');
			// apply the active class for all pagers
			slider.pagerEl.each(function(i, el){ $(el).find('a').eq(slideIndex).addClass('active'); });
		};

		/**
		 * Performs needed actions after a slide transition
		 */
		var updateAfterSlideTransition = function(){
			// if infinite loop is true
			if(slider.settings.infiniteLoop){
				var position = '';
				// first slide
				if(slider.active.index === 0){
					// set the new position
					position = slider.children.eq(0).position();
				// carousel, last slide
				}else if(slider.active.index === getPagerQty() - 1 && slider.carousel){
					position = slider.children.eq((getPagerQty() - 1) * getMoveBy()).position();
				// last slide
				}else if(slider.active.index === slider.children.length - 1){
					position = slider.children.eq(slider.children.length - 1).position();
				}
				if(position){
					if(slider.settings.mode === 'horizontal'){ setPositionProperty(-position.left, 'reset', 0); }
					else if(slider.settings.mode === 'vertical'){ setPositionProperty(-position.top, 'reset', 0); }
				}
			}
			// declare that the transition is complete
			slider.working = false;
			// onSlideAfter callback
			slider.settings.onSlideAfter(slider.children.eq(slider.active.index), slider.oldIndex, slider.active.index);
		};

		/**
		 * Updates the auto controls state (either active, or combined switch)
		 *
		 * @param state (string) "start", "stop"
		 *  - the new state of the auto show
		 */
		var updateAutoControls = function(state){
			// if autoControlsCombine is true, replace the current control with the new state
			if(slider.settings.autoControlsCombine){
				slider.controls.autoEl.html(slider.controls[state]);
			// if autoControlsCombine is false, apply the "active" class to the appropriate control
			}else{
				slider.controls.autoEl.find('a').removeClass('active');
				slider.controls.autoEl.find('a:not(.bx-' + state + ')').addClass('active');
			}
		};

		/**
		 * Updates the direction controls (checks if either should be hidden)
		 */
		var updateDirectionControls = function(){
			if(getPagerQty() === 1){
				slider.controls.prev.addClass('disabled');
				slider.controls.next.addClass('disabled');
			}else if(!slider.settings.infiniteLoop && slider.settings.hideControlOnEnd){
				// if first slide
				if(slider.active.index === 0){
					slider.controls.prev.addClass('disabled');
					slider.controls.next.removeClass('disabled');
				// if last slide
				}else if(slider.active.index === getPagerQty() - 1){
					slider.controls.next.addClass('disabled');
					slider.controls.prev.removeClass('disabled');
				// if any slide in the middle
				}else{
					slider.controls.prev.removeClass('disabled');
					slider.controls.next.removeClass('disabled');
				}
			}
		};

		/**
		 * Initializes the auto process
		 */
		var initAuto = function(){
			// if autoDelay was supplied, launch the auto show using a setTimeout() call
			if(slider.settings.autoDelay > 0){
				var timeout = setTimeout(el.startAuto, slider.settings.autoDelay);
			// if autoDelay was not supplied, start the auto show normally
			}else{
				el.startAuto();

				//add focus and blur events to ensure its running if timeout gets paused
				$(window).focus(function() {
					el.startAuto();
				}).blur(function() {
					el.stopAuto();
				});
				

			}
			// if autoHover is requested
			if(slider.settings.autoHover){
				// on el hover
				el.hover(function(){
					// if the auto show is currently playing (has an active interval)
					if(slider.interval){
						// stop the auto show and pass true argument which will prevent control update
						el.stopAuto(true);
						// create a new autoPaused value which will be used by the relative "mouseout" event
						slider.autoPaused = true;
					}
				}, function(){
					// if the autoPaused value was created be the prior "mouseover" event
					if(slider.autoPaused){
						// start the auto show and pass true argument which will prevent control update
						el.startAuto(true);
						// reset the autoPaused value
						slider.autoPaused = null;
					}
				});
			}
		};

		/**
		 * Initializes the ticker process
		 */
		var initTicker = function(){
			var startPosition = 0;
			// if autoDirection is "next", append a clone of the entire slider
			if(slider.settings.autoDirection === 'next'){
				el.append(slider.children.clone().addClass('bx-clone'));
			// if autoDirection is "prev", prepend a clone of the entire slider, and set the left position
			}else{
				el.prepend(slider.children.clone().addClass('bx-clone'));
				var position = slider.children.first().position();
				startPosition = slider.settings.mode === 'horizontal' ? -position.left : -position.top;
			}
			setPositionProperty(startPosition, 'reset', 0);
			// do not allow controls in ticker mode
			slider.settings.pager = false;
			slider.settings.controls = false;
			slider.settings.autoControls = false;
			// if autoHover is requested
			if(slider.settings.tickerHover){
				if(slider.usingCSS){
					var value;
					var idx = slider.settings.mode == 'horizontal' ? 4 : 5;
					slider.viewport.hover(function(){
						var transform = el.css('-' + slider.cssPrefix + '-transform');
						value = parseFloat(transform.split(',')[idx]);
						setPositionProperty(value, 'reset', 0);
					}, function(){
						var totalDimens = 0;
						slider.children.each(function(index){
						  totalDimens += slider.settings.mode == 'horizontal' ? $(this).outerWidth(true) : $(this).outerHeight(true);
						});
						// calculate the speed ratio (used to determine the new speed to finish the paused animation)
						var ratio = slider.settings.speed / totalDimens;
						// determine which property to use
						var property = slider.settings.mode == 'horizontal' ? 'left' : 'top';
						// calculate the new speed
						var newSpeed = ratio * (totalDimens - (Math.abs(parseInt(value))));
						tickerLoop(newSpeed);
					});
				} else {
					// on el hover
					slider.viewport.hover(function(){
						el.stop();
					}, function(){
						// calculate the total width of children (used to calculate the speed ratio)
						var totalDimens = 0;
						slider.children.each(function(index){
						  totalDimens += slider.settings.mode == 'horizontal' ? $(this).outerWidth(true) : $(this).outerHeight(true);
						});
						// calculate the speed ratio (used to determine the new speed to finish the paused animation)
						var ratio = slider.settings.speed / totalDimens;
						// determine which property to use
						var property = slider.settings.mode == 'horizontal' ? 'left' : 'top';
						// calculate the new speed
						var newSpeed = ratio * (totalDimens - (Math.abs(parseInt(el.css(property)))));
						tickerLoop(newSpeed);
					});
				}
			}
			// start the ticker loop
			tickerLoop();
		};

		/**
		 * Runs a continuous loop, news ticker-style
		 */
		var tickerLoop = function(resumeSpeed){
			speed = resumeSpeed ? resumeSpeed : slider.settings.speed;
			var position = {left: 0, top: 0};
			var reset = {left: 0, top: 0};
			// if "next" animate left position to last child, then reset left to 0
			if(slider.settings.autoDirection === 'next'){
				position = el.find('.bx-clone').first().position();
			// if "prev" animate left position to 0, then reset left to first non-clone child
			}else{
				reset = slider.children.first().position();
			}
			var animateProperty = slider.settings.mode === 'horizontal' ? -position.left : -position.top;
			var resetValue = slider.settings.mode === 'horizontal' ? -reset.left : -reset.top;
			var params = {resetValue: resetValue};
			setPositionProperty(animateProperty, 'ticker', speed, params);
		};

		/**
		 * Check if el is on screen
		 */
		var isOnScreen = function(el){
			var win = $(window);
			var viewport = {
				top : win.scrollTop(),
				left : win.scrollLeft()
			};
			viewport.right = viewport.left + win.width();
			viewport.bottom = viewport.top + win.height();

			var bounds = el.offset();
			bounds.right = bounds.left + el.outerWidth();
			bounds.bottom = bounds.top + el.outerHeight();

			return (!(viewport.right < bounds.left || viewport.left > bounds.right || viewport.bottom < bounds.top || viewport.top > bounds.bottom));
		};

		/**
		 * Initializes keyboard events
		 */
		var keyPress = function(e){
			var activeElementTag = document.activeElement.tagName.toLowerCase();
			var tagFilters='input|textarea';
			var p = new RegExp(activeElementTag,["i"]);
			var result = p.exec(tagFilters);
			if (result == null && isOnScreen(el)) {
				if (e.keyCode == 39) {
					clickNextBind(e);
					return false;
				}
				else if (e.keyCode == 37) {
					clickPrevBind(e);
					return false;
				}
			}
		};

		/**
		 * Initializes touch events
		 */
		var initTouch = function(){
			// initialize object to contain all touch values
			slider.touch = {
				start: {x: 0, y: 0},
				end: {x: 0, y: 0}
			};
			slider.viewport.bind('touchstart MSPointerDown pointerdown', onTouchStart);
			
			//for browsers that have implemented pointer events and fire a click after
			//every pointerup regardless of whether pointerup is on same screen location as pointerdown or not
			slider.viewport.on('click', '.bxslider a', function(e) {
				if (slider.viewport.hasClass('click-disabled')) {
					e.preventDefault();
					slider.viewport.removeClass('click-disabled');
				}
			});
		};

		/**
		 * Event handler for "touchstart"
		 *
		 * @param e (event)
		 *  - DOM event object
		 */
		var onTouchStart = function(e){
			//disable slider controls while user is interacting with slides to avoid slider freeze that happens on touch devices when a slide swipe happens immediately after interacting with slider controls
			slider.controls.el.addClass('disabled');

			if(slider.working){
				e.preventDefault();
				slider.controls.el.removeClass('disabled');
			}else{
				// record the original position when touch starts
				slider.touch.originalPos = el.position();
				var orig = e.originalEvent;
				var touchPoints = (typeof orig.changedTouches != 'undefined') ? orig.changedTouches : [orig];
				// record the starting touch x, y coordinates
				slider.touch.start.x = touchPoints[0].pageX;
				slider.touch.start.y = touchPoints[0].pageY;

				if (slider.viewport.get(0).setPointerCapture) {
					slider.pointerId = orig.pointerId;
					slider.viewport.get(0).setPointerCapture(slider.pointerId);
				}
				// bind a "touchmove" event to the viewport
				slider.viewport.bind('touchmove MSPointerMove pointermove', onTouchMove);
				// bind a "touchend" event to the viewport
				slider.viewport.bind('touchend MSPointerUp pointerup', onTouchEnd);
				slider.viewport.bind('MSPointerCancel pointercancel', onPointerCancel);
			}
		};

		/**
		 * Cancel Pointer for Windows Phone
		 *
		 * @param e (event)
		 *  - DOM event object
		 */
		var onPointerCancel = function(e) {
		/* onPointerCancel handler is needed to deal with situations when a touchend
		doesn't fire after a touchstart (this happens on windows phones only) */
			setPositionProperty(slider.touch.originalPos.left, 'reset', 0);

			//remove handlers
			slider.controls.el.removeClass('disabled');
			slider.viewport.unbind('MSPointerCancel pointercancel', onPointerCancel);
			slider.viewport.unbind('touchmove MSPointerMove pointermove', onTouchMove);
			slider.viewport.unbind('touchend MSPointerUp pointerup', onTouchEnd);
			if (slider.viewport.get(0).releasePointerCapture) {
				slider.viewport.get(0).releasePointerCapture(slider.pointerId);
 			}
		}

		/**
		 * Event handler for "touchmove"
		 *
		 * @param e (event)
		 *  - DOM event object
		 */
		var onTouchMove = function(e){
			var orig = e.originalEvent;
			var touchPoints = (typeof orig.changedTouches != 'undefined') ? orig.changedTouches : [orig];
			// if scrolling on y axis, do not prevent default
			var xMovement = Math.abs(touchPoints[0].pageX - slider.touch.start.x);
			var yMovement = Math.abs(touchPoints[0].pageY - slider.touch.start.y);
			// x axis swipe
			if((xMovement * 3) > yMovement && slider.settings.preventDefaultSwipeX){
				e.preventDefault();
			// y axis swipe
			}else if((yMovement * 3) > xMovement && slider.settings.preventDefaultSwipeY){
				e.preventDefault();
			}
			if(slider.settings.mode !== 'fade' && slider.settings.oneToOneTouch){
				var value = 0, change = 0;
				// if horizontal, drag along x axis
				if(slider.settings.mode === 'horizontal'){
					change = touchPoints[0].pageX - slider.touch.start.x;
					value = slider.touch.originalPos.left + change;
				// if vertical, drag along y axis
				}else{
					change = touchPoints[0].pageY - slider.touch.start.y;
					value = slider.touch.originalPos.top + change;
				}
				setPositionProperty(value, 'reset', 0);
			}
		};

		/**
		 * Event handler for "touchend"
		 *
		 * @param e (event)
		 *  - DOM event object
		 */
		var onTouchEnd = function(e){
			slider.viewport.unbind('touchmove MSPointerMove pointermove', onTouchMove);
			//enable slider controls as soon as user stops interacing with slides
			slider.controls.el.removeClass('disabled');
			var orig = e.originalEvent;
			var touchPoints = (typeof orig.changedTouches != 'undefined') ? orig.changedTouches : [orig];
			var value = 0;
			var distance = 0;
			// record end x, y positions
			slider.touch.end.x = touchPoints[0].pageX;
			slider.touch.end.y = touchPoints[0].pageY;
			// if fade mode, check if absolute x distance clears the threshold
			if(slider.settings.mode === 'fade'){
				distance = Math.abs(slider.touch.start.x - slider.touch.end.x);
				if(distance >= slider.settings.swipeThreshold){
					if(slider.touch.start.x > slider.touch.end.x){
						el.goToNextSlide();
					} else {
						el.goToPrevSlide();
					} 
					el.stopAuto();
				}
			// not fade mode
			}else{
				// calculate distance and el's animate property
				if(slider.settings.mode === 'horizontal'){
					distance = slider.touch.end.x - slider.touch.start.x;
					value = slider.touch.originalPos.left;
				}else{
					distance = slider.touch.end.y - slider.touch.start.y;
					value = slider.touch.originalPos.top;
				}
				// if not infinite loop and first / last slide, do not attempt a slide transition
				if(!slider.settings.infiniteLoop && ((slider.active.index === 0 && distance > 0) || (slider.active.last && distance < 0))){
					setPositionProperty(value, 'reset', 200);
				}else{
					// check if distance clears threshold
					if(Math.abs(distance) >= slider.settings.swipeThreshold){
						if(distance < 0){
							el.goToNextSlide();
						} else {
							el.goToPrevSlide();
						} 
						el.stopAuto();
					}else{
						// el.animate(property, 200);
						setPositionProperty(value, 'reset', 200);
					}
				}
			}
			slider.viewport.unbind('touchend MSPointerUp pointerup', onTouchEnd);
			if (slider.viewport.get(0).releasePointerCapture) {
				slider.viewport.get(0).releasePointerCapture(slider.pointerId);
			}
		};

		/**
		 * Window resize event callback
		 */
		var resizeWindow = function(e){
			// don't do anything if slider isn't initialized.
			if(!slider.initialized){ return; }
			// Delay if slider working.
			if (slider.working) {
				window.setTimeout(resizeWindow, 10);
			} else {
				// get the new window dimens (again, thank you IE)
				var windowWidthNew = $(window).width();
				var windowHeightNew = $(window).height();
				// make sure that it is a true window resize
				// *we must check this because our dinosaur friend IE fires a window resize event when certain DOM elements
				// are resized. Can you just die already?*
				if(windowWidth !== windowWidthNew || windowHeight !== windowHeightNew){
					// set the new window dimens
					windowWidth = windowWidthNew;
					windowHeight = windowHeightNew;
					// update all dynamic elements
					el.redrawSlider();
					// Call user resize handler
					slider.settings.onSliderResize.call(el, slider.active.index);
				}
			}
		};

		/**
		 * ===================================================================================
		 * = PUBLIC FUNCTIONS
		 * ===================================================================================
		 */

		/**
		 * Performs slide transition to the specified slide
		 *
		 * @param slideIndex (int)
		 *  - the destination slide's index (zero-based)
		 *
		 * @param direction (string)
		 *  - INTERNAL USE ONLY - the direction of travel ("prev" / "next")
		 */
		el.goToSlide = function(slideIndex, direction){
			// if plugin is currently in motion, ignore request
			if(slider.working || slider.active.index === slideIndex){ return; }
			// declare that plugin is in motion
			slider.working = true;
			// store the old index
			slider.oldIndex = slider.active.index;
			// if slideIndex is less than zero, set active index to last child (this happens during infinite loop)
			if(slideIndex < 0){
				slider.active.index = getPagerQty() - 1;
			// if slideIndex is greater than children length, set active index to 0 (this happens during infinite loop)
			}else if(slideIndex >= getPagerQty()){
				slider.active.index = 0;
			// set active index to requested slide
			}else{
				slider.active.index = slideIndex;
			}
			// onSlideBefore, onSlideNext, onSlidePrev callbacks
			// Allow transition canceling based on returned value
			var performTransition = true;

			performTransition = slider.settings.onSlideBefore(slider.children.eq(slider.active.index), slider.oldIndex, slider.active.index);
			
			if ( typeof(performTransition) !== "undefined" && !performTransition ) {
				slider.active.index = slider.oldIndex; // restore old index
				slider.working = false; // is not in motion
				return;	
			}
			if(direction === 'next'){
				// Prevent canceling in future functions or lack there-of from negating previous commands to cancel
				if(!slider.settings.onSlideNext(slider.children.eq(slider.active.index), slider.oldIndex, slider.active.index)){
					performTransition = false;
				}
			}else if(direction === 'prev'){
				// Prevent canceling in future functions or lack there-of from negating previous commands to cancel
				if(!slider.settings.onSlidePrev(slider.children.eq(slider.active.index), slider.oldIndex, slider.active.index)){
					performTransition = false;
				}
			}

			// If transitions canceled, reset and return
			if ( typeof(performTransition) !== "undefined" && !performTransition ) {
				slider.active.index = slider.oldIndex; // restore old index
				slider.working = false; // is not in motion
				return;	
			}

			// check if last slide
			slider.active.last = slider.active.index >= getPagerQty() - 1;
			// update the pager with active class
			if(slider.settings.pager || slider.settings.pagerCustom){ updatePagerActive(slider.active.index); }
			// // check for direction control update
			if(slider.settings.controls){ updateDirectionControls(); }
			// if slider is set to mode: "fade"
			if(slider.settings.mode === 'fade'){
				// if adaptiveHeight is true and next height is different from current height, animate to the new height
				if(slider.settings.adaptiveHeight && slider.viewport.height() !== getViewportHeight()){
					slider.viewport.animate({height: getViewportHeight()}, slider.settings.adaptiveHeightSpeed);
				}
				// fade out the visible child and reset its z-index value
				slider.children.filter(':visible').fadeOut(slider.settings.speed).css({zIndex: 0});
				// fade in the newly requested slide
				slider.children.eq(slider.active.index).css('zIndex', slider.settings.slideZIndex+1).fadeIn(slider.settings.speed, function(){
					$(this).css('zIndex', slider.settings.slideZIndex);
					updateAfterSlideTransition();
				});
			// slider mode is not "fade"
			}else{
				// if adaptiveHeight is true and next height is different from current height, animate to the new height
				if(slider.settings.adaptiveHeight && slider.viewport.height() !== getViewportHeight()){
					slider.viewport.animate({height: getViewportHeight()}, slider.settings.adaptiveHeightSpeed);
				}
				var moveBy = 0;
				var position = {left: 0, top: 0};
				var lastChild = null;
				// if carousel and not infinite loop
				if(!slider.settings.infiniteLoop && slider.carousel && slider.active.last){
					if(slider.settings.mode === 'horizontal'){
						// get the last child position
						lastChild = slider.children.eq(slider.children.length - 1);
						position = lastChild.position();
						// calculate the position of the last slide
						moveBy = slider.viewport.width() - lastChild.outerWidth();
					}else{
						// get last showing index position
						var lastShowingIndex = slider.children.length - slider.settings.minSlides;
						position = slider.children.eq(lastShowingIndex).position();
					}
					// horizontal carousel, going previous while on first slide (infiniteLoop mode)
				}else if(slider.carousel && slider.active.last && direction === 'prev'){
					// get the last child position
					var eq = slider.settings.moveSlides === 1 ? slider.settings.maxSlides - getMoveBy() : ((getPagerQty() - 1) * getMoveBy()) - (slider.children.length - slider.settings.maxSlides);
					lastChild = el.children('.bx-clone').eq(eq);
					position = lastChild.position();
				// if infinite loop and "Next" is clicked on the last slide
				}else if(direction === 'next' && slider.active.index === 0){
					// get the last clone position
					position = el.find('> .bx-clone').eq(slider.settings.maxSlides).position();
					slider.active.last = false;
				// normal non-zero requests
				}else if(slideIndex >= 0){
					var requestEl = slideIndex * getMoveBy();
					position = slider.children.eq(requestEl).position();
				}

				
				/* If the position doesn't exist
				 * (e.g. if you destroy the slider on a next click),
				 * it doesn't throw an error.
				 */
				if("undefined" !== typeof(position)){
					var value = slider.settings.mode === 'horizontal' ? -(position.left - moveBy) : -position.top;
					// plugin values to be animated
					setPositionProperty(value, 'slide', slider.settings.speed);
				}
			}
		};

		/**
		 * Transitions to the next slide in the show
		 */
		el.goToNextSlide = function(){
			// if infiniteLoop is false and last page is showing, disregard call
			if(!slider.settings.infiniteLoop && slider.active.last){ return; }
			var pagerIndex = parseInt(slider.active.index) + 1;
			el.goToSlide(pagerIndex, 'next');
		};

		/**
		 * Transitions to the prev slide in the show
		 */
		el.goToPrevSlide = function(){
			// if infiniteLoop is false and last page is showing, disregard call
			if(!slider.settings.infiniteLoop && slider.active.index === 0){ return; }
			var pagerIndex = parseInt(slider.active.index) - 1;
			el.goToSlide(pagerIndex, 'prev');
		};

		/**
		 * Starts the auto show
		 *
		 * @param preventControlUpdate (boolean)
		 *  - if true, auto controls state will not be updated
		 */
		el.startAuto = function(preventControlUpdate){
			// if an interval already exists, disregard call
			if(slider.interval){ return; }
			// create an interval
			slider.interval = setInterval(function(){
				if(slider.settings.autoDirection === 'next'){ 
					el.goToNextSlide(); 
				}else{
					el.goToPrevSlide();
				}
			}, slider.settings.pause);
			// if auto controls are displayed and preventControlUpdate is not true
			if(slider.settings.autoControls && preventControlUpdate !== true){ updateAutoControls('stop'); }
		};

		/**
		 * Stops the auto show
		 *
		 * @param preventControlUpdate (boolean)
		 *  - if true, auto controls state will not be updated
		 */
		el.stopAuto = function(preventControlUpdate){
			// if no interval exists, disregard call
			if(!slider.interval){ return; }
			// clear the interval
			clearInterval(slider.interval);
			slider.interval = null;
			// if auto controls are displayed and preventControlUpdate is not true
			if(slider.settings.autoControls && preventControlUpdate !== true){ updateAutoControls('start'); }
		};

		/**
		 * Returns current slide index (zero-based)
		 */
		el.getCurrentSlide = function(){
			return slider.active.index;
		};

		/**
		 * Returns current slide element
		 */
		el.getCurrentSlideElement = function(){
			return slider.children.eq(slider.active.index);
		};

		/**
		 * Returns number of slides in show
		 */
		el.getSlideCount = function(){
			return slider.children.length;
		};

		/**
		 * Return slider.working variable
		 */
		el.isWorking = function() {
			return slider.working;
		}

		/**
		 * Update all dynamic slider elements
		 */
		el.redrawSlider = function(){
			// resize all children in ratio to new screen size
			slider.children.add(el.find('.bx-clone')).outerWidth(getSlideWidth());
			// adjust the height
			slider.viewport.css('height', getViewportHeight());
			// update the slide position
			if(!slider.settings.ticker) { setSlidePosition(); }                 
			// if active.last was true before the screen resize, we want
			// to keep it last no matter what screen size we end on
			if (slider.active.last) { slider.active.index = getPagerQty() - 1; }
			// if the active index (page) no longer exists due to the resize, simply set the index as last
			if (slider.active.index >= getPagerQty()) { slider.active.last = true; }
			// if a pager is being displayed and a custom pager is not being used, update it
			if(slider.settings.pager && !slider.settings.pagerCustom){
				populatePager();
				updatePagerActive(slider.active.index);
			}
		};

		/**
		 * Destroy the current instance of the slider (revert everything back to original state)
		 */
		el.destroySlider = function(){
			// don't do anything if slider has already been destroyed
			if(!slider.initialized){ return; }
			slider.initialized = false;
			$('.bx-clone', this).remove();
			slider.children.each(function(){
				if($(this).data("origStyle") !== undefined){
					$(this).attr("style", $(this).data("origStyle"));
				} else {
					$(this).removeAttr('style');
				}
			});
			if($(this).data("origStyle") !== undefined){
				this.attr("style", $(this).data("origStyle"));
			} else {
				$(this).removeAttr('style');
			}
			$(this).unwrap().unwrap();
			if(slider.controls.el){ slider.controls.el.remove(); }
			if(slider.controls.next){ slider.controls.next.remove(); }
			if(slider.controls.prev){ slider.controls.prev.remove(); }
			if(slider.pagerEl && slider.settings.controls && !slider.settings.pagerCustom){ slider.pagerEl.remove(); }
			$('.bx-caption', this).remove();
			if(slider.controls.autoEl){ slider.controls.autoEl.remove(); }
			clearInterval(slider.interval);
			if(slider.settings.responsive){ $(window).unbind('resize', resizeWindow); }
			if(slider.settings.keyboardEnabled){ $(document).unbind('keydown', keyPress); }
		};

		/**
		 * Reload the slider (revert all DOM changes, and re-initialize)
		 */
		el.reloadSlider = function(settings){
			if(settings !== undefined){ options = settings; }
			el.destroySlider();
			init();
		};

		init();

		// returns the current jQuery object
		return this;
	};

})(jQuery);

(function(e){e.fn.ddslick=function(l){if(c[l]){return c[l].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof l==="object"||!l){return c.init.apply(this,arguments)}else{e.error("Method "+l+" does not exists.")}}};var c={},d={data:[],keepJSONItemsOnTop:false,width:260,height:null,background:"#eee",selectText:"",defaultSelectedIndex:null,truncateDescription:true,imagePosition:"left",showSelectedHTML:true,clickOffToClose:true,embedCSS:true,onSelected:function(){}},i='<div class="dd-select"><input class="dd-selected-value" type="hidden" /><a class="dd-selected"></a><span class="dd-pointer dd-pointer-down"></span></div>',a='<ul class="dd-options"></ul>',b='<style id="css-ddslick" type="text/css">.dd-select{ border-radius:2px; border:solid 1px #ccc; position:relative; cursor:pointer;}.dd-desc { color:#aaa; display:block; overflow: hidden; font-weight:normal; line-height: 1.4em; }.dd-selected{ overflow:hidden; display:block; padding:10px; font-weight:bold;}.dd-pointer{ width:0; height:0; position:absolute; right:10px; top:50%; margin-top:-3px;}.dd-pointer-down{ border:solid 5px transparent; border-top:solid 5px #000; }.dd-pointer-up{border:solid 5px transparent !important; border-bottom:solid 5px #000 !important; margin-top:-8px;}.dd-options{ border:solid 1px #ccc; border-top:none; list-style:none; box-shadow:0px 1px 5px #ddd; display:none; position:absolute; z-index:2000; margin:0; padding:0;background:#fff; overflow:auto;}.dd-option{ padding:10px; display:block; border-bottom:solid 1px #ddd; overflow:hidden; text-decoration:none; color:#333; cursor:pointer;-webkit-transition: all 0.25s ease-in-out; -moz-transition: all 0.25s ease-in-out;-o-transition: all 0.25s ease-in-out;-ms-transition: all 0.25s ease-in-out; }.dd-options > li:last-child > .dd-option{ border-bottom:none;}.dd-option:hover{ background:#f3f3f3; color:#000;}.dd-selected-description-truncated { text-overflow: ellipsis; white-space:nowrap; }.dd-option-selected { background:#f6f6f6; }.dd-option-image, .dd-selected-image { vertical-align:middle; float:left; margin-right:5px; max-width:64px;}.dd-image-right { float:right; margin-right:15px; margin-left:5px;}.dd-container{ position:relative;}​ .dd-selected-text { font-weight:bold}​</style>';c.init=function(l){var l=e.extend({},d,l);if(e("#css-ddslick").length<=0&&l.embedCSS){e(b).appendTo("head")}return this.each(function(){var p=e(this),q=p.data("ddslick");if(!q){var n=[],o=l.data;p.find("option").each(function(){var w=e(this),v=w.data();n.push({text:e.trim(w.text()),value:w.val(),selected:w.is(":selected"),description:v.description,imageSrc:v.imagesrc})});if(l.keepJSONItemsOnTop){e.merge(l.data,n)}else{l.data=e.merge(n,l.data)}var m=p,s=e('<div id="'+p.attr("id")+'"></div>');p.replaceWith(s);p=s;p.addClass("dd-container").append(i).append(a);var n=p.find(".dd-select"),u=p.find(".dd-options");u.css({width:l.width});n.css({width:l.width,background:l.background});p.css({width:l.width});if(l.height!=null){u.css({height:l.height,overflow:"auto"})}e.each(l.data,function(v,w){if(w.selected){l.defaultSelectedIndex=v}u.append('<li><a class="dd-option">'+(w.value?' <input class="dd-option-value" type="hidden" value="'+w.value+'" />':"")+(w.imageSrc?' <img class="dd-option-image'+(l.imagePosition=="right"?" dd-image-right":"")+'" src="'+w.imageSrc+'" />':"")+(w.text?' <label class="dd-option-text">'+w.text+"</label>":"")+(w.description?' <small class="dd-option-description dd-desc">'+w.description+"</small>":"")+"</a></li>")});var t={settings:l,original:m,selectedIndex:-1,selectedItem:null,selectedData:null};p.data("ddslick",t);if(l.selectText.length>0&&l.defaultSelectedIndex==null){p.find(".dd-selected").html(l.selectText)}else{var r=(l.defaultSelectedIndex!=null&&l.defaultSelectedIndex>=0&&l.defaultSelectedIndex<l.data.length)?l.defaultSelectedIndex:0;j(p,r)}p.find(".dd-select").on("click.ddslick",function(){f(p)});p.find(".dd-option").on("click.ddslick",function(){j(p,e(this).closest("li").index())});if(l.clickOffToClose){u.addClass("dd-click-off-close");p.on("click.ddslick",function(v){v.stopPropagation()});e("body").on("click",function(){e(".dd-click-off-close").slideUp(50).siblings(".dd-select").find(".dd-pointer").removeClass("dd-pointer-up")})}}})};c.select=function(l){return this.each(function(){if(l.index!==undefined){j(e(this),l.index)}})};c.open=function(){return this.each(function(){var m=e(this),l=m.data("ddslick");if(l){f(m)}})};c.close=function(){return this.each(function(){var m=e(this),l=m.data("ddslick");if(l){k(m)}})};c.destroy=function(){return this.each(function(){var n=e(this),m=n.data("ddslick");if(m){var l=m.original;n.removeData("ddslick").unbind(".ddslick").replaceWith(l)}})};function j(q,s){var u=q.data("ddslick");var r=q.find(".dd-selected"),n=r.siblings(".dd-selected-value"),v=q.find(".dd-options"),l=r.siblings(".dd-pointer"),p=q.find(".dd-option").eq(s),m=p.closest("li"),o=u.settings,t=u.settings.data[s];q.find(".dd-option").removeClass("dd-option-selected");p.addClass("dd-option-selected");u.selectedIndex=s;u.selectedItem=m;u.selectedData=t;if(o.showSelectedHTML){r.html((t.imageSrc?'<img class="dd-selected-image'+(o.imagePosition=="right"?" dd-image-right":"")+'" src="'+t.imageSrc+'" />':"")+(t.text?'<label class="dd-selected-text">'+t.text+"</label>":"")+(t.description?'<small class="dd-selected-description dd-desc'+(o.truncateDescription?" dd-selected-description-truncated":"")+'" >'+t.description+"</small>":""))}else{r.html(t.text)}n.val(t.value);u.original.val(t.value);q.data("ddslick",u);k(q);g(q);if(typeof o.onSelected=="function"){o.onSelected.call(this,u)}}function f(p){var o=p.find(".dd-select"),m=o.siblings(".dd-options"),l=o.find(".dd-pointer"),n=m.is(":visible");e(".dd-click-off-close").not(m).slideUp(50);e(".dd-pointer").removeClass("dd-pointer-up");if(n){m.slideUp("fast");l.removeClass("dd-pointer-up")}else{m.slideDown("fast");l.addClass("dd-pointer-up")}h(p)}function k(l){l.find(".dd-options").slideUp(50);l.find(".dd-pointer").removeClass("dd-pointer-up").removeClass("dd-pointer-up")}function g(o){var n=o.find(".dd-select").css("height");var m=o.find(".dd-selected-description");var l=o.find(".dd-selected-image");if(m.length<=0&&l.length>0){o.find(".dd-selected-text").css("lineHeight",n)}}function h(l){l.find(".dd-option").each(function(){var p=e(this);var n=p.css("height");var o=p.find(".dd-option-description");var m=l.find(".dd-option-image");if(o.length<=0&&m.length>0){p.find(".dd-option-text").css("lineHeight",n)}})}})(jQuery);

/**
 * Lightbox v2.7.1
 * by Lokesh Dhakar - http://lokeshdhakar.com/projects/lightbox2/
 *
 * @license http://creativecommons.org/licenses/by/2.5/
 * - Free for use in both personal and commercial projects
 * - Attribution requires leaving author name, author link, and the license info intact
 */

(function() {
  // Use local alias
  var $ = jQuery;

  var LightboxOptions = (function() {
    function LightboxOptions() {
      this.fadeDuration                = 500;
      this.fitImagesInViewport         = true;
      this.resizeDuration              = 700;
      this.positionFromTop             = 50;
      this.showImageNumberLabel        = true;
      this.alwaysShowNavOnTouchDevices = false;
      this.wrapAround                  = false;
    }
    
    // Change to localize to non-english language
    LightboxOptions.prototype.albumLabel = function(curImageNum, albumSize) {
      return "Image " + curImageNum + " of " + albumSize;
    };

    return LightboxOptions;
  })();


  var Lightbox = (function() {
    function Lightbox(options) {
      this.options           = options;
      this.album             = [];
      this.currentImageIndex = void 0;
      this.init();
    }

    Lightbox.prototype.init = function() {
      this.enable();
      this.build();
    };

    // Loop through anchors and areamaps looking for either data-lightbox attributes or rel attributes
    // that contain 'lightbox'. When these are clicked, start lightbox.
    Lightbox.prototype.enable = function() {
      var self = this;
      $('body').on('click', 'a[rel^=lightbox], area[rel^=lightbox], a[data-lightbox], area[data-lightbox]', function(event) {
        self.start($(event.currentTarget));
        return false;
      });
    };

    // Build html for the lightbox and the overlay.
    // Attach event handlers to the new DOM elements. click click click
    Lightbox.prototype.build = function() {
      var self = this;
      $("<div id='lightboxOverlay' class='lightboxOverlay'></div><div id='lightbox' class='lightbox'><div class='lb-outerContainer'><div class='lb-container'><img class='lb-image' src='' /><div class='lb-nav'><a class='lb-prev' href='' ></a><a class='lb-next' href='' ></a></div><div class='lb-loader'><a class='lb-cancel'></a></div></div></div><div class='lb-dataContainer'><div class='lb-data'><div class='lb-details'><span class='lb-caption'></span><span class='lb-number'></span></div><div class='lb-closeContainer'><a class='lb-close'></a></div></div></div></div>").appendTo($('body'));
      
      // Cache jQuery objects
      this.$lightbox       = $('#lightbox');
      this.$overlay        = $('#lightboxOverlay');
      this.$outerContainer = this.$lightbox.find('.lb-outerContainer');
      this.$container      = this.$lightbox.find('.lb-container');

      // Store css values for future lookup
      this.containerTopPadding = parseInt(this.$container.css('padding-top'), 10);
      this.containerRightPadding = parseInt(this.$container.css('padding-right'), 10);
      this.containerBottomPadding = parseInt(this.$container.css('padding-bottom'), 10);
      this.containerLeftPadding = parseInt(this.$container.css('padding-left'), 10);
      
      // Attach event handlers to the newly minted DOM elements
      this.$overlay.hide().on('click', function() {
        self.end();
        return false;
      });

      this.$lightbox.hide().on('click', function(event) {
        if ($(event.target).attr('id') === 'lightbox') {
          self.end();
        }
        return false;
      });

      this.$outerContainer.on('click', function(event) {
        if ($(event.target).attr('id') === 'lightbox') {
          self.end();
        }
        return false;
      });

      this.$lightbox.find('.lb-prev').on('click', function() {
        if (self.currentImageIndex === 0) {
          self.changeImage(self.album.length - 1);
        } else {
          self.changeImage(self.currentImageIndex - 1);
        }
        return false;
      });

      this.$lightbox.find('.lb-next').on('click', function() {
        if (self.currentImageIndex === self.album.length - 1) {
          self.changeImage(0);
        } else {
          self.changeImage(self.currentImageIndex + 1);
        }
        return false;
      });

      this.$lightbox.find('.lb-loader, .lb-close').on('click', function() {
        self.end();
        return false;
      });
    };

    // Show overlay and lightbox. If the image is part of a set, add siblings to album array.
    Lightbox.prototype.start = function($link) {
      var self    = this;
      var $window = $(window);

      $window.on('resize', $.proxy(this.sizeOverlay, this));

      $('select, object, embed').css({
        visibility: "hidden"
      });

      this.sizeOverlay();

      this.album = [];
      var imageNumber = 0;

      function addToAlbum($link) {
        self.album.push({
          link: $link.attr('href'),
          title: $link.attr('data-title') || $link.attr('title')
        });
      }

      // Support both data-lightbox attribute and rel attribute implementations
      var dataLightboxValue = $link.attr('data-lightbox');
      var $links;

      if (dataLightboxValue) {
        $links = $($link.prop("tagName") + '[data-lightbox="' + dataLightboxValue + '"]');
        for (var i = 0; i < $links.length; i = ++i) {
          addToAlbum($($links[i]));
          if ($links[i] === $link[0]) {
            imageNumber = i;
          }
        }
      } else {
        if ($link.attr('rel') === 'lightbox') {
          // If image is not part of a set
          addToAlbum($link);
        } else {
          // If image is part of a set
          $links = $($link.prop("tagName") + '[rel="' + $link.attr('rel') + '"]');
          for (var j = 0; j < $links.length; j = ++j) {
            addToAlbum($($links[j]));
            if ($links[j] === $link[0]) {
              imageNumber = j;
            }
          }
        }
      }
      
      // Position Lightbox
      var top  = $window.scrollTop() + this.options.positionFromTop;
      var left = $window.scrollLeft();
      this.$lightbox.css({
        top: top + 'px',
        left: left + 'px'
      }).fadeIn(this.options.fadeDuration);

      this.changeImage(imageNumber);
    };

    // Hide most UI elements in preparation for the animated resizing of the lightbox.
    Lightbox.prototype.changeImage = function(imageNumber) {
      var self = this;

      this.disableKeyboardNav();
      var $image = this.$lightbox.find('.lb-image');

      this.$overlay.fadeIn(this.options.fadeDuration);

      $('.lb-loader').fadeIn('slow');
      this.$lightbox.find('.lb-image, .lb-nav, .lb-prev, .lb-next, .lb-dataContainer, .lb-numbers, .lb-caption').hide();

      this.$outerContainer.addClass('animating');

      // When image to show is preloaded, we send the width and height to sizeContainer()
      var preloader = new Image();
      preloader.onload = function() {
        var $preloader, imageHeight, imageWidth, maxImageHeight, maxImageWidth, windowHeight, windowWidth;
        $image.attr('src', self.album[imageNumber].link);

        $preloader = $(preloader);

        $image.width(preloader.width);
        $image.height(preloader.height);
        
        if (self.options.fitImagesInViewport) {
          // Fit image inside the viewport.
          // Take into account the border around the image and an additional 10px gutter on each side.

          windowWidth    = $(window).width();
          windowHeight   = $(window).height();
          maxImageWidth  = windowWidth - self.containerLeftPadding - self.containerRightPadding - 20;
          maxImageHeight = windowHeight - self.containerTopPadding - self.containerBottomPadding - 120;

          // Is there a fitting issue?
          if ((preloader.width > maxImageWidth) || (preloader.height > maxImageHeight)) {
            if ((preloader.width / maxImageWidth) > (preloader.height / maxImageHeight)) {
              imageWidth  = maxImageWidth;
              imageHeight = parseInt(preloader.height / (preloader.width / imageWidth), 10);
              $image.width(imageWidth);
              $image.height(imageHeight);
            } else {
              imageHeight = maxImageHeight;
              imageWidth = parseInt(preloader.width / (preloader.height / imageHeight), 10);
              $image.width(imageWidth);
              $image.height(imageHeight);
            }
          }
        }
        self.sizeContainer($image.width(), $image.height());
      };

      preloader.src          = this.album[imageNumber].link;
      this.currentImageIndex = imageNumber;
    };

    // Stretch overlay to fit the viewport
    Lightbox.prototype.sizeOverlay = function() {
      this.$overlay
        .width($(window).width())
        .height($(document).height());
    };

    // Animate the size of the lightbox to fit the image we are showing
    Lightbox.prototype.sizeContainer = function(imageWidth, imageHeight) {
      var self = this;
      
      var oldWidth  = this.$outerContainer.outerWidth();
      var oldHeight = this.$outerContainer.outerHeight();
      var newWidth  = imageWidth + this.containerLeftPadding + this.containerRightPadding;
      var newHeight = imageHeight + this.containerTopPadding + this.containerBottomPadding;
      
      function postResize() {
        self.$lightbox.find('.lb-dataContainer').width(newWidth);
        self.$lightbox.find('.lb-prevLink').height(newHeight);
        self.$lightbox.find('.lb-nextLink').height(newHeight);
        self.showImage();
      }

      if (oldWidth !== newWidth || oldHeight !== newHeight) {
        this.$outerContainer.animate({
          width: newWidth,
          height: newHeight
        }, this.options.resizeDuration, 'swing', function() {
          postResize();
        });
      } else {
        postResize();
      }
    };

    // Display the image and it's details and begin preload neighboring images.
    Lightbox.prototype.showImage = function() {
      this.$lightbox.find('.lb-loader').hide();
      this.$lightbox.find('.lb-image').fadeIn('slow');
    
      this.updateNav();
      this.updateDetails();
      this.preloadNeighboringImages();
      this.enableKeyboardNav();
    };

    // Display previous and next navigation if appropriate.
    Lightbox.prototype.updateNav = function() {
      // Check to see if the browser supports touch events. If so, we take the conservative approach
      // and assume that mouse hover events are not supported and always show prev/next navigation
      // arrows in image sets.
      var alwaysShowNav = false;
      try {
        document.createEvent("TouchEvent");
        alwaysShowNav = (this.options.alwaysShowNavOnTouchDevices)? true: false;
      } catch (e) {}

      this.$lightbox.find('.lb-nav').show();

      if (this.album.length > 1) {
        if (this.options.wrapAround) {
          if (alwaysShowNav) {
            this.$lightbox.find('.lb-prev, .lb-next').css('opacity', '1');
          }
          this.$lightbox.find('.lb-prev, .lb-next').show();
        } else {
          if (this.currentImageIndex > 0) {
            this.$lightbox.find('.lb-prev').show();
            if (alwaysShowNav) {
              this.$lightbox.find('.lb-prev').css('opacity', '1');
            }
          }
          if (this.currentImageIndex < this.album.length - 1) {
            this.$lightbox.find('.lb-next').show();
            if (alwaysShowNav) {
              this.$lightbox.find('.lb-next').css('opacity', '1');
            }
          }
        }
      }
    };

    // Display caption, image number, and closing button.
    Lightbox.prototype.updateDetails = function() {
      var self = this;

      // Enable anchor clicks in the injected caption html.
      // Thanks Nate Wright for the fix. @https://github.com/NateWr
      if (typeof this.album[this.currentImageIndex].title !== 'undefined' && this.album[this.currentImageIndex].title !== "") {
        this.$lightbox.find('.lb-caption')
          .html(this.album[this.currentImageIndex].title)
          .fadeIn('fast')
          .find('a').on('click', function(event){
            location.href = $(this).attr('href');
          });
      }
    
      if (this.album.length > 1 && this.options.showImageNumberLabel) {
        this.$lightbox.find('.lb-number').text(this.options.albumLabel(this.currentImageIndex + 1, this.album.length)).fadeIn('fast');
      } else {
        this.$lightbox.find('.lb-number').hide();
      }
    
      this.$outerContainer.removeClass('animating');
    
      this.$lightbox.find('.lb-dataContainer').fadeIn(this.options.resizeDuration, function() {
        return self.sizeOverlay();
      });
    };

    // Preload previous and next images in set.
    Lightbox.prototype.preloadNeighboringImages = function() {
      if (this.album.length > this.currentImageIndex + 1) {
        var preloadNext = new Image();
        preloadNext.src = this.album[this.currentImageIndex + 1].link;
      }
      if (this.currentImageIndex > 0) {
        var preloadPrev = new Image();
        preloadPrev.src = this.album[this.currentImageIndex - 1].link;
      }
    };

    Lightbox.prototype.enableKeyboardNav = function() {
      $(document).on('keyup.keyboard', $.proxy(this.keyboardAction, this));
    };

    Lightbox.prototype.disableKeyboardNav = function() {
      $(document).off('.keyboard');
    };

    Lightbox.prototype.keyboardAction = function(event) {
      var KEYCODE_ESC        = 27;
      var KEYCODE_LEFTARROW  = 37;
      var KEYCODE_RIGHTARROW = 39;

      var keycode = event.keyCode;
      var key     = String.fromCharCode(keycode).toLowerCase();
      if (keycode === KEYCODE_ESC || key.match(/x|o|c/)) {
        this.end();
      } else if (key === 'p' || keycode === KEYCODE_LEFTARROW) {
        if (this.currentImageIndex !== 0) {
          this.changeImage(this.currentImageIndex - 1);
        } else if (this.options.wrapAround && this.album.length > 1) {
          this.changeImage(this.album.length - 1);
        }
      } else if (key === 'n' || keycode === KEYCODE_RIGHTARROW) {
        if (this.currentImageIndex !== this.album.length - 1) {
          this.changeImage(this.currentImageIndex + 1);
        } else if (this.options.wrapAround && this.album.length > 1) {
          this.changeImage(0);
        }
      }
    };

    // Closing time. :-(
    Lightbox.prototype.end = function() {
      this.disableKeyboardNav();
      $(window).off("resize", this.sizeOverlay);
      this.$lightbox.fadeOut(this.options.fadeDuration);
      this.$overlay.fadeOut(this.options.fadeDuration);
      $('select, object, embed').css({
        visibility: "visible"
      });
    };

    return Lightbox;

  })();

  $(function() {
    var options  = new LightboxOptions();
    var lightbox = new Lightbox(options);
  });

}).call(this);

/*!
 * money.js / fx() v0.2
 * Copyright 2014 Open Exchange Rates
 *
 * JavaScript library for realtime currency conversion and exchange rate calculation.
 *
 * Freely distributable under the MIT license.
 * Portions of money.js are inspired by or borrowed from underscore.js
 *
 * For details, examples and documentation:
 * http://openexchangerates.github.io/money.js/
 */
(function(root, undefined) {

	// Create a safe reference to the money.js object for use below.
	var fx = function(obj) {
		return new fxWrapper(obj);
	};

	// Current version.
	fx.version = '0.2';


	/* --- Setup --- */

	// fxSetup can be defined before loading money.js, to set the exchange rates and the base
	// (and default from/to) currencies - or the rates can be loaded in later if needed.
	var fxSetup = root.fxSetup || {
		rates : {},
		base : ""
	};

	// Object containing exchange rates relative to the fx.base currency, eg { "GBP" : "0.64" }
	fx.rates = fxSetup.rates;

	// Default exchange rate base currency (eg "USD"), which all the exchange rates are relative to
	fx.base = fxSetup.base;

	// Default from / to currencies for conversion via fx.convert():
	fx.settings = {
		from : fxSetup.from || fx.base,
		to : fxSetup.to || fx.base
	};


	/* --- Conversion --- */

	// The base function of the library: converts a value from one currency to another
	var convert = fx.convert = function(val, opts) {
		// Convert arrays recursively
		if (typeof val === 'object' && val.length) {
			for (var i = 0; i< val.length; i++ ) {
				val[i] = convert(val[i], opts);
			}
			return val;
		}

		// Make sure we gots some opts
		opts = opts || {};

		// We need to know the `from` and `to` currencies
		if( !opts.from ) opts.from = fx.settings.from;
		if( !opts.to ) opts.to = fx.settings.to;

		// Multiple the value by the exchange rate
		return val * getRate( opts.to, opts.from );
	};

	// Returns the exchange rate to `target` currency from `base` currency
	var getRate = function(to, from) {
		// Save bytes in minified version
		var rates = fx.rates;

		// Make sure the base rate is in the rates object:
		rates[fx.base] = 1;

		// Throw an error if either rate isn't in the rates array
		if ( !rates[to] || !rates[from] ) throw "fx error";

		// If `from` currency === fx.base, return the basic exchange rate for the `to` currency
		if ( from === fx.base ) {
			return rates[to];
		}

		// If `to` currency === fx.base, return the basic inverse rate of the `from` currency
		if ( to === fx.base ) {
			return 1 / rates[from];
		}

		// Otherwise, return the `to` rate multipled by the inverse of the `from` rate to get the
		// relative exchange rate between the two currencies
		return rates[to] * (1 / rates[from]);
	};


	/* --- OOP wrapper and chaining --- */

	// If fx(val) is called as a function, it returns a wrapped object that can be used OO-style
	var fxWrapper = function(val) {
		// Experimental: parse strings to pull out currency code and value:
		if ( typeof	val === "string" ) {
			this._v = parseFloat(val.replace(/[^0-9-.]/g, ""));
			this._fx = val.replace(/([^A-Za-z])/g, "");
		} else {
			this._v = val;
		}
	};

	// Expose `wrapper.prototype` as `fx.prototype`
	var fxProto = fx.prototype = fxWrapper.prototype;

	// fx(val).convert(opts) does the same thing as fx.convert(val, opts)
	fxProto.convert = function() {
		var args = Array.prototype.slice.call(arguments);
		args.unshift(this._v);
		return convert.apply(fx, args);
	};

	// fx(val).from(currency) returns a wrapped `fx` where the value has been converted from
	// `currency` to the `fx.base` currency. Should be followed by `.to(otherCurrency)`
	fxProto.from = function(currency) {
		var wrapped = fx(convert(this._v, {from: currency, to: fx.base}));
		wrapped._fx = fx.base;
		return wrapped;
	};

	// fx(val).to(currency) returns the value, converted from `fx.base` to `currency`
	fxProto.to = function(currency) {
		return convert(this._v, {from: this._fx ? this._fx : fx.settings.from, to: currency});
	};


	/* --- Module Definition --- */

	// Export the fx object for CommonJS. If being loaded as an AMD module, define it as such.
	// Otherwise, just add `fx` to the global object
	if (typeof exports !== 'undefined') {
		if (typeof module !== 'undefined' && module.exports) {
			exports = module.exports = fx;
		}
		exports.fx = fx;
	} else if (typeof define === 'function' && define.amd) {
		// Return the library as an AMD module:
		define([], function() {
			return fx;
		});
	} else {
		// Use fx.noConflict to restore `fx` back to its original value before money.js loaded.
		// Returns a reference to the library's `fx` object; e.g. `var money = fx.noConflict();`
		fx.noConflict = (function(previousFx) {
			return function() {
				// Reset the value of the root's `fx` variable:
				root.fx = previousFx;
				// Delete the noConflict function:
				fx.noConflict = undefined;
				// Return reference to the library to re-assign it:
				return fx;
			};
		})(root.fx);

		// Declare `fx` on the root (global/window) object:
		root['fx'] = fx;
	}

	// Root will be `window` in browser or `global` on the server:
}(this));

/*===================================================================================================================
 * @name: bPopup
 * @type: jQuery
 * @author: (c) Bjoern Klinggaard - @bklinggaard
 * @demo: http://dinbror.dk/bpopup
 * @version: 0.10.0
 * @requires jQuery 1.4.3
 *==================================================================================================================*/
;(function($) {
	'use strict';
	
    $.fn.bPopup = function(options, callback) {
        
    	if ($.isFunction(options)) {
            callback 		= options;
            options 		= null;
        }

		// OPTIONS
        var o 				= $.extend({}, $.fn.bPopup.defaults, options);
		
		// HIDE SCROLLBAR?  
        if (!o.scrollBar)
            $('html').css('overflow', 'hidden');
        
		// VARIABLES	
        var $popup 			= this
          ,  $this                       = $(this)
          , d 				= $(document)
          , w 				= window
		  , $w				= $(w)
          , wH				= windowHeight()
		  , wW				= windowWidth()
          , prefix			= '__b-popup'
		  , isIOS6X			= (/OS 6(_\d)+/i).test(navigator.userAgent) // Used for a temporary fix for ios6 timer bug when using zoom/scroll 
          , buffer			= 200
		  , popups			= 0
          , id
          , inside
          , fixedVPos
          , fixedHPos
          , fixedPosStyle
		  , vPos
          , hPos
		  , height
		  , width
		  , debounce
		  , autoCloseTO
		;

        /* PUBLIC FUNCTION - call it: $(element).bPopup().close();*/
        $popup.close = function() {
            _init();
            _close();
        };
		
        $popup.reposition = function(animateSpeed) {
            reposition(animateSpeed);
        };

        return $popup.each(function() {
            if ($(this).data('bPopup')) return; /*POPUP already exists?*/
            init();
        });

        function _init() {
            triggerCall(o.onOpen);
			popups = ($w.data('bPopup') || 0), 
                        id = prefix + popups + '__',
                        fixedVPos = o.position[1] !== 'auto', 
                        fixedHPos = o.position[0] !== 'auto', 
                        fixedPosStyle = o.positionStyle === 'fixed', 
                        height = $popup.outerHeight(true), 
                        width = $popup.outerWidth(true);
                
            // o.loadUrl ? createContent() : open();
        };
        
        function _close() {
            
            // alert(id, $popup.data('id'), $popup.data('bPopup'));
            if (o.modal) {
                $('.b-modal.'+id)
	                .fadeTo(o.speed, 0, function() {
	                    $(this).remove();
	                });
            }
            // Clean up
            unbindEvents();	
            clearTimeout(autoCloseTO);
            // Close trasition
            doTransition();
            
            return false; // Prevent default
        };

        /* HELPER FUNCTIONS - PRIVATE*/
        function init() {
            triggerCall(o.onOpen);
			popups = ($w.data('bPopup') || 0) + 1, id = prefix + popups + '__',fixedVPos = o.position[1] !== 'auto', fixedHPos = o.position[0] !== 'auto', fixedPosStyle = o.positionStyle === 'fixed', height = $popup.outerHeight(true), width = $popup.outerWidth(true);
            o.loadUrl ? createContent() : open();
        };
		
		function createContent() {
            o.contentContainer = $(o.contentContainer || $popup);
            switch (o.content) {
                case ('iframe'):
					var iframe = $('<iframe class="b-iframe" ' + o.iframeAttr +'></iframe>');
					iframe.appendTo(o.contentContainer);
					height = $popup.outerHeight(true);
					width = $popup.outerWidth(true);
					open();
					iframe.attr('src', o.loadUrl); // setting iframe src after open due IE9 bug
					triggerCall(o.loadCallback);
                    break;
				case ('image'):
					open();
					$('<img />')
						.load(function() {
						    triggerCall(o.loadCallback);
							recenter($(this));
					    }).attr('src', o.loadUrl).hide().appendTo(o.contentContainer);
					break;
                default:
					open();
					$('<div class="b-ajax-wrapper"></div>')
                    	.load(o.loadUrl, o.loadData, function(response, status, xhr) {
						    triggerCall(o.loadCallback, status);
							recenter($(this));
						}).hide().appendTo(o.contentContainer);
                    break;
            }
        };

		function open(){
			// MODAL OVERLAY
            if (o.modal) {
                $('<div class="b-modal '+id+'"></div>')
                .css({backgroundColor: o.modalColor, position: 'fixed', top: 0, right:0, bottom:0, left: 0, opacity: 0, zIndex: o.zIndex + popups})
                .appendTo(o.appendTo)
                .fadeTo(o.speed, o.opacity);
            }
			
			// POPUP
			calcPosition();
            $popup
				.data('bPopup', o).data('id',id)
				.css({ 
					  'left': o.transition == 'slideIn' || o.transition == 'slideBack' ? (o.transition == 'slideBack' ? d.scrollLeft() + wW : (hPos + width) *-1) : getLeftPos(!(!o.follow[0] && fixedHPos || fixedPosStyle))
					, 'position': o.positionStyle || 'absolute'
					, 'top': o.transition == 'slideDown' || o.transition == 'slideUp' ? (o.transition == 'slideUp' ? d.scrollTop() + wH : vPos + height * -1) : getTopPos(!(!o.follow[1] && fixedVPos || fixedPosStyle))
					, 'z-index': o.zIndex + popups + 1 
				}).each(function() {
            		if(o.appending) {
                                $(this).appendTo(o.appendTo);
            		}
        		});
			doTransition(true);	
		};
		
        function close() {
            // console.log(id, $popup.data('id'), $popup.data('bPopup'));
            
            // alert(id, $popup.data('id'), $popup.data('bPopup'));
            if (o.modal) {
                $('.b-modal.'+$popup.data('id'))
	                .fadeTo(o.speed, 0, function() {
	                    $(this).remove();
	                });
            }
            // Clean up
            unbindEvents();	
            clearTimeout(autoCloseTO);
            // Close trasition
            doTransition();
            
            return false; // Prevent default
        };
		
		function reposition(animateSpeed){
            wH = windowHeight();
  		    wW = windowWidth();
			inside = insideWindow();
           	if(inside){
				clearTimeout(debounce);
				debounce = setTimeout(function(){
					calcPosition();
					animateSpeed = animateSpeed || o.followSpeed;
					$popup
                       	.dequeue()
                       	.each(function() {
                           	if(fixedPosStyle) {
                            	$(this).css({ 'left': hPos, 'top': vPos });
                           	}
                           	else {
                               	$(this).animate({ 'left': o.follow[0] ? getLeftPos(true) : 'auto', 'top': o.follow[1] ? getTopPos(true) : 'auto' }, animateSpeed, o.followEasing);
                           	}
                       	});
				}, 50);					
           	}
		};
		
		//Eksperimental
		function recenter(content){
			var _width = content.width(), _height = content.height(), css = {};
			o.contentContainer.css({height:_height,width:_width});
			
			if (_height >= $popup.height()){
				css.height = $popup.height();
			}
			if(_width >= $popup.width()){
				css.width = $popup.width();
			}
			height = $popup.outerHeight(true)
			, width = $popup.outerWidth(true);
				
			calcPosition();
			o.contentContainer.css({height:'auto',width:'auto'});		
			
			css.left = getLeftPos(!(!o.follow[0] && fixedHPos || fixedPosStyle)),
			css.top = getTopPos(!(!o.follow[1] && fixedVPos || fixedPosStyle));
			
			$popup
				.animate(
					css
					, 250
					, function() { 
						content.show();
						inside = insideWindow();
					}
				);
		};
		
        function bindEvents() {
            $w.data('bPopup', popups);
			$popup.delegate('.bClose, .' + o.closeClass, 'click.'+id, close); // legacy, still supporting the close class bClose
            
            if (o.modalClose) {
                $('.b-modal.'+id).css('cursor', 'pointer').bind('click', close);
            }
			
			// Temporary disabling scroll/resize events on devices with IOS6+
			// due to a bug where events are dropped after pinch to zoom
            if (!isIOS6X && (o.follow[0] || o.follow[1])) {
               $w.bind('scroll.'+id, function() {
                	if(inside){
                    	$popup
                        	.dequeue()
                            .animate({ 'left': o.follow[0] ? getLeftPos(!fixedPosStyle) : 'auto', 'top': o.follow[1] ? getTopPos(!fixedPosStyle) : 'auto' }, o.followSpeed, o.followEasing);
					 }  
            	}).bind('resize.'+id, function() {
		            reposition();
                });
            }
            if (o.escClose) {
                d.bind('keydown.'+id, function(e) {
                    if (e.which == 27) {  //escape
                        close();
                    }
                });
            }
        };
		
        function unbindEvents() {
            if (!o.scrollBar) {
                $('html').css('overflow', 'auto');
            }
            $('.b-modal.'+id).unbind('click');
            d.unbind('keydown.'+id);
            $w.unbind('.'+id).data('bPopup', ($w.data('bPopup')-1 > 0) ? $w.data('bPopup')-1 : null);
            $popup.undelegate('.bClose, .' + o.closeClass, 'click.'+id, close).data('bPopup', null);
        };
		
		function doTransition(open) {
			switch (open ? o.transition : o.transitionClose || o.transition) {
			   case "slideIn":
				   	animate({
				   		left: open ? getLeftPos(!(!o.follow[0] && fixedHPos || fixedPosStyle)) : d.scrollLeft() - (width || $popup.outerWidth(true)) - buffer
				   	});
			      	break;
			   case "slideBack":
				   	animate({
				   		left: open ? getLeftPos(!(!o.follow[0] && fixedHPos || fixedPosStyle)) : d.scrollLeft() + wW + buffer
				   	});
			      	break;
			   case "slideDown":
				   	animate({
				   		top: open ? getTopPos(!(!o.follow[1] && fixedVPos || fixedPosStyle)) : d.scrollTop() - (height || $popup.outerHeight(true)) - buffer
				   	});
			      	break;
		   		case "slideUp":
					animate({
						top: open ? getTopPos(!(!o.follow[1] && fixedVPos || fixedPosStyle)) : d.scrollTop() + wH + buffer
					});
		      	  	break;
                                
                        case "fadeOut": 
                                $this.hide();
                                $popup.stop().fadeOut(o.speed);
                            break;
			   default:
			   	  	//Hardtyping 1 and 0 to ensure opacity 1 and not 0.9999998
				  	$popup.stop().fadeTo(o.speed, open ? 1 : 0, function(){onCompleteCallback(open);});
			}
			
			function animate(css){
			  	$popup
					.css({display: 'block',opacity: 1})
					.animate(css, o.speed, o.easing, function(){ onCompleteCallback(open); });
			};
		};
		
		
		function onCompleteCallback(open){
			if(open){
				bindEvents();
	            triggerCall(callback);
				if(o.autoClose){
					autoCloseTO = setTimeout(close, o.autoClose);
				}
			} else {
				$popup.hide();
				triggerCall(o.onClose);
				if (o.loadUrl) {
                    o.contentContainer.empty();
					$popup.css({height: 'auto', width: 'auto'});
                }		
			}
		};
		
		function getLeftPos(includeScroll){
			return includeScroll ? hPos + d.scrollLeft() : hPos;
		};
		
		function getTopPos(includeScroll){
			return includeScroll ? vPos + d.scrollTop() : vPos;
		};
		
		function triggerCall(func, arg) {
			$.isFunction(func) && func.call($popup, arg);
		};
		
       	function calcPosition(){
			vPos 		= fixedVPos ? o.position[1] : Math.max(0, ((wH- $popup.outerHeight(true)) / 2) - o.amsl)
			, hPos 		= fixedHPos ? o.position[0] : (wW - $popup.outerWidth(true)) / 2
			, inside 	= insideWindow();
		};
		
        function insideWindow(){
            return wH > $popup.outerHeight(true) && wW > $popup.outerWidth(true);
        };
		
		function windowHeight(){
			return w.innerHeight || $w.height();
		};
		
		function windowWidth(){
			return w.innerWidth || $w.width();
		};
    };

	/* DEFAULT VALUES */
    $.fn.bPopup.defaults = {
          amsl: 			50
        , appending: 		true
        , appendTo: 		'body'
		, autoClose:		false
        , closeClass: 		'b-close'
        , content: 			'ajax' // ajax, iframe or image
        , contentContainer: false
		, easing: 			'swing'
        , escClose: 		true
        , follow: 			[true, true] // x, y
		, followEasing: 	'swing'
        , followSpeed: 		500
		, iframeAttr: 		'scrolling="no" frameborder="0"'
		, loadCallback: 	false
		, loadData: 		false
        , loadUrl: 			false
        , modal: 			true
        , modalClose: 		true
        , modalColor: 		'#000'
        , onClose: 			false
        , onOpen: 			false
        , opacity: 			0.7
        , position: 		['auto', 'auto'] // x, y,
        , positionStyle: 	'absolute'// absolute or fixed
        , scrollBar: 		true
		, speed: 			250 // open & close speed
		, transition:		'fadeIn' //transitions: fadeIn, slideDown, slideIn, slideBack
		, transitionClose:	false
        , zIndex: 			9997 // popup gets z-index 9999, modal overlay 9998
    };
})(jQuery);

/* ===========================================================
 * jquery.autofix_anything.js v1
 * ===========================================================
 * Copyright 2013 Pete Rojwongsuriya.
 * http://www.thepetedesign.com
 *
 * Fix position of anything on your website automatically
 * with one js call
 *
 * https://github.com/peachananr/autofix_anything
 *
 * ========================================================== */

!function($){
  
  var defaults = {
    customOffset: false,
    manual: false,
    onlyInContainer: true
	};

  $.fn.autofix_anything = function(options){
    var settings = $.extend({}, defaults, options),
        el = $(this),
        curpos = el.position(),
        offset = settings.customOffset,
        pos = el.offset();
        
    el.addClass("autofix_sb")  
    
    $.fn.manualfix = function() {
      var el = $(this),
          pos = el.offset();
      if (el.hasClass("fixed")) {
        el.removeClass("fixed")
      } else {
        el.addClass("fixed").css({
          top: 0,
          left: pos.left,
          right: "auto",
          bottom: "auto"
        });
      }
      
    }
    
    fixAll = function(el, settings, curpos, pos){
      if (settings.customOffset == false) offset =  el.parent().offset().top
      if($(document).scrollTop() > offset && $(document).scrollTop() <= (el.parent().height() + (offset - $(window).height())))  {
          el.removeClass("bottom").addClass("fixed").css({
            top: 0,
            left: pos.left,
            right: "auto",
            bottom: "auto"
          });
      } else {
        if($(document).scrollTop() > offset) {
          if (settings.onlyInContainer == true ) {
            if($(document).scrollTop() > (el.parent().height() - $(window).height())) {
              el.addClass("bottom fixed").removeAttr( 'style' ).css({
                left: curpos.left
              });
            }else {
              el.removeClass("bottom fixed").removeAttr( 'style' );

            }
          }
        } else {
          el.removeClass("bottom fixed").removeAttr( 'style' );
        }
      }
    
    }
    if (settings.manual == false) {
      $(window).scroll(function() {
        fixAll(el, settings, curpos, pos)
      });
    }
    

  }
}(window.jQuery);


// Generated by CoffeeScript 1.9.2

/**
@license Sticky-kit v1.1.2 | WTFPL | Leaf Corcoran 2015 | http://leafo.net
 */
(function() {
  var $, win;

  $ = this.jQuery || window.jQuery;

  win = $(window);

  $.fn.stick_in_parent = function(opts) {
    var doc, elm, enable_bottoming, fn, i, inner_scrolling, len, manual_spacer, offset_top, outer_width, parent_selector, recalc_every, sticky_class;
    if (opts == null) {
      opts = {};
    }
    sticky_class = opts.sticky_class, inner_scrolling = opts.inner_scrolling, recalc_every = opts.recalc_every, parent_selector = opts.parent, offset_top = opts.offset_top, manual_spacer = opts.spacer, enable_bottoming = opts.bottoming;
    if (offset_top == null) {
      offset_top = 0;
    }
    if (parent_selector == null) {
      parent_selector = void 0;
    }
    if (inner_scrolling == null) {
      inner_scrolling = true;
    }
    if (sticky_class == null) {
      sticky_class = "is_stuck";
    }
    doc = $(document);
    if (enable_bottoming == null) {
      enable_bottoming = true;
    }
    outer_width = function(el) {
      var _el, computed, w;
      if (window.getComputedStyle) {
        _el = el[0];
        computed = window.getComputedStyle(el[0]);
        w = parseFloat(computed.getPropertyValue("width")) + parseFloat(computed.getPropertyValue("margin-left")) + parseFloat(computed.getPropertyValue("margin-right"));
        if (computed.getPropertyValue("box-sizing") !== "border-box") {
          w += parseFloat(computed.getPropertyValue("border-left-width")) + parseFloat(computed.getPropertyValue("border-right-width")) + parseFloat(computed.getPropertyValue("padding-left")) + parseFloat(computed.getPropertyValue("padding-right"));
        }
        return w;
      } else {
        return el.outerWidth(true);
      }
    };
    fn = function(elm, padding_bottom, parent_top, parent_height, top, height, el_float, detached) {
      var bottomed, detach, fixed, last_pos, last_scroll_height, offset, parent, recalc, recalc_and_tick, recalc_counter, spacer, tick;
      if (elm.data("sticky_kit")) {
        return;
      }
      elm.data("sticky_kit", true);
      last_scroll_height = doc.height();
      parent = elm.parent();
      if (parent_selector != null) {
        parent = parent.closest(parent_selector);
      }
      if (!parent.length) {
        throw "failed to find stick parent";
      }
      fixed = false;
      bottomed = false;
      spacer = manual_spacer != null ? manual_spacer && elm.closest(manual_spacer) : $("<div />");
      if (spacer) {
        spacer.css('position', elm.css('position'));
      }
      recalc = function() {
        var border_top, padding_top, restore;
        if (detached) {
          return;
        }
        last_scroll_height = doc.height();
        border_top = parseInt(parent.css("border-top-width"), 10);
        padding_top = parseInt(parent.css("padding-top"), 10);
        padding_bottom = parseInt(parent.css("padding-bottom"), 10);
        parent_top = parent.offset().top + border_top + padding_top;
        parent_height = parent.height();
        if (fixed) {
          fixed = false;
          bottomed = false;
          if (manual_spacer == null) {
            elm.insertAfter(spacer);
            spacer.detach();
          }
          elm.css({
            position: "",
            top: "",
            width: "",
            bottom: ""
          }).removeClass(sticky_class);
          restore = true;
        }
        top = elm.offset().top - (parseInt(elm.css("margin-top"), 10) || 0) - offset_top;
        height = elm.outerHeight(true);
        el_float = elm.css("float");
        if (spacer) {
          spacer.css({
            width: outer_width(elm),
            height: height,
            display: elm.css("display"),
            "vertical-align": elm.css("vertical-align"),
            "float": el_float
          });
        }
        if (restore) {
          return tick();
        }
      };
      recalc();
      if (height === parent_height) {
        return;
      }
      last_pos = void 0;
      offset = offset_top;
      recalc_counter = recalc_every;
      tick = function() {
        var css, delta, recalced, scroll, will_bottom, win_height;
        if (detached) {
          return;
        }
        recalced = false;
        if (recalc_counter != null) {
          recalc_counter -= 1;
          if (recalc_counter <= 0) {
            recalc_counter = recalc_every;
            recalc();
            recalced = true;
          }
        }
        if (!recalced && doc.height() !== last_scroll_height) {
          recalc();
          recalced = true;
        }
        scroll = win.scrollTop();
        if (last_pos != null) {
          delta = scroll - last_pos;
        }
        last_pos = scroll;
        if (fixed) {
          if (enable_bottoming) {
            will_bottom = scroll + height + offset > parent_height + parent_top;
            if (bottomed && !will_bottom) {
              bottomed = false;
              elm.css({
                position: "fixed",
                bottom: "",
                top: offset
              }).trigger("sticky_kit:unbottom");
            }
          }
          if (scroll < top) {
            fixed = false;
            offset = offset_top;
            if (manual_spacer == null) {
              if (el_float === "left" || el_float === "right") {
                elm.insertAfter(spacer);
              }
              spacer.detach();
            }
            css = {
              position: "",
              width: "",
              top: ""
            };
            elm.css(css).removeClass(sticky_class).trigger("sticky_kit:unstick");
          }
          if (inner_scrolling) {
            win_height = win.height();
            if (height + offset_top > win_height) {
              if (!bottomed) {
                offset -= delta;
                offset = Math.max(win_height - height, offset);
                offset = Math.min(offset_top, offset);
                if (fixed) {
                  elm.css({
                    top: offset + "px"
                  });
                }
              }
            }
          }
        } else {
          if (scroll > top) {
            fixed = true;
            css = {
              position: "fixed",
              top: offset
            };
            css.width = elm.css("box-sizing") === "border-box" ? elm.outerWidth() + "px" : elm.width() + "px";
            elm.css(css).addClass(sticky_class);
            if (manual_spacer == null) {
              elm.after(spacer);
              if (el_float === "left" || el_float === "right") {
                spacer.append(elm);
              }
            }
            elm.trigger("sticky_kit:stick");
          }
        }
        if (fixed && enable_bottoming) {
          if (will_bottom == null) {
            will_bottom = scroll + height + offset > parent_height + parent_top;
          }
          if (!bottomed && will_bottom) {
            bottomed = true;
            if (parent.css("position") === "static") {
              parent.css({
                position: "relative"
              });
            }
            return elm.css({
              position: "absolute",
              bottom: padding_bottom,
              top: "auto"
            }).trigger("sticky_kit:bottom");
          }
        }
      };
      recalc_and_tick = function() {
        recalc();
        return tick();
      };
      detach = function() {
        detached = true;
        win.off("touchmove", tick);
        win.off("scroll", tick);
        win.off("resize", recalc_and_tick);
        $(document.body).off("sticky_kit:recalc", recalc_and_tick);
        elm.off("sticky_kit:detach", detach);
        elm.removeData("sticky_kit");
        elm.css({
          position: "",
          bottom: "",
          top: "",
          width: ""
        });
        parent.position("position", "");
        if (fixed) {
          if (manual_spacer == null) {
            if (el_float === "left" || el_float === "right") {
              elm.insertAfter(spacer);
            }
            spacer.remove();
          }
          return elm.removeClass(sticky_class);
        }
      };
      win.on("touchmove", tick);
      win.on("scroll", tick);
      win.on("resize", recalc_and_tick);
      $(document.body).on("sticky_kit:recalc", recalc_and_tick);
      elm.on("sticky_kit:detach", detach);
      return setTimeout(tick, 0);
    };
    for (i = 0, len = this.length; i < len; i++) {
      elm = this[i];
      fn($(elm));
    }
    return this;
  };

}).call(this);

/**
 * jQuery syncTranslit plugin
 *
 * Copyright (c) 2009 Snitko Roman
 * Dual licensed under the MIT (MIT-LICENSE.txt)
 * and GPL (GPL-LICENSE.txt) licenses.
 *
 * @author 	Roman Snitko snowcore.net@gmail.com
 * @link http://snowcore.net/
 * @version 0.0.7
 */
;(function($){
    $.fn.syncTranslit = function(options) {
        var opts = $.extend({}, $.fn.syncTranslit.defaults, options);
        if(opts.strtr) {
            return $.fn.syncTranslit.strtr( opts );
        }
        
        return this.each(function() {
            $this = $(this);
            var o = $.meta ? $.extend({}, opts, $this.data()) : opts;
            var $destination = $('#' + opts.destination);
            o.destinationObject = $destination;
            
            // IE always sucks :)
            if (!Array.indexOf) {
                Array.prototype.indexOf = function(obj) {
                    for (var i = 0; i < this.length; i++) {
                        if (this[i] == obj) {
                            return i;
                        }
                    }
                    return -1;
                }
            }
            
            $this.keyup(function(){
            	var str = $(this).val();
            	var result = '';
            	for (var i = 0; i < str.length; i++) {
            		result += $.fn.syncTranslit.transliterate(str.charAt(i), o)
            	}
            	var regExp = new RegExp('[' + o.urlSeparator + ']{2,}', 'g');
            	result = result.replace(regExp, o.urlSeparator);
            	$destination.val(result);
            })
        });
    };
    
    
    $.fn.syncTranslit.strtr = function(opts) {
        var text = (opts._text) ? opts._text : '';

        var result = '';
        for (var i = 0; i < text.length; i++) {
                result += $.fn.syncTranslit.transliterate(text.charAt(i), opts);
        }
        var regExp = new RegExp('[' + opts.urlSeparator + ']{2,}', 'g');
        result = result.replace(regExp, opts.urlSeparator);
        return result;
    }
    
    /**
     * Transliterate character
     * @param {String} character
     * @param {Object} opts
     */
    $.fn.syncTranslit.transliterate = function(char, opts) {
    	var charIsLowerCase = true, trChar;
    	if (char.toLowerCase() != char) {
    		charIsLowerCase = false;
    	}
    	
    	char = char.toLowerCase();
    	
    	var index = opts.dictOriginal.indexOf(char);
    	if (index == -1) {
    		trChar = char;
    	} else {
    		trChar = opts.dictTranslate[index];
    	}
    	
    	if (opts.type == 'url') {
	    	var code = trChar.charCodeAt(0);
                
                if(trChar == '.') { return '.'; } // fix точка
                
	    	if (code >= 33  && code <= 47 && code != 45
	    		|| code >= 58  && code <= 64
	    		|| code >= 91  && code <= 96
	    		|| code >= 123 && code <= 126
	    		|| code >= 1072
	    	) {
	    		return '';
	    	}
	    	if (trChar == ' ' || trChar == '-') {
	    		return opts.urlSeparator;
	    	}
    	}
    	
    	if (opts.caseStyle == 'upper') {
    		return trChar.toUpperCase();
    	} else if (opts.caseStyle == 'normal') {
    		if (charIsLowerCase) {
    			return trChar.toLowerCase();
    		} else {
    			return trChar.toUpperCase();
    		}
    	}
	    return trChar;
    };
    
    /**
     * Default options
     */
    $.fn.syncTranslit.defaults = {
        /**
         * Dictionaries
         */
        dictOriginal:  ['а', 'б', 'в', 'г', 'д', 'е',
                        'ё', 'ж', 'з', 'и', 'й', 'к',
                        'л', 'м', 'н', 'о', 'п', 'р',
                        'с', 'т', 'у', 'ф', 'х', 'ц',
                        'ч', 'ш', 'щ', 'ъ', 'ы', 'ь',
                        'э', 'ю', 'я',
                        'і', 'є', 'ї', 'ґ'
                        ],
        dictTranslate: ['a', 'b', 'v', 'g', 'd', 'e',
                        'e', 'zh','z', 'i', 'j', 'k',
                        'l', 'm', 'n', 'o', 'p', 'r',
                        's', 't', 'u', 'f', 'h', 'ts',
                        'ch','sh','sch', '', 'y', '',
                        'e', 'ju', 'ja',
                        'i', 'je', 'ji', 'g'
                        ],
        
        /*
         * Case transformation: normal, lower, upper
         */
        caseStyle: 'lower',
        
        /*
         * Words separator in url
         */
        urlSeparator: '-',
        
        /*
         * Transliteration type: raw or url
         *    url - used for transliterating text into url slug
         *    raw - raw transliteration (with special characters)
         */
        type: 'url'
    };
})(jQuery);
$(document).ready(function(){ 
    var _email = new String($(".box-form-subscribe > form input.email").attr("name"));
    $('.box-form-subscribe > form').validate({
        onfocusout: false,
        onkeyup: false,
        onclick: true,
        onsubmit: true,
        focusInvalid: false,
        focusCleanup: false,        
        _email: {
            required: true,
            email: true
        },
        messages: {
            _email: {
                required: 'The Email field is empty',
                email: 'We’ll never share your email adress and you can opt out at any time, we promise.'
            }
        },

        errorClass: 'block-error',
        validClass: 'success',
        invalidHandler: function(event, validator) {
            if($('.box-form-subscribe > form .block-error').length)
                $('.box-form-subscribe > form .block-error').html( ' ' ).hide();
        },
        // управление ошибками
        showErrors: function(errorMap, errorList) {
            var msg = '';
            $.each(errorList, function(){
                if(this.message) 
                    msg += this.message + '<br />'; 
             });

            if(msg !== '') 
                $('.box-form-subscribe > form .block-error').html(msg).show();
        },
    });
});    

/* 
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */

function isset(element) {
    if(typeof element != 'undefined') {
        return element.length > 0;
    } else
        return false;
}

/*
 * parce url
 **/
function parseUrlQuery() {
    var data = {};
    if(location.search) {
        var pair = (location.search.substr(1)).split('&');
        for(var i = 0; i < pair.length; i ++) {
            var param = pair[i].split('=');
            data[param[0]] = param[1];
        }
    }
    return data;
}

/*
 * parce string serilize
 **/
function parseQuery( str ) {
    var data = {};
    if(typeof str == 'string') {
        var pair = (str).split('&');
        for(var i = 0; i < pair.length; i ++) {
            var param = pair[i].split('=');
            data[param[0]] = param[1];
        }
    } else if(typeof str == 'object') {
        $.each(str, function(_k, _val) {
            if(_val.name)
                data[ _val.name ] = (_val.value) ? _val.value : null;
        });
    }
    return data;
}

/*
 * Ajax function.
 * return json result
 **/
function getAjaxForm(path, params, options) {
  
    if(!options) options = {};
    
    var settings = $.extend( {
        'dataType': 'json',
        'async': false,
        'crossDomain': false,
        'type': 'POST',
        'cache': true
    }, options || {});
    
    console.log( settings );
    
    if(!path) {
        console.log('enter url AJAX!');
        return null;
    }
    var res = $.ajax({
                    url: path,
                    dataType: settings.dataType,
                    async: settings.async,
                    crossDomain: settings.crossDomain,
                    type: settings.type,
                    cache: settings.cache,
                    success: function() {
                        
                    },
                    complete: function(){
                    },
                    data: {
                        params: params 
                    }
		}).responseText;
                
    console.log(res);            
                
    res = eval('['+res+']');
    var obj = res[0];
    return obj;
}

/*
 * JSONP
 * 
 */
function _getAJAX( path, params, options ) {
   if(!options) options = {};
    
    var settings = $.extend( {
        'dataType': 'jsonp',
        'jsonp': "callback",
        'async': false,
        'crossDomain': false,
        'type': 'POST',
        'cache': true
    }, options || {});
    
    console.log( settings );
    
    if(!path) {
        console.log('enter url AJAX!');
        return null;
    }   

    return $.ajax({ 
        type: settings.type,
        async: settings.async,
        url: path,
        data: { 
           params: params 
        },
        dataType: settings.dataType,
        jsonp: settings.jsonp,
        crossDomain: settings.crossDomain,
        cache: settings.cache,
    });
}
/*!
 * Bootstrap YouTube Popup Player Plugin
 * author: Edii Shadow
 */
(function ($) {
  var $YouTubeModal = null,
    $YouTubeModalDialog = null,
    $YouTubeModalTitle = null,
    $YouTubeModalBody = null,
    margin = 5,
    methods;

  //Plugin methods
  methods = {
    //initialize plugin
    init: function (options) {
      options = $.extend({}, $.fn.YouTubeModal.defaults, options);

      // initialize YouTube Player Modal
      if ($YouTubeModal == null) {
        $YouTubeModal = $('<div class="modal ' + options.cssClass + '" id="YouTubeModal" role="dialog" aria-hidden="true">'); // fade
        
        
        var modalContent = '<div class="modal-dialog" id="YouTubeModalDialog">' +
                              '<div class="modal-content" id="YouTubeModalContent">' +
                                    '<div class="video-wrapper">' +
                                         '<div class="video-inner">'+
                                             '<button type="button" data-dismiss="modal" aria-hidden="true" class="video-close close"></button>'+
                                
                                              '<div class="modal-body" id="YouTubeModalBody"></div>' +
                                          '</div>'+ 
                                     '</div>'+     
                              '</div>' +
                            '</div>';
        
        
//        var modalContent = '<div class="modal-dialog" id="YouTubeModalDialog">' +
//                              '<div class="modal-content" id="YouTubeModalContent">' +
//                                '<div class="modal-header">' +
//                                  '<button type="button" class="close" data-dismiss="modal">&times;</button>' +
//                                  '<h4 class="modal-title" id="YouTubeModalTitle"></h4>' +
//                                '</div>' +
//                                '<div class="modal-body" id="YouTubeModalBody" style="padding:0;"></div>' +
//                              '</div>' +
//                            '</div>';
        $YouTubeModal.html(modalContent).hide().appendTo('body');
        $YouTubeModalDialog = $("#YouTubeModalDialog");
        $YouTubeModalTitle = $("#YouTubeModalTitle");
        $YouTubeModalBody = $("#YouTubeModalBody");
        $YouTubeModal.modal({
          show: false
        }).on('hide.bs.modal', resetModalBody);
      }

      return this.each(function () {
        var obj = $(this);
        var data = obj.data('YouTube');
        if (!data) { //check if event is already assigned
          obj.data('YouTube', {
            target: obj
          });
          $(obj).bind('click.YouTubeModal', function (event) {
            var youtubeId = options.youtubeId;
            if ($.trim(youtubeId) == '' && obj.is("a")) {
              youtubeId = getYouTubeIdFromUrl(obj.attr("href"));
            }
            if ($.trim(youtubeId) == '' || youtubeId === false) {
              youtubeId = obj.attr(options.idAttribute);
            }
            var videoTitle = $.trim(options.title);
            if (videoTitle == '') {
              if (options.useYouTubeTitle) setYouTubeTitle(youtubeId);
              else videoTitle = obj.attr('title');
            }
            if (videoTitle) {
              setModalTitle(videoTitle);
            }

            resizeModal(options.width);

            //Setup YouTube Modal
            var YouTubeURL = getYouTubeUrl(youtubeId, options);
            var YouTubePlayerIframe = getYouTubePlayer(YouTubeURL, options.width, options.height);
            $YouTubeModalBody.css({'max-width': options.width, 'height': options.height});
            setModalBody(YouTubePlayerIframe);
            $YouTubeModal.modal('show');

            event.preventDefault();
          });
        }
      });
    },
    destroy: function () {
      return this.each(function () {
        $(this).unbind(".YouTubeModal").removeData('YouTube');
      });
    }
  };

  function setModalTitle(title) {
    $YouTubeModalTitle.html($.trim(title));
  }

  function setModalBody(content) {
    $YouTubeModalBody.html(content);
  }

  function resetModalBody() {
    setModalTitle('');
    setModalBody('');
  }

  function resizeModal(w) {
//    $YouTubeModalDialog.css({
//      'max-width': w + (margin * 2)
//    });
  }

  function getYouTubeUrl(youtubeId, options) {
    return ["//www.youtube.com/embed/", youtubeId, "?rel=0&showsearch=0&autohide=", options.autohide,
      "&autoplay=", options.autoplay, "&controls=", options.controls, "&fs=", options.fs, "&loop=", options.loop,
      "&showinfo=", options.showinfo, "&color=", options.color, "&theme=", options.theme, "&wmode=transparent"
    ].join('');
  }

  function getYouTubePlayer(URL, width, height) {
    return ['<iframe title="YouTube video player" width="', width, '" height="', height, '" ',
      'style="margin:0; padding:0; box-sizing:border-box; border:0; -webkit-border-radius:5px; -moz-border-radius:5px; border-radius:5px; margin:', (margin - 1), 'px;" ',
      'src="', URL, '" frameborder="0" allowfullscreen seamless></iframe>'
    ].join('');
  }

  function setYouTubeTitle(youtubeId) {
    $.ajax({
      url: window.location.protocol + '//query.yahooapis.com/v1/public/yql',
      data: {
        q: "select * from json where url ='http://www.youtube.com/oembed?url=http://www.youtube.com/watch?v=" + youtubeId + "&format=json'",
        format: "json"
      },
      dataType: "jsonp",
      success: function (data) {
          if (data && data.query && data.query.results && data.query.results.json) {
            setModalTitle(data.query.results.json.title);
          }
      }
    });
  }

  function getYouTubeIdFromUrl(youtubeUrl) {
    var regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=)([^#\&\?]*).*/;
    var match = youtubeUrl.match(regExp);
    if (match && match[2].length == 11) {
      return match[2];
    } else {
      return false;
    }
  }

  $.fn.YouTubeModal = function (method) {
    if (methods[method]) {
      return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
    } else if (typeof method === 'object' || !method) {
      return methods.init.apply(this, arguments);
    } else {
      $.error('Method ' + method + ' does not exist on Bootstrap.YouTubeModal');
    }
  };

  //default configuration
  $.fn.YouTubeModal.defaults = {
    youtubeId: '',
    title: '',
    useYouTubeTitle: true,
    idAttribute: 'rel',
    cssClass: 'YouTubeModal',
    width: 640,
    height: 480,
    autohide: 2,
    autoplay: 1,
    color: 'red',
    controls: 1,
    fs: 1,
    loop: 0,
    showinfo: 0,
    theme: 'light'
  };
})(jQuery);

/*!
 * Bootstrap YouTube Popup Player Plugin
 * http://lab.abhinayrathore.com/bootstrap-youtube/
 * https://github.com/abhinayrathore/Bootstrap-Youtube-Popup-Player-Plugin
 */
!function(o){function t(t){h.html(o.trim(t))}function e(o){b.html(o)}function u(){t(""),e("")}function a(o){c.css({width:o+2*m})}function i(o,t){return["//www.youtube.com/embed/",o,"?rel=0&showsearch=0&autohide=",t.autohide,"&autoplay=",t.autoplay,"&controls=",t.controls,"&fs=",t.fs,"&loop=",t.loop,"&showinfo=",t.showinfo,"&color=",t.color,"&theme=",t.theme,"&wmode=transparent"].join("")}function l(o,t,e){return['<iframe title="YouTube video player" width="',t,'" height="',e,'" ','style="margin:0; padding:0; box-sizing:border-box; border:0; -webkit-border-radius:5px; -moz-border-radius:5px; border-radius:5px; margin:',m-1,'px;" ','src="',o,'" frameborder="0" allowfullscreen seamless></iframe>'].join("")}function d(e){o.ajax({url:window.location.protocol+"//query.yahooapis.com/v1/public/yql",data:{q:"select * from json where url ='http://www.youtube.com/oembed?url=http://www.youtube.com/watch?v="+e+"&format=json'",format:"json"},dataType:"jsonp",success:function(o){o&&o.query&&o.query.results&&o.query.results.json&&t(o.query.results.json.title)}})}function r(o){var t=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=)([^#\&\?]*).*/,e=o.match(t);return e&&11==e[2].length?e[2]:!1}var n,s=null,c=null,h=null,b=null,m=5;n={init:function(n){if(n=o.extend({},o.fn.YouTubeModal.defaults,n),null==s){s=o('<div class="modal fade '+n.cssClass+'" id="YouTubeModal" role="dialog" aria-hidden="true">');var m='<div class="modal-dialog" id="YouTubeModalDialog"><div class="modal-content" id="YouTubeModalContent"><div class="modal-header"><button type="button" class="close" data-dismiss="modal">&times;</button><h4 class="modal-title" id="YouTubeModalTitle"></h4></div><div class="modal-body" id="YouTubeModalBody" style="padding:0;"></div></div></div>';s.html(m).hide().appendTo("body"),c=o("#YouTubeModalDialog"),h=o("#YouTubeModalTitle"),b=o("#YouTubeModalBody"),s.modal({show:!1}).on("hide.bs.modal",u)}return this.each(function(){var u=o(this),c=u.data("YouTube");c||(u.data("YouTube",{target:u}),o(u).bind("click.YouTubeModal",function(c){var h=n.youtubeId;""==o.trim(h)&&u.is("a")&&(h=r(u.attr("href"))),(""==o.trim(h)||h===!1)&&(h=u.attr(n.idAttribute));var b=o.trim(n.title);""==b&&(n.useYouTubeTitle?d(h):b=u.attr("title")),b&&t(b),a(n.width);var m=i(h,n),f=l(m,n.width,n.height);e(f),s.modal("show"),c.preventDefault()}))})},destroy:function(){return this.each(function(){o(this).unbind(".YouTubeModal").removeData("YouTube")})}},o.fn.YouTubeModal=function(t){return n[t]?n[t].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof t&&t?void o.error("Method "+t+" does not exist on Bootstrap.YouTubeModal"):n.init.apply(this,arguments)},o.fn.YouTubeModal.defaults={youtubeId:"",title:"",useYouTubeTitle:!0,idAttribute:"rel",cssClass:"YouTubeModal",width:640,height:480,autohide:2,autoplay:1,color:"red",controls:1,fs:1,loop:0,showinfo:0,theme:"light"}}(jQuery);

/*!
 * Bootstrap YouTube Popup Player Plugin
 * http://lab.abhinayrathore.com/bootstrap-youtube/
 * https://github.com/abhinayrathore/Bootstrap-Youtube-Popup-Player-Plugin
 */
(function ($) {
  var $YouTubeModal = null,
    $YouTubeModalDialog = null,
    $YouTubeModalTitle = null,
    $YouTubeModalBody = null,
    margin = 5,
    methods;

  //Plugin methods
  methods = {
    //initialize plugin
    init: function (options) {
      options = $.extend({}, $.fn.YouTubeModal.defaults, options);

      // initialize YouTube Player Modal
      if ($YouTubeModal == null) {
        $YouTubeModal = $('<div class="modal fade ' + options.cssClass + '" id="YouTubeModal" role="dialog" aria-hidden="true">');
        var modalContent = '<div class="modal-dialog" id="YouTubeModalDialog">' +
                              '<div class="modal-content" id="YouTubeModalContent">' +
                                '<div class="modal-header">' +
                                  '<button type="button" class="close" data-dismiss="modal">&times;</button>' +
                                  '<h4 class="modal-title" id="YouTubeModalTitle"></h4>' +
                                '</div>' +
                                '<div class="modal-body" id="YouTubeModalBody" style="padding:0;"></div>' +
                              '</div>' +
                            '</div>';
        $YouTubeModal.html(modalContent).hide().appendTo('body');
        $YouTubeModalDialog = $("#YouTubeModalDialog");
        $YouTubeModalTitle = $("#YouTubeModalTitle");
        $YouTubeModalBody = $("#YouTubeModalBody");
        $YouTubeModal.modal({
          show: false
        }).on('hide.bs.modal', resetModalBody);
      }

      return this.each(function () {
        var obj = $(this);
        var data = obj.data('YouTube');
        if (!data) { //check if event is already assigned
          obj.data('YouTube', {
            target: obj
          });
          $(obj).bind('click.YouTubeModal', function (event) {
            var youtubeId = options.youtubeId;
            if ($.trim(youtubeId) == '' && obj.is("a")) {
              youtubeId = getYouTubeIdFromUrl(obj.attr("href"));
            }
            if ($.trim(youtubeId) == '' || youtubeId === false) {
              youtubeId = obj.attr(options.idAttribute);
            }
            var videoTitle = $.trim(options.title);
            if (videoTitle == '') {
              if (options.useYouTubeTitle) setYouTubeTitle(youtubeId);
              else videoTitle = obj.attr('title');
            }
            if (videoTitle) {
              setModalTitle(videoTitle);
            }

            resizeModal(options.width);

            //Setup YouTube Modal
            var YouTubeURL = getYouTubeUrl(youtubeId, options);
            var YouTubePlayerIframe = getYouTubePlayer(YouTubeURL, options.width, options.height);
            setModalBody(YouTubePlayerIframe);
            $YouTubeModal.modal('show');

            event.preventDefault();
          });
        }
      });
    },
    destroy: function () {
      return this.each(function () {
        $(this).unbind(".YouTubeModal").removeData('YouTube');
      });
    }
  };

  function setModalTitle(title) {
    $YouTubeModalTitle.html($.trim(title));
  }

  function setModalBody(content) {
    $YouTubeModalBody.html(content);
  }

  function resetModalBody() {
    setModalTitle('');
    setModalBody('');
  }

  function resizeModal(w) {
    $YouTubeModalDialog.css({
      width: w + (margin * 2)
    });
  }

  function getYouTubeUrl(youtubeId, options) {
    return ["//www.youtube.com/embed/", youtubeId, "?rel=0&showsearch=0&autohide=", options.autohide,
      "&autoplay=", options.autoplay, "&controls=", options.controls, "&fs=", options.fs, "&loop=", options.loop,
      "&showinfo=", options.showinfo, "&color=", options.color, "&theme=", options.theme, "&wmode=transparent"
    ].join('');
  }

  function getYouTubePlayer(URL, width, height) {
    return ['<iframe title="YouTube video player" width="', width, '" height="', height, '" ',
      'style="margin:0; padding:0; box-sizing:border-box; border:0; -webkit-border-radius:5px; -moz-border-radius:5px; border-radius:5px; margin:', (margin - 1), 'px;" ',
      'src="', URL, '" frameborder="0" allowfullscreen seamless></iframe>'
    ].join('');
  }

  function setYouTubeTitle(youtubeId) {
    $.ajax({
      url: window.location.protocol + '//query.yahooapis.com/v1/public/yql',
      data: {
        q: "select * from json where url ='http://www.youtube.com/oembed?url=http://www.youtube.com/watch?v=" + youtubeId + "&format=json'",
        format: "json"
      },
      dataType: "jsonp",
      success: function (data) {
          if (data && data.query && data.query.results && data.query.results.json) {
            setModalTitle(data.query.results.json.title);
          }
      }
    });
  }

  function getYouTubeIdFromUrl(youtubeUrl) {
    var regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=)([^#\&\?]*).*/;
    var match = youtubeUrl.match(regExp);
    if (match && match[2].length == 11) {
      return match[2];
    } else {
      return false;
    }
  }

  $.fn.YouTubeModal = function (method) {
    if (methods[method]) {
      return methods[method].apply(this, Array.prototype.slice.call(arguments, 1));
    } else if (typeof method === 'object' || !method) {
      return methods.init.apply(this, arguments);
    } else {
      $.error('Method ' + method + ' does not exist on Bootstrap.YouTubeModal');
    }
  };

  //default configuration
  $.fn.YouTubeModal.defaults = {
    youtubeId: '',
    title: '',
    useYouTubeTitle: true,
    idAttribute: 'rel',
    cssClass: 'YouTubeModal',
    width: 640,
    height: 480,
    autohide: 2,
    autoplay: 1,
    color: 'red',
    controls: 1,
    fs: 1,
    loop: 0,
    showinfo: 0,
    theme: 'light'
  };
})(jQuery);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlplcm9DbGlwYm9hcmQubWluLmpzIiwiYm9vdHN0cmFwLmpzIiwiYnJvd3Nlci5qcyIsImJ1dHRvbi5qcyIsImN1cnJhbmN5LmpzIiwiZWFzeVRvb2x0aXAuanMiLCJmYW5jeV9jaGVja2JveC5qcyIsImZseV9mZWFjaGVycy5qcyIsImluaXQuanMiLCJqcXVlcnkuYmEtaGFzaGNoYW5nZS5taW4uanMiLCJqcXVlcnkuY29va2llLmpzIiwianF1ZXJ5LmhhbmRsZXItdG9vbGtpdC5qcyIsImpxdWVyeS5tYXRjaEhlaWdodC1taW4uanMiLCJqcXVlcnkuc2ltcGxlUGFnaW5hdGlvbi5qcyIsImpxdWVyeS50b3RhbC1zdG9yYWdlLm1pbi5qcyIsImpxdWVyeS52YWxpZGF0ZS5qcyIsIm1haW4uanMiLCJvdXRXaW5kb3dzLmpzIiwicmVzaXplX2ltYWdlcy5qcyIsInJlc2l6ZV90ZWguanMiLCJzY3JvbGwuanMiLCJzdG9yZUZpbHRlci5qcyIsImJ4c2xpZGVyL2J4SW5pdC5qcyIsImJ4c2xpZGVyL2pxdWVyeS5ieHNsaWRlci5qcyIsImRkc2xpY2svZGRzbGljay5taW4uanMiLCJsaWdodGJveC9saWdodGJveC5qcyIsIm1vbmV5L21vbmV5LmpzIiwicG9wdXAvanF1ZXJ5LmJwb3B1cC5qcyIsInN0aWNreS9qcXVlcnkuYXV0b2ZpeF9hbnl0aGluZy5qcyIsInN0aWNreWJhci9qcXVlcnkuc3RpY2t5LWtpdC5qcyIsInRyYW5zbGl0ZS9qcXVlcnkuc3luY3RyYW5zbGl0LmpzIiwid3AvaW5pdC5qcyIsIndwL3NldHRpbmdzLmpzIiwieW91dHViZS9ib290c3RyYXAueW91dHViZXBvcHVwLmpzIiwieW91dHViZS9ib290c3RyYXAueW91dHViZXBvcHVwLm1pbi5qcyIsInlvdXR1YmUvYm9vdHN0cmFwLnlvdXR1YmVwb3B1cF8xLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDVEE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM3lHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVEQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDckZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdaQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbkVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqL0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQy9GQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDaFZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDbEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3AxQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM0dBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3BRQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFJQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzdDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDcFBBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqREE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3ZKQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pnREE7QUFDQTtBQ0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDM1pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN0S0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFZQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNuRkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4UUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN6SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN2Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNqSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzNMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ05BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZnJvbnRlbmQubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyohXG4gKiBaZXJvQ2xpcGJvYXJkXG4gKiBUaGUgWmVyb0NsaXBib2FyZCBsaWJyYXJ5IHByb3ZpZGVzIGFuIGVhc3kgd2F5IHRvIGNvcHkgdGV4dCB0byB0aGUgY2xpcGJvYXJkIHVzaW5nIGFuIGludmlzaWJsZSBBZG9iZSBGbGFzaCBtb3ZpZSBhbmQgYSBKYXZhU2NyaXB0IGludGVyZmFjZS5cbiAqIENvcHlyaWdodCAoYykgMjAwOS0yMDE1IEpvbiBSb2hhbiwgSmFtZXMgTS4gR3JlZW5lXG4gKiBMaWNlbnNlZCBNSVRcbiAqIGh0dHA6Ly96ZXJvY2xpcGJvYXJkLm9yZy9cbiAqIHYyLjMuMC1iZXRhLjFcbiAqL1xuIWZ1bmN0aW9uKGEsYil7XCJ1c2Ugc3RyaWN0XCI7dmFyIGMsZCxlLGY9YSxnPWYuZG9jdW1lbnQsaD1mLm5hdmlnYXRvcixpPWYuc2V0VGltZW91dCxqPWYuY2xlYXJUaW1lb3V0LGs9Zi5zZXRJbnRlcnZhbCxsPWYuY2xlYXJJbnRlcnZhbCxtPWYuZ2V0Q29tcHV0ZWRTdHlsZSxuPWYuZW5jb2RlVVJJQ29tcG9uZW50LG89Zi5BY3RpdmVYT2JqZWN0LHA9Zi5FcnJvcixxPWYuTnVtYmVyLnBhcnNlSW50fHxmLnBhcnNlSW50LHI9Zi5OdW1iZXIucGFyc2VGbG9hdHx8Zi5wYXJzZUZsb2F0LHM9Zi5OdW1iZXIuaXNOYU58fGYuaXNOYU4sdD1mLkRhdGUubm93LHU9Zi5PYmplY3Qua2V5cyx2PWYuT2JqZWN0LmRlZmluZVByb3BlcnR5LHc9Zi5PYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LHg9Zi5BcnJheS5wcm90b3R5cGUuc2xpY2UseT1mdW5jdGlvbigpe3ZhciBhPWZ1bmN0aW9uKGEpe3JldHVybiBhfTtpZihcImZ1bmN0aW9uXCI9PXR5cGVvZiBmLndyYXAmJlwiZnVuY3Rpb25cIj09dHlwZW9mIGYudW53cmFwKXRyeXt2YXIgYj1nLmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiksYz1mLnVud3JhcChiKTsxPT09Yi5ub2RlVHlwZSYmYyYmMT09PWMubm9kZVR5cGUmJihhPWYudW53cmFwKX1jYXRjaChkKXt9cmV0dXJuIGF9KCksej1mdW5jdGlvbihhKXtyZXR1cm4geC5jYWxsKGEsMCl9LEE9ZnVuY3Rpb24oKXt2YXIgYSxjLGQsZSxmLGcsaD16KGFyZ3VtZW50cyksaT1oWzBdfHx7fTtmb3IoYT0xLGM9aC5sZW5ndGg7Yz5hO2ErKylpZihudWxsIT0oZD1oW2FdKSlmb3IoZSBpbiBkKXcuY2FsbChkLGUpJiYoZj1pW2VdLGc9ZFtlXSxpIT09ZyYmZyE9PWImJihpW2VdPWcpKTtyZXR1cm4gaX0sQj1mdW5jdGlvbihhKXt2YXIgYixjLGQsZTtpZihcIm9iamVjdFwiIT10eXBlb2YgYXx8bnVsbD09YXx8XCJudW1iZXJcIj09dHlwZW9mIGEubm9kZVR5cGUpYj1hO2Vsc2UgaWYoXCJudW1iZXJcIj09dHlwZW9mIGEubGVuZ3RoKWZvcihiPVtdLGM9MCxkPWEubGVuZ3RoO2Q+YztjKyspdy5jYWxsKGEsYykmJihiW2NdPUIoYVtjXSkpO2Vsc2V7Yj17fTtmb3IoZSBpbiBhKXcuY2FsbChhLGUpJiYoYltlXT1CKGFbZV0pKX1yZXR1cm4gYn0sQz1mdW5jdGlvbihhLGIpe2Zvcih2YXIgYz17fSxkPTAsZT1iLmxlbmd0aDtlPmQ7ZCsrKWJbZF1pbiBhJiYoY1tiW2RdXT1hW2JbZF1dKTtyZXR1cm4gY30sRD1mdW5jdGlvbihhLGIpe3ZhciBjPXt9O2Zvcih2YXIgZCBpbiBhKS0xPT09Yi5pbmRleE9mKGQpJiYoY1tkXT1hW2RdKTtyZXR1cm4gY30sRT1mdW5jdGlvbihhKXtpZihhKWZvcih2YXIgYiBpbiBhKXcuY2FsbChhLGIpJiZkZWxldGUgYVtiXTtyZXR1cm4gYX0sRj1mdW5jdGlvbihhLGIpe2lmKGEmJjE9PT1hLm5vZGVUeXBlJiZhLm93bmVyRG9jdW1lbnQmJmImJigxPT09Yi5ub2RlVHlwZSYmYi5vd25lckRvY3VtZW50JiZiLm93bmVyRG9jdW1lbnQ9PT1hLm93bmVyRG9jdW1lbnR8fDk9PT1iLm5vZGVUeXBlJiYhYi5vd25lckRvY3VtZW50JiZiPT09YS5vd25lckRvY3VtZW50KSlkb3tpZihhPT09YilyZXR1cm4hMDthPWEucGFyZW50Tm9kZX13aGlsZShhKTtyZXR1cm4hMX0sRz1mdW5jdGlvbihhKXt2YXIgYjtyZXR1cm5cInN0cmluZ1wiPT10eXBlb2YgYSYmYSYmKGI9YS5zcGxpdChcIiNcIilbMF0uc3BsaXQoXCI/XCIpWzBdLGI9YS5zbGljZSgwLGEubGFzdEluZGV4T2YoXCIvXCIpKzEpKSxifSxIPWZ1bmN0aW9uKGEpe3ZhciBiLGM7cmV0dXJuXCJzdHJpbmdcIj09dHlwZW9mIGEmJmEmJihjPWEubWF0Y2goL14oPzp8W146QF0qQHwuK1xcKUAoPz1odHRwW3NdP3xmaWxlKXwuKz9cXHMrKD86IGF0IHxAKSg/OlteOlxcKF0rICkqW1xcKF0/KSgoPzpodHRwW3NdP3xmaWxlKTpcXC9cXC9bXFwvXT8uKz9cXC9bXjpcXCldKj8pKD86OlxcZCspKD86OlxcZCspPy8pLGMmJmNbMV0/Yj1jWzFdOihjPWEubWF0Y2goL1xcKUAoKD86aHR0cFtzXT98ZmlsZSk6XFwvXFwvW1xcL10/Lis/XFwvW146XFwpXSo/KSg/OjpcXGQrKSg/OjpcXGQrKT8vKSxjJiZjWzFdJiYoYj1jWzFdKSkpLGJ9LEk9ZnVuY3Rpb24oKXt2YXIgYSxiO3RyeXt0aHJvdyBuZXcgcH1jYXRjaChjKXtiPWN9cmV0dXJuIGImJihhPWIuc291cmNlVVJMfHxiLmZpbGVOYW1lfHxIKGIuc3RhY2spKSxhfSxKPWZ1bmN0aW9uKCl7dmFyIGEsYyxkO2lmKGcuY3VycmVudFNjcmlwdCYmKGE9Zy5jdXJyZW50U2NyaXB0LnNyYykpcmV0dXJuIGE7aWYoYz1nLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwic2NyaXB0XCIpLDE9PT1jLmxlbmd0aClyZXR1cm4gY1swXS5zcmN8fGI7aWYoXCJyZWFkeVN0YXRlXCJpbiBjWzBdKWZvcihkPWMubGVuZ3RoO2QtLTspaWYoXCJpbnRlcmFjdGl2ZVwiPT09Y1tkXS5yZWFkeVN0YXRlJiYoYT1jW2RdLnNyYykpcmV0dXJuIGE7cmV0dXJuXCJsb2FkaW5nXCI9PT1nLnJlYWR5U3RhdGUmJihhPWNbYy5sZW5ndGgtMV0uc3JjKT9hOihhPUkoKSk/YTpifSxLPWZ1bmN0aW9uKCl7dmFyIGEsYyxkLGU9Zy5nZXRFbGVtZW50c0J5VGFnTmFtZShcInNjcmlwdFwiKTtmb3IoYT1lLmxlbmd0aDthLS07KXtpZighKGQ9ZVthXS5zcmMpKXtjPW51bGw7YnJlYWt9aWYoZD1HKGQpLG51bGw9PWMpYz1kO2Vsc2UgaWYoYyE9PWQpe2M9bnVsbDticmVha319cmV0dXJuIGN8fGJ9LEw9ZnVuY3Rpb24oKXt2YXIgYT1HKEooKSl8fEsoKXx8XCJcIjtyZXR1cm4gYStcIlplcm9DbGlwYm9hcmQuc3dmXCJ9LE09ZnVuY3Rpb24oKXt2YXIgYT0vd2luKGRvd3N8W1xcc10/KG50fG1lfGNlfHhwfHZpc3RhfFtcXGRdKykpL2k7cmV0dXJuISFoJiYoYS50ZXN0KGguYXBwVmVyc2lvbnx8XCJcIil8fGEudGVzdChoLnBsYXRmb3JtfHxcIlwiKXx8LTEhPT0oaC51c2VyQWdlbnR8fFwiXCIpLmluZGV4T2YoXCJXaW5kb3dzXCIpKX0sTj1mdW5jdGlvbigpe3JldHVybiBudWxsPT1hLm9wZW5lciYmKCEhYS50b3AmJmEhPWEudG9wfHwhIWEucGFyZW50JiZhIT1hLnBhcmVudCl9KCksTz17YnJpZGdlOm51bGwsdmVyc2lvbjpcIjAuMC4wXCIscGx1Z2luVHlwZTpcInVua25vd25cIixkaXNhYmxlZDpudWxsLG91dGRhdGVkOm51bGwsc2FuZGJveGVkOm51bGwsdW5hdmFpbGFibGU6bnVsbCxkZWdyYWRlZDpudWxsLGRlYWN0aXZhdGVkOm51bGwsb3ZlcmR1ZTpudWxsLHJlYWR5Om51bGx9LFA9XCIxMS4wLjBcIixRPXt9LFI9e30sUz1udWxsLFQ9MCxVPTAsVj17cmVhZHk6XCJGbGFzaCBjb21tdW5pY2F0aW9uIGlzIGVzdGFibGlzaGVkXCIsZXJyb3I6e1wiZmxhc2gtZGlzYWJsZWRcIjpcIkZsYXNoIGlzIGRpc2FibGVkIG9yIG5vdCBpbnN0YWxsZWQuIE1heSBhbHNvIGJlIGF0dGVtcHRpbmcgdG8gcnVuIEZsYXNoIGluIGEgc2FuZGJveGVkIGlmcmFtZSwgd2hpY2ggaXMgaW1wb3NzaWJsZS5cIixcImZsYXNoLW91dGRhdGVkXCI6XCJGbGFzaCBpcyB0b28gb3V0ZGF0ZWQgdG8gc3VwcG9ydCBaZXJvQ2xpcGJvYXJkXCIsXCJmbGFzaC1zYW5kYm94ZWRcIjpcIkF0dGVtcHRpbmcgdG8gcnVuIEZsYXNoIGluIGEgc2FuZGJveGVkIGlmcmFtZSwgd2hpY2ggaXMgaW1wb3NzaWJsZVwiLFwiZmxhc2gtdW5hdmFpbGFibGVcIjpcIkZsYXNoIGlzIHVuYWJsZSB0byBjb21tdW5pY2F0ZSBiaWRpcmVjdGlvbmFsbHkgd2l0aCBKYXZhU2NyaXB0XCIsXCJmbGFzaC1kZWdyYWRlZFwiOlwiRmxhc2ggaXMgdW5hYmxlIHRvIHByZXNlcnZlIGRhdGEgZmlkZWxpdHkgd2hlbiBjb21tdW5pY2F0aW5nIHdpdGggSmF2YVNjcmlwdFwiLFwiZmxhc2gtZGVhY3RpdmF0ZWRcIjpcIkZsYXNoIGlzIHRvbyBvdXRkYXRlZCBmb3IgeW91ciBicm93c2VyIGFuZC9vciBpcyBjb25maWd1cmVkIGFzIGNsaWNrLXRvLWFjdGl2YXRlLlxcblRoaXMgbWF5IGFsc28gbWVhbiB0aGF0IHRoZSBaZXJvQ2xpcGJvYXJkIFNXRiBvYmplY3QgY291bGQgbm90IGJlIGxvYWRlZCwgc28gcGxlYXNlIGNoZWNrIHlvdXIgYHN3ZlBhdGhgIGNvbmZpZ3VyYXRpb24gYW5kL29yIG5ldHdvcmsgY29ubmVjdGl2aXR5Llxcbk1heSBhbHNvIGJlIGF0dGVtcHRpbmcgdG8gcnVuIEZsYXNoIGluIGEgc2FuZGJveGVkIGlmcmFtZSwgd2hpY2ggaXMgaW1wb3NzaWJsZS5cIixcImZsYXNoLW92ZXJkdWVcIjpcIkZsYXNoIGNvbW11bmljYXRpb24gd2FzIGVzdGFibGlzaGVkIGJ1dCBOT1Qgd2l0aGluIHRoZSBhY2NlcHRhYmxlIHRpbWUgbGltaXRcIixcInZlcnNpb24tbWlzbWF0Y2hcIjpcIlplcm9DbGlwYm9hcmQgSlMgdmVyc2lvbiBudW1iZXIgZG9lcyBub3QgbWF0Y2ggWmVyb0NsaXBib2FyZCBTV0YgdmVyc2lvbiBudW1iZXJcIixcImNsaXBib2FyZC1lcnJvclwiOlwiQXQgbGVhc3Qgb25lIGVycm9yIHdhcyB0aHJvd24gd2hpbGUgWmVyb0NsaXBib2FyZCB3YXMgYXR0ZW1wdGluZyB0byBpbmplY3QgeW91ciBkYXRhIGludG8gdGhlIGNsaXBib2FyZFwiLFwiY29uZmlnLW1pc21hdGNoXCI6XCJaZXJvQ2xpcGJvYXJkIGNvbmZpZ3VyYXRpb24gZG9lcyBub3QgbWF0Y2ggRmxhc2gncyByZWFsaXR5XCIsXCJzd2Ytbm90LWZvdW5kXCI6XCJUaGUgWmVyb0NsaXBib2FyZCBTV0Ygb2JqZWN0IGNvdWxkIG5vdCBiZSBsb2FkZWQsIHNvIHBsZWFzZSBjaGVjayB5b3VyIGBzd2ZQYXRoYCBjb25maWd1cmF0aW9uIGFuZC9vciBuZXR3b3JrIGNvbm5lY3Rpdml0eVwifX0sVz1bXCJmbGFzaC11bmF2YWlsYWJsZVwiLFwiZmxhc2gtZGVncmFkZWRcIixcImZsYXNoLW92ZXJkdWVcIixcInZlcnNpb24tbWlzbWF0Y2hcIixcImNvbmZpZy1taXNtYXRjaFwiLFwiY2xpcGJvYXJkLWVycm9yXCJdLFg9W1wiZmxhc2gtZGlzYWJsZWRcIixcImZsYXNoLW91dGRhdGVkXCIsXCJmbGFzaC1zYW5kYm94ZWRcIixcImZsYXNoLXVuYXZhaWxhYmxlXCIsXCJmbGFzaC1kZWdyYWRlZFwiLFwiZmxhc2gtZGVhY3RpdmF0ZWRcIixcImZsYXNoLW92ZXJkdWVcIl0sWT1uZXcgUmVnRXhwKFwiXmZsYXNoLShcIitYLm1hcChmdW5jdGlvbihhKXtyZXR1cm4gYS5yZXBsYWNlKC9eZmxhc2gtLyxcIlwiKX0pLmpvaW4oXCJ8XCIpK1wiKSRcIiksWj1uZXcgUmVnRXhwKFwiXmZsYXNoLShcIitYLnNsaWNlKDEpLm1hcChmdW5jdGlvbihhKXtyZXR1cm4gYS5yZXBsYWNlKC9eZmxhc2gtLyxcIlwiKX0pLmpvaW4oXCJ8XCIpK1wiKSRcIiksJD17c3dmUGF0aDpMKCksdHJ1c3RlZERvbWFpbnM6YS5sb2NhdGlvbi5ob3N0P1thLmxvY2F0aW9uLmhvc3RdOltdLGNhY2hlQnVzdDohMCxmb3JjZUVuaGFuY2VkQ2xpcGJvYXJkOiExLGZsYXNoTG9hZFRpbWVvdXQ6M2U0LGF1dG9BY3RpdmF0ZTohMCxidWJibGVFdmVudHM6ITAsZml4TGluZUVuZGluZ3M6ITAsY29udGFpbmVySWQ6XCJnbG9iYWwtemVyb2NsaXBib2FyZC1odG1sLWJyaWRnZVwiLGNvbnRhaW5lckNsYXNzOlwiZ2xvYmFsLXplcm9jbGlwYm9hcmQtY29udGFpbmVyXCIsc3dmT2JqZWN0SWQ6XCJnbG9iYWwtemVyb2NsaXBib2FyZC1mbGFzaC1icmlkZ2VcIixob3ZlckNsYXNzOlwiemVyb2NsaXBib2FyZC1pcy1ob3ZlclwiLGFjdGl2ZUNsYXNzOlwiemVyb2NsaXBib2FyZC1pcy1hY3RpdmVcIixmb3JjZUhhbmRDdXJzb3I6ITEsdGl0bGU6bnVsbCx6SW5kZXg6OTk5OTk5OTk5fSxfPWZ1bmN0aW9uKGEpe2lmKFwib2JqZWN0XCI9PXR5cGVvZiBhJiZudWxsIT09YSlmb3IodmFyIGIgaW4gYSlpZih3LmNhbGwoYSxiKSlpZigvXig/OmZvcmNlSGFuZEN1cnNvcnx0aXRsZXx6SW5kZXh8YnViYmxlRXZlbnRzfGZpeExpbmVFbmRpbmdzKSQvLnRlc3QoYikpJFtiXT1hW2JdO2Vsc2UgaWYobnVsbD09Ty5icmlkZ2UpaWYoXCJjb250YWluZXJJZFwiPT09Ynx8XCJzd2ZPYmplY3RJZFwiPT09Yil7aWYoIW9hKGFbYl0pKXRocm93IG5ldyBFcnJvcihcIlRoZSBzcGVjaWZpZWQgYFwiK2IrXCJgIHZhbHVlIGlzIG5vdCB2YWxpZCBhcyBhbiBIVE1MNCBFbGVtZW50IElEXCIpOyRbYl09YVtiXX1lbHNlICRbYl09YVtiXTt7aWYoXCJzdHJpbmdcIiE9dHlwZW9mIGF8fCFhKXJldHVybiBCKCQpO2lmKHcuY2FsbCgkLGEpKXJldHVybiAkW2FdfX0sYWE9ZnVuY3Rpb24oKXtyZXR1cm4gVmEoKSx7YnJvd3NlcjpDKGgsW1widXNlckFnZW50XCIsXCJwbGF0Zm9ybVwiLFwiYXBwTmFtZVwiLFwiYXBwVmVyc2lvblwiXSksZmxhc2g6RChPLFtcImJyaWRnZVwiXSksemVyb2NsaXBib2FyZDp7dmVyc2lvbjpYYS52ZXJzaW9uLGNvbmZpZzpYYS5jb25maWcoKX19fSxiYT1mdW5jdGlvbigpe3JldHVybiEhKE8uZGlzYWJsZWR8fE8ub3V0ZGF0ZWR8fE8uc2FuZGJveGVkfHxPLnVuYXZhaWxhYmxlfHxPLmRlZ3JhZGVkfHxPLmRlYWN0aXZhdGVkKX0sY2E9ZnVuY3Rpb24oYSxkKXt2YXIgZSxmLGcsaD17fTtpZihcInN0cmluZ1wiPT10eXBlb2YgYSYmYSlnPWEudG9Mb3dlckNhc2UoKS5zcGxpdCgvXFxzKy8pO2Vsc2UgaWYoXCJvYmplY3RcIj09dHlwZW9mIGEmJmEmJlwidW5kZWZpbmVkXCI9PXR5cGVvZiBkKWZvcihlIGluIGEpdy5jYWxsKGEsZSkmJlwic3RyaW5nXCI9PXR5cGVvZiBlJiZlJiZcImZ1bmN0aW9uXCI9PXR5cGVvZiBhW2VdJiZYYS5vbihlLGFbZV0pO2lmKGcmJmcubGVuZ3RoKXtmb3IoZT0wLGY9Zy5sZW5ndGg7Zj5lO2UrKylhPWdbZV0ucmVwbGFjZSgvXm9uLyxcIlwiKSxoW2FdPSEwLFFbYV18fChRW2FdPVtdKSxRW2FdLnB1c2goZCk7aWYoaC5yZWFkeSYmTy5yZWFkeSYmWGEuZW1pdCh7dHlwZTpcInJlYWR5XCJ9KSxoLmVycm9yKXtmb3IoZT0wLGY9WC5sZW5ndGg7Zj5lO2UrKylpZihPW1hbZV0ucmVwbGFjZSgvXmZsYXNoLS8sXCJcIildPT09ITApe1hhLmVtaXQoe3R5cGU6XCJlcnJvclwiLG5hbWU6WFtlXX0pO2JyZWFrfWMhPT1iJiZYYS52ZXJzaW9uIT09YyYmWGEuZW1pdCh7dHlwZTpcImVycm9yXCIsbmFtZTpcInZlcnNpb24tbWlzbWF0Y2hcIixqc1ZlcnNpb246WGEudmVyc2lvbixzd2ZWZXJzaW9uOmN9KX19cmV0dXJuIFhhfSxkYT1mdW5jdGlvbihhLGIpe3ZhciBjLGQsZSxmLGc7aWYoMD09PWFyZ3VtZW50cy5sZW5ndGgpZj11KFEpO2Vsc2UgaWYoXCJzdHJpbmdcIj09dHlwZW9mIGEmJmEpZj1hLnNwbGl0KC9cXHMrLyk7ZWxzZSBpZihcIm9iamVjdFwiPT10eXBlb2YgYSYmYSYmXCJ1bmRlZmluZWRcIj09dHlwZW9mIGIpZm9yKGMgaW4gYSl3LmNhbGwoYSxjKSYmXCJzdHJpbmdcIj09dHlwZW9mIGMmJmMmJlwiZnVuY3Rpb25cIj09dHlwZW9mIGFbY10mJlhhLm9mZihjLGFbY10pO2lmKGYmJmYubGVuZ3RoKWZvcihjPTAsZD1mLmxlbmd0aDtkPmM7YysrKWlmKGE9ZltjXS50b0xvd2VyQ2FzZSgpLnJlcGxhY2UoL15vbi8sXCJcIiksZz1RW2FdLGcmJmcubGVuZ3RoKWlmKGIpZm9yKGU9Zy5pbmRleE9mKGIpOy0xIT09ZTspZy5zcGxpY2UoZSwxKSxlPWcuaW5kZXhPZihiLGUpO2Vsc2UgZy5sZW5ndGg9MDtyZXR1cm4gWGF9LGVhPWZ1bmN0aW9uKGEpe3ZhciBiO3JldHVybiBiPVwic3RyaW5nXCI9PXR5cGVvZiBhJiZhP0IoUVthXSl8fG51bGw6QihRKX0sZmE9ZnVuY3Rpb24oYSl7dmFyIGIsYyxkO3JldHVybiBhPXBhKGEpLGEmJiF3YShhKT9cInJlYWR5XCI9PT1hLnR5cGUmJk8ub3ZlcmR1ZT09PSEwP1hhLmVtaXQoe3R5cGU6XCJlcnJvclwiLG5hbWU6XCJmbGFzaC1vdmVyZHVlXCJ9KTooYj1BKHt9LGEpLHVhLmNhbGwodGhpcyxiKSxcImNvcHlcIj09PWEudHlwZSYmKGQ9RWEoUiksYz1kLmRhdGEsUz1kLmZvcm1hdE1hcCksYyk6dm9pZCAwfSxnYT1mdW5jdGlvbigpe3ZhciBhPU8uc2FuZGJveGVkO2lmKFZhKCksXCJib29sZWFuXCIhPXR5cGVvZiBPLnJlYWR5JiYoTy5yZWFkeT0hMSksTy5zYW5kYm94ZWQhPT1hJiZPLnNhbmRib3hlZD09PSEwKU8ucmVhZHk9ITEsWGEuZW1pdCh7dHlwZTpcImVycm9yXCIsbmFtZTpcImZsYXNoLXNhbmRib3hlZFwifSk7ZWxzZSBpZighWGEuaXNGbGFzaFVudXNhYmxlKCkmJm51bGw9PT1PLmJyaWRnZSl7dmFyIGI9JC5mbGFzaExvYWRUaW1lb3V0O1wibnVtYmVyXCI9PXR5cGVvZiBiJiZiPj0wJiYoVD1pKGZ1bmN0aW9uKCl7XCJib29sZWFuXCIhPXR5cGVvZiBPLmRlYWN0aXZhdGVkJiYoTy5kZWFjdGl2YXRlZD0hMCksTy5kZWFjdGl2YXRlZD09PSEwJiZYYS5lbWl0KHt0eXBlOlwiZXJyb3JcIixuYW1lOlwiZmxhc2gtZGVhY3RpdmF0ZWRcIn0pfSxiKSksTy5vdmVyZHVlPSExLENhKCl9fSxoYT1mdW5jdGlvbigpe1hhLmNsZWFyRGF0YSgpLFhhLmJsdXIoKSxYYS5lbWl0KFwiZGVzdHJveVwiKSxEYSgpLFhhLm9mZigpfSxpYT1mdW5jdGlvbihhLGIpe3ZhciBjO2lmKFwib2JqZWN0XCI9PXR5cGVvZiBhJiZhJiZcInVuZGVmaW5lZFwiPT10eXBlb2YgYiljPWEsWGEuY2xlYXJEYXRhKCk7ZWxzZXtpZihcInN0cmluZ1wiIT10eXBlb2YgYXx8IWEpcmV0dXJuO2M9e30sY1thXT1ifWZvcih2YXIgZCBpbiBjKVwic3RyaW5nXCI9PXR5cGVvZiBkJiZkJiZ3LmNhbGwoYyxkKSYmXCJzdHJpbmdcIj09dHlwZW9mIGNbZF0mJmNbZF0mJihSW2RdPVVhKGNbZF0pKX0samE9ZnVuY3Rpb24oYSl7XCJ1bmRlZmluZWRcIj09dHlwZW9mIGE/KEUoUiksUz1udWxsKTpcInN0cmluZ1wiPT10eXBlb2YgYSYmdy5jYWxsKFIsYSkmJmRlbGV0ZSBSW2FdfSxrYT1mdW5jdGlvbihhKXtyZXR1cm5cInVuZGVmaW5lZFwiPT10eXBlb2YgYT9CKFIpOlwic3RyaW5nXCI9PXR5cGVvZiBhJiZ3LmNhbGwoUixhKT9SW2FdOnZvaWQgMH0sbGE9ZnVuY3Rpb24oYSl7aWYoYSYmMT09PWEubm9kZVR5cGUpe2QmJihNYShkLCQuYWN0aXZlQ2xhc3MpLGQhPT1hJiZNYShkLCQuaG92ZXJDbGFzcykpLGQ9YSxMYShhLCQuaG92ZXJDbGFzcyk7dmFyIGI9YS5nZXRBdHRyaWJ1dGUoXCJ0aXRsZVwiKXx8JC50aXRsZTtpZihcInN0cmluZ1wiPT10eXBlb2YgYiYmYil7dmFyIGM9QmEoTy5icmlkZ2UpO2MmJmMuc2V0QXR0cmlidXRlKFwidGl0bGVcIixiKX12YXIgZT0kLmZvcmNlSGFuZEN1cnNvcj09PSEwfHxcInBvaW50ZXJcIj09PU5hKGEsXCJjdXJzb3JcIik7U2EoZSksUmEoKX19LG1hPWZ1bmN0aW9uKCl7dmFyIGE9QmEoTy5icmlkZ2UpO2EmJihhLnJlbW92ZUF0dHJpYnV0ZShcInRpdGxlXCIpLGEuc3R5bGUubGVmdD1cIjBweFwiLGEuc3R5bGUudG9wPVwiLTk5OTlweFwiLGEuc3R5bGUud2lkdGg9XCIxcHhcIixhLnN0eWxlLmhlaWdodD1cIjFweFwiKSxkJiYoTWEoZCwkLmhvdmVyQ2xhc3MpLE1hKGQsJC5hY3RpdmVDbGFzcyksZD1udWxsKX0sbmE9ZnVuY3Rpb24oKXtyZXR1cm4gZHx8bnVsbH0sb2E9ZnVuY3Rpb24oYSl7cmV0dXJuXCJzdHJpbmdcIj09dHlwZW9mIGEmJmEmJi9eW0EtWmEtel1bQS1aYS16MC05XzpcXC1cXC5dKiQvLnRlc3QoYSl9LHBhPWZ1bmN0aW9uKGEpe3ZhciBiO2lmKFwic3RyaW5nXCI9PXR5cGVvZiBhJiZhPyhiPWEsYT17fSk6XCJvYmplY3RcIj09dHlwZW9mIGEmJmEmJlwic3RyaW5nXCI9PXR5cGVvZiBhLnR5cGUmJmEudHlwZSYmKGI9YS50eXBlKSxiKXtiPWIudG9Mb3dlckNhc2UoKSwhYS50YXJnZXQmJigvXihjb3B5fGFmdGVyY29weXxfY2xpY2spJC8udGVzdChiKXx8XCJlcnJvclwiPT09YiYmXCJjbGlwYm9hcmQtZXJyb3JcIj09PWEubmFtZSkmJihhLnRhcmdldD1lKSxBKGEse3R5cGU6Yix0YXJnZXQ6YS50YXJnZXR8fGR8fG51bGwscmVsYXRlZFRhcmdldDphLnJlbGF0ZWRUYXJnZXR8fG51bGwsY3VycmVudFRhcmdldDpPJiZPLmJyaWRnZXx8bnVsbCx0aW1lU3RhbXA6YS50aW1lU3RhbXB8fHQoKXx8bnVsbH0pO3ZhciBjPVZbYS50eXBlXTtyZXR1cm5cImVycm9yXCI9PT1hLnR5cGUmJmEubmFtZSYmYyYmKGM9Y1thLm5hbWVdKSxjJiYoYS5tZXNzYWdlPWMpLFwicmVhZHlcIj09PWEudHlwZSYmQShhLHt0YXJnZXQ6bnVsbCx2ZXJzaW9uOk8udmVyc2lvbn0pLFwiZXJyb3JcIj09PWEudHlwZSYmKFkudGVzdChhLm5hbWUpJiZBKGEse3RhcmdldDpudWxsLG1pbmltdW1WZXJzaW9uOlB9KSxaLnRlc3QoYS5uYW1lKSYmQShhLHt2ZXJzaW9uOk8udmVyc2lvbn0pKSxcImNvcHlcIj09PWEudHlwZSYmKGEuY2xpcGJvYXJkRGF0YT17c2V0RGF0YTpYYS5zZXREYXRhLGNsZWFyRGF0YTpYYS5jbGVhckRhdGF9KSxcImFmdGVyY29weVwiPT09YS50eXBlJiYoYT1GYShhLFMpKSxhLnRhcmdldCYmIWEucmVsYXRlZFRhcmdldCYmKGEucmVsYXRlZFRhcmdldD1xYShhLnRhcmdldCkpLHJhKGEpfX0scWE9ZnVuY3Rpb24oYSl7dmFyIGI9YSYmYS5nZXRBdHRyaWJ1dGUmJmEuZ2V0QXR0cmlidXRlKFwiZGF0YS1jbGlwYm9hcmQtdGFyZ2V0XCIpO3JldHVybiBiP2cuZ2V0RWxlbWVudEJ5SWQoYik6bnVsbH0scmE9ZnVuY3Rpb24oYSl7aWYoYSYmL15fKD86Y2xpY2t8bW91c2UoPzpvdmVyfG91dHxkb3dufHVwfG1vdmUpKSQvLnRlc3QoYS50eXBlKSl7dmFyIGM9YS50YXJnZXQsZD1cIl9tb3VzZW92ZXJcIj09PWEudHlwZSYmYS5yZWxhdGVkVGFyZ2V0P2EucmVsYXRlZFRhcmdldDpiLGU9XCJfbW91c2VvdXRcIj09PWEudHlwZSYmYS5yZWxhdGVkVGFyZ2V0P2EucmVsYXRlZFRhcmdldDpiLGg9T2EoYyksaT1mLnNjcmVlbkxlZnR8fGYuc2NyZWVuWHx8MCxqPWYuc2NyZWVuVG9wfHxmLnNjcmVlbll8fDAsaz1nLmJvZHkuc2Nyb2xsTGVmdCtnLmRvY3VtZW50RWxlbWVudC5zY3JvbGxMZWZ0LGw9Zy5ib2R5LnNjcm9sbFRvcCtnLmRvY3VtZW50RWxlbWVudC5zY3JvbGxUb3AsbT1oLmxlZnQrKFwibnVtYmVyXCI9PXR5cGVvZiBhLl9zdGFnZVg/YS5fc3RhZ2VYOjApLG49aC50b3ArKFwibnVtYmVyXCI9PXR5cGVvZiBhLl9zdGFnZVk/YS5fc3RhZ2VZOjApLG89bS1rLHA9bi1sLHE9aStvLHI9aitwLHM9XCJudW1iZXJcIj09dHlwZW9mIGEubW92ZW1lbnRYP2EubW92ZW1lbnRYOjAsdD1cIm51bWJlclwiPT10eXBlb2YgYS5tb3ZlbWVudFk/YS5tb3ZlbWVudFk6MDtkZWxldGUgYS5fc3RhZ2VYLGRlbGV0ZSBhLl9zdGFnZVksQShhLHtzcmNFbGVtZW50OmMsZnJvbUVsZW1lbnQ6ZCx0b0VsZW1lbnQ6ZSxzY3JlZW5YOnEsc2NyZWVuWTpyLHBhZ2VYOm0scGFnZVk6bixjbGllbnRYOm8sY2xpZW50WTpwLHg6byx5OnAsbW92ZW1lbnRYOnMsbW92ZW1lbnRZOnQsb2Zmc2V0WDowLG9mZnNldFk6MCxsYXllclg6MCxsYXllclk6MH0pfXJldHVybiBhfSxzYT1mdW5jdGlvbihhKXt2YXIgYj1hJiZcInN0cmluZ1wiPT10eXBlb2YgYS50eXBlJiZhLnR5cGV8fFwiXCI7cmV0dXJuIS9eKD86KD86YmVmb3JlKT9jb3B5fGRlc3Ryb3kpJC8udGVzdChiKX0sdGE9ZnVuY3Rpb24oYSxiLGMsZCl7ZD9pKGZ1bmN0aW9uKCl7YS5hcHBseShiLGMpfSwwKTphLmFwcGx5KGIsYyl9LHVhPWZ1bmN0aW9uKGEpe2lmKFwib2JqZWN0XCI9PXR5cGVvZiBhJiZhJiZhLnR5cGUpe3ZhciBiPXNhKGEpLGM9UVtcIipcIl18fFtdLGQ9UVthLnR5cGVdfHxbXSxlPWMuY29uY2F0KGQpO2lmKGUmJmUubGVuZ3RoKXt2YXIgZyxoLGksaixrLGw9dGhpcztmb3IoZz0wLGg9ZS5sZW5ndGg7aD5nO2crKylpPWVbZ10saj1sLFwic3RyaW5nXCI9PXR5cGVvZiBpJiZcImZ1bmN0aW9uXCI9PXR5cGVvZiBmW2ldJiYoaT1mW2ldKSxcIm9iamVjdFwiPT10eXBlb2YgaSYmaSYmXCJmdW5jdGlvblwiPT10eXBlb2YgaS5oYW5kbGVFdmVudCYmKGo9aSxpPWkuaGFuZGxlRXZlbnQpLFwiZnVuY3Rpb25cIj09dHlwZW9mIGkmJihrPUEoe30sYSksdGEoaSxqLFtrXSxiKSl9cmV0dXJuIHRoaXN9fSx2YT1mdW5jdGlvbihhKXt2YXIgYj1udWxsO3JldHVybihOPT09ITF8fGEmJlwiZXJyb3JcIj09PWEudHlwZSYmYS5uYW1lJiYtMSE9PVcuaW5kZXhPZihhLm5hbWUpKSYmKGI9ITEpLGJ9LHdhPWZ1bmN0aW9uKGEpe3ZhciBiPWEudGFyZ2V0fHxkfHxudWxsLGY9XCJzd2ZcIj09PWEuX3NvdXJjZTtzd2l0Y2goZGVsZXRlIGEuX3NvdXJjZSxhLnR5cGUpe2Nhc2VcImVycm9yXCI6dmFyIGc9XCJmbGFzaC1zYW5kYm94ZWRcIj09PWEubmFtZXx8dmEoYSk7XCJib29sZWFuXCI9PXR5cGVvZiBnJiYoTy5zYW5kYm94ZWQ9ZyksLTEhPT1YLmluZGV4T2YoYS5uYW1lKT9BKE8se2Rpc2FibGVkOlwiZmxhc2gtZGlzYWJsZWRcIj09PWEubmFtZSxvdXRkYXRlZDpcImZsYXNoLW91dGRhdGVkXCI9PT1hLm5hbWUsdW5hdmFpbGFibGU6XCJmbGFzaC11bmF2YWlsYWJsZVwiPT09YS5uYW1lLGRlZ3JhZGVkOlwiZmxhc2gtZGVncmFkZWRcIj09PWEubmFtZSxkZWFjdGl2YXRlZDpcImZsYXNoLWRlYWN0aXZhdGVkXCI9PT1hLm5hbWUsb3ZlcmR1ZTpcImZsYXNoLW92ZXJkdWVcIj09PWEubmFtZSxyZWFkeTohMX0pOlwidmVyc2lvbi1taXNtYXRjaFwiPT09YS5uYW1lJiYoYz1hLnN3ZlZlcnNpb24sQShPLHtkaXNhYmxlZDohMSxvdXRkYXRlZDohMSx1bmF2YWlsYWJsZTohMSxkZWdyYWRlZDohMSxkZWFjdGl2YXRlZDohMSxvdmVyZHVlOiExLHJlYWR5OiExfSkpLFFhKCk7YnJlYWs7Y2FzZVwicmVhZHlcIjpjPWEuc3dmVmVyc2lvbjt2YXIgaD1PLmRlYWN0aXZhdGVkPT09ITA7QShPLHtkaXNhYmxlZDohMSxvdXRkYXRlZDohMSxzYW5kYm94ZWQ6ITEsdW5hdmFpbGFibGU6ITEsZGVncmFkZWQ6ITEsZGVhY3RpdmF0ZWQ6ITEsb3ZlcmR1ZTpoLHJlYWR5OiFofSksUWEoKTticmVhaztjYXNlXCJiZWZvcmVjb3B5XCI6ZT1iO2JyZWFrO2Nhc2VcImNvcHlcIjp2YXIgaSxqLGs9YS5yZWxhdGVkVGFyZ2V0OyFSW1widGV4dC9odG1sXCJdJiYhUltcInRleHQvcGxhaW5cIl0mJmsmJihqPWsudmFsdWV8fGsub3V0ZXJIVE1MfHxrLmlubmVySFRNTCkmJihpPWsudmFsdWV8fGsudGV4dENvbnRlbnR8fGsuaW5uZXJUZXh0KT8oYS5jbGlwYm9hcmREYXRhLmNsZWFyRGF0YSgpLGEuY2xpcGJvYXJkRGF0YS5zZXREYXRhKFwidGV4dC9wbGFpblwiLGkpLGohPT1pJiZhLmNsaXBib2FyZERhdGEuc2V0RGF0YShcInRleHQvaHRtbFwiLGopKTohUltcInRleHQvcGxhaW5cIl0mJmEudGFyZ2V0JiYoaT1hLnRhcmdldC5nZXRBdHRyaWJ1dGUoXCJkYXRhLWNsaXBib2FyZC10ZXh0XCIpKSYmKGEuY2xpcGJvYXJkRGF0YS5jbGVhckRhdGEoKSxhLmNsaXBib2FyZERhdGEuc2V0RGF0YShcInRleHQvcGxhaW5cIixpKSk7YnJlYWs7Y2FzZVwiYWZ0ZXJjb3B5XCI6eGEoYSksWGEuY2xlYXJEYXRhKCksYiYmYiE9PUthKCkmJmIuZm9jdXMmJmIuZm9jdXMoKTticmVhaztjYXNlXCJfbW91c2VvdmVyXCI6WGEuZm9jdXMoYiksJC5idWJibGVFdmVudHM9PT0hMCYmZiYmKGImJmIhPT1hLnJlbGF0ZWRUYXJnZXQmJiFGKGEucmVsYXRlZFRhcmdldCxiKSYmeWEoQSh7fSxhLHt0eXBlOlwibW91c2VlbnRlclwiLGJ1YmJsZXM6ITEsY2FuY2VsYWJsZTohMX0pKSx5YShBKHt9LGEse3R5cGU6XCJtb3VzZW92ZXJcIn0pKSk7YnJlYWs7Y2FzZVwiX21vdXNlb3V0XCI6WGEuYmx1cigpLCQuYnViYmxlRXZlbnRzPT09ITAmJmYmJihiJiZiIT09YS5yZWxhdGVkVGFyZ2V0JiYhRihhLnJlbGF0ZWRUYXJnZXQsYikmJnlhKEEoe30sYSx7dHlwZTpcIm1vdXNlbGVhdmVcIixidWJibGVzOiExLGNhbmNlbGFibGU6ITF9KSkseWEoQSh7fSxhLHt0eXBlOlwibW91c2VvdXRcIn0pKSk7YnJlYWs7Y2FzZVwiX21vdXNlZG93blwiOkxhKGIsJC5hY3RpdmVDbGFzcyksJC5idWJibGVFdmVudHM9PT0hMCYmZiYmeWEoQSh7fSxhLHt0eXBlOmEudHlwZS5zbGljZSgxKX0pKTticmVhaztjYXNlXCJfbW91c2V1cFwiOk1hKGIsJC5hY3RpdmVDbGFzcyksJC5idWJibGVFdmVudHM9PT0hMCYmZiYmeWEoQSh7fSxhLHt0eXBlOmEudHlwZS5zbGljZSgxKX0pKTticmVhaztjYXNlXCJfY2xpY2tcIjplPW51bGwsJC5idWJibGVFdmVudHM9PT0hMCYmZiYmeWEoQSh7fSxhLHt0eXBlOmEudHlwZS5zbGljZSgxKX0pKTticmVhaztjYXNlXCJfbW91c2Vtb3ZlXCI6JC5idWJibGVFdmVudHM9PT0hMCYmZiYmeWEoQSh7fSxhLHt0eXBlOmEudHlwZS5zbGljZSgxKX0pKX1yZXR1cm4vXl8oPzpjbGlja3xtb3VzZSg/Om92ZXJ8b3V0fGRvd258dXB8bW92ZSkpJC8udGVzdChhLnR5cGUpPyEwOnZvaWQgMH0seGE9ZnVuY3Rpb24oYSl7aWYoYS5lcnJvcnMmJmEuZXJyb3JzLmxlbmd0aD4wKXt2YXIgYj1CKGEpO0EoYix7dHlwZTpcImVycm9yXCIsbmFtZTpcImNsaXBib2FyZC1lcnJvclwifSksZGVsZXRlIGIuc3VjY2VzcyxpKGZ1bmN0aW9uKCl7WGEuZW1pdChiKX0sMCl9fSx5YT1mdW5jdGlvbihhKXtpZihhJiZcInN0cmluZ1wiPT10eXBlb2YgYS50eXBlJiZhKXt2YXIgYixjPWEudGFyZ2V0fHxudWxsLGQ9YyYmYy5vd25lckRvY3VtZW50fHxnLGU9e3ZpZXc6ZC5kZWZhdWx0Vmlld3x8ZixjYW5CdWJibGU6ITAsY2FuY2VsYWJsZTohMCxkZXRhaWw6XCJjbGlja1wiPT09YS50eXBlPzE6MCxidXR0b246XCJudW1iZXJcIj09dHlwZW9mIGEud2hpY2g/YS53aGljaC0xOlwibnVtYmVyXCI9PXR5cGVvZiBhLmJ1dHRvbj9hLmJ1dHRvbjpkLmNyZWF0ZUV2ZW50PzA6MX0saD1BKGUsYSk7YyYmZC5jcmVhdGVFdmVudCYmYy5kaXNwYXRjaEV2ZW50JiYoaD1baC50eXBlLGguY2FuQnViYmxlLGguY2FuY2VsYWJsZSxoLnZpZXcsaC5kZXRhaWwsaC5zY3JlZW5YLGguc2NyZWVuWSxoLmNsaWVudFgsaC5jbGllbnRZLGguY3RybEtleSxoLmFsdEtleSxoLnNoaWZ0S2V5LGgubWV0YUtleSxoLmJ1dHRvbixoLnJlbGF0ZWRUYXJnZXRdLGI9ZC5jcmVhdGVFdmVudChcIk1vdXNlRXZlbnRzXCIpLGIuaW5pdE1vdXNlRXZlbnQmJihiLmluaXRNb3VzZUV2ZW50LmFwcGx5KGIsaCksYi5fc291cmNlPVwianNcIixjLmRpc3BhdGNoRXZlbnQoYikpKX19LHphPWZ1bmN0aW9uKCl7dmFyIGE9JC5mbGFzaExvYWRUaW1lb3V0O2lmKFwibnVtYmVyXCI9PXR5cGVvZiBhJiZhPj0wKXt2YXIgYj1NYXRoLm1pbigxZTMsYS8xMCksYz0kLnN3Zk9iamVjdElkK1wiX2ZhbGxiYWNrQ29udGVudFwiO1U9ayhmdW5jdGlvbigpe3ZhciBhPWcuZ2V0RWxlbWVudEJ5SWQoYyk7UGEoYSkmJihRYSgpLE8uZGVhY3RpdmF0ZWQ9bnVsbCxYYS5lbWl0KHt0eXBlOlwiZXJyb3JcIixuYW1lOlwic3dmLW5vdC1mb3VuZFwifSkpfSxiKX19LEFhPWZ1bmN0aW9uKCl7dmFyIGE9Zy5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO3JldHVybiBhLmlkPSQuY29udGFpbmVySWQsYS5jbGFzc05hbWU9JC5jb250YWluZXJDbGFzcyxhLnN0eWxlLnBvc2l0aW9uPVwiYWJzb2x1dGVcIixhLnN0eWxlLmxlZnQ9XCIwcHhcIixhLnN0eWxlLnRvcD1cIi05OTk5cHhcIixhLnN0eWxlLndpZHRoPVwiMXB4XCIsYS5zdHlsZS5oZWlnaHQ9XCIxcHhcIixhLnN0eWxlLnpJbmRleD1cIlwiK1RhKCQuekluZGV4KSxhfSxCYT1mdW5jdGlvbihhKXtmb3IodmFyIGI9YSYmYS5wYXJlbnROb2RlO2ImJlwiT0JKRUNUXCI9PT1iLm5vZGVOYW1lJiZiLnBhcmVudE5vZGU7KWI9Yi5wYXJlbnROb2RlO3JldHVybiBifHxudWxsfSxDYT1mdW5jdGlvbigpe3ZhciBhLGI9Ty5icmlkZ2UsYz1CYShiKTtpZighYil7dmFyIGQ9SmEoZi5sb2NhdGlvbi5ob3N0LCQpLGU9XCJuZXZlclwiPT09ZD9cIm5vbmVcIjpcImFsbFwiLGg9SGEoQSh7anNWZXJzaW9uOlhhLnZlcnNpb259LCQpKSxpPSQuc3dmUGF0aCtHYSgkLnN3ZlBhdGgsJCk7Yz1BYSgpO3ZhciBqPWcuY3JlYXRlRWxlbWVudChcImRpdlwiKTtjLmFwcGVuZENoaWxkKGopLGcuYm9keS5hcHBlbmRDaGlsZChjKTt2YXIgaz1nLmNyZWF0ZUVsZW1lbnQoXCJkaXZcIiksbD1cImFjdGl2ZXhcIj09PU8ucGx1Z2luVHlwZTtrLmlubmVySFRNTD0nPG9iamVjdCBpZD1cIicrJC5zd2ZPYmplY3RJZCsnXCIgbmFtZT1cIicrJC5zd2ZPYmplY3RJZCsnXCIgd2lkdGg9XCIxMDAlXCIgaGVpZ2h0PVwiMTAwJVwiICcrKGw/J2NsYXNzaWQ9XCJjbHNpZDpkMjdjZGI2ZS1hZTZkLTExY2YtOTZiOC00NDQ1NTM1NDAwMDBcIic6J3R5cGU9XCJhcHBsaWNhdGlvbi94LXNob2Nrd2F2ZS1mbGFzaFwiIGRhdGE9XCInK2krJ1wiJykrXCI+XCIrKGw/JzxwYXJhbSBuYW1lPVwibW92aWVcIiB2YWx1ZT1cIicraSsnXCIvPic6XCJcIikrJzxwYXJhbSBuYW1lPVwiYWxsb3dTY3JpcHRBY2Nlc3NcIiB2YWx1ZT1cIicrZCsnXCIvPjxwYXJhbSBuYW1lPVwiYWxsb3dOZXR3b3JraW5nXCIgdmFsdWU9XCInK2UrJ1wiLz48cGFyYW0gbmFtZT1cIm1lbnVcIiB2YWx1ZT1cImZhbHNlXCIvPjxwYXJhbSBuYW1lPVwid21vZGVcIiB2YWx1ZT1cInRyYW5zcGFyZW50XCIvPjxwYXJhbSBuYW1lPVwiZmxhc2h2YXJzXCIgdmFsdWU9XCInK2grJ1wiLz48ZGl2IGlkPVwiJyskLnN3Zk9iamVjdElkKydfZmFsbGJhY2tDb250ZW50XCI+Jm5ic3A7PC9kaXY+PC9vYmplY3Q+JyxiPWsuZmlyc3RDaGlsZCxrPW51bGwseShiKS5aZXJvQ2xpcGJvYXJkPVhhLGMucmVwbGFjZUNoaWxkKGIsaiksemEoKX1yZXR1cm4gYnx8KGI9Z1skLnN3Zk9iamVjdElkXSxiJiYoYT1iLmxlbmd0aCkmJihiPWJbYS0xXSksIWImJmMmJihiPWMuZmlyc3RDaGlsZCkpLE8uYnJpZGdlPWJ8fG51bGwsYn0sRGE9ZnVuY3Rpb24oKXt2YXIgYT1PLmJyaWRnZTtpZihhKXt2YXIgZD1CYShhKTtkJiYoXCJhY3RpdmV4XCI9PT1PLnBsdWdpblR5cGUmJlwicmVhZHlTdGF0ZVwiaW4gYT8oYS5zdHlsZS5kaXNwbGF5PVwibm9uZVwiLGZ1bmN0aW9uIGUoKXtpZig0PT09YS5yZWFkeVN0YXRlKXtmb3IodmFyIGIgaW4gYSlcImZ1bmN0aW9uXCI9PXR5cGVvZiBhW2JdJiYoYVtiXT1udWxsKTthLnBhcmVudE5vZGUmJmEucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChhKSxkLnBhcmVudE5vZGUmJmQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChkKX1lbHNlIGkoZSwxMCl9KCkpOihhLnBhcmVudE5vZGUmJmEucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChhKSxkLnBhcmVudE5vZGUmJmQucGFyZW50Tm9kZS5yZW1vdmVDaGlsZChkKSkpLFFhKCksTy5yZWFkeT1udWxsLE8uYnJpZGdlPW51bGwsTy5kZWFjdGl2YXRlZD1udWxsLGM9Yn19LEVhPWZ1bmN0aW9uKGEpe3ZhciBiPXt9LGM9e307aWYoXCJvYmplY3RcIj09dHlwZW9mIGEmJmEpe2Zvcih2YXIgZCBpbiBhKWlmKGQmJncuY2FsbChhLGQpJiZcInN0cmluZ1wiPT10eXBlb2YgYVtkXSYmYVtkXSlzd2l0Y2goZC50b0xvd2VyQ2FzZSgpKXtjYXNlXCJ0ZXh0L3BsYWluXCI6Y2FzZVwidGV4dFwiOmNhc2VcImFpcjp0ZXh0XCI6Y2FzZVwiZmxhc2g6dGV4dFwiOmIudGV4dD1hW2RdLGMudGV4dD1kO2JyZWFrO2Nhc2VcInRleHQvaHRtbFwiOmNhc2VcImh0bWxcIjpjYXNlXCJhaXI6aHRtbFwiOmNhc2VcImZsYXNoOmh0bWxcIjpiLmh0bWw9YVtkXSxjLmh0bWw9ZDticmVhaztjYXNlXCJhcHBsaWNhdGlvbi9ydGZcIjpjYXNlXCJ0ZXh0L3J0ZlwiOmNhc2VcInJ0ZlwiOmNhc2VcInJpY2h0ZXh0XCI6Y2FzZVwiYWlyOnJ0ZlwiOmNhc2VcImZsYXNoOnJ0ZlwiOmIucnRmPWFbZF0sYy5ydGY9ZH1yZXR1cm57ZGF0YTpiLGZvcm1hdE1hcDpjfX19LEZhPWZ1bmN0aW9uKGEsYil7aWYoXCJvYmplY3RcIiE9dHlwZW9mIGF8fCFhfHxcIm9iamVjdFwiIT10eXBlb2YgYnx8IWIpcmV0dXJuIGE7dmFyIGM9e307Zm9yKHZhciBkIGluIGEpaWYody5jYWxsKGEsZCkpaWYoXCJlcnJvcnNcIj09PWQpe2NbZF09YVtkXT9hW2RdLnNsaWNlKCk6W107Zm9yKHZhciBlPTAsZj1jW2RdLmxlbmd0aDtmPmU7ZSsrKWNbZF1bZV0uZm9ybWF0PWJbY1tkXVtlXS5mb3JtYXRdfWVsc2UgaWYoXCJzdWNjZXNzXCIhPT1kJiZcImRhdGFcIiE9PWQpY1tkXT1hW2RdO2Vsc2V7Y1tkXT17fTt2YXIgZz1hW2RdO2Zvcih2YXIgaCBpbiBnKWgmJncuY2FsbChnLGgpJiZ3LmNhbGwoYixoKSYmKGNbZF1bYltoXV09Z1toXSl9cmV0dXJuIGN9LEdhPWZ1bmN0aW9uKGEsYil7dmFyIGM9bnVsbD09Ynx8YiYmYi5jYWNoZUJ1c3Q9PT0hMDtyZXR1cm4gYz8oLTE9PT1hLmluZGV4T2YoXCI/XCIpP1wiP1wiOlwiJlwiKStcIm5vQ2FjaGU9XCIrdCgpOlwiXCJ9LEhhPWZ1bmN0aW9uKGEpe3ZhciBiLGMsZCxlLGc9XCJcIixoPVtdO2lmKGEudHJ1c3RlZERvbWFpbnMmJihcInN0cmluZ1wiPT10eXBlb2YgYS50cnVzdGVkRG9tYWlucz9lPVthLnRydXN0ZWREb21haW5zXTpcIm9iamVjdFwiPT10eXBlb2YgYS50cnVzdGVkRG9tYWlucyYmXCJsZW5ndGhcImluIGEudHJ1c3RlZERvbWFpbnMmJihlPWEudHJ1c3RlZERvbWFpbnMpKSxlJiZlLmxlbmd0aClmb3IoYj0wLGM9ZS5sZW5ndGg7Yz5iO2IrKylpZih3LmNhbGwoZSxiKSYmZVtiXSYmXCJzdHJpbmdcIj09dHlwZW9mIGVbYl0pe2lmKGQ9SWEoZVtiXSksIWQpY29udGludWU7aWYoXCIqXCI9PT1kKXtoLmxlbmd0aD0wLGgucHVzaChkKTticmVha31oLnB1c2guYXBwbHkoaCxbZCxcIi8vXCIrZCxmLmxvY2F0aW9uLnByb3RvY29sK1wiLy9cIitkXSl9cmV0dXJuIGgubGVuZ3RoJiYoZys9XCJ0cnVzdGVkT3JpZ2lucz1cIituKGguam9pbihcIixcIikpKSxhLmZvcmNlRW5oYW5jZWRDbGlwYm9hcmQ9PT0hMCYmKGcrPShnP1wiJlwiOlwiXCIpK1wiZm9yY2VFbmhhbmNlZENsaXBib2FyZD10cnVlXCIpLFwic3RyaW5nXCI9PXR5cGVvZiBhLnN3Zk9iamVjdElkJiZhLnN3Zk9iamVjdElkJiYoZys9KGc/XCImXCI6XCJcIikrXCJzd2ZPYmplY3RJZD1cIituKGEuc3dmT2JqZWN0SWQpKSxcInN0cmluZ1wiPT10eXBlb2YgYS5qc1ZlcnNpb24mJmEuanNWZXJzaW9uJiYoZys9KGc/XCImXCI6XCJcIikrXCJqc1ZlcnNpb249XCIrbihhLmpzVmVyc2lvbikpLGd9LElhPWZ1bmN0aW9uKGEpe2lmKG51bGw9PWF8fFwiXCI9PT1hKXJldHVybiBudWxsO2lmKGE9YS5yZXBsYWNlKC9eXFxzK3xcXHMrJC9nLFwiXCIpLFwiXCI9PT1hKXJldHVybiBudWxsO3ZhciBiPWEuaW5kZXhPZihcIi8vXCIpO2E9LTE9PT1iP2E6YS5zbGljZShiKzIpO3ZhciBjPWEuaW5kZXhPZihcIi9cIik7cmV0dXJuIGE9LTE9PT1jP2E6LTE9PT1ifHwwPT09Yz9udWxsOmEuc2xpY2UoMCxjKSxhJiZcIi5zd2ZcIj09PWEuc2xpY2UoLTQpLnRvTG93ZXJDYXNlKCk/bnVsbDphfHxudWxsfSxKYT1mdW5jdGlvbigpe3ZhciBhPWZ1bmN0aW9uKGEpe3ZhciBiLGMsZCxlPVtdO2lmKFwic3RyaW5nXCI9PXR5cGVvZiBhJiYoYT1bYV0pLFwib2JqZWN0XCIhPXR5cGVvZiBhfHwhYXx8XCJudW1iZXJcIiE9dHlwZW9mIGEubGVuZ3RoKXJldHVybiBlO2ZvcihiPTAsYz1hLmxlbmd0aDtjPmI7YisrKWlmKHcuY2FsbChhLGIpJiYoZD1JYShhW2JdKSkpe2lmKFwiKlwiPT09ZCl7ZS5sZW5ndGg9MCxlLnB1c2goXCIqXCIpO2JyZWFrfS0xPT09ZS5pbmRleE9mKGQpJiZlLnB1c2goZCl9cmV0dXJuIGV9O3JldHVybiBmdW5jdGlvbihiLGMpe3ZhciBkPUlhKGMuc3dmUGF0aCk7bnVsbD09PWQmJihkPWIpO3ZhciBlPWEoYy50cnVzdGVkRG9tYWlucyksZj1lLmxlbmd0aDtpZihmPjApe2lmKDE9PT1mJiZcIipcIj09PWVbMF0pcmV0dXJuXCJhbHdheXNcIjtpZigtMSE9PWUuaW5kZXhPZihiKSlyZXR1cm4gMT09PWYmJmI9PT1kP1wic2FtZURvbWFpblwiOlwiYWx3YXlzXCJ9cmV0dXJuXCJuZXZlclwifX0oKSxLYT1mdW5jdGlvbigpe3RyeXtyZXR1cm4gZy5hY3RpdmVFbGVtZW50fWNhdGNoKGEpe3JldHVybiBudWxsfX0sTGE9ZnVuY3Rpb24oYSxiKXt2YXIgYyxkLGUsZj1bXTtpZihcInN0cmluZ1wiPT10eXBlb2YgYiYmYiYmKGY9Yi5zcGxpdCgvXFxzKy8pKSxhJiYxPT09YS5ub2RlVHlwZSYmZi5sZW5ndGg+MCl7Zm9yKGU9KFwiIFwiKyhhLmNsYXNzTmFtZXx8XCJcIikrXCIgXCIpLnJlcGxhY2UoL1tcXHRcXHJcXG5cXGZdL2csXCIgXCIpLGM9MCxkPWYubGVuZ3RoO2Q+YztjKyspLTE9PT1lLmluZGV4T2YoXCIgXCIrZltjXStcIiBcIikmJihlKz1mW2NdK1wiIFwiKTtlPWUucmVwbGFjZSgvXlxccyt8XFxzKyQvZyxcIlwiKSxlIT09YS5jbGFzc05hbWUmJihhLmNsYXNzTmFtZT1lKX1yZXR1cm4gYX0sTWE9ZnVuY3Rpb24oYSxiKXt2YXIgYyxkLGUsZj1bXTtpZihcInN0cmluZ1wiPT10eXBlb2YgYiYmYiYmKGY9Yi5zcGxpdCgvXFxzKy8pKSxhJiYxPT09YS5ub2RlVHlwZSYmZi5sZW5ndGg+MCYmYS5jbGFzc05hbWUpe2ZvcihlPShcIiBcIithLmNsYXNzTmFtZStcIiBcIikucmVwbGFjZSgvW1xcdFxcclxcblxcZl0vZyxcIiBcIiksYz0wLGQ9Zi5sZW5ndGg7ZD5jO2MrKyllPWUucmVwbGFjZShcIiBcIitmW2NdK1wiIFwiLFwiIFwiKTtlPWUucmVwbGFjZSgvXlxccyt8XFxzKyQvZyxcIlwiKSxlIT09YS5jbGFzc05hbWUmJihhLmNsYXNzTmFtZT1lKX1yZXR1cm4gYX0sTmE9ZnVuY3Rpb24oYSxiKXt2YXIgYz1tKGEsbnVsbCkuZ2V0UHJvcGVydHlWYWx1ZShiKTtyZXR1cm5cImN1cnNvclwiIT09Ynx8YyYmXCJhdXRvXCIhPT1jfHxcIkFcIiE9PWEubm9kZU5hbWU/YzpcInBvaW50ZXJcIn0sT2E9ZnVuY3Rpb24oYSl7dmFyIGI9e2xlZnQ6MCx0b3A6MCx3aWR0aDowLGhlaWdodDowfTtpZihhLmdldEJvdW5kaW5nQ2xpZW50UmVjdCl7dmFyIGM9YS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSxkPWYucGFnZVhPZmZzZXQsZT1mLnBhZ2VZT2Zmc2V0LGg9Zy5kb2N1bWVudEVsZW1lbnQuY2xpZW50TGVmdHx8MCxpPWcuZG9jdW1lbnRFbGVtZW50LmNsaWVudFRvcHx8MCxqPTAsaz0wO2lmKFwicmVsYXRpdmVcIj09PU5hKGcuYm9keSxcInBvc2l0aW9uXCIpKXt2YXIgbD1nLmJvZHkuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCksbT1nLmRvY3VtZW50RWxlbWVudC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTtqPWwubGVmdC1tLmxlZnR8fDAsaz1sLnRvcC1tLnRvcHx8MH1iLmxlZnQ9Yy5sZWZ0K2QtaC1qLGIudG9wPWMudG9wK2UtaS1rLGIud2lkdGg9XCJ3aWR0aFwiaW4gYz9jLndpZHRoOmMucmlnaHQtYy5sZWZ0LGIuaGVpZ2h0PVwiaGVpZ2h0XCJpbiBjP2MuaGVpZ2h0OmMuYm90dG9tLWMudG9wfXJldHVybiBifSxQYT1mdW5jdGlvbihhKXtpZighYSlyZXR1cm4hMTt2YXIgYj1tKGEsbnVsbCk7aWYoIWIpcmV0dXJuITE7dmFyIGM9cihiLmhlaWdodCk+MCxkPXIoYi53aWR0aCk+MCxlPXIoYi50b3ApPj0wLGY9cihiLmxlZnQpPj0wLGc9YyYmZCYmZSYmZixoPWc/bnVsbDpPYShhKSxpPVwibm9uZVwiIT09Yi5kaXNwbGF5JiZcImNvbGxhcHNlXCIhPT1iLnZpc2liaWxpdHkmJihnfHwhIWgmJihjfHxoLmhlaWdodD4wKSYmKGR8fGgud2lkdGg+MCkmJihlfHxoLnRvcD49MCkmJihmfHxoLmxlZnQ+PTApKTtyZXR1cm4gaX0sUWE9ZnVuY3Rpb24oKXtqKFQpLFQ9MCxsKFUpLFU9MH0sUmE9ZnVuY3Rpb24oKXt2YXIgYTtpZihkJiYoYT1CYShPLmJyaWRnZSkpKXt2YXIgYj1PYShkKTtBKGEuc3R5bGUse3dpZHRoOmIud2lkdGgrXCJweFwiLGhlaWdodDpiLmhlaWdodCtcInB4XCIsdG9wOmIudG9wK1wicHhcIixsZWZ0OmIubGVmdCtcInB4XCIsekluZGV4OlwiXCIrVGEoJC56SW5kZXgpfSl9fSxTYT1mdW5jdGlvbihhKXtPLnJlYWR5PT09ITAmJihPLmJyaWRnZSYmXCJmdW5jdGlvblwiPT10eXBlb2YgTy5icmlkZ2Uuc2V0SGFuZEN1cnNvcj9PLmJyaWRnZS5zZXRIYW5kQ3Vyc29yKGEpOk8ucmVhZHk9ITEpfSxUYT1mdW5jdGlvbihhKXtpZigvXig/OmF1dG98aW5oZXJpdCkkLy50ZXN0KGEpKXJldHVybiBhO3ZhciBiO3JldHVyblwibnVtYmVyXCIhPXR5cGVvZiBhfHxzKGEpP1wic3RyaW5nXCI9PXR5cGVvZiBhJiYoYj1UYShxKGEsMTApKSk6Yj1hLFwibnVtYmVyXCI9PXR5cGVvZiBiP2I6XCJhdXRvXCJ9LFVhPWZ1bmN0aW9uKGEpe3ZhciBiPS8oXFxyXFxufFxccnxcXG4pL2c7cmV0dXJuXCJzdHJpbmdcIj09dHlwZW9mIGEmJiQuZml4TGluZUVuZGluZ3M9PT0hMCYmKE0oKT8vKChefFteXFxyXSlcXG58XFxyKFteXFxuXXwkKSkvLnRlc3QoYSkmJihhPWEucmVwbGFjZShiLFwiXFxyXFxuXCIpKTovXFxyLy50ZXN0KGEpJiYoYT1hLnJlcGxhY2UoYixcIlxcblwiKSkpLGF9LFZhPWZ1bmN0aW9uKGIpe3ZhciBjLGQsZSxmPU8uc2FuZGJveGVkLGc9bnVsbDtpZihiPWI9PT0hMCxOPT09ITEpZz0hMTtlbHNle3RyeXtkPWEuZnJhbWVFbGVtZW50fHxudWxsfWNhdGNoKGgpe2U9e25hbWU6aC5uYW1lLG1lc3NhZ2U6aC5tZXNzYWdlfX1pZihkJiYxPT09ZC5ub2RlVHlwZSYmXCJJRlJBTUVcIj09PWQubm9kZU5hbWUpdHJ5e2c9ZC5oYXNBdHRyaWJ1dGUoXCJzYW5kYm94XCIpfWNhdGNoKGgpe2c9bnVsbH1lbHNle3RyeXtjPWRvY3VtZW50LmRvbWFpbnx8bnVsbH1jYXRjaChoKXtjPW51bGx9KG51bGw9PT1jfHxlJiZcIlNlY3VyaXR5RXJyb3JcIj09PWUubmFtZSYmLyhefFtcXHNcXChcXFtAXSlzYW5kYm94KGVzfGVkfGluZ3xbXFxzXFwuLCFcXClcXF1AXXwkKS8udGVzdChlLm1lc3NhZ2UudG9Mb3dlckNhc2UoKSkpJiYoZz0hMCl9fXJldHVybiBPLnNhbmRib3hlZD1nLGY9PT1nfHxifHxXYShvKSxnfSxXYT1mdW5jdGlvbihhKXtmdW5jdGlvbiBiKGEpe3ZhciBiPWEubWF0Y2goL1tcXGRdKy9nKTtyZXR1cm4gYi5sZW5ndGg9MyxiLmpvaW4oXCIuXCIpfWZ1bmN0aW9uIGMoYSl7cmV0dXJuISFhJiYoYT1hLnRvTG93ZXJDYXNlKCkpJiYoL14ocGVwZmxhc2hwbGF5ZXJcXC5kbGx8bGlicGVwZmxhc2hwbGF5ZXJcXC5zb3xwZXBwZXJmbGFzaHBsYXllclxcLnBsdWdpbikkLy50ZXN0KGEpfHxcImNocm9tZS5wbHVnaW5cIj09PWEuc2xpY2UoLTEzKSl9ZnVuY3Rpb24gZChhKXthJiYoaT0hMCxhLnZlcnNpb24mJihsPWIoYS52ZXJzaW9uKSksIWwmJmEuZGVzY3JpcHRpb24mJihsPWIoYS5kZXNjcmlwdGlvbikpLGEuZmlsZW5hbWUmJihrPWMoYS5maWxlbmFtZSkpKX12YXIgZSxmLGcsaT0hMSxqPSExLGs9ITEsbD1cIlwiO2lmKGgucGx1Z2lucyYmaC5wbHVnaW5zLmxlbmd0aCllPWgucGx1Z2luc1tcIlNob2Nrd2F2ZSBGbGFzaFwiXSxkKGUpLGgucGx1Z2luc1tcIlNob2Nrd2F2ZSBGbGFzaCAyLjBcIl0mJihpPSEwLGw9XCIyLjAuMC4xMVwiKTtlbHNlIGlmKGgubWltZVR5cGVzJiZoLm1pbWVUeXBlcy5sZW5ndGgpZz1oLm1pbWVUeXBlc1tcImFwcGxpY2F0aW9uL3gtc2hvY2t3YXZlLWZsYXNoXCJdLGU9ZyYmZy5lbmFibGVkUGx1Z2luLGQoZSk7ZWxzZSBpZihcInVuZGVmaW5lZFwiIT10eXBlb2YgYSl7aj0hMDt0cnl7Zj1uZXcgYShcIlNob2Nrd2F2ZUZsYXNoLlNob2Nrd2F2ZUZsYXNoLjdcIiksaT0hMCxsPWIoZi5HZXRWYXJpYWJsZShcIiR2ZXJzaW9uXCIpKX1jYXRjaChtKXt0cnl7Zj1uZXcgYShcIlNob2Nrd2F2ZUZsYXNoLlNob2Nrd2F2ZUZsYXNoLjZcIiksaT0hMCxsPVwiNi4wLjIxXCJ9Y2F0Y2gobil7dHJ5e2Y9bmV3IGEoXCJTaG9ja3dhdmVGbGFzaC5TaG9ja3dhdmVGbGFzaFwiKSxpPSEwLGw9YihmLkdldFZhcmlhYmxlKFwiJHZlcnNpb25cIikpfWNhdGNoKG8pe2o9ITF9fX19Ty5kaXNhYmxlZD1pIT09ITAsTy5vdXRkYXRlZD1sJiZyKGwpPHIoUCksTy52ZXJzaW9uPWx8fFwiMC4wLjBcIixPLnBsdWdpblR5cGU9az9cInBlcHBlclwiOmo/XCJhY3RpdmV4XCI6aT9cIm5ldHNjYXBlXCI6XCJ1bmtub3duXCJ9O1dhKG8pLFZhKCEwKTt2YXIgWGE9ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcyBpbnN0YW5jZW9mIFhhP3ZvaWQoXCJmdW5jdGlvblwiPT10eXBlb2YgWGEuX2NyZWF0ZUNsaWVudCYmWGEuX2NyZWF0ZUNsaWVudC5hcHBseSh0aGlzLHooYXJndW1lbnRzKSkpOm5ldyBYYX07dihYYSxcInZlcnNpb25cIix7dmFsdWU6XCIyLjMuMC1iZXRhLjFcIix3cml0YWJsZTohMSxjb25maWd1cmFibGU6ITAsZW51bWVyYWJsZTohMH0pLFhhLmNvbmZpZz1mdW5jdGlvbigpe3JldHVybiBfLmFwcGx5KHRoaXMseihhcmd1bWVudHMpKX0sWGEuc3RhdGU9ZnVuY3Rpb24oKXtyZXR1cm4gYWEuYXBwbHkodGhpcyx6KGFyZ3VtZW50cykpfSxYYS5pc0ZsYXNoVW51c2FibGU9ZnVuY3Rpb24oKXtyZXR1cm4gYmEuYXBwbHkodGhpcyx6KGFyZ3VtZW50cykpfSxYYS5vbj1mdW5jdGlvbigpe3JldHVybiBjYS5hcHBseSh0aGlzLHooYXJndW1lbnRzKSl9LFhhLm9mZj1mdW5jdGlvbigpe3JldHVybiBkYS5hcHBseSh0aGlzLHooYXJndW1lbnRzKSl9LFhhLmhhbmRsZXJzPWZ1bmN0aW9uKCl7cmV0dXJuIGVhLmFwcGx5KHRoaXMseihhcmd1bWVudHMpKX0sWGEuZW1pdD1mdW5jdGlvbigpe3JldHVybiBmYS5hcHBseSh0aGlzLHooYXJndW1lbnRzKSl9LFhhLmNyZWF0ZT1mdW5jdGlvbigpe3JldHVybiBnYS5hcHBseSh0aGlzLHooYXJndW1lbnRzKSl9LFhhLmRlc3Ryb3k9ZnVuY3Rpb24oKXtyZXR1cm4gaGEuYXBwbHkodGhpcyx6KGFyZ3VtZW50cykpfSxYYS5zZXREYXRhPWZ1bmN0aW9uKCl7cmV0dXJuIGlhLmFwcGx5KHRoaXMseihhcmd1bWVudHMpKX0sWGEuY2xlYXJEYXRhPWZ1bmN0aW9uKCl7cmV0dXJuIGphLmFwcGx5KHRoaXMseihhcmd1bWVudHMpKX0sWGEuZ2V0RGF0YT1mdW5jdGlvbigpe3JldHVybiBrYS5hcHBseSh0aGlzLHooYXJndW1lbnRzKSl9LFhhLmZvY3VzPVhhLmFjdGl2YXRlPWZ1bmN0aW9uKCl7cmV0dXJuIGxhLmFwcGx5KHRoaXMseihhcmd1bWVudHMpKX0sWGEuYmx1cj1YYS5kZWFjdGl2YXRlPWZ1bmN0aW9uKCl7cmV0dXJuIG1hLmFwcGx5KHRoaXMseihhcmd1bWVudHMpKX0sWGEuYWN0aXZlRWxlbWVudD1mdW5jdGlvbigpe3JldHVybiBuYS5hcHBseSh0aGlzLHooYXJndW1lbnRzKSl9O3ZhciBZYT0wLFphPXt9LCRhPTAsX2E9e30sYWI9e307QSgkLHthdXRvQWN0aXZhdGU6ITB9KTt2YXIgYmI9ZnVuY3Rpb24oYSl7dmFyIGI9dGhpcztiLmlkPVwiXCIrWWErKyxaYVtiLmlkXT17aW5zdGFuY2U6YixlbGVtZW50czpbXSxoYW5kbGVyczp7fX0sYSYmYi5jbGlwKGEpLFhhLm9uKFwiKlwiLGZ1bmN0aW9uKGEpe3JldHVybiBiLmVtaXQoYSl9KSxYYS5vbihcImRlc3Ryb3lcIixmdW5jdGlvbigpe2IuZGVzdHJveSgpfSksWGEuY3JlYXRlKCl9LGNiPWZ1bmN0aW9uKGEsZCl7dmFyIGUsZixnLGg9e30saT1aYVt0aGlzLmlkXSxqPWkmJmkuaGFuZGxlcnM7aWYoIWkpdGhyb3cgbmV3IEVycm9yKFwiQXR0ZW1wdGVkIHRvIGFkZCBuZXcgbGlzdGVuZXIocykgdG8gYSBkZXN0cm95ZWQgWmVyb0NsaXBib2FyZCBjbGllbnQgaW5zdGFuY2VcIik7aWYoXCJzdHJpbmdcIj09dHlwZW9mIGEmJmEpZz1hLnRvTG93ZXJDYXNlKCkuc3BsaXQoL1xccysvKTtlbHNlIGlmKFwib2JqZWN0XCI9PXR5cGVvZiBhJiZhJiZcInVuZGVmaW5lZFwiPT10eXBlb2YgZClmb3IoZSBpbiBhKXcuY2FsbChhLGUpJiZcInN0cmluZ1wiPT10eXBlb2YgZSYmZSYmXCJmdW5jdGlvblwiPT10eXBlb2YgYVtlXSYmdGhpcy5vbihlLGFbZV0pO2lmKGcmJmcubGVuZ3RoKXtmb3IoZT0wLGY9Zy5sZW5ndGg7Zj5lO2UrKylhPWdbZV0ucmVwbGFjZSgvXm9uLyxcIlwiKSxoW2FdPSEwLGpbYV18fChqW2FdPVtdKSxqW2FdLnB1c2goZCk7aWYoaC5yZWFkeSYmTy5yZWFkeSYmdGhpcy5lbWl0KHt0eXBlOlwicmVhZHlcIixjbGllbnQ6dGhpc30pLGguZXJyb3Ipe2ZvcihlPTAsZj1YLmxlbmd0aDtmPmU7ZSsrKWlmKE9bWFtlXS5yZXBsYWNlKC9eZmxhc2gtLyxcIlwiKV0pe3RoaXMuZW1pdCh7dHlwZTpcImVycm9yXCIsbmFtZTpYW2VdLGNsaWVudDp0aGlzfSk7YnJlYWt9YyE9PWImJlhhLnZlcnNpb24hPT1jJiZ0aGlzLmVtaXQoe3R5cGU6XCJlcnJvclwiLG5hbWU6XCJ2ZXJzaW9uLW1pc21hdGNoXCIsanNWZXJzaW9uOlhhLnZlcnNpb24sc3dmVmVyc2lvbjpjfSl9fXJldHVybiB0aGlzfSxkYj1mdW5jdGlvbihhLGIpe3ZhciBjLGQsZSxmLGcsaD1aYVt0aGlzLmlkXSxpPWgmJmguaGFuZGxlcnM7aWYoIWkpcmV0dXJuIHRoaXM7aWYoMD09PWFyZ3VtZW50cy5sZW5ndGgpZj11KGkpO2Vsc2UgaWYoXCJzdHJpbmdcIj09dHlwZW9mIGEmJmEpZj1hLnNwbGl0KC9cXHMrLyk7ZWxzZSBpZihcIm9iamVjdFwiPT10eXBlb2YgYSYmYSYmXCJ1bmRlZmluZWRcIj09dHlwZW9mIGIpZm9yKGMgaW4gYSl3LmNhbGwoYSxjKSYmXCJzdHJpbmdcIj09dHlwZW9mIGMmJmMmJlwiZnVuY3Rpb25cIj09dHlwZW9mIGFbY10mJnRoaXMub2ZmKGMsYVtjXSk7aWYoZiYmZi5sZW5ndGgpZm9yKGM9MCxkPWYubGVuZ3RoO2Q+YztjKyspaWYoYT1mW2NdLnRvTG93ZXJDYXNlKCkucmVwbGFjZSgvXm9uLyxcIlwiKSxnPWlbYV0sZyYmZy5sZW5ndGgpaWYoYilmb3IoZT1nLmluZGV4T2YoYik7LTEhPT1lOylnLnNwbGljZShlLDEpLGU9Zy5pbmRleE9mKGIsZSk7ZWxzZSBnLmxlbmd0aD0wO3JldHVybiB0aGlzfSxlYj1mdW5jdGlvbihhKXt2YXIgYj1udWxsLGM9WmFbdGhpcy5pZF0mJlphW3RoaXMuaWRdLmhhbmRsZXJzO3JldHVybiBjJiYoYj1cInN0cmluZ1wiPT10eXBlb2YgYSYmYT9jW2FdP2NbYV0uc2xpY2UoMCk6W106QihjKSksYn0sZmI9ZnVuY3Rpb24oYSl7aWYoa2IuY2FsbCh0aGlzLGEpKXtcIm9iamVjdFwiPT10eXBlb2YgYSYmYSYmXCJzdHJpbmdcIj09dHlwZW9mIGEudHlwZSYmYS50eXBlJiYoYT1BKHt9LGEpKTt2YXIgYj1BKHt9LHBhKGEpLHtjbGllbnQ6dGhpc30pO2xiLmNhbGwodGhpcyxiKX1yZXR1cm4gdGhpc30sZ2I9ZnVuY3Rpb24oYSl7aWYoIVphW3RoaXMuaWRdKXRocm93IG5ldyBFcnJvcihcIkF0dGVtcHRlZCB0byBjbGlwIGVsZW1lbnQocykgdG8gYSBkZXN0cm95ZWQgWmVyb0NsaXBib2FyZCBjbGllbnQgaW5zdGFuY2VcIik7YT1tYihhKTtmb3IodmFyIGI9MDtiPGEubGVuZ3RoO2IrKylpZih3LmNhbGwoYSxiKSYmYVtiXSYmMT09PWFbYl0ubm9kZVR5cGUpe2FbYl0uemNDbGlwcGluZ0lkPy0xPT09X2FbYVtiXS56Y0NsaXBwaW5nSWRdLmluZGV4T2YodGhpcy5pZCkmJl9hW2FbYl0uemNDbGlwcGluZ0lkXS5wdXNoKHRoaXMuaWQpOihhW2JdLnpjQ2xpcHBpbmdJZD1cInpjQ2xpcHBpbmdJZF9cIiskYSsrLF9hW2FbYl0uemNDbGlwcGluZ0lkXT1bdGhpcy5pZF0sJC5hdXRvQWN0aXZhdGU9PT0hMCYmbmIoYVtiXSkpO3ZhciBjPVphW3RoaXMuaWRdJiZaYVt0aGlzLmlkXS5lbGVtZW50czstMT09PWMuaW5kZXhPZihhW2JdKSYmYy5wdXNoKGFbYl0pfXJldHVybiB0aGlzfSxoYj1mdW5jdGlvbihhKXt2YXIgYj1aYVt0aGlzLmlkXTtpZighYilyZXR1cm4gdGhpczt2YXIgYyxkPWIuZWxlbWVudHM7YT1cInVuZGVmaW5lZFwiPT10eXBlb2YgYT9kLnNsaWNlKDApOm1iKGEpO2Zvcih2YXIgZT1hLmxlbmd0aDtlLS07KWlmKHcuY2FsbChhLGUpJiZhW2VdJiYxPT09YVtlXS5ub2RlVHlwZSl7Zm9yKGM9MDstMSE9PShjPWQuaW5kZXhPZihhW2VdLGMpKTspZC5zcGxpY2UoYywxKTt2YXIgZj1fYVthW2VdLnpjQ2xpcHBpbmdJZF07aWYoZil7Zm9yKGM9MDstMSE9PShjPWYuaW5kZXhPZih0aGlzLmlkLGMpKTspZi5zcGxpY2UoYywxKTswPT09Zi5sZW5ndGgmJigkLmF1dG9BY3RpdmF0ZT09PSEwJiZvYihhW2VdKSxkZWxldGUgYVtlXS56Y0NsaXBwaW5nSWQpfX1yZXR1cm4gdGhpc30saWI9ZnVuY3Rpb24oKXt2YXIgYT1aYVt0aGlzLmlkXTtyZXR1cm4gYSYmYS5lbGVtZW50cz9hLmVsZW1lbnRzLnNsaWNlKDApOltdfSxqYj1mdW5jdGlvbigpe1phW3RoaXMuaWRdJiYodGhpcy51bmNsaXAoKSx0aGlzLm9mZigpLGRlbGV0ZSBaYVt0aGlzLmlkXSl9LGtiPWZ1bmN0aW9uKGEpe2lmKCFhfHwhYS50eXBlKXJldHVybiExO2lmKGEuY2xpZW50JiZhLmNsaWVudCE9PXRoaXMpcmV0dXJuITE7dmFyIGI9WmFbdGhpcy5pZF0sYz1iJiZiLmVsZW1lbnRzLGQ9ISFjJiZjLmxlbmd0aD4wLGU9IWEudGFyZ2V0fHxkJiYtMSE9PWMuaW5kZXhPZihhLnRhcmdldCksZj1hLnJlbGF0ZWRUYXJnZXQmJmQmJi0xIT09Yy5pbmRleE9mKGEucmVsYXRlZFRhcmdldCksZz1hLmNsaWVudCYmYS5jbGllbnQ9PT10aGlzO3JldHVybiBiJiYoZXx8Znx8Zyk/ITA6ITF9LGxiPWZ1bmN0aW9uKGEpe3ZhciBiPVphW3RoaXMuaWRdO2lmKFwib2JqZWN0XCI9PXR5cGVvZiBhJiZhJiZhLnR5cGUmJmIpe3ZhciBjPXNhKGEpLGQ9YiYmYi5oYW5kbGVyc1tcIipcIl18fFtdLGU9YiYmYi5oYW5kbGVyc1thLnR5cGVdfHxbXSxnPWQuY29uY2F0KGUpO2lmKGcmJmcubGVuZ3RoKXt2YXIgaCxpLGosayxsLG09dGhpcztmb3IoaD0wLGk9Zy5sZW5ndGg7aT5oO2grKylqPWdbaF0saz1tLFwic3RyaW5nXCI9PXR5cGVvZiBqJiZcImZ1bmN0aW9uXCI9PXR5cGVvZiBmW2pdJiYoaj1mW2pdKSxcIm9iamVjdFwiPT10eXBlb2YgaiYmaiYmXCJmdW5jdGlvblwiPT10eXBlb2Ygai5oYW5kbGVFdmVudCYmKGs9aixqPWouaGFuZGxlRXZlbnQpLFwiZnVuY3Rpb25cIj09dHlwZW9mIGomJihsPUEoe30sYSksdGEoaixrLFtsXSxjKSl9fX0sbWI9ZnVuY3Rpb24oYSl7cmV0dXJuXCJzdHJpbmdcIj09dHlwZW9mIGEmJihhPVtdKSxcIm51bWJlclwiIT10eXBlb2YgYS5sZW5ndGg/W2FdOmF9LG5iPWZ1bmN0aW9uKGEpe2lmKGEmJjE9PT1hLm5vZGVUeXBlKXt2YXIgYj1mdW5jdGlvbihhKXsoYXx8KGE9Zi5ldmVudCkpJiYoXCJqc1wiIT09YS5fc291cmNlJiYoYS5zdG9wSW1tZWRpYXRlUHJvcGFnYXRpb24oKSxhLnByZXZlbnREZWZhdWx0KCkpLGRlbGV0ZSBhLl9zb3VyY2UpfSxjPWZ1bmN0aW9uKGMpeyhjfHwoYz1mLmV2ZW50KSkmJihiKGMpLFhhLmZvY3VzKGEpKX07YS5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdmVyXCIsYywhMSksYS5hZGRFdmVudExpc3RlbmVyKFwibW91c2VvdXRcIixiLCExKSxhLmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWVudGVyXCIsYiwhMSksYS5hZGRFdmVudExpc3RlbmVyKFwibW91c2VsZWF2ZVwiLGIsITEpLGEuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlbW92ZVwiLGIsITEpLGFiW2EuemNDbGlwcGluZ0lkXT17bW91c2VvdmVyOmMsbW91c2VvdXQ6Yixtb3VzZWVudGVyOmIsbW91c2VsZWF2ZTpiLG1vdXNlbW92ZTpifX19LG9iPWZ1bmN0aW9uKGEpe2lmKGEmJjE9PT1hLm5vZGVUeXBlKXt2YXIgYj1hYlthLnpjQ2xpcHBpbmdJZF07aWYoXCJvYmplY3RcIj09dHlwZW9mIGImJmIpe2Zvcih2YXIgYyxkLGU9W1wibW92ZVwiLFwibGVhdmVcIixcImVudGVyXCIsXCJvdXRcIixcIm92ZXJcIl0sZj0wLGc9ZS5sZW5ndGg7Zz5mO2YrKyljPVwibW91c2VcIitlW2ZdLGQ9YltjXSxcImZ1bmN0aW9uXCI9PXR5cGVvZiBkJiZhLnJlbW92ZUV2ZW50TGlzdGVuZXIoYyxkLCExKTtkZWxldGUgYWJbYS56Y0NsaXBwaW5nSWRdfX19O1hhLl9jcmVhdGVDbGllbnQ9ZnVuY3Rpb24oKXtiYi5hcHBseSh0aGlzLHooYXJndW1lbnRzKSl9LFhhLnByb3RvdHlwZS5vbj1mdW5jdGlvbigpe3JldHVybiBjYi5hcHBseSh0aGlzLHooYXJndW1lbnRzKSl9LFhhLnByb3RvdHlwZS5vZmY9ZnVuY3Rpb24oKXtyZXR1cm4gZGIuYXBwbHkodGhpcyx6KGFyZ3VtZW50cykpfSxYYS5wcm90b3R5cGUuaGFuZGxlcnM9ZnVuY3Rpb24oKXtyZXR1cm4gZWIuYXBwbHkodGhpcyx6KGFyZ3VtZW50cykpfSxYYS5wcm90b3R5cGUuZW1pdD1mdW5jdGlvbigpe3JldHVybiBmYi5hcHBseSh0aGlzLHooYXJndW1lbnRzKSl9LFhhLnByb3RvdHlwZS5jbGlwPWZ1bmN0aW9uKCl7cmV0dXJuIGdiLmFwcGx5KHRoaXMseihhcmd1bWVudHMpKX0sWGEucHJvdG90eXBlLnVuY2xpcD1mdW5jdGlvbigpe3JldHVybiBoYi5hcHBseSh0aGlzLHooYXJndW1lbnRzKSl9LFhhLnByb3RvdHlwZS5lbGVtZW50cz1mdW5jdGlvbigpe3JldHVybiBpYi5hcHBseSh0aGlzLHooYXJndW1lbnRzKSl9LFhhLnByb3RvdHlwZS5kZXN0cm95PWZ1bmN0aW9uKCl7cmV0dXJuIGpiLmFwcGx5KHRoaXMseihhcmd1bWVudHMpKX0sWGEucHJvdG90eXBlLnNldFRleHQ9ZnVuY3Rpb24oYSl7aWYoIVphW3RoaXMuaWRdKXRocm93IG5ldyBFcnJvcihcIkF0dGVtcHRlZCB0byBzZXQgcGVuZGluZyBjbGlwYm9hcmQgZGF0YSBmcm9tIGEgZGVzdHJveWVkIFplcm9DbGlwYm9hcmQgY2xpZW50IGluc3RhbmNlXCIpO3JldHVybiBYYS5zZXREYXRhKFwidGV4dC9wbGFpblwiLGEpLHRoaXN9LFhhLnByb3RvdHlwZS5zZXRIdG1sPWZ1bmN0aW9uKGEpe2lmKCFaYVt0aGlzLmlkXSl0aHJvdyBuZXcgRXJyb3IoXCJBdHRlbXB0ZWQgdG8gc2V0IHBlbmRpbmcgY2xpcGJvYXJkIGRhdGEgZnJvbSBhIGRlc3Ryb3llZCBaZXJvQ2xpcGJvYXJkIGNsaWVudCBpbnN0YW5jZVwiKTtyZXR1cm4gWGEuc2V0RGF0YShcInRleHQvaHRtbFwiLGEpLHRoaXN9LFhhLnByb3RvdHlwZS5zZXRSaWNoVGV4dD1mdW5jdGlvbihhKXtpZighWmFbdGhpcy5pZF0pdGhyb3cgbmV3IEVycm9yKFwiQXR0ZW1wdGVkIHRvIHNldCBwZW5kaW5nIGNsaXBib2FyZCBkYXRhIGZyb20gYSBkZXN0cm95ZWQgWmVyb0NsaXBib2FyZCBjbGllbnQgaW5zdGFuY2VcIik7cmV0dXJuIFhhLnNldERhdGEoXCJhcHBsaWNhdGlvbi9ydGZcIixhKSx0aGlzfSxYYS5wcm90b3R5cGUuc2V0RGF0YT1mdW5jdGlvbigpe2lmKCFaYVt0aGlzLmlkXSl0aHJvdyBuZXcgRXJyb3IoXCJBdHRlbXB0ZWQgdG8gc2V0IHBlbmRpbmcgY2xpcGJvYXJkIGRhdGEgZnJvbSBhIGRlc3Ryb3llZCBaZXJvQ2xpcGJvYXJkIGNsaWVudCBpbnN0YW5jZVwiKTtyZXR1cm4gWGEuc2V0RGF0YS5hcHBseSh0aGlzLHooYXJndW1lbnRzKSksdGhpc30sWGEucHJvdG90eXBlLmNsZWFyRGF0YT1mdW5jdGlvbigpe2lmKCFaYVt0aGlzLmlkXSl0aHJvdyBuZXcgRXJyb3IoXCJBdHRlbXB0ZWQgdG8gY2xlYXIgcGVuZGluZyBjbGlwYm9hcmQgZGF0YSBmcm9tIGEgZGVzdHJveWVkIFplcm9DbGlwYm9hcmQgY2xpZW50IGluc3RhbmNlXCIpO3JldHVybiBYYS5jbGVhckRhdGEuYXBwbHkodGhpcyx6KGFyZ3VtZW50cykpLHRoaXN9LFhhLnByb3RvdHlwZS5nZXREYXRhPWZ1bmN0aW9uKCl7aWYoIVphW3RoaXMuaWRdKXRocm93IG5ldyBFcnJvcihcIkF0dGVtcHRlZCB0byBnZXQgcGVuZGluZyBjbGlwYm9hcmQgZGF0YSBmcm9tIGEgZGVzdHJveWVkIFplcm9DbGlwYm9hcmQgY2xpZW50IGluc3RhbmNlXCIpO3JldHVybiBYYS5nZXREYXRhLmFwcGx5KHRoaXMseihhcmd1bWVudHMpKX0sXCJmdW5jdGlvblwiPT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kP2RlZmluZShmdW5jdGlvbigpe3JldHVybiBYYX0pOlwib2JqZWN0XCI9PXR5cGVvZiBtb2R1bGUmJm1vZHVsZSYmXCJvYmplY3RcIj09dHlwZW9mIG1vZHVsZS5leHBvcnRzJiZtb2R1bGUuZXhwb3J0cz9tb2R1bGUuZXhwb3J0cz1YYTphLlplcm9DbGlwYm9hcmQ9WGF9KGZ1bmN0aW9uKCl7cmV0dXJuIHRoaXN8fHdpbmRvd30oKSk7XG4vLyMgc291cmNlTWFwcGluZ1VSTD1aZXJvQ2xpcGJvYXJkLm1pbi5tYXAiLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqIEJvb3RzdHJhcDogYWZmaXguanMgdjMuMi4wXG4gKiBodHRwOi8vZ2V0Ym9vdHN0cmFwLmNvbS9qYXZhc2NyaXB0LyNhZmZpeFxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiBDb3B5cmlnaHQgMjAxMS0yMDE0IFR3aXR0ZXIsIEluYy5cbiAqIExpY2Vuc2VkIHVuZGVyIE1JVCAoaHR0cHM6Ly9naXRodWIuY29tL3R3YnMvYm9vdHN0cmFwL2Jsb2IvbWFzdGVyL0xJQ0VOU0UpXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuXG4rIGZ1bmN0aW9uKCQpIHtcblx0J3VzZSBzdHJpY3QnO1xuXHQvLyBBRkZJWCBDTEFTUyBERUZJTklUSU9OXG5cdC8vID09PT09PT09PT09PT09PT09PT09PT1cblxuXHR2YXIgQWZmaXggPSBmdW5jdGlvbihlbGVtZW50LCBvcHRpb25zKSB7XG5cdFx0dGhpcy5vcHRpb25zID0gJC5leHRlbmQoe30sIEFmZml4LkRFRkFVTFRTLCBvcHRpb25zKVxuXG5cdFx0dGhpcy4kdGFyZ2V0ID0gJCh0aGlzLm9wdGlvbnMudGFyZ2V0KVxuXHRcdFx0Lm9uKCdzY3JvbGwuYnMuYWZmaXguZGF0YS1hcGknLCAkLnByb3h5KHRoaXMuY2hlY2tQb3NpdGlvbiwgdGhpcykpXG5cdFx0XHQub24oJ2NsaWNrLmJzLmFmZml4LmRhdGEtYXBpJywgJC5wcm94eSh0aGlzLmNoZWNrUG9zaXRpb25XaXRoRXZlbnRMb29wLCB0aGlzKSlcblxuXHRcdHRoaXMuJGVsZW1lbnQgPSAkKGVsZW1lbnQpXG5cdFx0dGhpcy5hZmZpeGVkID1cblx0XHRcdHRoaXMudW5waW4gPVxuXHRcdFx0dGhpcy5waW5uZWRPZmZzZXQgPSBudWxsXG5cblx0XHR0aGlzLmNoZWNrUG9zaXRpb24oKVxuXHR9XG5cblx0QWZmaXguVkVSU0lPTiA9ICczLjIuMCdcblxuXHRBZmZpeC5SRVNFVCA9ICdhZmZpeCBhZmZpeC10b3AgYWZmaXgtYm90dG9tJ1xuXG5cdEFmZml4LkRFRkFVTFRTID0ge1xuXHRcdG9mZnNldDogMCxcblx0XHR0YXJnZXQ6IHdpbmRvd1xuXHR9XG5cblx0QWZmaXgucHJvdG90eXBlLmdldFBpbm5lZE9mZnNldCA9IGZ1bmN0aW9uKCkge1xuXHRcdGlmICh0aGlzLnBpbm5lZE9mZnNldCkgcmV0dXJuIHRoaXMucGlubmVkT2Zmc2V0XG5cdFx0dGhpcy4kZWxlbWVudC5yZW1vdmVDbGFzcyhBZmZpeC5SRVNFVCkuYWRkQ2xhc3MoJ2FmZml4Jylcblx0XHR2YXIgc2Nyb2xsVG9wID0gdGhpcy4kdGFyZ2V0LnNjcm9sbFRvcCgpXG5cdFx0dmFyIHBvc2l0aW9uID0gdGhpcy4kZWxlbWVudC5vZmZzZXQoKVxuXHRcdHJldHVybiAodGhpcy5waW5uZWRPZmZzZXQgPSBwb3NpdGlvbi50b3AgLSBzY3JvbGxUb3ApXG5cdH1cblxuXHRBZmZpeC5wcm90b3R5cGUuY2hlY2tQb3NpdGlvbldpdGhFdmVudExvb3AgPSBmdW5jdGlvbigpIHtcblx0XHRzZXRUaW1lb3V0KCQucHJveHkodGhpcy5jaGVja1Bvc2l0aW9uLCB0aGlzKSwgMSlcblx0fVxuXG5cdEFmZml4LnByb3RvdHlwZS5jaGVja1Bvc2l0aW9uID0gZnVuY3Rpb24oKSB7XG5cdFx0aWYgKCF0aGlzLiRlbGVtZW50LmlzKCc6dmlzaWJsZScpKSByZXR1cm5cblxuXHRcdHZhciBzY3JvbGxIZWlnaHQgPSAkKGRvY3VtZW50KS5oZWlnaHQoKVxuXHRcdHZhciBzY3JvbGxUb3AgPSB0aGlzLiR0YXJnZXQuc2Nyb2xsVG9wKClcblx0XHR2YXIgcG9zaXRpb24gPSB0aGlzLiRlbGVtZW50Lm9mZnNldCgpXG5cdFx0dmFyIG9mZnNldCA9IHRoaXMub3B0aW9ucy5vZmZzZXRcblx0XHR2YXIgb2Zmc2V0VG9wID0gb2Zmc2V0LnRvcFxuXHRcdHZhciBvZmZzZXRCb3R0b20gPSBvZmZzZXQuYm90dG9tXG5cblx0XHRpZiAodHlwZW9mIG9mZnNldCAhPSAnb2JqZWN0Jykgb2Zmc2V0Qm90dG9tID0gb2Zmc2V0VG9wID0gb2Zmc2V0XG5cdFx0aWYgKHR5cGVvZiBvZmZzZXRUb3AgPT0gJ2Z1bmN0aW9uJykgb2Zmc2V0VG9wID0gb2Zmc2V0LnRvcCh0aGlzLiRlbGVtZW50KVxuXHRcdGlmICh0eXBlb2Ygb2Zmc2V0Qm90dG9tID09ICdmdW5jdGlvbicpIG9mZnNldEJvdHRvbSA9IG9mZnNldC5ib3R0b20odGhpcy4kZWxlbWVudClcblxuXHRcdHZhciBhZmZpeCA9IHRoaXMudW5waW4gIT0gbnVsbCAmJiAoc2Nyb2xsVG9wICsgdGhpcy51bnBpbiA8PSBwb3NpdGlvbi50b3ApID8gZmFsc2UgOlxuXHRcdFx0b2Zmc2V0Qm90dG9tICE9IG51bGwgJiYgKHBvc2l0aW9uLnRvcCArIHRoaXMuJGVsZW1lbnQuaGVpZ2h0KCkgPj0gc2Nyb2xsSGVpZ2h0IC0gb2Zmc2V0Qm90dG9tKSA/ICdib3R0b20nIDpcblx0XHRcdG9mZnNldFRvcCAhPSBudWxsICYmIChzY3JvbGxUb3AgPD0gb2Zmc2V0VG9wKSA/ICd0b3AnIDogZmFsc2VcblxuXHRcdGlmICh0aGlzLmFmZml4ZWQgPT09IGFmZml4KSByZXR1cm5cblx0XHRpZiAodGhpcy51bnBpbiAhPSBudWxsKSB0aGlzLiRlbGVtZW50LmNzcygndG9wJywgJycpXG5cblx0XHR2YXIgYWZmaXhUeXBlID0gJ2FmZml4JyArIChhZmZpeCA/ICctJyArIGFmZml4IDogJycpXG5cdFx0dmFyIGUgPSAkLkV2ZW50KGFmZml4VHlwZSArICcuYnMuYWZmaXgnKVxuXG5cdFx0dGhpcy4kZWxlbWVudC50cmlnZ2VyKGUpXG5cblx0XHRpZiAoZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgcmV0dXJuXG5cblx0XHR0aGlzLmFmZml4ZWQgPSBhZmZpeFxuXHRcdHRoaXMudW5waW4gPSBhZmZpeCA9PSAnYm90dG9tJyA/IHRoaXMuZ2V0UGlubmVkT2Zmc2V0KCkgOiBudWxsXG5cblx0XHR0aGlzLiRlbGVtZW50XG5cdFx0XHQucmVtb3ZlQ2xhc3MoQWZmaXguUkVTRVQpXG5cdFx0XHQuYWRkQ2xhc3MoYWZmaXhUeXBlKVxuXHRcdFx0LnRyaWdnZXIoJC5FdmVudChhZmZpeFR5cGUucmVwbGFjZSgnYWZmaXgnLCAnYWZmaXhlZCcpKSlcblxuXHRcdGlmIChhZmZpeCA9PSAnYm90dG9tJykge1xuXHRcdFx0dGhpcy4kZWxlbWVudC5vZmZzZXQoe1xuXHRcdFx0XHR0b3A6IHNjcm9sbEhlaWdodCAtIHRoaXMuJGVsZW1lbnQuaGVpZ2h0KCkgLSBvZmZzZXRCb3R0b21cblx0XHRcdH0pXG5cdFx0fVxuXHR9XG5cblxuXHQvLyBBRkZJWCBQTFVHSU4gREVGSU5JVElPTlxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09PVxuXG5cdGZ1bmN0aW9uIFBsdWdpbihvcHRpb24pIHtcblx0XHRyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyICR0aGlzID0gJCh0aGlzKVxuXHRcdFx0dmFyIGRhdGEgPSAkdGhpcy5kYXRhKCdicy5hZmZpeCcpXG5cdFx0XHR2YXIgb3B0aW9ucyA9IHR5cGVvZiBvcHRpb24gPT0gJ29iamVjdCcgJiYgb3B0aW9uXG5cblx0XHRcdGlmICghZGF0YSkgJHRoaXMuZGF0YSgnYnMuYWZmaXgnLCAoZGF0YSA9IG5ldyBBZmZpeCh0aGlzLCBvcHRpb25zKSkpXG5cdFx0XHRpZiAodHlwZW9mIG9wdGlvbiA9PSAnc3RyaW5nJykgZGF0YVtvcHRpb25dKClcblx0XHR9KVxuXHR9XG5cblx0dmFyIG9sZCA9ICQuZm4uYWZmaXhcblxuXHQkLmZuLmFmZml4ID0gUGx1Z2luXG5cdCQuZm4uYWZmaXguQ29uc3RydWN0b3IgPSBBZmZpeFxuXG5cblx0Ly8gQUZGSVggTk8gQ09ORkxJQ1Rcblx0Ly8gPT09PT09PT09PT09PT09PT1cblxuXHQkLmZuLmFmZml4Lm5vQ29uZmxpY3QgPSBmdW5jdGlvbigpIHtcblx0XHQkLmZuLmFmZml4ID0gb2xkXG5cdFx0cmV0dXJuIHRoaXNcblx0fVxuXG5cblx0Ly8gQUZGSVggREFUQS1BUElcblx0Ly8gPT09PT09PT09PT09PT1cblxuXHQkKHdpbmRvdykub24oJ2xvYWQnLCBmdW5jdGlvbigpIHtcblx0XHQkKCdbZGF0YS1zcHk9XCJhZmZpeFwiXScpLmVhY2goZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgJHNweSA9ICQodGhpcylcblx0XHRcdHZhciBkYXRhID0gJHNweS5kYXRhKClcblxuXHRcdFx0ZGF0YS5vZmZzZXQgPSBkYXRhLm9mZnNldCB8fCB7fVxuXG5cdFx0XHRpZiAoZGF0YS5vZmZzZXRCb3R0b20pIGRhdGEub2Zmc2V0LmJvdHRvbSA9IGRhdGEub2Zmc2V0Qm90dG9tXG5cdFx0XHRpZiAoZGF0YS5vZmZzZXRUb3ApIGRhdGEub2Zmc2V0LnRvcCA9IGRhdGEub2Zmc2V0VG9wXG5cblx0XHRcdFBsdWdpbi5jYWxsKCRzcHksIGRhdGEpXG5cdFx0fSlcblx0fSlcblxufShqUXVlcnkpO1xuXG4vKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqIEJvb3RzdHJhcDogYWxlcnQuanMgdjMuMi4wXG4gKiBodHRwOi8vZ2V0Ym9vdHN0cmFwLmNvbS9qYXZhc2NyaXB0LyNhbGVydHNcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogQ29weXJpZ2h0IDIwMTEtMjAxNCBUd2l0dGVyLCBJbmMuXG4gKiBMaWNlbnNlZCB1bmRlciBNSVQgKGh0dHBzOi8vZ2l0aHViLmNvbS90d2JzL2Jvb3RzdHJhcC9ibG9iL21hc3Rlci9MSUNFTlNFKVxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cblxuKyBmdW5jdGlvbigkKSB7XG5cdCd1c2Ugc3RyaWN0JztcblxuXHQvLyBBTEVSVCBDTEFTUyBERUZJTklUSU9OXG5cdC8vID09PT09PT09PT09PT09PT09PT09PT1cblxuXHR2YXIgZGlzbWlzcyA9ICdbZGF0YS1kaXNtaXNzPVwiYWxlcnRcIl0nXG5cdHZhciBBbGVydCA9IGZ1bmN0aW9uKGVsKSB7XG5cdFx0JChlbCkub24oJ2NsaWNrJywgZGlzbWlzcywgdGhpcy5jbG9zZSlcblx0fVxuXG5cdEFsZXJ0LlZFUlNJT04gPSAnMy4yLjAnXG5cblx0QWxlcnQucHJvdG90eXBlLmNsb3NlID0gZnVuY3Rpb24oZSkge1xuXHRcdHZhciAkdGhpcyA9ICQodGhpcylcblx0XHR2YXIgc2VsZWN0b3IgPSAkdGhpcy5hdHRyKCdkYXRhLXRhcmdldCcpXG5cblx0XHRpZiAoIXNlbGVjdG9yKSB7XG5cdFx0XHRzZWxlY3RvciA9ICR0aGlzLmF0dHIoJ2hyZWYnKVxuXHRcdFx0c2VsZWN0b3IgPSBzZWxlY3RvciAmJiBzZWxlY3Rvci5yZXBsYWNlKC8uKig/PSNbXlxcc10qJCkvLCAnJykgLy8gc3RyaXAgZm9yIGllN1xuXHRcdH1cblxuXHRcdHZhciAkcGFyZW50ID0gJChzZWxlY3RvcilcblxuXHRcdGlmIChlKSBlLnByZXZlbnREZWZhdWx0KClcblxuXHRcdGlmICghJHBhcmVudC5sZW5ndGgpIHtcblx0XHRcdCRwYXJlbnQgPSAkdGhpcy5oYXNDbGFzcygnYWxlcnQnKSA/ICR0aGlzIDogJHRoaXMucGFyZW50KClcblx0XHR9XG5cblx0XHQkcGFyZW50LnRyaWdnZXIoZSA9ICQuRXZlbnQoJ2Nsb3NlLmJzLmFsZXJ0JykpXG5cblx0XHRpZiAoZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgcmV0dXJuXG5cblx0XHQkcGFyZW50LnJlbW92ZUNsYXNzKCdpbicpXG5cblx0XHRmdW5jdGlvbiByZW1vdmVFbGVtZW50KCkge1xuXHRcdFx0Ly8gZGV0YWNoIGZyb20gcGFyZW50LCBmaXJlIGV2ZW50IHRoZW4gY2xlYW4gdXAgZGF0YVxuXHRcdFx0JHBhcmVudC5kZXRhY2goKS50cmlnZ2VyKCdjbG9zZWQuYnMuYWxlcnQnKS5yZW1vdmUoKVxuXHRcdH1cblxuXHRcdCQuc3VwcG9ydC50cmFuc2l0aW9uICYmICRwYXJlbnQuaGFzQ2xhc3MoJ2ZhZGUnKSA/XG5cdFx0XHQkcGFyZW50XG5cdFx0XHQub25lKCdic1RyYW5zaXRpb25FbmQnLCByZW1vdmVFbGVtZW50KVxuXHRcdFx0LmVtdWxhdGVUcmFuc2l0aW9uRW5kKDE1MCkgOlxuXHRcdFx0cmVtb3ZlRWxlbWVudCgpXG5cdH1cblxuXG5cdC8vIEFMRVJUIFBMVUdJTiBERUZJTklUSU9OXG5cdC8vID09PT09PT09PT09PT09PT09PT09PT09XG5cblx0ZnVuY3Rpb24gUGx1Z2luKG9wdGlvbikge1xuXHRcdHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgJHRoaXMgPSAkKHRoaXMpXG5cdFx0XHR2YXIgZGF0YSA9ICR0aGlzLmRhdGEoJ2JzLmFsZXJ0JylcblxuXHRcdFx0aWYgKCFkYXRhKSAkdGhpcy5kYXRhKCdicy5hbGVydCcsIChkYXRhID0gbmV3IEFsZXJ0KHRoaXMpKSlcblx0XHRcdGlmICh0eXBlb2Ygb3B0aW9uID09ICdzdHJpbmcnKSBkYXRhW29wdGlvbl0uY2FsbCgkdGhpcylcblx0XHR9KVxuXHR9XG5cblx0dmFyIG9sZCA9ICQuZm4uYWxlcnRcblxuXHQkLmZuLmFsZXJ0ID0gUGx1Z2luXG5cdCQuZm4uYWxlcnQuQ29uc3RydWN0b3IgPSBBbGVydFxuXG5cblx0Ly8gQUxFUlQgTk8gQ09ORkxJQ1Rcblx0Ly8gPT09PT09PT09PT09PT09PT1cblxuXHQkLmZuLmFsZXJ0Lm5vQ29uZmxpY3QgPSBmdW5jdGlvbigpIHtcblx0XHQkLmZuLmFsZXJ0ID0gb2xkXG5cdFx0cmV0dXJuIHRoaXNcblx0fVxuXG5cblx0Ly8gQUxFUlQgREFUQS1BUElcblx0Ly8gPT09PT09PT09PT09PT1cblxuXHQkKGRvY3VtZW50KS5vbignY2xpY2suYnMuYWxlcnQuZGF0YS1hcGknLCBkaXNtaXNzLCBBbGVydC5wcm90b3R5cGUuY2xvc2UpXG5cbn0oalF1ZXJ5KTtcblxuLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiBCb290c3RyYXA6IGJ1dHRvbi5qcyB2My4yLjBcbiAqIGh0dHA6Ly9nZXRib290c3RyYXAuY29tL2phdmFzY3JpcHQvI2J1dHRvbnNcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogQ29weXJpZ2h0IDIwMTEtMjAxNCBUd2l0dGVyLCBJbmMuXG4gKiBMaWNlbnNlZCB1bmRlciBNSVQgKGh0dHBzOi8vZ2l0aHViLmNvbS90d2JzL2Jvb3RzdHJhcC9ibG9iL21hc3Rlci9MSUNFTlNFKVxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cblxuKyBmdW5jdGlvbigkKSB7XG5cdCd1c2Ugc3RyaWN0JztcblxuXHQvLyBCVVRUT04gUFVCTElDIENMQVNTIERFRklOSVRJT05cblx0Ly8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cblx0dmFyIEJ1dHRvbiA9IGZ1bmN0aW9uKGVsZW1lbnQsIG9wdGlvbnMpIHtcblx0XHR0aGlzLiRlbGVtZW50ID0gJChlbGVtZW50KVxuXHRcdHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBCdXR0b24uREVGQVVMVFMsIG9wdGlvbnMpXG5cdFx0dGhpcy5pc0xvYWRpbmcgPSBmYWxzZVxuXHR9XG5cblx0QnV0dG9uLlZFUlNJT04gPSAnMy4yLjAnXG5cblx0QnV0dG9uLkRFRkFVTFRTID0ge1xuXHRcdGxvYWRpbmdUZXh0OiAnbG9hZGluZy4uLidcblx0fVxuXG5cdEJ1dHRvbi5wcm90b3R5cGUuc2V0U3RhdGUgPSBmdW5jdGlvbihzdGF0ZSkge1xuXHRcdHZhciBkID0gJ2Rpc2FibGVkJ1xuXHRcdHZhciAkZWwgPSB0aGlzLiRlbGVtZW50XG5cdFx0dmFyIHZhbCA9ICRlbC5pcygnaW5wdXQnKSA/ICd2YWwnIDogJ2h0bWwnXG5cdFx0dmFyIGRhdGEgPSAkZWwuZGF0YSgpXG5cblx0XHRzdGF0ZSA9IHN0YXRlICsgJ1RleHQnXG5cblx0XHRpZiAoZGF0YS5yZXNldFRleHQgPT0gbnVsbCkgJGVsLmRhdGEoJ3Jlc2V0VGV4dCcsICRlbFt2YWxdKCkpXG5cblx0XHQkZWxbdmFsXShkYXRhW3N0YXRlXSA9PSBudWxsID8gdGhpcy5vcHRpb25zW3N0YXRlXSA6IGRhdGFbc3RhdGVdKVxuXG5cdFx0Ly8gcHVzaCB0byBldmVudCBsb29wIHRvIGFsbG93IGZvcm1zIHRvIHN1Ym1pdFxuXHRcdHNldFRpbWVvdXQoJC5wcm94eShmdW5jdGlvbigpIHtcblx0XHRcdGlmIChzdGF0ZSA9PSAnbG9hZGluZ1RleHQnKSB7XG5cdFx0XHRcdHRoaXMuaXNMb2FkaW5nID0gdHJ1ZVxuXHRcdFx0XHQkZWwuYWRkQ2xhc3MoZCkuYXR0cihkLCBkKVxuXHRcdFx0fSBlbHNlIGlmICh0aGlzLmlzTG9hZGluZykge1xuXHRcdFx0XHR0aGlzLmlzTG9hZGluZyA9IGZhbHNlXG5cdFx0XHRcdCRlbC5yZW1vdmVDbGFzcyhkKS5yZW1vdmVBdHRyKGQpXG5cdFx0XHR9XG5cdFx0fSwgdGhpcyksIDApXG5cdH1cblxuXHRCdXR0b24ucHJvdG90eXBlLnRvZ2dsZSA9IGZ1bmN0aW9uKCkge1xuXHRcdHZhciBjaGFuZ2VkID0gdHJ1ZVxuXHRcdHZhciAkcGFyZW50ID0gdGhpcy4kZWxlbWVudC5jbG9zZXN0KCdbZGF0YS10b2dnbGU9XCJidXR0b25zXCJdJylcblxuXHRcdGlmICgkcGFyZW50Lmxlbmd0aCkge1xuXHRcdFx0dmFyICRpbnB1dCA9IHRoaXMuJGVsZW1lbnQuZmluZCgnaW5wdXQnKVxuXHRcdFx0aWYgKCRpbnB1dC5wcm9wKCd0eXBlJykgPT0gJ3JhZGlvJykge1xuXHRcdFx0XHRpZiAoJGlucHV0LnByb3AoJ2NoZWNrZWQnKSAmJiB0aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCdhY3RpdmUnKSkgY2hhbmdlZCA9IGZhbHNlXG5cdFx0XHRcdGVsc2UgJHBhcmVudC5maW5kKCcuYWN0aXZlJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpXG5cdFx0XHR9XG5cdFx0XHRpZiAoY2hhbmdlZCkgJGlucHV0LnByb3AoJ2NoZWNrZWQnLCAhdGhpcy4kZWxlbWVudC5oYXNDbGFzcygnYWN0aXZlJykpLnRyaWdnZXIoJ2NoYW5nZScpXG5cdFx0fVxuXG5cdFx0aWYgKGNoYW5nZWQpIHRoaXMuJGVsZW1lbnQudG9nZ2xlQ2xhc3MoJ2FjdGl2ZScpXG5cdH1cblxuXG5cdC8vIEJVVFRPTiBQTFVHSU4gREVGSU5JVElPTlxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09PT1cblxuXHRmdW5jdGlvbiBQbHVnaW4ob3B0aW9uKSB7XG5cdFx0cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHtcblx0XHRcdHZhciAkdGhpcyA9ICQodGhpcylcblx0XHRcdHZhciBkYXRhID0gJHRoaXMuZGF0YSgnYnMuYnV0dG9uJylcblx0XHRcdHZhciBvcHRpb25zID0gdHlwZW9mIG9wdGlvbiA9PSAnb2JqZWN0JyAmJiBvcHRpb25cblxuXHRcdFx0aWYgKCFkYXRhKSAkdGhpcy5kYXRhKCdicy5idXR0b24nLCAoZGF0YSA9IG5ldyBCdXR0b24odGhpcywgb3B0aW9ucykpKVxuXG5cdFx0XHRpZiAob3B0aW9uID09ICd0b2dnbGUnKSBkYXRhLnRvZ2dsZSgpXG5cdFx0XHRlbHNlIGlmIChvcHRpb24pIGRhdGEuc2V0U3RhdGUob3B0aW9uKVxuXHRcdH0pXG5cdH1cblxuXHR2YXIgb2xkID0gJC5mbi5idXR0b25cblxuXHQkLmZuLmJ1dHRvbiA9IFBsdWdpblxuXHQkLmZuLmJ1dHRvbi5Db25zdHJ1Y3RvciA9IEJ1dHRvblxuXG5cblx0Ly8gQlVUVE9OIE5PIENPTkZMSUNUXG5cdC8vID09PT09PT09PT09PT09PT09PVxuXG5cdCQuZm4uYnV0dG9uLm5vQ29uZmxpY3QgPSBmdW5jdGlvbigpIHtcblx0XHQkLmZuLmJ1dHRvbiA9IG9sZFxuXHRcdHJldHVybiB0aGlzXG5cdH1cblxuXG5cdC8vIEJVVFRPTiBEQVRBLUFQSVxuXHQvLyA9PT09PT09PT09PT09PT1cblxuXHQkKGRvY3VtZW50KS5vbignY2xpY2suYnMuYnV0dG9uLmRhdGEtYXBpJywgJ1tkYXRhLXRvZ2dsZV49XCJidXR0b25cIl0nLCBmdW5jdGlvbihlKSB7XG5cdFx0dmFyICRidG4gPSAkKGUudGFyZ2V0KVxuXHRcdGlmICghJGJ0bi5oYXNDbGFzcygnYnRuJykpICRidG4gPSAkYnRuLmNsb3Nlc3QoJy5idG4nKVxuXHRcdFBsdWdpbi5jYWxsKCRidG4sICd0b2dnbGUnKVxuXHRcdGUucHJldmVudERlZmF1bHQoKVxuXHR9KVxuXG59KGpRdWVyeSk7XG5cbi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogQm9vdHN0cmFwOiBjYXJvdXNlbC5qcyB2My4yLjBcbiAqIGh0dHA6Ly9nZXRib290c3RyYXAuY29tL2phdmFzY3JpcHQvI2Nhcm91c2VsXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqIENvcHlyaWdodCAyMDExLTIwMTQgVHdpdHRlciwgSW5jLlxuICogTGljZW5zZWQgdW5kZXIgTUlUIChodHRwczovL2dpdGh1Yi5jb20vdHdicy9ib290c3RyYXAvYmxvYi9tYXN0ZXIvTElDRU5TRSlcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG5cbisgZnVuY3Rpb24oJCkge1xuXHQndXNlIHN0cmljdCc7XG5cblx0Ly8gQ0FST1VTRUwgQ0xBU1MgREVGSU5JVElPTlxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09PT09XG5cblx0dmFyIENhcm91c2VsID0gZnVuY3Rpb24oZWxlbWVudCwgb3B0aW9ucykge1xuXHRcdHRoaXMuJGVsZW1lbnQgPSAkKGVsZW1lbnQpLm9uKCdrZXlkb3duLmJzLmNhcm91c2VsJywgJC5wcm94eSh0aGlzLmtleWRvd24sIHRoaXMpKVxuXHRcdHRoaXMuJGluZGljYXRvcnMgPSB0aGlzLiRlbGVtZW50LmZpbmQoJy5jYXJvdXNlbC1pbmRpY2F0b3JzJylcblx0XHR0aGlzLm9wdGlvbnMgPSBvcHRpb25zXG5cdFx0dGhpcy5wYXVzZWQgPVxuXHRcdFx0dGhpcy5zbGlkaW5nID1cblx0XHRcdHRoaXMuaW50ZXJ2YWwgPVxuXHRcdFx0dGhpcy4kYWN0aXZlID1cblx0XHRcdHRoaXMuJGl0ZW1zID0gbnVsbFxuXG5cdFx0dGhpcy5vcHRpb25zLnBhdXNlID09ICdob3ZlcicgJiYgdGhpcy4kZWxlbWVudFxuXHRcdFx0Lm9uKCdtb3VzZWVudGVyLmJzLmNhcm91c2VsJywgJC5wcm94eSh0aGlzLnBhdXNlLCB0aGlzKSlcblx0XHRcdC5vbignbW91c2VsZWF2ZS5icy5jYXJvdXNlbCcsICQucHJveHkodGhpcy5jeWNsZSwgdGhpcykpXG5cdH1cblxuXHRDYXJvdXNlbC5WRVJTSU9OID0gJzMuMi4wJ1xuXG5cdENhcm91c2VsLkRFRkFVTFRTID0ge1xuXHRcdGludGVydmFsOiA1MDAwLFxuXHRcdHBhdXNlOiAnaG92ZXInLFxuXHRcdHdyYXA6IHRydWVcblx0fVxuXG5cdENhcm91c2VsLnByb3RvdHlwZS5rZXlkb3duID0gZnVuY3Rpb24oZSkge1xuXHRcdHN3aXRjaCAoZS53aGljaCkge1xuXHRcdFx0Y2FzZSAzNzpcblx0XHRcdFx0dGhpcy5wcmV2KCk7XG5cdFx0XHRcdGJyZWFrXG5cdFx0XHRjYXNlIDM5OlxuXHRcdFx0XHR0aGlzLm5leHQoKTtcblx0XHRcdFx0YnJlYWtcblx0XHRcdGRlZmF1bHQ6XG5cdFx0XHRcdHJldHVyblxuXHRcdH1cblxuXHRcdGUucHJldmVudERlZmF1bHQoKVxuXHR9XG5cblx0Q2Fyb3VzZWwucHJvdG90eXBlLmN5Y2xlID0gZnVuY3Rpb24oZSkge1xuXHRcdGUgfHwgKHRoaXMucGF1c2VkID0gZmFsc2UpXG5cblx0XHR0aGlzLmludGVydmFsICYmIGNsZWFySW50ZXJ2YWwodGhpcy5pbnRlcnZhbClcblxuXHRcdHRoaXMub3B0aW9ucy5pbnRlcnZhbCAmJiAhdGhpcy5wYXVzZWQgJiYgKHRoaXMuaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgkLnByb3h5KHRoaXMubmV4dCwgdGhpcyksIHRoaXMub3B0aW9ucy5pbnRlcnZhbCkpXG5cblx0XHRyZXR1cm4gdGhpc1xuXHR9XG5cblx0Q2Fyb3VzZWwucHJvdG90eXBlLmdldEl0ZW1JbmRleCA9IGZ1bmN0aW9uKGl0ZW0pIHtcblx0XHR0aGlzLiRpdGVtcyA9IGl0ZW0ucGFyZW50KCkuY2hpbGRyZW4oJy5pdGVtJylcblx0XHRyZXR1cm4gdGhpcy4kaXRlbXMuaW5kZXgoaXRlbSB8fCB0aGlzLiRhY3RpdmUpXG5cdH1cblxuXHRDYXJvdXNlbC5wcm90b3R5cGUudG8gPSBmdW5jdGlvbihwb3MpIHtcblx0XHR2YXIgdGhhdCA9IHRoaXNcblx0XHR2YXIgYWN0aXZlSW5kZXggPSB0aGlzLmdldEl0ZW1JbmRleCh0aGlzLiRhY3RpdmUgPSB0aGlzLiRlbGVtZW50LmZpbmQoJy5pdGVtLmFjdGl2ZScpKVxuXG5cdFx0aWYgKHBvcyA+ICh0aGlzLiRpdGVtcy5sZW5ndGggLSAxKSB8fCBwb3MgPCAwKSByZXR1cm5cblxuXHRcdGlmICh0aGlzLnNsaWRpbmcpIHJldHVybiB0aGlzLiRlbGVtZW50Lm9uZSgnc2xpZC5icy5jYXJvdXNlbCcsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0aGF0LnRvKHBvcylcblx0XHRcdH0pIC8vIHllcywgXCJzbGlkXCJcblx0XHRpZiAoYWN0aXZlSW5kZXggPT0gcG9zKSByZXR1cm4gdGhpcy5wYXVzZSgpLmN5Y2xlKClcblxuXHRcdHJldHVybiB0aGlzLnNsaWRlKHBvcyA+IGFjdGl2ZUluZGV4ID8gJ25leHQnIDogJ3ByZXYnLCAkKHRoaXMuJGl0ZW1zW3Bvc10pKVxuXHR9XG5cblx0Q2Fyb3VzZWwucHJvdG90eXBlLnBhdXNlID0gZnVuY3Rpb24oZSkge1xuXHRcdGUgfHwgKHRoaXMucGF1c2VkID0gdHJ1ZSlcblxuXHRcdGlmICh0aGlzLiRlbGVtZW50LmZpbmQoJy5uZXh0LCAucHJldicpLmxlbmd0aCAmJiAkLnN1cHBvcnQudHJhbnNpdGlvbikge1xuXHRcdFx0dGhpcy4kZWxlbWVudC50cmlnZ2VyKCQuc3VwcG9ydC50cmFuc2l0aW9uLmVuZClcblx0XHRcdHRoaXMuY3ljbGUodHJ1ZSlcblx0XHR9XG5cblx0XHR0aGlzLmludGVydmFsID0gY2xlYXJJbnRlcnZhbCh0aGlzLmludGVydmFsKVxuXG5cdFx0cmV0dXJuIHRoaXNcblx0fVxuXG5cdENhcm91c2VsLnByb3RvdHlwZS5uZXh0ID0gZnVuY3Rpb24oKSB7XG5cdFx0aWYgKHRoaXMuc2xpZGluZykgcmV0dXJuXG5cdFx0cmV0dXJuIHRoaXMuc2xpZGUoJ25leHQnKVxuXHR9XG5cblx0Q2Fyb3VzZWwucHJvdG90eXBlLnByZXYgPSBmdW5jdGlvbigpIHtcblx0XHRpZiAodGhpcy5zbGlkaW5nKSByZXR1cm5cblx0XHRyZXR1cm4gdGhpcy5zbGlkZSgncHJldicpXG5cdH1cblxuXHRDYXJvdXNlbC5wcm90b3R5cGUuc2xpZGUgPSBmdW5jdGlvbih0eXBlLCBuZXh0KSB7XG5cdFx0dmFyICRhY3RpdmUgPSB0aGlzLiRlbGVtZW50LmZpbmQoJy5pdGVtLmFjdGl2ZScpXG5cdFx0dmFyICRuZXh0ID0gbmV4dCB8fCAkYWN0aXZlW3R5cGVdKClcblx0XHR2YXIgaXNDeWNsaW5nID0gdGhpcy5pbnRlcnZhbFxuXHRcdHZhciBkaXJlY3Rpb24gPSB0eXBlID09ICduZXh0JyA/ICdsZWZ0JyA6ICdyaWdodCdcblx0XHR2YXIgZmFsbGJhY2sgPSB0eXBlID09ICduZXh0JyA/ICdmaXJzdCcgOiAnbGFzdCdcblx0XHR2YXIgdGhhdCA9IHRoaXNcblxuXHRcdGlmICghJG5leHQubGVuZ3RoKSB7XG5cdFx0XHRpZiAoIXRoaXMub3B0aW9ucy53cmFwKSByZXR1cm5cblx0XHRcdCRuZXh0ID0gdGhpcy4kZWxlbWVudC5maW5kKCcuaXRlbScpW2ZhbGxiYWNrXSgpXG5cdFx0fVxuXG5cdFx0aWYgKCRuZXh0Lmhhc0NsYXNzKCdhY3RpdmUnKSkgcmV0dXJuICh0aGlzLnNsaWRpbmcgPSBmYWxzZSlcblxuXHRcdHZhciByZWxhdGVkVGFyZ2V0ID0gJG5leHRbMF1cblx0XHR2YXIgc2xpZGVFdmVudCA9ICQuRXZlbnQoJ3NsaWRlLmJzLmNhcm91c2VsJywge1xuXHRcdFx0cmVsYXRlZFRhcmdldDogcmVsYXRlZFRhcmdldCxcblx0XHRcdGRpcmVjdGlvbjogZGlyZWN0aW9uXG5cdFx0fSlcblx0XHR0aGlzLiRlbGVtZW50LnRyaWdnZXIoc2xpZGVFdmVudClcblx0XHRpZiAoc2xpZGVFdmVudC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgcmV0dXJuXG5cblx0XHR0aGlzLnNsaWRpbmcgPSB0cnVlXG5cblx0XHRpc0N5Y2xpbmcgJiYgdGhpcy5wYXVzZSgpXG5cblx0XHRpZiAodGhpcy4kaW5kaWNhdG9ycy5sZW5ndGgpIHtcblx0XHRcdHRoaXMuJGluZGljYXRvcnMuZmluZCgnLmFjdGl2ZScpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKVxuXHRcdFx0dmFyICRuZXh0SW5kaWNhdG9yID0gJCh0aGlzLiRpbmRpY2F0b3JzLmNoaWxkcmVuKClbdGhpcy5nZXRJdGVtSW5kZXgoJG5leHQpXSlcblx0XHRcdCRuZXh0SW5kaWNhdG9yICYmICRuZXh0SW5kaWNhdG9yLmFkZENsYXNzKCdhY3RpdmUnKVxuXHRcdH1cblxuXHRcdHZhciBzbGlkRXZlbnQgPSAkLkV2ZW50KCdzbGlkLmJzLmNhcm91c2VsJywge1xuXHRcdFx0XHRyZWxhdGVkVGFyZ2V0OiByZWxhdGVkVGFyZ2V0LFxuXHRcdFx0XHRkaXJlY3Rpb246IGRpcmVjdGlvblxuXHRcdFx0fSkgLy8geWVzLCBcInNsaWRcIlxuXHRcdGlmICgkLnN1cHBvcnQudHJhbnNpdGlvbiAmJiB0aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCdzbGlkZScpKSB7XG5cdFx0XHQkbmV4dC5hZGRDbGFzcyh0eXBlKVxuXHRcdFx0JG5leHRbMF0ub2Zmc2V0V2lkdGggLy8gZm9yY2UgcmVmbG93XG5cdFx0XHQkYWN0aXZlLmFkZENsYXNzKGRpcmVjdGlvbilcblx0XHRcdCRuZXh0LmFkZENsYXNzKGRpcmVjdGlvbilcblx0XHRcdCRhY3RpdmVcblx0XHRcdFx0Lm9uZSgnYnNUcmFuc2l0aW9uRW5kJywgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0JG5leHQucmVtb3ZlQ2xhc3MoW3R5cGUsIGRpcmVjdGlvbl0uam9pbignICcpKS5hZGRDbGFzcygnYWN0aXZlJylcblx0XHRcdFx0XHQkYWN0aXZlLnJlbW92ZUNsYXNzKFsnYWN0aXZlJywgZGlyZWN0aW9uXS5qb2luKCcgJykpXG5cdFx0XHRcdFx0dGhhdC5zbGlkaW5nID0gZmFsc2Vcblx0XHRcdFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0dGhhdC4kZWxlbWVudC50cmlnZ2VyKHNsaWRFdmVudClcblx0XHRcdFx0XHR9LCAwKVxuXHRcdFx0XHR9KVxuXHRcdFx0XHQuZW11bGF0ZVRyYW5zaXRpb25FbmQoJGFjdGl2ZS5jc3MoJ3RyYW5zaXRpb24tZHVyYXRpb24nKS5zbGljZSgwLCAtMSkgKiAxMDAwKVxuXHRcdH0gZWxzZSB7XG5cdFx0XHQkYWN0aXZlLnJlbW92ZUNsYXNzKCdhY3RpdmUnKVxuXHRcdFx0JG5leHQuYWRkQ2xhc3MoJ2FjdGl2ZScpXG5cdFx0XHR0aGlzLnNsaWRpbmcgPSBmYWxzZVxuXHRcdFx0dGhpcy4kZWxlbWVudC50cmlnZ2VyKHNsaWRFdmVudClcblx0XHR9XG5cblx0XHRpc0N5Y2xpbmcgJiYgdGhpcy5jeWNsZSgpXG5cblx0XHRyZXR1cm4gdGhpc1xuXHR9XG5cblxuXHQvLyBDQVJPVVNFTCBQTFVHSU4gREVGSU5JVElPTlxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5cdGZ1bmN0aW9uIFBsdWdpbihvcHRpb24pIHtcblx0XHRyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyICR0aGlzID0gJCh0aGlzKVxuXHRcdFx0dmFyIGRhdGEgPSAkdGhpcy5kYXRhKCdicy5jYXJvdXNlbCcpXG5cdFx0XHR2YXIgb3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBDYXJvdXNlbC5ERUZBVUxUUywgJHRoaXMuZGF0YSgpLCB0eXBlb2Ygb3B0aW9uID09ICdvYmplY3QnICYmIG9wdGlvbilcblx0XHRcdHZhciBhY3Rpb24gPSB0eXBlb2Ygb3B0aW9uID09ICdzdHJpbmcnID8gb3B0aW9uIDogb3B0aW9ucy5zbGlkZVxuXG5cdFx0XHRpZiAoIWRhdGEpICR0aGlzLmRhdGEoJ2JzLmNhcm91c2VsJywgKGRhdGEgPSBuZXcgQ2Fyb3VzZWwodGhpcywgb3B0aW9ucykpKVxuXHRcdFx0aWYgKHR5cGVvZiBvcHRpb24gPT0gJ251bWJlcicpIGRhdGEudG8ob3B0aW9uKVxuXHRcdFx0ZWxzZSBpZiAoYWN0aW9uKSBkYXRhW2FjdGlvbl0oKVxuXHRcdFx0ZWxzZSBpZiAob3B0aW9ucy5pbnRlcnZhbCkgZGF0YS5wYXVzZSgpLmN5Y2xlKClcblx0XHR9KVxuXHR9XG5cblx0dmFyIG9sZCA9ICQuZm4uY2Fyb3VzZWxcblxuXHQkLmZuLmNhcm91c2VsID0gUGx1Z2luXG5cdCQuZm4uY2Fyb3VzZWwuQ29uc3RydWN0b3IgPSBDYXJvdXNlbFxuXG5cblx0Ly8gQ0FST1VTRUwgTk8gQ09ORkxJQ1Rcblx0Ly8gPT09PT09PT09PT09PT09PT09PT1cblxuXHQkLmZuLmNhcm91c2VsLm5vQ29uZmxpY3QgPSBmdW5jdGlvbigpIHtcblx0XHQkLmZuLmNhcm91c2VsID0gb2xkXG5cdFx0cmV0dXJuIHRoaXNcblx0fVxuXG5cblx0Ly8gQ0FST1VTRUwgREFUQS1BUElcblx0Ly8gPT09PT09PT09PT09PT09PT1cblxuXHQkKGRvY3VtZW50KS5vbignY2xpY2suYnMuY2Fyb3VzZWwuZGF0YS1hcGknLCAnW2RhdGEtc2xpZGVdLCBbZGF0YS1zbGlkZS10b10nLCBmdW5jdGlvbihlKSB7XG5cdFx0dmFyIGhyZWZcblx0XHR2YXIgJHRoaXMgPSAkKHRoaXMpXG5cdFx0dmFyICR0YXJnZXQgPSAkKCR0aGlzLmF0dHIoJ2RhdGEtdGFyZ2V0JykgfHwgKGhyZWYgPSAkdGhpcy5hdHRyKCdocmVmJykpICYmIGhyZWYucmVwbGFjZSgvLiooPz0jW15cXHNdKyQpLywgJycpKSAvLyBzdHJpcCBmb3IgaWU3XG5cdFx0aWYgKCEkdGFyZ2V0Lmhhc0NsYXNzKCdjYXJvdXNlbCcpKSByZXR1cm5cblx0XHR2YXIgb3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCAkdGFyZ2V0LmRhdGEoKSwgJHRoaXMuZGF0YSgpKVxuXHRcdHZhciBzbGlkZUluZGV4ID0gJHRoaXMuYXR0cignZGF0YS1zbGlkZS10bycpXG5cdFx0aWYgKHNsaWRlSW5kZXgpIG9wdGlvbnMuaW50ZXJ2YWwgPSBmYWxzZVxuXG5cdFx0UGx1Z2luLmNhbGwoJHRhcmdldCwgb3B0aW9ucylcblxuXHRcdGlmIChzbGlkZUluZGV4KSB7XG5cdFx0XHQkdGFyZ2V0LmRhdGEoJ2JzLmNhcm91c2VsJykudG8oc2xpZGVJbmRleClcblx0XHR9XG5cblx0XHRlLnByZXZlbnREZWZhdWx0KClcblx0fSlcblxuXHQkKHdpbmRvdykub24oJ2xvYWQnLCBmdW5jdGlvbigpIHtcblx0XHQkKCdbZGF0YS1yaWRlPVwiY2Fyb3VzZWxcIl0nKS5lYWNoKGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyICRjYXJvdXNlbCA9ICQodGhpcylcblx0XHRcdFBsdWdpbi5jYWxsKCRjYXJvdXNlbCwgJGNhcm91c2VsLmRhdGEoKSlcblx0XHR9KVxuXHR9KVxuXG59KGpRdWVyeSk7XG5cbi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogQm9vdHN0cmFwOiBjb2xsYXBzZS5qcyB2My4yLjBcbiAqIGh0dHA6Ly9nZXRib290c3RyYXAuY29tL2phdmFzY3JpcHQvI2NvbGxhcHNlXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqIENvcHlyaWdodCAyMDExLTIwMTQgVHdpdHRlciwgSW5jLlxuICogTGljZW5zZWQgdW5kZXIgTUlUIChodHRwczovL2dpdGh1Yi5jb20vdHdicy9ib290c3RyYXAvYmxvYi9tYXN0ZXIvTElDRU5TRSlcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG5cbisgZnVuY3Rpb24oJCkge1xuXHQndXNlIHN0cmljdCc7XG5cblx0Ly8gQ09MTEFQU0UgUFVCTElDIENMQVNTIERFRklOSVRJT05cblx0Ly8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuXHR2YXIgQ29sbGFwc2UgPSBmdW5jdGlvbihlbGVtZW50LCBvcHRpb25zKSB7XG5cdFx0dGhpcy4kZWxlbWVudCA9ICQoZWxlbWVudClcblx0XHR0aGlzLm9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgQ29sbGFwc2UuREVGQVVMVFMsIG9wdGlvbnMpXG5cdFx0dGhpcy50cmFuc2l0aW9uaW5nID0gbnVsbFxuXG5cdFx0aWYgKHRoaXMub3B0aW9ucy5wYXJlbnQpIHRoaXMuJHBhcmVudCA9ICQodGhpcy5vcHRpb25zLnBhcmVudClcblx0XHRpZiAodGhpcy5vcHRpb25zLnRvZ2dsZSkgdGhpcy50b2dnbGUoKVxuXHR9XG5cblx0Q29sbGFwc2UuVkVSU0lPTiA9ICczLjIuMCdcblxuXHRDb2xsYXBzZS5ERUZBVUxUUyA9IHtcblx0XHR0b2dnbGU6IHRydWVcblx0fVxuXG5cdENvbGxhcHNlLnByb3RvdHlwZS5kaW1lbnNpb24gPSBmdW5jdGlvbigpIHtcblx0XHR2YXIgaGFzV2lkdGggPSB0aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCd3aWR0aCcpXG5cdFx0cmV0dXJuIGhhc1dpZHRoID8gJ3dpZHRoJyA6ICdoZWlnaHQnXG5cdH1cblxuXHRDb2xsYXBzZS5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uKCkge1xuXHRcdGlmICh0aGlzLnRyYW5zaXRpb25pbmcgfHwgdGhpcy4kZWxlbWVudC5oYXNDbGFzcygnaW4nKSkgcmV0dXJuXG5cblx0XHR2YXIgc3RhcnRFdmVudCA9ICQuRXZlbnQoJ3Nob3cuYnMuY29sbGFwc2UnKVxuXHRcdHRoaXMuJGVsZW1lbnQudHJpZ2dlcihzdGFydEV2ZW50KVxuXHRcdGlmIChzdGFydEV2ZW50LmlzRGVmYXVsdFByZXZlbnRlZCgpKSByZXR1cm5cblxuXHRcdHZhciBhY3RpdmVzID0gdGhpcy4kcGFyZW50ICYmIHRoaXMuJHBhcmVudC5maW5kKCc+IC5wYW5lbCA+IC5pbicpXG5cblx0XHRpZiAoYWN0aXZlcyAmJiBhY3RpdmVzLmxlbmd0aCkge1xuXHRcdFx0dmFyIGhhc0RhdGEgPSBhY3RpdmVzLmRhdGEoJ2JzLmNvbGxhcHNlJylcblx0XHRcdGlmIChoYXNEYXRhICYmIGhhc0RhdGEudHJhbnNpdGlvbmluZykgcmV0dXJuXG5cdFx0XHRQbHVnaW4uY2FsbChhY3RpdmVzLCAnaGlkZScpXG5cdFx0XHRoYXNEYXRhIHx8IGFjdGl2ZXMuZGF0YSgnYnMuY29sbGFwc2UnLCBudWxsKVxuXHRcdH1cblxuXHRcdHZhciBkaW1lbnNpb24gPSB0aGlzLmRpbWVuc2lvbigpXG5cblx0XHR0aGlzLiRlbGVtZW50XG5cdFx0XHQucmVtb3ZlQ2xhc3MoJ2NvbGxhcHNlJylcblx0XHRcdC5hZGRDbGFzcygnY29sbGFwc2luZycpW2RpbWVuc2lvbl0oMClcblxuXHRcdHRoaXMudHJhbnNpdGlvbmluZyA9IDFcblxuXHRcdHZhciBjb21wbGV0ZSA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0dGhpcy4kZWxlbWVudFxuXHRcdFx0XHQucmVtb3ZlQ2xhc3MoJ2NvbGxhcHNpbmcnKVxuXHRcdFx0XHQuYWRkQ2xhc3MoJ2NvbGxhcHNlIGluJylbZGltZW5zaW9uXSgnJylcblx0XHRcdHRoaXMudHJhbnNpdGlvbmluZyA9IDBcblx0XHRcdHRoaXMuJGVsZW1lbnRcblx0XHRcdFx0LnRyaWdnZXIoJ3Nob3duLmJzLmNvbGxhcHNlJylcblx0XHR9XG5cblx0XHRpZiAoISQuc3VwcG9ydC50cmFuc2l0aW9uKSByZXR1cm4gY29tcGxldGUuY2FsbCh0aGlzKVxuXG5cdFx0dmFyIHNjcm9sbFNpemUgPSAkLmNhbWVsQ2FzZShbJ3Njcm9sbCcsIGRpbWVuc2lvbl0uam9pbignLScpKVxuXG5cdFx0dGhpcy4kZWxlbWVudFxuXHRcdFx0Lm9uZSgnYnNUcmFuc2l0aW9uRW5kJywgJC5wcm94eShjb21wbGV0ZSwgdGhpcykpXG5cdFx0XHQuZW11bGF0ZVRyYW5zaXRpb25FbmQoMzUwKVtkaW1lbnNpb25dKHRoaXMuJGVsZW1lbnRbMF1bc2Nyb2xsU2l6ZV0pXG5cdH1cblxuXHRDb2xsYXBzZS5wcm90b3R5cGUuaGlkZSA9IGZ1bmN0aW9uKCkge1xuXHRcdGlmICh0aGlzLnRyYW5zaXRpb25pbmcgfHwgIXRoaXMuJGVsZW1lbnQuaGFzQ2xhc3MoJ2luJykpIHJldHVyblxuXG5cdFx0dmFyIHN0YXJ0RXZlbnQgPSAkLkV2ZW50KCdoaWRlLmJzLmNvbGxhcHNlJylcblx0XHR0aGlzLiRlbGVtZW50LnRyaWdnZXIoc3RhcnRFdmVudClcblx0XHRpZiAoc3RhcnRFdmVudC5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgcmV0dXJuXG5cblx0XHR2YXIgZGltZW5zaW9uID0gdGhpcy5kaW1lbnNpb24oKVxuXG5cdFx0dGhpcy4kZWxlbWVudFtkaW1lbnNpb25dKHRoaXMuJGVsZW1lbnRbZGltZW5zaW9uXSgpKVswXS5vZmZzZXRIZWlnaHRcblxuXHRcdHRoaXMuJGVsZW1lbnRcblx0XHRcdC5hZGRDbGFzcygnY29sbGFwc2luZycpXG5cdFx0XHQucmVtb3ZlQ2xhc3MoJ2NvbGxhcHNlJylcblx0XHRcdC5yZW1vdmVDbGFzcygnaW4nKVxuXG5cdFx0dGhpcy50cmFuc2l0aW9uaW5nID0gMVxuXG5cdFx0dmFyIGNvbXBsZXRlID0gZnVuY3Rpb24oKSB7XG5cdFx0XHR0aGlzLnRyYW5zaXRpb25pbmcgPSAwXG5cdFx0XHR0aGlzLiRlbGVtZW50XG5cdFx0XHRcdC50cmlnZ2VyKCdoaWRkZW4uYnMuY29sbGFwc2UnKVxuXHRcdFx0XHQucmVtb3ZlQ2xhc3MoJ2NvbGxhcHNpbmcnKVxuXHRcdFx0XHQuYWRkQ2xhc3MoJ2NvbGxhcHNlJylcblx0XHR9XG5cblx0XHRpZiAoISQuc3VwcG9ydC50cmFuc2l0aW9uKSByZXR1cm4gY29tcGxldGUuY2FsbCh0aGlzKVxuXG5cdFx0dGhpcy4kZWxlbWVudFtkaW1lbnNpb25dKDApXG5cdFx0XHQub25lKCdic1RyYW5zaXRpb25FbmQnLCAkLnByb3h5KGNvbXBsZXRlLCB0aGlzKSlcblx0XHRcdC5lbXVsYXRlVHJhbnNpdGlvbkVuZCgzNTApXG5cdH1cblxuXHRDb2xsYXBzZS5wcm90b3R5cGUudG9nZ2xlID0gZnVuY3Rpb24oKSB7XG5cdFx0dGhpc1t0aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCdpbicpID8gJ2hpZGUnIDogJ3Nob3cnXSgpXG5cdH1cblxuXG5cdC8vIENPTExBUFNFIFBMVUdJTiBERUZJTklUSU9OXG5cdC8vID09PT09PT09PT09PT09PT09PT09PT09PT09XG5cblx0ZnVuY3Rpb24gUGx1Z2luKG9wdGlvbikge1xuXHRcdHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgJHRoaXMgPSAkKHRoaXMpXG5cdFx0XHR2YXIgZGF0YSA9ICR0aGlzLmRhdGEoJ2JzLmNvbGxhcHNlJylcblx0XHRcdHZhciBvcHRpb25zID0gJC5leHRlbmQoe30sIENvbGxhcHNlLkRFRkFVTFRTLCAkdGhpcy5kYXRhKCksIHR5cGVvZiBvcHRpb24gPT0gJ29iamVjdCcgJiYgb3B0aW9uKVxuXG5cdFx0XHRpZiAoIWRhdGEgJiYgb3B0aW9ucy50b2dnbGUgJiYgb3B0aW9uID09ICdzaG93Jykgb3B0aW9uID0gIW9wdGlvblxuXHRcdFx0aWYgKCFkYXRhKSAkdGhpcy5kYXRhKCdicy5jb2xsYXBzZScsIChkYXRhID0gbmV3IENvbGxhcHNlKHRoaXMsIG9wdGlvbnMpKSlcblx0XHRcdGlmICh0eXBlb2Ygb3B0aW9uID09ICdzdHJpbmcnKSBkYXRhW29wdGlvbl0oKVxuXHRcdH0pXG5cdH1cblxuXHR2YXIgb2xkID0gJC5mbi5jb2xsYXBzZVxuXG5cdCQuZm4uY29sbGFwc2UgPSBQbHVnaW5cblx0JC5mbi5jb2xsYXBzZS5Db25zdHJ1Y3RvciA9IENvbGxhcHNlXG5cblxuXHQvLyBDT0xMQVBTRSBOTyBDT05GTElDVFxuXHQvLyA9PT09PT09PT09PT09PT09PT09PVxuXG5cdCQuZm4uY29sbGFwc2Uubm9Db25mbGljdCA9IGZ1bmN0aW9uKCkge1xuXHRcdCQuZm4uY29sbGFwc2UgPSBvbGRcblx0XHRyZXR1cm4gdGhpc1xuXHR9XG5cblxuXHQvLyBDT0xMQVBTRSBEQVRBLUFQSVxuXHQvLyA9PT09PT09PT09PT09PT09PVxuXG5cdCQoZG9jdW1lbnQpLm9uKCdjbGljay5icy5jb2xsYXBzZS5kYXRhLWFwaScsICdbZGF0YS10b2dnbGU9XCJjb2xsYXBzZVwiXScsIGZ1bmN0aW9uKGUpIHtcblx0XHR2YXIgaHJlZlxuXHRcdHZhciAkdGhpcyA9ICQodGhpcylcblx0XHR2YXIgdGFyZ2V0ID0gJHRoaXMuYXR0cignZGF0YS10YXJnZXQnKSB8fCBlLnByZXZlbnREZWZhdWx0KCkgfHwgKGhyZWYgPSAkdGhpcy5hdHRyKCdocmVmJykpICYmIGhyZWYucmVwbGFjZSgvLiooPz0jW15cXHNdKyQpLywgJycpIC8vIHN0cmlwIGZvciBpZTdcblx0XHR2YXIgJHRhcmdldCA9ICQodGFyZ2V0KVxuXHRcdHZhciBkYXRhID0gJHRhcmdldC5kYXRhKCdicy5jb2xsYXBzZScpXG5cdFx0dmFyIG9wdGlvbiA9IGRhdGEgPyAndG9nZ2xlJyA6ICR0aGlzLmRhdGEoKVxuXHRcdHZhciBwYXJlbnQgPSAkdGhpcy5hdHRyKCdkYXRhLXBhcmVudCcpXG5cdFx0dmFyICRwYXJlbnQgPSBwYXJlbnQgJiYgJChwYXJlbnQpXG5cblx0XHRpZiAoIWRhdGEgfHwgIWRhdGEudHJhbnNpdGlvbmluZykge1xuXHRcdFx0aWYgKCRwYXJlbnQpICRwYXJlbnQuZmluZCgnW2RhdGEtdG9nZ2xlPVwiY29sbGFwc2VcIl1bZGF0YS1wYXJlbnQ9XCInICsgcGFyZW50ICsgJ1wiXScpLm5vdCgkdGhpcykuYWRkQ2xhc3MoJ2NvbGxhcHNlZCcpXG5cdFx0XHQkdGhpc1skdGFyZ2V0Lmhhc0NsYXNzKCdpbicpID8gJ2FkZENsYXNzJyA6ICdyZW1vdmVDbGFzcyddKCdjb2xsYXBzZWQnKVxuXHRcdH1cblxuXHRcdFBsdWdpbi5jYWxsKCR0YXJnZXQsIG9wdGlvbilcblx0fSlcblxufShqUXVlcnkpO1xuXG4vKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqIEJvb3RzdHJhcDogZHJvcGRvd24uanMgdjMuMi4wXG4gKiBodHRwOi8vZ2V0Ym9vdHN0cmFwLmNvbS9qYXZhc2NyaXB0LyNkcm9wZG93bnNcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogQ29weXJpZ2h0IDIwMTEtMjAxNCBUd2l0dGVyLCBJbmMuXG4gKiBMaWNlbnNlZCB1bmRlciBNSVQgKGh0dHBzOi8vZ2l0aHViLmNvbS90d2JzL2Jvb3RzdHJhcC9ibG9iL21hc3Rlci9MSUNFTlNFKVxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cblxuKyBmdW5jdGlvbigkKSB7XG5cdCd1c2Ugc3RyaWN0JztcblxuXHQvLyBEUk9QRE9XTiBDTEFTUyBERUZJTklUSU9OXG5cdC8vID09PT09PT09PT09PT09PT09PT09PT09PT1cblxuXHR2YXIgYmFja2Ryb3AgPSAnLmRyb3Bkb3duLWJhY2tkcm9wJ1xuXHR2YXIgdG9nZ2xlID0gJ1tkYXRhLXRvZ2dsZT1cImRyb3Bkb3duXCJdJ1xuXHR2YXIgRHJvcGRvd24gPSBmdW5jdGlvbihlbGVtZW50KSB7XG5cdFx0JChlbGVtZW50KS5vbignY2xpY2suYnMuZHJvcGRvd24nLCB0aGlzLnRvZ2dsZSlcblx0fVxuXG5cdERyb3Bkb3duLlZFUlNJT04gPSAnMy4yLjAnXG5cblx0RHJvcGRvd24ucHJvdG90eXBlLnRvZ2dsZSA9IGZ1bmN0aW9uKGUpIHtcblx0XHR2YXIgJHRoaXMgPSAkKHRoaXMpXG5cblx0XHRpZiAoJHRoaXMuaXMoJy5kaXNhYmxlZCwgOmRpc2FibGVkJykpIHJldHVyblxuXG5cdFx0dmFyICRwYXJlbnQgPSBnZXRQYXJlbnQoJHRoaXMpXG5cdFx0dmFyIGlzQWN0aXZlID0gJHBhcmVudC5oYXNDbGFzcygnb3BlbicpXG5cblx0XHRjbGVhck1lbnVzKClcblxuXHRcdGlmICghaXNBY3RpdmUpIHtcblx0XHRcdGlmICgnb250b3VjaHN0YXJ0JyBpbiBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgJiYgISRwYXJlbnQuY2xvc2VzdCgnLm5hdmJhci1uYXYnKS5sZW5ndGgpIHtcblx0XHRcdFx0Ly8gaWYgbW9iaWxlIHdlIHVzZSBhIGJhY2tkcm9wIGJlY2F1c2UgY2xpY2sgZXZlbnRzIGRvbid0IGRlbGVnYXRlXG5cdFx0XHRcdCQoJzxkaXYgY2xhc3M9XCJkcm9wZG93bi1iYWNrZHJvcFwiLz4nKS5pbnNlcnRBZnRlcigkKHRoaXMpKS5vbignY2xpY2snLCBjbGVhck1lbnVzKVxuXHRcdFx0fVxuXG5cdFx0XHR2YXIgcmVsYXRlZFRhcmdldCA9IHtcblx0XHRcdFx0cmVsYXRlZFRhcmdldDogdGhpc1xuXHRcdFx0fVxuXHRcdFx0JHBhcmVudC50cmlnZ2VyKGUgPSAkLkV2ZW50KCdzaG93LmJzLmRyb3Bkb3duJywgcmVsYXRlZFRhcmdldCkpXG5cblx0XHRcdGlmIChlLmlzRGVmYXVsdFByZXZlbnRlZCgpKSByZXR1cm5cblxuXHRcdFx0JHRoaXMudHJpZ2dlcignZm9jdXMnKVxuXG5cdFx0XHQkcGFyZW50XG5cdFx0XHRcdC50b2dnbGVDbGFzcygnb3BlbicpXG5cdFx0XHRcdC50cmlnZ2VyKCdzaG93bi5icy5kcm9wZG93bicsIHJlbGF0ZWRUYXJnZXQpXG5cdFx0fVxuXG5cdFx0cmV0dXJuIGZhbHNlXG5cdH1cblxuXHREcm9wZG93bi5wcm90b3R5cGUua2V5ZG93biA9IGZ1bmN0aW9uKGUpIHtcblx0XHRpZiAoIS8oMzh8NDB8MjcpLy50ZXN0KGUua2V5Q29kZSkpIHJldHVyblxuXG5cdFx0dmFyICR0aGlzID0gJCh0aGlzKVxuXG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpXG5cdFx0ZS5zdG9wUHJvcGFnYXRpb24oKVxuXG5cdFx0aWYgKCR0aGlzLmlzKCcuZGlzYWJsZWQsIDpkaXNhYmxlZCcpKSByZXR1cm5cblxuXHRcdHZhciAkcGFyZW50ID0gZ2V0UGFyZW50KCR0aGlzKVxuXHRcdHZhciBpc0FjdGl2ZSA9ICRwYXJlbnQuaGFzQ2xhc3MoJ29wZW4nKVxuXG5cdFx0aWYgKCFpc0FjdGl2ZSB8fCAoaXNBY3RpdmUgJiYgZS5rZXlDb2RlID09IDI3KSkge1xuXHRcdFx0aWYgKGUud2hpY2ggPT0gMjcpICRwYXJlbnQuZmluZCh0b2dnbGUpLnRyaWdnZXIoJ2ZvY3VzJylcblx0XHRcdHJldHVybiAkdGhpcy50cmlnZ2VyKCdjbGljaycpXG5cdFx0fVxuXG5cdFx0dmFyIGRlc2MgPSAnIGxpOm5vdCguZGl2aWRlcik6dmlzaWJsZSBhJ1xuXHRcdHZhciAkaXRlbXMgPSAkcGFyZW50LmZpbmQoJ1tyb2xlPVwibWVudVwiXScgKyBkZXNjICsgJywgW3JvbGU9XCJsaXN0Ym94XCJdJyArIGRlc2MpXG5cblx0XHRpZiAoISRpdGVtcy5sZW5ndGgpIHJldHVyblxuXG5cdFx0dmFyIGluZGV4ID0gJGl0ZW1zLmluZGV4KCRpdGVtcy5maWx0ZXIoJzpmb2N1cycpKVxuXG5cdFx0aWYgKGUua2V5Q29kZSA9PSAzOCAmJiBpbmRleCA+IDApIGluZGV4LS0gLy8gdXBcblx0XHRcdGlmIChlLmtleUNvZGUgPT0gNDAgJiYgaW5kZXggPCAkaXRlbXMubGVuZ3RoIC0gMSkgaW5kZXgrKyAvLyBkb3duXG5cdFx0XHRcdGlmICghfmluZGV4KSBpbmRleCA9IDBcblxuXHRcdCRpdGVtcy5lcShpbmRleCkudHJpZ2dlcignZm9jdXMnKVxuXHR9XG5cblx0ZnVuY3Rpb24gY2xlYXJNZW51cyhlKSB7XG5cdFx0aWYgKGUgJiYgZS53aGljaCA9PT0gMykgcmV0dXJuXG5cdFx0JChiYWNrZHJvcCkucmVtb3ZlKClcblx0XHQkKHRvZ2dsZSkuZWFjaChmdW5jdGlvbigpIHtcblx0XHRcdHZhciAkcGFyZW50ID0gZ2V0UGFyZW50KCQodGhpcykpXG5cdFx0XHR2YXIgcmVsYXRlZFRhcmdldCA9IHtcblx0XHRcdFx0cmVsYXRlZFRhcmdldDogdGhpc1xuXHRcdFx0fVxuXHRcdFx0aWYgKCEkcGFyZW50Lmhhc0NsYXNzKCdvcGVuJykpIHJldHVyblxuXHRcdFx0JHBhcmVudC50cmlnZ2VyKGUgPSAkLkV2ZW50KCdoaWRlLmJzLmRyb3Bkb3duJywgcmVsYXRlZFRhcmdldCkpXG5cdFx0XHRpZiAoZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgcmV0dXJuXG5cdFx0XHQkcGFyZW50LnJlbW92ZUNsYXNzKCdvcGVuJykudHJpZ2dlcignaGlkZGVuLmJzLmRyb3Bkb3duJywgcmVsYXRlZFRhcmdldClcblx0XHR9KVxuXHR9XG5cblx0ZnVuY3Rpb24gZ2V0UGFyZW50KCR0aGlzKSB7XG5cdFx0dmFyIHNlbGVjdG9yID0gJHRoaXMuYXR0cignZGF0YS10YXJnZXQnKVxuXG5cdFx0aWYgKCFzZWxlY3Rvcikge1xuXHRcdFx0c2VsZWN0b3IgPSAkdGhpcy5hdHRyKCdocmVmJylcblx0XHRcdHNlbGVjdG9yID0gc2VsZWN0b3IgJiYgLyNbQS1aYS16XS8udGVzdChzZWxlY3RvcikgJiYgc2VsZWN0b3IucmVwbGFjZSgvLiooPz0jW15cXHNdKiQpLywgJycpIC8vIHN0cmlwIGZvciBpZTdcblx0XHR9XG5cblx0XHR2YXIgJHBhcmVudCA9IHNlbGVjdG9yICYmICQoc2VsZWN0b3IpXG5cblx0XHRyZXR1cm4gJHBhcmVudCAmJiAkcGFyZW50Lmxlbmd0aCA/ICRwYXJlbnQgOiAkdGhpcy5wYXJlbnQoKVxuXHR9XG5cblxuXHQvLyBEUk9QRE9XTiBQTFVHSU4gREVGSU5JVElPTlxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5cdGZ1bmN0aW9uIFBsdWdpbihvcHRpb24pIHtcblx0XHRyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyICR0aGlzID0gJCh0aGlzKVxuXHRcdFx0dmFyIGRhdGEgPSAkdGhpcy5kYXRhKCdicy5kcm9wZG93bicpXG5cblx0XHRcdGlmICghZGF0YSkgJHRoaXMuZGF0YSgnYnMuZHJvcGRvd24nLCAoZGF0YSA9IG5ldyBEcm9wZG93bih0aGlzKSkpXG5cdFx0XHRpZiAodHlwZW9mIG9wdGlvbiA9PSAnc3RyaW5nJykgZGF0YVtvcHRpb25dLmNhbGwoJHRoaXMpXG5cdFx0fSlcblx0fVxuXG5cdHZhciBvbGQgPSAkLmZuLmRyb3Bkb3duXG5cblx0JC5mbi5kcm9wZG93biA9IFBsdWdpblxuXHQkLmZuLmRyb3Bkb3duLkNvbnN0cnVjdG9yID0gRHJvcGRvd25cblxuXG5cdC8vIERST1BET1dOIE5PIENPTkZMSUNUXG5cdC8vID09PT09PT09PT09PT09PT09PT09XG5cblx0JC5mbi5kcm9wZG93bi5ub0NvbmZsaWN0ID0gZnVuY3Rpb24oKSB7XG5cdFx0JC5mbi5kcm9wZG93biA9IG9sZFxuXHRcdHJldHVybiB0aGlzXG5cdH1cblxuXG5cdC8vIEFQUExZIFRPIFNUQU5EQVJEIERST1BET1dOIEVMRU1FTlRTXG5cdC8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cblx0JChkb2N1bWVudClcblx0XHQub24oJ2NsaWNrLmJzLmRyb3Bkb3duLmRhdGEtYXBpJywgY2xlYXJNZW51cylcblx0XHQub24oJ2NsaWNrLmJzLmRyb3Bkb3duLmRhdGEtYXBpJywgJy5kcm9wZG93biBmb3JtJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKVxuXHRcdH0pXG5cdFx0Lm9uKCdjbGljay5icy5kcm9wZG93bi5kYXRhLWFwaScsIHRvZ2dsZSwgRHJvcGRvd24ucHJvdG90eXBlLnRvZ2dsZSlcblx0XHQub24oJ2tleWRvd24uYnMuZHJvcGRvd24uZGF0YS1hcGknLCB0b2dnbGUgKyAnLCBbcm9sZT1cIm1lbnVcIl0sIFtyb2xlPVwibGlzdGJveFwiXScsIERyb3Bkb3duLnByb3RvdHlwZS5rZXlkb3duKVxuXG59KGpRdWVyeSk7XG5cbi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogQm9vdHN0cmFwOiB0YWIuanMgdjMuMi4wXG4gKiBodHRwOi8vZ2V0Ym9vdHN0cmFwLmNvbS9qYXZhc2NyaXB0LyN0YWJzXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqIENvcHlyaWdodCAyMDExLTIwMTQgVHdpdHRlciwgSW5jLlxuICogTGljZW5zZWQgdW5kZXIgTUlUIChodHRwczovL2dpdGh1Yi5jb20vdHdicy9ib290c3RyYXAvYmxvYi9tYXN0ZXIvTElDRU5TRSlcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG5cbisgZnVuY3Rpb24oJCkge1xuXHQndXNlIHN0cmljdCc7XG5cblx0Ly8gVEFCIENMQVNTIERFRklOSVRJT05cblx0Ly8gPT09PT09PT09PT09PT09PT09PT1cblxuXHR2YXIgVGFiID0gZnVuY3Rpb24oZWxlbWVudCkge1xuXHRcdHRoaXMuZWxlbWVudCA9ICQoZWxlbWVudClcblx0fVxuXG5cdFRhYi5WRVJTSU9OID0gJzMuMi4wJ1xuXG5cdFRhYi5wcm90b3R5cGUuc2hvdyA9IGZ1bmN0aW9uKCkge1xuXHRcdHZhciAkdGhpcyA9IHRoaXMuZWxlbWVudFxuXHRcdHZhciAkdWwgPSAkdGhpcy5jbG9zZXN0KCd1bDpub3QoLmRyb3Bkb3duLW1lbnUpJylcblx0XHR2YXIgc2VsZWN0b3IgPSAkdGhpcy5kYXRhKCd0YXJnZXQnKVxuXG5cdFx0aWYgKCFzZWxlY3Rvcikge1xuXHRcdFx0c2VsZWN0b3IgPSAkdGhpcy5hdHRyKCdocmVmJylcblx0XHRcdHNlbGVjdG9yID0gc2VsZWN0b3IgJiYgc2VsZWN0b3IucmVwbGFjZSgvLiooPz0jW15cXHNdKiQpLywgJycpIC8vIHN0cmlwIGZvciBpZTdcblx0XHR9XG5cblx0XHRpZiAoJHRoaXMucGFyZW50KCdsaScpLmhhc0NsYXNzKCdhY3RpdmUnKSkgcmV0dXJuXG5cblx0XHR2YXIgcHJldmlvdXMgPSAkdWwuZmluZCgnLmFjdGl2ZTpsYXN0IGEnKVswXVxuXHRcdHZhciBlID0gJC5FdmVudCgnc2hvdy5icy50YWInLCB7XG5cdFx0XHRyZWxhdGVkVGFyZ2V0OiBwcmV2aW91c1xuXHRcdH0pXG5cblx0XHQkdGhpcy50cmlnZ2VyKGUpXG5cblx0XHRpZiAoZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgcmV0dXJuXG5cblx0XHR2YXIgJHRhcmdldCA9ICQoc2VsZWN0b3IpXG5cblx0XHR0aGlzLmFjdGl2YXRlKCR0aGlzLmNsb3Nlc3QoJ2xpJyksICR1bClcblx0XHR0aGlzLmFjdGl2YXRlKCR0YXJnZXQsICR0YXJnZXQucGFyZW50KCksIGZ1bmN0aW9uKCkge1xuXHRcdFx0JHRoaXMudHJpZ2dlcih7XG5cdFx0XHRcdHR5cGU6ICdzaG93bi5icy50YWInLFxuXHRcdFx0XHRyZWxhdGVkVGFyZ2V0OiBwcmV2aW91c1xuXHRcdFx0fSlcblx0XHR9KVxuXHR9XG5cblx0VGFiLnByb3RvdHlwZS5hY3RpdmF0ZSA9IGZ1bmN0aW9uKGVsZW1lbnQsIGNvbnRhaW5lciwgY2FsbGJhY2spIHtcblx0XHR2YXIgJGFjdGl2ZSA9IGNvbnRhaW5lci5maW5kKCc+IC5hY3RpdmUnKVxuXHRcdHZhciB0cmFuc2l0aW9uID0gY2FsbGJhY2sgJiYgJC5zdXBwb3J0LnRyYW5zaXRpb24gJiYgJGFjdGl2ZS5oYXNDbGFzcygnZmFkZScpXG5cblx0XHRmdW5jdGlvbiBuZXh0KCkge1xuXHRcdFx0JGFjdGl2ZVxuXHRcdFx0XHQucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpXG5cdFx0XHRcdC5maW5kKCc+IC5kcm9wZG93bi1tZW51ID4gLmFjdGl2ZScpXG5cdFx0XHRcdC5yZW1vdmVDbGFzcygnYWN0aXZlJylcblxuXHRcdFx0ZWxlbWVudC5hZGRDbGFzcygnYWN0aXZlJylcblxuXHRcdFx0aWYgKHRyYW5zaXRpb24pIHtcblx0XHRcdFx0ZWxlbWVudFswXS5vZmZzZXRXaWR0aCAvLyByZWZsb3cgZm9yIHRyYW5zaXRpb25cblx0XHRcdFx0ZWxlbWVudC5hZGRDbGFzcygnaW4nKVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0ZWxlbWVudC5yZW1vdmVDbGFzcygnZmFkZScpXG5cdFx0XHR9XG5cblx0XHRcdGlmIChlbGVtZW50LnBhcmVudCgnLmRyb3Bkb3duLW1lbnUnKSkge1xuXHRcdFx0XHRlbGVtZW50LmNsb3Nlc3QoJ2xpLmRyb3Bkb3duJykuYWRkQ2xhc3MoJ2FjdGl2ZScpXG5cdFx0XHR9XG5cblx0XHRcdGNhbGxiYWNrICYmIGNhbGxiYWNrKClcblx0XHR9XG5cblx0XHR0cmFuc2l0aW9uID9cblx0XHRcdCRhY3RpdmVcblx0XHRcdC5vbmUoJ2JzVHJhbnNpdGlvbkVuZCcsIG5leHQpXG5cdFx0XHQuZW11bGF0ZVRyYW5zaXRpb25FbmQoMTUwKSA6XG5cdFx0XHRuZXh0KClcblxuXHRcdCRhY3RpdmUucmVtb3ZlQ2xhc3MoJ2luJylcblx0fVxuXG5cblx0Ly8gVEFCIFBMVUdJTiBERUZJTklUSU9OXG5cdC8vID09PT09PT09PT09PT09PT09PT09PVxuXG5cdGZ1bmN0aW9uIFBsdWdpbihvcHRpb24pIHtcblx0XHRyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyICR0aGlzID0gJCh0aGlzKVxuXHRcdFx0dmFyIGRhdGEgPSAkdGhpcy5kYXRhKCdicy50YWInKVxuXG5cdFx0XHRpZiAoIWRhdGEpICR0aGlzLmRhdGEoJ2JzLnRhYicsIChkYXRhID0gbmV3IFRhYih0aGlzKSkpXG5cdFx0XHRpZiAodHlwZW9mIG9wdGlvbiA9PSAnc3RyaW5nJykgZGF0YVtvcHRpb25dKClcblx0XHR9KVxuXHR9XG5cblx0dmFyIG9sZCA9ICQuZm4udGFiXG5cblx0JC5mbi50YWIgPSBQbHVnaW5cblx0JC5mbi50YWIuQ29uc3RydWN0b3IgPSBUYWJcblxuXG5cdC8vIFRBQiBOTyBDT05GTElDVFxuXHQvLyA9PT09PT09PT09PT09PT1cblxuXHQkLmZuLnRhYi5ub0NvbmZsaWN0ID0gZnVuY3Rpb24oKSB7XG5cdFx0JC5mbi50YWIgPSBvbGRcblx0XHRyZXR1cm4gdGhpc1xuXHR9XG5cblxuXHQvLyBUQUIgREFUQS1BUElcblx0Ly8gPT09PT09PT09PT09XG5cblx0JChkb2N1bWVudCkub24oJ2NsaWNrLmJzLnRhYi5kYXRhLWFwaScsICdbZGF0YS10b2dnbGU9XCJ0YWJcIl0sIFtkYXRhLXRvZ2dsZT1cInBpbGxcIl0nLCBmdW5jdGlvbihlKSB7XG5cdFx0ZS5wcmV2ZW50RGVmYXVsdCgpXG5cdFx0UGx1Z2luLmNhbGwoJCh0aGlzKSwgJ3Nob3cnKVxuXHR9KVxuXG59KGpRdWVyeSk7XG5cbi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogQm9vdHN0cmFwOiB0cmFuc2l0aW9uLmpzIHYzLjIuMFxuICogaHR0cDovL2dldGJvb3RzdHJhcC5jb20vamF2YXNjcmlwdC8jdHJhbnNpdGlvbnNcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogQ29weXJpZ2h0IDIwMTEtMjAxNCBUd2l0dGVyLCBJbmMuXG4gKiBMaWNlbnNlZCB1bmRlciBNSVQgKGh0dHBzOi8vZ2l0aHViLmNvbS90d2JzL2Jvb3RzdHJhcC9ibG9iL21hc3Rlci9MSUNFTlNFKVxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09ICovXG5cblxuKyBmdW5jdGlvbigkKSB7XG5cdCd1c2Ugc3RyaWN0JztcblxuXHQvLyBDU1MgVFJBTlNJVElPTiBTVVBQT1JUIChTaG91dG91dDogaHR0cDovL3d3dy5tb2Rlcm5penIuY29tLylcblx0Ly8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cblx0ZnVuY3Rpb24gdHJhbnNpdGlvbkVuZCgpIHtcblx0XHR2YXIgZWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdib290c3RyYXAnKVxuXG5cdFx0dmFyIHRyYW5zRW5kRXZlbnROYW1lcyA9IHtcblx0XHRcdFdlYmtpdFRyYW5zaXRpb246ICd3ZWJraXRUcmFuc2l0aW9uRW5kJyxcblx0XHRcdE1velRyYW5zaXRpb246ICd0cmFuc2l0aW9uZW5kJyxcblx0XHRcdE9UcmFuc2l0aW9uOiAnb1RyYW5zaXRpb25FbmQgb3RyYW5zaXRpb25lbmQnLFxuXHRcdFx0dHJhbnNpdGlvbjogJ3RyYW5zaXRpb25lbmQnXG5cdFx0fVxuXG5cdFx0Zm9yICh2YXIgbmFtZSBpbiB0cmFuc0VuZEV2ZW50TmFtZXMpIHtcblx0XHRcdGlmIChlbC5zdHlsZVtuYW1lXSAhPT0gdW5kZWZpbmVkKSB7XG5cdFx0XHRcdHJldHVybiB7XG5cdFx0XHRcdFx0ZW5kOiB0cmFuc0VuZEV2ZW50TmFtZXNbbmFtZV1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBmYWxzZSAvLyBleHBsaWNpdCBmb3IgaWU4ICggIC5fLilcblx0fVxuXG5cdC8vIGh0dHA6Ly9ibG9nLmFsZXhtYWNjYXcuY29tL2Nzcy10cmFuc2l0aW9uc1xuXHQkLmZuLmVtdWxhdGVUcmFuc2l0aW9uRW5kID0gZnVuY3Rpb24oZHVyYXRpb24pIHtcblx0XHR2YXIgY2FsbGVkID0gZmFsc2Vcblx0XHR2YXIgJGVsID0gdGhpc1xuXHRcdCQodGhpcykub25lKCdic1RyYW5zaXRpb25FbmQnLCBmdW5jdGlvbigpIHtcblx0XHRcdGNhbGxlZCA9IHRydWVcblx0XHR9KVxuXHRcdHZhciBjYWxsYmFjayA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0aWYgKCFjYWxsZWQpICQoJGVsKS50cmlnZ2VyKCQuc3VwcG9ydC50cmFuc2l0aW9uLmVuZClcblx0XHR9XG5cdFx0c2V0VGltZW91dChjYWxsYmFjaywgZHVyYXRpb24pXG5cdFx0cmV0dXJuIHRoaXNcblx0fVxuXG5cdCQoZnVuY3Rpb24oKSB7XG5cdFx0JC5zdXBwb3J0LnRyYW5zaXRpb24gPSB0cmFuc2l0aW9uRW5kKClcblxuXHRcdGlmICghJC5zdXBwb3J0LnRyYW5zaXRpb24pIHJldHVyblxuXG5cdFx0JC5ldmVudC5zcGVjaWFsLmJzVHJhbnNpdGlvbkVuZCA9IHtcblx0XHRcdGJpbmRUeXBlOiAkLnN1cHBvcnQudHJhbnNpdGlvbi5lbmQsXG5cdFx0XHRkZWxlZ2F0ZVR5cGU6ICQuc3VwcG9ydC50cmFuc2l0aW9uLmVuZCxcblx0XHRcdGhhbmRsZTogZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRpZiAoJChlLnRhcmdldCkuaXModGhpcykpIHJldHVybiBlLmhhbmRsZU9iai5oYW5kbGVyLmFwcGx5KHRoaXMsIGFyZ3VtZW50cylcblx0XHRcdH1cblx0XHR9XG5cdH0pXG5cbn0oalF1ZXJ5KTtcblxuLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiBCb290c3RyYXA6IHNjcm9sbHNweS5qcyB2My4yLjBcbiAqIGh0dHA6Ly9nZXRib290c3RyYXAuY29tL2phdmFzY3JpcHQvI3Njcm9sbHNweVxuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiBDb3B5cmlnaHQgMjAxMS0yMDE0IFR3aXR0ZXIsIEluYy5cbiAqIExpY2Vuc2VkIHVuZGVyIE1JVCAoaHR0cHM6Ly9naXRodWIuY29tL3R3YnMvYm9vdHN0cmFwL2Jsb2IvbWFzdGVyL0xJQ0VOU0UpXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuXG4rIGZ1bmN0aW9uKCQpIHtcblx0J3VzZSBzdHJpY3QnO1xuXG5cdC8vIFNDUk9MTFNQWSBDTEFTUyBERUZJTklUSU9OXG5cdC8vID09PT09PT09PT09PT09PT09PT09PT09PT09XG5cblx0ZnVuY3Rpb24gU2Nyb2xsU3B5KGVsZW1lbnQsIG9wdGlvbnMpIHtcblx0XHR2YXIgcHJvY2VzcyA9ICQucHJveHkodGhpcy5wcm9jZXNzLCB0aGlzKVxuXG5cdFx0dGhpcy4kYm9keSA9ICQoJ2JvZHknKVxuXHRcdHRoaXMuJHNjcm9sbEVsZW1lbnQgPSAkKGVsZW1lbnQpLmlzKCdib2R5JykgPyAkKHdpbmRvdykgOiAkKGVsZW1lbnQpXG5cdFx0dGhpcy5vcHRpb25zID0gJC5leHRlbmQoe30sIFNjcm9sbFNweS5ERUZBVUxUUywgb3B0aW9ucylcblx0XHR0aGlzLnNlbGVjdG9yID0gKHRoaXMub3B0aW9ucy50YXJnZXQgfHwgJycpICsgJyAubmF2IGxpID4gYSdcblx0XHR0aGlzLm9mZnNldHMgPSBbXVxuXHRcdHRoaXMudGFyZ2V0cyA9IFtdXG5cdFx0dGhpcy5hY3RpdmVUYXJnZXQgPSBudWxsXG5cdFx0dGhpcy5zY3JvbGxIZWlnaHQgPSAwXG5cblx0XHR0aGlzLiRzY3JvbGxFbGVtZW50Lm9uKCdzY3JvbGwuYnMuc2Nyb2xsc3B5JywgcHJvY2Vzcylcblx0XHR0aGlzLnJlZnJlc2goKVxuXHRcdHRoaXMucHJvY2VzcygpXG5cdH1cblxuXHRTY3JvbGxTcHkuVkVSU0lPTiA9ICczLjIuMCdcblxuXHRTY3JvbGxTcHkuREVGQVVMVFMgPSB7XG5cdFx0b2Zmc2V0OiAxMFxuXHR9XG5cblx0U2Nyb2xsU3B5LnByb3RvdHlwZS5nZXRTY3JvbGxIZWlnaHQgPSBmdW5jdGlvbigpIHtcblx0XHRyZXR1cm4gdGhpcy4kc2Nyb2xsRWxlbWVudFswXS5zY3JvbGxIZWlnaHQgfHwgTWF0aC5tYXgodGhpcy4kYm9keVswXS5zY3JvbGxIZWlnaHQsIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxIZWlnaHQpXG5cdH1cblxuXHRTY3JvbGxTcHkucHJvdG90eXBlLnJlZnJlc2ggPSBmdW5jdGlvbigpIHtcblx0XHR2YXIgb2Zmc2V0TWV0aG9kID0gJ29mZnNldCdcblx0XHR2YXIgb2Zmc2V0QmFzZSA9IDBcblxuXHRcdGlmICghJC5pc1dpbmRvdyh0aGlzLiRzY3JvbGxFbGVtZW50WzBdKSkge1xuXHRcdFx0b2Zmc2V0TWV0aG9kID0gJ3Bvc2l0aW9uJ1xuXHRcdFx0b2Zmc2V0QmFzZSA9IHRoaXMuJHNjcm9sbEVsZW1lbnQuc2Nyb2xsVG9wKClcblx0XHR9XG5cblx0XHR0aGlzLm9mZnNldHMgPSBbXVxuXHRcdHRoaXMudGFyZ2V0cyA9IFtdXG5cdFx0dGhpcy5zY3JvbGxIZWlnaHQgPSB0aGlzLmdldFNjcm9sbEhlaWdodCgpXG5cblx0XHR2YXIgc2VsZiA9IHRoaXNcblxuXHRcdHRoaXMuJGJvZHlcblx0XHRcdC5maW5kKHRoaXMuc2VsZWN0b3IpXG5cdFx0XHQubWFwKGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR2YXIgJGVsID0gJCh0aGlzKVxuXHRcdFx0XHR2YXIgaHJlZiA9ICRlbC5kYXRhKCd0YXJnZXQnKSB8fCAkZWwuYXR0cignaHJlZicpXG5cdFx0XHRcdHZhciAkaHJlZiA9IC9eIy4vLnRlc3QoaHJlZikgJiYgJChocmVmKVxuXG5cdFx0XHRcdHJldHVybiAoJGhyZWYgJiYgJGhyZWYubGVuZ3RoICYmICRocmVmLmlzKCc6dmlzaWJsZScpICYmIFtcblx0XHRcdFx0XHRbJGhyZWZbb2Zmc2V0TWV0aG9kXSgpLnRvcCArIG9mZnNldEJhc2UsIGhyZWZdXG5cdFx0XHRcdF0pIHx8IG51bGxcblx0XHRcdH0pXG5cdFx0XHQuc29ydChmdW5jdGlvbihhLCBiKSB7XG5cdFx0XHRcdHJldHVybiBhWzBdIC0gYlswXVxuXHRcdFx0fSlcblx0XHRcdC5lYWNoKGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRzZWxmLm9mZnNldHMucHVzaCh0aGlzWzBdKVxuXHRcdFx0XHRzZWxmLnRhcmdldHMucHVzaCh0aGlzWzFdKVxuXHRcdFx0fSlcblx0fVxuXG5cdFNjcm9sbFNweS5wcm90b3R5cGUucHJvY2VzcyA9IGZ1bmN0aW9uKCkge1xuXHRcdHZhciBzY3JvbGxUb3AgPSB0aGlzLiRzY3JvbGxFbGVtZW50LnNjcm9sbFRvcCgpICsgdGhpcy5vcHRpb25zLm9mZnNldFxuXHRcdHZhciBzY3JvbGxIZWlnaHQgPSB0aGlzLmdldFNjcm9sbEhlaWdodCgpXG5cdFx0dmFyIG1heFNjcm9sbCA9IHRoaXMub3B0aW9ucy5vZmZzZXQgKyBzY3JvbGxIZWlnaHQgLSB0aGlzLiRzY3JvbGxFbGVtZW50LmhlaWdodCgpXG5cdFx0dmFyIG9mZnNldHMgPSB0aGlzLm9mZnNldHNcblx0XHR2YXIgdGFyZ2V0cyA9IHRoaXMudGFyZ2V0c1xuXHRcdHZhciBhY3RpdmVUYXJnZXQgPSB0aGlzLmFjdGl2ZVRhcmdldFxuXHRcdHZhciBpXG5cblx0XHRpZiAodGhpcy5zY3JvbGxIZWlnaHQgIT0gc2Nyb2xsSGVpZ2h0KSB7XG5cdFx0XHR0aGlzLnJlZnJlc2goKVxuXHRcdH1cblxuXHRcdGlmIChzY3JvbGxUb3AgPj0gbWF4U2Nyb2xsKSB7XG5cdFx0XHRyZXR1cm4gYWN0aXZlVGFyZ2V0ICE9IChpID0gdGFyZ2V0c1t0YXJnZXRzLmxlbmd0aCAtIDFdKSAmJiB0aGlzLmFjdGl2YXRlKGkpXG5cdFx0fVxuXG5cdFx0aWYgKGFjdGl2ZVRhcmdldCAmJiBzY3JvbGxUb3AgPD0gb2Zmc2V0c1swXSkge1xuXHRcdFx0cmV0dXJuIGFjdGl2ZVRhcmdldCAhPSAoaSA9IHRhcmdldHNbMF0pICYmIHRoaXMuYWN0aXZhdGUoaSlcblx0XHR9XG5cblx0XHRmb3IgKGkgPSBvZmZzZXRzLmxlbmd0aDsgaS0tOykge1xuXHRcdFx0YWN0aXZlVGFyZ2V0ICE9IHRhcmdldHNbaV0gJiYgc2Nyb2xsVG9wID49IG9mZnNldHNbaV0gJiYgKCFvZmZzZXRzW2kgKyAxXSB8fCBzY3JvbGxUb3AgPD0gb2Zmc2V0c1tpICsgMV0pICYmIHRoaXMuYWN0aXZhdGUodGFyZ2V0c1tpXSlcblx0XHR9XG5cdH1cblxuXHRTY3JvbGxTcHkucHJvdG90eXBlLmFjdGl2YXRlID0gZnVuY3Rpb24odGFyZ2V0KSB7XG5cdFx0dGhpcy5hY3RpdmVUYXJnZXQgPSB0YXJnZXRcblxuXHRcdCQodGhpcy5zZWxlY3Rvcilcblx0XHRcdC5wYXJlbnRzVW50aWwodGhpcy5vcHRpb25zLnRhcmdldCwgJy5hY3RpdmUnKVxuXHRcdFx0LnJlbW92ZUNsYXNzKCdhY3RpdmUnKVxuXG5cdFx0dmFyIHNlbGVjdG9yID0gdGhpcy5zZWxlY3RvciArXG5cdFx0XHQnW2RhdGEtdGFyZ2V0PVwiJyArIHRhcmdldCArICdcIl0sJyArXG5cdFx0XHR0aGlzLnNlbGVjdG9yICsgJ1tocmVmPVwiJyArIHRhcmdldCArICdcIl0nXG5cblx0XHR2YXIgYWN0aXZlID0gJChzZWxlY3Rvcilcblx0XHRcdC5wYXJlbnRzKCdsaScpXG5cdFx0XHQuYWRkQ2xhc3MoJ2FjdGl2ZScpXG5cblx0XHRpZiAoYWN0aXZlLnBhcmVudCgnLmRyb3Bkb3duLW1lbnUnKS5sZW5ndGgpIHtcblx0XHRcdGFjdGl2ZSA9IGFjdGl2ZVxuXHRcdFx0XHQuY2xvc2VzdCgnbGkuZHJvcGRvd24nKVxuXHRcdFx0XHQuYWRkQ2xhc3MoJ2FjdGl2ZScpXG5cdFx0fVxuXG5cdFx0YWN0aXZlLnRyaWdnZXIoJ2FjdGl2YXRlLmJzLnNjcm9sbHNweScpXG5cdH1cblxuXG5cdC8vIFNDUk9MTFNQWSBQTFVHSU4gREVGSU5JVElPTlxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuXHRmdW5jdGlvbiBQbHVnaW4ob3B0aW9uKSB7XG5cdFx0cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHtcblx0XHRcdHZhciAkdGhpcyA9ICQodGhpcylcblx0XHRcdHZhciBkYXRhID0gJHRoaXMuZGF0YSgnYnMuc2Nyb2xsc3B5Jylcblx0XHRcdHZhciBvcHRpb25zID0gdHlwZW9mIG9wdGlvbiA9PSAnb2JqZWN0JyAmJiBvcHRpb25cblxuXHRcdFx0aWYgKCFkYXRhKSAkdGhpcy5kYXRhKCdicy5zY3JvbGxzcHknLCAoZGF0YSA9IG5ldyBTY3JvbGxTcHkodGhpcywgb3B0aW9ucykpKVxuXHRcdFx0aWYgKHR5cGVvZiBvcHRpb24gPT0gJ3N0cmluZycpIGRhdGFbb3B0aW9uXSgpXG5cdFx0fSlcblx0fVxuXG5cdHZhciBvbGQgPSAkLmZuLnNjcm9sbHNweVxuXG5cdCQuZm4uc2Nyb2xsc3B5ID0gUGx1Z2luXG5cdCQuZm4uc2Nyb2xsc3B5LkNvbnN0cnVjdG9yID0gU2Nyb2xsU3B5XG5cblxuXHQvLyBTQ1JPTExTUFkgTk8gQ09ORkxJQ1Rcblx0Ly8gPT09PT09PT09PT09PT09PT09PT09XG5cblx0JC5mbi5zY3JvbGxzcHkubm9Db25mbGljdCA9IGZ1bmN0aW9uKCkge1xuXHRcdCQuZm4uc2Nyb2xsc3B5ID0gb2xkXG5cdFx0cmV0dXJuIHRoaXNcblx0fVxuXG5cblx0Ly8gU0NST0xMU1BZIERBVEEtQVBJXG5cdC8vID09PT09PT09PT09PT09PT09PVxuXG5cdCQod2luZG93KS5vbignbG9hZC5icy5zY3JvbGxzcHkuZGF0YS1hcGknLCBmdW5jdGlvbigpIHtcblx0XHQkKCdbZGF0YS1zcHk9XCJzY3JvbGxcIl0nKS5lYWNoKGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyICRzcHkgPSAkKHRoaXMpXG5cdFx0XHRQbHVnaW4uY2FsbCgkc3B5LCAkc3B5LmRhdGEoKSlcblx0XHR9KVxuXHR9KVxuXG59KGpRdWVyeSk7XG5cbi8qID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICogQm9vdHN0cmFwOiBtb2RhbC5qcyB2My4yLjBcbiAqIGh0dHA6Ly9nZXRib290c3RyYXAuY29tL2phdmFzY3JpcHQvI21vZGFsc1xuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiBDb3B5cmlnaHQgMjAxMS0yMDE0IFR3aXR0ZXIsIEluYy5cbiAqIExpY2Vuc2VkIHVuZGVyIE1JVCAoaHR0cHM6Ly9naXRodWIuY29tL3R3YnMvYm9vdHN0cmFwL2Jsb2IvbWFzdGVyL0xJQ0VOU0UpXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuXG4rIGZ1bmN0aW9uKCQpIHtcblx0J3VzZSBzdHJpY3QnO1xuXG5cdC8vIE1PREFMIENMQVNTIERFRklOSVRJT05cblx0Ly8gPT09PT09PT09PT09PT09PT09PT09PVxuXG5cdHZhciBNb2RhbCA9IGZ1bmN0aW9uKGVsZW1lbnQsIG9wdGlvbnMpIHtcblx0XHR0aGlzLm9wdGlvbnMgPSBvcHRpb25zXG5cdFx0dGhpcy4kYm9keSA9ICQoZG9jdW1lbnQuYm9keSlcblx0XHR0aGlzLiRlbGVtZW50ID0gJChlbGVtZW50KVxuXHRcdHRoaXMuJGJhY2tkcm9wID1cblx0XHRcdHRoaXMuaXNTaG93biA9IG51bGxcblx0XHR0aGlzLnNjcm9sbGJhcldpZHRoID0gMFxuXG5cdFx0aWYgKHRoaXMub3B0aW9ucy5yZW1vdGUpIHtcblx0XHRcdHRoaXMuJGVsZW1lbnRcblx0XHRcdFx0LmZpbmQoJy5tb2RhbC1jb250ZW50Jylcblx0XHRcdFx0LmxvYWQodGhpcy5vcHRpb25zLnJlbW90ZSwgJC5wcm94eShmdW5jdGlvbigpIHtcblx0XHRcdFx0XHR0aGlzLiRlbGVtZW50LnRyaWdnZXIoJ2xvYWRlZC5icy5tb2RhbCcpXG5cdFx0XHRcdH0sIHRoaXMpKVxuXHRcdH1cblx0fVxuXG5cdE1vZGFsLlZFUlNJT04gPSAnMy4yLjAnXG5cblx0TW9kYWwuREVGQVVMVFMgPSB7XG5cdFx0YmFja2Ryb3A6IHRydWUsXG5cdFx0a2V5Ym9hcmQ6IHRydWUsXG5cdFx0c2hvdzogdHJ1ZVxuXHR9XG5cblx0TW9kYWwucHJvdG90eXBlLnRvZ2dsZSA9IGZ1bmN0aW9uKF9yZWxhdGVkVGFyZ2V0KSB7XG5cdFx0cmV0dXJuIHRoaXMuaXNTaG93biA/IHRoaXMuaGlkZSgpIDogdGhpcy5zaG93KF9yZWxhdGVkVGFyZ2V0KVxuXHR9XG5cblx0TW9kYWwucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbihfcmVsYXRlZFRhcmdldCkge1xuXHRcdHZhciB0aGF0ID0gdGhpc1xuXHRcdHZhciBlID0gJC5FdmVudCgnc2hvdy5icy5tb2RhbCcsIHtcblx0XHRcdHJlbGF0ZWRUYXJnZXQ6IF9yZWxhdGVkVGFyZ2V0XG5cdFx0fSlcblxuXHRcdHRoaXMuJGVsZW1lbnQudHJpZ2dlcihlKVxuXG5cdFx0aWYgKHRoaXMuaXNTaG93biB8fCBlLmlzRGVmYXVsdFByZXZlbnRlZCgpKSByZXR1cm5cblxuXHRcdHRoaXMuaXNTaG93biA9IHRydWVcblxuXHRcdHRoaXMuY2hlY2tTY3JvbGxiYXIoKVxuXHRcdHRoaXMuJGJvZHkuYWRkQ2xhc3MoJ21vZGFsLW9wZW4nKVxuXG5cdFx0dGhpcy5zZXRTY3JvbGxiYXIoKVxuXHRcdHRoaXMuZXNjYXBlKClcblxuXHRcdHRoaXMuJGVsZW1lbnQub24oJ2NsaWNrLmRpc21pc3MuYnMubW9kYWwnLCAnW2RhdGEtZGlzbWlzcz1cIm1vZGFsXCJdJywgJC5wcm94eSh0aGlzLmhpZGUsIHRoaXMpKVxuXG5cdFx0dGhpcy5iYWNrZHJvcChmdW5jdGlvbigpIHtcblx0XHRcdHZhciB0cmFuc2l0aW9uID0gJC5zdXBwb3J0LnRyYW5zaXRpb24gJiYgdGhhdC4kZWxlbWVudC5oYXNDbGFzcygnZmFkZScpXG5cblx0XHRcdGlmICghdGhhdC4kZWxlbWVudC5wYXJlbnQoKS5sZW5ndGgpIHtcblx0XHRcdFx0dGhhdC4kZWxlbWVudC5hcHBlbmRUbyh0aGF0LiRib2R5KSAvLyBkb24ndCBtb3ZlIG1vZGFscyBkb20gcG9zaXRpb25cblx0XHRcdH1cblxuXHRcdFx0dGhhdC4kZWxlbWVudFxuXHRcdFx0XHQuc2hvdygpXG5cdFx0XHRcdC5zY3JvbGxUb3AoMClcblxuXHRcdFx0aWYgKHRyYW5zaXRpb24pIHtcblx0XHRcdFx0dGhhdC4kZWxlbWVudFswXS5vZmZzZXRXaWR0aCAvLyBmb3JjZSByZWZsb3dcblx0XHRcdH1cblxuXHRcdFx0dGhhdC4kZWxlbWVudFxuXHRcdFx0XHQuYWRkQ2xhc3MoJ2luJylcblx0XHRcdFx0LmF0dHIoJ2FyaWEtaGlkZGVuJywgZmFsc2UpXG5cblx0XHRcdHRoYXQuZW5mb3JjZUZvY3VzKClcblxuXHRcdFx0dmFyIGUgPSAkLkV2ZW50KCdzaG93bi5icy5tb2RhbCcsIHtcblx0XHRcdFx0cmVsYXRlZFRhcmdldDogX3JlbGF0ZWRUYXJnZXRcblx0XHRcdH0pXG5cblx0XHRcdHRyYW5zaXRpb24gP1xuXHRcdFx0XHR0aGF0LiRlbGVtZW50LmZpbmQoJy5tb2RhbC1kaWFsb2cnKSAvLyB3YWl0IGZvciBtb2RhbCB0byBzbGlkZSBpblxuXHRcdFx0Lm9uZSgnYnNUcmFuc2l0aW9uRW5kJywgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRoYXQuJGVsZW1lbnQudHJpZ2dlcignZm9jdXMnKS50cmlnZ2VyKGUpXG5cdFx0XHR9KVxuXHRcdFx0XHQuZW11bGF0ZVRyYW5zaXRpb25FbmQoMzAwKSA6XG5cdFx0XHRcdHRoYXQuJGVsZW1lbnQudHJpZ2dlcignZm9jdXMnKS50cmlnZ2VyKGUpXG5cdFx0fSlcblx0fVxuXG5cdE1vZGFsLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24oZSkge1xuXHRcdGlmIChlKSBlLnByZXZlbnREZWZhdWx0KClcblxuXHRcdGUgPSAkLkV2ZW50KCdoaWRlLmJzLm1vZGFsJylcblxuXHRcdHRoaXMuJGVsZW1lbnQudHJpZ2dlcihlKVxuXG5cdFx0aWYgKCF0aGlzLmlzU2hvd24gfHwgZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgcmV0dXJuXG5cblx0XHR0aGlzLmlzU2hvd24gPSBmYWxzZVxuXG5cdFx0dGhpcy4kYm9keS5yZW1vdmVDbGFzcygnbW9kYWwtb3BlbicpXG5cblx0XHR0aGlzLnJlc2V0U2Nyb2xsYmFyKClcblx0XHR0aGlzLmVzY2FwZSgpXG5cblx0XHQkKGRvY3VtZW50KS5vZmYoJ2ZvY3VzaW4uYnMubW9kYWwnKVxuXG5cdFx0dGhpcy4kZWxlbWVudFxuXHRcdFx0LnJlbW92ZUNsYXNzKCdpbicpXG5cdFx0XHQuYXR0cignYXJpYS1oaWRkZW4nLCB0cnVlKVxuXHRcdFx0Lm9mZignY2xpY2suZGlzbWlzcy5icy5tb2RhbCcpXG5cblx0XHQkLnN1cHBvcnQudHJhbnNpdGlvbiAmJiB0aGlzLiRlbGVtZW50Lmhhc0NsYXNzKCdmYWRlJykgP1xuXHRcdFx0dGhpcy4kZWxlbWVudFxuXHRcdFx0Lm9uZSgnYnNUcmFuc2l0aW9uRW5kJywgJC5wcm94eSh0aGlzLmhpZGVNb2RhbCwgdGhpcykpXG5cdFx0XHQuZW11bGF0ZVRyYW5zaXRpb25FbmQoMzAwKSA6XG5cdFx0XHR0aGlzLmhpZGVNb2RhbCgpXG5cdH1cblxuXHRNb2RhbC5wcm90b3R5cGUuZW5mb3JjZUZvY3VzID0gZnVuY3Rpb24oKSB7XG5cdFx0JChkb2N1bWVudClcblx0XHRcdC5vZmYoJ2ZvY3VzaW4uYnMubW9kYWwnKSAvLyBndWFyZCBhZ2FpbnN0IGluZmluaXRlIGZvY3VzIGxvb3Bcblx0XHQub24oJ2ZvY3VzaW4uYnMubW9kYWwnLCAkLnByb3h5KGZ1bmN0aW9uKGUpIHtcblx0XHRcdGlmICh0aGlzLiRlbGVtZW50WzBdICE9PSBlLnRhcmdldCAmJiAhdGhpcy4kZWxlbWVudC5oYXMoZS50YXJnZXQpLmxlbmd0aCkge1xuXHRcdFx0XHR0aGlzLiRlbGVtZW50LnRyaWdnZXIoJ2ZvY3VzJylcblx0XHRcdH1cblx0XHR9LCB0aGlzKSlcblx0fVxuXG5cdE1vZGFsLnByb3RvdHlwZS5lc2NhcGUgPSBmdW5jdGlvbigpIHtcblx0XHRpZiAodGhpcy5pc1Nob3duICYmIHRoaXMub3B0aW9ucy5rZXlib2FyZCkge1xuXHRcdFx0dGhpcy4kZWxlbWVudC5vbigna2V5dXAuZGlzbWlzcy5icy5tb2RhbCcsICQucHJveHkoZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRlLndoaWNoID09IDI3ICYmIHRoaXMuaGlkZSgpXG5cdFx0XHR9LCB0aGlzKSlcblx0XHR9IGVsc2UgaWYgKCF0aGlzLmlzU2hvd24pIHtcblx0XHRcdHRoaXMuJGVsZW1lbnQub2ZmKCdrZXl1cC5kaXNtaXNzLmJzLm1vZGFsJylcblx0XHR9XG5cdH1cblxuXHRNb2RhbC5wcm90b3R5cGUuaGlkZU1vZGFsID0gZnVuY3Rpb24oKSB7XG5cdFx0dmFyIHRoYXQgPSB0aGlzXG5cdFx0dGhpcy4kZWxlbWVudC5oaWRlKClcblx0XHR0aGlzLmJhY2tkcm9wKGZ1bmN0aW9uKCkge1xuXHRcdFx0dGhhdC4kZWxlbWVudC50cmlnZ2VyKCdoaWRkZW4uYnMubW9kYWwnKVxuXHRcdH0pXG5cdH1cblxuXHRNb2RhbC5wcm90b3R5cGUucmVtb3ZlQmFja2Ryb3AgPSBmdW5jdGlvbigpIHtcblx0XHR0aGlzLiRiYWNrZHJvcCAmJiB0aGlzLiRiYWNrZHJvcC5yZW1vdmUoKVxuXHRcdHRoaXMuJGJhY2tkcm9wID0gbnVsbFxuXHR9XG5cblx0TW9kYWwucHJvdG90eXBlLmJhY2tkcm9wID0gZnVuY3Rpb24oY2FsbGJhY2spIHtcblx0XHR2YXIgdGhhdCA9IHRoaXNcblx0XHR2YXIgYW5pbWF0ZSA9IHRoaXMuJGVsZW1lbnQuaGFzQ2xhc3MoJ2ZhZGUnKSA/ICdmYWRlJyA6ICcnXG5cblx0XHRpZiAodGhpcy5pc1Nob3duICYmIHRoaXMub3B0aW9ucy5iYWNrZHJvcCkge1xuXHRcdFx0dmFyIGRvQW5pbWF0ZSA9ICQuc3VwcG9ydC50cmFuc2l0aW9uICYmIGFuaW1hdGVcblxuXHRcdFx0dGhpcy4kYmFja2Ryb3AgPSAkKCc8ZGl2IGNsYXNzPVwibW9kYWwtYmFja2Ryb3AgJyArIGFuaW1hdGUgKyAnXCIgLz4nKVxuXHRcdFx0XHQuYXBwZW5kVG8odGhpcy4kYm9keSlcblxuXHRcdFx0dGhpcy4kZWxlbWVudC5vbignY2xpY2suZGlzbWlzcy5icy5tb2RhbCcsICQucHJveHkoZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRpZiAoZS50YXJnZXQgIT09IGUuY3VycmVudFRhcmdldCkgcmV0dXJuXG5cdFx0XHRcdHRoaXMub3B0aW9ucy5iYWNrZHJvcCA9PSAnc3RhdGljJyA/IHRoaXMuJGVsZW1lbnRbMF0uZm9jdXMuY2FsbCh0aGlzLiRlbGVtZW50WzBdKSA6IHRoaXMuaGlkZS5jYWxsKHRoaXMpXG5cdFx0XHR9LCB0aGlzKSlcblxuXHRcdFx0aWYgKGRvQW5pbWF0ZSkgdGhpcy4kYmFja2Ryb3BbMF0ub2Zmc2V0V2lkdGggLy8gZm9yY2UgcmVmbG93XG5cblx0XHRcdHRoaXMuJGJhY2tkcm9wLmFkZENsYXNzKCdpbicpXG5cblx0XHRcdGlmICghY2FsbGJhY2spIHJldHVyblxuXG5cdFx0XHRkb0FuaW1hdGUgP1xuXHRcdFx0XHR0aGlzLiRiYWNrZHJvcFxuXHRcdFx0XHQub25lKCdic1RyYW5zaXRpb25FbmQnLCBjYWxsYmFjaylcblx0XHRcdFx0LmVtdWxhdGVUcmFuc2l0aW9uRW5kKDE1MCkgOlxuXHRcdFx0XHRjYWxsYmFjaygpXG5cblx0XHR9IGVsc2UgaWYgKCF0aGlzLmlzU2hvd24gJiYgdGhpcy4kYmFja2Ryb3ApIHtcblx0XHRcdHRoaXMuJGJhY2tkcm9wLnJlbW92ZUNsYXNzKCdpbicpXG5cblx0XHRcdHZhciBjYWxsYmFja1JlbW92ZSA9IGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0aGF0LnJlbW92ZUJhY2tkcm9wKClcblx0XHRcdFx0Y2FsbGJhY2sgJiYgY2FsbGJhY2soKVxuXHRcdFx0fVxuXHRcdFx0JC5zdXBwb3J0LnRyYW5zaXRpb24gJiYgdGhpcy4kZWxlbWVudC5oYXNDbGFzcygnZmFkZScpID9cblx0XHRcdFx0dGhpcy4kYmFja2Ryb3Bcblx0XHRcdFx0Lm9uZSgnYnNUcmFuc2l0aW9uRW5kJywgY2FsbGJhY2tSZW1vdmUpXG5cdFx0XHRcdC5lbXVsYXRlVHJhbnNpdGlvbkVuZCgxNTApIDpcblx0XHRcdFx0Y2FsbGJhY2tSZW1vdmUoKVxuXG5cdFx0fSBlbHNlIGlmIChjYWxsYmFjaykge1xuXHRcdFx0Y2FsbGJhY2soKVxuXHRcdH1cblx0fVxuXG5cdE1vZGFsLnByb3RvdHlwZS5jaGVja1Njcm9sbGJhciA9IGZ1bmN0aW9uKCkge1xuXHRcdGlmIChkb2N1bWVudC5ib2R5LmNsaWVudFdpZHRoID49IHdpbmRvdy5pbm5lcldpZHRoKSByZXR1cm5cblx0XHR0aGlzLnNjcm9sbGJhcldpZHRoID0gdGhpcy5zY3JvbGxiYXJXaWR0aCB8fCB0aGlzLm1lYXN1cmVTY3JvbGxiYXIoKVxuXHR9XG5cblx0TW9kYWwucHJvdG90eXBlLnNldFNjcm9sbGJhciA9IGZ1bmN0aW9uKCkge1xuXHRcdHZhciBib2R5UGFkID0gcGFyc2VJbnQoKHRoaXMuJGJvZHkuY3NzKCdwYWRkaW5nLXJpZ2h0JykgfHwgMCksIDEwKVxuXHRcdGlmICh0aGlzLnNjcm9sbGJhcldpZHRoKSB0aGlzLiRib2R5LmNzcygncGFkZGluZy1yaWdodCcsIGJvZHlQYWQgKyB0aGlzLnNjcm9sbGJhcldpZHRoKVxuXHR9XG5cblx0TW9kYWwucHJvdG90eXBlLnJlc2V0U2Nyb2xsYmFyID0gZnVuY3Rpb24oKSB7XG5cdFx0dGhpcy4kYm9keS5jc3MoJ3BhZGRpbmctcmlnaHQnLCAnJylcblx0fVxuXG5cdE1vZGFsLnByb3RvdHlwZS5tZWFzdXJlU2Nyb2xsYmFyID0gZnVuY3Rpb24oKSB7IC8vIHRoeCB3YWxzaFxuXHRcdHZhciBzY3JvbGxEaXYgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKVxuXHRcdHNjcm9sbERpdi5jbGFzc05hbWUgPSAnbW9kYWwtc2Nyb2xsYmFyLW1lYXN1cmUnXG5cdFx0dGhpcy4kYm9keS5hcHBlbmQoc2Nyb2xsRGl2KVxuXHRcdHZhciBzY3JvbGxiYXJXaWR0aCA9IHNjcm9sbERpdi5vZmZzZXRXaWR0aCAtIHNjcm9sbERpdi5jbGllbnRXaWR0aFxuXHRcdHRoaXMuJGJvZHlbMF0ucmVtb3ZlQ2hpbGQoc2Nyb2xsRGl2KVxuXHRcdHJldHVybiBzY3JvbGxiYXJXaWR0aFxuXHR9XG5cblxuXHQvLyBNT0RBTCBQTFVHSU4gREVGSU5JVElPTlxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09PVxuXG5cdGZ1bmN0aW9uIFBsdWdpbihvcHRpb24sIF9yZWxhdGVkVGFyZ2V0KSB7XG5cdFx0cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHtcblx0XHRcdHZhciAkdGhpcyA9ICQodGhpcylcblx0XHRcdHZhciBkYXRhID0gJHRoaXMuZGF0YSgnYnMubW9kYWwnKVxuXHRcdFx0dmFyIG9wdGlvbnMgPSAkLmV4dGVuZCh7fSwgTW9kYWwuREVGQVVMVFMsICR0aGlzLmRhdGEoKSwgdHlwZW9mIG9wdGlvbiA9PSAnb2JqZWN0JyAmJiBvcHRpb24pXG5cblx0XHRcdGlmICghZGF0YSkgJHRoaXMuZGF0YSgnYnMubW9kYWwnLCAoZGF0YSA9IG5ldyBNb2RhbCh0aGlzLCBvcHRpb25zKSkpXG5cdFx0XHRpZiAodHlwZW9mIG9wdGlvbiA9PSAnc3RyaW5nJykgZGF0YVtvcHRpb25dKF9yZWxhdGVkVGFyZ2V0KVxuXHRcdFx0ZWxzZSBpZiAob3B0aW9ucy5zaG93KSBkYXRhLnNob3coX3JlbGF0ZWRUYXJnZXQpXG5cdFx0fSlcblx0fVxuXG5cdHZhciBvbGQgPSAkLmZuLm1vZGFsXG5cblx0JC5mbi5tb2RhbCA9IFBsdWdpblxuXHQkLmZuLm1vZGFsLkNvbnN0cnVjdG9yID0gTW9kYWxcblxuXG5cdC8vIE1PREFMIE5PIENPTkZMSUNUXG5cdC8vID09PT09PT09PT09PT09PT09XG5cblx0JC5mbi5tb2RhbC5ub0NvbmZsaWN0ID0gZnVuY3Rpb24oKSB7XG5cdFx0JC5mbi5tb2RhbCA9IG9sZFxuXHRcdHJldHVybiB0aGlzXG5cdH1cblxuXG5cdC8vIE1PREFMIERBVEEtQVBJXG5cdC8vID09PT09PT09PT09PT09XG5cblx0JChkb2N1bWVudCkub24oJ2NsaWNrLmJzLm1vZGFsLmRhdGEtYXBpJywgJ1tkYXRhLXRvZ2dsZT1cIm1vZGFsXCJdJywgZnVuY3Rpb24oZSkge1xuXHRcdHZhciAkdGhpcyA9ICQodGhpcylcblx0XHR2YXIgaHJlZiA9ICR0aGlzLmF0dHIoJ2hyZWYnKVxuXHRcdHZhciAkdGFyZ2V0ID0gJCgkdGhpcy5hdHRyKCdkYXRhLXRhcmdldCcpIHx8IChocmVmICYmIGhyZWYucmVwbGFjZSgvLiooPz0jW15cXHNdKyQpLywgJycpKSkgLy8gc3RyaXAgZm9yIGllN1xuXHRcdHZhciBvcHRpb24gPSAkdGFyZ2V0LmRhdGEoJ2JzLm1vZGFsJykgPyAndG9nZ2xlJyA6ICQuZXh0ZW5kKHtcblx0XHRcdHJlbW90ZTogIS8jLy50ZXN0KGhyZWYpICYmIGhyZWZcblx0XHR9LCAkdGFyZ2V0LmRhdGEoKSwgJHRoaXMuZGF0YSgpKVxuXG5cdFx0aWYgKCR0aGlzLmlzKCdhJykpIGUucHJldmVudERlZmF1bHQoKVxuXG5cdFx0JHRhcmdldC5vbmUoJ3Nob3cuYnMubW9kYWwnLCBmdW5jdGlvbihzaG93RXZlbnQpIHtcblx0XHRcdGlmIChzaG93RXZlbnQuaXNEZWZhdWx0UHJldmVudGVkKCkpIHJldHVybiAvLyBvbmx5IHJlZ2lzdGVyIGZvY3VzIHJlc3RvcmVyIGlmIG1vZGFsIHdpbGwgYWN0dWFsbHkgZ2V0IHNob3duXG5cdFx0XHQkdGFyZ2V0Lm9uZSgnaGlkZGVuLmJzLm1vZGFsJywgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdCR0aGlzLmlzKCc6dmlzaWJsZScpICYmICR0aGlzLnRyaWdnZXIoJ2ZvY3VzJylcblx0XHRcdH0pXG5cdFx0fSlcblx0XHRQbHVnaW4uY2FsbCgkdGFyZ2V0LCBvcHRpb24sIHRoaXMpXG5cdH0pXG5cbn0oalF1ZXJ5KTtcblxuLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiBCb290c3RyYXA6IHRvb2x0aXAuanMgdjMuMi4wXG4gKiBodHRwOi8vZ2V0Ym9vdHN0cmFwLmNvbS9qYXZhc2NyaXB0LyN0b29sdGlwXG4gKiBJbnNwaXJlZCBieSB0aGUgb3JpZ2luYWwgalF1ZXJ5LnRpcHN5IGJ5IEphc29uIEZyYW1lXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbiAqIENvcHlyaWdodCAyMDExLTIwMTQgVHdpdHRlciwgSW5jLlxuICogTGljZW5zZWQgdW5kZXIgTUlUIChodHRwczovL2dpdGh1Yi5jb20vdHdicy9ib290c3RyYXAvYmxvYi9tYXN0ZXIvTElDRU5TRSlcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSAqL1xuXG5cbisgZnVuY3Rpb24oJCkge1xuXHQndXNlIHN0cmljdCc7XG5cblx0Ly8gVE9PTFRJUCBQVUJMSUMgQ0xBU1MgREVGSU5JVElPTlxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cblx0dmFyIFRvb2x0aXAgPSBmdW5jdGlvbihlbGVtZW50LCBvcHRpb25zKSB7XG5cdFx0dGhpcy50eXBlID1cblx0XHRcdHRoaXMub3B0aW9ucyA9XG5cdFx0XHR0aGlzLmVuYWJsZWQgPVxuXHRcdFx0dGhpcy50aW1lb3V0ID1cblx0XHRcdHRoaXMuaG92ZXJTdGF0ZSA9XG5cdFx0XHR0aGlzLiRlbGVtZW50ID0gbnVsbFxuXG5cdFx0dGhpcy5pbml0KCd0b29sdGlwJywgZWxlbWVudCwgb3B0aW9ucylcblx0fVxuXG5cdFRvb2x0aXAuVkVSU0lPTiA9ICczLjIuMCdcblxuXHRUb29sdGlwLkRFRkFVTFRTID0ge1xuXHRcdGFuaW1hdGlvbjogdHJ1ZSxcblx0XHRwbGFjZW1lbnQ6ICd0b3AnLFxuXHRcdHNlbGVjdG9yOiBmYWxzZSxcblx0XHR0ZW1wbGF0ZTogJzxkaXYgY2xhc3M9XCJ0b29sdGlwXCIgcm9sZT1cInRvb2x0aXBcIj48ZGl2IGNsYXNzPVwidG9vbHRpcC1hcnJvd1wiPjwvZGl2PjxkaXYgY2xhc3M9XCJ0b29sdGlwLWlubmVyXCI+PC9kaXY+PC9kaXY+Jyxcblx0XHR0cmlnZ2VyOiAnaG92ZXIgZm9jdXMnLFxuXHRcdHRpdGxlOiAnJyxcblx0XHRkZWxheTogMCxcblx0XHRodG1sOiBmYWxzZSxcblx0XHRjb250YWluZXI6IGZhbHNlLFxuXHRcdHZpZXdwb3J0OiB7XG5cdFx0XHRzZWxlY3RvcjogJ2JvZHknLFxuXHRcdFx0cGFkZGluZzogMFxuXHRcdH1cblx0fVxuXG5cdFRvb2x0aXAucHJvdG90eXBlLmluaXQgPSBmdW5jdGlvbih0eXBlLCBlbGVtZW50LCBvcHRpb25zKSB7XG5cdFx0dGhpcy5lbmFibGVkID0gdHJ1ZVxuXHRcdHRoaXMudHlwZSA9IHR5cGVcblx0XHR0aGlzLiRlbGVtZW50ID0gJChlbGVtZW50KVxuXHRcdHRoaXMub3B0aW9ucyA9IHRoaXMuZ2V0T3B0aW9ucyhvcHRpb25zKVxuXHRcdHRoaXMuJHZpZXdwb3J0ID0gdGhpcy5vcHRpb25zLnZpZXdwb3J0ICYmICQodGhpcy5vcHRpb25zLnZpZXdwb3J0LnNlbGVjdG9yIHx8IHRoaXMub3B0aW9ucy52aWV3cG9ydClcblxuXHRcdHZhciB0cmlnZ2VycyA9IHRoaXMub3B0aW9ucy50cmlnZ2VyLnNwbGl0KCcgJylcblxuXHRcdGZvciAodmFyIGkgPSB0cmlnZ2Vycy5sZW5ndGg7IGktLTspIHtcblx0XHRcdHZhciB0cmlnZ2VyID0gdHJpZ2dlcnNbaV1cblxuXHRcdFx0aWYgKHRyaWdnZXIgPT0gJ2NsaWNrJykge1xuXHRcdFx0XHR0aGlzLiRlbGVtZW50Lm9uKCdjbGljay4nICsgdGhpcy50eXBlLCB0aGlzLm9wdGlvbnMuc2VsZWN0b3IsICQucHJveHkodGhpcy50b2dnbGUsIHRoaXMpKVxuXHRcdFx0fSBlbHNlIGlmICh0cmlnZ2VyICE9ICdtYW51YWwnKSB7XG5cdFx0XHRcdHZhciBldmVudEluID0gdHJpZ2dlciA9PSAnaG92ZXInID8gJ21vdXNlZW50ZXInIDogJ2ZvY3VzaW4nXG5cdFx0XHRcdHZhciBldmVudE91dCA9IHRyaWdnZXIgPT0gJ2hvdmVyJyA/ICdtb3VzZWxlYXZlJyA6ICdmb2N1c291dCdcblxuXHRcdFx0XHR0aGlzLiRlbGVtZW50Lm9uKGV2ZW50SW4gKyAnLicgKyB0aGlzLnR5cGUsIHRoaXMub3B0aW9ucy5zZWxlY3RvciwgJC5wcm94eSh0aGlzLmVudGVyLCB0aGlzKSlcblx0XHRcdFx0dGhpcy4kZWxlbWVudC5vbihldmVudE91dCArICcuJyArIHRoaXMudHlwZSwgdGhpcy5vcHRpb25zLnNlbGVjdG9yLCAkLnByb3h5KHRoaXMubGVhdmUsIHRoaXMpKVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHRoaXMub3B0aW9ucy5zZWxlY3RvciA/XG5cdFx0XHQodGhpcy5fb3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCB0aGlzLm9wdGlvbnMsIHtcblx0XHRcdHRyaWdnZXI6ICdtYW51YWwnLFxuXHRcdFx0c2VsZWN0b3I6ICcnXG5cdFx0fSkpIDpcblx0XHRcdHRoaXMuZml4VGl0bGUoKVxuXHR9XG5cblx0VG9vbHRpcC5wcm90b3R5cGUuZ2V0RGVmYXVsdHMgPSBmdW5jdGlvbigpIHtcblx0XHRyZXR1cm4gVG9vbHRpcC5ERUZBVUxUU1xuXHR9XG5cblx0VG9vbHRpcC5wcm90b3R5cGUuZ2V0T3B0aW9ucyA9IGZ1bmN0aW9uKG9wdGlvbnMpIHtcblx0XHRvcHRpb25zID0gJC5leHRlbmQoe30sIHRoaXMuZ2V0RGVmYXVsdHMoKSwgdGhpcy4kZWxlbWVudC5kYXRhKCksIG9wdGlvbnMpXG5cblx0XHRpZiAob3B0aW9ucy5kZWxheSAmJiB0eXBlb2Ygb3B0aW9ucy5kZWxheSA9PSAnbnVtYmVyJykge1xuXHRcdFx0b3B0aW9ucy5kZWxheSA9IHtcblx0XHRcdFx0c2hvdzogb3B0aW9ucy5kZWxheSxcblx0XHRcdFx0aGlkZTogb3B0aW9ucy5kZWxheVxuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBvcHRpb25zXG5cdH1cblxuXHRUb29sdGlwLnByb3RvdHlwZS5nZXREZWxlZ2F0ZU9wdGlvbnMgPSBmdW5jdGlvbigpIHtcblx0XHR2YXIgb3B0aW9ucyA9IHt9XG5cdFx0dmFyIGRlZmF1bHRzID0gdGhpcy5nZXREZWZhdWx0cygpXG5cblx0XHR0aGlzLl9vcHRpb25zICYmICQuZWFjaCh0aGlzLl9vcHRpb25zLCBmdW5jdGlvbihrZXksIHZhbHVlKSB7XG5cdFx0XHRpZiAoZGVmYXVsdHNba2V5XSAhPSB2YWx1ZSkgb3B0aW9uc1trZXldID0gdmFsdWVcblx0XHR9KVxuXG5cdFx0cmV0dXJuIG9wdGlvbnNcblx0fVxuXG5cdFRvb2x0aXAucHJvdG90eXBlLmVudGVyID0gZnVuY3Rpb24ob2JqKSB7XG5cdFx0dmFyIHNlbGYgPSBvYmogaW5zdGFuY2VvZiB0aGlzLmNvbnN0cnVjdG9yID9cblx0XHRcdG9iaiA6ICQob2JqLmN1cnJlbnRUYXJnZXQpLmRhdGEoJ2JzLicgKyB0aGlzLnR5cGUpXG5cblx0XHRpZiAoIXNlbGYpIHtcblx0XHRcdHNlbGYgPSBuZXcgdGhpcy5jb25zdHJ1Y3RvcihvYmouY3VycmVudFRhcmdldCwgdGhpcy5nZXREZWxlZ2F0ZU9wdGlvbnMoKSlcblx0XHRcdCQob2JqLmN1cnJlbnRUYXJnZXQpLmRhdGEoJ2JzLicgKyB0aGlzLnR5cGUsIHNlbGYpXG5cdFx0fVxuXG5cdFx0Y2xlYXJUaW1lb3V0KHNlbGYudGltZW91dClcblxuXHRcdHNlbGYuaG92ZXJTdGF0ZSA9ICdpbidcblxuXHRcdGlmICghc2VsZi5vcHRpb25zLmRlbGF5IHx8ICFzZWxmLm9wdGlvbnMuZGVsYXkuc2hvdykgcmV0dXJuIHNlbGYuc2hvdygpXG5cblx0XHRzZWxmLnRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuXHRcdFx0aWYgKHNlbGYuaG92ZXJTdGF0ZSA9PSAnaW4nKSBzZWxmLnNob3coKVxuXHRcdH0sIHNlbGYub3B0aW9ucy5kZWxheS5zaG93KVxuXHR9XG5cblx0VG9vbHRpcC5wcm90b3R5cGUubGVhdmUgPSBmdW5jdGlvbihvYmopIHtcblx0XHR2YXIgc2VsZiA9IG9iaiBpbnN0YW5jZW9mIHRoaXMuY29uc3RydWN0b3IgP1xuXHRcdFx0b2JqIDogJChvYmouY3VycmVudFRhcmdldCkuZGF0YSgnYnMuJyArIHRoaXMudHlwZSlcblxuXHRcdGlmICghc2VsZikge1xuXHRcdFx0c2VsZiA9IG5ldyB0aGlzLmNvbnN0cnVjdG9yKG9iai5jdXJyZW50VGFyZ2V0LCB0aGlzLmdldERlbGVnYXRlT3B0aW9ucygpKVxuXHRcdFx0JChvYmouY3VycmVudFRhcmdldCkuZGF0YSgnYnMuJyArIHRoaXMudHlwZSwgc2VsZilcblx0XHR9XG5cblx0XHRjbGVhclRpbWVvdXQoc2VsZi50aW1lb3V0KVxuXG5cdFx0c2VsZi5ob3ZlclN0YXRlID0gJ291dCdcblxuXHRcdGlmICghc2VsZi5vcHRpb25zLmRlbGF5IHx8ICFzZWxmLm9wdGlvbnMuZGVsYXkuaGlkZSkgcmV0dXJuIHNlbGYuaGlkZSgpXG5cblx0XHRzZWxmLnRpbWVvdXQgPSBzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuXHRcdFx0aWYgKHNlbGYuaG92ZXJTdGF0ZSA9PSAnb3V0Jykgc2VsZi5oaWRlKClcblx0XHR9LCBzZWxmLm9wdGlvbnMuZGVsYXkuaGlkZSlcblx0fVxuXG5cdFRvb2x0aXAucHJvdG90eXBlLnNob3cgPSBmdW5jdGlvbigpIHtcblx0XHR2YXIgZSA9ICQuRXZlbnQoJ3Nob3cuYnMuJyArIHRoaXMudHlwZSlcblxuXHRcdGlmICh0aGlzLmhhc0NvbnRlbnQoKSAmJiB0aGlzLmVuYWJsZWQpIHtcblx0XHRcdHRoaXMuJGVsZW1lbnQudHJpZ2dlcihlKVxuXG5cdFx0XHR2YXIgaW5Eb20gPSAkLmNvbnRhaW5zKGRvY3VtZW50LmRvY3VtZW50RWxlbWVudCwgdGhpcy4kZWxlbWVudFswXSlcblx0XHRcdGlmIChlLmlzRGVmYXVsdFByZXZlbnRlZCgpIHx8ICFpbkRvbSkgcmV0dXJuXG5cdFx0XHR2YXIgdGhhdCA9IHRoaXNcblxuXHRcdFx0dmFyICR0aXAgPSB0aGlzLnRpcCgpXG5cblx0XHRcdHZhciB0aXBJZCA9IHRoaXMuZ2V0VUlEKHRoaXMudHlwZSlcblxuXHRcdFx0dGhpcy5zZXRDb250ZW50KClcblx0XHRcdCR0aXAuYXR0cignaWQnLCB0aXBJZClcblx0XHRcdHRoaXMuJGVsZW1lbnQuYXR0cignYXJpYS1kZXNjcmliZWRieScsIHRpcElkKVxuXG5cdFx0XHRpZiAodGhpcy5vcHRpb25zLmFuaW1hdGlvbikgJHRpcC5hZGRDbGFzcygnZmFkZScpXG5cblx0XHRcdHZhciBwbGFjZW1lbnQgPSB0eXBlb2YgdGhpcy5vcHRpb25zLnBsYWNlbWVudCA9PSAnZnVuY3Rpb24nID9cblx0XHRcdFx0dGhpcy5vcHRpb25zLnBsYWNlbWVudC5jYWxsKHRoaXMsICR0aXBbMF0sIHRoaXMuJGVsZW1lbnRbMF0pIDpcblx0XHRcdFx0dGhpcy5vcHRpb25zLnBsYWNlbWVudFxuXG5cdFx0XHR2YXIgYXV0b1Rva2VuID0gL1xccz9hdXRvP1xccz8vaVxuXHRcdFx0dmFyIGF1dG9QbGFjZSA9IGF1dG9Ub2tlbi50ZXN0KHBsYWNlbWVudClcblx0XHRcdGlmIChhdXRvUGxhY2UpIHBsYWNlbWVudCA9IHBsYWNlbWVudC5yZXBsYWNlKGF1dG9Ub2tlbiwgJycpIHx8ICd0b3AnXG5cblx0XHRcdCR0aXBcblx0XHRcdFx0LmRldGFjaCgpXG5cdFx0XHRcdC5jc3Moe1xuXHRcdFx0XHRcdHRvcDogMCxcblx0XHRcdFx0XHRsZWZ0OiAwLFxuXHRcdFx0XHRcdGRpc3BsYXk6ICdibG9jaydcblx0XHRcdFx0fSlcblx0XHRcdFx0LmFkZENsYXNzKHBsYWNlbWVudClcblx0XHRcdFx0LmRhdGEoJ2JzLicgKyB0aGlzLnR5cGUsIHRoaXMpXG5cblx0XHRcdHRoaXMub3B0aW9ucy5jb250YWluZXIgPyAkdGlwLmFwcGVuZFRvKHRoaXMub3B0aW9ucy5jb250YWluZXIpIDogJHRpcC5pbnNlcnRBZnRlcih0aGlzLiRlbGVtZW50KVxuXG5cdFx0XHR2YXIgcG9zID0gdGhpcy5nZXRQb3NpdGlvbigpXG5cdFx0XHR2YXIgYWN0dWFsV2lkdGggPSAkdGlwWzBdLm9mZnNldFdpZHRoXG5cdFx0XHR2YXIgYWN0dWFsSGVpZ2h0ID0gJHRpcFswXS5vZmZzZXRIZWlnaHRcblxuXHRcdFx0aWYgKGF1dG9QbGFjZSkge1xuXHRcdFx0XHR2YXIgb3JnUGxhY2VtZW50ID0gcGxhY2VtZW50XG5cdFx0XHRcdHZhciAkcGFyZW50ID0gdGhpcy4kZWxlbWVudC5wYXJlbnQoKVxuXHRcdFx0XHR2YXIgcGFyZW50RGltID0gdGhpcy5nZXRQb3NpdGlvbigkcGFyZW50KVxuXG5cdFx0XHRcdHBsYWNlbWVudCA9IHBsYWNlbWVudCA9PSAnYm90dG9tJyAmJiBwb3MudG9wICsgcG9zLmhlaWdodCArIGFjdHVhbEhlaWdodCAtIHBhcmVudERpbS5zY3JvbGwgPiBwYXJlbnREaW0uaGVpZ2h0ID8gJ3RvcCcgOlxuXHRcdFx0XHRcdHBsYWNlbWVudCA9PSAndG9wJyAmJiBwb3MudG9wIC0gcGFyZW50RGltLnNjcm9sbCAtIGFjdHVhbEhlaWdodCA8IDAgPyAnYm90dG9tJyA6XG5cdFx0XHRcdFx0cGxhY2VtZW50ID09ICdyaWdodCcgJiYgcG9zLnJpZ2h0ICsgYWN0dWFsV2lkdGggPiBwYXJlbnREaW0ud2lkdGggPyAnbGVmdCcgOlxuXHRcdFx0XHRcdHBsYWNlbWVudCA9PSAnbGVmdCcgJiYgcG9zLmxlZnQgLSBhY3R1YWxXaWR0aCA8IHBhcmVudERpbS5sZWZ0ID8gJ3JpZ2h0JyA6XG5cdFx0XHRcdFx0cGxhY2VtZW50XG5cblx0XHRcdFx0JHRpcFxuXHRcdFx0XHRcdC5yZW1vdmVDbGFzcyhvcmdQbGFjZW1lbnQpXG5cdFx0XHRcdFx0LmFkZENsYXNzKHBsYWNlbWVudClcblx0XHRcdH1cblxuXHRcdFx0dmFyIGNhbGN1bGF0ZWRPZmZzZXQgPSB0aGlzLmdldENhbGN1bGF0ZWRPZmZzZXQocGxhY2VtZW50LCBwb3MsIGFjdHVhbFdpZHRoLCBhY3R1YWxIZWlnaHQpXG5cblx0XHRcdHRoaXMuYXBwbHlQbGFjZW1lbnQoY2FsY3VsYXRlZE9mZnNldCwgcGxhY2VtZW50KVxuXG5cdFx0XHR2YXIgY29tcGxldGUgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0dGhhdC4kZWxlbWVudC50cmlnZ2VyKCdzaG93bi5icy4nICsgdGhhdC50eXBlKVxuXHRcdFx0XHR0aGF0LmhvdmVyU3RhdGUgPSBudWxsXG5cdFx0XHR9XG5cblx0XHRcdCQuc3VwcG9ydC50cmFuc2l0aW9uICYmIHRoaXMuJHRpcC5oYXNDbGFzcygnZmFkZScpID9cblx0XHRcdFx0JHRpcFxuXHRcdFx0XHQub25lKCdic1RyYW5zaXRpb25FbmQnLCBjb21wbGV0ZSlcblx0XHRcdFx0LmVtdWxhdGVUcmFuc2l0aW9uRW5kKDE1MCkgOlxuXHRcdFx0XHRjb21wbGV0ZSgpXG5cdFx0fVxuXHR9XG5cblx0VG9vbHRpcC5wcm90b3R5cGUuYXBwbHlQbGFjZW1lbnQgPSBmdW5jdGlvbihvZmZzZXQsIHBsYWNlbWVudCkge1xuXHRcdHZhciAkdGlwID0gdGhpcy50aXAoKVxuXHRcdHZhciB3aWR0aCA9ICR0aXBbMF0ub2Zmc2V0V2lkdGhcblx0XHR2YXIgaGVpZ2h0ID0gJHRpcFswXS5vZmZzZXRIZWlnaHRcblxuXHRcdC8vIG1hbnVhbGx5IHJlYWQgbWFyZ2lucyBiZWNhdXNlIGdldEJvdW5kaW5nQ2xpZW50UmVjdCBpbmNsdWRlcyBkaWZmZXJlbmNlXG5cdFx0dmFyIG1hcmdpblRvcCA9IHBhcnNlSW50KCR0aXAuY3NzKCdtYXJnaW4tdG9wJyksIDEwKVxuXHRcdHZhciBtYXJnaW5MZWZ0ID0gcGFyc2VJbnQoJHRpcC5jc3MoJ21hcmdpbi1sZWZ0JyksIDEwKVxuXG5cdFx0Ly8gd2UgbXVzdCBjaGVjayBmb3IgTmFOIGZvciBpZSA4Lzlcblx0XHRpZiAoaXNOYU4obWFyZ2luVG9wKSkgbWFyZ2luVG9wID0gMFxuXHRcdGlmIChpc05hTihtYXJnaW5MZWZ0KSkgbWFyZ2luTGVmdCA9IDBcblxuXHRcdG9mZnNldC50b3AgPSBvZmZzZXQudG9wICsgbWFyZ2luVG9wXG5cdFx0b2Zmc2V0LmxlZnQgPSBvZmZzZXQubGVmdCArIG1hcmdpbkxlZnRcblxuXHRcdC8vICQuZm4ub2Zmc2V0IGRvZXNuJ3Qgcm91bmQgcGl4ZWwgdmFsdWVzXG5cdFx0Ly8gc28gd2UgdXNlIHNldE9mZnNldCBkaXJlY3RseSB3aXRoIG91ciBvd24gZnVuY3Rpb24gQi0wXG5cdFx0JC5vZmZzZXQuc2V0T2Zmc2V0KCR0aXBbMF0sICQuZXh0ZW5kKHtcblx0XHRcdHVzaW5nOiBmdW5jdGlvbihwcm9wcykge1xuXHRcdFx0XHQkdGlwLmNzcyh7XG5cdFx0XHRcdFx0dG9wOiBNYXRoLnJvdW5kKHByb3BzLnRvcCksXG5cdFx0XHRcdFx0bGVmdDogTWF0aC5yb3VuZChwcm9wcy5sZWZ0KVxuXHRcdFx0XHR9KVxuXHRcdFx0fVxuXHRcdH0sIG9mZnNldCksIDApXG5cblx0XHQkdGlwLmFkZENsYXNzKCdpbicpXG5cblx0XHQvLyBjaGVjayB0byBzZWUgaWYgcGxhY2luZyB0aXAgaW4gbmV3IG9mZnNldCBjYXVzZWQgdGhlIHRpcCB0byByZXNpemUgaXRzZWxmXG5cdFx0dmFyIGFjdHVhbFdpZHRoID0gJHRpcFswXS5vZmZzZXRXaWR0aFxuXHRcdHZhciBhY3R1YWxIZWlnaHQgPSAkdGlwWzBdLm9mZnNldEhlaWdodFxuXG5cdFx0aWYgKHBsYWNlbWVudCA9PSAndG9wJyAmJiBhY3R1YWxIZWlnaHQgIT0gaGVpZ2h0KSB7XG5cdFx0XHRvZmZzZXQudG9wID0gb2Zmc2V0LnRvcCArIGhlaWdodCAtIGFjdHVhbEhlaWdodFxuXHRcdH1cblxuXHRcdHZhciBkZWx0YSA9IHRoaXMuZ2V0Vmlld3BvcnRBZGp1c3RlZERlbHRhKHBsYWNlbWVudCwgb2Zmc2V0LCBhY3R1YWxXaWR0aCwgYWN0dWFsSGVpZ2h0KVxuXG5cdFx0aWYgKGRlbHRhLmxlZnQpIG9mZnNldC5sZWZ0ICs9IGRlbHRhLmxlZnRcblx0XHRlbHNlIG9mZnNldC50b3AgKz0gZGVsdGEudG9wXG5cblx0XHR2YXIgYXJyb3dEZWx0YSA9IGRlbHRhLmxlZnQgPyBkZWx0YS5sZWZ0ICogMiAtIHdpZHRoICsgYWN0dWFsV2lkdGggOiBkZWx0YS50b3AgKiAyIC0gaGVpZ2h0ICsgYWN0dWFsSGVpZ2h0XG5cdFx0dmFyIGFycm93UG9zaXRpb24gPSBkZWx0YS5sZWZ0ID8gJ2xlZnQnIDogJ3RvcCdcblx0XHR2YXIgYXJyb3dPZmZzZXRQb3NpdGlvbiA9IGRlbHRhLmxlZnQgPyAnb2Zmc2V0V2lkdGgnIDogJ29mZnNldEhlaWdodCdcblxuXHRcdCR0aXAub2Zmc2V0KG9mZnNldClcblx0XHR0aGlzLnJlcGxhY2VBcnJvdyhhcnJvd0RlbHRhLCAkdGlwWzBdW2Fycm93T2Zmc2V0UG9zaXRpb25dLCBhcnJvd1Bvc2l0aW9uKVxuXHR9XG5cblx0VG9vbHRpcC5wcm90b3R5cGUucmVwbGFjZUFycm93ID0gZnVuY3Rpb24oZGVsdGEsIGRpbWVuc2lvbiwgcG9zaXRpb24pIHtcblx0XHR0aGlzLmFycm93KCkuY3NzKHBvc2l0aW9uLCBkZWx0YSA/ICg1MCAqICgxIC0gZGVsdGEgLyBkaW1lbnNpb24pICsgJyUnKSA6ICcnKVxuXHR9XG5cblx0VG9vbHRpcC5wcm90b3R5cGUuc2V0Q29udGVudCA9IGZ1bmN0aW9uKCkge1xuXHRcdHZhciAkdGlwID0gdGhpcy50aXAoKVxuXHRcdHZhciB0aXRsZSA9IHRoaXMuZ2V0VGl0bGUoKVxuXG5cdFx0JHRpcC5maW5kKCcudG9vbHRpcC1pbm5lcicpW3RoaXMub3B0aW9ucy5odG1sID8gJ2h0bWwnIDogJ3RleHQnXSh0aXRsZSlcblx0XHQkdGlwLnJlbW92ZUNsYXNzKCdmYWRlIGluIHRvcCBib3R0b20gbGVmdCByaWdodCcpXG5cdH1cblxuXHRUb29sdGlwLnByb3RvdHlwZS5oaWRlID0gZnVuY3Rpb24oKSB7XG5cdFx0dmFyIHRoYXQgPSB0aGlzXG5cdFx0dmFyICR0aXAgPSB0aGlzLnRpcCgpXG5cdFx0dmFyIGUgPSAkLkV2ZW50KCdoaWRlLmJzLicgKyB0aGlzLnR5cGUpXG5cblx0XHR0aGlzLiRlbGVtZW50LnJlbW92ZUF0dHIoJ2FyaWEtZGVzY3JpYmVkYnknKVxuXG5cdFx0ZnVuY3Rpb24gY29tcGxldGUoKSB7XG5cdFx0XHRpZiAodGhhdC5ob3ZlclN0YXRlICE9ICdpbicpICR0aXAuZGV0YWNoKClcblx0XHRcdHRoYXQuJGVsZW1lbnQudHJpZ2dlcignaGlkZGVuLmJzLicgKyB0aGF0LnR5cGUpXG5cdFx0fVxuXG5cdFx0dGhpcy4kZWxlbWVudC50cmlnZ2VyKGUpXG5cblx0XHRpZiAoZS5pc0RlZmF1bHRQcmV2ZW50ZWQoKSkgcmV0dXJuXG5cblx0XHQkdGlwLnJlbW92ZUNsYXNzKCdpbicpXG5cblx0XHQkLnN1cHBvcnQudHJhbnNpdGlvbiAmJiB0aGlzLiR0aXAuaGFzQ2xhc3MoJ2ZhZGUnKSA/XG5cdFx0XHQkdGlwXG5cdFx0XHQub25lKCdic1RyYW5zaXRpb25FbmQnLCBjb21wbGV0ZSlcblx0XHRcdC5lbXVsYXRlVHJhbnNpdGlvbkVuZCgxNTApIDpcblx0XHRcdGNvbXBsZXRlKClcblxuXHRcdHRoaXMuaG92ZXJTdGF0ZSA9IG51bGxcblxuXHRcdHJldHVybiB0aGlzXG5cdH1cblxuXHRUb29sdGlwLnByb3RvdHlwZS5maXhUaXRsZSA9IGZ1bmN0aW9uKCkge1xuXHRcdHZhciAkZSA9IHRoaXMuJGVsZW1lbnRcblx0XHRpZiAoJGUuYXR0cigndGl0bGUnKSB8fCB0eXBlb2YoJGUuYXR0cignZGF0YS1vcmlnaW5hbC10aXRsZScpKSAhPSAnc3RyaW5nJykge1xuXHRcdFx0JGUuYXR0cignZGF0YS1vcmlnaW5hbC10aXRsZScsICRlLmF0dHIoJ3RpdGxlJykgfHwgJycpLmF0dHIoJ3RpdGxlJywgJycpXG5cdFx0fVxuXHR9XG5cblx0VG9vbHRpcC5wcm90b3R5cGUuaGFzQ29udGVudCA9IGZ1bmN0aW9uKCkge1xuXHRcdHJldHVybiB0aGlzLmdldFRpdGxlKClcblx0fVxuXG5cdFRvb2x0aXAucHJvdG90eXBlLmdldFBvc2l0aW9uID0gZnVuY3Rpb24oJGVsZW1lbnQpIHtcblx0XHQkZWxlbWVudCA9ICRlbGVtZW50IHx8IHRoaXMuJGVsZW1lbnRcblx0XHR2YXIgZWwgPSAkZWxlbWVudFswXVxuXHRcdHZhciBpc0JvZHkgPSBlbC50YWdOYW1lID09ICdCT0RZJ1xuXHRcdHJldHVybiAkLmV4dGVuZCh7fSwgKHR5cGVvZiBlbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QgPT0gJ2Z1bmN0aW9uJykgPyBlbC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKSA6IG51bGwsIHtcblx0XHRcdHNjcm9sbDogaXNCb2R5ID8gZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LnNjcm9sbFRvcCB8fCBkb2N1bWVudC5ib2R5LnNjcm9sbFRvcCA6ICRlbGVtZW50LnNjcm9sbFRvcCgpLFxuXHRcdFx0d2lkdGg6IGlzQm9keSA/ICQod2luZG93KS53aWR0aCgpIDogJGVsZW1lbnQub3V0ZXJXaWR0aCgpLFxuXHRcdFx0aGVpZ2h0OiBpc0JvZHkgPyAkKHdpbmRvdykuaGVpZ2h0KCkgOiAkZWxlbWVudC5vdXRlckhlaWdodCgpXG5cdFx0fSwgaXNCb2R5ID8ge1xuXHRcdFx0dG9wOiAwLFxuXHRcdFx0bGVmdDogMFxuXHRcdH0gOiAkZWxlbWVudC5vZmZzZXQoKSlcblx0fVxuXG5cdFRvb2x0aXAucHJvdG90eXBlLmdldENhbGN1bGF0ZWRPZmZzZXQgPSBmdW5jdGlvbihwbGFjZW1lbnQsIHBvcywgYWN0dWFsV2lkdGgsIGFjdHVhbEhlaWdodCkge1xuXHRcdHJldHVybiBwbGFjZW1lbnQgPT0gJ2JvdHRvbScgPyB7XG5cdFx0XHRcdHRvcDogcG9zLnRvcCArIHBvcy5oZWlnaHQsXG5cdFx0XHRcdGxlZnQ6IHBvcy5sZWZ0ICsgcG9zLndpZHRoIC8gMiAtIGFjdHVhbFdpZHRoIC8gMlxuXHRcdFx0fSA6XG5cdFx0XHRwbGFjZW1lbnQgPT0gJ3RvcCcgPyB7XG5cdFx0XHRcdHRvcDogcG9zLnRvcCAtIGFjdHVhbEhlaWdodCxcblx0XHRcdFx0bGVmdDogcG9zLmxlZnQgKyBwb3Mud2lkdGggLyAyIC0gYWN0dWFsV2lkdGggLyAyXG5cdFx0XHR9IDpcblx0XHRcdHBsYWNlbWVudCA9PSAnbGVmdCcgPyB7XG5cdFx0XHRcdHRvcDogcG9zLnRvcCArIHBvcy5oZWlnaHQgLyAyIC0gYWN0dWFsSGVpZ2h0IC8gMixcblx0XHRcdFx0bGVmdDogcG9zLmxlZnQgLSBhY3R1YWxXaWR0aFxuXHRcdFx0fSA6XG5cdFx0XHQvKiBwbGFjZW1lbnQgPT0gJ3JpZ2h0JyAqL1xuXHRcdFx0e1xuXHRcdFx0XHR0b3A6IHBvcy50b3AgKyBwb3MuaGVpZ2h0IC8gMiAtIGFjdHVhbEhlaWdodCAvIDIsXG5cdFx0XHRcdGxlZnQ6IHBvcy5sZWZ0ICsgcG9zLndpZHRoXG5cdFx0XHR9XG5cblx0fVxuXG5cdFRvb2x0aXAucHJvdG90eXBlLmdldFZpZXdwb3J0QWRqdXN0ZWREZWx0YSA9IGZ1bmN0aW9uKHBsYWNlbWVudCwgcG9zLCBhY3R1YWxXaWR0aCwgYWN0dWFsSGVpZ2h0KSB7XG5cdFx0dmFyIGRlbHRhID0ge1xuXHRcdFx0dG9wOiAwLFxuXHRcdFx0bGVmdDogMFxuXHRcdH1cblx0XHRpZiAoIXRoaXMuJHZpZXdwb3J0KSByZXR1cm4gZGVsdGFcblxuXHRcdHZhciB2aWV3cG9ydFBhZGRpbmcgPSB0aGlzLm9wdGlvbnMudmlld3BvcnQgJiYgdGhpcy5vcHRpb25zLnZpZXdwb3J0LnBhZGRpbmcgfHwgMFxuXHRcdHZhciB2aWV3cG9ydERpbWVuc2lvbnMgPSB0aGlzLmdldFBvc2l0aW9uKHRoaXMuJHZpZXdwb3J0KVxuXG5cdFx0aWYgKC9yaWdodHxsZWZ0Ly50ZXN0KHBsYWNlbWVudCkpIHtcblx0XHRcdHZhciB0b3BFZGdlT2Zmc2V0ID0gcG9zLnRvcCAtIHZpZXdwb3J0UGFkZGluZyAtIHZpZXdwb3J0RGltZW5zaW9ucy5zY3JvbGxcblx0XHRcdHZhciBib3R0b21FZGdlT2Zmc2V0ID0gcG9zLnRvcCArIHZpZXdwb3J0UGFkZGluZyAtIHZpZXdwb3J0RGltZW5zaW9ucy5zY3JvbGwgKyBhY3R1YWxIZWlnaHRcblx0XHRcdGlmICh0b3BFZGdlT2Zmc2V0IDwgdmlld3BvcnREaW1lbnNpb25zLnRvcCkgeyAvLyB0b3Agb3ZlcmZsb3dcblx0XHRcdFx0ZGVsdGEudG9wID0gdmlld3BvcnREaW1lbnNpb25zLnRvcCAtIHRvcEVkZ2VPZmZzZXRcblx0XHRcdH0gZWxzZSBpZiAoYm90dG9tRWRnZU9mZnNldCA+IHZpZXdwb3J0RGltZW5zaW9ucy50b3AgKyB2aWV3cG9ydERpbWVuc2lvbnMuaGVpZ2h0KSB7IC8vIGJvdHRvbSBvdmVyZmxvd1xuXHRcdFx0XHRkZWx0YS50b3AgPSB2aWV3cG9ydERpbWVuc2lvbnMudG9wICsgdmlld3BvcnREaW1lbnNpb25zLmhlaWdodCAtIGJvdHRvbUVkZ2VPZmZzZXRcblx0XHRcdH1cblx0XHR9IGVsc2Uge1xuXHRcdFx0dmFyIGxlZnRFZGdlT2Zmc2V0ID0gcG9zLmxlZnQgLSB2aWV3cG9ydFBhZGRpbmdcblx0XHRcdHZhciByaWdodEVkZ2VPZmZzZXQgPSBwb3MubGVmdCArIHZpZXdwb3J0UGFkZGluZyArIGFjdHVhbFdpZHRoXG5cdFx0XHRpZiAobGVmdEVkZ2VPZmZzZXQgPCB2aWV3cG9ydERpbWVuc2lvbnMubGVmdCkgeyAvLyBsZWZ0IG92ZXJmbG93XG5cdFx0XHRcdGRlbHRhLmxlZnQgPSB2aWV3cG9ydERpbWVuc2lvbnMubGVmdCAtIGxlZnRFZGdlT2Zmc2V0XG5cdFx0XHR9IGVsc2UgaWYgKHJpZ2h0RWRnZU9mZnNldCA+IHZpZXdwb3J0RGltZW5zaW9ucy53aWR0aCkgeyAvLyByaWdodCBvdmVyZmxvd1xuXHRcdFx0XHRkZWx0YS5sZWZ0ID0gdmlld3BvcnREaW1lbnNpb25zLmxlZnQgKyB2aWV3cG9ydERpbWVuc2lvbnMud2lkdGggLSByaWdodEVkZ2VPZmZzZXRcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gZGVsdGFcblx0fVxuXG5cdFRvb2x0aXAucHJvdG90eXBlLmdldFRpdGxlID0gZnVuY3Rpb24oKSB7XG5cdFx0dmFyIHRpdGxlXG5cdFx0dmFyICRlID0gdGhpcy4kZWxlbWVudFxuXHRcdHZhciBvID0gdGhpcy5vcHRpb25zXG5cblx0XHR0aXRsZSA9ICRlLmF0dHIoJ2RhdGEtb3JpZ2luYWwtdGl0bGUnKSB8fCAodHlwZW9mIG8udGl0bGUgPT0gJ2Z1bmN0aW9uJyA/IG8udGl0bGUuY2FsbCgkZVswXSkgOiBvLnRpdGxlKVxuXG5cdFx0cmV0dXJuIHRpdGxlXG5cdH1cblxuXHRUb29sdGlwLnByb3RvdHlwZS5nZXRVSUQgPSBmdW5jdGlvbihwcmVmaXgpIHtcblx0XHRkbyBwcmVmaXggKz0gfn4oTWF0aC5yYW5kb20oKSAqIDEwMDAwMDApXG5cdFx0d2hpbGUgKGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHByZWZpeCkpXG5cdFx0cmV0dXJuIHByZWZpeFxuXHR9XG5cblx0VG9vbHRpcC5wcm90b3R5cGUudGlwID0gZnVuY3Rpb24oKSB7XG5cdFx0cmV0dXJuICh0aGlzLiR0aXAgPSB0aGlzLiR0aXAgfHwgJCh0aGlzLm9wdGlvbnMudGVtcGxhdGUpKVxuXHR9XG5cblx0VG9vbHRpcC5wcm90b3R5cGUuYXJyb3cgPSBmdW5jdGlvbigpIHtcblx0XHRyZXR1cm4gKHRoaXMuJGFycm93ID0gdGhpcy4kYXJyb3cgfHwgdGhpcy50aXAoKS5maW5kKCcudG9vbHRpcC1hcnJvdycpKVxuXHR9XG5cblx0VG9vbHRpcC5wcm90b3R5cGUudmFsaWRhdGUgPSBmdW5jdGlvbigpIHtcblx0XHRpZiAoIXRoaXMuJGVsZW1lbnRbMF0ucGFyZW50Tm9kZSkge1xuXHRcdFx0dGhpcy5oaWRlKClcblx0XHRcdHRoaXMuJGVsZW1lbnQgPSBudWxsXG5cdFx0XHR0aGlzLm9wdGlvbnMgPSBudWxsXG5cdFx0fVxuXHR9XG5cblx0VG9vbHRpcC5wcm90b3R5cGUuZW5hYmxlID0gZnVuY3Rpb24oKSB7XG5cdFx0dGhpcy5lbmFibGVkID0gdHJ1ZVxuXHR9XG5cblx0VG9vbHRpcC5wcm90b3R5cGUuZGlzYWJsZSA9IGZ1bmN0aW9uKCkge1xuXHRcdHRoaXMuZW5hYmxlZCA9IGZhbHNlXG5cdH1cblxuXHRUb29sdGlwLnByb3RvdHlwZS50b2dnbGVFbmFibGVkID0gZnVuY3Rpb24oKSB7XG5cdFx0dGhpcy5lbmFibGVkID0gIXRoaXMuZW5hYmxlZFxuXHR9XG5cblx0VG9vbHRpcC5wcm90b3R5cGUudG9nZ2xlID0gZnVuY3Rpb24oZSkge1xuXHRcdHZhciBzZWxmID0gdGhpc1xuXHRcdGlmIChlKSB7XG5cdFx0XHRzZWxmID0gJChlLmN1cnJlbnRUYXJnZXQpLmRhdGEoJ2JzLicgKyB0aGlzLnR5cGUpXG5cdFx0XHRpZiAoIXNlbGYpIHtcblx0XHRcdFx0c2VsZiA9IG5ldyB0aGlzLmNvbnN0cnVjdG9yKGUuY3VycmVudFRhcmdldCwgdGhpcy5nZXREZWxlZ2F0ZU9wdGlvbnMoKSlcblx0XHRcdFx0JChlLmN1cnJlbnRUYXJnZXQpLmRhdGEoJ2JzLicgKyB0aGlzLnR5cGUsIHNlbGYpXG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0c2VsZi50aXAoKS5oYXNDbGFzcygnaW4nKSA/IHNlbGYubGVhdmUoc2VsZikgOiBzZWxmLmVudGVyKHNlbGYpXG5cdH1cblxuXHRUb29sdGlwLnByb3RvdHlwZS5kZXN0cm95ID0gZnVuY3Rpb24oKSB7XG5cdFx0Y2xlYXJUaW1lb3V0KHRoaXMudGltZW91dClcblx0XHR0aGlzLmhpZGUoKS4kZWxlbWVudC5vZmYoJy4nICsgdGhpcy50eXBlKS5yZW1vdmVEYXRhKCdicy4nICsgdGhpcy50eXBlKVxuXHR9XG5cblxuXHQvLyBUT09MVElQIFBMVUdJTiBERUZJTklUSU9OXG5cdC8vID09PT09PT09PT09PT09PT09PT09PT09PT1cblxuXHRmdW5jdGlvbiBQbHVnaW4ob3B0aW9uKSB7XG5cdFx0cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHtcblx0XHRcdHZhciAkdGhpcyA9ICQodGhpcylcblx0XHRcdHZhciBkYXRhID0gJHRoaXMuZGF0YSgnYnMudG9vbHRpcCcpXG5cdFx0XHR2YXIgb3B0aW9ucyA9IHR5cGVvZiBvcHRpb24gPT0gJ29iamVjdCcgJiYgb3B0aW9uXG5cblx0XHRcdGlmICghZGF0YSAmJiBvcHRpb24gPT0gJ2Rlc3Ryb3knKSByZXR1cm5cblx0XHRcdGlmICghZGF0YSkgJHRoaXMuZGF0YSgnYnMudG9vbHRpcCcsIChkYXRhID0gbmV3IFRvb2x0aXAodGhpcywgb3B0aW9ucykpKVxuXHRcdFx0aWYgKHR5cGVvZiBvcHRpb24gPT0gJ3N0cmluZycpIGRhdGFbb3B0aW9uXSgpXG5cdFx0fSlcblx0fVxuXG5cdHZhciBvbGQgPSAkLmZuLnRvb2x0aXBcblxuXHQkLmZuLnRvb2x0aXAgPSBQbHVnaW5cblx0JC5mbi50b29sdGlwLkNvbnN0cnVjdG9yID0gVG9vbHRpcFxuXG5cblx0Ly8gVE9PTFRJUCBOTyBDT05GTElDVFxuXHQvLyA9PT09PT09PT09PT09PT09PT09XG5cblx0JC5mbi50b29sdGlwLm5vQ29uZmxpY3QgPSBmdW5jdGlvbigpIHtcblx0XHQkLmZuLnRvb2x0aXAgPSBvbGRcblx0XHRyZXR1cm4gdGhpc1xuXHR9XG5cbn0oalF1ZXJ5KTtcblxuLyogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiBCb290c3RyYXA6IHBvcG92ZXIuanMgdjMuMi4wXG4gKiBodHRwOi8vZ2V0Ym9vdHN0cmFwLmNvbS9qYXZhc2NyaXB0LyNwb3BvdmVyc1xuICogPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiBDb3B5cmlnaHQgMjAxMS0yMDE0IFR3aXR0ZXIsIEluYy5cbiAqIExpY2Vuc2VkIHVuZGVyIE1JVCAoaHR0cHM6Ly9naXRodWIuY29tL3R3YnMvYm9vdHN0cmFwL2Jsb2IvbWFzdGVyL0xJQ0VOU0UpXG4gKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuXG4rIGZ1bmN0aW9uKCQpIHtcblx0J3VzZSBzdHJpY3QnO1xuXG5cdC8vIFBPUE9WRVIgUFVCTElDIENMQVNTIERFRklOSVRJT05cblx0Ly8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5cdHZhciBQb3BvdmVyID0gZnVuY3Rpb24oZWxlbWVudCwgb3B0aW9ucykge1xuXHRcdHRoaXMuaW5pdCgncG9wb3ZlcicsIGVsZW1lbnQsIG9wdGlvbnMpXG5cdH1cblxuXHRpZiAoISQuZm4udG9vbHRpcCkgdGhyb3cgbmV3IEVycm9yKCdQb3BvdmVyIHJlcXVpcmVzIHRvb2x0aXAuanMnKVxuXG5cdFBvcG92ZXIuVkVSU0lPTiA9ICczLjIuMCdcblxuXHRQb3BvdmVyLkRFRkFVTFRTID0gJC5leHRlbmQoe30sICQuZm4udG9vbHRpcC5Db25zdHJ1Y3Rvci5ERUZBVUxUUywge1xuXHRcdHBsYWNlbWVudDogJ3JpZ2h0Jyxcblx0XHR0cmlnZ2VyOiAnY2xpY2snLFxuXHRcdGNvbnRlbnQ6ICcnLFxuXHRcdHRlbXBsYXRlOiAnPGRpdiBjbGFzcz1cInBvcG92ZXJcIiByb2xlPVwidG9vbHRpcFwiPjxkaXYgY2xhc3M9XCJhcnJvd1wiPjwvZGl2PjxoMyBjbGFzcz1cInBvcG92ZXItdGl0bGVcIj48L2gzPjxkaXYgY2xhc3M9XCJwb3BvdmVyLWNvbnRlbnRcIj48L2Rpdj48L2Rpdj4nXG5cdH0pXG5cblxuXHQvLyBOT1RFOiBQT1BPVkVSIEVYVEVORFMgdG9vbHRpcC5qc1xuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5cdFBvcG92ZXIucHJvdG90eXBlID0gJC5leHRlbmQoe30sICQuZm4udG9vbHRpcC5Db25zdHJ1Y3Rvci5wcm90b3R5cGUpXG5cblx0UG9wb3Zlci5wcm90b3R5cGUuY29uc3RydWN0b3IgPSBQb3BvdmVyXG5cblx0UG9wb3Zlci5wcm90b3R5cGUuZ2V0RGVmYXVsdHMgPSBmdW5jdGlvbigpIHtcblx0XHRyZXR1cm4gUG9wb3Zlci5ERUZBVUxUU1xuXHR9XG5cblx0UG9wb3Zlci5wcm90b3R5cGUuc2V0Q29udGVudCA9IGZ1bmN0aW9uKCkge1xuXHRcdHZhciAkdGlwID0gdGhpcy50aXAoKVxuXHRcdHZhciB0aXRsZSA9IHRoaXMuZ2V0VGl0bGUoKVxuXHRcdHZhciBjb250ZW50ID0gdGhpcy5nZXRDb250ZW50KClcblxuXHRcdCR0aXAuZmluZCgnLnBvcG92ZXItdGl0bGUnKVt0aGlzLm9wdGlvbnMuaHRtbCA/ICdodG1sJyA6ICd0ZXh0J10odGl0bGUpXG5cdFx0JHRpcC5maW5kKCcucG9wb3Zlci1jb250ZW50JykuZW1wdHkoKVsgLy8gd2UgdXNlIGFwcGVuZCBmb3IgaHRtbCBvYmplY3RzIHRvIG1haW50YWluIGpzIGV2ZW50c1xuXHRcdFx0dGhpcy5vcHRpb25zLmh0bWwgPyAodHlwZW9mIGNvbnRlbnQgPT0gJ3N0cmluZycgPyAnaHRtbCcgOiAnYXBwZW5kJykgOiAndGV4dCdcblx0XHRdKGNvbnRlbnQpXG5cblx0XHQkdGlwLnJlbW92ZUNsYXNzKCdmYWRlIHRvcCBib3R0b20gbGVmdCByaWdodCBpbicpXG5cblx0XHQvLyBJRTggZG9lc24ndCBhY2NlcHQgaGlkaW5nIHZpYSB0aGUgYDplbXB0eWAgcHNldWRvIHNlbGVjdG9yLCB3ZSBoYXZlIHRvIGRvXG5cdFx0Ly8gdGhpcyBtYW51YWxseSBieSBjaGVja2luZyB0aGUgY29udGVudHMuXG5cdFx0aWYgKCEkdGlwLmZpbmQoJy5wb3BvdmVyLXRpdGxlJykuaHRtbCgpKSAkdGlwLmZpbmQoJy5wb3BvdmVyLXRpdGxlJykuaGlkZSgpXG5cdH1cblxuXHRQb3BvdmVyLnByb3RvdHlwZS5oYXNDb250ZW50ID0gZnVuY3Rpb24oKSB7XG5cdFx0cmV0dXJuIHRoaXMuZ2V0VGl0bGUoKSB8fCB0aGlzLmdldENvbnRlbnQoKVxuXHR9XG5cblx0UG9wb3Zlci5wcm90b3R5cGUuZ2V0Q29udGVudCA9IGZ1bmN0aW9uKCkge1xuXHRcdHZhciAkZSA9IHRoaXMuJGVsZW1lbnRcblx0XHR2YXIgbyA9IHRoaXMub3B0aW9uc1xuXG5cdFx0cmV0dXJuICRlLmF0dHIoJ2RhdGEtY29udGVudCcpIHx8ICh0eXBlb2Ygby5jb250ZW50ID09ICdmdW5jdGlvbicgP1xuXHRcdFx0by5jb250ZW50LmNhbGwoJGVbMF0pIDpcblx0XHRcdG8uY29udGVudClcblx0fVxuXG5cdFBvcG92ZXIucHJvdG90eXBlLmFycm93ID0gZnVuY3Rpb24oKSB7XG5cdFx0cmV0dXJuICh0aGlzLiRhcnJvdyA9IHRoaXMuJGFycm93IHx8IHRoaXMudGlwKCkuZmluZCgnLmFycm93JykpXG5cdH1cblxuXHRQb3BvdmVyLnByb3RvdHlwZS50aXAgPSBmdW5jdGlvbigpIHtcblx0XHRpZiAoIXRoaXMuJHRpcCkgdGhpcy4kdGlwID0gJCh0aGlzLm9wdGlvbnMudGVtcGxhdGUpXG5cdFx0cmV0dXJuIHRoaXMuJHRpcFxuXHR9XG5cblxuXHQvLyBQT1BPVkVSIFBMVUdJTiBERUZJTklUSU9OXG5cdC8vID09PT09PT09PT09PT09PT09PT09PT09PT1cblxuXHRmdW5jdGlvbiBQbHVnaW4ob3B0aW9uKSB7XG5cdFx0cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpIHtcblx0XHRcdHZhciAkdGhpcyA9ICQodGhpcylcblx0XHRcdHZhciBkYXRhID0gJHRoaXMuZGF0YSgnYnMucG9wb3ZlcicpXG5cdFx0XHR2YXIgb3B0aW9ucyA9IHR5cGVvZiBvcHRpb24gPT0gJ29iamVjdCcgJiYgb3B0aW9uXG5cblx0XHRcdGlmICghZGF0YSAmJiBvcHRpb24gPT0gJ2Rlc3Ryb3knKSByZXR1cm5cblx0XHRcdGlmICghZGF0YSkgJHRoaXMuZGF0YSgnYnMucG9wb3ZlcicsIChkYXRhID0gbmV3IFBvcG92ZXIodGhpcywgb3B0aW9ucykpKVxuXHRcdFx0aWYgKHR5cGVvZiBvcHRpb24gPT0gJ3N0cmluZycpIGRhdGFbb3B0aW9uXSgpXG5cdFx0fSlcblx0fVxuXG5cdHZhciBvbGQgPSAkLmZuLnBvcG92ZXJcblxuXHQkLmZuLnBvcG92ZXIgPSBQbHVnaW5cblx0JC5mbi5wb3BvdmVyLkNvbnN0cnVjdG9yID0gUG9wb3ZlclxuXG5cblx0Ly8gUE9QT1ZFUiBOTyBDT05GTElDVFxuXHQvLyA9PT09PT09PT09PT09PT09PT09XG5cblx0JC5mbi5wb3BvdmVyLm5vQ29uZmxpY3QgPSBmdW5jdGlvbigpIHtcblx0XHQkLmZuLnBvcG92ZXIgPSBvbGRcblx0XHRyZXR1cm4gdGhpc1xuXHR9XG5cbn0oalF1ZXJ5KTtcblxuLyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiohXG4gKiBCb290c3RyYXAtc2VsZWN0IHYxLjYuMiAoaHR0cDovL3NpbHZpb21vcmV0by5naXRodWIuaW8vYm9vdHN0cmFwLXNlbGVjdC8pXG4gKlxuICogQ29weXJpZ2h0IDIwMTMtMjAxNCBib290c3RyYXAtc2VsZWN0XG4gKiBMaWNlbnNlZCB1bmRlciBNSVQgKGh0dHBzOi8vZ2l0aHViLmNvbS9zaWx2aW9tb3JldG8vYm9vdHN0cmFwLXNlbGVjdC9ibG9iL21hc3Rlci9MSUNFTlNFKVxuICovXG4oZnVuY3Rpb24oJCkge1xuXHQndXNlIHN0cmljdCc7XG5cblx0Ly8gQ2FzZSBpbnNlbnNpdGl2ZSBzZWFyY2hcblx0JC5leHByWyc6J10uaWNvbnRhaW5zID0gZnVuY3Rpb24ob2JqLCBpbmRleCwgbWV0YSkge1xuXHRcdHJldHVybiBpY29udGFpbnMoJChvYmopLnRleHQoKSwgbWV0YVszXSk7XG5cdH07XG5cblx0Ly8gQ2FzZSBhbmQgYWNjZW50IGluc2Vuc2l0aXZlIHNlYXJjaFxuXHQkLmV4cHJbJzonXS5haWNvbnRhaW5zID0gZnVuY3Rpb24ob2JqLCBpbmRleCwgbWV0YSkge1xuXHRcdHJldHVybiBpY29udGFpbnMoJChvYmopLmRhdGEoJ25vcm1hbGl6ZWRUZXh0JykgfHwgJChvYmopLnRleHQoKSwgbWV0YVszXSk7XG5cdH07XG5cblx0LyoqXG5cdCAqIEFjdHVhbCBpbXBsZW1lbnRhdGlvbiBvZiB0aGUgY2FzZSBpbnNlbnNpdGl2ZSBzZWFyY2guXG5cdCAqIEBhY2Nlc3MgcHJpdmF0ZVxuXHQgKiBAcGFyYW0ge1N0cmluZ30gaGF5c3RhY2tcblx0ICogQHBhcmFtIHtTdHJpbmd9IG5lZWRsZVxuXHQgKiBAcmV0dXJucyB7Ym9vbGVhbn1cblx0ICovXG5cdGZ1bmN0aW9uIGljb250YWlucyhoYXlzdGFjaywgbmVlZGxlKSB7XG5cdFx0cmV0dXJuIGhheXN0YWNrLnRvVXBwZXJDYXNlKCkuaW5kZXhPZihuZWVkbGUudG9VcHBlckNhc2UoKSkgPiAtMTtcblx0fVxuXG5cdC8qKlxuXHQgKiBSZW1vdmUgYWxsIGRpYXRyaWNzIGZyb20gdGhlIGdpdmVuIHRleHQuXG5cdCAqIEBhY2Nlc3MgcHJpdmF0ZVxuXHQgKiBAcGFyYW0ge1N0cmluZ30gdGV4dFxuXHQgKiBAcmV0dXJucyB7U3RyaW5nfVxuXHQgKi9cblx0ZnVuY3Rpb24gbm9ybWFsaXplVG9CYXNlKHRleHQpIHtcblx0XHR2YXIgckV4cHMgPSBbe1xuXHRcdFx0cmU6IC9bXFx4QzAtXFx4QzZdL2csXG5cdFx0XHRjaDogXCJBXCJcblx0XHR9LCB7XG5cdFx0XHRyZTogL1tcXHhFMC1cXHhFNl0vZyxcblx0XHRcdGNoOiBcImFcIlxuXHRcdH0sIHtcblx0XHRcdHJlOiAvW1xceEM4LVxceENCXS9nLFxuXHRcdFx0Y2g6IFwiRVwiXG5cdFx0fSwge1xuXHRcdFx0cmU6IC9bXFx4RTgtXFx4RUJdL2csXG5cdFx0XHRjaDogXCJlXCJcblx0XHR9LCB7XG5cdFx0XHRyZTogL1tcXHhDQy1cXHhDRl0vZyxcblx0XHRcdGNoOiBcIklcIlxuXHRcdH0sIHtcblx0XHRcdHJlOiAvW1xceEVDLVxceEVGXS9nLFxuXHRcdFx0Y2g6IFwiaVwiXG5cdFx0fSwge1xuXHRcdFx0cmU6IC9bXFx4RDItXFx4RDZdL2csXG5cdFx0XHRjaDogXCJPXCJcblx0XHR9LCB7XG5cdFx0XHRyZTogL1tcXHhGMi1cXHhGNl0vZyxcblx0XHRcdGNoOiBcIm9cIlxuXHRcdH0sIHtcblx0XHRcdHJlOiAvW1xceEQ5LVxceERDXS9nLFxuXHRcdFx0Y2g6IFwiVVwiXG5cdFx0fSwge1xuXHRcdFx0cmU6IC9bXFx4RjktXFx4RkNdL2csXG5cdFx0XHRjaDogXCJ1XCJcblx0XHR9LCB7XG5cdFx0XHRyZTogL1tcXHhDNy1cXHhFN10vZyxcblx0XHRcdGNoOiBcImNcIlxuXHRcdH0sIHtcblx0XHRcdHJlOiAvW1xceEQxXS9nLFxuXHRcdFx0Y2g6IFwiTlwiXG5cdFx0fSwge1xuXHRcdFx0cmU6IC9bXFx4RjFdL2csXG5cdFx0XHRjaDogXCJuXCJcblx0XHR9XTtcblx0XHQkLmVhY2gockV4cHMsIGZ1bmN0aW9uKCkge1xuXHRcdFx0dGV4dCA9IHRleHQucmVwbGFjZSh0aGlzLnJlLCB0aGlzLmNoKTtcblx0XHR9KTtcblx0XHRyZXR1cm4gdGV4dDtcblx0fVxuXG5cdHZhciBTZWxlY3RwaWNrZXIgPSBmdW5jdGlvbihlbGVtZW50LCBvcHRpb25zLCBlKSB7XG5cdFx0aWYgKGUpIHtcblx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0fVxuXG5cdFx0dGhpcy4kZWxlbWVudCA9ICQoZWxlbWVudCk7XG5cdFx0dGhpcy4kbmV3RWxlbWVudCA9IG51bGw7XG5cdFx0dGhpcy4kYnV0dG9uID0gbnVsbDtcblx0XHR0aGlzLiRtZW51ID0gbnVsbDtcblx0XHR0aGlzLiRsaXMgPSBudWxsO1xuXHRcdHRoaXMub3B0aW9ucyA9IG9wdGlvbnM7XG5cblx0XHQvLyBJZiB3ZSBoYXZlIG5vIHRpdGxlIHlldCwgdHJ5IHRvIHB1bGwgaXQgZnJvbSB0aGUgaHRtbCB0aXRsZSBhdHRyaWJ1dGUgKGpRdWVyeSBkb2VzbnQnIHBpY2sgaXQgdXAgYXMgaXQncyBub3QgYVxuXHRcdC8vIGRhdGEtYXR0cmlidXRlKVxuXHRcdGlmICh0aGlzLm9wdGlvbnMudGl0bGUgPT09IG51bGwpIHtcblx0XHRcdHRoaXMub3B0aW9ucy50aXRsZSA9IHRoaXMuJGVsZW1lbnQuYXR0cigndGl0bGUnKTtcblx0XHR9XG5cblx0XHQvL0V4cG9zZSBwdWJsaWMgbWV0aG9kc1xuXHRcdHRoaXMudmFsID0gU2VsZWN0cGlja2VyLnByb3RvdHlwZS52YWw7XG5cdFx0dGhpcy5yZW5kZXIgPSBTZWxlY3RwaWNrZXIucHJvdG90eXBlLnJlbmRlcjtcblx0XHR0aGlzLnJlZnJlc2ggPSBTZWxlY3RwaWNrZXIucHJvdG90eXBlLnJlZnJlc2g7XG5cdFx0dGhpcy5zZXRTdHlsZSA9IFNlbGVjdHBpY2tlci5wcm90b3R5cGUuc2V0U3R5bGU7XG5cdFx0dGhpcy5zZWxlY3RBbGwgPSBTZWxlY3RwaWNrZXIucHJvdG90eXBlLnNlbGVjdEFsbDtcblx0XHR0aGlzLmRlc2VsZWN0QWxsID0gU2VsZWN0cGlja2VyLnByb3RvdHlwZS5kZXNlbGVjdEFsbDtcblx0XHR0aGlzLmRlc3Ryb3kgPSBTZWxlY3RwaWNrZXIucHJvdG90eXBlLnJlbW92ZTtcblx0XHR0aGlzLnJlbW92ZSA9IFNlbGVjdHBpY2tlci5wcm90b3R5cGUucmVtb3ZlO1xuXHRcdHRoaXMuc2hvdyA9IFNlbGVjdHBpY2tlci5wcm90b3R5cGUuc2hvdztcblx0XHR0aGlzLmhpZGUgPSBTZWxlY3RwaWNrZXIucHJvdG90eXBlLmhpZGU7XG5cblx0XHR0aGlzLmluaXQoKTtcblx0fTtcblxuXHRTZWxlY3RwaWNrZXIuVkVSU0lPTiA9ICcxLjYuMic7XG5cblx0Ly8gcGFydCBvZiB0aGlzIGlzIGR1cGxpY2F0ZWQgaW4gaTE4bi9kZWZhdWx0cy1lbl9VUy5qcy4gTWFrZSBzdXJlIHRvIHVwZGF0ZSBib3RoLlxuXHRTZWxlY3RwaWNrZXIuREVGQVVMVFMgPSB7XG5cdFx0bm9uZVNlbGVjdGVkVGV4dDogJ05vdGhpbmcgc2VsZWN0ZWQnLFxuXHRcdG5vbmVSZXN1bHRzVGV4dDogJ05vIHJlc3VsdHMgbWF0Y2gnLFxuXHRcdGNvdW50U2VsZWN0ZWRUZXh0OiBmdW5jdGlvbihudW1TZWxlY3RlZCwgbnVtVG90YWwpIHtcblx0XHRcdHJldHVybiAobnVtU2VsZWN0ZWQgPT0gMSkgPyBcInswfSBpdGVtIHNlbGVjdGVkXCIgOiBcInswfSBpdGVtcyBzZWxlY3RlZFwiO1xuXHRcdH0sXG5cdFx0bWF4T3B0aW9uc1RleHQ6IGZ1bmN0aW9uKG51bUFsbCwgbnVtR3JvdXApIHtcblx0XHRcdHZhciBhcnIgPSBbXTtcblxuXHRcdFx0YXJyWzBdID0gKG51bUFsbCA9PSAxKSA/ICdMaW1pdCByZWFjaGVkICh7bn0gaXRlbSBtYXgpJyA6ICdMaW1pdCByZWFjaGVkICh7bn0gaXRlbXMgbWF4KSc7XG5cdFx0XHRhcnJbMV0gPSAobnVtR3JvdXAgPT0gMSkgPyAnR3JvdXAgbGltaXQgcmVhY2hlZCAoe259IGl0ZW0gbWF4KScgOiAnR3JvdXAgbGltaXQgcmVhY2hlZCAoe259IGl0ZW1zIG1heCknO1xuXG5cdFx0XHRyZXR1cm4gYXJyO1xuXHRcdH0sXG5cdFx0c2VsZWN0QWxsVGV4dDogJ1NlbGVjdCBBbGwnLFxuXHRcdGRlc2VsZWN0QWxsVGV4dDogJ0Rlc2VsZWN0IEFsbCcsXG5cdFx0bXVsdGlwbGVTZXBhcmF0b3I6ICcsICcsXG5cdFx0c3R5bGU6ICdidG4tc2VsZWN0Jyxcblx0XHRzaXplOiAnYXV0bycsXG5cdFx0dGl0bGU6ICdzdHJpbmcnLFxuXHRcdHNlbGVjdGVkVGV4dEZvcm1hdDogJ3ZhbHVlcycsXG5cdFx0d2lkdGg6IGZhbHNlLFxuXHRcdGNvbnRhaW5lcjogZmFsc2UsXG5cdFx0aGlkZURpc2FibGVkOiBmYWxzZSxcblx0XHRzaG93U3VidGV4dDogZmFsc2UsXG5cdFx0c2hvd0ljb246IHRydWUsXG5cdFx0c2hvd0NvbnRlbnQ6IHRydWUsXG5cdFx0ZHJvcHVwQXV0bzogdHJ1ZSxcblx0XHRoZWFkZXI6IGZhbHNlLFxuXHRcdGxpdmVTZWFyY2g6IGZhbHNlLFxuXHRcdGFjdGlvbnNCb3g6IGZhbHNlLFxuXHRcdGljb25CYXNlOiAnZ2x5cGhpY29uJyxcblx0XHR0aWNrSWNvbjogJ2dseXBoaWNvbi1vaycsXG5cdFx0bWF4T3B0aW9uczogZmFsc2UsXG5cdFx0bW9iaWxlOiBmYWxzZSxcblx0XHRzZWxlY3RPblRhYjogZmFsc2UsXG5cdFx0ZHJvcGRvd25BbGlnblJpZ2h0OiBmYWxzZSxcblx0XHRzZWFyY2hBY2NlbnRJbnNlbnNpdGl2ZTogZmFsc2Vcblx0fTtcblxuXHRTZWxlY3RwaWNrZXIucHJvdG90eXBlID0ge1xuXG5cdFx0Y29uc3RydWN0b3I6IFNlbGVjdHBpY2tlcixcblxuXHRcdGluaXQ6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIHRoYXQgPSB0aGlzLFxuXHRcdFx0XHRpZCA9IHRoaXMuJGVsZW1lbnQuYXR0cignaWQnKTtcblxuXHRcdFx0dGhpcy4kZWxlbWVudC5oaWRlKCk7XG5cdFx0XHR0aGlzLm11bHRpcGxlID0gdGhpcy4kZWxlbWVudC5wcm9wKCdtdWx0aXBsZScpO1xuXHRcdFx0dGhpcy5hdXRvZm9jdXMgPSB0aGlzLiRlbGVtZW50LnByb3AoJ2F1dG9mb2N1cycpO1xuXHRcdFx0dGhpcy4kbmV3RWxlbWVudCA9IHRoaXMuY3JlYXRlVmlldygpO1xuXHRcdFx0dGhpcy4kZWxlbWVudC5hZnRlcih0aGlzLiRuZXdFbGVtZW50KTtcblx0XHRcdHRoaXMuJG1lbnUgPSB0aGlzLiRuZXdFbGVtZW50LmZpbmQoJz4gLmRyb3Bkb3duLW1lbnUnKTtcblx0XHRcdHRoaXMuJGJ1dHRvbiA9IHRoaXMuJG5ld0VsZW1lbnQuZmluZCgnPiBidXR0b24nKTtcblx0XHRcdHRoaXMuJHNlYXJjaGJveCA9IHRoaXMuJG5ld0VsZW1lbnQuZmluZCgnaW5wdXQnKTtcblxuXHRcdFx0aWYgKHRoaXMub3B0aW9ucy5kcm9wZG93bkFsaWduUmlnaHQpXG5cdFx0XHRcdHRoaXMuJG1lbnUuYWRkQ2xhc3MoJ2Ryb3Bkb3duLW1lbnUtcmlnaHQnKTtcblxuXHRcdFx0aWYgKHR5cGVvZiBpZCAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0dGhpcy4kYnV0dG9uLmF0dHIoJ2RhdGEtaWQnLCBpZCk7XG5cdFx0XHRcdCQoJ2xhYmVsW2Zvcj1cIicgKyBpZCArICdcIl0nKS5jbGljayhmdW5jdGlvbihlKSB7XG5cdFx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRcdHRoYXQuJGJ1dHRvbi5mb2N1cygpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy5jaGVja0Rpc2FibGVkKCk7XG5cdFx0XHR0aGlzLmNsaWNrTGlzdGVuZXIoKTtcblx0XHRcdGlmICh0aGlzLm9wdGlvbnMubGl2ZVNlYXJjaCkgdGhpcy5saXZlU2VhcmNoTGlzdGVuZXIoKTtcblx0XHRcdHRoaXMucmVuZGVyKCk7XG5cdFx0XHR0aGlzLmxpSGVpZ2h0KCk7XG5cdFx0XHR0aGlzLnNldFN0eWxlKCk7XG5cdFx0XHR0aGlzLnNldFdpZHRoKCk7XG5cdFx0XHRpZiAodGhpcy5vcHRpb25zLmNvbnRhaW5lcikgdGhpcy5zZWxlY3RQb3NpdGlvbigpO1xuXHRcdFx0dGhpcy4kbWVudS5kYXRhKCd0aGlzJywgdGhpcyk7XG5cdFx0XHR0aGlzLiRuZXdFbGVtZW50LmRhdGEoJ3RoaXMnLCB0aGlzKTtcblx0XHRcdGlmICh0aGlzLm9wdGlvbnMubW9iaWxlKSB0aGlzLm1vYmlsZSgpO1xuXHRcdH0sXG5cblx0XHRjcmVhdGVEcm9wZG93bjogZnVuY3Rpb24oKSB7XG5cdFx0XHQvLyBPcHRpb25zXG5cdFx0XHQvLyBJZiB3ZSBhcmUgbXVsdGlwbGUsIHRoZW4gYWRkIHRoZSBzaG93LXRpY2sgY2xhc3MgYnkgZGVmYXVsdFxuXHRcdFx0dmFyIG11bHRpcGxlID0gdGhpcy5tdWx0aXBsZSA/ICcgc2hvdy10aWNrJyA6ICcnLFxuXHRcdFx0XHRpbnB1dEdyb3VwID0gdGhpcy4kZWxlbWVudC5wYXJlbnQoKS5oYXNDbGFzcygnaW5wdXQtZ3JvdXAnKSA/ICcgaW5wdXQtZ3JvdXAtYnRuJyA6ICcnLFxuXHRcdFx0XHRhdXRvZm9jdXMgPSB0aGlzLmF1dG9mb2N1cyA/ICcgYXV0b2ZvY3VzJyA6ICcnLFxuXHRcdFx0XHRidG5TaXplID0gdGhpcy4kZWxlbWVudC5wYXJlbnRzKCkuaGFzQ2xhc3MoJ2Zvcm0tZ3JvdXAtbGcnKSA/ICcgYnRuLWxnJyA6ICh0aGlzLiRlbGVtZW50LnBhcmVudHMoKS5oYXNDbGFzcygnZm9ybS1ncm91cC1zbScpID8gJyBidG4tc20nIDogJycpO1xuXHRcdFx0Ly8gRWxlbWVudHNcblx0XHRcdHZhciBoZWFkZXIgPSB0aGlzLm9wdGlvbnMuaGVhZGVyID8gJzxkaXYgY2xhc3M9XCJwb3BvdmVyLXRpdGxlXCI+PGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJjbG9zZVwiIGFyaWEtaGlkZGVuPVwidHJ1ZVwiPiZ0aW1lczs8L2J1dHRvbj4nICsgdGhpcy5vcHRpb25zLmhlYWRlciArICc8L2Rpdj4nIDogJyc7XG5cdFx0XHR2YXIgc2VhcmNoYm94ID0gdGhpcy5vcHRpb25zLmxpdmVTZWFyY2ggPyAnPGRpdiBjbGFzcz1cImJzLXNlYXJjaGJveFwiPjxpbnB1dCB0eXBlPVwidGV4dFwiIGNsYXNzPVwiaW5wdXQtYmxvY2stbGV2ZWwgZm9ybS1jb250cm9sXCIgYXV0b2NvbXBsZXRlPVwib2ZmXCIgLz48L2Rpdj4nIDogJyc7XG5cdFx0XHR2YXIgYWN0aW9uc2JveCA9IHRoaXMub3B0aW9ucy5hY3Rpb25zQm94ID8gJzxkaXYgY2xhc3M9XCJicy1hY3Rpb25zYm94XCI+JyArXG5cdFx0XHRcdCc8ZGl2IGNsYXNzPVwiYnRuLWdyb3VwIGJ0bi1ibG9ja1wiPicgK1xuXHRcdFx0XHQnPGJ1dHRvbiBjbGFzcz1cImFjdGlvbnMtYnRuIGJzLXNlbGVjdC1hbGwgYnRuIGJ0bi1zbSBidG4tZGVmYXVsdFwiPicgK1xuXHRcdFx0XHR0aGlzLm9wdGlvbnMuc2VsZWN0QWxsVGV4dCArXG5cdFx0XHRcdCc8L2J1dHRvbj4nICtcblx0XHRcdFx0JzxidXR0b24gY2xhc3M9XCJhY3Rpb25zLWJ0biBicy1kZXNlbGVjdC1hbGwgYnRuIGJ0bi1zbSBidG4tZGVmYXVsdFwiPicgK1xuXHRcdFx0XHR0aGlzLm9wdGlvbnMuZGVzZWxlY3RBbGxUZXh0ICtcblx0XHRcdFx0JzwvYnV0dG9uPicgK1xuXHRcdFx0XHQnPC9kaXY+JyArXG5cdFx0XHRcdCc8L2Rpdj4nIDogJyc7XG5cdFx0XHR2YXIgZHJvcCA9XG5cdFx0XHRcdCc8ZGl2IGNsYXNzPVwiYnRuLWdyb3VwIGJvb3RzdHJhcC1zZWxlY3QnICsgbXVsdGlwbGUgKyBpbnB1dEdyb3VwICsgJ1wiPicgK1xuXHRcdFx0XHQnPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJidG4gZHJvcGRvd24tdG9nZ2xlIHNlbGVjdHBpY2tlcicgKyBidG5TaXplICsgJ1wiIGRhdGEtdG9nZ2xlPVwiZHJvcGRvd25cIicgKyBhdXRvZm9jdXMgKyAnPicgK1xuXHRcdFx0XHQnPHNwYW4gY2xhc3M9XCJmaWx0ZXItb3B0aW9uIHB1bGwtbGVmdFwiPjwvc3Bhbj4mbmJzcDsnICtcblx0XHRcdFx0JzxzcGFuIGNsYXNzPVwiY2FyZXRcIj48L3NwYW4+JyArXG5cdFx0XHRcdCc8L2J1dHRvbj4nICtcblx0XHRcdFx0JzxkaXYgY2xhc3M9XCJkcm9wZG93bi1tZW51IG9wZW5cIj4nICtcblx0XHRcdFx0aGVhZGVyICtcblx0XHRcdFx0c2VhcmNoYm94ICtcblx0XHRcdFx0YWN0aW9uc2JveCArXG5cdFx0XHRcdCc8dWwgY2xhc3M9XCJkcm9wZG93bi1tZW51IGlubmVyIHNlbGVjdHBpY2tlclwiIHJvbGU9XCJtZW51XCI+JyArXG5cdFx0XHRcdCc8L3VsPicgK1xuXHRcdFx0XHQnPC9kaXY+JyArXG5cdFx0XHRcdCc8L2Rpdj4nO1xuXG5cdFx0XHRyZXR1cm4gJChkcm9wKTtcblx0XHR9LFxuXG5cdFx0Y3JlYXRlVmlldzogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgJGRyb3AgPSB0aGlzLmNyZWF0ZURyb3Bkb3duKCk7XG5cdFx0XHR2YXIgJGxpID0gdGhpcy5jcmVhdGVMaSgpO1xuXHRcdFx0JGRyb3AuZmluZCgndWwnKS5hcHBlbmQoJGxpKTtcblx0XHRcdHJldHVybiAkZHJvcDtcblx0XHR9LFxuXG5cdFx0cmVsb2FkTGk6IGZ1bmN0aW9uKCkge1xuXHRcdFx0Ly9SZW1vdmUgYWxsIGNoaWxkcmVuLlxuXHRcdFx0dGhpcy5kZXN0cm95TGkoKTtcblx0XHRcdC8vUmUgYnVpbGRcblx0XHRcdHZhciAkbGkgPSB0aGlzLmNyZWF0ZUxpKCk7XG5cdFx0XHR0aGlzLiRtZW51LmZpbmQoJ3VsJykuYXBwZW5kKCRsaSk7XG5cdFx0fSxcblxuXHRcdGRlc3Ryb3lMaTogZnVuY3Rpb24oKSB7XG5cdFx0XHR0aGlzLiRtZW51LmZpbmQoJ2xpJykucmVtb3ZlKCk7XG5cdFx0fSxcblxuXHRcdGNyZWF0ZUxpOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciB0aGF0ID0gdGhpcyxcblx0XHRcdFx0X2xpID0gW10sXG5cdFx0XHRcdG9wdElEID0gMDtcblxuXHRcdFx0Ly8gSGVscGVyIGZ1bmN0aW9uc1xuXHRcdFx0LyoqXG5cdFx0XHQgKiBAcGFyYW0gY29udGVudFxuXHRcdFx0ICogQHBhcmFtIFtpbmRleF1cblx0XHRcdCAqIEBwYXJhbSBbY2xhc3Nlc11cblx0XHRcdCAqIEByZXR1cm5zIHtzdHJpbmd9XG5cdFx0XHQgKi9cblx0XHRcdHZhciBnZW5lcmF0ZUxJID0gZnVuY3Rpb24oY29udGVudCwgaW5kZXgsIGNsYXNzZXMpIHtcblx0XHRcdFx0cmV0dXJuICc8bGknICtcblx0XHRcdFx0XHQodHlwZW9mIGNsYXNzZXMgIT09ICd1bmRlZmluZWQnID8gJyBjbGFzcz1cIicgKyBjbGFzc2VzICsgJ1wiJyA6ICcnKSArXG5cdFx0XHRcdFx0KHR5cGVvZiBpbmRleCAhPT0gJ3VuZGVmaW5lZCcgfCBudWxsID09PSBpbmRleCA/ICcgZGF0YS1vcmlnaW5hbC1pbmRleD1cIicgKyBpbmRleCArICdcIicgOiAnJykgK1xuXHRcdFx0XHRcdCc+JyArIGNvbnRlbnQgKyAnPC9saT4nO1xuXHRcdFx0fTtcblxuXHRcdFx0LyoqXG5cdFx0XHQgKiBAcGFyYW0gdGV4dFxuXHRcdFx0ICogQHBhcmFtIFtjbGFzc2VzXVxuXHRcdFx0ICogQHBhcmFtIFtpbmxpbmVdXG5cdFx0XHQgKiBAcGFyYW0gW29wdGdyb3VwXVxuXHRcdFx0ICogQHJldHVybnMge3N0cmluZ31cblx0XHRcdCAqL1xuXHRcdFx0dmFyIGdlbmVyYXRlQSA9IGZ1bmN0aW9uKHRleHQsIGNsYXNzZXMsIGlubGluZSwgb3B0Z3JvdXApIHtcblx0XHRcdFx0dmFyIG5vcm1UZXh0ID0gbm9ybWFsaXplVG9CYXNlKCQudHJpbSgkKFwiPGRpdi8+XCIpLmh0bWwodGV4dCkudGV4dCgpKS5yZXBsYWNlKC9cXHNcXHMrL2csICcgJykpO1xuXHRcdFx0XHRyZXR1cm4gJzxhIHRhYmluZGV4PVwiMFwiJyArXG5cdFx0XHRcdFx0KHR5cGVvZiBjbGFzc2VzICE9PSAndW5kZWZpbmVkJyA/ICcgY2xhc3M9XCInICsgY2xhc3NlcyArICdcIicgOiAnJykgK1xuXHRcdFx0XHRcdCh0eXBlb2YgaW5saW5lICE9PSAndW5kZWZpbmVkJyA/ICcgc3R5bGU9XCInICsgaW5saW5lICsgJ1wiJyA6ICcnKSArXG5cdFx0XHRcdFx0KHR5cGVvZiBvcHRncm91cCAhPT0gJ3VuZGVmaW5lZCcgPyAnZGF0YS1vcHRncm91cD1cIicgKyBvcHRncm91cCArICdcIicgOiAnJykgK1xuXHRcdFx0XHRcdCcgZGF0YS1ub3JtYWxpemVkLXRleHQ9XCInICsgbm9ybVRleHQgKyAnXCInICtcblx0XHRcdFx0XHQnPicgKyB0ZXh0ICtcblx0XHRcdFx0XHQnPHNwYW4gY2xhc3M9XCInICsgdGhhdC5vcHRpb25zLmljb25CYXNlICsgJyAnICsgdGhhdC5vcHRpb25zLnRpY2tJY29uICsgJyBjaGVjay1tYXJrXCI+PC9zcGFuPicgK1xuXHRcdFx0XHRcdCc8L2E+Jztcblx0XHRcdH07XG5cblx0XHRcdHRoaXMuJGVsZW1lbnQuZmluZCgnb3B0aW9uJykuZWFjaChmdW5jdGlvbigpIHtcblx0XHRcdFx0dmFyICR0aGlzID0gJCh0aGlzKTtcblxuXHRcdFx0XHQvLyBHZXQgdGhlIGNsYXNzIGFuZCB0ZXh0IGZvciB0aGUgb3B0aW9uXG5cdFx0XHRcdHZhciBvcHRpb25DbGFzcyA9ICR0aGlzLmF0dHIoJ2NsYXNzJykgfHwgJycsXG5cdFx0XHRcdFx0aW5saW5lID0gJHRoaXMuYXR0cignc3R5bGUnKSxcblx0XHRcdFx0XHR0ZXh0ID0gJHRoaXMuZGF0YSgnY29udGVudCcpID8gJHRoaXMuZGF0YSgnY29udGVudCcpIDogJHRoaXMuaHRtbCgpLFxuXHRcdFx0XHRcdHN1YnRleHQgPSB0eXBlb2YgJHRoaXMuZGF0YSgnc3VidGV4dCcpICE9PSAndW5kZWZpbmVkJyA/ICc8c21hbGwgY2xhc3M9XCJtdXRlZCB0ZXh0LW11dGVkXCI+JyArICR0aGlzLmRhdGEoJ3N1YnRleHQnKSArICc8L3NtYWxsPicgOiAnJyxcblx0XHRcdFx0XHRpY29uID0gdHlwZW9mICR0aGlzLmRhdGEoJ2ljb24nKSAhPT0gJ3VuZGVmaW5lZCcgPyAnPHNwYW4gY2xhc3M9XCInICsgdGhhdC5vcHRpb25zLmljb25CYXNlICsgJyAnICsgJHRoaXMuZGF0YSgnaWNvbicpICsgJ1wiPjwvc3Bhbj4gJyA6ICcnLFxuXHRcdFx0XHRcdGlzRGlzYWJsZWQgPSAkdGhpcy5pcygnOmRpc2FibGVkJykgfHwgJHRoaXMucGFyZW50KCkuaXMoJzpkaXNhYmxlZCcpLFxuXHRcdFx0XHRcdGluZGV4ID0gJHRoaXNbMF0uaW5kZXg7XG5cdFx0XHRcdGlmIChpY29uICE9PSAnJyAmJiBpc0Rpc2FibGVkKSB7XG5cdFx0XHRcdFx0aWNvbiA9ICc8c3Bhbj4nICsgaWNvbiArICc8L3NwYW4+Jztcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICghJHRoaXMuZGF0YSgnY29udGVudCcpKSB7XG5cdFx0XHRcdFx0Ly8gUHJlcGVuZCBhbnkgaWNvbiBhbmQgYXBwZW5kIGFueSBzdWJ0ZXh0IHRvIHRoZSBtYWluIHRleHQuXG5cdFx0XHRcdFx0dGV4dCA9IGljb24gKyAnPHNwYW4gY2xhc3M9XCJ0ZXh0XCI+JyArIHRleHQgKyBzdWJ0ZXh0ICsgJzwvc3Bhbj4nO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHRoYXQub3B0aW9ucy5oaWRlRGlzYWJsZWQgJiYgaXNEaXNhYmxlZCkge1xuXHRcdFx0XHRcdHJldHVybjtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICgkdGhpcy5wYXJlbnQoKS5pcygnb3B0Z3JvdXAnKSAmJiAkdGhpcy5kYXRhKCdkaXZpZGVyJykgIT09IHRydWUpIHtcblx0XHRcdFx0XHRpZiAoJHRoaXMuaW5kZXgoKSA9PT0gMCkgeyAvLyBJcyBpdCB0aGUgZmlyc3Qgb3B0aW9uIG9mIHRoZSBvcHRncm91cD9cblx0XHRcdFx0XHRcdG9wdElEICs9IDE7XG5cblx0XHRcdFx0XHRcdC8vIEdldCB0aGUgb3B0IGdyb3VwIGxhYmVsXG5cdFx0XHRcdFx0XHR2YXIgbGFiZWwgPSAkdGhpcy5wYXJlbnQoKS5hdHRyKCdsYWJlbCcpO1xuXHRcdFx0XHRcdFx0dmFyIGxhYmVsU3VidGV4dCA9IHR5cGVvZiAkdGhpcy5wYXJlbnQoKS5kYXRhKCdzdWJ0ZXh0JykgIT09ICd1bmRlZmluZWQnID8gJzxzbWFsbCBjbGFzcz1cIm11dGVkIHRleHQtbXV0ZWRcIj4nICsgJHRoaXMucGFyZW50KCkuZGF0YSgnc3VidGV4dCcpICsgJzwvc21hbGw+JyA6ICcnO1xuXHRcdFx0XHRcdFx0dmFyIGxhYmVsSWNvbiA9ICR0aGlzLnBhcmVudCgpLmRhdGEoJ2ljb24nKSA/ICc8c3BhbiBjbGFzcz1cIicgKyB0aGF0Lm9wdGlvbnMuaWNvbkJhc2UgKyAnICcgKyAkdGhpcy5wYXJlbnQoKS5kYXRhKCdpY29uJykgKyAnXCI+PC9zcGFuPiAnIDogJyc7XG5cdFx0XHRcdFx0XHRsYWJlbCA9IGxhYmVsSWNvbiArICc8c3BhbiBjbGFzcz1cInRleHRcIj4nICsgbGFiZWwgKyBsYWJlbFN1YnRleHQgKyAnPC9zcGFuPic7XG5cblx0XHRcdFx0XHRcdGlmIChpbmRleCAhPT0gMCAmJiBfbGkubGVuZ3RoID4gMCkgeyAvLyBJcyBpdCBOT1QgdGhlIGZpcnN0IG9wdGlvbiBvZiB0aGUgc2VsZWN0ICYmIGFyZSB0aGVyZSBlbGVtZW50cyBpbiB0aGUgZHJvcGRvd24/XG5cdFx0XHRcdFx0XHRcdF9saS5wdXNoKGdlbmVyYXRlTEkoJycsIG51bGwsICdkaXZpZGVyJykpO1xuXHRcdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0XHRfbGkucHVzaChnZW5lcmF0ZUxJKGxhYmVsLCBudWxsLCAnZHJvcGRvd24taGVhZGVyJykpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdF9saS5wdXNoKGdlbmVyYXRlTEkoZ2VuZXJhdGVBKHRleHQsICdvcHQgJyArIG9wdGlvbkNsYXNzLCBpbmxpbmUsIG9wdElEKSwgaW5kZXgpKTtcblx0XHRcdFx0fSBlbHNlIGlmICgkdGhpcy5kYXRhKCdkaXZpZGVyJykgPT09IHRydWUpIHtcblx0XHRcdFx0XHRfbGkucHVzaChnZW5lcmF0ZUxJKCcnLCBpbmRleCwgJ2RpdmlkZXInKSk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoJHRoaXMuZGF0YSgnaGlkZGVuJykgPT09IHRydWUpIHtcblx0XHRcdFx0XHRfbGkucHVzaChnZW5lcmF0ZUxJKGdlbmVyYXRlQSh0ZXh0LCBvcHRpb25DbGFzcywgaW5saW5lKSwgaW5kZXgsICdoaWRlIGlzLWhpZGRlbicpKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRfbGkucHVzaChnZW5lcmF0ZUxJKGdlbmVyYXRlQSh0ZXh0LCBvcHRpb25DbGFzcywgaW5saW5lKSwgaW5kZXgpKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cblx0XHRcdC8vSWYgd2UgYXJlIG5vdCBtdWx0aXBsZSwgd2UgZG9uJ3QgaGF2ZSBhIHNlbGVjdGVkIGl0ZW0sIGFuZCB3ZSBkb24ndCBoYXZlIGEgdGl0bGUsIHNlbGVjdCB0aGUgZmlyc3QgZWxlbWVudCBzbyBzb21ldGhpbmcgaXMgc2V0IGluIHRoZSBidXR0b25cblx0XHRcdGlmICghdGhpcy5tdWx0aXBsZSAmJiB0aGlzLiRlbGVtZW50LmZpbmQoJ29wdGlvbjpzZWxlY3RlZCcpLmxlbmd0aCA9PT0gMCAmJiAhdGhpcy5vcHRpb25zLnRpdGxlKSB7XG5cdFx0XHRcdHRoaXMuJGVsZW1lbnQuZmluZCgnb3B0aW9uJykuZXEoMCkucHJvcCgnc2VsZWN0ZWQnLCB0cnVlKS5hdHRyKCdzZWxlY3RlZCcsICdzZWxlY3RlZCcpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gJChfbGkuam9pbignJykpO1xuXHRcdH0sXG5cblx0XHRmaW5kTGlzOiBmdW5jdGlvbigpIHtcblx0XHRcdGlmICh0aGlzLiRsaXMgPT0gbnVsbCkgdGhpcy4kbGlzID0gdGhpcy4kbWVudS5maW5kKCdsaScpO1xuXHRcdFx0cmV0dXJuIHRoaXMuJGxpcztcblx0XHR9LFxuXG5cdFx0LyoqXG5cdFx0ICogQHBhcmFtIFt1cGRhdGVMaV0gZGVmYXVsdHMgdG8gdHJ1ZVxuXHRcdCAqL1xuXHRcdHJlbmRlcjogZnVuY3Rpb24odXBkYXRlTGkpIHtcblx0XHRcdHZhciB0aGF0ID0gdGhpcztcblxuXHRcdFx0Ly9VcGRhdGUgdGhlIExJIHRvIG1hdGNoIHRoZSBTRUxFQ1Rcblx0XHRcdGlmICh1cGRhdGVMaSAhPT0gZmFsc2UpIHtcblx0XHRcdFx0dGhpcy4kZWxlbWVudC5maW5kKCdvcHRpb24nKS5lYWNoKGZ1bmN0aW9uKGluZGV4KSB7XG5cdFx0XHRcdFx0dGhhdC5zZXREaXNhYmxlZChpbmRleCwgJCh0aGlzKS5pcygnOmRpc2FibGVkJykgfHwgJCh0aGlzKS5wYXJlbnQoKS5pcygnOmRpc2FibGVkJykpO1xuXHRcdFx0XHRcdHRoYXQuc2V0U2VsZWN0ZWQoaW5kZXgsICQodGhpcykuaXMoJzpzZWxlY3RlZCcpKTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMudGFiSW5kZXgoKTtcblx0XHRcdHZhciBub3REaXNhYmxlZCA9IHRoaXMub3B0aW9ucy5oaWRlRGlzYWJsZWQgPyAnOm5vdChbZGlzYWJsZWRdKScgOiAnJztcblx0XHRcdHZhciBzZWxlY3RlZEl0ZW1zID0gdGhpcy4kZWxlbWVudC5maW5kKCdvcHRpb246c2VsZWN0ZWQnICsgbm90RGlzYWJsZWQpLm1hcChmdW5jdGlvbigpIHtcblx0XHRcdFx0dmFyICR0aGlzID0gJCh0aGlzKTtcblx0XHRcdFx0dmFyIGljb24gPSAkdGhpcy5kYXRhKCdpY29uJykgJiYgdGhhdC5vcHRpb25zLnNob3dJY29uID8gJzxpIGNsYXNzPVwiJyArIHRoYXQub3B0aW9ucy5pY29uQmFzZSArICcgJyArICR0aGlzLmRhdGEoJ2ljb24nKSArICdcIj48L2k+ICcgOiAnJztcblx0XHRcdFx0dmFyIHN1YnRleHQ7XG5cdFx0XHRcdGlmICh0aGF0Lm9wdGlvbnMuc2hvd1N1YnRleHQgJiYgJHRoaXMuYXR0cignZGF0YS1zdWJ0ZXh0JykgJiYgIXRoYXQubXVsdGlwbGUpIHtcblx0XHRcdFx0XHRzdWJ0ZXh0ID0gJyA8c21hbGwgY2xhc3M9XCJtdXRlZCB0ZXh0LW11dGVkXCI+JyArICR0aGlzLmRhdGEoJ3N1YnRleHQnKSArICc8L3NtYWxsPic7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0c3VidGV4dCA9ICcnO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGlmICgkdGhpcy5kYXRhKCdjb250ZW50JykgJiYgdGhhdC5vcHRpb25zLnNob3dDb250ZW50KSB7XG5cdFx0XHRcdFx0cmV0dXJuICR0aGlzLmRhdGEoJ2NvbnRlbnQnKTtcblx0XHRcdFx0fSBlbHNlIGlmICh0eXBlb2YgJHRoaXMuYXR0cigndGl0bGUnKSAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdFx0XHRyZXR1cm4gJHRoaXMuYXR0cigndGl0bGUnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRyZXR1cm4gaWNvbiArICR0aGlzLmh0bWwoKSArIHN1YnRleHQ7XG5cdFx0XHRcdH1cblx0XHRcdH0pLnRvQXJyYXkoKTtcblxuXHRcdFx0Ly9GaXhlcyBpc3N1ZSBpbiBJRTEwIG9jY3VycmluZyB3aGVuIG5vIGRlZmF1bHQgb3B0aW9uIGlzIHNlbGVjdGVkIGFuZCBhdCBsZWFzdCBvbmUgb3B0aW9uIGlzIGRpc2FibGVkXG5cdFx0XHQvL0NvbnZlcnQgYWxsIHRoZSB2YWx1ZXMgaW50byBhIGNvbW1hIGRlbGltaXRlZCBzdHJpbmdcblx0XHRcdHZhciB0aXRsZSA9ICF0aGlzLm11bHRpcGxlID8gc2VsZWN0ZWRJdGVtc1swXSA6IHNlbGVjdGVkSXRlbXMuam9pbih0aGlzLm9wdGlvbnMubXVsdGlwbGVTZXBhcmF0b3IpO1xuXG5cdFx0XHQvL0lmIHRoaXMgaXMgbXVsdGkgc2VsZWN0LCBhbmQgdGhlIHNlbGVjdFRleHQgdHlwZSBpcyBjb3VudCwgdGhlIHNob3cgMSBvZiAyIHNlbGVjdGVkIGV0Yy4uXG5cdFx0XHRpZiAodGhpcy5tdWx0aXBsZSAmJiB0aGlzLm9wdGlvbnMuc2VsZWN0ZWRUZXh0Rm9ybWF0LmluZGV4T2YoJ2NvdW50JykgPiAtMSkge1xuXHRcdFx0XHR2YXIgbWF4ID0gdGhpcy5vcHRpb25zLnNlbGVjdGVkVGV4dEZvcm1hdC5zcGxpdCgnPicpO1xuXHRcdFx0XHRpZiAoKG1heC5sZW5ndGggPiAxICYmIHNlbGVjdGVkSXRlbXMubGVuZ3RoID4gbWF4WzFdKSB8fCAobWF4Lmxlbmd0aCA9PSAxICYmIHNlbGVjdGVkSXRlbXMubGVuZ3RoID49IDIpKSB7XG5cdFx0XHRcdFx0bm90RGlzYWJsZWQgPSB0aGlzLm9wdGlvbnMuaGlkZURpc2FibGVkID8gJywgW2Rpc2FibGVkXScgOiAnJztcblx0XHRcdFx0XHR2YXIgdG90YWxDb3VudCA9IHRoaXMuJGVsZW1lbnQuZmluZCgnb3B0aW9uJykubm90KCdbZGF0YS1kaXZpZGVyPVwidHJ1ZVwiXSwgW2RhdGEtaGlkZGVuPVwidHJ1ZVwiXScgKyBub3REaXNhYmxlZCkubGVuZ3RoLFxuXHRcdFx0XHRcdFx0dHI4blRleHQgPSAodHlwZW9mIHRoaXMub3B0aW9ucy5jb3VudFNlbGVjdGVkVGV4dCA9PT0gJ2Z1bmN0aW9uJykgPyB0aGlzLm9wdGlvbnMuY291bnRTZWxlY3RlZFRleHQoc2VsZWN0ZWRJdGVtcy5sZW5ndGgsIHRvdGFsQ291bnQpIDogdGhpcy5vcHRpb25zLmNvdW50U2VsZWN0ZWRUZXh0O1xuXHRcdFx0XHRcdHRpdGxlID0gdHI4blRleHQucmVwbGFjZSgnezB9Jywgc2VsZWN0ZWRJdGVtcy5sZW5ndGgudG9TdHJpbmcoKSkucmVwbGFjZSgnezF9JywgdG90YWxDb3VudC50b1N0cmluZygpKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLm9wdGlvbnMudGl0bGUgPSB0aGlzLiRlbGVtZW50LmF0dHIoJ3RpdGxlJyk7XG5cblx0XHRcdGlmICh0aGlzLm9wdGlvbnMuc2VsZWN0ZWRUZXh0Rm9ybWF0ID09ICdzdGF0aWMnKSB7XG5cdFx0XHRcdHRpdGxlID0gdGhpcy5vcHRpb25zLnRpdGxlO1xuXHRcdFx0fVxuXG5cdFx0XHQvL0lmIHdlIGRvbnQgaGF2ZSBhIHRpdGxlLCB0aGVuIHVzZSB0aGUgZGVmYXVsdCwgb3IgaWYgbm90aGluZyBpcyBzZXQgYXQgYWxsLCB1c2UgdGhlIG5vdCBzZWxlY3RlZCB0ZXh0XG5cdFx0XHRpZiAoIXRpdGxlKSB7XG5cdFx0XHRcdHRpdGxlID0gdHlwZW9mIHRoaXMub3B0aW9ucy50aXRsZSAhPT0gJ3VuZGVmaW5lZCcgPyB0aGlzLm9wdGlvbnMudGl0bGUgOiB0aGlzLm9wdGlvbnMubm9uZVNlbGVjdGVkVGV4dDtcblx0XHRcdH1cblxuXHRcdFx0dGhpcy4kYnV0dG9uLmF0dHIoJ3RpdGxlJywgJC50cmltKCQoXCI8ZGl2Lz5cIikuaHRtbCh0aXRsZSkudGV4dCgpKS5yZXBsYWNlKC9cXHNcXHMrL2csICcgJykpO1xuXHRcdFx0dGhpcy4kbmV3RWxlbWVudC5maW5kKCcuZmlsdGVyLW9wdGlvbicpLmh0bWwodGl0bGUpO1xuXHRcdH0sXG5cblx0XHQvKipcblx0XHQgKiBAcGFyYW0gW3N0eWxlXVxuXHRcdCAqIEBwYXJhbSBbc3RhdHVzXVxuXHRcdCAqL1xuXHRcdHNldFN0eWxlOiBmdW5jdGlvbihzdHlsZSwgc3RhdHVzKSB7XG5cdFx0XHRpZiAodGhpcy4kZWxlbWVudC5hdHRyKCdjbGFzcycpKSB7XG5cdFx0XHRcdHRoaXMuJG5ld0VsZW1lbnQuYWRkQ2xhc3ModGhpcy4kZWxlbWVudC5hdHRyKCdjbGFzcycpLnJlcGxhY2UoL3NlbGVjdHBpY2tlcnxtb2JpbGUtZGV2aWNlfHZhbGlkYXRlXFxbLipcXF0vZ2ksICcnKSk7XG5cdFx0XHR9XG5cblx0XHRcdHZhciBidXR0b25DbGFzcyA9IHN0eWxlID8gc3R5bGUgOiB0aGlzLm9wdGlvbnMuc3R5bGU7XG5cblx0XHRcdGlmIChzdGF0dXMgPT0gJ2FkZCcpIHtcblx0XHRcdFx0dGhpcy4kYnV0dG9uLmFkZENsYXNzKGJ1dHRvbkNsYXNzKTtcblx0XHRcdH0gZWxzZSBpZiAoc3RhdHVzID09ICdyZW1vdmUnKSB7XG5cdFx0XHRcdHRoaXMuJGJ1dHRvbi5yZW1vdmVDbGFzcyhidXR0b25DbGFzcyk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLiRidXR0b24ucmVtb3ZlQ2xhc3ModGhpcy5vcHRpb25zLnN0eWxlKTtcblx0XHRcdFx0dGhpcy4kYnV0dG9uLmFkZENsYXNzKGJ1dHRvbkNsYXNzKTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0bGlIZWlnaHQ6IGZ1bmN0aW9uKCkge1xuXHRcdFx0aWYgKHRoaXMub3B0aW9ucy5zaXplID09PSBmYWxzZSkgcmV0dXJuO1xuXG5cdFx0XHR2YXIgJHNlbGVjdENsb25lID0gdGhpcy4kbWVudS5wYXJlbnQoKS5jbG9uZSgpLmZpbmQoJz4gLmRyb3Bkb3duLXRvZ2dsZScpLnByb3AoJ2F1dG9mb2N1cycsIGZhbHNlKS5lbmQoKS5hcHBlbmRUbygnYm9keScpLFxuXHRcdFx0XHQkbWVudUNsb25lID0gJHNlbGVjdENsb25lLmFkZENsYXNzKCdvcGVuJykuZmluZCgnPiAuZHJvcGRvd24tbWVudScpLFxuXHRcdFx0XHRsaUhlaWdodCA9ICRtZW51Q2xvbmUuZmluZCgnbGknKS5ub3QoJy5kaXZpZGVyJykubm90KCcuZHJvcGRvd24taGVhZGVyJykuZmlsdGVyKCc6dmlzaWJsZScpLmNoaWxkcmVuKCdhJykub3V0ZXJIZWlnaHQoKSxcblx0XHRcdFx0aGVhZGVySGVpZ2h0ID0gdGhpcy5vcHRpb25zLmhlYWRlciA/ICRtZW51Q2xvbmUuZmluZCgnLnBvcG92ZXItdGl0bGUnKS5vdXRlckhlaWdodCgpIDogMCxcblx0XHRcdFx0c2VhcmNoSGVpZ2h0ID0gdGhpcy5vcHRpb25zLmxpdmVTZWFyY2ggPyAkbWVudUNsb25lLmZpbmQoJy5icy1zZWFyY2hib3gnKS5vdXRlckhlaWdodCgpIDogMCxcblx0XHRcdFx0YWN0aW9uc0hlaWdodCA9IHRoaXMub3B0aW9ucy5hY3Rpb25zQm94ID8gJG1lbnVDbG9uZS5maW5kKCcuYnMtYWN0aW9uc2JveCcpLm91dGVySGVpZ2h0KCkgOiAwO1xuXG5cdFx0XHQkc2VsZWN0Q2xvbmUucmVtb3ZlKCk7XG5cblx0XHRcdHRoaXMuJG5ld0VsZW1lbnRcblx0XHRcdFx0LmRhdGEoJ2xpSGVpZ2h0JywgbGlIZWlnaHQpXG5cdFx0XHRcdC5kYXRhKCdoZWFkZXJIZWlnaHQnLCBoZWFkZXJIZWlnaHQpXG5cdFx0XHRcdC5kYXRhKCdzZWFyY2hIZWlnaHQnLCBzZWFyY2hIZWlnaHQpXG5cdFx0XHRcdC5kYXRhKCdhY3Rpb25zSGVpZ2h0JywgYWN0aW9uc0hlaWdodCk7XG5cdFx0fSxcblxuXHRcdHNldFNpemU6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dGhpcy5maW5kTGlzKCk7XG5cdFx0XHR2YXIgdGhhdCA9IHRoaXMsXG5cdFx0XHRcdG1lbnUgPSB0aGlzLiRtZW51LFxuXHRcdFx0XHRtZW51SW5uZXIgPSBtZW51LmZpbmQoJy5pbm5lcicpLFxuXHRcdFx0XHRzZWxlY3RIZWlnaHQgPSB0aGlzLiRuZXdFbGVtZW50Lm91dGVySGVpZ2h0KCksXG5cdFx0XHRcdGxpSGVpZ2h0ID0gdGhpcy4kbmV3RWxlbWVudC5kYXRhKCdsaUhlaWdodCcpLFxuXHRcdFx0XHRoZWFkZXJIZWlnaHQgPSB0aGlzLiRuZXdFbGVtZW50LmRhdGEoJ2hlYWRlckhlaWdodCcpLFxuXHRcdFx0XHRzZWFyY2hIZWlnaHQgPSB0aGlzLiRuZXdFbGVtZW50LmRhdGEoJ3NlYXJjaEhlaWdodCcpLFxuXHRcdFx0XHRhY3Rpb25zSGVpZ2h0ID0gdGhpcy4kbmV3RWxlbWVudC5kYXRhKCdhY3Rpb25zSGVpZ2h0JyksXG5cdFx0XHRcdGRpdkhlaWdodCA9IHRoaXMuJGxpcy5maWx0ZXIoJy5kaXZpZGVyJykub3V0ZXJIZWlnaHQodHJ1ZSksXG5cdFx0XHRcdG1lbnVQYWRkaW5nID0gcGFyc2VJbnQobWVudS5jc3MoJ3BhZGRpbmctdG9wJykpICtcblx0XHRcdFx0cGFyc2VJbnQobWVudS5jc3MoJ3BhZGRpbmctYm90dG9tJykpICtcblx0XHRcdFx0cGFyc2VJbnQobWVudS5jc3MoJ2JvcmRlci10b3Atd2lkdGgnKSkgK1xuXHRcdFx0XHRwYXJzZUludChtZW51LmNzcygnYm9yZGVyLWJvdHRvbS13aWR0aCcpKSxcblx0XHRcdFx0bm90RGlzYWJsZWQgPSB0aGlzLm9wdGlvbnMuaGlkZURpc2FibGVkID8gJywgLmRpc2FibGVkJyA6ICcnLFxuXHRcdFx0XHQkd2luZG93ID0gJCh3aW5kb3cpLFxuXHRcdFx0XHRtZW51RXh0cmFzID0gbWVudVBhZGRpbmcgKyBwYXJzZUludChtZW51LmNzcygnbWFyZ2luLXRvcCcpKSArIHBhcnNlSW50KG1lbnUuY3NzKCdtYXJnaW4tYm90dG9tJykpICsgMixcblx0XHRcdFx0bWVudUhlaWdodCxcblx0XHRcdFx0c2VsZWN0T2Zmc2V0VG9wLFxuXHRcdFx0XHRzZWxlY3RPZmZzZXRCb3QsXG5cdFx0XHRcdHBvc1ZlcnQgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHQvLyBKUXVlcnkgZGVmaW5lcyBhIHNjcm9sbFRvcCBmdW5jdGlvbiwgYnV0IGluIHB1cmUgSlMgaXQncyBhIHByb3BlcnR5XG5cdFx0XHRcdFx0Ly9ub2luc3BlY3Rpb24gSlNWYWxpZGF0ZVR5cGVzXG5cdFx0XHRcdFx0c2VsZWN0T2Zmc2V0VG9wID0gdGhhdC4kbmV3RWxlbWVudC5vZmZzZXQoKS50b3AgLSAkd2luZG93LnNjcm9sbFRvcCgpO1xuXHRcdFx0XHRcdHNlbGVjdE9mZnNldEJvdCA9ICR3aW5kb3cuaGVpZ2h0KCkgLSBzZWxlY3RPZmZzZXRUb3AgLSBzZWxlY3RIZWlnaHQ7XG5cdFx0XHRcdH07XG5cdFx0XHRwb3NWZXJ0KCk7XG5cdFx0XHRpZiAodGhpcy5vcHRpb25zLmhlYWRlcikgbWVudS5jc3MoJ3BhZGRpbmctdG9wJywgMCk7XG5cblx0XHRcdGlmICh0aGlzLm9wdGlvbnMuc2l6ZSA9PSAnYXV0bycpIHtcblx0XHRcdFx0dmFyIGdldFNpemUgPSBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHR2YXIgbWluSGVpZ2h0LFxuXHRcdFx0XHRcdFx0bGlzVmlzID0gdGhhdC4kbGlzLm5vdCgnLmhpZGUnKTtcblxuXHRcdFx0XHRcdHBvc1ZlcnQoKTtcblx0XHRcdFx0XHRtZW51SGVpZ2h0ID0gc2VsZWN0T2Zmc2V0Qm90IC0gbWVudUV4dHJhcztcblxuXHRcdFx0XHRcdGlmICh0aGF0Lm9wdGlvbnMuZHJvcHVwQXV0bykge1xuXHRcdFx0XHRcdFx0dGhhdC4kbmV3RWxlbWVudC50b2dnbGVDbGFzcygnZHJvcHVwJywgKHNlbGVjdE9mZnNldFRvcCA+IHNlbGVjdE9mZnNldEJvdCkgJiYgKChtZW51SGVpZ2h0IC0gbWVudUV4dHJhcykgPCBtZW51LmhlaWdodCgpKSk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmICh0aGF0LiRuZXdFbGVtZW50Lmhhc0NsYXNzKCdkcm9wdXAnKSkge1xuXHRcdFx0XHRcdFx0bWVudUhlaWdodCA9IHNlbGVjdE9mZnNldFRvcCAtIG1lbnVFeHRyYXM7XG5cdFx0XHRcdFx0fVxuXG5cdFx0XHRcdFx0aWYgKChsaXNWaXMubGVuZ3RoICsgbGlzVmlzLmZpbHRlcignLmRyb3Bkb3duLWhlYWRlcicpLmxlbmd0aCkgPiAzKSB7XG5cdFx0XHRcdFx0XHRtaW5IZWlnaHQgPSBsaUhlaWdodCAqIDMgKyBtZW51RXh0cmFzIC0gMjtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0bWluSGVpZ2h0ID0gMDtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRtZW51LmNzcyh7XG5cdFx0XHRcdFx0XHQnbWF4LWhlaWdodCc6IG1lbnVIZWlnaHQgKyAncHgnLFxuXHRcdFx0XHRcdFx0J292ZXJmbG93JzogJ2hpZGRlbicsXG5cdFx0XHRcdFx0XHQnbWluLWhlaWdodCc6IG1pbkhlaWdodCArIGhlYWRlckhlaWdodCArIHNlYXJjaEhlaWdodCArIGFjdGlvbnNIZWlnaHQgKyAncHgnXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0bWVudUlubmVyLmNzcyh7XG5cdFx0XHRcdFx0XHQnbWF4LWhlaWdodCc6IG1lbnVIZWlnaHQgLSBoZWFkZXJIZWlnaHQgLSBzZWFyY2hIZWlnaHQgLSBhY3Rpb25zSGVpZ2h0IC0gbWVudVBhZGRpbmcgKyAncHgnLFxuXHRcdFx0XHRcdFx0J292ZXJmbG93LXknOiAnYXV0bycsXG5cdFx0XHRcdFx0XHQnbWluLWhlaWdodCc6IE1hdGgubWF4KG1pbkhlaWdodCAtIG1lbnVQYWRkaW5nLCAwKSArICdweCdcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fTtcblx0XHRcdFx0Z2V0U2l6ZSgpO1xuXHRcdFx0XHR0aGlzLiRzZWFyY2hib3gub2ZmKCdpbnB1dC5nZXRTaXplIHByb3BlcnR5Y2hhbmdlLmdldFNpemUnKS5vbignaW5wdXQuZ2V0U2l6ZSBwcm9wZXJ0eWNoYW5nZS5nZXRTaXplJywgZ2V0U2l6ZSk7XG5cdFx0XHRcdCQod2luZG93KS5vZmYoJ3Jlc2l6ZS5nZXRTaXplJykub24oJ3Jlc2l6ZS5nZXRTaXplJywgZ2V0U2l6ZSk7XG5cdFx0XHRcdCQod2luZG93KS5vZmYoJ3Njcm9sbC5nZXRTaXplJykub24oJ3Njcm9sbC5nZXRTaXplJywgZ2V0U2l6ZSk7XG5cdFx0XHR9IGVsc2UgaWYgKHRoaXMub3B0aW9ucy5zaXplICYmIHRoaXMub3B0aW9ucy5zaXplICE9ICdhdXRvJyAmJiBtZW51LmZpbmQoJ2xpJyArIG5vdERpc2FibGVkKS5sZW5ndGggPiB0aGlzLm9wdGlvbnMuc2l6ZSkge1xuXHRcdFx0XHR2YXIgb3B0SW5kZXggPSB0aGlzLiRsaXMubm90KCcuZGl2aWRlcicgKyBub3REaXNhYmxlZCkuZmluZCgnID4gKicpLnNsaWNlKDAsIHRoaXMub3B0aW9ucy5zaXplKS5sYXN0KCkucGFyZW50KCkuaW5kZXgoKTtcblx0XHRcdFx0dmFyIGRpdkxlbmd0aCA9IHRoaXMuJGxpcy5zbGljZSgwLCBvcHRJbmRleCArIDEpLmZpbHRlcignLmRpdmlkZXInKS5sZW5ndGg7XG5cdFx0XHRcdG1lbnVIZWlnaHQgPSBsaUhlaWdodCAqIHRoaXMub3B0aW9ucy5zaXplICsgZGl2TGVuZ3RoICogZGl2SGVpZ2h0ICsgbWVudVBhZGRpbmc7XG5cdFx0XHRcdGlmICh0aGF0Lm9wdGlvbnMuZHJvcHVwQXV0bykge1xuXHRcdFx0XHRcdC8vbm9pbnNwZWN0aW9uIEpTVW51c2VkQXNzaWdubWVudFxuXHRcdFx0XHRcdHRoaXMuJG5ld0VsZW1lbnQudG9nZ2xlQ2xhc3MoJ2Ryb3B1cCcsIChzZWxlY3RPZmZzZXRUb3AgPiBzZWxlY3RPZmZzZXRCb3QpICYmIChtZW51SGVpZ2h0IDwgbWVudS5oZWlnaHQoKSkpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdG1lbnUuY3NzKHtcblx0XHRcdFx0XHQnbWF4LWhlaWdodCc6IG1lbnVIZWlnaHQgKyBoZWFkZXJIZWlnaHQgKyBzZWFyY2hIZWlnaHQgKyBhY3Rpb25zSGVpZ2h0ICsgJ3B4Jyxcblx0XHRcdFx0XHQnb3ZlcmZsb3cnOiAnaGlkZGVuJ1xuXHRcdFx0XHR9KTtcblx0XHRcdFx0bWVudUlubmVyLmNzcyh7XG5cdFx0XHRcdFx0J21heC1oZWlnaHQnOiBtZW51SGVpZ2h0IC0gbWVudVBhZGRpbmcgKyAncHgnLFxuXHRcdFx0XHRcdCdvdmVyZmxvdy15JzogJ2F1dG8nXG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHRzZXRXaWR0aDogZnVuY3Rpb24oKSB7XG5cdFx0XHRpZiAodGhpcy5vcHRpb25zLndpZHRoID09ICdhdXRvJykge1xuXHRcdFx0XHR0aGlzLiRtZW51LmNzcygnbWluLXdpZHRoJywgJzAnKTtcblxuXHRcdFx0XHQvLyBHZXQgY29ycmVjdCB3aWR0aCBpZiBlbGVtZW50IGhpZGRlblxuXHRcdFx0XHR2YXIgc2VsZWN0Q2xvbmUgPSB0aGlzLiRuZXdFbGVtZW50LmNsb25lKCkuYXBwZW5kVG8oJ2JvZHknKTtcblx0XHRcdFx0dmFyIHVsV2lkdGggPSBzZWxlY3RDbG9uZS5maW5kKCc+IC5kcm9wZG93bi1tZW51JykuY3NzKCd3aWR0aCcpO1xuXHRcdFx0XHR2YXIgYnRuV2lkdGggPSBzZWxlY3RDbG9uZS5jc3MoJ3dpZHRoJywgJ2F1dG8nKS5maW5kKCc+IGJ1dHRvbicpLmNzcygnd2lkdGgnKTtcblx0XHRcdFx0c2VsZWN0Q2xvbmUucmVtb3ZlKCk7XG5cblx0XHRcdFx0Ly8gU2V0IHdpZHRoIHRvIHdoYXRldmVyJ3MgbGFyZ2VyLCBidXR0b24gdGl0bGUgb3IgbG9uZ2VzdCBvcHRpb25cblx0XHRcdFx0dGhpcy4kbmV3RWxlbWVudC5jc3MoJ3dpZHRoJywgTWF0aC5tYXgocGFyc2VJbnQodWxXaWR0aCksIHBhcnNlSW50KGJ0bldpZHRoKSkgKyAncHgnKTtcblx0XHRcdH0gZWxzZSBpZiAodGhpcy5vcHRpb25zLndpZHRoID09ICdmaXQnKSB7XG5cdFx0XHRcdC8vIFJlbW92ZSBpbmxpbmUgbWluLXdpZHRoIHNvIHdpZHRoIGNhbiBiZSBjaGFuZ2VkIGZyb20gJ2F1dG8nXG5cdFx0XHRcdHRoaXMuJG1lbnUuY3NzKCdtaW4td2lkdGgnLCAnJyk7XG5cdFx0XHRcdHRoaXMuJG5ld0VsZW1lbnQuY3NzKCd3aWR0aCcsICcnKS5hZGRDbGFzcygnZml0LXdpZHRoJyk7XG5cdFx0XHR9IGVsc2UgaWYgKHRoaXMub3B0aW9ucy53aWR0aCkge1xuXHRcdFx0XHQvLyBSZW1vdmUgaW5saW5lIG1pbi13aWR0aCBzbyB3aWR0aCBjYW4gYmUgY2hhbmdlZCBmcm9tICdhdXRvJ1xuXHRcdFx0XHR0aGlzLiRtZW51LmNzcygnbWluLXdpZHRoJywgJycpO1xuXHRcdFx0XHR0aGlzLiRuZXdFbGVtZW50LmNzcygnd2lkdGgnLCB0aGlzLm9wdGlvbnMud2lkdGgpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly8gUmVtb3ZlIGlubGluZSBtaW4td2lkdGgvd2lkdGggc28gd2lkdGggY2FuIGJlIGNoYW5nZWRcblx0XHRcdFx0dGhpcy4kbWVudS5jc3MoJ21pbi13aWR0aCcsICcnKTtcblx0XHRcdFx0dGhpcy4kbmV3RWxlbWVudC5jc3MoJ3dpZHRoJywgJycpO1xuXHRcdFx0fVxuXHRcdFx0Ly8gUmVtb3ZlIGZpdC13aWR0aCBjbGFzcyBpZiB3aWR0aCBpcyBjaGFuZ2VkIHByb2dyYW1tYXRpY2FsbHlcblx0XHRcdGlmICh0aGlzLiRuZXdFbGVtZW50Lmhhc0NsYXNzKCdmaXQtd2lkdGgnKSAmJiB0aGlzLm9wdGlvbnMud2lkdGggIT09ICdmaXQnKSB7XG5cdFx0XHRcdHRoaXMuJG5ld0VsZW1lbnQucmVtb3ZlQ2xhc3MoJ2ZpdC13aWR0aCcpO1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHRzZWxlY3RQb3NpdGlvbjogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgdGhhdCA9IHRoaXMsXG5cdFx0XHRcdGRyb3AgPSAnPGRpdiAvPicsXG5cdFx0XHRcdCRkcm9wID0gJChkcm9wKSxcblx0XHRcdFx0cG9zLFxuXHRcdFx0XHRhY3R1YWxIZWlnaHQsXG5cdFx0XHRcdGdldFBsYWNlbWVudCA9IGZ1bmN0aW9uKCRlbGVtZW50KSB7XG5cdFx0XHRcdFx0JGRyb3AuYWRkQ2xhc3MoJGVsZW1lbnQuYXR0cignY2xhc3MnKS5yZXBsYWNlKC9mb3JtLWNvbnRyb2wvZ2ksICcnKSkudG9nZ2xlQ2xhc3MoJ2Ryb3B1cCcsICRlbGVtZW50Lmhhc0NsYXNzKCdkcm9wdXAnKSk7XG5cdFx0XHRcdFx0cG9zID0gJGVsZW1lbnQub2Zmc2V0KCk7XG5cdFx0XHRcdFx0YWN0dWFsSGVpZ2h0ID0gJGVsZW1lbnQuaGFzQ2xhc3MoJ2Ryb3B1cCcpID8gMCA6ICRlbGVtZW50WzBdLm9mZnNldEhlaWdodDtcblx0XHRcdFx0XHQkZHJvcC5jc3Moe1xuXHRcdFx0XHRcdFx0J3RvcCc6IHBvcy50b3AgKyBhY3R1YWxIZWlnaHQsXG5cdFx0XHRcdFx0XHQnbGVmdCc6IHBvcy5sZWZ0LFxuXHRcdFx0XHRcdFx0J3dpZHRoJzogJGVsZW1lbnRbMF0ub2Zmc2V0V2lkdGgsXG5cdFx0XHRcdFx0XHQncG9zaXRpb24nOiAnYWJzb2x1dGUnXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH07XG5cdFx0XHR0aGlzLiRuZXdFbGVtZW50Lm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRpZiAodGhhdC5pc0Rpc2FibGVkKCkpIHtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblx0XHRcdFx0Z2V0UGxhY2VtZW50KCQodGhpcykpO1xuXHRcdFx0XHQkZHJvcC5hcHBlbmRUbyh0aGF0Lm9wdGlvbnMuY29udGFpbmVyKTtcblx0XHRcdFx0JGRyb3AudG9nZ2xlQ2xhc3MoJ29wZW4nLCAhJCh0aGlzKS5oYXNDbGFzcygnb3BlbicpKTtcblx0XHRcdFx0JGRyb3AuYXBwZW5kKHRoYXQuJG1lbnUpO1xuXHRcdFx0fSk7XG5cdFx0XHQkKHdpbmRvdykucmVzaXplKGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRnZXRQbGFjZW1lbnQodGhhdC4kbmV3RWxlbWVudCk7XG5cdFx0XHR9KTtcblx0XHRcdCQod2luZG93KS5vbignc2Nyb2xsJywgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdGdldFBsYWNlbWVudCh0aGF0LiRuZXdFbGVtZW50KTtcblx0XHRcdH0pO1xuXHRcdFx0JCgnaHRtbCcpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0aWYgKCQoZS50YXJnZXQpLmNsb3Nlc3QodGhhdC4kbmV3RWxlbWVudCkubGVuZ3RoIDwgMSkge1xuXHRcdFx0XHRcdCRkcm9wLnJlbW92ZUNsYXNzKCdvcGVuJyk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH0sXG5cblx0XHRzZXRTZWxlY3RlZDogZnVuY3Rpb24oaW5kZXgsIHNlbGVjdGVkKSB7XG5cdFx0XHR0aGlzLmZpbmRMaXMoKTtcblx0XHRcdHRoaXMuJGxpcy5maWx0ZXIoJ1tkYXRhLW9yaWdpbmFsLWluZGV4PVwiJyArIGluZGV4ICsgJ1wiXScpLnRvZ2dsZUNsYXNzKCdzZWxlY3RlZCcsIHNlbGVjdGVkKTtcblx0XHR9LFxuXG5cdFx0c2V0RGlzYWJsZWQ6IGZ1bmN0aW9uKGluZGV4LCBkaXNhYmxlZCkge1xuXHRcdFx0dGhpcy5maW5kTGlzKCk7XG5cdFx0XHRpZiAoZGlzYWJsZWQpIHtcblx0XHRcdFx0dGhpcy4kbGlzLmZpbHRlcignW2RhdGEtb3JpZ2luYWwtaW5kZXg9XCInICsgaW5kZXggKyAnXCJdJykuYWRkQ2xhc3MoJ2Rpc2FibGVkJykuZmluZCgnYScpLmF0dHIoJ2hyZWYnLCAnIycpLmF0dHIoJ3RhYmluZGV4JywgLTEpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy4kbGlzLmZpbHRlcignW2RhdGEtb3JpZ2luYWwtaW5kZXg9XCInICsgaW5kZXggKyAnXCJdJykucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJykuZmluZCgnYScpLnJlbW92ZUF0dHIoJ2hyZWYnKS5hdHRyKCd0YWJpbmRleCcsIDApO1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHRpc0Rpc2FibGVkOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLiRlbGVtZW50LmlzKCc6ZGlzYWJsZWQnKTtcblx0XHR9LFxuXG5cdFx0Y2hlY2tEaXNhYmxlZDogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgdGhhdCA9IHRoaXM7XG5cblx0XHRcdGlmICh0aGlzLmlzRGlzYWJsZWQoKSkge1xuXHRcdFx0XHR0aGlzLiRidXR0b24uYWRkQ2xhc3MoJ2Rpc2FibGVkJykuYXR0cigndGFiaW5kZXgnLCAtMSk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpZiAodGhpcy4kYnV0dG9uLmhhc0NsYXNzKCdkaXNhYmxlZCcpKSB7XG5cdFx0XHRcdFx0dGhpcy4kYnV0dG9uLnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0aWYgKHRoaXMuJGJ1dHRvbi5hdHRyKCd0YWJpbmRleCcpID09IC0xKSB7XG5cdFx0XHRcdFx0aWYgKCF0aGlzLiRlbGVtZW50LmRhdGEoJ3RhYmluZGV4JykpIHRoaXMuJGJ1dHRvbi5yZW1vdmVBdHRyKCd0YWJpbmRleCcpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdHRoaXMuJGJ1dHRvbi5jbGljayhmdW5jdGlvbigpIHtcblx0XHRcdFx0cmV0dXJuICF0aGF0LmlzRGlzYWJsZWQoKTtcblx0XHRcdH0pO1xuXHRcdH0sXG5cblx0XHR0YWJJbmRleDogZnVuY3Rpb24oKSB7XG5cdFx0XHRpZiAodGhpcy4kZWxlbWVudC5pcygnW3RhYmluZGV4XScpKSB7XG5cdFx0XHRcdHRoaXMuJGVsZW1lbnQuZGF0YSgndGFiaW5kZXgnLCB0aGlzLiRlbGVtZW50LmF0dHIoJ3RhYmluZGV4JykpO1xuXHRcdFx0XHR0aGlzLiRidXR0b24uYXR0cigndGFiaW5kZXgnLCB0aGlzLiRlbGVtZW50LmRhdGEoJ3RhYmluZGV4JykpO1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHRjbGlja0xpc3RlbmVyOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciB0aGF0ID0gdGhpcztcblxuXHRcdFx0dGhpcy4kbmV3RWxlbWVudC5vbigndG91Y2hzdGFydC5kcm9wZG93bicsICcuZHJvcGRvd24tbWVudScsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLiRuZXdFbGVtZW50Lm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR0aGF0LnNldFNpemUoKTtcblx0XHRcdFx0aWYgKCF0aGF0Lm9wdGlvbnMubGl2ZVNlYXJjaCAmJiAhdGhhdC5tdWx0aXBsZSkge1xuXHRcdFx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHR0aGF0LiRtZW51LmZpbmQoJy5zZWxlY3RlZCBhJykuZm9jdXMoKTtcblx0XHRcdFx0XHR9LCAxMCk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLiRtZW51Lm9uKCdjbGljaycsICdsaSBhJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHR2YXIgJHRoaXMgPSAkKHRoaXMpLFxuXHRcdFx0XHRcdGNsaWNrZWRJbmRleCA9ICR0aGlzLnBhcmVudCgpLmRhdGEoJ29yaWdpbmFsSW5kZXgnKSxcblx0XHRcdFx0XHRwcmV2VmFsdWUgPSB0aGF0LiRlbGVtZW50LnZhbCgpLFxuXHRcdFx0XHRcdHByZXZJbmRleCA9IHRoYXQuJGVsZW1lbnQucHJvcCgnc2VsZWN0ZWRJbmRleCcpO1xuXG5cdFx0XHRcdC8vIERvbid0IGNsb3NlIG9uIG11bHRpIGNob2ljZSBtZW51XG5cdFx0XHRcdGlmICh0aGF0Lm11bHRpcGxlKSB7XG5cdFx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblxuXHRcdFx0XHQvL0Rvbid0IHJ1biBpZiB3ZSBoYXZlIGJlZW4gZGlzYWJsZWRcblx0XHRcdFx0aWYgKCF0aGF0LmlzRGlzYWJsZWQoKSAmJiAhJHRoaXMucGFyZW50KCkuaGFzQ2xhc3MoJ2Rpc2FibGVkJykpIHtcblx0XHRcdFx0XHR2YXIgJG9wdGlvbnMgPSB0aGF0LiRlbGVtZW50LmZpbmQoJ29wdGlvbicpLFxuXHRcdFx0XHRcdFx0JG9wdGlvbiA9ICRvcHRpb25zLmVxKGNsaWNrZWRJbmRleCksXG5cdFx0XHRcdFx0XHRzdGF0ZSA9ICRvcHRpb24ucHJvcCgnc2VsZWN0ZWQnKSxcblx0XHRcdFx0XHRcdCRvcHRncm91cCA9ICRvcHRpb24ucGFyZW50KCdvcHRncm91cCcpLFxuXHRcdFx0XHRcdFx0bWF4T3B0aW9ucyA9IHRoYXQub3B0aW9ucy5tYXhPcHRpb25zLFxuXHRcdFx0XHRcdFx0bWF4T3B0aW9uc0dycCA9ICRvcHRncm91cC5kYXRhKCdtYXhPcHRpb25zJykgfHwgZmFsc2U7XG5cblx0XHRcdFx0XHRpZiAoIXRoYXQubXVsdGlwbGUpIHsgLy8gRGVzZWxlY3QgYWxsIG90aGVycyBpZiBub3QgbXVsdGkgc2VsZWN0IGJveFxuXHRcdFx0XHRcdFx0JG9wdGlvbnMucHJvcCgnc2VsZWN0ZWQnLCBmYWxzZSk7XG5cdFx0XHRcdFx0XHQkb3B0aW9uLnByb3AoJ3NlbGVjdGVkJywgdHJ1ZSk7XG5cdFx0XHRcdFx0XHR0aGF0LiRtZW51LmZpbmQoJy5zZWxlY3RlZCcpLnJlbW92ZUNsYXNzKCdzZWxlY3RlZCcpO1xuXHRcdFx0XHRcdFx0dGhhdC5zZXRTZWxlY3RlZChjbGlja2VkSW5kZXgsIHRydWUpO1xuXHRcdFx0XHRcdH0gZWxzZSB7IC8vIFRvZ2dsZSB0aGUgb25lIHdlIGhhdmUgY2hvc2VuIGlmIHdlIGFyZSBtdWx0aSBzZWxlY3QuXG5cdFx0XHRcdFx0XHQkb3B0aW9uLnByb3AoJ3NlbGVjdGVkJywgIXN0YXRlKTtcblx0XHRcdFx0XHRcdHRoYXQuc2V0U2VsZWN0ZWQoY2xpY2tlZEluZGV4LCAhc3RhdGUpO1xuXHRcdFx0XHRcdFx0JHRoaXMuYmx1cigpO1xuXG5cdFx0XHRcdFx0XHRpZiAoKG1heE9wdGlvbnMgIT09IGZhbHNlKSB8fCAobWF4T3B0aW9uc0dycCAhPT0gZmFsc2UpKSB7XG5cdFx0XHRcdFx0XHRcdHZhciBtYXhSZWFjaGVkID0gbWF4T3B0aW9ucyA8ICRvcHRpb25zLmZpbHRlcignOnNlbGVjdGVkJykubGVuZ3RoLFxuXHRcdFx0XHRcdFx0XHRcdG1heFJlYWNoZWRHcnAgPSBtYXhPcHRpb25zR3JwIDwgJG9wdGdyb3VwLmZpbmQoJ29wdGlvbjpzZWxlY3RlZCcpLmxlbmd0aDtcblxuXHRcdFx0XHRcdFx0XHRpZiAoKG1heE9wdGlvbnMgJiYgbWF4UmVhY2hlZCkgfHwgKG1heE9wdGlvbnNHcnAgJiYgbWF4UmVhY2hlZEdycCkpIHtcblx0XHRcdFx0XHRcdFx0XHRpZiAobWF4T3B0aW9ucyAmJiBtYXhPcHRpb25zID09IDEpIHtcblx0XHRcdFx0XHRcdFx0XHRcdCRvcHRpb25zLnByb3AoJ3NlbGVjdGVkJywgZmFsc2UpO1xuXHRcdFx0XHRcdFx0XHRcdFx0JG9wdGlvbi5wcm9wKCdzZWxlY3RlZCcsIHRydWUpO1xuXHRcdFx0XHRcdFx0XHRcdFx0dGhhdC4kbWVudS5maW5kKCcuc2VsZWN0ZWQnKS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcblx0XHRcdFx0XHRcdFx0XHRcdHRoYXQuc2V0U2VsZWN0ZWQoY2xpY2tlZEluZGV4LCB0cnVlKTtcblx0XHRcdFx0XHRcdFx0XHR9IGVsc2UgaWYgKG1heE9wdGlvbnNHcnAgJiYgbWF4T3B0aW9uc0dycCA9PSAxKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHQkb3B0Z3JvdXAuZmluZCgnb3B0aW9uOnNlbGVjdGVkJykucHJvcCgnc2VsZWN0ZWQnLCBmYWxzZSk7XG5cdFx0XHRcdFx0XHRcdFx0XHQkb3B0aW9uLnByb3AoJ3NlbGVjdGVkJywgdHJ1ZSk7XG5cdFx0XHRcdFx0XHRcdFx0XHR2YXIgb3B0Z3JvdXBJRCA9ICR0aGlzLmRhdGEoJ29wdGdyb3VwJyk7XG5cblx0XHRcdFx0XHRcdFx0XHRcdHRoYXQuJG1lbnUuZmluZCgnLnNlbGVjdGVkJykuaGFzKCdhW2RhdGEtb3B0Z3JvdXA9XCInICsgb3B0Z3JvdXBJRCArICdcIl0nKS5yZW1vdmVDbGFzcygnc2VsZWN0ZWQnKTtcblxuXHRcdFx0XHRcdFx0XHRcdFx0dGhhdC5zZXRTZWxlY3RlZChjbGlja2VkSW5kZXgsIHRydWUpO1xuXHRcdFx0XHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRcdFx0XHR2YXIgbWF4T3B0aW9uc0FyciA9ICh0eXBlb2YgdGhhdC5vcHRpb25zLm1heE9wdGlvbnNUZXh0ID09PSAnZnVuY3Rpb24nKSA/XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHRoYXQub3B0aW9ucy5tYXhPcHRpb25zVGV4dChtYXhPcHRpb25zLCBtYXhPcHRpb25zR3JwKSA6IHRoYXQub3B0aW9ucy5tYXhPcHRpb25zVGV4dCxcblx0XHRcdFx0XHRcdFx0XHRcdFx0bWF4VHh0ID0gbWF4T3B0aW9uc0FyclswXS5yZXBsYWNlKCd7bn0nLCBtYXhPcHRpb25zKSxcblx0XHRcdFx0XHRcdFx0XHRcdFx0bWF4VHh0R3JwID0gbWF4T3B0aW9uc0FyclsxXS5yZXBsYWNlKCd7bn0nLCBtYXhPcHRpb25zR3JwKSxcblx0XHRcdFx0XHRcdFx0XHRcdFx0JG5vdGlmeSA9ICQoJzxkaXYgY2xhc3M9XCJub3RpZnlcIj48L2Rpdj4nKTtcblx0XHRcdFx0XHRcdFx0XHRcdC8vIElmIHt2YXJ9IGlzIHNldCBpbiBhcnJheSwgcmVwbGFjZSBpdFxuXHRcdFx0XHRcdFx0XHRcdFx0LyoqIEBkZXByZWNhdGVkICovXG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAobWF4T3B0aW9uc0FyclsyXSkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHRtYXhUeHQgPSBtYXhUeHQucmVwbGFjZSgne3Zhcn0nLCBtYXhPcHRpb25zQXJyWzJdW21heE9wdGlvbnMgPiAxID8gMCA6IDFdKTtcblx0XHRcdFx0XHRcdFx0XHRcdFx0bWF4VHh0R3JwID0gbWF4VHh0R3JwLnJlcGxhY2UoJ3t2YXJ9JywgbWF4T3B0aW9uc0FyclsyXVttYXhPcHRpb25zR3JwID4gMSA/IDAgOiAxXSk7XG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRcdCRvcHRpb24ucHJvcCgnc2VsZWN0ZWQnLCBmYWxzZSk7XG5cblx0XHRcdFx0XHRcdFx0XHRcdHRoYXQuJG1lbnUuYXBwZW5kKCRub3RpZnkpO1xuXG5cdFx0XHRcdFx0XHRcdFx0XHRpZiAobWF4T3B0aW9ucyAmJiBtYXhSZWFjaGVkKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdCRub3RpZnkuYXBwZW5kKCQoJzxkaXY+JyArIG1heFR4dCArICc8L2Rpdj4nKSk7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHRoYXQuJGVsZW1lbnQudHJpZ2dlcignbWF4UmVhY2hlZC5icy5zZWxlY3QnKTtcblx0XHRcdFx0XHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdFx0XHRcdFx0aWYgKG1heE9wdGlvbnNHcnAgJiYgbWF4UmVhY2hlZEdycCkge1xuXHRcdFx0XHRcdFx0XHRcdFx0XHQkbm90aWZ5LmFwcGVuZCgkKCc8ZGl2PicgKyBtYXhUeHRHcnAgKyAnPC9kaXY+JykpO1xuXHRcdFx0XHRcdFx0XHRcdFx0XHR0aGF0LiRlbGVtZW50LnRyaWdnZXIoJ21heFJlYWNoZWRHcnAuYnMuc2VsZWN0Jyk7XG5cdFx0XHRcdFx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRcdFx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdHRoYXQuc2V0U2VsZWN0ZWQoY2xpY2tlZEluZGV4LCBmYWxzZSk7XG5cdFx0XHRcdFx0XHRcdFx0XHR9LCAxMCk7XG5cblx0XHRcdFx0XHRcdFx0XHRcdCRub3RpZnkuZGVsYXkoNzUwKS5mYWRlT3V0KDMwMCwgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0XHRcdFx0XHRcdCQodGhpcykucmVtb3ZlKCk7XG5cdFx0XHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoIXRoYXQubXVsdGlwbGUpIHtcblx0XHRcdFx0XHRcdHRoYXQuJGJ1dHRvbi5mb2N1cygpO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAodGhhdC5vcHRpb25zLmxpdmVTZWFyY2gpIHtcblx0XHRcdFx0XHRcdHRoYXQuJHNlYXJjaGJveC5mb2N1cygpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdC8vIFRyaWdnZXIgc2VsZWN0ICdjaGFuZ2UnXG5cdFx0XHRcdFx0aWYgKChwcmV2VmFsdWUgIT0gdGhhdC4kZWxlbWVudC52YWwoKSAmJiB0aGF0Lm11bHRpcGxlKSB8fCAocHJldkluZGV4ICE9IHRoYXQuJGVsZW1lbnQucHJvcCgnc2VsZWN0ZWRJbmRleCcpICYmICF0aGF0Lm11bHRpcGxlKSkge1xuXHRcdFx0XHRcdFx0dGhhdC4kZWxlbWVudC5jaGFuZ2UoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLiRtZW51Lm9uKCdjbGljaycsICdsaS5kaXNhYmxlZCBhLCAucG9wb3Zlci10aXRsZSwgLnBvcG92ZXItdGl0bGUgOm5vdCguY2xvc2UpJywgZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRpZiAoZS50YXJnZXQgPT0gdGhpcykge1xuXHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXHRcdFx0XHRcdGlmICghdGhhdC5vcHRpb25zLmxpdmVTZWFyY2gpIHtcblx0XHRcdFx0XHRcdHRoYXQuJGJ1dHRvbi5mb2N1cygpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHR0aGF0LiRzZWFyY2hib3guZm9jdXMoKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLiRtZW51Lm9uKCdjbGljaycsICdsaS5kaXZpZGVyLCBsaS5kcm9wZG93bi1oZWFkZXInLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHRcdFx0aWYgKCF0aGF0Lm9wdGlvbnMubGl2ZVNlYXJjaCkge1xuXHRcdFx0XHRcdHRoYXQuJGJ1dHRvbi5mb2N1cygpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoYXQuJHNlYXJjaGJveC5mb2N1cygpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy4kbWVudS5vbignY2xpY2snLCAnLnBvcG92ZXItdGl0bGUgLmNsb3NlJywgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRoYXQuJGJ1dHRvbi5mb2N1cygpO1xuXHRcdFx0fSk7XG5cblx0XHRcdHRoaXMuJHNlYXJjaGJveC5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdGUuc3RvcFByb3BhZ2F0aW9uKCk7XG5cdFx0XHR9KTtcblxuXG5cdFx0XHR0aGlzLiRtZW51Lm9uKCdjbGljaycsICcuYWN0aW9ucy1idG4nLCBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdGlmICh0aGF0Lm9wdGlvbnMubGl2ZVNlYXJjaCkge1xuXHRcdFx0XHRcdHRoYXQuJHNlYXJjaGJveC5mb2N1cygpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoYXQuJGJ1dHRvbi5mb2N1cygpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0XHRlLnN0b3BQcm9wYWdhdGlvbigpO1xuXG5cdFx0XHRcdGlmICgkKHRoaXMpLmlzKCcuYnMtc2VsZWN0LWFsbCcpKSB7XG5cdFx0XHRcdFx0dGhhdC5zZWxlY3RBbGwoKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGF0LmRlc2VsZWN0QWxsKCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0dGhhdC4kZWxlbWVudC5jaGFuZ2UoKTtcblx0XHRcdH0pO1xuXG5cdFx0XHR0aGlzLiRlbGVtZW50LmNoYW5nZShmdW5jdGlvbigpIHtcblx0XHRcdFx0dGhhdC5yZW5kZXIoZmFsc2UpO1xuXHRcdFx0fSk7XG5cdFx0fSxcblxuXHRcdGxpdmVTZWFyY2hMaXN0ZW5lcjogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgdGhhdCA9IHRoaXMsXG5cdFx0XHRcdG5vX3Jlc3VsdHMgPSAkKCc8bGkgY2xhc3M9XCJuby1yZXN1bHRzXCI+PC9saT4nKTtcblxuXHRcdFx0dGhpcy4kbmV3RWxlbWVudC5vbignY2xpY2suZHJvcGRvd24uZGF0YS1hcGknLCBmdW5jdGlvbigpIHtcblx0XHRcdFx0dGhhdC4kbWVudS5maW5kKCcuYWN0aXZlJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuXHRcdFx0XHRpZiAoISF0aGF0LiRzZWFyY2hib3gudmFsKCkpIHtcblx0XHRcdFx0XHR0aGF0LiRzZWFyY2hib3gudmFsKCcnKTtcblx0XHRcdFx0XHR0aGF0LiRsaXMubm90KCcuaXMtaGlkZGVuJykucmVtb3ZlQ2xhc3MoJ2hpZGUnKTtcblx0XHRcdFx0XHRpZiAoISFub19yZXN1bHRzLnBhcmVudCgpLmxlbmd0aCkgbm9fcmVzdWx0cy5yZW1vdmUoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRpZiAoIXRoYXQubXVsdGlwbGUpIHRoYXQuJG1lbnUuZmluZCgnLnNlbGVjdGVkJykuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuXHRcdFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdHRoYXQuJHNlYXJjaGJveC5mb2N1cygpO1xuXHRcdFx0XHR9LCAxMCk7XG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy4kc2VhcmNoYm94Lm9uKCdpbnB1dCBwcm9wZXJ0eWNoYW5nZScsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRpZiAodGhhdC4kc2VhcmNoYm94LnZhbCgpKSB7XG5cblx0XHRcdFx0XHRpZiAodGhhdC5vcHRpb25zLnNlYXJjaEFjY2VudEluc2Vuc2l0aXZlKSB7XG5cdFx0XHRcdFx0XHR0aGF0LiRsaXMubm90KCcuaXMtaGlkZGVuJykucmVtb3ZlQ2xhc3MoJ2hpZGUnKS5maW5kKCdhJykubm90KCc6YWljb250YWlucygnICsgbm9ybWFsaXplVG9CYXNlKHRoYXQuJHNlYXJjaGJveC52YWwoKSkgKyAnKScpLnBhcmVudCgpLmFkZENsYXNzKCdoaWRlJyk7XG5cdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdHRoYXQuJGxpcy5ub3QoJy5pcy1oaWRkZW4nKS5yZW1vdmVDbGFzcygnaGlkZScpLmZpbmQoJ2EnKS5ub3QoJzppY29udGFpbnMoJyArIHRoYXQuJHNlYXJjaGJveC52YWwoKSArICcpJykucGFyZW50KCkuYWRkQ2xhc3MoJ2hpZGUnKTtcblx0XHRcdFx0XHR9XG5cblx0XHRcdFx0XHRpZiAoIXRoYXQuJG1lbnUuZmluZCgnbGknKS5maWx0ZXIoJzp2aXNpYmxlOm5vdCgubm8tcmVzdWx0cyknKS5sZW5ndGgpIHtcblx0XHRcdFx0XHRcdGlmICghIW5vX3Jlc3VsdHMucGFyZW50KCkubGVuZ3RoKSBub19yZXN1bHRzLnJlbW92ZSgpO1xuXHRcdFx0XHRcdFx0bm9fcmVzdWx0cy5odG1sKHRoYXQub3B0aW9ucy5ub25lUmVzdWx0c1RleHQgKyAnIFwiJyArIHRoYXQuJHNlYXJjaGJveC52YWwoKSArICdcIicpLnNob3coKTtcblx0XHRcdFx0XHRcdHRoYXQuJG1lbnUuZmluZCgnbGknKS5sYXN0KCkuYWZ0ZXIobm9fcmVzdWx0cyk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmICghIW5vX3Jlc3VsdHMucGFyZW50KCkubGVuZ3RoKSB7XG5cdFx0XHRcdFx0XHRub19yZXN1bHRzLnJlbW92ZSgpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdHRoYXQuJGxpcy5ub3QoJy5pcy1oaWRkZW4nKS5yZW1vdmVDbGFzcygnaGlkZScpO1xuXHRcdFx0XHRcdGlmICghIW5vX3Jlc3VsdHMucGFyZW50KCkubGVuZ3RoKSBub19yZXN1bHRzLnJlbW92ZSgpO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0dGhhdC4kbWVudS5maW5kKCdsaS5hY3RpdmUnKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG5cdFx0XHRcdHRoYXQuJG1lbnUuZmluZCgnbGknKS5maWx0ZXIoJzp2aXNpYmxlOm5vdCguZGl2aWRlciknKS5lcSgwKS5hZGRDbGFzcygnYWN0aXZlJykuZmluZCgnYScpLmZvY3VzKCk7XG5cdFx0XHRcdCQodGhpcykuZm9jdXMoKTtcblx0XHRcdH0pO1xuXHRcdH0sXG5cblx0XHR2YWw6IGZ1bmN0aW9uKHZhbHVlKSB7XG5cdFx0XHRpZiAodHlwZW9mIHZhbHVlICE9PSAndW5kZWZpbmVkJykge1xuXHRcdFx0XHR0aGlzLiRlbGVtZW50LnZhbCh2YWx1ZSk7XG5cdFx0XHRcdHRoaXMucmVuZGVyKCk7XG5cblx0XHRcdFx0cmV0dXJuIHRoaXMuJGVsZW1lbnQ7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy4kZWxlbWVudC52YWwoKTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0c2VsZWN0QWxsOiBmdW5jdGlvbigpIHtcblx0XHRcdHRoaXMuZmluZExpcygpO1xuXHRcdFx0dGhpcy4kbGlzLm5vdCgnLmRpdmlkZXInKS5ub3QoJy5kaXNhYmxlZCcpLm5vdCgnLnNlbGVjdGVkJykuZmlsdGVyKCc6dmlzaWJsZScpLmZpbmQoJ2EnKS5jbGljaygpO1xuXHRcdH0sXG5cblx0XHRkZXNlbGVjdEFsbDogZnVuY3Rpb24oKSB7XG5cdFx0XHR0aGlzLmZpbmRMaXMoKTtcblx0XHRcdHRoaXMuJGxpcy5ub3QoJy5kaXZpZGVyJykubm90KCcuZGlzYWJsZWQnKS5maWx0ZXIoJy5zZWxlY3RlZCcpLmZpbHRlcignOnZpc2libGUnKS5maW5kKCdhJykuY2xpY2soKTtcblx0XHR9LFxuXG5cdFx0a2V5ZG93bjogZnVuY3Rpb24oZSkge1xuXHRcdFx0dmFyICR0aGlzID0gJCh0aGlzKSxcblx0XHRcdFx0JHBhcmVudCA9ICgkdGhpcy5pcygnaW5wdXQnKSkgPyAkdGhpcy5wYXJlbnQoKS5wYXJlbnQoKSA6ICR0aGlzLnBhcmVudCgpLFxuXHRcdFx0XHQkaXRlbXMsXG5cdFx0XHRcdHRoYXQgPSAkcGFyZW50LmRhdGEoJ3RoaXMnKSxcblx0XHRcdFx0aW5kZXgsXG5cdFx0XHRcdG5leHQsXG5cdFx0XHRcdGZpcnN0LFxuXHRcdFx0XHRsYXN0LFxuXHRcdFx0XHRwcmV2LFxuXHRcdFx0XHRuZXh0UHJldixcblx0XHRcdFx0cHJldkluZGV4LFxuXHRcdFx0XHRpc0FjdGl2ZSxcblx0XHRcdFx0a2V5Q29kZU1hcCA9IHtcblx0XHRcdFx0XHQzMjogJyAnLFxuXHRcdFx0XHRcdDQ4OiAnMCcsXG5cdFx0XHRcdFx0NDk6ICcxJyxcblx0XHRcdFx0XHQ1MDogJzInLFxuXHRcdFx0XHRcdDUxOiAnMycsXG5cdFx0XHRcdFx0NTI6ICc0Jyxcblx0XHRcdFx0XHQ1MzogJzUnLFxuXHRcdFx0XHRcdDU0OiAnNicsXG5cdFx0XHRcdFx0NTU6ICc3Jyxcblx0XHRcdFx0XHQ1NjogJzgnLFxuXHRcdFx0XHRcdDU3OiAnOScsXG5cdFx0XHRcdFx0NTk6ICc7Jyxcblx0XHRcdFx0XHQ2NTogJ2EnLFxuXHRcdFx0XHRcdDY2OiAnYicsXG5cdFx0XHRcdFx0Njc6ICdjJyxcblx0XHRcdFx0XHQ2ODogJ2QnLFxuXHRcdFx0XHRcdDY5OiAnZScsXG5cdFx0XHRcdFx0NzA6ICdmJyxcblx0XHRcdFx0XHQ3MTogJ2cnLFxuXHRcdFx0XHRcdDcyOiAnaCcsXG5cdFx0XHRcdFx0NzM6ICdpJyxcblx0XHRcdFx0XHQ3NDogJ2onLFxuXHRcdFx0XHRcdDc1OiAnaycsXG5cdFx0XHRcdFx0NzY6ICdsJyxcblx0XHRcdFx0XHQ3NzogJ20nLFxuXHRcdFx0XHRcdDc4OiAnbicsXG5cdFx0XHRcdFx0Nzk6ICdvJyxcblx0XHRcdFx0XHQ4MDogJ3AnLFxuXHRcdFx0XHRcdDgxOiAncScsXG5cdFx0XHRcdFx0ODI6ICdyJyxcblx0XHRcdFx0XHQ4MzogJ3MnLFxuXHRcdFx0XHRcdDg0OiAndCcsXG5cdFx0XHRcdFx0ODU6ICd1Jyxcblx0XHRcdFx0XHQ4NjogJ3YnLFxuXHRcdFx0XHRcdDg3OiAndycsXG5cdFx0XHRcdFx0ODg6ICd4Jyxcblx0XHRcdFx0XHQ4OTogJ3knLFxuXHRcdFx0XHRcdDkwOiAneicsXG5cdFx0XHRcdFx0OTY6ICcwJyxcblx0XHRcdFx0XHQ5NzogJzEnLFxuXHRcdFx0XHRcdDk4OiAnMicsXG5cdFx0XHRcdFx0OTk6ICczJyxcblx0XHRcdFx0XHQxMDA6ICc0Jyxcblx0XHRcdFx0XHQxMDE6ICc1Jyxcblx0XHRcdFx0XHQxMDI6ICc2Jyxcblx0XHRcdFx0XHQxMDM6ICc3Jyxcblx0XHRcdFx0XHQxMDQ6ICc4Jyxcblx0XHRcdFx0XHQxMDU6ICc5J1xuXHRcdFx0XHR9O1xuXG5cdFx0XHRpZiAodGhhdC5vcHRpb25zLmxpdmVTZWFyY2gpICRwYXJlbnQgPSAkdGhpcy5wYXJlbnQoKS5wYXJlbnQoKTtcblxuXHRcdFx0aWYgKHRoYXQub3B0aW9ucy5jb250YWluZXIpICRwYXJlbnQgPSB0aGF0LiRtZW51O1xuXG5cdFx0XHQkaXRlbXMgPSAkKCdbcm9sZT1tZW51XSBsaSBhJywgJHBhcmVudCk7XG5cblx0XHRcdGlzQWN0aXZlID0gdGhhdC4kbWVudS5wYXJlbnQoKS5oYXNDbGFzcygnb3BlbicpO1xuXG5cdFx0XHRpZiAoIWlzQWN0aXZlICYmIC8oWzAtOV18W0Etel0pLy50ZXN0KFN0cmluZy5mcm9tQ2hhckNvZGUoZS5rZXlDb2RlKSkpIHtcblx0XHRcdFx0aWYgKCF0aGF0Lm9wdGlvbnMuY29udGFpbmVyKSB7XG5cdFx0XHRcdFx0dGhhdC5zZXRTaXplKCk7XG5cdFx0XHRcdFx0dGhhdC4kbWVudS5wYXJlbnQoKS5hZGRDbGFzcygnb3BlbicpO1xuXHRcdFx0XHRcdGlzQWN0aXZlID0gdHJ1ZTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGF0LiRuZXdFbGVtZW50LnRyaWdnZXIoJ2NsaWNrJyk7XG5cdFx0XHRcdH1cblx0XHRcdFx0dGhhdC4kc2VhcmNoYm94LmZvY3VzKCk7XG5cdFx0XHR9XG5cblx0XHRcdGlmICh0aGF0Lm9wdGlvbnMubGl2ZVNlYXJjaCkge1xuXHRcdFx0XHRpZiAoLyheOSR8MjcpLy50ZXN0KGUua2V5Q29kZS50b1N0cmluZygxMCkpICYmIGlzQWN0aXZlICYmIHRoYXQuJG1lbnUuZmluZCgnLmFjdGl2ZScpLmxlbmd0aCA9PT0gMCkge1xuXHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHR0aGF0LiRtZW51LnBhcmVudCgpLnJlbW92ZUNsYXNzKCdvcGVuJyk7XG5cdFx0XHRcdFx0dGhhdC4kYnV0dG9uLmZvY3VzKCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0JGl0ZW1zID0gJCgnW3JvbGU9bWVudV0gbGk6bm90KC5kaXZpZGVyKTpub3QoLmRyb3Bkb3duLWhlYWRlcik6dmlzaWJsZScsICRwYXJlbnQpO1xuXHRcdFx0XHRpZiAoISR0aGlzLnZhbCgpICYmICEvKDM4fDQwKS8udGVzdChlLmtleUNvZGUudG9TdHJpbmcoMTApKSkge1xuXHRcdFx0XHRcdGlmICgkaXRlbXMuZmlsdGVyKCcuYWN0aXZlJykubGVuZ3RoID09PSAwKSB7XG5cdFx0XHRcdFx0XHRpZiAodGhhdC5vcHRpb25zLnNlYXJjaEFjY2VudEluc2Vuc2l0aXZlKSB7XG5cdFx0XHRcdFx0XHRcdCRpdGVtcyA9IHRoYXQuJG5ld0VsZW1lbnQuZmluZCgnbGknKS5maWx0ZXIoJzphaWNvbnRhaW5zKCcgKyBub3JtYWxpemVUb0Jhc2Uoa2V5Q29kZU1hcFtlLmtleUNvZGVdKSArICcpJyk7XG5cdFx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0XHQkaXRlbXMgPSB0aGF0LiRuZXdFbGVtZW50LmZpbmQoJ2xpJykuZmlsdGVyKCc6aWNvbnRhaW5zKCcgKyBrZXlDb2RlTWFwW2Uua2V5Q29kZV0gKyAnKScpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXG5cdFx0XHRpZiAoISRpdGVtcy5sZW5ndGgpIHJldHVybjtcblxuXHRcdFx0aWYgKC8oMzh8NDApLy50ZXN0KGUua2V5Q29kZS50b1N0cmluZygxMCkpKSB7XG5cdFx0XHRcdGluZGV4ID0gJGl0ZW1zLmluZGV4KCRpdGVtcy5maWx0ZXIoJzpmb2N1cycpKTtcblx0XHRcdFx0Zmlyc3QgPSAkaXRlbXMucGFyZW50KCc6bm90KC5kaXNhYmxlZCk6dmlzaWJsZScpLmZpcnN0KCkuaW5kZXgoKTtcblx0XHRcdFx0bGFzdCA9ICRpdGVtcy5wYXJlbnQoJzpub3QoLmRpc2FibGVkKTp2aXNpYmxlJykubGFzdCgpLmluZGV4KCk7XG5cdFx0XHRcdG5leHQgPSAkaXRlbXMuZXEoaW5kZXgpLnBhcmVudCgpLm5leHRBbGwoJzpub3QoLmRpc2FibGVkKTp2aXNpYmxlJykuZXEoMCkuaW5kZXgoKTtcblx0XHRcdFx0cHJldiA9ICRpdGVtcy5lcShpbmRleCkucGFyZW50KCkucHJldkFsbCgnOm5vdCguZGlzYWJsZWQpOnZpc2libGUnKS5lcSgwKS5pbmRleCgpO1xuXHRcdFx0XHRuZXh0UHJldiA9ICRpdGVtcy5lcShuZXh0KS5wYXJlbnQoKS5wcmV2QWxsKCc6bm90KC5kaXNhYmxlZCk6dmlzaWJsZScpLmVxKDApLmluZGV4KCk7XG5cblx0XHRcdFx0aWYgKHRoYXQub3B0aW9ucy5saXZlU2VhcmNoKSB7XG5cdFx0XHRcdFx0JGl0ZW1zLmVhY2goZnVuY3Rpb24oaSkge1xuXHRcdFx0XHRcdFx0aWYgKCQodGhpcykuaXMoJzpub3QoLmRpc2FibGVkKScpKSB7XG5cdFx0XHRcdFx0XHRcdCQodGhpcykuZGF0YSgnaW5kZXgnLCBpKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRpbmRleCA9ICRpdGVtcy5pbmRleCgkaXRlbXMuZmlsdGVyKCcuYWN0aXZlJykpO1xuXHRcdFx0XHRcdGZpcnN0ID0gJGl0ZW1zLmZpbHRlcignOm5vdCguZGlzYWJsZWQpOnZpc2libGUnKS5maXJzdCgpLmRhdGEoJ2luZGV4Jyk7XG5cdFx0XHRcdFx0bGFzdCA9ICRpdGVtcy5maWx0ZXIoJzpub3QoLmRpc2FibGVkKTp2aXNpYmxlJykubGFzdCgpLmRhdGEoJ2luZGV4Jyk7XG5cdFx0XHRcdFx0bmV4dCA9ICRpdGVtcy5lcShpbmRleCkubmV4dEFsbCgnOm5vdCguZGlzYWJsZWQpOnZpc2libGUnKS5lcSgwKS5kYXRhKCdpbmRleCcpO1xuXHRcdFx0XHRcdHByZXYgPSAkaXRlbXMuZXEoaW5kZXgpLnByZXZBbGwoJzpub3QoLmRpc2FibGVkKTp2aXNpYmxlJykuZXEoMCkuZGF0YSgnaW5kZXgnKTtcblx0XHRcdFx0XHRuZXh0UHJldiA9ICRpdGVtcy5lcShuZXh0KS5wcmV2QWxsKCc6bm90KC5kaXNhYmxlZCk6dmlzaWJsZScpLmVxKDApLmRhdGEoJ2luZGV4Jyk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRwcmV2SW5kZXggPSAkdGhpcy5kYXRhKCdwcmV2SW5kZXgnKTtcblxuXHRcdFx0XHRpZiAoZS5rZXlDb2RlID09IDM4KSB7XG5cdFx0XHRcdFx0aWYgKHRoYXQub3B0aW9ucy5saXZlU2VhcmNoKSBpbmRleCAtPSAxO1xuXHRcdFx0XHRcdGlmIChpbmRleCAhPSBuZXh0UHJldiAmJiBpbmRleCA+IHByZXYpIGluZGV4ID0gcHJldjtcblx0XHRcdFx0XHRpZiAoaW5kZXggPCBmaXJzdCkgaW5kZXggPSBmaXJzdDtcblx0XHRcdFx0XHRpZiAoaW5kZXggPT0gcHJldkluZGV4KSBpbmRleCA9IGxhc3Q7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHRpZiAoZS5rZXlDb2RlID09IDQwKSB7XG5cdFx0XHRcdFx0aWYgKHRoYXQub3B0aW9ucy5saXZlU2VhcmNoKSBpbmRleCArPSAxO1xuXHRcdFx0XHRcdGlmIChpbmRleCA9PSAtMSkgaW5kZXggPSAwO1xuXHRcdFx0XHRcdGlmIChpbmRleCAhPSBuZXh0UHJldiAmJiBpbmRleCA8IG5leHQpIGluZGV4ID0gbmV4dDtcblx0XHRcdFx0XHRpZiAoaW5kZXggPiBsYXN0KSBpbmRleCA9IGxhc3Q7XG5cdFx0XHRcdFx0aWYgKGluZGV4ID09IHByZXZJbmRleCkgaW5kZXggPSBmaXJzdDtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdCR0aGlzLmRhdGEoJ3ByZXZJbmRleCcsIGluZGV4KTtcblxuXHRcdFx0XHRpZiAoIXRoYXQub3B0aW9ucy5saXZlU2VhcmNoKSB7XG5cdFx0XHRcdFx0JGl0ZW1zLmVxKGluZGV4KS5mb2N1cygpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRpZiAoISR0aGlzLmlzKCcuZHJvcGRvd24tdG9nZ2xlJykpIHtcblx0XHRcdFx0XHRcdCRpdGVtcy5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG5cdFx0XHRcdFx0XHQkaXRlbXMuZXEoaW5kZXgpLmFkZENsYXNzKCdhY3RpdmUnKS5maW5kKCdhJykuZm9jdXMoKTtcblx0XHRcdFx0XHRcdCR0aGlzLmZvY3VzKCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cblx0XHRcdH0gZWxzZSBpZiAoISR0aGlzLmlzKCdpbnB1dCcpKSB7XG5cdFx0XHRcdHZhciBrZXlJbmRleCA9IFtdLFxuXHRcdFx0XHRcdGNvdW50LFxuXHRcdFx0XHRcdHByZXZLZXk7XG5cblx0XHRcdFx0JGl0ZW1zLmVhY2goZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0aWYgKCQodGhpcykucGFyZW50KCkuaXMoJzpub3QoLmRpc2FibGVkKScpKSB7XG5cdFx0XHRcdFx0XHRpZiAoJC50cmltKCQodGhpcykudGV4dCgpLnRvTG93ZXJDYXNlKCkpLnN1YnN0cmluZygwLCAxKSA9PSBrZXlDb2RlTWFwW2Uua2V5Q29kZV0pIHtcblx0XHRcdFx0XHRcdFx0a2V5SW5kZXgucHVzaCgkKHRoaXMpLnBhcmVudCgpLmluZGV4KCkpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cblx0XHRcdFx0Y291bnQgPSAkKGRvY3VtZW50KS5kYXRhKCdrZXljb3VudCcpO1xuXHRcdFx0XHRjb3VudCsrO1xuXHRcdFx0XHQkKGRvY3VtZW50KS5kYXRhKCdrZXljb3VudCcsIGNvdW50KTtcblxuXHRcdFx0XHRwcmV2S2V5ID0gJC50cmltKCQoJzpmb2N1cycpLnRleHQoKS50b0xvd2VyQ2FzZSgpKS5zdWJzdHJpbmcoMCwgMSk7XG5cblx0XHRcdFx0aWYgKHByZXZLZXkgIT0ga2V5Q29kZU1hcFtlLmtleUNvZGVdKSB7XG5cdFx0XHRcdFx0Y291bnQgPSAxO1xuXHRcdFx0XHRcdCQoZG9jdW1lbnQpLmRhdGEoJ2tleWNvdW50JywgY291bnQpO1xuXHRcdFx0XHR9IGVsc2UgaWYgKGNvdW50ID49IGtleUluZGV4Lmxlbmd0aCkge1xuXHRcdFx0XHRcdCQoZG9jdW1lbnQpLmRhdGEoJ2tleWNvdW50JywgMCk7XG5cdFx0XHRcdFx0aWYgKGNvdW50ID4ga2V5SW5kZXgubGVuZ3RoKSBjb3VudCA9IDE7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQkaXRlbXMuZXEoa2V5SW5kZXhbY291bnQgLSAxXSkuZm9jdXMoKTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gU2VsZWN0IGZvY3VzZWQgb3B0aW9uIGlmIFwiRW50ZXJcIiwgXCJTcGFjZWJhclwiIG9yIFwiVGFiXCIgKHdoZW4gc2VsZWN0T25UYWIgaXMgdHJ1ZSkgYXJlIHByZXNzZWQgaW5zaWRlIHRoZSBtZW51LlxuXHRcdFx0aWYgKCgvKDEzfDMyKS8udGVzdChlLmtleUNvZGUudG9TdHJpbmcoMTApKSB8fCAoLyheOSQpLy50ZXN0KGUua2V5Q29kZS50b1N0cmluZygxMCkpICYmIHRoYXQub3B0aW9ucy5zZWxlY3RPblRhYikpICYmIGlzQWN0aXZlKSB7XG5cdFx0XHRcdGlmICghLygzMikvLnRlc3QoZS5rZXlDb2RlLnRvU3RyaW5nKDEwKSkpIGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0aWYgKCF0aGF0Lm9wdGlvbnMubGl2ZVNlYXJjaCkge1xuXHRcdFx0XHRcdCQoJzpmb2N1cycpLmNsaWNrKCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIS8oMzIpLy50ZXN0KGUua2V5Q29kZS50b1N0cmluZygxMCkpKSB7XG5cdFx0XHRcdFx0dGhhdC4kbWVudS5maW5kKCcuYWN0aXZlIGEnKS5jbGljaygpO1xuXHRcdFx0XHRcdCR0aGlzLmZvY3VzKCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0JChkb2N1bWVudCkuZGF0YSgna2V5Y291bnQnLCAwKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKCgvKF45JHwyNykvLnRlc3QoZS5rZXlDb2RlLnRvU3RyaW5nKDEwKSkgJiYgaXNBY3RpdmUgJiYgKHRoYXQubXVsdGlwbGUgfHwgdGhhdC5vcHRpb25zLmxpdmVTZWFyY2gpKSB8fCAoLygyNykvLnRlc3QoZS5rZXlDb2RlLnRvU3RyaW5nKDEwKSkgJiYgIWlzQWN0aXZlKSkge1xuXHRcdFx0XHR0aGF0LiRtZW51LnBhcmVudCgpLnJlbW92ZUNsYXNzKCdvcGVuJyk7XG5cdFx0XHRcdHRoYXQuJGJ1dHRvbi5mb2N1cygpO1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHRtb2JpbGU6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dGhpcy4kZWxlbWVudC5hZGRDbGFzcygnbW9iaWxlLWRldmljZScpLmFwcGVuZFRvKHRoaXMuJG5ld0VsZW1lbnQpO1xuXHRcdFx0aWYgKHRoaXMub3B0aW9ucy5jb250YWluZXIpIHRoaXMuJG1lbnUuaGlkZSgpO1xuXHRcdH0sXG5cblx0XHRyZWZyZXNoOiBmdW5jdGlvbigpIHtcblx0XHRcdHRoaXMuJGxpcyA9IG51bGw7XG5cdFx0XHR0aGlzLnJlbG9hZExpKCk7XG5cdFx0XHR0aGlzLnJlbmRlcigpO1xuXHRcdFx0dGhpcy5zZXRXaWR0aCgpO1xuXHRcdFx0dGhpcy5zZXRTdHlsZSgpO1xuXHRcdFx0dGhpcy5jaGVja0Rpc2FibGVkKCk7XG5cdFx0XHR0aGlzLmxpSGVpZ2h0KCk7XG5cdFx0fSxcblxuXHRcdHVwZGF0ZTogZnVuY3Rpb24oKSB7XG5cdFx0XHR0aGlzLnJlbG9hZExpKCk7XG5cdFx0XHR0aGlzLnNldFdpZHRoKCk7XG5cdFx0XHR0aGlzLnNldFN0eWxlKCk7XG5cdFx0XHR0aGlzLmNoZWNrRGlzYWJsZWQoKTtcblx0XHRcdHRoaXMubGlIZWlnaHQoKTtcblx0XHR9LFxuXG5cdFx0aGlkZTogZnVuY3Rpb24oKSB7XG5cdFx0XHR0aGlzLiRuZXdFbGVtZW50LmhpZGUoKTtcblx0XHR9LFxuXG5cdFx0c2hvdzogZnVuY3Rpb24oKSB7XG5cdFx0XHR0aGlzLiRuZXdFbGVtZW50LnNob3coKTtcblx0XHR9LFxuXG5cdFx0cmVtb3ZlOiBmdW5jdGlvbigpIHtcblx0XHRcdHRoaXMuJG5ld0VsZW1lbnQucmVtb3ZlKCk7XG5cdFx0XHR0aGlzLiRlbGVtZW50LnJlbW92ZSgpO1xuXHRcdH1cblx0fTtcblxuXHQvLyBTRUxFQ1RQSUNLRVIgUExVR0lOIERFRklOSVRJT05cblx0Ly8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cdGZ1bmN0aW9uIFBsdWdpbihvcHRpb24sIGV2ZW50KSB7XG5cdFx0Ly8gZ2V0IHRoZSBhcmdzIG9mIHRoZSBvdXRlciBmdW5jdGlvbi4uXG5cdFx0dmFyIGFyZ3MgPSBhcmd1bWVudHM7XG5cdFx0Ly8gVGhlIGFyZ3VtZW50cyBvZiB0aGUgZnVuY3Rpb24gYXJlIGV4cGxpY2l0bHkgcmUtZGVmaW5lZCBmcm9tIHRoZSBhcmd1bWVudCBsaXN0LCBiZWNhdXNlIHRoZSBzaGlmdCBjYXVzZXMgdGhlbVxuXHRcdC8vIHRvIGdldCBsb3N0XG5cdFx0Ly9ub2luc3BlY3Rpb24gSlNEdXBsaWNhdGVkRGVjbGFyYXRpb25cblx0XHR2YXIgX29wdGlvbiA9IG9wdGlvbixcblx0XHRcdG9wdGlvbiA9IGFyZ3NbMF0sXG5cdFx0XHRldmVudCA9IGFyZ3NbMV07XG5cdFx0W10uc2hpZnQuYXBwbHkoYXJncyk7XG5cblx0XHQvLyBUaGlzIGZpeGVzIGEgYnVnIGluIHRoZSBqcyBpbXBsZW1lbnRhdGlvbiBvbiBhbmRyb2lkIDIuMyAjNzE1XG5cdFx0aWYgKHR5cGVvZiBvcHRpb24gPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRcdG9wdGlvbiA9IF9vcHRpb247XG5cdFx0fVxuXG5cdFx0dmFyIHZhbHVlO1xuXHRcdHZhciBjaGFpbiA9IHRoaXMuZWFjaChmdW5jdGlvbigpIHtcblx0XHRcdHZhciAkdGhpcyA9ICQodGhpcyk7XG5cdFx0XHRpZiAoJHRoaXMuaXMoJ3NlbGVjdCcpKSB7XG5cdFx0XHRcdHZhciBkYXRhID0gJHRoaXMuZGF0YSgnc2VsZWN0cGlja2VyJyksXG5cdFx0XHRcdFx0b3B0aW9ucyA9IHR5cGVvZiBvcHRpb24gPT0gJ29iamVjdCcgJiYgb3B0aW9uO1xuXG5cdFx0XHRcdGlmICghZGF0YSkge1xuXHRcdFx0XHRcdHZhciBjb25maWcgPSAkLmV4dGVuZCh7fSwgU2VsZWN0cGlja2VyLkRFRkFVTFRTLCAkLmZuLnNlbGVjdHBpY2tlci5kZWZhdWx0cyB8fCB7fSwgJHRoaXMuZGF0YSgpLCBvcHRpb25zKTtcblx0XHRcdFx0XHQkdGhpcy5kYXRhKCdzZWxlY3RwaWNrZXInLCAoZGF0YSA9IG5ldyBTZWxlY3RwaWNrZXIodGhpcywgY29uZmlnLCBldmVudCkpKTtcblx0XHRcdFx0fSBlbHNlIGlmIChvcHRpb25zKSB7XG5cdFx0XHRcdFx0Zm9yICh2YXIgaSBpbiBvcHRpb25zKSB7XG5cdFx0XHRcdFx0XHRpZiAob3B0aW9ucy5oYXNPd25Qcm9wZXJ0eShpKSkge1xuXHRcdFx0XHRcdFx0XHRkYXRhLm9wdGlvbnNbaV0gPSBvcHRpb25zW2ldO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXG5cdFx0XHRcdGlmICh0eXBlb2Ygb3B0aW9uID09ICdzdHJpbmcnKSB7XG5cdFx0XHRcdFx0aWYgKGRhdGFbb3B0aW9uXSBpbnN0YW5jZW9mIEZ1bmN0aW9uKSB7XG5cdFx0XHRcdFx0XHR2YWx1ZSA9IGRhdGFbb3B0aW9uXS5hcHBseShkYXRhLCBhcmdzKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0dmFsdWUgPSBkYXRhLm9wdGlvbnNbb3B0aW9uXTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9KTtcblxuXHRcdGlmICh0eXBlb2YgdmFsdWUgIT09ICd1bmRlZmluZWQnKSB7XG5cdFx0XHQvL25vaW5zcGVjdGlvbiBKU1VudXNlZEFzc2lnbm1lbnRcblx0XHRcdHJldHVybiB2YWx1ZTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0cmV0dXJuIGNoYWluO1xuXHRcdH1cblx0fVxuXG5cdHZhciBvbGQgPSAkLmZuLnNlbGVjdHBpY2tlcjtcblx0JC5mbi5zZWxlY3RwaWNrZXIgPSBQbHVnaW47XG5cdCQuZm4uc2VsZWN0cGlja2VyLkNvbnN0cnVjdG9yID0gU2VsZWN0cGlja2VyO1xuXG5cdC8vIFNFTEVDVFBJQ0tFUiBOTyBDT05GTElDVFxuXHQvLyA9PT09PT09PT09PT09PT09PT09PT09PT1cblx0JC5mbi5zZWxlY3RwaWNrZXIubm9Db25mbGljdCA9IGZ1bmN0aW9uKCkge1xuXHRcdCQuZm4uc2VsZWN0cGlja2VyID0gb2xkO1xuXHRcdHJldHVybiB0aGlzO1xuXHR9O1xuXG5cdCQoZG9jdW1lbnQpXG5cdFx0LmRhdGEoJ2tleWNvdW50JywgMClcblx0XHQub24oJ2tleWRvd24nLCAnLmJvb3RzdHJhcC1zZWxlY3QgW2RhdGEtdG9nZ2xlPWRyb3Bkb3duXSwgLmJvb3RzdHJhcC1zZWxlY3QgW3JvbGU9bWVudV0sIC5icy1zZWFyY2hib3ggaW5wdXQnLCBTZWxlY3RwaWNrZXIucHJvdG90eXBlLmtleWRvd24pXG5cdFx0Lm9uKCdmb2N1c2luLm1vZGFsJywgJy5ib290c3RyYXAtc2VsZWN0IFtkYXRhLXRvZ2dsZT1kcm9wZG93bl0sIC5ib290c3RyYXAtc2VsZWN0IFtyb2xlPW1lbnVdLCAuYnMtc2VhcmNoYm94IGlucHV0JywgZnVuY3Rpb24oZSkge1xuXHRcdFx0ZS5zdG9wUHJvcGFnYXRpb24oKTtcblx0XHR9KTtcblxuXHQvLyBTRUxFQ1RQSUNLRVIgREFUQS1BUElcblx0Ly8gPT09PT09PT09PT09PT09PT09PT09XG5cdCQod2luZG93KS5vbignbG9hZC5icy5zZWxlY3QuZGF0YS1hcGknLCBmdW5jdGlvbigpIHtcblx0XHQkKCcuc2VsZWN0cGlja2VyJykuZWFjaChmdW5jdGlvbigpIHtcblx0XHRcdHZhciAkc2VsZWN0cGlja2VyID0gJCh0aGlzKTtcblx0XHRcdFBsdWdpbi5jYWxsKCRzZWxlY3RwaWNrZXIsICRzZWxlY3RwaWNrZXIuZGF0YSgpKTtcblx0XHR9KVxuXHR9KTtcblxufSkoalF1ZXJ5KTtcbiIsImZ1bmN0aW9uIGRldGVjdElFKCkge1xuICAgIHZhciB1YSA9IHdpbmRvdy5uYXZpZ2F0b3IudXNlckFnZW50O1xuXG4gICAgdmFyIG1zaWUgPSB1YS5pbmRleE9mKCdNU0lFICcpO1xuICAgIGlmIChtc2llID4gMCkge1xuICAgICAgICAvLyBJRSAxMCBvciBvbGRlciA9PiByZXR1cm4gdmVyc2lvbiBudW1iZXJcbiAgICAgICAgcmV0dXJuIHBhcnNlSW50KHVhLnN1YnN0cmluZyhtc2llICsgNSwgdWEuaW5kZXhPZignLicsIG1zaWUpKSwgMTApO1xuICAgIH1cblxuICAgIHZhciB0cmlkZW50ID0gdWEuaW5kZXhPZignVHJpZGVudC8nKTtcbiAgICBpZiAodHJpZGVudCA+IDApIHtcbiAgICAgICAgLy8gSUUgMTEgPT4gcmV0dXJuIHZlcnNpb24gbnVtYmVyXG4gICAgICAgIHZhciBydiA9IHVhLmluZGV4T2YoJ3J2OicpO1xuICAgICAgICByZXR1cm4gcGFyc2VJbnQodWEuc3Vic3RyaW5nKHJ2ICsgMywgdWEuaW5kZXhPZignLicsIHJ2KSksIDEwKTtcbiAgICB9XG5cbiAgICB2YXIgZWRnZSA9IHVhLmluZGV4T2YoJ0VkZ2UvJyk7XG4gICAgaWYgKGVkZ2UgPiAwKSB7XG4gICAgICAgLy8gSUUgMTIgPT4gcmV0dXJuIHZlcnNpb24gbnVtYmVyXG4gICAgICAgcmV0dXJuIHBhcnNlSW50KHVhLnN1YnN0cmluZyhlZGdlICsgNSwgdWEuaW5kZXhPZignLicsIGVkZ2UpKSwgMTApO1xuICAgIH1cblxuICAgIC8vIG90aGVyIGJyb3dzZXJcbiAgICByZXR1cm4gZmFsc2U7XG59XG5cbihmdW5jdGlvbigkKXtcbiAgICAkKGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgLy92YXIgJGNvcHkgPSAkKCdkaXYuU1BBX3ByaW50Y29udGFjdCcpLmNsb25lKCk7XG4gICAgICAgIHZhciAkYm9keSA9ICQoJ2JvZHknKTtcblxuICAgICAgICAvLyRjb3B5Lmluc2VydEFmdGVyKCcjcHJpbnRkYXRlJyk7XG5cbiAgICAgICAgaWYoJC5icm93c2VyLm1zaWUgfHwgZGV0ZWN0SUUoKSkge1xuICAgICAgICAgICAgJGJvZHkuYWRkQ2xhc3MoJ21zaWUgaWUnK2RldGVjdElFKCkpO1xuICAgICAgICAgICAgLy92YXIgdXNlckFnZW50ID0gdXNlckFnZW50LnN1YnN0cmluZygwLHVzZXJBZ2VudC5pbmRleE9mKCcuJykpO1xuICAgICAgICAgICAgLy92YXIgdmVyc2lvbiA9IHVzZXJBZ2VudDtcbiAgICAgICAgICAgIC8vJGJvZHkuYWRkQ2xhc3MoJ21zaWUgaWUnICsgdmVyc2lvbik7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vYWxlcnQoJ0lFJyk7XG4gICAgICAgIH0gZWxzZSBpZigkLmJyb3dzZXIud2Via2l0KSB7XG4gICAgICAgICAgICAkYm9keS5hZGRDbGFzcygnd2Via2l0Jyk7XG4gICAgICAgIH0gZWxzZSBpZigkLmJyb3dzZXIubW96aWxsYSkge1xuICAgICAgICAgICAgJGJvZHkuYWRkQ2xhc3MoJ21vemlsbGEnKTtcbiAgICAgICAgfVxuXG4gICAgfSk7XG59KGpRdWVyeSkpO1xuXG5cbi8qIVxuKiBEZXRlY3RpenIgdkBWRVJTSU9OXG4qIGh0dHA6Ly9iYXJpc2F5ZGlub2dsdS5naXRodWIuY29tL0RldGVjdGl6ci9cbipcbiogV3JpdHRlbiBieSBCYXJpcyBBeWRpbm9nbHUgKGh0dHA6Ly9iYXJpcy5heWRpbm9nbHUuaW5mbykgLSBDb3B5cmlnaHQgMjAxMlxuKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2VcbipcbiogRGF0ZTogQERBVEVcbiovXG4iLCIvLyQoZnVuY3Rpb24oKSB7XG4vLyAgICBcbi8vXHQkKCcuX2ZvcndhcmRfcHJpY2luZycpLm9uKFwiY2xpY2tcIixmdW5jdGlvbigpe1xuLy8gICAgICAgICAgICBfZ2FfZ2VuZXJhdGVkKCAkKHRoaXMpICk7ICAgXG4vLyAgICAgICAgICAgIC8vIHJlZGlyZWN0IHN0b3JlXG4vLyAgICAgICAgICAgIGRvY3VtZW50LmxvY2F0aW9uID0gZG9tYWluICsgJy9zdG9yZS5odG1sJztcdFxuLy9cdH0pO1xuLy8gICAgICAgIFxuLy8gICAgICAgICQoJy5nYS1jbGljaycpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7XG4vLyAgICAgICAgICAgIC8vZXZlbnQucHJldmVudERlZmF1bHQoKTtcbi8vICAgICAgICAgICAgX2dhX2dlbmVyYXRlZCggJCh0aGlzKSApO1xuLy8gICAgICAgICAgICAvL3JldHVybiB0cnVlO1xuLy8gICAgICAgIH0pO1xuLy9cbi8vfSk7XG4vL1xuLy9mdW5jdGlvbiBfZ2FfZ2VuZXJhdGVkKCAkKHRoaXMpICkge1xuLy8gICAgdmFyIF9nYV9sYWJlbF9idXR0b24gPSBmYWxzZSxcbi8vICAgICAgICBfZ2FfdHlwZV9idXR0b24gPSBmYWxzZSxcbi8vICAgICAgICBfZ2FfZXZlbnQgPSBmYWxzZTtcbi8vXG4vLyAgICBfZ2FfZXZlbnQgPSAoJCh0aGlzKS5hdHRyKCdnYS1ldmVudCcpKSA/ICQodGhpcykuYXR0cignZ2EtZXZlbnQnKSA6IGZhbHNlO1xuLy8gICAgX2dhX3R5cGVfYnV0dG9uID0gKCQodGhpcykuYXR0cignZ2EtdHlwZS1idXR0b24nKSkgPyAkKHRoaXMpLmF0dHIoJ2dhLXR5cGUtYnV0dG9uJykgOiAnYnV5IGJ1dHRvbic7XG4vLyAgICBfZ2FfbGFiZWxfYnV0dG9uID0gKCQodGhpcykuYXR0cignZ2EtbGFiZWwtYnV0dG9uJykpID8gJC50cmltKCAkKHRoaXMpLmF0dHIoJ2dhLWxhYmVsLWJ1dHRvbicpLnRvTG93ZXJDYXNlKCkgKS5yZXBsYWNlKC9cXHMvZywnLScpIDogZmFsc2U7XG4vL1xuLy8gICAgaWYoX2dhX2V2ZW50ICYmIF9nYV90eXBlX2J1dHRvbiAmJiBfZ2FfbGFiZWxfYnV0dG9uKSB7XG4vLyAgICAgICAgZ2EoJ3NlbmQnLCAnZXZlbnQnLCBfZ2FfdHlwZV9idXR0b24sIF9nYV9ldmVudCwgX2dhX2xhYmVsX2J1dHRvbik7XG4vLyAgICB9IFxuLy99XG5cbmZ1bmN0aW9uIGdvb2dsZV9hbmFsaXR5Y3NfY2xpY2soIGNhdGVnb3J5LCBhY3Rpb24sIGxhYmVsICkge1xuICAgIGlmKGFjdGlvbiAmJiBjYXRlZ29yeSAmJiBsYWJlbCkge1xuICAgICAgICBnYSgnc2VuZCcsICdldmVudCcsIGNhdGVnb3J5LCBhY3Rpb24sIGxhYmVsKTtcbiAgICB9XG59XG5cbmZ1bmN0aW9uIFRyYWNrRXZlbnRHQShDYXRlZ29yeSwgQWN0aW9uLCBMYWJlbCwgVmFsdWUpIHtcbiAgICBcInVzZSBzdHJpY3RcIjtcbiAgICBpZiAodHlwZW9mIChfZ2FxKSAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICBfZ2FxLnB1c2goWydfdHJhY2tFdmVudCcsIENhdGVnb3J5LCBBY3Rpb24sIExhYmVsLCBWYWx1ZV0pO1xuICAgIH0gZWxzZSBpZiAodHlwZW9mIChnYSkgIT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICAgICAgZ2EoJ3NlbmQnLCAnZXZlbnQnLCBDYXRlZ29yeSwgQWN0aW9uLCBMYWJlbCwgVmFsdWUpO1xuICAgIH1cbn1cblxuJChmdW5jdGlvbigpIHtcbiAgICAkKCcuZ2EtYWN0aW9uLWNsaWNrJykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgIHZhciBfZ2FfYWN0aW9uID0gKCQodGhpcykuYXR0cignZ2EtYWN0aW9uJykpID8gJCh0aGlzKS5hdHRyKCdnYS1hY3Rpb24nKSA6IGZhbHNlLFxuICAgICAgICAgICAgICAgX2dhX2NhdGVnb3J5ID0gKCQodGhpcykuYXR0cignZ2EtY2F0ZWdvcnknKSkgPyAkKHRoaXMpLmF0dHIoJ2dhLWNhdGVnb3J5JykgOiBmYWxzZSxcbiAgICAgICAgICAgICAgIF9nYV9sYWJlbCA9ICgkKHRoaXMpLmF0dHIoJ2dhLWxhYmVsJykpID8gJC50cmltKCAkKHRoaXMpLmF0dHIoJ2dhLWxhYmVsJykudG9Mb3dlckNhc2UoKSApLnJlcGxhY2UoL1xccy9nLCctJykgOiBmYWxzZTtcbiAgICAgICAgXG4gICAgICAgIGlmKF9nYV9hY3Rpb24gJiYgX2dhX2NhdGVnb3J5ICYmIF9nYV9sYWJlbCkge1xuICAgICAgICAgICAgLy8gZ2EoJ3NlbmQnLCAnZXZlbnQnLCBfZ2FfY2F0ZWdvcnksIF9nYV9hY3Rpb24sIF9nYV9sYWJlbCk7XG4gICAgICAgICAgICBUcmFja0V2ZW50R0EoX2dhX2NhdGVnb3J5LCBfZ2FfYWN0aW9uLCBfZ2FfbGFiZWwpO1xuICAgICAgICB9XG4gICAgICAgIFxuICAgIH0pO1xuICAgIFxuICAgICQoJy5nYS1hY3Rpb24tc3VibWl0Jykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7IC8vIGNsb3Nlc3QoJ2Zvcm0nKS4gc3VibWl0XG4gICAgICAgIHZhciBfYiA9ICQodGhpcyksIF9mb3JtID0gJCh0aGlzKS5jbG9zZXN0KCdmb3JtJyk7ICAvLyAuZmluZCgnLmdhLWFjdGlvbi1zdWJtaXQnKVxuICAgICAgICB2YXIgX2dhX2FjdGlvbiA9IChfYi5hdHRyKCdnYS1hY3Rpb24nKSkgPyBfYi5hdHRyKCdnYS1hY3Rpb24nKSA6IGZhbHNlLFxuICAgICAgICAgICBfZ2FfY2F0ZWdvcnkgPSAoX2IuYXR0cignZ2EtY2F0ZWdvcnknKSkgPyBfYi5hdHRyKCdnYS1jYXRlZ29yeScpIDogZmFsc2UsXG4gICAgICAgICAgIF9nYV9wYWdlID0gKF9iLmF0dHIoJ2dhLXBhZ2UnKSkgPyBfYi5hdHRyKCdnYS1wYWdlJykgOiAnJyxcbiAgICAgICAgICAgX2dhX2xhYmVsID0gKF9iLmF0dHIoJ2dhLWxhYmVsJykpID8gJC50cmltKCBfYi5hdHRyKCdnYS1sYWJlbCcpLnRvTG93ZXJDYXNlKCkgKS5yZXBsYWNlKC9cXHMvZywnLScpIDogZmFsc2U7XG4gICAgICAgIFxuICAgICAgICBpZihfZ2FfYWN0aW9uICYmIF9nYV9jYXRlZ29yeSAmJiBfZ2FfbGFiZWwpIHtcbiAgICAgICAgICAgIGdhKCdzZW5kJywgJ3BhZ2UnLCBfZ2FfcGFnZSk7XG4gICAgICAgICAgICBnYSgnc2VuZCcsICdwYWdldmlldycsIF9nYV9wYWdlKTtcbiAgICAgICAgICAgIC8vIGdhKCdzZXQnLCAncmVmZXJyZXInLCAnaHR0cDovL3B1bXBpYy5jb20nKTtcbiAgICAgICAgICAgIGdhKCdzZW5kJywgJ2V2ZW50JywgX2dhX2NhdGVnb3J5LCBfZ2FfYWN0aW9uLCBfZ2FfbGFiZWwsIHtcbiAgICAgICAgICAgICAgICAncGFnZSc6IF9nYV9wYWdlLFxuICAgICAgICAgICAgICAgICdfdHJhY2tQYWdldmlldyc6IF9nYV9wYWdlLCBcbiAgICAgICAgICAgICAgICAnaGl0Q2FsbGJhY2snOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgX2Zvcm0uc3VibWl0KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgIHJldHVybiAhKGdhLmhhc093blByb3BlcnR5KCdsb2FkZWQnKSAmJiBnYS5sb2FkZWQgPT09IHRydWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBcbn0pO1xuXG4iLCJjdXJyZW5jeUhhbmRsZXIgPSB7XG4gICAgYWZ0ZXJMb2FkOiBmdW5jdGlvbihyYXRlcyl7XG4gICAgICAgICQuZWFjaCgkKCdpbnB1dC5kYXRhLXByaWNlJyksIGZ1bmN0aW9uKGksIHByaWNlVGFnKXtcbiAgICAgICAgICAgIHZhciB1c2RQcmljZSA9ICQocHJpY2VUYWcpLmRhdGEoJ3ByaWNlLXVzZCcpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZiAodHlwZW9mIHVzZFByaWNlICE9PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgICQuZWFjaChbJ2dicCcsICdldXInLCAnY2FkJywgJ2F1ZCddLCBmdW5jdGlvbihpLCBjdXJyZW5jeSl7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYocmF0ZXNbY3VycmVuY3kudG9VcHBlckNhc2UoKV0pe1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHByaWNlSW5DdXJyZW5jeSA9IE51bWJlcigoMSAvIHJhdGVzW2N1cnJlbmN5LnRvVXBwZXJDYXNlKCldKSAqIHVzZFByaWNlKS50b0ZpeGVkKDIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJChwcmljZVRhZykuYXR0cignZGF0YS1wcmljZS0nICsgY3VycmVuY3ksIHByaWNlSW5DdXJyZW5jeSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHZhciBkb3VibGVQcmljZSA9ICQocHJpY2VUYWcpLmRhdGEoJ2RhdGEtb2ZmZXItcHJpY2UtdXNkJyk7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmICh0eXBlb2YgZG91YmxlUHJpY2UgIT09ICd1bmRlZmluZWQnKSB7XG4gICAgICAgICAgICAgICAgJC5lYWNoKFsnZ2JwJywgJ2V1cicsICdjYWQnLCAnYXVkJ10sIGZ1bmN0aW9uKGksIGN1cnJlbmN5KXtcblxuICAgICAgICAgICAgICAgICAgICBpZihyYXRlc1tjdXJyZW5jeS50b1VwcGVyQ2FzZSgpXSl7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHJpY2VJbkN1cnJlbmN5ID0gTnVtYmVyKCgxIC8gcmF0ZXNbY3VycmVuY3kudG9VcHBlckNhc2UoKV0pICogZG91YmxlUHJpY2UpLnRvRml4ZWQoMik7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKHByaWNlVGFnKS5hdHRyKCdkYXRhLW9mZmVyLXByaWNlLScgKyBjdXJyZW5jeSwgcHJpY2VJbkN1cnJlbmN5KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgICQoJ2lucHV0LmRhdGEtcHJpY2U6Y2hlY2tlZCcpLmNoYW5nZSgpO1xuICAgIH0sXG4gICAgb25DaGFuZ2U6IGZ1bmN0aW9uKGN1cnJlbnRDdXJyZW5jeSl7XG4gICAgICAgICQoJ2lucHV0LmRhdGEtcHJpY2UnKVxuICAgICAgICAgICAgLmF0dHIoJ2RhdGEtY3VyJywgY3VycmVudEN1cnJlbmN5KVxuICAgICAgICAgICAgLmZpbHRlcignOmNoZWNrZWQnKVxuICAgICAgICAgICAgLmNoYW5nZSgpO1xuICAgIH1cbn07XG5cbihmdW5jdGlvbiggJCApe1xuICAgICAgLy8gdmFyIF9kYXRhT2JqID0gKCQoXCJib2R5XCIpLmhhc0NsYXNzKFwiaWU4XCIpKSA/IGRvY3VtZW50LmJvZHkgOiB3aW5kb3c7XG4gICAgICB2YXIgJHRoaXMgPSB7fSwgJHJhdGVzID0ge30sICRfaHRtbCA9IFwiXCI7XG4gICAgICBcbiAgICAgIHZhciAkX3NldHRpbmdzID0ge1xuICAgICAgICAgICdkZWJ1Zyc6IGZhbHNlLFxuICAgICAgICAgICdhcGlfa2V5JzogJycsIC8vIGFwcF9pZD1cbiAgICAgICAgICAvLyAnaG9zdCc6ICcvY3VycmVuY3kuaHRtbCcsXG4gICAgICAgICAgJ2N1cnJCYXNlJzogJ1VTRCcsXG4gICAgICAgICAgJ2N1cnJDb2RlJzogeyAndXNkJyA6ICckJywgXG4gICAgICAgICAgICAgICAgICAgICAgICAnZXVyJyA6J+KCrCcsIFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2dicCcgOiAnwqMnLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2NhZCcgOiAnJCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAnYXVkJyA6ICckJ30sXG4gICAgICAgICAgJ2ZpbHRlcic6IHtcbiAgICAgICAgICAgICAgJ2lzbyc6IFsnVVNEJywnRVVSJywnR0JQJywnQ0FEJywnQVVEJ11cbiAgICAgICAgICAgfSxcbiAgICAgICAgICAncmF0ZXMnOiB7fSwgLy8gbGlzdCBjdXJyYW5jZSByYXRlc1xuICAgICAgICAgICdjb252ZXJ0Jzoge1xuICAgICAgICAgICAgICAnZnJvbSc6IGZhbHNlLFxuICAgICAgICAgICAgICAndG8nOiBmYWxzZSxcbiAgICAgICAgICB9LFxuICAgICAgICAgICdhamF4Jzoge1xuICAgICAgICAgICAgICAnZGF0YVR5cGUnOiAnanNvbicsXG4gICAgICAgICAgICAgICd0eXBlJzogJ1BPU1QnLFxuICAgICAgICAgICAgICAnY3Jvc3NEb21haW4nOiB0cnVlLFxuICAgICAgICAgICAgICAnZGF0YSc6IHtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgIH0sIFxuICAgICAgICAgICdvbk9wZW4nOiBmYWxzZSxcbiAgICAgIH0gIFxuICAgIFxuICAgICAgLy8gZGV0ZWN0ZWQgbWV0aG9kXG4gICAgICB2YXIgbWV0aG9kcyA9IHtcbiAgICAgICAgaW5pdCA6IGZ1bmN0aW9uKCBvcHRpb25zICkgeyBcbiAgICAgICAgICAgIG1ldGhvZHMuX2RpZSgnTG9hZCBpbml0ISAqQ3VycicpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAkdGhpcyA9ICQodGhpcyk7XG4gICAgICAgICAgICAvLyBzZXQgZmlsdGVyc1xuICAgICAgICAgICAgbWV0aG9kcy5zZXRTZXR0aW5ncyggb3B0aW9ucyApO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAvLyBzZXQgcmF0ZXNcbiAgICAgICAgICAgIG1ldGhvZHMuc2V0UmF0ZXMoKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgIG1ldGhvZHMuX2RpZSgnUmF0ZXMgLi4uJyk7ICAgIFxuICAgICAgICAgICAgbWV0aG9kcy5fZGllKCAkX3NldHRpbmdzLnJhdGVzICk7ICAgXG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8vIGluaXQgbW9uZXlcbiAgICAgICAgICAgIHZhciByYXRlcyA9IG1ldGhvZHMuX2luaXRNb25leSgpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBtZXRob2RzLnRyaWdnZXJDYWxsKCRfc2V0dGluZ3Mub25PcGVuLCByYXRlcyk7XG4gICAgICAgICAgICByZXR1cm4gJCh0aGlzKTtcbiAgICAgICAgfSwgLy8gc2V0IGluaXRcbiAgICAgICAgXG4gICAgICAgIHNldFNldHRpbmdzOiBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgICAgICBpZih0eXBlb2Ygb3B0aW9ucyAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgICAgICAgICAgICRfc2V0dGluZ3MgPSAkLmV4dGVuZCggJF9zZXR0aW5ncywgb3B0aW9ucyB8fCB7fSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIFxuICAgICAgICBzZXRSYXRlczogZnVuY3Rpb24oICRfb2JqICkge1xuICAgICAgICAgICAgaWYodHlwZW9mICRfb2JqICE9PSBcInVuZGVmaW5lZFwiICkge1xuICAgICAgICAgICAgICAgICRfc2V0dGluZ3MucmF0ZXMgPSAkX29iajtcbiAgICAgICAgICAgIH0gZWxzZSBpZigkcmF0ZXMgPSBtZXRob2RzLl9qc29uKCkpIHtcbiAgICAgICAgICAgICAgICAkX3NldHRpbmdzLnJhdGVzID0gJHJhdGVzOyBcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgXG4gICAgICAgIHRyaWdnZXJDYWxsOiBmdW5jdGlvbihmdW5jLCBhcmcpIHtcbiAgICAgICAgICAgICAgICAkLmlzRnVuY3Rpb24oZnVuYykgJiYgZnVuYy5jYWxsKHRoaXMsIGFyZyk7XG4gICAgICAgIH0sXG4gICAgICAgIFxuICAgICAgICBfZGllOiBmdW5jdGlvbihtc2cpIHtcbiAgICAgICAgICAgIGlmKCRfc2V0dGluZ3MuZGVidWcpXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coIG1zZyApO1xuICAgICAgICB9LFxuICAgICAgICBcbiAgICAgICAgLyogPT09PSBpbml0IGNvb2tpZSA9PT09PT0gKi9cbiAgICAgICAgX2NsZWFyQ29va2llOiBmdW5jdGlvbigga2V5ICkge1xuICAgICAgICAgICAgaWYoJC5jb29raWUoIGtleSApKSB7XG4gICAgICAgICAgICAgICAgJC5yZW1vdmVDb29raWUoIGtleSwgeyBwYXRoOiAnLycgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG5cbiAgICAgICAgc2V0Q29va2llOiBmdW5jdGlvbihrZXksIHZhbHVlKSB7XG4gICAgICAgICAgICAkLmNvb2tpZShrZXksIHZhbHVlLCB7IGV4cGlyZXM6IDcsIHBhdGg6ICcvJyB9KTtcbiAgICAgICAgfSxcblxuICAgICAgICBnZXRDb29raWU6IGZ1bmN0aW9uKCBrZXkgKSB7XG4gICAgICAgICAgICBpZigkLmNvb2tpZShrZXkpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuICQuY29va2llKGtleSk7IFxuICAgICAgICAgICAgfSBlbHNlXG4gICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9LFxuICAgICAgICBcbiAgICAgICAgLyogPT09PSBpbml0IGRhdGEgY2FoY2UgPT09PT09ICovXG4gICAgICAgIF9jbGVhckNhY2g6IGZ1bmN0aW9uKGtleSkge1xuLy8gICAgICAgICAgICBpZiggJChcImJvZHlcIikuaGFzQ2xhc3MoXCJpZThcIikgKSB7IFxuLy8gICAgICAgICAgICAgICAgaWYoa2V5KSB7XG4vLyAgICAgICAgICAgICAgICAgICAgalF1ZXJ5LmRhdGEoIGRvY3VtZW50LmJvZHksIGtleSwgZmFsc2UpO1xuLy8gICAgICAgICAgICAgICAgfSBlbHNlIHtcbi8vICAgICAgICAgICAgICAgICAgICBqUXVlcnkuZGF0YSggZG9jdW1lbnQuYm9keSwgJ19yZXN1bHQnLCBmYWxzZSk7XG4vLyAgICAgICAgICAgICAgICB9XG4vLyAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYoa2V5KSB7XG4gICAgICAgICAgICAgICAgICAgIGpRdWVyeS5kYXRhKCB3aW5kb3csIGtleSwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGpRdWVyeS5kYXRhKCB3aW5kb3csICdfcmVzdWx0JywgZmFsc2UpO1xuICAgICAgICAgICAgICAgIH0gICAgXG4vLyAgICAgICAgICAgIH0gICAgXG4gICAgICAgIH0sXG4gICAgICAgIHNldENhY2g6IGZ1bmN0aW9uKGtleSwgcGFyYW1zKSB7XG4gICAgICAgICAgICBrZXkgPSAoIWtleSkgPyBcIl9yZXN1bHRcIiA6IGtleTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYocGFyYW1zKSB7XG4vLyAgICAgICAgICAgICAgICBpZiggJChcImJvZHlcIikuaGFzQ2xhc3MoXCJpZThcIikgKSB7IFxuLy8gICAgICAgICAgICAgICAgICAgIHJldHVybiBqUXVlcnkuZGF0YSggZG9jdW1lbnQuYm9keSwga2V5LCBwYXJhbXMgKTtcbi8vICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBqUXVlcnkuZGF0YSggd2luZG93LCBrZXksIHBhcmFtcyk7XG4vLyAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9IGVsc2Uge1xuLy8gICAgICAgICAgICAgICAgaWYoICQoXCJib2R5XCIpLmhhc0NsYXNzKFwiaWU4XCIpICkgeyBcbi8vICAgICAgICAgICAgICAgICAgICByZXR1cm4galF1ZXJ5LmRhdGEoIGRvY3VtZW50LmJvZHksIGtleSk7XG4vLyAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4galF1ZXJ5LmRhdGEoIHdpbmRvdywga2V5KTtcbi8vICAgICAgICAgICAgICAgIH0gICAgXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgfSwgLy8gc2V0IGNhaGNlXG4gICAgICAgIFxuICAgICAgICBnZXRDYWNoOiBmdW5jdGlvbihrZXkpIHtcbi8vICAgICAgICAgICAgaWYoICQoXCJib2R5XCIpLmhhc0NsYXNzKFwiaWU4XCIpICkge1xuLy8gICAgICAgICAgICAgICAgaWYoalF1ZXJ5LmRhdGEoIGRvY3VtZW50LmJvZHksIGtleSkpXG4vLyAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5kYXRhKCBkb2N1bWVudC5ib2R5LCBrZXkpO1xuLy8gICAgICAgICAgICAgICAgZWxzZVxuLy8gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbi8vICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZihqUXVlcnkuZGF0YSggd2luZG93LCBrZXkpKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4galF1ZXJ5LmRhdGEoIHdpbmRvdywga2V5KTtcbiAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbi8vICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBcbiAgICAgICAgLyogYWpheCAqL1xuICAgICAgICBfanNvbjogZnVuY3Rpb24oX2RhdGEpIHtcbiAgICAgICAgICAgIG1ldGhvZHMuX2RpZSgnTG9hZCBqc29uIGN1cnIuLicpO1xuICAgICAgICAgICAgdmFyIF91cmwgPSAnJywgcmVzdWx0ID0ge307XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgXG4vLyAgICAgICAgICAgIF9kYXRhID0gKF9kYXRhKSA/IF9kYXRhIDoge1xuLy8gICAgICAgICAgICAgICAgJ19iYXNlJzogJF9zZXR0aW5ncy5jdXJyQmFzZSwgLy8gc2V0IEJhc2UgY3VycmFuY2Vcbi8vICAgICAgICAgICAgICAgICdfZmlsdGVyJzogJF9zZXR0aW5ncy5maWx0ZXIgLy8gc2V0IGZpbHRlciBpbiBpc29cbi8vICAgICAgICAgICAgfTsgXG4vLyAgICAgICAgICAgIFxuLy8gICAgICAgICAgICBpZiggJChcImJvZHlcIikuaGFzQ2xhc3MoXCJpZThcIikgfHwgJChcImJvZHlcIikuaGFzQ2xhc3MoXCJpZTlcIikgKSB7IFxuLy8gICAgICAgICAgICAgICAgbWV0aG9kcy5fZGllKCdMb2FkIGllOCBvciBpZTkgLi4uJyk7XG4vLyAgICAgICAgICAgICAgICAvLyBmaXggZm9yIGllOFxuLy8gICAgICAgICAgICAgICAgdmFyIHJlc3BvbmNlID0gJC5hamF4KHtcbi8vICAgICAgICAgICAgICAgICAgIHR5cGU6ICRfc2V0dGluZ3MuYWpheC50eXBlLFxuLy8gICAgICAgICAgICAgICAgICAgdXJsOiAkX3NldHRpbmdzLmhvc3QsXG4vLyAgICAgICAgICAgICAgICAgICBwcm9jZXNzRGF0YTogdHJ1ZSxcbi8vICAgICAgICAgICAgICAgICAgIGFzeW5jOiBmYWxzZSxcbi8vICAgICAgICAgICAgICAgICAgIGNhY2hlOiBmYWxzZSxcbi8vICAgICAgICAgICAgICAgICAgIGRhdGE6ICQuZXh0ZW5kKF9kYXRhLCAkX3NldHRpbmdzLmFqYXguZGF0YSksXG4vLyAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogXCJqc29uXCIsXG4vLyAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbiAoKSB7XG4vLyAgICAgICAgICAgICAgICAgICB9XG4vLyAgICAgICAgICAgICAgICB9KS5yZXNwb25zZVRleHQ7XG4vLyAgICAgICAgICAgICAgICByZXNwb25jZSA9IGV2YWwoJ1snK3Jlc3BvbmNlKyddJyk7XG4vLyAgICAgICAgICAgICAgICBtZXRob2RzLnNldENhY2goJ19hamF4JywgcmVzcG9uY2VbMF0pOyAvLyAucmVzcG9uc2VKU09OXG4vLyAgICAgICAgICAgICAgICBcbi8vICAgICAgICAgICAgfSBlbHNlIHtcbi8vICAgICAgICAgICAgICAgICQuYWpheCh7IFxuLy8gICAgICAgICAgICAgICAgICAgIHR5cGU6ICRfc2V0dGluZ3MuYWpheC50eXBlLFxuLy8gICAgICAgICAgICAgICAgICAgIGFzeW5jOiBmYWxzZSxcbi8vICAgICAgICAgICAgICAgICAgICBjYWNoZTogZmFsc2UsXG4vLyAgICAgICAgICAgICAgICAgICAgdXJsOiAkX3NldHRpbmdzLmhvc3QsXG4vLyAgICAgICAgICAgICAgICAgICAgZGF0YTogJC5leHRlbmQoX2RhdGEsICRfc2V0dGluZ3MuYWpheC5kYXRhKSxcbi8vICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogJF9zZXR0aW5ncy5hamF4LmRhdGFUeXBlLFxuLy8gICAgICAgICAgICAgICAgICAgIGNyb3NzRG9tYWluOiAkX3NldHRpbmdzLmFqYXguY3Jvc3NEb21haW5cbi8vICAgICAgICAgICAgICAgIH0pLmRvbmUoZnVuY3Rpb24ocmVzcG9uY2UpIHtcbi8vICAgICAgICAgICAgICAgICAgICBtZXRob2RzLl9kaWUoICdSZXNwb25jZS4uJyApO1xuLy8gICAgICAgICAgICAgICAgICAgIG1ldGhvZHMuX2RpZSggcmVzcG9uY2UgKTtcbi8vICAgICAgICAgICAgICAgICAgICBpZihyZXNwb25jZSkge1xuLy9cbi8vICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZHMuX2RpZSggcmVzcG9uY2UgKTtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgbWV0aG9kcy5zZXRDYWNoKCdfYWpheCcsIHJlc3BvbmNlKTsgLy8gLnJlc3BvbnNlSlNPTiBcbi8vICAgICAgICAgICAgICAgICAgICB9XG4vLyAgICAgICAgICAgICAgICB9KTtcbi8vICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBpZihpc3NldCgkcmFuZCkgJiYgIW1ldGhvZHMuZ2V0Q2FjaCgnX2FqYXgnKSkgbWV0aG9kcy5zZXRDYWNoKCdfYWpheCcsICRyYW5kKTtcblxuICAgICAgICAgICAgbWV0aG9kcy5fZGllKCAnZ2V0Q2FjaGUuLi4nICk7XG4gICAgICAgICAgICBtZXRob2RzLl9kaWUoIG1ldGhvZHMuZ2V0Q2FjaCgnX2FqYXgnKSApO1xuICAgICAgICAgICAgcmV0dXJuIHJlc3VsdCA9IG1ldGhvZHMuZ2V0Q2FjaCgnX2FqYXgnKTtcbiAgICAgICAgICAgIFxuICAgICAgICB9LFxuICAgICAgICBcbiAgICAgICAgLy8gbW9uZXkgbWF0aFxuICAgICAgICBfaW5pdE1vbmV5OiBmdW5jdGlvbiggZGF0YSApIHtcbiAgICAgICAgICAgIHZhciBfcmF0ZXMgPSB7fTtcbiAgICAgICAgICAgIGlmKCRfc2V0dGluZ3MucmF0ZXMpIHtcbiAgICAgICAgICAgICAgICAkLmVhY2goJF9zZXR0aW5ncy5yYXRlcywgZnVuY3Rpb24oa2V5LCB2YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYodmFsLmlzbylcbiAgICAgICAgICAgICAgICAgICAgICAgIF9yYXRlc1sgdmFsLmlzby50b1VwcGVyQ2FzZSgpIF0gPSBwYXJzZUZsb2F0KCB2YWwucmF0ZXMgKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIFxuICAgICAgICAgICAgbWV0aG9kcy5fZGllKCAgX3JhdGVzICAgKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gaW5pdCBtb25leVxuICAgICAgICAgICAgZngucmF0ZXMgPSAoX3JhdGVzKSA/IF9yYXRlcyA6IGRhdGEucmF0ZXM7XG4gICAgICAgICAgICBmeC5iYXNlID0gKCRfc2V0dGluZ3MuY3VyckJhc2UpID8gJF9zZXR0aW5ncy5jdXJyQmFzZSA6IGRhdGEuYmFzZTtcbiAgICAgICAgICAgIHJldHVybiBfcmF0ZXM7XG4gICAgICAgIH0sXG4gICAgICAgIFxuICAgICAgICBfY29udmVydDogZnVuY3Rpb24oIHByaWNpbmcsIGZyb20sIHRvICkge1xuICAgICAgICAgICAgaWYoIXByaWNpbmcpIHJldHVybiBudWxsO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICB2YXIgX3NldHRpbmdzID0ge1xuICAgICAgICAgICAgICAgIGZyb206IChmcm9tKSA/IGZyb20udG9VcHBlckNhc2UoKSA6IGZhbHNlLFxuICAgICAgICAgICAgICAgIHRvOiAodG8pID8gdG8udG9VcHBlckNhc2UoKSA6IGZhbHNlLFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgcmV0dXJuIGZ4LmNvbnZlcnQocHJpY2luZywgX3NldHRpbmdzKTtcbiAgICAgICAgfSxcbiAgICAgICAgXG4gICAgICAgIGJpbmRFdmVudDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAvLyBjbGljayBcbiAgICAgICAgICAgIGlmKCR0aGlzLmZpbmQoJy5zdG9yZS1mbGFncywgLnN0b3JlLWxpbmstY3VycmFuY3ktZmxhZycpLmxlbmd0aClcbiAgICAgICAgICAgICAgICAkdGhpcy5maW5kKCcuc3RvcmUtZmxhZ3MsIC5zdG9yZS1saW5rLWN1cnJhbmN5LWZsYWcnKS5vbignY2xpY2snLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgICAgdmFyIGN1cnJfY29udmVydCA9ICQodGhpcykuYXR0cignYXR0ci1yYXRlcy1pc28nKTtcbiAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICBpZihtZXRob2RzLmdldENhY2goJ2N1cnJJU08nKSAmJiBjdXJyX2NvbnZlcnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgaWYobWV0aG9kcy5nZXRDYWNoKCdjdXJySVNPJykgIT0gY3Vycl9jb252ZXJ0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RzLnNldENhY2goJ2N1cnJJU08nLCBjdXJyX2NvbnZlcnQpO1xuICAgICAgICAgICAgICAgICAgICAgICB9IFxuICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZXRob2RzLnNldENhY2goJ2N1cnJJU08nLCBjdXJyX2NvbnZlcnQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgLy8gc3RhdHVzXG4gICAgICAgICAgICAgICAgICAgJHRoaXMuZmluZCgnLnN0b3JlLWZsYWdzLCAuc3RvcmUtbGluay1jdXJyYW5jeS1mbGFnJykuZWFjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgaWYoJCh0aGlzKS5oYXNDbGFzcygnYWN0aXZlJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgfSBcbiAgICAgICAgICAgICAgICAgICB9KTsgXG4gICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgJCh0aGlzKS5hZGRDbGFzcygnYWN0aXZlJyk7IFxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAvLyBldmVudCBcbiAgICAgICAgICAgICAgICAgICAgbWV0aG9kcy5hZnRlckV2ZW50KCk7XG4gICAgICAgICAgICAgICAgICAgIC8vIGFsZXJ0KCBtZXRob2RzLl9jb252ZXJ0KDEwMCwgJF9zZXR0aW5ncy5jdXJyQmFzZSwgY3Vycl9jb252ZXJ0IHx8ICRfc2V0dGluZ3MuY3VyckJhc2UpICk7IC8vICdVU0QnLCAnRVVSJyBcbiAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIFxuICAgICAgICB1bmJpbmRFdmVudDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkdGhpcy5maW5kKCcuc3RvcmUtZmxhZ3MsIC5zdG9yZS1saW5rLWN1cnJhbmN5LWZsYWcnKS5vZmYoJ2NsaWNrJyk7XG4gICAgICAgIH0sXG4gICAgICAgIFxuICAgICAgICAvLyBzaG93IGNyZWF0ZSBodG1sIGxpc3QgcmF0ZXNcbiAgICAgICAgc2hvdzogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgc3RhdHVzID0gW107XG4gICAgICAgICAgICAgbWV0aG9kcy5fZGllKCAkX3NldHRpbmdzLnJhdGVzICk7XG4gICAgICAgICAgICAgXG4gICAgICAgICAgICBpZigkX3NldHRpbmdzLnJhdGVzKSB7XG4gICAgICAgICAgICAgICAgJF9odG1sICs9ICc8c3Bhbj5DdXJyZW5jeTo8L3NwYW4+JztcbiAgICAgICAgICAgICAgICAvLyRfaHRtbCArPSAnPHVsIGNsYXNzPVwiY2xlYXJmaXhcIj4nOyBcbiAgICAgICAgICAgICAgICAkLmVhY2goJF9zZXR0aW5ncy5yYXRlcywgZnVuY3Rpb24oa2V5LCB2YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgc3RhdHVzWyBrZXkgXSA9ICh2YWwuaXNvLnRvVXBwZXJDYXNlKCkgPT0gJF9zZXR0aW5ncy5jdXJyQmFzZSkgPyAnYWN0aXZlJyA6ICcnOyBcbiAgICAgICAgICAgICAgICAgICAgLy8kX2h0bWwgKz0gJzxsaT48c3BhbiBjbGFzcz1cInN0b3JlLWZsYWdzIGZsYWctJyt2YWwuaXNvKycgJytzdGF0dXNbIGtleSBdKydcIiBhdHRyLXJhdGVzLWlzbz1cIicrdmFsLmlzbysnXCIgYXR0ci1yYXRlcy1pZD1cIicrdmFsLmlkKydcIj48L3NwYW4+PC9saT4nOyAvLyAnK3ZhbC5pc28udG9VcHBlckNhc2UoKSsnXG4gICAgICAgICAgICAgICAgICAgICRfaHRtbCArPSAnPGEgY2xhc3M9XCJzdG9yZS1saW5rLWN1cnJhbmN5LWZsYWcgJytzdGF0dXNbIGtleSBdKydcIiBhdHRyLXJhdGVzLWlzbz1cIicrdmFsLmlzbysnXCIgYXR0ci1yYXRlcy1pZD1cIicrdmFsLmlkKydcIiBocmVmPVwiI1wiPjxpIGNsYXNzPVwiaWNvLWZsYWctJyt2YWwuaXNvKydcIj48L2k+PHNwYW4+Jyt2YWwuaXNvLnRvVXBwZXJDYXNlKCkrJzwvc3Bhbj48L2E+JztcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAvLyRfaHRtbCArPSAnPC91bD4nO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICR0aGlzLmh0bWwoICRfaHRtbCApO1xuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIG1ldGhvZHMuYmVmb3JlRXZlbnQoKTsgLy8gc2V0dXAgZGVmYXVsdFxuICAgICAgICAgICAgICAgIG1ldGhvZHMuYmluZEV2ZW50KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgfSxcbiAgICAgICAgXG4gICAgICAgIC8vIGJlZm9yZUV2ZW50XG4gICAgICAgIGJlZm9yZUV2ZW50OiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICQoJy5ib3gtY3VycmVuY2UnKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgIHZhciBfc3ltYm9sID0gJCh0aGlzKS5maW5kKCdkaXYuc3ltYm9sJyksXG4gICAgICAgICAgICAgICAgICAgIF9pc28gPSBfc3ltYm9sLmF0dHIoJ2F0dHItaXNvJyk7XG4gICAgICAgICAgICAgICBpZighX2lzby5sZW5ndGgpIF9zeW1ib2wuYXR0cignYXR0ci1pc28nLCAkX3NldHRpbmdzLmN1cnJCYXNlKTtcbiAgICAgICAgICAgICAgIGlmKCFfc3ltYm9sLmxlbmd0aCkgX3N5bWJvbC50ZXh0KCAkX3NldHRpbmdzLmN1cnJDb2RlWyAkX3NldHRpbmdzLmN1cnJCYXNlLnRvTG93ZXJDYXNlKCkgXSApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIFxuICAgICAgICAvLyBhZnRlckV2ZW50XG4gICAgICAgIGFmdGVyRXZlbnQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIGN1cnJlbmN5SGFuZGxlci5vbkNoYW5nZShtZXRob2RzLmdldENhY2goJ2N1cnJJU08nKSk7XG4gICAgICAgICAgXG4gICAgICAgICAgJC5lYWNoKCQoJy5ib3gtY3VycmVuY2UnKSwgZnVuY3Rpb24oaSwgYm94Q3Vycikge1xuICAgIFxuICAgICAgICAgICAgICBtZXRob2RzLl9kaWUoICAkKGJveEN1cnIpICAgKTtcbiAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgIHZhciBfc3ltYm9sID0gJCggYm94Q3VyciApLmZpbmQoJ2Rpdi5zeW1ib2wnKSwgXG4gICAgICAgICAgICAgICAgICBfcHJpY2UgPSAkKCBib3hDdXJyICkuZmluZCgnZGl2LmN1cnInKSxcbiAgICAgICAgICAgICAgICAgIHN5bWJvbCA9IChfc3ltYm9sKSA/IF9zeW1ib2wudGV4dCgpIDogZmFsc2UsIFxuICAgICAgICAgICAgICAgICAgcHJpY2UgPSAoX3ByaWNlKSA/IF9wcmljZS50ZXh0KCkgOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgIGlzbyA9IChfcHJpY2UpID8gX3N5bWJvbC5hdHRyKCdhdHRyLWlzbycpIDogZmFsc2U7XG4gICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgIG1ldGhvZHMuX2RpZSggICdhZnRlckV2ZW50Li4uJyAgICk7XG4gICAgICAgICAgICAgICAgICBtZXRob2RzLl9kaWUoICBzeW1ib2wgICApO1xuICAgICAgICAgICAgICAgICAgbWV0aG9kcy5fZGllKCAgcHJpY2UgICApO1xuICAgICAgICAgICAgICAgICAgbWV0aG9kcy5fZGllKCAgaXNvICAgKTtcbiAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgIGlmKHByaWNlKSB7XG4gICAgICAgICAgICAgICAgICBfcHJpY2UuaHRtbCggbWV0aG9kcy5fY29udmVydCggcGFyc2VGbG9hdChwcmljZSksIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1ldGhvZHMuZ2V0Q2FjaCgnY3VycklTTycpIHx8ICRfc2V0dGluZ3MuY3VyckJhc2UsICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc29cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKS50b0ZpeGVkKDIpICApOyAvLyApLnRvRml4ZWQoMilcbiAgICAgICAgICAgICAgICAgIF9zeW1ib2wuYXR0cignYXR0ci1pc28nLCBtZXRob2RzLmdldENhY2goJ2N1cnJJU08nKSk7ICAgXG4gICAgICAgICAgICAgICAgICBfc3ltYm9sLnRleHQoICRfc2V0dGluZ3MuY3VyckNvZGVbIG1ldGhvZHMuZ2V0Q2FjaCgnY3VycklTTycpLnRvTG93ZXJDYXNlKCkgXSApXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgIFxuICAgICAgICAgIH0pOyAgXG4gICAgICAgICAgXG4gICAgICAgIH0sXG4gICAgICAgIFxuICAgICAgICBydW4gOiBmdW5jdGlvbiggcGFyYW1zICkge1xuICAgICAgICAgICAgbWV0aG9kcy5fZGllKCBwYXJhbXMgKTtcbiAgICAgICAgICAgIG1ldGhvZHMuX2RpZSggJ1JhdGVzIGluaXQnICk7XG4gICAgICAgICAgICBtZXRob2RzLl9kaWUoICRfc2V0dGluZ3MucmF0ZXMgKTtcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIC8vIGNvbnN0cnVjdG9yXG4gICAgICAkLmZuLmN1cnJhbmN5ID0gZnVuY3Rpb24oIG1ldGhvZCwgdHlwZSApIHtcbiAgICAgICAgIFxuICAgICAgICAvLyDQu9C+0LPQuNC60LAg0LLRi9C30L7QstCwINC80LXRgtC+0LTQsFxuICAgICAgICBpZiAoIG1ldGhvZHNbbWV0aG9kXSApIHtcbiAgICAgICAgICAgIHJldHVybiBtZXRob2RzWyBtZXRob2QgXS5hcHBseSggdGhpcywgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoIGFyZ3VtZW50cywgMSApKTtcbiAgICAgICAgfSBlbHNlIGlmICggdHlwZW9mIG1ldGhvZCA9PT0gJ29iamVjdCcgfHwgISBtZXRob2QgKSB7XG4gICAgICAgICAgbWV0aG9kcy5pbml0LmFwcGx5KCB0aGlzLCBhcmd1bWVudHMgKTsgXG4gICAgICAgICAgaWYodHlwZW9mIHR5cGUgIT09IFwidW5kZWZpbmVkXCIgJiYgbWV0aG9kc1t0eXBlXSkge1xuICAgICAgICAgICAgICByZXR1cm4gbWV0aG9kc1t0eXBlXS5hcHBseSggdGhpcywgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoIGFyZ3VtZW50cywgMSApKTtcbiAgICAgICAgICB9IFxuLy8gICAgICAgICAgZWxzZSB7XG4vLyAgICAgICAgICAgICAgcmV0dXJuIG1ldGhvZHMuaW5pdC5hcHBseSggdGhpcywgYXJndW1lbnRzICk7XG4vLyAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgJC5lcnJvciggJ9Cc0LXRgtC+0LQg0YEg0LjQvNC10L3QtdC8ICcgKyAgbWV0aG9kICsgJyDQvdC1INGB0YPRidC10YHRgtCy0YPQtdGCINC00LvRjyBqUXVlcnkudG9vbHRpcCcgKTtcbiAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgXG4gICAgICB9O1xuXG59KSggalF1ZXJ5ICk7IFxuXG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpeyBcbiAgICBcbiAgIGlmKCQoJy5saXN0LWN1cnJlbmNpZXMnKS5sZW5ndGgpIHtcbiAgICAgICQoJy5saXN0LWN1cnJlbmNpZXMnKS5jdXJyYW5jeSh7XG4gICAgICAgICAgb25PcGVuOiBmdW5jdGlvbihyYXRlcykge1xuICAgICAgICAgICAgICBjdXJyZW5jeUhhbmRsZXIuYWZ0ZXJMb2FkKHJhdGVzKTtcbiAgICAgICAgICB9XG4gICAgICB9LCdzaG93Jyk7XG4gICB9XG4gICBcbn0pOyIsIi8qXG4gKiBcdEVhc3kgVG9vbHRpcCAxLjAgLSBqUXVlcnkgcGx1Z2luXG4gKlx0d3JpdHRlbiBieSBBbGVuIEdyYWthbGljXHRcbiAqXHRodHRwOi8vY3NzZ2xvYmUuY29tL3Bvc3QvNDM4MC9lYXN5LXRvb2x0aXAtLWpxdWVyeS1wbHVnaW5cbiAqXG4gKlx0Q29weXJpZ2h0IChjKSAyMDA5IEFsZW4gR3Jha2FsaWMgKGh0dHA6Ly9jc3NnbG9iZS5jb20pXG4gKlx0RHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIChNSVQtTElDRU5TRS50eHQpXG4gKlx0YW5kIEdQTCAoR1BMLUxJQ0VOU0UudHh0KSBsaWNlbnNlcy5cbiAqXG4gKlx0QnVpbHQgZm9yIGpRdWVyeSBsaWJyYXJ5XG4gKlx0aHR0cDovL2pxdWVyeS5jb21cbiAqXG4gKi9cbiBcbihmdW5jdGlvbigkKSB7XG5cblx0JC5mbi5lYXN5VG9vbHRpcCA9IGZ1bmN0aW9uKG9wdGlvbnMpe1xuXHQgIFxuXHRcdC8vIGRlZmF1bHQgY29uZmlndXJhdGlvbiBwcm9wZXJ0aWVzXG5cdFx0dmFyIGRlZmF1bHRzID0ge1x0XG5cdFx0XHR4T2Zmc2V0OiAxMCxcdFx0XG5cdFx0XHR5T2Zmc2V0OiAyNSxcblx0XHRcdHRvb2x0aXBJZDogXCJlYXN5VG9vbHRpcFwiLFxuXHRcdFx0Y2xpY2tSZW1vdmU6IGZhbHNlLFxuXHRcdFx0Y29udGVudDogXCJcIixcblx0XHRcdHVzZUVsZW1lbnQ6IFwiXCJcblx0XHR9OyBcblx0XHRcdFxuXHRcdHZhciBvcHRpb25zID0gJC5leHRlbmQoZGVmYXVsdHMsIG9wdGlvbnMpOyAgXG5cdFx0dmFyIGNvbnRlbnQ7XG5cdFx0XHRcdFxuXHRcdHRoaXMuZWFjaChmdW5jdGlvbigpIHsgIFx0XHRcdFx0XG5cdFx0XHR2YXIgdGl0bGUgPSAkKHRoaXMpLmF0dHIoXCJ0aXRsZVwiKTtcdFx0XHRcdFxuXHRcdFx0JCh0aGlzKS5ob3ZlcihmdW5jdGlvbihlKXtcdFx0XHRcdFx0XHRcdFx0XHRcdFx0IFx0XHRcdFx0XHRcdFx0ICAgXG5cdFx0XHRcdGNvbnRlbnQgPSAob3B0aW9ucy5jb250ZW50ICE9IFwiXCIpID8gb3B0aW9ucy5jb250ZW50IDogdGl0bGU7XG5cdFx0XHRcdGNvbnRlbnQgPSAob3B0aW9ucy51c2VFbGVtZW50ICE9IFwiXCIpID8gJChcIiNcIiArIG9wdGlvbnMudXNlRWxlbWVudCkuaHRtbCgpIDogY29udGVudDtcblx0XHRcdFx0JCh0aGlzKS5hdHRyKFwidGl0bGVcIixcIlwiKTtcdFx0XHRcdFx0XHRcdFx0XHQgIFx0XHRcdFx0XG5cdFx0XHRcdGlmIChjb250ZW50ICE9IFwiXCIgJiYgY29udGVudCAhPSB1bmRlZmluZWQpe1x0XHRcdFxuXHRcdFx0XHRcdCQoXCJib2R5XCIpLmFwcGVuZChcIjxkaXYgaWQ9J1wiKyBvcHRpb25zLnRvb2x0aXBJZCArXCInPlwiKyBjb250ZW50ICtcIjwvZGl2PlwiKTtcdFx0XG5cdFx0XHRcdFx0JChcIiNcIiArIG9wdGlvbnMudG9vbHRpcElkKVxuXHRcdFx0XHRcdFx0LmNzcyhcInBvc2l0aW9uXCIsXCJhYnNvbHV0ZVwiKVxuXHRcdFx0XHRcdFx0LmNzcyhcInRvcFwiLChlLnBhZ2VZIC0gb3B0aW9ucy55T2Zmc2V0KSArIFwicHhcIilcblx0XHRcdFx0XHRcdC5jc3MoXCJsZWZ0XCIsKGUucGFnZVggKyBvcHRpb25zLnhPZmZzZXQpICsgXCJweFwiKVx0XHRcdFx0XHRcdFxuXHRcdFx0XHRcdFx0LmNzcyhcImRpc3BsYXlcIixcIm5vbmVcIilcblx0XHRcdFx0XHRcdC5mYWRlSW4oXCJmYXN0XCIpXG5cdFx0XHRcdH1cblx0XHRcdH0sXG5cdFx0XHRmdW5jdGlvbigpe1x0XG5cdFx0XHRcdCQoXCIjXCIgKyBvcHRpb25zLnRvb2x0aXBJZCkucmVtb3ZlKCk7XG5cdFx0XHRcdCQodGhpcykuYXR0cihcInRpdGxlXCIsdGl0bGUpO1xuXHRcdFx0fSk7XHRcblx0XHRcdCQodGhpcykubW91c2Vtb3ZlKGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHQkKFwiI1wiICsgb3B0aW9ucy50b29sdGlwSWQpXG5cdFx0XHRcdFx0LmNzcyhcInRvcFwiLChlLnBhZ2VZIC0gb3B0aW9ucy55T2Zmc2V0KSArIFwicHhcIilcblx0XHRcdFx0XHQuY3NzKFwibGVmdFwiLChlLnBhZ2VYICsgb3B0aW9ucy54T2Zmc2V0KSArIFwicHhcIilcdFx0XHRcdFx0XG5cdFx0XHR9KTtcdFxuXHRcdFx0aWYob3B0aW9ucy5jbGlja1JlbW92ZSl7XG5cdFx0XHRcdCQodGhpcykubW91c2Vkb3duKGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRcdCQoXCIjXCIgKyBvcHRpb25zLnRvb2x0aXBJZCkucmVtb3ZlKCk7XG5cdFx0XHRcdFx0JCh0aGlzKS5hdHRyKFwidGl0bGVcIix0aXRsZSk7XG5cdFx0XHRcdH0pO1x0XHRcdFx0XG5cdFx0XHR9XG5cdFx0fSk7XG5cdCAgXG5cdH07XG5cbn0pKGpRdWVyeSk7XG4iLCJ2YXIgZCA9IGRvY3VtZW50O1xudmFyIHNhZmFyaSA9IChuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlKCkuaW5kZXhPZignc2FmYXJpJykgIT0gLTEpID8gdHJ1ZSA6IGZhbHNlO1xudmFyIGdlYnRuID0gZnVuY3Rpb24ocGFyRWwsY2hpbGQpIHsgcmV0dXJuIHBhckVsLmdldEVsZW1lbnRzQnlUYWdOYW1lKGNoaWxkKTsgfTtcbm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuXHRcblx0dmFyIGJvZHkgPSBnZWJ0bihkLCdib2R5JylbMF07XG5cdGJvZHkuY2xhc3NOYW1lID0gYm9keS5jbGFzc05hbWUgJiYgYm9keS5jbGFzc05hbWUgIT0gJycgPyBib2R5LmNsYXNzTmFtZSArICcgaGFzLWpzJyA6ICdoYXMtanMnO1xuXHRcblx0aWYgKCFkLmdldEVsZW1lbnRCeUlkIHx8ICFkLmNyZWF0ZVRleHROb2RlKSByZXR1cm47XG5cdHZhciBscyA9IGdlYnRuKGQsJ2xhYmVsJyk7XG5cdGZvciAodmFyIGkgPSAwOyBpIDwgbHMubGVuZ3RoOyBpKyspIHtcblx0XHR2YXIgbCA9IGxzW2ldO1xuXHRcdGlmIChsLmNsYXNzTmFtZS5pbmRleE9mKCdsYWJlbF8nKSA9PSAtMSkgY29udGludWU7XG5cdFx0dmFyIGlucCA9IGdlYnRuKGwsJ2lucHV0JylbMF07XG5cdFx0aWYgKGwuY2xhc3NOYW1lID09ICdsYWJlbF9jaGVjaycpIHtcblx0XHRcdGwuY2xhc3NOYW1lID0gKHNhZmFyaSAmJiBpbnAuY2hlY2tlZCA9PSB0cnVlIHx8IGlucC5jaGVja2VkKSA/ICdsYWJlbF9jaGVjayBjX29uJyA6ICdsYWJlbF9jaGVjayBjX29mZic7XG5cdFx0XHRsLm9uY2xpY2sgPSBjaGVja19pdDtcblx0XHR9O1xuXHRcdGlmIChsLmNsYXNzTmFtZSA9PSAnbGFiZWxfcmFkaW8nKSB7XG5cdFx0XHRsLmNsYXNzTmFtZSA9IChzYWZhcmkgJiYgaW5wLmNoZWNrZWQgPT0gdHJ1ZSB8fCBpbnAuY2hlY2tlZCkgPyAnbGFiZWxfcmFkaW8gcl9vbicgOiAnbGFiZWxfcmFkaW8gcl9vZmYnO1xuXHRcdFx0bC5vbmNsaWNrID0gdHVybl9yYWRpbztcblx0XHR9O1xuXHR9O1xufTtcbnZhciBjaGVja19pdCA9IGZ1bmN0aW9uKCkge1xuXHR2YXIgaW5wID0gZ2VidG4odGhpcywnaW5wdXQnKVswXTtcblx0aWYgKHRoaXMuY2xhc3NOYW1lID09ICdsYWJlbF9jaGVjayBjX29mZicgfHwgKCFzYWZhcmkgJiYgaW5wLmNoZWNrZWQpKSB7XG5cdFx0dGhpcy5jbGFzc05hbWUgPSAnbGFiZWxfY2hlY2sgY19vbic7XG5cdFx0aWYgKHNhZmFyaSkgaW5wLmNsaWNrKCk7XG5cdH0gZWxzZSB7XG5cdFx0dGhpcy5jbGFzc05hbWUgPSAnbGFiZWxfY2hlY2sgY19vZmYnO1xuXHRcdGlmIChzYWZhcmkpIGlucC5jbGljaygpO1xuXHR9O1xufTtcbnZhciB0dXJuX3JhZGlvID0gZnVuY3Rpb24oKSB7XG5cdHZhciBpbnAgPSBnZWJ0bih0aGlzLCdpbnB1dCcpWzBdO1xuXHRpZiAodGhpcy5jbGFzc05hbWUgPT0gJ2xhYmVsX3JhZGlvIHJfb2ZmJyB8fCBpbnAuY2hlY2tlZCkge1xuXHRcdHZhciBscyA9IGdlYnRuKHRoaXMucGFyZW50Tm9kZSwnbGFiZWwnKTtcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IGxzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHR2YXIgbCA9IGxzW2ldO1xuXHRcdFx0aWYgKGwuY2xhc3NOYW1lLmluZGV4T2YoJ2xhYmVsX3JhZGlvJykgPT0gLTEpICBjb250aW51ZTtcblx0XHRcdGwuY2xhc3NOYW1lID0gJ2xhYmVsX3JhZGlvIHJfb2ZmJztcblx0XHR9O1xuXHRcdHRoaXMuY2xhc3NOYW1lID0gJ2xhYmVsX3JhZGlvIHJfb24nO1xuXHRcdGlmIChzYWZhcmkpIGlucC5jbGljaygpO1xuXHR9IGVsc2Uge1xuXHRcdHRoaXMuY2xhc3NOYW1lID0gJ2xhYmVsX3JhZGlvIHJfb2ZmJztcblx0XHRpZiAoc2FmYXJpKSBpbnAuY2xpY2soKTtcblx0fTtcbn07IiwiJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKXsgXG5cbiAgICAvLyBjcmVhdGUgY29va2llXG4gICAgaWYodHlwZW9mICQuY29va2llKCdmbHlfZmVhdHVyZXMnKSA9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICQuY29va2llKCdmbHlfZmVhdHVyZXMnLCAwLCB7ICBcbiAgICAgICAgICAgIGV4cGlyZXM6IDEgLy8g0YPRgdGC0LDQvdC+0LLQuNGC0Ywg0L3QsCDRgdGD0YLQutC4ICBcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIFxuICAgIFxuICAgICQod2luZG93KS5zY3JvbGwoZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBpZiAoJCh0aGlzKS5zY3JvbGxUb3AoKSA+IDEwMCAmJiBcbiAgICAgICAgICAgICAgICAgICAgdHlwZW9mICQuY29va2llKCdmbHlfZmVhdHVyZXMnKSAhPT0gXCJ1bmRlZmluZWRcIiAmJlxuICAgICAgICAgICAgICAgICAgICAhcGFyc2VJbnQoICQuY29va2llKCdmbHlfZmVhdHVyZXMnKSApICkge1xuICAgICAgICAgICAgICAgICAgICAkKCcjZmx5X2ZlYXR1cmVzJykuZmFkZUluKCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkKCcjZmx5X2ZlYXR1cmVzJykuZmFkZU91dCgpO1xuICAgICAgICAgICAgfVxuICAgIH0pO1xuICAgIFxuLy8gICAgaWYodHlwZW9mICQuY29va2llKCdmbHlfZmVhdHVyZXMnKSAhPT0gXCJ1bmRlZmluZWRcIiBcbi8vICAgICAgICAgICAgICAgICYmICFwYXJzZUludCggJC5jb29raWUoJ2ZseV9mZWF0dXJlcycpICkpIHtcbi8vICAgICAgICAgICAgJCgnI2ZseV9mZWF0dXJlcycpLmNzcyh7J2Rpc3BsYXknOiAnaW5saW5lLWJsb2NrJ30pO1xuLy8gICAgfVxuICAgIFxuICAgIGlmKCQoJy5mbHlfY2xvc2UnKS5sZW5ndGgpIHtcbiAgICAgICAgJCgnLmZseV9jbG9zZScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5oaWRlKCk7XG4gICAgICAgICAgICBpZih0eXBlb2YgJC5jb29raWUoJ2ZseV9mZWF0dXJlcycpICE9PSBcInVuZGVmaW5lZFwiIFxuICAgICAgICAgICAgICAgICYmICFwYXJzZUludCggJC5jb29raWUoJ2ZseV9mZWF0dXJlcycpICkpIHtcbiAgICAgICAgICAgICAgICAkLmNvb2tpZSgnZmx5X2ZlYXR1cmVzJywgMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgfVxufSk7XG5cbiIsIi8vIGZpeCBpZTggLSAxMFxudmFyIGFsZXJ0RmFsbGJhY2sgPSBmYWxzZTtcbmlmICh0eXBlb2YgY29uc29sZSA9PT0gXCJ1bmRlZmluZWRcIiB8fCB0eXBlb2YgY29uc29sZS5sb2cgPT09IFwidW5kZWZpbmVkXCIpIHtcbiAgICBjb25zb2xlID0ge307XG4gICAgaWYgKGFsZXJ0RmFsbGJhY2spIHtcbiAgICAgICAgY29uc29sZS5sb2cgPSBmdW5jdGlvbiAobXNnKSB7XG4gICAgICAgICAgICBhbGVydChtc2cpO1xuICAgICAgICB9O1xuICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUubG9nID0gZnVuY3Rpb24gKCkge1xuICAgICAgICB9O1xuICAgIH1cbn1cblxuKGZ1bmN0aW9uICgkKSB7XG5cdFxuXHR2YXIgJF9yZXN1bHQgPSB7XG4gICAgICAgICdfcGxhbnMnOiBmYWxzZSxcbiAgICAgICAgJ19tb2JpbGUnOiBmYWxzZVxuICAgIH07XG4gICAgdmFyICR0aGlzID0ge307XG5cbiAgICB2YXIgX3NldHRpbmdzID0ge1xuICAgICAgICAncGxhbic6IGZhbHNlLFxuICAgICAgICAnbW9iaWxlJzogZmFsc2VcbiAgICB9XG5cbiAgICAvLyBkZXRlY3RlZCBtZXRob2RcbiAgICB2YXIgbWV0aG9kcyA9IHtcbiAgICAgICAgaW5pdDogZnVuY3Rpb24gKG9wdGlvbnMpIHtcblxuICAgICAgICAgICAgLy8gc2V0IGZpbHRlcnNcbiAgICAgICAgICAgIGlmICh0eXBlb2Ygb3B0aW9ucy5maWx0ZXJzICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAgICAgX3NldHRpbmdzLnBsYW5zID0gKG9wdGlvbnMuZmlsdGVycy5wbGFucykgPyBvcHRpb25zLmZpbHRlcnMucGxhbnMgOiBudWxsO1xuICAgICAgICAgICAgICAgIF9zZXR0aW5ncy5tb2JpbGUgPSAob3B0aW9ucy5maWx0ZXJzLm1vYmlsZSkgPyBvcHRpb25zLmZpbHRlcnMubW9iaWxlIDogbnVsbDtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmV0dXJuICQodGhpcyk7XG4gICAgICAgIH0sIC8vIHNldCBpbml0XG5cbiAgICAgICAgX2NsZWFyQ2FjaDogZnVuY3Rpb24gKGtleSkge1xuICAgICAgICAgICAgaWYgKGtleSkge1xuICAgICAgICAgICAgICAgIGpRdWVyeS5kYXRhKHdpbmRvdywga2V5LCBmYWxzZSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGpRdWVyeS5kYXRhKHdpbmRvdywgJ19yZXN1bHQnLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgalF1ZXJ5LmRhdGEod2luZG93LCAnX3BsYW5zJywgZmFsc2UpO1xuICAgICAgICAgICAgICAgIGpRdWVyeS5kYXRhKHdpbmRvdywgJ19tb2JpbGUnLCBmYWxzZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgfSxcbiAgICAgICAgX2NhY2g6IGZ1bmN0aW9uIChwYXJhbXMsIGtleSkge1xuICAgICAgICAgICAga2V5ID0gKCFrZXkpID8gXCJfcmVzdWx0XCIgOiBrZXk7XG4gICAgICAgICAgICBpZiAocGFyYW1zKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIGpRdWVyeS5kYXRhKHdpbmRvdywga2V5LCBwYXJhbXMpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4galF1ZXJ5LmRhdGEod2luZG93LCBrZXkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LCAvLyBzZXQgY2FoY2VcblxuICAgICAgICBfcGxhbnM6IGZ1bmN0aW9uICggKSB7XG4gICAgICAgICAgICBpZiAoX3NldHRpbmdzLnBsYW5zKSB7XG4gICAgICAgICAgICAgICAgdmFyIF9yZXMgPSBbXTtcbiAgICAgICAgICAgICAgICAkLmVhY2goJHRoaXMsIGZ1bmN0aW9uIChrZXksIGl0ZW1fb2JqKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciAkX2l0ZW0gPSAkKGl0ZW1fb2JqKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyICR1c2VfcGxhbnMgPSAkX2l0ZW0uYXR0cignYXR0ci11c2UtcGxhbicpLnNwbGl0KCd8Jyk7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKCQuaW5BcnJheShfc2V0dGluZ3MucGxhbnMsICR1c2VfcGxhbnMpICE9IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfcmVzWyRfaXRlbS5pbmRleCgpXSA9ICRfaXRlbS5pbmRleCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBtZXRob2RzLl9jYWNoKF9yZXMsIFwiX3BsYW5zXCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBtZXRob2RzLl9jbGVhckNhY2goJ19wbGFucycpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdOb3QgZW50ZXIgZmlsdGVycyBQbGFucyAoKnNldHRpbmdzKSEnKTtcbiAgICAgICAgICAgIH1cblxuXG4gICAgICAgIH0sIC8vIHNldCBwbGFucyBmaWx0ZXJzXG5cbiAgICAgICAgX21vYmlsZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKF9zZXR0aW5ncy5tb2JpbGUpIHtcbiAgICAgICAgICAgICAgICB2YXIgX3JlcyA9IFtdO1xuICAgICAgICAgICAgICAgIGlmICghJF9yZXN1bHQuX3BsYW5zKSB7XG4gICAgICAgICAgICAgICAgICAgICQuZWFjaChfc2V0dGluZ3MubW9iaWxlLCBmdW5jdGlvbiAoX3R5cGUsIF9zdGF0dXMpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfc3RhdHVzID09IHRydWUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2goJHRoaXMsIGZ1bmN0aW9uIChrZXksIGl0ZW1fb2JqKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkX2l0ZW0gPSAkKGl0ZW1fb2JqKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRfaXRlbS5maW5kKCcuYm94LWZpbHRlci1tb2JpbGUgaS5pY29uLScgKyBfdHlwZSArICcnKS5pcygnLnN1cHBvcnRlZCcpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfcmVzWyAkX2l0ZW0uaW5kZXgoKSBdID0gJF9pdGVtLmluZGV4KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkLmVhY2goJHRoaXMsIGZ1bmN0aW9uIChrZXksIGl0ZW1fb2JqKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgJF9pdGVtID0gJChpdGVtX29iaik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoJC5pbkFycmF5KCRfaXRlbS5pbmRleCgpLCAkX3Jlc3VsdC5fcGxhbnMpICE9IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKF9zZXR0aW5ncy5tb2JpbGUsIGZ1bmN0aW9uIChfdHlwZSwgX3N0YXR1cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoX3N0YXR1cyA9PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJF9pdGVtLmZpbmQoJy5ib3gtZmlsdGVyLW1vYmlsZSBpLmljb24tJyArIF90eXBlICsgJycpLmlzKCcuc3VwcG9ydGVkJykpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX3Jlc1sgJF9pdGVtLmluZGV4KCkgXSA9ICRfaXRlbS5pbmRleCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgIG1ldGhvZHMuX2NhY2goX3JlcywgXCJfbW9iaWxlXCIpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBtZXRob2RzLl9jbGVhckNhY2goJ19tb2JpbGUnKTtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnTm90IGVudGVyIGZpbHRlcnMgbW9iaWxlICgqc2V0dGluZ3MpIScpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgIH0sIC8vIHNldCBtb2JpbGUgZmlsdGVyc1xuICAgICAgICBfcnVuOiBmdW5jdGlvbiAob2JqKSB7XG4gICAgICAgICAgICBpZiAoIW9iai5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnTm90IGRldGVjdGVkIE9iamVjdHMhJyk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAkdGhpcyA9IG9iajtcblxuICAgICAgICAgICAgbWV0aG9kcy5fcGxhbnMoKTsgLy8gZGV0ZWN0ZWQgcGxhbnNcbiAgICAgICAgICAgICRfcmVzdWx0Ll9wbGFucyA9IG1ldGhvZHMuX2NhY2goZmFsc2UsIFwiX3BsYW5zXCIpOyAvLyBnZXQgcGFyYW1zIHBsYW5zIGluIGNhY2hlXG5cbiAgICAgICAgICAgIGlmICh0eXBlb2YgJF9yZXN1bHQuX3BsYW5zID09PSBcInVuZGVmaW5lZFwiKVxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdOb3QgZW50ZXIgcGxhbnMgZmlsdGVycyEnKTtcbiAgICAgICAgICAgIG1ldGhvZHMuX21vYmlsZSgpOyAvLyBkZXRlY3RlZCBmaWx0ZXJzIG1vYmlsZVxuICAgICAgICAgICAgJF9yZXN1bHQuX21vYmlsZSA9IG1ldGhvZHMuX2NhY2goZmFsc2UsIFwiX21vYmlsZVwiKTsgLy8gZ2V0IHBhcmFtcyBtb2JpbGUgaW4gY2FjaGVcbiAgICAgICAgICAgIGlmICh0eXBlb2YgJF9yZXN1bHQuX21vYmlsZSA9PT0gXCJ1bmRlZmluZWRcIilcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnTm90IGVudGVyIG1vYmlsZSBmaWx0ZXIhJyk7XG4gICAgICAgICAgICBtZXRob2RzLl92aXNpYmxlKCRfcmVzdWx0KTsgLy8gc2hvdy9oaWRlIGVsZW1lbnRzXG4gICAgICAgIH0sXG4gICAgICAgIF92aXNpYmxlOiBmdW5jdGlvbiAoYXJyX2luZGV4KSB7XG4gICAgICAgICAgICBpZiAoJHRoaXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgYXJyX2luZGV4Ll9wbGFucyAhPT0gXCJ1bmRlZmluZWRcIiAmJiBhcnJfaW5kZXguX3BsYW5zLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKCR0aGlzLCBmdW5jdGlvbiAoa2V5LCBpdGVtX29iaikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRfaXRlbSA9ICQoaXRlbV9vYmopO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGFycl9pbmRleC5fcGxhbnMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNldCBwbGFuc1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkLmluQXJyYXkoJF9pdGVtLmluZGV4KCksIGFycl9pbmRleC5fcGxhbnMpICE9IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkX2l0ZW0uaGFzQ2xhc3MoJ2hpZGUnKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRfaXRlbS5yZW1vdmVDbGFzcygnaGlkZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkX2l0ZW0uYWRkQ2xhc3MoJ3Nob3cnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJF9pdGVtLmhhc0NsYXNzKCdzaG93JykpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkX2l0ZW0ucmVtb3ZlQ2xhc3MoJ3Nob3cnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkX2l0ZW0uYWRkQ2xhc3MoJ2hpZGUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgfSk7IC8vIHNob3cvaGlkZSBlbGVtZW50cyBwbGFuc1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGZpbHRlciBtb2JpbGUgaW4gcGxhbnNcbiAgICAgICAgICAgICAgICAgICAgaWYgKGFycl9pbmRleC5fbW9iaWxlLmxlbmd0aCA+IDAgJiYgdHlwZW9mIGFycl9pbmRleC5fbW9iaWxlICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2goJHRoaXMsIGZ1bmN0aW9uIChrZXksIGl0ZW1fb2JqKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRfaXRlbSA9ICQoaXRlbV9vYmopO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkLmluQXJyYXkoJF9pdGVtLmluZGV4KCksIGFycl9pbmRleC5fbW9iaWxlKSAhPSAtMSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoJF9pdGVtLmhhc0NsYXNzKCdoaWRlJykpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkX2l0ZW0ucmVtb3ZlQ2xhc3MoJ2hpZGUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJF9pdGVtLmFkZENsYXNzKCdzaG93Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRfaXRlbS5oYXNDbGFzcygnc2hvdycpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJF9pdGVtLnJlbW92ZUNsYXNzKCdzaG93JylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJF9pdGVtLmFkZENsYXNzKCdoaWRlJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gLy8gc2hvdy9oaWRlIG1vYmlsZSBpbiBwbGFuc1xuXG5cbiAgICAgICAgICAgICAgICB9IC8vIGZpbHRlcnMgcGxhbnNcblxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKCFhcnJfaW5kZXguX3BsYW5zLmxlbmd0aFxuICAgICAgICAgICAgICAgICAgICAgICAgJiYgdHlwZW9mIGFycl9pbmRleC5fbW9iaWxlICE9PSBcInVuZGVmaW5lZFwiXG4gICAgICAgICAgICAgICAgICAgICAgICAmJiBhcnJfaW5kZXguX21vYmlsZS5sZW5ndGggPiAwKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgJC5lYWNoKCR0aGlzLCBmdW5jdGlvbiAoa2V5LCBpdGVtX29iaikge1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyICRfaXRlbSA9ICQoaXRlbV9vYmopO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCQuaW5BcnJheSgkX2l0ZW0uaW5kZXgoKSwgYXJyX2luZGV4Ll9tb2JpbGUpICE9IC0xKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRfaXRlbS5oYXNDbGFzcygnaGlkZScpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkX2l0ZW0ucmVtb3ZlQ2xhc3MoJ2hpZGUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkX2l0ZW0uYWRkQ2xhc3MoJ3Nob3cnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCRfaXRlbS5oYXNDbGFzcygnc2hvdycpKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkX2l0ZW0ucmVtb3ZlQ2xhc3MoJ3Nob3cnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICRfaXRlbS5hZGRDbGFzcygnaGlkZScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IC8vIGFsbCBtb2JpbGUgZmlsdGVyc1xuICAgICAgICAgICAgICAgIGVsc2Uge1xuXG4gICAgICAgICAgICAgICAgICAgICQuZWFjaCgkdGhpcywgZnVuY3Rpb24gKGtleSwgaXRlbV9vYmopIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciAkX2l0ZW0gPSAkKGl0ZW1fb2JqKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICgkX2l0ZW0uaGFzQ2xhc3MoJ2hpZGUnKSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkX2l0ZW0ucmVtb3ZlQ2xhc3MoJ2hpZGUnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICRfaXRlbS5hZGRDbGFzcygnc2hvdycpO1xuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgc2hvdzogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIG1ldGhvZHMuX3J1bigkKHRoaXMpKTtcbiAgICAgICAgfSxcbiAgICAgICAgdXBkYXRlOiBmdW5jdGlvbiAoY29udGVudCkge1xuICAgICAgICAgICAgLy8gISEhXG4gICAgICAgIH1cbiAgICB9O1xuXG4gICAgLy8gY29uc3RydWN0b3JcbiAgICAkLmZuLnRhYlB1bXBpYyA9IGZ1bmN0aW9uIChtZXRob2QpIHtcblxuICAgICAgICAvLyDQu9C+0LPQuNC60LAg0LLRi9C30L7QstCwINC80LXRgtC+0LTQsFxuICAgICAgICBpZiAobWV0aG9kc1ttZXRob2RdKSB7XG4gICAgICAgICAgICByZXR1cm4gbWV0aG9kc1sgbWV0aG9kIF0uYXBwbHkodGhpcywgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSk7XG4gICAgICAgIH0gZWxzZSBpZiAodHlwZW9mIG1ldGhvZCA9PT0gJ29iamVjdCcgfHwgIW1ldGhvZCkge1xuICAgICAgICAgICAgcmV0dXJuIG1ldGhvZHMuaW5pdC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgJC5lcnJvcign0JzQtdGC0L7QtCDRgSDQuNC80LXQvdC10LwgJyArIG1ldGhvZCArICcg0L3QtSDRgdGD0YnQtdGB0YLQstGD0LXRgiDQtNC70Y8galF1ZXJ5LnRvb2x0aXAnKTtcbiAgICAgICAgfVxuXG5cbiAgICB9O1xuXG59KShqUXVlcnkpO1xuXG4vLyBnbG9iYSB2YXJpYWJsZVxuJGRhdGFfaGFzaCA9IFtdO1xuXG52YXIgX2h0bWxQb3BVcCA9IHtcbiAgICAnYm94U3RhdHVzQXV0aCc6ICc8ZGl2IGlkPVwiYm94LXN0YXR1cy1hdXRoXCIgY2xhc3M9XCJwb3BVcFwiPjxkaXY+PGxhYmVsIGNsYXNzPVwidGl0bGUgZ29sZFwiPkhlbGxvITxpIGNsYXNzPVwiY2xvc2Ugc21hbGxcIj48L2k+PC9sYWJlbD48L2Rpdj4nXG4gICAgICAgICAgICArICc8cCBjbGFzcz1cImluZm9cIj5Zb3UgaGF2ZSBqdXN0IGxvZ2dlZCBpbnRvIFB1bXBpYy5jb20sIGVuam95IHlvdXIgdGltZSB3aXRoIHVzIG9yIGdvIHN0cmFpZ2h0IHRvIHlvdXIgPGEgY2xhc3M9XCJhLWRlZmF1bHRcIiBocmVmPVwiaHR0cHM6Ly9jcC5wdW1waWMuY29tXCI+YWNjb3VudDwvYT4uPC9wPidcbiAgICAgICAgICAgICsgJzwvZGl2PicsXG4gICAgJ2JveFN0YXR1c1JlZ2lzdHJhdGlvbic6ICc8ZGl2IGlkPVwiYm94LXN0YXR1cy1yZWdpc3RyYXRpb25cIiBjbGFzcz1cInBvcFVwXCI+J1xuICAgICAgICAgICAgKyAnPGRpdj48bGFiZWwgY2xhc3M9XCJ0aXRsZSBnb2xkXCI+SGVsbG8hPGkgY2xhc3M9XCJjbG9zZSBzbWFsbFwiPjwvaT48L2xhYmVsPjwvZGl2PidcbiAgICAgICAgICAgICsgJzxwIGNsYXNzPVwiaW5mb1wiPllvdSBoYXZlIGp1c3QgcmVnaXN0ZXJlZCBpbiBQdW1waWMuY29tLCBlbmpveSB5b3VyIHRpbWUgd2l0aCB1cyBvciBnbyBzdHJhaWdodCB0byB5b3VyIDxhIGNsYXNzPVwiYS1kZWZhdWx0XCIgaHJlZj1cImh0dHBzOi8vY3AucHVtcGljLmNvbVwiPmFjY291bnQ8L2E+LjwvcD4nXG4gICAgICAgICAgICArICc8L2Rpdj4nLFxuICAgICdib3hTdGF0dXNGcmVlVHJpYWxSZWdpc3RyYXRpb24nOiAnPGRpdiBpZD1cImJveC1zdGF0dXMtZnJlZS10cmlhbC1yZWdpc3RyYXRpb25cIiBjbGFzcz1cInBvcFVwXCI+J1xuICAgICAgICAgICAgKyAnPGRpdj48bGFiZWwgY2xhc3M9XCJ0aXRsZSBnb2xkXCI+VGhhbmsgeW91IGZvciBzaWduaW5nIHVwITxpIGNsYXNzPVwiY2xvc2Ugc21hbGxcIj48L2k+PC9sYWJlbD48L2Rpdj4nXG4gICAgICAgICAgICArICc8cCBjbGFzcz1cImluZm9cIj5UaGUgZW1haWwgd2l0aCByZWdpc3RyYXRpb24gZGV0YWlscyB3YXMgc2VudCB0byAnICsgVXNlckxvZ2luICsgJy48YnIgLz4gWW91IGNhbiBnbyBzdHJhaWdodCB0byB5b3VyIDxhIGNsYXNzPVwiYS1kZWZhdWx0XCIgaHJlZj1cImh0dHBzOi8vY3AucHVtcGljLmNvbVwiPlBlcnNvbmFsIEFjY291bnQ8L2E+IG5vdy48L3A+J1xuICAgICAgICAgICAgKyAnPC9kaXY+JyxcbiAgICAnZW1haWxfc3VjY2Vzcyc6ICc8ZGl2IGlkPVwiYm94LWVtYWlsLXN1Y2Nlc3NcIiBjbGFzcz1cInBvcFVwXCI+J1xuICAgICAgICAgICAgKyAnPGRpdj48bGFiZWwgY2xhc3M9XCJ0aXRsZSBnb2xkXCI+IFRoYW5rIHlvdSEgPGkgY2xhc3M9XCJjbG9zZSBzbWFsbFwiPjwvaT48L2xhYmVsPjwvZGl2PidcbiAgICAgICAgICAgICsgJzxkaXYgY2xhc3M9XCJpbmZvIHRleHQtY2VudGVyXCI+IFlvdXIgZGlzY291bnQgY29kZSB3aWxsIGJlIHNlbnQgdG8geW91IHNvb24uJ1xuICAgICAgICAgICAgKyAnPGZvcm0+PGRpdj48YSBocmVmPVwiI1wiIGNsYXNzPVwiYnV0dG9uLXJlZCBidG4tZGVmYXVsdCBibG9jay1wb3BVcC1jbG9zZVwiPkNsb3NlPC9hPjwvZGl2PjwvZm9ybT4nXG4gICAgICAgICAgICArICc8L2Rpdj48L2Rpdj4nLFxuICAgICdib3hfZW1haWwnOiAnPGRpdiBpZD1cImJveC1lbWFpbFwiIGNsYXNzPVwicG9wVXBcIj4nXG4gICAgICAgICAgICArICc8ZGl2PjxsYWJlbCBjbGFzcz1cInRpdGxlIGdvbGRcIj4gPGI+MTAlPC9iPiBvZmY8aSBjbGFzcz1cImNsb3NlIHNtYWxsXCI+PC9pPjwvbGFiZWw+PC9kaXY+J1xuICAgICAgICAgICAgKyAnPGRpdiBjbGFzcz1cImluZm8gdGV4dC1jZW50ZXJcIj5XYW50IHRvIGdldCA8YSBjbGFzcz1cImEtZGVmYXVsdFwiIGhyZWY9XCIjXCI+MTAlIGRpc2NvdW50PC9hPiByaWdodCBub3c/PGJyIC8+U3Vic2NyaWJlIHRvIG91ciBzcGVjYWlsIHByb21vISdcbiAgICAgICAgICAgICsgJzxmb3JtIGNsYXNzPVwiYmxvY2stcG9wdXAtZm9ybSB0ZXh0LWNlbnRlclwiPidcbiAgICAgICAgICAgICsgJzxkaXY+PGlucHV0IGlkPVwiZW1haWxcIiBjbGFzcz1cInJlcXVpcmVkXCIgdHlwZT1cImVtYWlsXCIgbmFtZT1cImVtYWlsXCIgdmFsdWU9XCJcIiBwbGFjZWhvbGRlcj1cImVtYWlsXCIgLz4nXG4gICAgICAgICAgICArICc8ZGl2IGlkPVwiZW1haWwtZXJyb3JcIiBjbGFzcz1cImVycm9yXCI+PC9kaXY+PC9kaXY+PGRpdj48YnV0dG9uIGNsYXNzPVwiYnV0dG9uLXJlZCBidG4tZGVmYXVsdFwiPlNhdmUgMTAlIHRvZGF5PC9idXR0b24+PC9kaXY+J1xuICAgICAgICAgICAgKyAnPC9mb3JtPjwvZGl2PjwvZGl2PicsXG59O1xuXG4vLyBhbmNob3JcbmpRdWVyeShmdW5jdGlvbiAoKSB7XG4gICAgalF1ZXJ5KHdpbmRvdykuaGFzaGNoYW5nZShmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChkb2N1bWVudC5sb2NhdGlvbi5oYXNoID09ICcnKVxuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB2YXIgaGFzaCA9IGxvY2F0aW9uLmhhc2guc3BsaXQoJyMnKTtcbiAgICAgICAgaWYgKGhhc2gubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgJGRhdGFfaGFzaCA9IGhhc2hbMV07XG4gICAgICAgICAgICBoYXNoY2hhbmdlX29uTG9hZEluaXQoKTtcblxuICAgICAgICAgICAgLy8gaWYoJCgnLmJveC1hbmNob3IgIycraGFzaFsxXSkubGVuZ3RoKVxuICAgICAgICAgICAgLy9pZih0eXBlb2YgJCgnLmJveC1hbmNob3IgIycraGFzaFsxXSkgPT0gXCJvYmplY3RcIilcbiAgICAgICAgICAgIC8vICAgICQoJ2h0bWwsIGJvZHknKS5hbmltYXRlKHtzY3JvbGxUb3A6ICQoJy5ib3gtYW5jaG9yICMnK2hhc2hbMV0pLm9mZnNldCgpLnRvcH0sIDgwMCk7XG4gICAgICAgIH1cblxuICAgIH0pO1xuICAgIGpRdWVyeSh3aW5kb3cpLmhhc2hjaGFuZ2UoKTtcbn0pO1xuXG4vLyBpbml0IGNvb2tpZXNcbmZ1bmN0aW9uIGNvb2tpZV9pbml0KCkge1xuLy8gICAgaWYoIWdldENvb2tpZSgncG9wVXAnKSkge1xuLy8gICAgICAgICQuY29va2llKCdwb3BVcCcsIGZhbHNlLCB7XG4vLyAgICAgICAgICAgICAgICAgICAgICAgIGV4cGlyZXM6IDcsXG4vLyAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6ICcvJ1xuLy8gICAgICAgICAgICAgICAgICAgIH0pO1xuLy8gICAgfVxuXG4gICAgLy8gc2F2ZSBjb29raWUgc2NyZWVuIHdpbmRvd1xuICAgIGlmICghZ2V0Q29va2llKCdfc2NyZWVuJykpIHtcbiAgICAgICAgJC5jb29raWUoJ19zY3JlZW4nLCAkKHdpbmRvdykud2lkdGgoKSArICd4JyArICQod2luZG93KS5oZWlnaHQoKSwge2V4cGlyZXM6IDcsIHBhdGg6ICcvJywgZG9tYWluOiAnLnB1bXBpYy5jb20nfSk7XG4gICAgfVxuXG59XG5cbmZ1bmN0aW9uIGNvcHlfdG9fY2xpcGJvYXJkX2luaXQoKSB7XG4gICAgdmFyIGNsaWVudCA9IG5ldyBaZXJvQ2xpcGJvYXJkKCQoXCIuY29weS10by1jbGlwYm9hcmRcIikpO1xuXG4gICAgY2xpZW50Lm9uKFwiY29weVwiLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgdmFyIGNsaXBib2FyZCA9IGV2ZW50LmNsaXBib2FyZERhdGE7XG4gICAgICAgIGNsaXBib2FyZC5zZXREYXRhKFwidGV4dC9wbGFpblwiLCAkKCcuY29weS10aGlzJykudmFsKCkpO1xuICAgIH0pO1xuXG4gICAgY2xpZW50Lm9uKCdhZnRlcmNvcHknLCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgJCgnLmNvcHktZG9uZScpLnNob3coKS5mYWRlT3V0KDE1MDApO1xuICAgIH0pO1xuXG59XG5cbmZ1bmN0aW9uIGNvb2tpZV9jbGVhcigpIHtcbiAgICBpZiAoJC5jb29raWUoJ3BvcFVwJykpIHtcbiAgICAgICAgJC5yZW1vdmVDb29raWUoJ3BvcFVwJywge3BhdGg6ICcvJ30pO1xuICAgIH1cbn1cblxuZnVuY3Rpb24gc2V0Q29va2llKG5hbWUsIHZhbHVlKSB7XG4gICAgJC5jb29raWUobmFtZSwgdmFsdWUsIHtleHBpcmVzOiA3LCBwYXRoOiAnLyd9KTtcbn1cblxuZnVuY3Rpb24gZ2V0Q29va2llKG5hbWUpIHtcbiAgICBpZiAoJC5jb29raWUobmFtZSkpIHtcbiAgICAgICAgcmV0dXJuICQuY29va2llKG5hbWUpO1xuICAgIH0gZWxzZVxuICAgICAgICByZXR1cm4gZmFsc2U7XG59XG5cbi8vIGluaXQgaGFzaGNoYW5nZSAoIGluaXQgYlBvcFVwIClcbmZ1bmN0aW9uIGhhc2hjaGFuZ2Vfb25Mb2FkSW5pdCgpIHtcblxufVxuXG5mdW5jdGlvbiBoYXNoY2hhbmdlX0FmdGVySW5pdCgpIHtcbiAgICB2YXIgX2RhdGEgPSBfcGFyY2VIYXNoKCRkYXRhX2hhc2gpO1xuICAgIHZhciAkX3BvcFVwID0gJCgnLmJveC1wb3BVcCcpLFxuICAgICAgICAgICAgJGF1dGggPSAkX3BvcFVwLmZpbmQoJyNib3gtc3RhdHVzLWF1dGgnKSxcbiAgICAgICAgICAgICRyZWdpc3RyYXRpb24gPSAkX3BvcFVwLmZpbmQoJyNib3gtc3RhdHVzLXJlZ2lzdHJhdGlvbicpLFxuICAgICAgICAgICAgJHRyaWFsX3JlZ2lzdHJhdGlvbiA9ICRfcG9wVXAuZmluZCgnI2JveC1zdGF0dXMtZnJlZS10cmlhbC1yZWdpc3RyYXRpb24nKTtcbiAgICAvLyBpbml0IGJQb3BVcFxuICAgIGlmIChpc3NldChfZGF0YVsncG9wVXAnXSkgJiYgX2hhc1VzZXIgPT0gJ3RydWUnKSB7XG5cbiAgICAgICAgaWYgKF9kYXRhWydwb3BVcCddID09IFwiYXV0aFwiKSB7IC8vICYmICFnZXRDb29raWUoJ3BvcFVwJylcbiAgICAgICAgICAgIC8vIGdvb2dsZSBhbmFsaXR5Y3NcbiAgICAgICAgICAgIGdhKCdzZW5kJywgJ2V2ZW50JywgJ2Zvcm0nLCAnc3VibWl0JywgJ2xvZ2luLXN1Y2Nlc3MnKTtcblxuICAgICAgICAgICAgaWYgKCEkYXV0aC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAkYXV0aCA9ICRfcG9wVXBcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoX2h0bWxQb3BVcC5ib3hTdGF0dXNBdXRoKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmZpbmQoJyNib3gtc3RhdHVzLWF1dGgnKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgLy8gbG9naW4gc3RhdHVzIG9rXG4gICAgICAgICAgICBpZiAoaXNzZXQoJGF1dGgpKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRpdGxlID0gJGF1dGguZmluZCgnLnRpdGxlJylcbiAgICAgICAgICAgICAgICAgICAgICAgICwgY29udGVudCA9ICRhdXRoLmZpbmQoJy5pbmZvJyk7XG4gICAgICAgICAgICAgICAgJGF1dGguYlBvcHVwKHtcbiAgICAgICAgICAgICAgICAgICAgbW9kYWxDbG9zZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMC42LFxuICAgICAgICAgICAgICAgICAgICBmb2xsb3c6IFtmYWxzZSwgZmFsc2VdLFxuICAgICAgICAgICAgICAgICAgICBwb3NpdGlvblN0eWxlOiAnZml4ZWQnLCAvLydmaXhlZCcgb3IgJ2Fic29sdXRlJ1xuICAgICAgICAgICAgICAgICAgICBvbk9wZW46IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vY29udGVudC5odG1sKCdURVNUIFBPUFVQIGVsZW1lbnQhJyk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGNsb3NlQ2xhc3M6ICdjbG9zZScsXG4gICAgICAgICAgICAgICAgICAgIG9uQ2xvc2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNldENvb2tpZSgncG9wVXAnLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vY29udGVudC5lbXB0eSgpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKF9kYXRhWydwb3BVcCddID09IFwicmVnaXN0cmF0aW9uXCIpIHsgLy8gJiYgIWdldENvb2tpZSgncG9wVXAnKVxuICAgICAgICAgICAgLy8gZ29vZ2xlIGFuYWxpdHljc1xuICAgICAgICAgICAgZ2EoJ3NlbmQnLCAnZXZlbnQnLCAnZm9ybScsICdzdWJtaXQnLCAncmVnaXN0cmF0aW9uLXN1Y2Nlc3MnKTtcblxuICAgICAgICAgICAgaWYgKCEkcmVnaXN0cmF0aW9uLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICRyZWdpc3RyYXRpb24gPSAkX3BvcFVwXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKF9odG1sUG9wVXAuYm94U3RhdHVzUmVnaXN0cmF0aW9uKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmZpbmQoJyNib3gtc3RhdHVzLXJlZ2lzdHJhdGlvbicpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBsb2dpbiBzdGF0dXMgb2tcbiAgICAgICAgICAgIGlmIChpc3NldCgkcmVnaXN0cmF0aW9uKSkge1xuICAgICAgICAgICAgICAgIHZhciB0aXRsZSA9ICRyZWdpc3RyYXRpb24uZmluZCgnLnRpdGxlJylcbiAgICAgICAgICAgICAgICAgICAgICAgICwgY29udGVudCA9ICRyZWdpc3RyYXRpb24uZmluZCgnLmluZm8nKTtcbiAgICAgICAgICAgICAgICAkcmVnaXN0cmF0aW9uLmJQb3B1cCh7XG4gICAgICAgICAgICAgICAgICAgIG1vZGFsQ2xvc2U6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAuNixcbiAgICAgICAgICAgICAgICAgICAgZm9sbG93OiBbZmFsc2UsIGZhbHNlXSxcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb25TdHlsZTogJ2ZpeGVkJywgLy8nZml4ZWQnIG9yICdhYnNvbHV0ZSdcbiAgICAgICAgICAgICAgICAgICAgb25PcGVuOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL2NvbnRlbnQuaHRtbCgnVEVTVCBQT1BVUCBlbGVtZW50IScpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBjbG9zZUNsYXNzOiAnY2xvc2UnLFxuICAgICAgICAgICAgICAgICAgICBvbkNsb3NlOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBzZXRDb29raWUoJ3BvcFVwJywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL2NvbnRlbnQuZW1wdHkoKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuXG4gICAgICAgIC8vZnJlZS10cmlhbC1yZWdpc3RyYXRpb25cbiAgICAgICAgaWYgKF9kYXRhWydwb3BVcCddID09IFwiZnJlZS10cmlhbC1yZWdpc3RyYXRpb25cIikgeyAvLyAmJiAhZ2V0Q29va2llKCdwb3BVcCcpXG4gICAgICAgICAgICBpZiAoISR0cmlhbF9yZWdpc3RyYXRpb24ubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgJHRyaWFsX3JlZ2lzdHJhdGlvbiA9ICRfcG9wVXBcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hcHBlbmQoX2h0bWxQb3BVcC5ib3hTdGF0dXNGcmVlVHJpYWxSZWdpc3RyYXRpb24pXG4gICAgICAgICAgICAgICAgICAgICAgICAuZmluZCgnI2JveC1zdGF0dXMtZnJlZS10cmlhbC1yZWdpc3RyYXRpb24nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGxvZ2luIHN0YXR1cyBva1xuICAgICAgICAgICAgaWYgKGlzc2V0KCR0cmlhbF9yZWdpc3RyYXRpb24pKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRpdGxlID0gJHRyaWFsX3JlZ2lzdHJhdGlvbi5maW5kKCcudGl0bGUnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLCBjb250ZW50ID0gJHRyaWFsX3JlZ2lzdHJhdGlvbi5maW5kKCcuaW5mbycpO1xuXG4gICAgICAgICAgICAgICAgJHRyaWFsX3JlZ2lzdHJhdGlvbi5iUG9wdXAoe1xuICAgICAgICAgICAgICAgICAgICBtb2RhbENsb3NlOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICBvcGFjaXR5OiAwLjYsXG4gICAgICAgICAgICAgICAgICAgIGZvbGxvdzogW2ZhbHNlLCBmYWxzZV0sXG4gICAgICAgICAgICAgICAgICAgIHBvc2l0aW9uU3R5bGU6ICdmaXhlZCcsXG4gICAgICAgICAgICAgICAgICAgIG9uT3BlbjogZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBnb29nbGUgYW5hbGl0eWNzXG4gICAgICAgICAgICAgICAgICAgICAgICBnYSgnc2VuZCcsICdldmVudCcsICd0cmlhbCcsICdwb3B1cCcsICdmcmVlLXRyaWFsLXJlZ2lzdHJhdGlvbi1zdWNjZXNzJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgY2xvc2VDbGFzczogJ2Nsb3NlJyxcbiAgICAgICAgICAgICAgICAgICAgb25DbG9zZTogZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICB9XG59XG5cbmZ1bmN0aW9uIF9wYXJjZUhhc2goaGFzaCkge1xuICAgIHZhciBfZGF0YSA9IHt9O1xuICAgIGlmIChoYXNoLmxlbmd0aCkge1xuICAgICAgICB2YXIgcGFpciA9IChoYXNoKS5zcGxpdCgnJicpO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhaXIubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBwYXJhbSA9IHBhaXJbaV0uc3BsaXQoJz0nKTtcbiAgICAgICAgICAgIF9kYXRhW3BhcmFtWzBdXSA9IHBhcmFtWzFdO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBfZGF0YTtcbn1cblxuXG5mdW5jdGlvbiBpc3NldChlbGVtZW50KSB7XG4gICAgaWYgKHR5cGVvZiBlbGVtZW50ICE9ICd1bmRlZmluZWQnKSB7XG4gICAgICAgIHJldHVybiBlbGVtZW50Lmxlbmd0aCA+IDA7XG4gICAgfSBlbHNlXG4gICAgICAgIHJldHVybiBmYWxzZTtcbn1cblxuLy8gdG9nZ2xlQ2xpY2tlZFxualF1ZXJ5LmZuLmNsaWNrVG9nZ2xlID0gZnVuY3Rpb24gKGEsIGIpIHtcbiAgICB2YXIgYWIgPSBbYiwgYV07XG4gICAgZnVuY3Rpb24gY2IoKSB7XG4gICAgICAgIGFiW3RoaXMuX3RvZyBePSAxXS5jYWxsKHRoaXMpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLm9uKFwiY2xpY2tcIiwgY2IpO1xufTtcblxuLypcbiAoZnVuY3Rpb24oJCkge1xuICQuZm4uY2xpY2tUb2dnbGUgPSBmdW5jdGlvbihmdW5jMSwgZnVuYzIpIHtcbiB2YXIgZnVuY3MgPSBbZnVuYzEsIGZ1bmMyXTtcbiB0aGlzLmRhdGEoJ3RvZ2dsZWNsaWNrZWQnLCAwKTtcbiB0aGlzLmNsaWNrKGZ1bmN0aW9uKGV2ZW50KSB7XG4gZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiB2YXIgZGF0YSA9ICQodGhpcykuZGF0YSgpO1xuIHZhciB0YyA9IGRhdGEudG9nZ2xlY2xpY2tlZDtcbiAkLnByb3h5KGZ1bmNzW3RjXSwgdGhpcykoKTtcbiBkYXRhLnRvZ2dsZWNsaWNrZWQgPSAodGMgKyAxKSAlIDI7XG4gcmV0dXJuIGZhbHNlO1xuIH0pO1xuIHJldHVybiB0aGlzO1xuIH07XG4gfShqUXVlcnkpKTtcbiAqL1xuXG4vKlxuICogcGFyY2UgdXJsXG4gKiovXG5mdW5jdGlvbiBwYXJzZVVybFF1ZXJ5KCkge1xuICAgIHZhciBkYXRhID0ge307XG4gICAgaWYgKGxvY2F0aW9uLnNlYXJjaCkge1xuICAgICAgICB2YXIgcGFpciA9IChsb2NhdGlvbi5zZWFyY2guc3Vic3RyKDEpKS5zcGxpdCgnJicpO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHBhaXIubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHZhciBwYXJhbSA9IHBhaXJbaV0uc3BsaXQoJz0nKTtcbiAgICAgICAgICAgIGRhdGFbcGFyYW1bMF1dID0gcGFyYW1bMV07XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGRhdGE7XG59XG5cblxuZnVuY3Rpb24gY2xpY2tBY3RpdmUob2JqLCBfdGhpcykge1xuICAgIGlmICgkKG9iaikubGVuZ3RoID4gMCkge1xuICAgICAgICAkLmVhY2goJChvYmopLCBmdW5jdGlvbiAoa2V5LCB2YWwpIHtcbiAgICAgICAgICAgIGlmICgkKHZhbCkuaGFzQ2xhc3MoJ2FjdGl2ZScpKVxuICAgICAgICAgICAgICAgICQodmFsKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgIH0pOyAvLyBjbGVhciBhbGwgYWN0aXZlXG4gICAgICAgIF90aGlzLmFkZENsYXNzKCdhY3RpdmUnKTtcbiAgICB9XG59XG5cbi8qXG4gKiBwYXJjZSBzdHJpbmcgc2VyaWxpemVcbiAqKi9cbmZ1bmN0aW9uIHBhcnNlUXVlcnkoc3RyKSB7XG4gICAgdmFyIGRhdGEgPSB7fTtcbiAgICBpZiAodHlwZW9mIHN0ciA9PSAnc3RyaW5nJykge1xuICAgICAgICB2YXIgcGFpciA9IChzdHIpLnNwbGl0KCcmJyk7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcGFpci5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgdmFyIHBhcmFtID0gcGFpcltpXS5zcGxpdCgnPScpO1xuICAgICAgICAgICAgZGF0YVtwYXJhbVswXV0gPSBwYXJhbVsxXTtcbiAgICAgICAgfVxuICAgIH0gZWxzZSBpZiAodHlwZW9mIHN0ciA9PSAnb2JqZWN0Jykge1xuICAgICAgICAkLmVhY2goc3RyLCBmdW5jdGlvbiAoX2ssIF92YWwpIHtcbiAgICAgICAgICAgIGlmIChfdmFsLm5hbWUpXG4gICAgICAgICAgICAgICAgZGF0YVsgX3ZhbC5uYW1lIF0gPSAoX3ZhbC52YWx1ZSkgPyBfdmFsLnZhbHVlIDogbnVsbDtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIHJldHVybiBkYXRhO1xufVxuXG5cbi8qXG4gKiBBamF4IGZ1bmN0aW9uLlxuICogcmV0dXJuIGpzb24gcmVzdWx0XG4gKiovXG5mdW5jdGlvbiBnZXRBamF4Rm9ybShwYXRoLCBwYXJhbXMsIG9wdGlvbnMpIHtcblxuICAgIGlmICghb3B0aW9ucylcbiAgICAgICAgb3B0aW9ucyA9IHt9O1xuXG4gICAgdmFyIHNldHRpbmdzID0gJC5leHRlbmQoe1xuICAgICAgICAnZGF0YVR5cGUnOiAnanNvbicsXG4gICAgICAgICdhc3luYyc6IGZhbHNlLFxuICAgICAgICAnY3Jvc3NEb21haW4nOiBmYWxzZSxcbiAgICAgICAgJ3R5cGUnOiAnUE9TVCcsXG4gICAgICAgICdjYWNoZSc6IHRydWVcbiAgICB9LCBvcHRpb25zIHx8IHt9KTtcblxuXG4gICAgaWYgKCFwYXRoKSB7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICB2YXIgcmVzID0gJC5hamF4KHtcbiAgICAgICAgdXJsOiBwYXRoLFxuICAgICAgICBkYXRhVHlwZTogc2V0dGluZ3MuZGF0YVR5cGUsXG4gICAgICAgIGFzeW5jOiBzZXR0aW5ncy5hc3luYyxcbiAgICAgICAgY3Jvc3NEb21haW46IHNldHRpbmdzLmNyb3NzRG9tYWluLFxuICAgICAgICB0eXBlOiBzZXR0aW5ncy50eXBlLFxuICAgICAgICBjYWNoZTogc2V0dGluZ3MuY2FjaGUsXG4gICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uICgpIHtcblxuICAgICAgICB9LFxuICAgICAgICBjb21wbGV0ZTogZnVuY3Rpb24gKCkge1xuICAgICAgICB9LFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBwYXJhbXM6IHBhcmFtc1xuICAgICAgICB9XG4gICAgfSkucmVzcG9uc2VUZXh0O1xuXG4gICAgY29uc29sZS5sb2cocmVzKTtcblxuICAgIHJlcyA9IGV2YWwoJ1snICsgcmVzICsgJ10nKTtcbiAgICB2YXIgb2JqID0gcmVzWzBdO1xuICAgIHJldHVybiBvYmo7XG59XG5cbi8qXG4gKiBKU09OUFxuICpcbiAqL1xuZnVuY3Rpb24gX2dldEFKQVgocGF0aCwgcGFyYW1zLCBvcHRpb25zKSB7XG4gICAgaWYgKCFvcHRpb25zKVxuICAgICAgICBvcHRpb25zID0ge307XG5cbiAgICB2YXIgc2V0dGluZ3MgPSAkLmV4dGVuZCh7XG4gICAgICAgICdkYXRhVHlwZSc6ICdqc29ucCcsXG4gICAgICAgICdqc29ucCc6IFwiY2FsbGJhY2tcIixcbiAgICAgICAgJ2FzeW5jJzogZmFsc2UsXG4gICAgICAgICdjcm9zc0RvbWFpbic6IGZhbHNlLFxuICAgICAgICAndHlwZSc6ICdQT1NUJyxcbiAgICAgICAgJ2NhY2hlJzogdHJ1ZVxuICAgIH0sIG9wdGlvbnMgfHwge30pO1xuXG4gICAgY29uc29sZS5sb2coc2V0dGluZ3MpO1xuXG4gICAgaWYgKCFwYXRoKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdlbnRlciB1cmwgQUpBWCEnKTtcbiAgICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgcmV0dXJuICQuYWpheCh7XG4gICAgICAgIHR5cGU6IHNldHRpbmdzLnR5cGUsXG4gICAgICAgIGFzeW5jOiBzZXR0aW5ncy5hc3luYyxcbiAgICAgICAgdXJsOiBwYXRoLFxuICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICBwYXJhbXM6IHBhcmFtc1xuICAgICAgICB9LFxuICAgICAgICBkYXRhVHlwZTogc2V0dGluZ3MuZGF0YVR5cGUsXG4gICAgICAgIGpzb25wOiBzZXR0aW5ncy5qc29ucCxcbiAgICAgICAgY3Jvc3NEb21haW46IHNldHRpbmdzLmNyb3NzRG9tYWluLFxuICAgICAgICBjYWNoZTogc2V0dGluZ3MuY2FjaGUsXG4gICAgfSk7XG59XG5cbi8qXG4gKlxuICogQHBhcmFtIHt0eXBlfSAkX21zZ1xuICogQHJldHVybnMge3VuZGVmaW5lZH1cbiAqL1xuZnVuY3Rpb24gZ2V0SnNvbnAoX2RhdGEpIHtcbiAgICBpZiAodHlwZW9mIF9kYXRhICE9ICdvYmplY3QnKSB7XG4gICAgICAgIGRpZSgnRGF0YSBub3Qgb2JqZWN0IScpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBiYXNlVXJsID0gXCJodHRwOi8vYS5wdW1waWMuZGV2L2luZGV4LnBocFwiO1xuICAgIHJldHVybiAkLmFqYXgoe1xuICAgICAgICB0eXBlOiBcIkdFVFwiLFxuICAgICAgICBhc3luYzogZmFsc2UsXG4gICAgICAgIHVybDogYmFzZVVybCxcbiAgICAgICAgZGF0YTogX2RhdGEsXG4gICAgICAgIGRhdGFUeXBlOiBcImpzb25wXCIsXG4gICAgICAgIGpzb25wOiBcImNhbGxiYWNrXCIsXG4gICAgICAgIGNyb3NzRG9tYWluOiB0cnVlXG4gICAgfSk7XG5cbn1cblxuXG4vKlxuICpcbiAqIEBwYXJhbSB7dHlwZX0gJF9tc2dcbiAqIEByZXR1cm5zIHt1bmRlZmluZWR9XG4gKi9cbmZ1bmN0aW9uIHJlbG9hZENhcHRjaGEob2JqLCBlcnJvcikge1xuICAgIGlmICghb2JqLmxlbmd0aClcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIHZhciBfZm9ybSA9IG9iai5wYXJlbnRzKCdmb3JtJyk7XG4gICAgdmFyIF9zcmMgPSAnL2NhcHRjaGEuaHRtbD8nICsgTWF0aC5yYW5kb20oKTtcbiAgICBpZiAoJChvYmopLmF0dHIoJ2F0dHItd2lkdGgnKSAmJiAkKG9iaikuYXR0cignYXR0ci1oZWlnaHQnKSkge1xuICAgICAgICBfc3JjID0gJy9jYXB0Y2hhLmh0bWw/d2lkdGg9JyArICQob2JqKS5hdHRyKCdhdHRyLXdpZHRoJykgKyAnJmhlaWdodD0nICsgJChvYmopLmF0dHIoJ2F0dHItaGVpZ2h0JykgKyAnJicgKyBNYXRoLnJhbmRvbSgpO1xuICAgIH1cbiAgICAkKCcuYm94LWNhcHRjaGEnKS5maW5kKCcjaW1nLWNhcHRjaGEnKS5hdHRyKCdzcmMnLCBfc3JjKTtcblxuICAgIGlmIChlcnJvcilcbiAgICAgICAgX2Zvcm0uZmluZCgnaW5wdXRbbmFtZT1cImNhcHRjaGFcIl0nKS5mb2N1cygpO1xufVxuXG4vKlxuICogRGlzcGxheSBlcnJvciBtYXNzZW5nZVxuICogQHBhcmFtIHt0eXBlfSAkX21zZ1xuICogQHJldHVybnMge3VuZGVmaW5lZH1cbiAqL1xuZnVuY3Rpb24gZGllKCRfbXNnKSB7XG4gICAgY29uc29sZS5sb2coJF9tc2cpO1xufVxuXG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG5cbiAgICAkcnNfd2lkdGggPSBmYWxzZTtcbiAgICAkKHdpbmRvdykucmVzaXplKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgJHJzX3dpZHRoID0gJCh3aW5kb3cpLndpZHRoKClcbiAgICB9KTtcblxuICAgIGlmICghJHJzX3dpZHRoKSB7XG4gICAgICAgICRyc193aWR0aCA9ICQod2luZG93KS53aWR0aCgpO1xuICAgIH1cblxuICAgIGNvb2tpZV9pbml0KCk7XG5cbiAgICBjb3B5X3RvX2NsaXBib2FyZF9pbml0KCk7XG5cbiAgICAkLmRhdGEod2luZG93LCBcImZpbHRlcnNcIiwgZmFsc2UpOyAvLyBpbml0IGNsZWFyIGNhY2hlXG5cbiAgICB2YXIgZmlsdGVycyA9IHtcbiAgICAgICAgJ3BsYW5zJzogZmFsc2UsXG4gICAgICAgICdtb2JpbGUnOiB7XG4gICAgICAgICAgICAnYXBwbGUnOiBmYWxzZSxcbiAgICAgICAgICAgICdhbmRyb2lkJzogZmFsc2UsXG4gICAgICAgICAgICAnYmxhY2tiZXJyeSc6IGZhbHNlXG4gICAgICAgIH1cbiAgICB9OyAvLyBpbml0IHNldHRpbmdzXG5cbiAgICAvLyBhY3RpdmF0ZSB0YWJcbiAgICBpZiAod2luZG93LmxvY2F0aW9uLmhhc2gubGVuZ3RoKSB7XG4gICAgICAgIHZhciBoYXNoID0gd2luZG93LmxvY2F0aW9uLmhhc2gsXG4gICAgICAgICAgICAgICAgJGJ1dHRvbiA9ICQoJ2FbaHJlZj1cIicgKyBoYXNoICsgJ1wiXScpO1xuICAgICAgICBpZiAoJGJ1dHRvbi5sZW5ndGggJiYgJChoYXNoKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICRidXR0b24uYXR0cignZGF0YS10b2dnbGVkJywgJ29uJyk7XG4gICAgICAgICAgICAkYnV0dG9uLnBhcmVudCgpLmFkZENsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgICAgICQoJy5ib3hfY2F0ZWdvcnk+dWw+bGknKS5oaWRlKCk7XG4gICAgICAgICAgICAkKGhhc2gpLnNob3coKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIGZhY2Vib29jayBzaGFyZVxuXG4vLyAgICAkLmFqYXhTZXR1cCh7IGNhY2hlOiB0cnVlIH0pO1xuLy8gICAgJC5nZXRTY3JpcHQoJy8vY29ubmVjdC5mYWNlYm9vay5uZXQvZW5fVVMvc2RrLmpzJywgZnVuY3Rpb24oKXtcbi8vICAgICAgICBGQi5pbml0KHtcbi8vICAgICAgICAgICAgLy8gYXBwSWQ6ICd7eW91ci1hcHAtaWR9Jyxcbi8vICAgICAgICAgICAgdmVyc2lvbjogJ3YyLjQnIC8vIG9yIHYyLjAsIHYyLjEsIHYyLjIsIHYyLjNcbi8vICAgICAgICB9KTtcbi8vICAgICAgICAvLyQoJyNsb2dpbmJ1dHRvbiwjZmVlZGJ1dHRvbicpLnJlbW92ZUF0dHIoJ2Rpc2FibGVkJyk7XG4vLyAgICAgICAgLy8gRkIuZ2V0TG9naW5TdGF0dXModXBkYXRlU3RhdHVzQ2FsbGJhY2spO1xuLy8gICAgfSk7XG5cbiAgICBmdW5jdGlvbiBmYl9zaGFyZSgpIHtcbiAgICAgICAgLy8gZmFjZWJvb2sgc2hhcmUgZGlhbG9nXG4gICAgICAgIEZCLnVpKHtcbiAgICAgICAgICAgIG1ldGhvZDogJ2ZlZWQnLFxuICAgICAgICAgICAgbmFtZTogXCJZb3VyIFBhZ2UgVGl0bGVcIixcbiAgICAgICAgICAgIGxpbms6IFwiaHR0cHM6Ly93d3cud2VibmlyYWouY29tL2xpbmstdG8tcGFnZS9cIixcbiAgICAgICAgICAgIHBpY3R1cmU6IFwiaHR0cHM6Ly9zdGFja2V4Y2hhbmdlLmNvbS91c2Vycy9mbGFpci81NTc5NjkucG5nXCIsXG4gICAgICAgICAgICBjYXB0aW9uOiBcIlNvbWUgZGVzY3JpcHRpb24gaGVyZVwiXG4gICAgICAgIH0sIGZ1bmN0aW9uIChyZXNwb25zZSkge1xuICAgICAgICAgICAgLy8gZG8gbm90aGluZ1xuICAgICAgICB9KTtcblxuICAgIH1cblxuXG5cbiAgICAkKCcuc2hhcmVfbGlzdCBhJykuY2xpY2soZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuXG4gICAgICAgIC8vIGZhY2Vib29rXG4vLyAgICAgICAgaWYoJCh0aGlzKS5oYXNDbGFzcygnc2hhcmUtZmFjZWJvb2snKSkge1xuLy8gICAgICAgICAgIHdpbmRvdy5vcGVuKFwiaHR0cDovL3d3dy5mYWNlYm9vay5jb20vc2hhcmVyL3NoYXJlci5waHA/cz0xMDAmcFt1cmxdPVwiK2VuY29kZVVSSUNvbXBvbmVudCh3aW5kb3cubG9jYXRpb24pK1wiJnBbaW1hZ2VzXVswXT1odHRwOi8vcHVtcGljLmNvbS9pbWFnZXMvc29jaWFscy9zb2NpYWwtaWNvbi5qcGcmcFt0aXRsZV09TW9iaWxlIFBob25lIFNlY3VyaXR5IE1lYXN1cmVzJnBbc3VtbWFyeV09SG93IHRvIHByb3RlY3QgY2hpbGRyZW4gZnJvbSBvbmxpbmUgcHJlZGF0b3JzLCBjeWJlcmJ1bGxpZXMsIDE4KyBjb250ZW50LCBhbmQgaWRlbnRpdHkgdGhlZnQuIFB1bXBpYyBnYXRoZXJlZCBlc3NlbnRpYWwgaW5mb3JtYXRpb24gb24gbW9iaWxlIHBob25lIHNhZmV0eSBwcmFjdGljZS4gTGVhcm4gbW9yZSB0byBrZWVwIGtpZHMgc2FmZS5cIixcbi8vICAgICAgICAgICAnU2hhcmUnLFxuLy8gICAgICAgICAgICdoZWlnaHQ9MzAwLHdpZHRoPTUwMCcpO1xuLy8gICAgICAgICAgIC8vIGZiX3NoYXJlKCk7XG4vLyAgICAgICAgfSBlbHNlIHtcblxuLy8gICAgICAgIGNvbnNvbGUubG9nKCAkKHRoaXMpLmRhdGEoJ2xvY2F0aW9uJykgKyBlbmNvZGVVUklDb21wb25lbnQod2luZG93LmxvY2F0aW9uKSApO1xuICAgICAgICBpZiAoaXNzZXQoJCh0aGlzKS5kYXRhKCdsb2NhdGlvbicpKSAmJiAkKHRoaXMpLmRhdGEoJ2xvY2F0aW9uJykubGVuZ3RoKSB7XG5cbiAgICAgICAgICAgIHZhciBtZWRpYSA9ICcnO1xuICAgICAgICAgICAgaWYgKGlzc2V0KCQodGhpcykuZGF0YSgnbWVkaWEnKSkgJiYgJCh0aGlzKS5kYXRhKCdtZWRpYScpLmxlbmd0aClcbiAgICAgICAgICAgICAgICBtZWRpYSA9ICcmbWVkaWE9JyArICQodGhpcykuZGF0YSgnbWVkaWEnKTtcblxuICAgICAgICAgICAgd2luZG93Lm9wZW4oJCh0aGlzKS5kYXRhKCdsb2NhdGlvbicpICsgZW5jb2RlVVJJQ29tcG9uZW50KHdpbmRvdy5sb2NhdGlvbikgKyBtZWRpYSwgJ1NoYXJlJywgJ2hlaWdodD0zMDAsd2lkdGg9NTAwJyk7XG4gICAgICAgIH1cblxuICAgICAgICAvL31cbiAgICAgICAgcmV0dXJuIGZhbHNlXG4gICAgfSk7XG5cbiAgICAkKCcuYm94LXBsYW5zLCAuYm94LXBob25lJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGZpbHRlcnMgPSAoISQuZGF0YSh3aW5kb3csIFwiZmlsdGVyc1wiKSkgPyBmaWx0ZXJzIDogJC5kYXRhKHdpbmRvdywgXCJmaWx0ZXJzXCIpO1xuICAgICAgICB2YXIgX3JlbCA9ICQodGhpcykuYXR0cigncmVsJyk7XG5cbiAgICAgICAgaWYgKCQodGhpcykuaGFzQ2xhc3MoJ2FjdGl2ZScpKSB7XG4gICAgICAgICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcblxuICAgICAgICAgICAgaWYgKCQodGhpcykuaXMoJy5ib3gtcGxhbnMnKSkge1xuICAgICAgICAgICAgICAgIGZpbHRlcnMucGxhbnMgPSBmYWxzZTtcbiAgICAgICAgICAgIH0gZWxzZSBpZiAoJCh0aGlzKS5pcygnLmJveC1waG9uZScpKSB7XG4gICAgICAgICAgICAgICAgZm9yIChrZXkgaW4gZmlsdGVycy5tb2JpbGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZmlsdGVycy5tb2JpbGVba2V5XSA9IGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgaWYgKCQodGhpcykuaXMoJy5ib3gtcGxhbnMnKSkge1xuICAgICAgICAgICAgICAgIGNsaWNrQWN0aXZlKCcuYm94LXBsYW5zJywgJCh0aGlzKSk7XG4gICAgICAgICAgICAgICAgZmlsdGVycy5wbGFucyA9IF9yZWw7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKCQodGhpcykuaXMoJy5ib3gtcGhvbmUnKSkge1xuICAgICAgICAgICAgICAgIGNsaWNrQWN0aXZlKCcuYm94LXBob25lJywgJCh0aGlzKSk7XG4gICAgICAgICAgICAgICAgLy8gY2xlYXIgYWxsIHBhcmFtcyAoYWZ0ZXIgY2xpY2sgaW4gbW9iaWxlKVxuICAgICAgICAgICAgICAgIGZvciAoa2V5IGluIGZpbHRlcnMubW9iaWxlKSB7XG4gICAgICAgICAgICAgICAgICAgIGZpbHRlcnMubW9iaWxlW2tleV0gPSBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGZpbHRlcnMubW9iaWxlW19yZWxdICE9PSBcInVuZGVmaW5lZFwiKVxuICAgICAgICAgICAgICAgICAgICBmaWx0ZXJzLm1vYmlsZVtfcmVsXSA9IHRydWU7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBjb25zb2xlLmxvZygnc2F2ZSBjYXNoZSBmaWx0ZXIuLi4nKTtcbiAgICAgICAgJC5kYXRhKHdpbmRvdywgXCJmaWx0ZXJzXCIsIGZpbHRlcnMpOyAvLyBzYXZlIGluIHJlc3VsdCBsb2NhbGUgY2FjaGVcbiAgICAgICAgY29uc29sZS5sb2coJ2VuZC4uLicpO1xuXG4gICAgICAgIGNvbnNvbGUubG9nKCdpbml0IFBsdWdpbnMgVGFicy4uLicpO1xuICAgICAgICAkKCcuYm94LWJvZHktZmlsdGVycycpLnRhYlB1bXBpYyh7XG4gICAgICAgICAgICAnZmlsdGVycyc6IGZpbHRlcnNcbiAgICAgICAgfSkudGFiUHVtcGljKCdzaG93Jyk7XG4gICAgICAgIGNvbnNvbGUubG9nKCdlbmQuLi4nKTtcblxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSk7XG5cbiAgICBpZiAoJCgnI2l0ZW0tc3RpY2t5YmFyJykubGVuZ3RoKSB7XG4gICAgICAgIC8vICQoXCIjaXRlbS1zdGlja3liYXJcIikudHJpZ2dlcihcInN0aWNreV9raXQ6ZGV0YWNoXCIpO1xuICAgICAgICAvLyAkKFwiI2l0ZW0tc3RpY2t5YmFyXCIpLnN0aWNrX2luX3BhcmVudCgpO1xuXG5cbiAgICAgICAgJCgnLmxpc3RfY2F0ZWdvcnkgPiBsaScpLmVhY2goZnVuY3Rpb24gKGtleSwgdmFsKSB7XG4gICAgICAgICAgICAkKCcjaXRlbS1zdGlja3liYXIuc3RpY2t5YmFyLScgKyBrZXkpLnN0aWNrX2luX3BhcmVudCgpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2tleSA9ICcgKyBrZXkpO1xuICAgICAgICB9KTtcblxuXG4vLyAgICAgICAgJChcIiNpdGVtLXN0aWNreWJhclwiKS5lYWNoKGZ1bmN0aW9uKGtleSwgdmFsKSB7XG4vLyAgICAgICAgICAgIGNvbnNvbGUubG9nKGtleSk7XG4vLyAgICAgICAgICAgICQodGhpcykuc3RpY2tfaW5fcGFyZW50KCk7XG4vLyAgICAgICAgfSk7XG5cbi8vICAgICAgICAkKFwiI2l0ZW0tc3RpY2t5YmFyXCIpLnN0aWNrX2luX3BhcmVudCh7XG4vLyAgICAgICAgcGFyZW50OiBcIiNpdGVtcy1zdGlja3liYXJcIixcbi8vICAgICAgICBzcGFjZXI6IFwiI2l0ZW0tc3RpY2t5YmFyXCJcbi8vICAgICAgfSk7XG4gICAgfVxuXG4gICAgaWYgKCQoJyNibG9jay1zdGlja3liYXInKS5sZW5ndGgpIHtcbiAgICAgICAgJCgnI2Jsb2NrLXN0aWNreWJhcicpLnN0aWNrX2luX3BhcmVudCgpO1xuICAgIH1cblxuICAgIGlmICgkKCcubGlzdF9jYXRlZ29yeSA+IGxpID4gYVtkYXRhLXRvZ2dsZWQ9XCJvblwiXScpLmxlbmd0aCkge1xuICAgICAgICAkLmVhY2goJCgnLmxpc3RfY2F0ZWdvcnkgPiBsaSA+IGFbZGF0YS10b2dnbGVkPVwib25cIl0nKSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJCgnLmJveF9jYXRlZ29yeSA+IHVsID4gbGknKS5oaWRlKCk7XG4gICAgICAgICAgICBpZiAoJCh0aGlzKS5wYXJlbnQoKS5oYXNDbGFzcygnYWN0aXZlJykpIHtcbiAgICAgICAgICAgICAgICB2YXIgX2hhc2ggPSAkKHRoaXMpLmF0dHIoJ2hyZWYnKS5zcGxpdCgnIycpO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKF9oYXNoWzFdKTtcbiAgICAgICAgICAgICAgICBpZiAoX2hhc2gubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICQoJy5ib3hfY2F0ZWdvcnkgPiB1bCA+IGxpJykuZmluZCgnIycgKyBfaGFzaFsxXSkuY2xvc2VzdCgnbGknKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG5cblxuICAgIC8vY2hlY2sgaWYgbGluayBpcyB3aXRoIGhhc2hcbiAgICB2YXIgY3VyclVybCA9IHdpbmRvdy5sb2NhdGlvbi5oYXNoO1xuICAgIGlmKGN1cnJVcmwpIHtcbiAgICAgICQoJy5saXN0X2NhdGVnb3J5ID4gbGk6Zmlyc3QtY2hpbGQnKS5yZW1vdmVDbGFzcygnYWN0aXZlJylcbiAgICB9XG4gICAgZnVuY3Rpb24gb2Zmc2V0QW5jaG9yKCkge1xuICAgICAgICBpZihsb2NhdGlvbi5oYXNoLmxlbmd0aCAhPT0gMCkge1xuICAgICAgICAgICAgd2luZG93LnNjcm9sbFRvKHdpbmRvdy5zY3JvbGxYLCB3aW5kb3cuc2Nyb2xsWSAtIDkwKTtcbiAgICAgICAgfVxuICAgIH1cblxuICAgIC8vIFRoaXMgd2lsbCBjYXB0dXJlIGhhc2ggY2hhbmdlcyB3aGlsZSBvbiB0aGUgcGFnZVxuICAgICQod2luZG93KS5vbihcImhhc2hjaGFuZ2VcIixvZmZzZXRBbmNob3IpO1xuXG4gICAgLy8gVGhpcyBpcyBoZXJlIHNvIHRoYXQgd2hlbiB5b3UgZW50ZXIgdGhlIHBhZ2Ugd2l0aCBhIGhhc2gsXG4gICAgLy8gaXQgY2FuIHByb3ZpZGUgdGhlIG9mZnNldCBpbiB0aGF0IGNhc2UgdG9vLiBIYXZpbmcgYSB0aW1lb3V0XG4gICAgLy8gc2VlbXMgbmVjZXNzYXJ5IHRvIGFsbG93IHRoZSBicm93c2VyIHRvIGp1bXAgdG8gdGhlIGFuY2hvciBmaXJzdC5cbiAgICB3aW5kb3cuc2V0VGltZW91dChvZmZzZXRBbmNob3IsIDEpO1xuICAgIC8vIGNob29zZSBjYXRlZ29leVxuICAgIC8vJCgnLmxpc3RfY2F0ZWdvcnkgPiBsaTpmaXJzdC1jaGlsZCcpLmFkZENsYXNzKCdhY3RpdmUnKTtcbiAgICAkKCcubGlzdF9jYXRlZ29yeSA+IGxpID4gYScpLm9uKCdjbGljaycsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAvL2V2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHZhciBfaGFzaCA9ICQodGhpcykuYXR0cignaHJlZicpLnNwbGl0KCcjJyksXG4gICAgICAgICAgICAgICAgX2luZGV4ID0gJCh0aGlzKS5jbG9zZXN0KCdsaScpLmluZGV4KCksXG4gICAgICAgICAgICAgICAgJGhvbGRlciA9ICQodGhpcykucGFyZW50KCkucGFyZW50KCk7XG5cbiAgICAgICAgLy8gY29uc29sZS5sb2coJ2luZGV4ID0gJytfaW5kZXgpO1xuXG4gICAgICAgIHZhciBzdG9yZV9oaXN0b3J5ID0gJGhvbGRlci5hdHRyKCdzYXZlLXN0YXRlJyk7XG5cbiAgICAgICAgaWYgKHR5cGVvZiBzdG9yZV9oaXN0b3J5ICE9PSB0eXBlb2YgdW5kZWZpbmVkICYmIHN0b3JlX2hpc3RvcnkgIT09IGZhbHNlKSB7XG4gICAgICAgICAgICB3aW5kb3cubG9jYXRpb24uaGFzaCA9ICQodGhpcykuYXR0cignaHJlZicpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gY2xlYXIgYWxsIGFjdGl2ZVxuICAgICAgICAkLmVhY2goJCgnLmxpc3RfY2F0ZWdvcnkgPiBsaScpLm5vdChcIjplcShcIiArIF9pbmRleCArIFwiKVwiKSwgZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgaWYgKCQodGhpcykuaGFzQ2xhc3MoJ2FjdGl2ZScpKVxuICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuXG4gICAgICAgICAgICBpZiAoJCh0aGlzKS5jaGlsZHJlbignYScpLmF0dHIoJ2RhdGEtdG9nZ2xlZCcpID09ICdvbicpIHtcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmNoaWxkcmVuKCdhJykuYXR0cignZGF0YS10b2dnbGVkJywgJ29mZicpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTsgLy8gY2xlYXIgYWN0aXZlXG5cbiAgICAgICAgLy8gYWxsIGFkZCBhdHRyIG9mZlxuXG4gICAgICAgIGlmICghJCh0aGlzKS5hdHRyKCdkYXRhLXRvZ2dsZWQnKSB8fCAkKHRoaXMpLmF0dHIoJ2RhdGEtdG9nZ2xlZCcpID09ICdvZmYnKSB7XG4gICAgICAgICAgICAkKHRoaXMpLmF0dHIoJ2RhdGEtdG9nZ2xlZCcsICdvbicpO1xuXG4gICAgICAgICAgICAkKFwiLmxpc3RfY2F0ZWdvcnlcIikuZWFjaChmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIGlmICgkKHRoaXMpLmZpbmQoXCJsaTplcShcIiArIF9pbmRleCArIFwiKVwiKS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgICAgICQodGhpcykuZmluZChcImxpOmVxKFwiICsgX2luZGV4ICsgXCIpXCIpLmFkZENsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICAkKCcuYm94X2NhdGVnb3J5ID4gdWwgPiBsaScpLmhpZGUoKTtcblxuICAgICAgICAgICAgaWYgKF9oYXNoLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICAgICBpZiAoX2hhc2hbMV0gPT0gJ2FsbCcpIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnLmJveF9jYXRlZ29yeSA+IHVsID4gbGknKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnLmJveF9jYXRlZ29yeSA+IHVsID4gbGknKS5maW5kKCcjJyArIF9oYXNoWzFdKS5jbG9zZXN0KCdsaScpLnNob3coKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICBpZiAoJCgnLmJveF9jYXRlZ29yeSA+IHVsID4gbGknKS5maW5kKCcjJyArIF9oYXNoWzFdKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gJCgnaHRtbCwgYm9keScpLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICAvLyAgICAgc2Nyb2xsVG9wOiBNYXRoLmNlaWwoJCgnLmJveF9jYXRlZ29yeSA+IHVsID4gbGknKS5maW5kKCcjJyArIF9oYXNoWzFdKS5vZmZzZXQoKS50b3ApIC8vIE1hdGguY2VpbCgodGFyZ2V0X3RvcCAqICQod2luZG93KS5vdXRlckhlaWdodCh0cnVlKSkgLyAkKCdodG1sLCBib2R5JykuaGVpZ2h0KCkpXG4gICAgICAgICAgICAgICAgICAgIC8vIH0sICdsaW5lYXInKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH1cblxuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCQodGhpcykuYXR0cignZGF0YS10b2dnbGVkJykgPT0gJ29uJykge1xuICAgICAgICAgICAgJCh0aGlzKS5hdHRyKCdkYXRhLXRvZ2dsZWQnLCAnb2ZmJyk7XG5cbiAgICAgICAgICAgICQoXCIubGlzdF9jYXRlZ29yeVwiKS5lYWNoKGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgaWYgKCQodGhpcykuZmluZChcImxpOmVxKFwiICsgX2luZGV4ICsgXCIpXCIpLmhhc0NsYXNzKCdhY3RpdmUnKSlcbiAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5maW5kKFwibGk6ZXEoXCIgKyBfaW5kZXggKyBcIilcIikucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICQoJy5ib3hfY2F0ZWdvcnkgPiB1bCA+IGxpJykuc2hvdygpO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gJCgnI2l0ZW0tc3RpY2t5YmFyJykudHJpZ2dlcihcInN0aWNreV9raXQ6cmVjYWxjXCIpO1xuXG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9KTtcblxuLy9cbi8vICAgICAkKCcubGlzdF9jYXRlZ29yeSA+IGxpID4gYScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGV2ZW50KSB7XG4vLyAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4vLyAgICAgICAgIHZhciBfaGFzaCA9ICQodGhpcykuYXR0cignaHJlZicpLnNwbGl0KCcjJyk7XG4vL1xuLy8gICAgICAgICAkLmVhY2goJCgnLmxpc3RfY2F0ZWdvcnkgPiBsaScpLCBmdW5jdGlvbigpIHtcbi8vICAgICAgICAgICAgaWYoJCh0aGlzKS5oYXNDbGFzcygnYWN0aXZlJykpXG4vLyAgICAgICAgICAgICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcbi8vICAgICAgICAgfSk7IC8vIGNsZWFyIGFjdGl2ZVxuLy9cbi8vICAgICAgICAgaWYoJCh0aGlzKS5wYXJlbnQoKS5oYXNDbGFzcygnYWN0aXZlJykpIHtcbi8vICAgICAgICAgICAgICQodGhpcykucGFyZW50KCkucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuLy8gICAgICAgICAgICAgJCgnLmJveF9jYXRlZ29yeSA+IHVsID4gbGknKS5zaG93KCk7XG4vLyAgICAgICAgIH0gZWxzZSB7XG4vLyAgICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgpLmFkZENsYXNzKCdhY3RpdmUnKTtcbi8vICAgICAgICAgICAgICQoJy5ib3hfY2F0ZWdvcnkgPiB1bCA+IGxpJykuaGlkZSgpO1xuLy8gICAgICAgICAgICAgaWYoX2hhc2gubGVuZ3RoID4gMSkge1xuLy8gICAgICAgICAgICAgICAgaWYoX2hhc2hbMV0gPT0gJ2FsbCcpIHtcbi8vICAgICAgICAgICAgICAgICAgICAkKCcuYm94X2NhdGVnb3J5ID4gdWwgPiBsaScpLnNob3coKTtcbi8vICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4vLyAgICAgICAgICAgICAgICAgICAgJCgnLmJveF9jYXRlZ29yeSA+IHVsID4gbGknKS5maW5kKCcjJytfaGFzaFsxXSkuY2xvc2VzdCgnbGknKS5zaG93KCk7XG4vLyAgICAgICAgICAgICAgICB9XG4vL1xuLy9cbi8vICAgICAgICAgICAgIH1cbi8vICAgICAgICAgfVxuLy9cbi8vICAgICAgICAgcmV0dXJuIGZhbHNlO1xuLy8gICAgIH0pO1xuXG4gICAgLy8g0Y/QutC+0YDQuFxuICAgICQoJ2EuYW5jaG9yJykub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHZhciBhbmNob3IgPSAkKHRoaXMpLmF0dHIoJ2hyZWYnKS5zcGxpdCgnIycpO1xuICAgICAgICBpZiAoYW5jaG9yLmxlbmd0aCA+IDEpIHtcbiAgICAgICAgICAgICQoJ2h0bWwsIGJvZHknKS5zdG9wKCkuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgc2Nyb2xsVG9wOiAkKCcuYm94LWFuY2hvciAjJyArIGFuY2hvclsxXSkub2Zmc2V0KCkudG9wXG4gICAgICAgICAgICB9LCAxMDAwKTtcbiAgICAgICAgfVxuXG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0pO1xuXG5cbi8vICAgJCgnLnNlYXJjaC1jYXRlZ29yeScpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGUpIHtcbi8vICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbi8vICAgICAgIHZhciBfb3MgPSAkKHRoaXMpLmF0dHIoJ2F0dHJfb3MnKTtcbi8vICAgICAgIGlmKCBfb3MpIHtcbi8vICAgICAgICAgICAkLmZuLlB1bXBpY0xpc3QoJ3NlYXJjaCcsIHtcbi8vICAgICAgICAgICAgICAgJ3NlYXJjaF9tZXRob2QnOiAnZ2V0UGhvbmVzQnlPUycsXG4vLyAgICAgICAgICAgICAgICdfbWV0aG9kJzogJ2dldENvdW50T1MnLFxuLy8gICAgICAgICAgICAgICAnX3F1ZXJ5JzogX29zXG4vLyAgICAgICAgICAgfSk7XG4vLyAgICAgICB9XG4vL1xuLy8gICAgICAgcmV0dXJuIGZhbHNlO1xuLy8gICB9KTtcblxuICAgIC8vIGNvbXBhdGliaWxpdHkgdG9vbHRpcCBpbiBkZXZpY2VcbiAgICBpZiAoJCgnLm1vYmlsZV90b29sdGlwJykubGVuZ3RoKSB7XG4gICAgICAgICQoJy5tb2JpbGVfdG9vbHRpcCcpLmVhc3lUb29sdGlwKCk7XG4gICAgfVxuXG4gICAgLy8gZm9jdXNcbiAgICBpZiAoJCgnLmZvcm0tZGlzY291bnQnKS5sZW5ndGgpIHtcbiAgICAgICAgdmFyIGVsZW1lbnRzID0gJChcIi5mb3JtLWRpc2NvdW50IGlucHV0W3R5cGUhPSdzdWJtaXQnXSwgLmZvcm0tZGlzY291bnQgdGV4dGFyZWEsIC5mb3JtLWRpc2NvdW50IHNlbGVjdFwiKTtcbiAgICAgICAgZWxlbWVudHMuZm9jdXMoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgJCh0aGlzKS5hZGRDbGFzcygnaGlnaGxpZ2h0Jyk7XG4gICAgICAgIH0pO1xuICAgICAgICBlbGVtZW50cy5ibHVyKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICQodGhpcykucmVtb3ZlQ2xhc3MoJ2hpZ2hsaWdodCcpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBpZiAoJCgnLmJveC1mb3JtJykubGVuZ3RoKSB7XG4gICAgICAgIHZhciBlbGVtZW50cyA9ICQoXCIuYm94LWZvcm0gaW5wdXRbdHlwZSE9J3N1Ym1pdCddLCAuYm94LWZvcm0gdGV4dGFyZWEsIC5ib3gtZm9ybSBzZWxlY3RcIik7XG4gICAgICAgIGVsZW1lbnRzLmZvY3VzKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICQodGhpcykuYWRkQ2xhc3MoJ2hpZ2hsaWdodCcpO1xuICAgICAgICB9KTtcbiAgICAgICAgZWxlbWVudHMuYmx1cihmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkKHRoaXMpLnJlbW92ZUNsYXNzKCdoaWdobGlnaHQnKTtcbiAgICAgICAgfSk7XG4gICAgfVxuXG5cbiAgICAvLyBjb21wYXRpYmlsaXR5X2Zvcm1cbiAgICB2YXIgdmFsaWRhdG9yX3NlbmRfZmluZF9waG9uZSA9ICQoJ2Zvcm1bbmFtZT1cInNlbmRfZmluZF9waG9uZVwiXScpLnZhbGlkYXRlKHtcbiAgICAgICAgb25mb2N1c291dDogZmFsc2UsXG4gICAgICAgIG9ua2V5dXA6IGZhbHNlLFxuICAgICAgICBvbmNsaWNrOiB0cnVlLFxuICAgICAgICBvbnN1Ym1pdDogdHJ1ZSxcbiAgICAgICAgZm9jdXNJbnZhbGlkOiBmYWxzZSxcbiAgICAgICAgZm9jdXNDbGVhbnVwOiBmYWxzZSxcbiAgICAgICAgZGVidWc6IGZhbHNlLFxuICAgICAgICAnZGV2aWNlLW1vZGVsJzoge1xuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWVcbiAgICAgICAgfSxcbiAgICAgICAgJ2NhcHRjaGEnOiB7XG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICBlbWFpbDoge1xuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICBlbWFpbDogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICBuYW1lOiB7XG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICBtZXNzYWdlczoge1xuICAgICAgICAgICAgJ2NhcHRjaGEnOiBcIkludmFsaWQgQ0FQVENIQS5cIiwgLy8gVGhlIENBUFRDSEEgZmllbGQgaXMgZW1wdHkuXG4gICAgICAgICAgICBuYW1lOiBcIlRoZSBOYW1lIGZpZWxkIGlzIGVtcHR5XCIsXG4gICAgICAgICAgICAnZGV2aWNlLW1vZGVsJzogXCJUaGUgRGV2aWNlIE1vZGVsIGZpZWxkIGlzIGVtcHR5XCIsXG4gICAgICAgICAgICBlbWFpbDoge1xuICAgICAgICAgICAgICAgIHJlcXVpcmVkOiBcIlRoZSBFbWFpbCBmaWVsZCBpcyBlbXB0eVwiLFxuICAgICAgICAgICAgICAgIGVtYWlsOiBcIkludmFsaWQgZW1haWwgZm9ybWF0XCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3JDbGFzczogXCJpbnZhbGlkXCIsXG4gICAgICAgIHZhbGlkQ2xhc3M6IFwic3VjY2Vzc1wiLFxuICAgICAgICBpbnZhbGlkSGFuZGxlcjogZnVuY3Rpb24gKGV2ZW50LCB2YWxpZGF0b3IpIHtcbiAgICAgICAgICAgIGlmICgkKCdmb3JtW25hbWU9XCJzZW5kX2ZpbmRfcGhvbmVcIl0gc3Bhbi5pbmZvJykubGVuZ3RoKVxuICAgICAgICAgICAgICAgICQoJ2Zvcm1bbmFtZT1cInNlbmRfZmluZF9waG9uZVwiXSBzcGFuLmluZm8nKS5odG1sKFwiIFwiKS5oaWRlKCk7XG5cbiAgICAgICAgICAgIGlmICgkKCdmb3JtW25hbWU9XCJzZW5kX2ZpbmRfcGhvbmVcIl0gLmZhdGFsLWVycm9yJykubGVuZ3RoKVxuICAgICAgICAgICAgICAgICQoJ2Zvcm1bbmFtZT1cInNlbmRfZmluZF9waG9uZVwiXSAuZmF0YWwtZXJyb3InKS5odG1sKFwiIFwiKS5oaWRlKCk7XG5cbiAgICAgICAgICAgIGlmICgkKCdmb3JtW25hbWU9XCJzZW5kX2ZpbmRfcGhvbmVcIl0gbGFiZWwuZXJyb3IsIGZvcm1bbmFtZT1cInNlbmRfZmluZF9waG9uZVwiXSBsYWJlbC5pbnZhbGlkJykubGVuZ3RoKVxuICAgICAgICAgICAgICAgICQoJ2Zvcm1bbmFtZT1cInNlbmRfZmluZF9waG9uZVwiXSBsYWJlbC5lcnJvciwgZm9ybVtuYW1lPVwic2VuZF9maW5kX3Bob25lXCJdIGxhYmVsLmludmFsaWQnKS5yZW1vdmUoKTtcbiAgICAgICAgfSxcbiAgICAgICAgLy8g0YPQv9GA0LDQstC70LXQvdC40LUg0L7RiNC40LHQutCw0LzQuFxuICAgICAgICBzaG93RXJyb3JzOiBmdW5jdGlvbiAoZXJyb3JNYXAsIGVycm9yTGlzdCkge1xuICAgICAgICAgICAgdmFyIF9mb3JtID0gJCgnZm9ybVtuYW1lPVwic2VuZF9maW5kX3Bob25lXCJdJyk7XG4gICAgICAgICAgICB2YXIgbXNnID0gbnVsbDtcblxuICAgICAgICAgICAgJC5lYWNoKGVycm9yTGlzdCwgZnVuY3Rpb24gKGtleSwgdmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUuZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IF9mb3JtLmZpbmQodmFsdWUuZWxlbWVudCkuYXR0cignbmFtZScpO1xuICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyggbmFtZSApO1xuICAgICAgICAgICAgICAgICAgICBfZm9ybS5maW5kKHZhbHVlLmVsZW1lbnQpLmFmdGVyKCc8bGFiZWwgaWQ9XCInICsgbmFtZSArICctZXJyb3JcIiBmb3I9XCInICsgbmFtZSArICdcIiBjbGFzcz1cImludmFsaWRcIj4nICsgdmFsdWUubWVzc2FnZSArICc8L2xhYmVsPicpO1xuICAgICAgICAgICAgICAgICAgICBfZm9ybS5maW5kKHZhbHVlLmVsZW1lbnQpLm5leHQoKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHN1Ym1pdEhhbmRsZXI6IGZ1bmN0aW9uIChmb3JtKSB7XG4gICAgICAgICAgICBpZiAoJCgnZm9ybVtuYW1lPVwic2VuZF9maW5kX3Bob25lXCJdIHNwYW4uaW5mbycpLmxlbmd0aClcbiAgICAgICAgICAgICAgICAkKCdmb3JtW25hbWU9XCJzZW5kX2ZpbmRfcGhvbmVcIl0gc3Bhbi5pbmZvJykuaHRtbChcIiBcIikuaGlkZSgpO1xuXG4gICAgICAgICAgICBpZiAoJCgnZm9ybVtuYW1lPVwic2VuZF9maW5kX3Bob25lXCJdIC5mYXRhbC1lcnJvcicpLmxlbmd0aClcbiAgICAgICAgICAgICAgICAkKCdmb3JtW25hbWU9XCJzZW5kX2ZpbmRfcGhvbmVcIl0gLmZhdGFsLWVycm9yJykuaHRtbChcIiBcIikuaGlkZSgpO1xuXG4gICAgICAgICAgICBpZiAoJCgnZm9ybVtuYW1lPVwic2VuZF9maW5kX3Bob25lXCJdIGxhYmVsLmVycm9yLCBmb3JtW25hbWU9XCJzZW5kX2ZpbmRfcGhvbmVcIl0gbGFiZWwuaW52YWxpZCcpLmxlbmd0aClcbiAgICAgICAgICAgICAgICAkKCdmb3JtW25hbWU9XCJzZW5kX2ZpbmRfcGhvbmVcIl0gbGFiZWwuZXJyb3IsIGZvcm1bbmFtZT1cInNlbmRfZmluZF9waG9uZVwiXSBsYWJlbC5pbnZhbGlkJykucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgIHZhciAkZm9ybSA9ICQoZm9ybSk7XG4gICAgICAgICAgICB2YXIgX3BhcmFtcyA9IHBhcnNlUXVlcnkoJGZvcm0uc2VyaWFsaXplQXJyYXkoKSk7XG5cbiAgICAgICAgICAgIHZhciBfcmVzcG9uc2UgPSBnZXRBamF4Rm9ybSgnL2NvbXBhdGliaWxpdHlfc2VuZC5odG1sJywgX3BhcmFtcyk7XG4gICAgICAgICAgICBpZiAoX3Jlc3BvbnNlLnJlc3VsdCkge1xuICAgICAgICAgICAgICAgIHZhciBfcmVzID0gX3Jlc3BvbnNlLnJlc3VsdDtcbiAgICAgICAgICAgICAgICBpZiAoX3Jlcy5lcnJvcikge1xuXG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgX3Jlcy5lcnJvciA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQuZWFjaChfcmVzLmVycm9yLCBmdW5jdGlvbiAobmFtZSwgdGV4dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfb2JqID0gJGZvcm0uZmluZCgnaW5wdXRbbmFtZT1cIicgKyBuYW1lICsgJ1wiXScpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9vYmoubGVuZ3RoKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9vYmoubmV4dCgnbGFiZWwnKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9vYmoubmV4dCgpLmh0bWwodGV4dCkuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnPGxhYmVsIGlkPVwiJyArIG5hbWUgKyAnLWVycm9yXCIgZm9yPVwiJyArIG5hbWUgKyAnXCIgY2xhc3M9XCJpbnZhbGlkXCI+JyArIHRleHQgKyAnPC9sYWJlbD4nKS5pbnNlcnRBZnRlcihfb2JqKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgJCgnZm9ybVtuYW1lPVwic2VuZF9maW5kX3Bob25lXCJdIC5mYXRhbC1lcnJvcicpLmh0bWwoX3Jlcy5lcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZWxvYWRDYXB0Y2hhKCRmb3JtLmZpbmQoJy5ib3gtY2FwdGNoYSA+IGltZycpLCB0cnVlKTsgLy8gcmVsb2FkIGNhcHRjaGFcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoX3Jlcy5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgICQoJ2Zvcm1bbmFtZT1cInNlbmRfZmluZF9waG9uZVwiXSBzcGFuLmluZm8nKS5odG1sKF9yZXMuc3VjY2VzcykuY3NzKHsnZGlzcGxheSc6ICdpbmxpbmUtYmxvY2snfSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gc2Nyb2xsVG8gYmxvY2sgaW5mb1xuICAgICAgICAgICAgICAgICAgICB2YXIgdGFyZ2V0X3RvcCA9ICQoJ2Zvcm1bbmFtZT1cInNlbmRfZmluZF9waG9uZVwiXSBzcGFuLmluZm8nKS5vZmZzZXQoKS50b3A7XG4gICAgICAgICAgICAgICAgICAgICQoJ2h0bWwsIGJvZHknKS5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbFRvcDogTWF0aC5jZWlsKHRhcmdldF90b3ApIC8vIE1hdGguY2VpbCgodGFyZ2V0X3RvcCAqICQod2luZG93KS5vdXRlckhlaWdodCh0cnVlKSkgLyAkKCdodG1sLCBib2R5JykuaGVpZ2h0KCkpXG4gICAgICAgICAgICAgICAgICAgIH0sICdsaW5lYXInKTtcblxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyh0YXJnZXRfdG9wLCBNYXRoLmNlaWwoKHRhcmdldF90b3AgKiAkKHdpbmRvdykub3V0ZXJIZWlnaHQodHJ1ZSkpIC8gJCgnaHRtbCwgYm9keScpLmhlaWdodCgpKSk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gZ29vZ2xlIGFuYWxpdHljc1xuICAgICAgICAgICAgICAgICAgICBnYSgnc2VuZCcsICdldmVudCcsICdmb3JtJywgJ3N1Ym1pdCcsICdjb21wYXRpYmlsaXR5LXJlcXVlc3Qtc3VjY2VzcycpO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnZm9ybVtuYW1lPVwic2VuZF9maW5kX3Bob25lXCJdIC5mYXRhbC1lcnJvcicpLmh0bWwoJ1lvdXIgZW1haWwgd2FzIG5vdCBzZW50Jyk7XG4gICAgICAgICAgICAgICAgICAgIHJlbG9hZENhcHRjaGEoJGZvcm0uZmluZCgnLmJveC1jYXB0Y2hhID4gaW1nJyksIHRydWUpOyAvLyByZWxvYWQgY2FwdGNoYVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICQoJ2Zvcm1bbmFtZT1cInNlbmRfZmluZF9waG9uZVwiXSAuZmF0YWwtZXJyb3InKS5odG1sKCdZb3VyIGVtYWlsIHdhcyBub3Qgc2VudCcpO1xuICAgICAgICAgICAgICAgIHJlbG9hZENhcHRjaGEoJGZvcm0uZmluZCgnLmJveC1jYXB0Y2hhID4gaW1nJyksIHRydWUpOyAvLyByZWxvYWQgY2FwdGNoYVxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmVsb2FkQ2FwdGNoYSgkZm9ybS5maW5kKCcuYm94LWNhcHRjaGEgPiBpbWcnKSwgZmFsc2UpOyAvLyByZWxvYWQgY2FwdGNoYVxuICAgICAgICAgICAgJGZvcm0udHJpZ2dlcihcInJlc2V0XCIpO1xuXG4gICAgICAgICAgICAvLyByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIGNsZWFyIGluZm8gaW4gZm9jdXNcbiAgICAkKCdmb3JtW25hbWU9XCJzZW5kX2ZpbmRfcGhvbmVcIl0gaW5wdXQsIGZvcm1bbmFtZT1cInNlbmRfZmluZF9waG9uZVwiXSB0ZXh0YXJlYScpLmZvY3VzKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy9pZigkKCdmb3JtW25hbWU9XCJzZW5kX2ZpbmRfcGhvbmVcIl0gc3Bhbi5pbmZvJykubGVuZ3RoKVxuICAgICAgICAvLyAgICAkKCdmb3JtW25hbWU9XCJzZW5kX2ZpbmRfcGhvbmVcIl0gc3Bhbi5pbmZvJykuaHRtbCggXCIgXCIgKS5oaWRlKCk7XG4gICAgICAgIC8vaWYoJCgnZm9ybVtuYW1lPVwic2VuZF9maW5kX3Bob25lXCJdIC5mYXRhbC1lcnJvcicpLmxlbmd0aClcbiAgICAgICAgLy8gICAgJCgnZm9ybVtuYW1lPVwic2VuZF9maW5kX3Bob25lXCJdIC5mYXRhbC1lcnJvcicpLmh0bWwoIFwiIFwiICkuaGlkZSgpO1xuICAgICAgICAvL2lmKCQoJ2Zvcm1bbmFtZT1cInNlbmRfZmluZF9waG9uZVwiXSBsYWJlbC5lcnJvciwgZm9ybVtuYW1lPVwic2VuZF9maW5kX3Bob25lXCJdIGxhYmVsLmludmFsaWQnKS5sZW5ndGgpXG4gICAgICAgIC8vICAgICQoJ2Zvcm1bbmFtZT1cInNlbmRfZmluZF9waG9uZVwiXSBsYWJlbC5lcnJvciwgZm9ybVtuYW1lPVwic2VuZF9maW5kX3Bob25lXCJdIGxhYmVsLmludmFsaWQnKS5yZW1vdmUoKTtcbiAgICB9KTtcblxuICAgIC8vIGNvbXBhdGliaWxpdHlfZm9ybVxuICAgIHZhciB2YWxpZGF0b3Jfc2VuZF9tb2JpbGVfb3BlcmF0b3JzX2ZpbmRfcGhvbmUgPSAkKCdmb3JtW25hbWU9XCJzZW5kX21vYmlsZV9vcGVyYXRvcnNfZmluZF9waG9uZVwiXScpLnZhbGlkYXRlKHtcbiAgICAgICAgb25mb2N1c291dDogZmFsc2UsXG4gICAgICAgIG9ua2V5dXA6IGZhbHNlLFxuICAgICAgICBvbmNsaWNrOiB0cnVlLFxuICAgICAgICBvbnN1Ym1pdDogdHJ1ZSxcbiAgICAgICAgZm9jdXNJbnZhbGlkOiBmYWxzZSxcbiAgICAgICAgZm9jdXNDbGVhbnVwOiBmYWxzZSxcbiAgICAgICAgZGVidWc6IGZhbHNlLFxuICAgICAgICAnY2Fycmllcic6IHtcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgICdjYXB0Y2hhJzoge1xuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWVcbiAgICAgICAgfSxcbiAgICAgICAgZW1haWw6IHtcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgICAgZW1haWw6IHRydWVcbiAgICAgICAgfSxcbiAgICAgICAgbWVzc2FnZXM6IHtcbiAgICAgICAgICAgICdjYXB0Y2hhJzogXCJJbnZhbGlkIENBUFRDSEEuXCIsIC8vIFRoZSBDQVBUQ0hBIGZpZWxkIGlzIGVtcHR5LlxuICAgICAgICAgICAgbmFtZTogXCJUaGUgRGV2aWNlIE1vZGVsIGZpZWxkIGlzIGVtcHR5XCIsXG4gICAgICAgICAgICBlbWFpbDoge1xuICAgICAgICAgICAgICAgIHJlcXVpcmVkOiBcIlRoZSBFbWFpbCBmaWVsZCBpcyBlbXB0eVwiLFxuICAgICAgICAgICAgICAgIGVtYWlsOiBcIkludmFsaWQgZW1haWwgZm9ybWF0XCJcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3JDbGFzczogXCJpbnZhbGlkXCIsXG4gICAgICAgIHZhbGlkQ2xhc3M6IFwic3VjY2Vzc1wiLFxuICAgICAgICBpbnZhbGlkSGFuZGxlcjogZnVuY3Rpb24gKGV2ZW50LCB2YWxpZGF0b3IpIHtcbiAgICAgICAgICAgIGlmICgkKCdmb3JtW25hbWU9XCJzZW5kX21vYmlsZV9vcGVyYXRvcnNfZmluZF9waG9uZVwiXSBzcGFuLmluZm8nKS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgJCgnZm9ybVtuYW1lPVwic2VuZF9tb2JpbGVfb3BlcmF0b3JzX2ZpbmRfcGhvbmVcIl0gc3Bhbi5pbmZvJykuaHRtbChcIiBcIikuaGlkZSgpO1xuXG4gICAgICAgICAgICBpZiAoJCgnZm9ybVtuYW1lPVwic2VuZF9tb2JpbGVfb3BlcmF0b3JzX2ZpbmRfcGhvbmVcIl0gLmZhdGFsLWVycm9yJykubGVuZ3RoKVxuICAgICAgICAgICAgICAgICQoJ2Zvcm1bbmFtZT1cInNlbmRfbW9iaWxlX29wZXJhdG9yc19maW5kX3Bob25lXCJdIC5mYXRhbC1lcnJvcicpLmh0bWwoXCIgXCIpLmhpZGUoKTtcblxuICAgICAgICAgICAgaWYgKCQoJ2Zvcm1bbmFtZT1cInNlbmRfbW9iaWxlX29wZXJhdG9yc19maW5kX3Bob25lXCJdIGxhYmVsLmVycm9yLCBmb3JtW25hbWU9XCJzZW5kX21vYmlsZV9vcGVyYXRvcnNfZmluZF9waG9uZVwiXSBsYWJlbC5pbnZhbGlkJykubGVuZ3RoKVxuICAgICAgICAgICAgICAgICQoJ2Zvcm1bbmFtZT1cInNlbmRfbW9iaWxlX29wZXJhdG9yc19maW5kX3Bob25lXCJdIGxhYmVsLmVycm9yLCBmb3JtW25hbWU9XCJzZW5kX21vYmlsZV9vcGVyYXRvcnNfZmluZF9waG9uZVwiXSBsYWJlbC5pbnZhbGlkJykucmVtb3ZlKCk7XG4gICAgICAgIH0sXG4gICAgICAgIC8vINGD0L/RgNCw0LLQu9C10L3QuNC1INC+0YjQuNCx0LrQsNC80LhcbiAgICAgICAgc2hvd0Vycm9yczogZnVuY3Rpb24gKGVycm9yTWFwLCBlcnJvckxpc3QpIHtcbiAgICAgICAgICAgIHZhciBfZm9ybSA9ICQoJ2Zvcm1bbmFtZT1cInNlbmRfbW9iaWxlX29wZXJhdG9yc19maW5kX3Bob25lXCJdJyk7XG4gICAgICAgICAgICB2YXIgbXNnID0gbnVsbDtcblxuICAgICAgICAgICAgJC5lYWNoKGVycm9yTGlzdCwgZnVuY3Rpb24gKGtleSwgdmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUuZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IF9mb3JtLmZpbmQodmFsdWUuZWxlbWVudCkuYXR0cignbmFtZScpO1xuICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyggbmFtZSApO1xuICAgICAgICAgICAgICAgICAgICBfZm9ybS5maW5kKHZhbHVlLmVsZW1lbnQpLmFmdGVyKCc8bGFiZWwgaWQ9XCInICsgbmFtZSArICctZXJyb3JcIiBmb3I9XCInICsgbmFtZSArICdcIiBjbGFzcz1cImludmFsaWRcIj4nICsgdmFsdWUubWVzc2FnZSArICc8L2xhYmVsPicpO1xuICAgICAgICAgICAgICAgICAgICBfZm9ybS5maW5kKHZhbHVlLmVsZW1lbnQpLm5leHQoKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHN1Ym1pdEhhbmRsZXI6IGZ1bmN0aW9uIChmb3JtKSB7XG4gICAgICAgICAgICBpZiAoJCgnZm9ybVtuYW1lPVwic2VuZF9tb2JpbGVfb3BlcmF0b3JzX2ZpbmRfcGhvbmVcIl0gc3Bhbi5pbmZvJykubGVuZ3RoKVxuICAgICAgICAgICAgICAgICQoJ2Zvcm1bbmFtZT1cInNlbmRfbW9iaWxlX29wZXJhdG9yc19maW5kX3Bob25lXCJdIHNwYW4uaW5mbycpLmh0bWwoXCIgXCIpLmhpZGUoKTtcblxuICAgICAgICAgICAgaWYgKCQoJ2Zvcm1bbmFtZT1cInNlbmRfbW9iaWxlX29wZXJhdG9yc19maW5kX3Bob25lXCJdIC5mYXRhbC1lcnJvcicpLmxlbmd0aClcbiAgICAgICAgICAgICAgICAkKCdmb3JtW25hbWU9XCJzZW5kX21vYmlsZV9vcGVyYXRvcnNfZmluZF9waG9uZVwiXSAuZmF0YWwtZXJyb3InKS5odG1sKFwiIFwiKS5oaWRlKCk7XG5cbiAgICAgICAgICAgIGlmICgkKCdmb3JtW25hbWU9XCJzZW5kX21vYmlsZV9vcGVyYXRvcnNfZmluZF9waG9uZVwiXSBsYWJlbC5lcnJvciwgZm9ybVtuYW1lPVwic2VuZF9tb2JpbGVfb3BlcmF0b3JzX2ZpbmRfcGhvbmVcIl0gbGFiZWwuaW52YWxpZCcpLmxlbmd0aClcbiAgICAgICAgICAgICAgICAkKCdmb3JtW25hbWU9XCJzZW5kX21vYmlsZV9vcGVyYXRvcnNfZmluZF9waG9uZVwiXSBsYWJlbC5lcnJvciwgZm9ybVtuYW1lPVwic2VuZF9tb2JpbGVfb3BlcmF0b3JzX2ZpbmRfcGhvbmVcIl0gbGFiZWwuaW52YWxpZCcpLnJlbW92ZSgpO1xuXG4gICAgICAgICAgICB2YXIgJGZvcm0gPSAkKGZvcm0pO1xuICAgICAgICAgICAgdmFyIF9wYXJhbXMgPSBwYXJzZVF1ZXJ5KCRmb3JtLnNlcmlhbGl6ZUFycmF5KCkpO1xuXG4gICAgICAgICAgICB2YXIgX3Jlc3BvbnNlID0gZ2V0QWpheEZvcm0oJy9ncHMtd2lyZWxlc3MtdHJhY2tpbmctcGhvbmUuaHRtbCcsIF9wYXJhbXMpO1xuICAgICAgICAgICAgaWYgKF9yZXNwb25zZS5yZXN1bHQpIHtcbiAgICAgICAgICAgICAgICB2YXIgX3JlcyA9IF9yZXNwb25zZS5yZXN1bHQ7XG4gICAgICAgICAgICAgICAgaWYgKF9yZXMuZXJyb3IpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIF9yZXMuZXJyb3IgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2goX3Jlcy5lcnJvciwgZnVuY3Rpb24gKG5hbWUsIHRleHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgX29iaiA9ICRmb3JtLmZpbmQoJ2lucHV0W25hbWU9XCInICsgbmFtZSArICdcIl0nKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfb2JqLmxlbmd0aCkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfb2JqLm5leHQoJ2xhYmVsJykubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfb2JqLm5leHQoKS5odG1sKHRleHQpLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJzxsYWJlbCBpZD1cIicgKyBuYW1lICsgJy1lcnJvclwiIGZvcj1cIicgKyBuYW1lICsgJ1wiIGNsYXNzPVwiaW52YWxpZFwiPicgKyB0ZXh0ICsgJzwvbGFiZWw+JykuaW5zZXJ0QWZ0ZXIoX29iaik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJ2Zvcm1bbmFtZT1cInNlbmRfbW9iaWxlX29wZXJhdG9yc19maW5kX3Bob25lXCJdIC5mYXRhbC1lcnJvcicpLmh0bWwoX3Jlcy5lcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgICAgICAgICByZWxvYWRDYXB0Y2hhKCRmb3JtLmZpbmQoJy5ib3gtY2FwdGNoYSA+IGltZycpLCB0cnVlKTsgLy8gcmVsb2FkIGNhcHRjaGFcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoX3Jlcy5zdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgICQoJ2Zvcm1bbmFtZT1cInNlbmRfbW9iaWxlX29wZXJhdG9yc19maW5kX3Bob25lXCJdIHNwYW4uaW5mbycpLmh0bWwoX3Jlcy5zdWNjZXNzKS5jc3MoeydkaXNwbGF5JzogJ2lubGluZS1ibG9jayd9KTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBzY3JvbGxUbyBibG9jayBpbmZvXG4gICAgICAgICAgICAgICAgICAgIHZhciB0YXJnZXRfdG9wID0gJCgnZm9ybVtuYW1lPVwic2VuZF9tb2JpbGVfb3BlcmF0b3JzX2ZpbmRfcGhvbmVcIl0gc3Bhbi5pbmZvJykub2Zmc2V0KCkudG9wO1xuICAgICAgICAgICAgICAgICAgICAkKCdodG1sLCBib2R5JykuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxUb3A6IE1hdGguY2VpbCh0YXJnZXRfdG9wKSAvLyBNYXRoLmNlaWwoKHRhcmdldF90b3AgKiAkKHdpbmRvdykub3V0ZXJIZWlnaHQodHJ1ZSkpIC8gJCgnaHRtbCwgYm9keScpLmhlaWdodCgpKVxuICAgICAgICAgICAgICAgICAgICB9LCAnbGluZWFyJyk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coIHRhcmdldF90b3AsIE1hdGguY2VpbCgodGFyZ2V0X3RvcCAqICQod2luZG93KS5vdXRlckhlaWdodCh0cnVlKSkgLyAkKCdodG1sLCBib2R5JykuaGVpZ2h0KCkpICk7XG5cbiAgICAgICAgICAgICAgICAgICAgLy8gZ29vZ2xlIGFuYWxpdHljc1xuICAgICAgICAgICAgICAgICAgICBnYSgnc2VuZCcsICdldmVudCcsICdmb3JtJywgJ3N1Ym1pdCcsICdtb2JpbGUtb3BlcmF0b3JzLXJlcXVlc3Qtc3VjY2VzcycpO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnZm9ybVtuYW1lPVwic2VuZF9tb2JpbGVfb3BlcmF0b3JzX2ZpbmRfcGhvbmVcIl0gLmZhdGFsLWVycm9yJykuaHRtbCgnWW91ciBlbWFpbCB3YXMgbm90IHNlbnQnKTtcbiAgICAgICAgICAgICAgICAgICAgcmVsb2FkQ2FwdGNoYSgkZm9ybS5maW5kKCcuYm94LWNhcHRjaGEgPiBpbWcnKSwgdHJ1ZSk7IC8vIHJlbG9hZCBjYXB0Y2hhXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJCgnZm9ybVtuYW1lPVwic2VuZF9tb2JpbGVfb3BlcmF0b3JzX2ZpbmRfcGhvbmVcIl0gLmZhdGFsLWVycm9yJykuaHRtbCgnWW91ciBlbWFpbCB3YXMgbm90IHNlbnQnKTtcbiAgICAgICAgICAgICAgICByZWxvYWRDYXB0Y2hhKCRmb3JtLmZpbmQoJy5ib3gtY2FwdGNoYSA+IGltZycpLCB0cnVlKTsgLy8gcmVsb2FkIGNhcHRjaGFcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJlbG9hZENhcHRjaGEoJGZvcm0uZmluZCgnLmJveC1jYXB0Y2hhID4gaW1nJyksIGZhbHNlKTsgLy8gcmVsb2FkIGNhcHRjaGFcbiAgICAgICAgICAgICRmb3JtLnRyaWdnZXIoXCJyZXNldFwiKTtcblxuICAgICAgICAgICAgLy8gcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfSk7XG5cbiAgICAvLyBjbGVhciBpbmZvIGluIGZvY3VzXG4gICAgJCgnZm9ybVtuYW1lPVwic2VuZF9tb2JpbGVfb3BlcmF0b3JzX2ZpbmRfcGhvbmVcIl0gaW5wdXQsIGZvcm1bbmFtZT1cInNlbmRfbW9iaWxlX29wZXJhdG9yc19maW5kX3Bob25lXCJdIHRleHRhcmVhJykuZm9jdXMoZnVuY3Rpb24gKCkge1xuICAgICAgICAvL2lmKCQoJ2Zvcm1bbmFtZT1cInNlbmRfbW9iaWxlX29wZXJhdG9yc19maW5kX3Bob25lXCJdIHNwYW4uaW5mbycpLmxlbmd0aClcbiAgICAgICAgLy8gICAgJCgnZm9ybVtuYW1lPVwic2VuZF9tb2JpbGVfb3BlcmF0b3JzX2ZpbmRfcGhvbmVcIl0gc3Bhbi5pbmZvJykuaHRtbCggXCIgXCIgKS5oaWRlKCk7XG4gICAgICAgIC8vaWYoJCgnZm9ybVtuYW1lPVwic2VuZF9tb2JpbGVfb3BlcmF0b3JzX2ZpbmRfcGhvbmVcIl0gLmZhdGFsLWVycm9yJykubGVuZ3RoKVxuICAgICAgICAvLyAgICAkKCdmb3JtW25hbWU9XCJzZW5kX21vYmlsZV9vcGVyYXRvcnNfZmluZF9waG9uZVwiXSAuZmF0YWwtZXJyb3InKS5odG1sKCBcIiBcIiApLmhpZGUoKTtcbiAgICAgICAgLy9pZigkKCdmb3JtW25hbWU9XCJzZW5kX21vYmlsZV9vcGVyYXRvcnNfZmluZF9waG9uZVwiXSBsYWJlbC5lcnJvciwgZm9ybVtuYW1lPVwic2VuZF9tb2JpbGVfb3BlcmF0b3JzX2ZpbmRfcGhvbmVcIl0gbGFiZWwuaW52YWxpZCcpLmxlbmd0aClcbiAgICAgICAgLy8gICAgJCgnZm9ybVtuYW1lPVwic2VuZF9tb2JpbGVfb3BlcmF0b3JzX2ZpbmRfcGhvbmVcIl0gbGFiZWwuZXJyb3IsIGZvcm1bbmFtZT1cInNlbmRfbW9iaWxlX29wZXJhdG9yc19maW5kX3Bob25lXCJdIGxhYmVsLmludmFsaWQnKS5yZW1vdmUoKTtcbiAgICB9KTtcblxuXG4gICAgLy8gdmFsaWRhdG9yIGZhcSAoZm9ybS1mYXEtc2VuZClcbiAgICB2YXIgdmFsaWRhdG9yX2Zvcm1fZmFxID0gJCgnZm9ybS5mb3JtLWZhcS1zZW5kJykudmFsaWRhdGUoe1xuICAgICAgICBvbmZvY3Vzb3V0OiBmYWxzZSxcbiAgICAgICAgZm9jdXNJbnZhbGlkOiBmYWxzZSxcbiAgICAgICAgJ25hbWUnOiB7XG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICAncXVlc3Rpb24nOiB7XG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICBlbWFpbDoge1xuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgICAgICBlbWFpbDogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICBtZXNzYWdlczoge1xuICAgICAgICAgICAgbmFtZTogXCJUaGUgTmFtZSBmaWVsZCBpcyBlbXB0eVwiLFxuICAgICAgICAgICAgcXVlc3Rpb246ICdUaGUgUXVlc3Rpb24gZmllbGQgaXMgZW1wdHknLFxuICAgICAgICAgICAgZW1haWw6IHtcbiAgICAgICAgICAgICAgICByZXF1aXJlZDogXCJUaGUgRW1haWwgZmllbGQgaXMgZW1wdHlcIixcbiAgICAgICAgICAgICAgICBlbWFpbDogXCJJbnZhbGlkIGVtYWlsIGZvcm1hdFwiXG4gICAgICAgICAgICB9LFxuICAgICAgICB9LFxuICAgICAgICBlcnJvckNsYXNzOiBcImludmFsaWRcIixcbiAgICAgICAgdmFsaWRDbGFzczogXCJzdWNjZXNzXCIsXG4gICAgICAgIGludmFsaWRIYW5kbGVyOiBmdW5jdGlvbiAoZXZlbnQsIHZhbGlkYXRvcikge1xuICAgICAgICAgICAgaWYgKCQoJ2Zvcm0uZm9ybS1mYXEtc2VuZCBzcGFuLmluZm8nKS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgJCgnZm9ybS5mb3JtLWZhcS1zZW5kIHNwYW4uaW5mbycpLmh0bWwoXCIgXCIpLmhpZGUoKTtcblxuICAgICAgICAgICAgaWYgKCQoJ2Zvcm0uZm9ybS1mYXEtc2VuZCAuZmF0YWwtZXJyb3InKS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgJCgnZm9ybS5mb3JtLWZhcS1zZW5kIC5mYXRhbC1lcnJvcicpLmh0bWwoXCIgXCIpLmhpZGUoKTtcbiAgICAgICAgfSxcbiAgICAgICAgc3VibWl0SGFuZGxlcjogZnVuY3Rpb24gKGZvcm0pIHtcbiAgICAgICAgICAgIGlmICgkKCdmb3JtLmZvcm0tZmFxLXNlbmQgc3Bhbi5pbmZvJykubGVuZ3RoKVxuICAgICAgICAgICAgICAgICQoJ2Zvcm0uZm9ybS1mYXEtc2VuZCBzcGFuLmluZm8nKS5odG1sKFwiIFwiKS5oaWRlKCk7XG5cbiAgICAgICAgICAgIGlmICgkKCdmb3JtLmZvcm0tZmFxLXNlbmQgLmZhdGFsLWVycm9yJykubGVuZ3RoKVxuICAgICAgICAgICAgICAgICQoJ2Zvcm0uZm9ybS1mYXEtc2VuZCAuZmF0YWwtZXJyb3InKS5odG1sKFwiIFwiKS5oaWRlKCk7XG5cbiAgICAgICAgICAgIHZhciAkZm9ybSA9ICQoZm9ybSk7XG4gICAgICAgICAgICB2YXIgX3BhcmFtcyA9IHBhcnNlUXVlcnkoJGZvcm0uc2VyaWFsaXplQXJyYXkoKSk7XG5cbiAgICAgICAgICAgIHZhciBfcmVzcG9uc2UgPSBnZXRBamF4Rm9ybSgnL2ZhcV9zZW5kLmh0bWwnLCBfcGFyYW1zKTtcbiAgICAgICAgICAgIGlmIChfcmVzcG9uc2UucmVzdWx0KSB7XG4gICAgICAgICAgICAgICAgdmFyIF9yZXMgPSBfcmVzcG9uc2UucmVzdWx0O1xuICAgICAgICAgICAgICAgIGlmIChfcmVzLmVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgX3Jlcy5lcnJvciA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQuZWFjaChfcmVzLmVycm9yLCBmdW5jdGlvbiAobmFtZSwgdGV4dCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfb2JqID0gJGZvcm0uZmluZCgnaW5wdXRbbmFtZT1cIicgKyBuYW1lICsgJ1wiXScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfb2JqLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoX29iai5uZXh0KCdsYWJlbCcpLmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9vYmoubmV4dCgpLmh0bWwodGV4dCkuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCc8bGFiZWwgaWQ9XCInICsgbmFtZSArICctZXJyb3JcIiBmb3I9XCInICsgbmFtZSArICdcIiBjbGFzcz1cImludmFsaWRcIj4nICsgdGV4dCArICc8L2xhYmVsPicpLmluc2VydEFmdGVyKF9vYmopO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgJCgnZm9ybS5mb3JtLWZhcS1zZW5kIC5mYXRhbC1lcnJvcicpLmh0bWwoX3Jlcy5lcnJvcik7XG4gICAgICAgICAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKF9yZXMuc3VjY2Vzcykge1xuICAgICAgICAgICAgICAgICAgICAkKCdmb3JtLmZvcm0tZmFxLXNlbmQgc3Bhbi5pbmZvJykuaHRtbChfcmVzLnN1Y2Nlc3MpLmNzcyh7J2Rpc3BsYXknOiAnaW5saW5lLWJsb2NrJ30pO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGdvb2dsZSBhbmFsaXR5Y3NcbiAgICAgICAgICAgICAgICAgICAgZ2EoJ3NlbmQnLCAnZXZlbnQnLCAnZm9ybScsICdzdWJtaXQnLCAnZmFxLXJlcXVlc3Qtc3VjY2VzcycpO1xuXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnZm9ybS5mb3JtLWZhcS1zZW5kIC5mYXRhbC1lcnJvcicpLmh0bWwoJ1lvdXIgZW1haWwgd2FzIG5vdCBzZW50Jyk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdTeXN0ZW0gZXJyb3IhJyk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJCgnZm9ybS5mb3JtLWZhcS1zZW5kIC5mYXRhbC1lcnJvcicpLmh0bWwoJ1lvdXIgZW1haWwgd2FzIG5vdCBzZW50Jyk7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ0NhbiBub3QgZ2V0IHBhcmFtcyBpbiBhamF4IScpO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuXG4gICAgICAgICAgICAkZm9ybS50cmlnZ2VyKFwicmVzZXRcIik7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIGNsZWFyIGluZm8gaW4gZm9jdXNcbiAgICAkKCdmb3JtLmZvcm0tZmFxLXNlbmQgaW5wdXQsIGZvcm0uZm9ybS1mYXEtc2VuZCB0ZXh0YXJlYScpLmZvY3VzKGZ1bmN0aW9uICgpIHtcbi8vICAgICAgICBpZigkKCdmb3JtLmZvcm0tZmFxLXNlbmQgc3Bhbi5pbmZvJykubGVuZ3RoKVxuLy8gICAgICAgICAgICAkKCdmb3JtLmZvcm0tZmFxLXNlbmQgc3Bhbi5pbmZvJykuaHRtbCggXCIgXCIgKS5oaWRlKCk7XG4vLyAgICAgICAgaWYoJCgnZm9ybS5mb3JtLWZhcS1zZW5kIC5mYXRhbC1lcnJvcicpLmxlbmd0aClcbi8vICAgICAgICAgICAgJCgnZm9ybS5mb3JtLWZhcS1zZW5kIC5mYXRhbC1lcnJvcicpLmh0bWwoIFwiIFwiICkuaGlkZSgpO1xuLy8gICAgICAgIGlmKCQoJ2Zvcm0uZm9ybS1mYXEtc2VuZCBsYWJlbC5lcnJvciwgZm9ybS5mb3JtLWZhcS1zZW5kIGxhYmVsLmludmFsaWQnKS5sZW5ndGgpXG4vLyAgICAgICAgICAgICQoJ2Zvcm0uZm9ybS1mYXEtc2VuZCBsYWJlbC5lcnJvciwgZm9ybS5mb3JtLWZhcS1zZW5kIGxhYmVsLmludmFsaWQnKS5yZW1vdmUoKTtcbiAgICB9KTtcblxuXG5cbiAgICAvKiB2YWxpZGF0ZSBjb250YWN0IHVzICovXG4gICAgJCgnZm9ybS5mb3JtLWNvbnRhY3QtdXMgc2VsZWN0JylcbiAgICAgICAgICAgIC5jaGFuZ2UoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBfc2VsZWN0ZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgICAkKCdmb3JtLmZvcm0tY29udGFjdC11cyAjd29zJykudmFsKCcnKTtcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmZpbmQoXCJvcHRpb246c2VsZWN0ZWRcIikuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIF9zZWxlY3RlZCA9ICQodGhpcykudmFsKCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoX3NlbGVjdGVkICYmIF9zZWxlY3RlZCAhPSAnMCcpIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnZm9ybS5mb3JtLWNvbnRhY3QtdXMgI3dvcycpLnZhbChfc2VsZWN0ZWQpLnZhbGlkKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIC8vICQodGhpcykuc2VsZWN0cGlja2VyKCdoaWRlJyk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNoYW5nZSgpO1xuXG5cbiAgICB2YXIgdmFsaWRhdG9yX2NvbnRhY3RfdXMgPSAkKCdmb3JtLmZvcm0tY29udGFjdC11cycpLnZhbGlkYXRlKHtcbiAgICAgICAgb25mb2N1c291dDogZmFsc2UsXG4gICAgICAgIG9ua2V5dXA6IGZhbHNlLFxuICAgICAgICBvbmNsaWNrOiB0cnVlLFxuICAgICAgICBvbnN1Ym1pdDogdHJ1ZSxcbiAgICAgICAgZm9jdXNJbnZhbGlkOiBmYWxzZSxcbiAgICAgICAgZm9jdXNDbGVhbnVwOiBmYWxzZSxcbiAgICAgICAgZGVidWc6IGZhbHNlLFxuICAgICAgICBpZ25vcmU6IFwibm90OmhpZGRlblwiLFxuICAgICAgICAnbmFtZSc6IHtcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgICdkZXNjcmlwdGlvbic6IHtcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIHdvczoge1xuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWVcbiAgICAgICAgfSxcbiAgICAgICAgZW1haWw6IHtcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgICAgZW1haWw6IHRydWVcbiAgICAgICAgfSxcbiAgICAgICAgJ2NhcHRjaGEnOiB7XG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgfSxcbiAgICAgICAgbWVzc2FnZXM6IHtcbiAgICAgICAgICAgICdjYXB0Y2hhJzogXCJJbnZhbGlkIENBUFRDSEEuXCIsIC8vIFRoZSBDQVBUQ0hBIGZpZWxkIGlzIGVtcHR5LlxuICAgICAgICAgICAgbmFtZTogXCJUaGUgTmFtZSBmaWVsZCBpcyBlbXB0eVwiLFxuICAgICAgICAgICAgZGVzY3JpcHRpb246ICdUaGUgUXVlc3Rpb24gZmllbGQgaXMgZW1wdHknLFxuICAgICAgICAgICAgd29zOiAnVGhlIGZpZWxkIENob29zZSB5b3VyIE9TIGlzIGVtcHR5JyxcbiAgICAgICAgICAgIGVtYWlsOiB7XG4gICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFwiVGhlIEVtYWlsIGZpZWxkIGlzIGVtcHR5XCIsXG4gICAgICAgICAgICAgICAgZW1haWw6IFwiSW52YWxpZCBlbWFpbCBmb3JtYXRcIlxuICAgICAgICAgICAgfSxcbiAgICAgICAgfSxcbiAgICAgICAgZXJyb3JDbGFzczogXCJpbnZhbGlkXCIsXG4gICAgICAgIHZhbGlkQ2xhc3M6IFwic3VjY2Vzc1wiLFxuICAgICAgICBpbnZhbGlkSGFuZGxlcjogZnVuY3Rpb24gKGV2ZW50LCB2YWxpZGF0b3IpIHtcbiAgICAgICAgICAgIGlmICgkKCdmb3JtLmZvcm0tY29udGFjdC11cyBzcGFuLmluZm8nKS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgJCgnZm9ybS5mb3JtLWNvbnRhY3QtdXMgc3Bhbi5pbmZvJykuaHRtbChcIiBcIikuaGlkZSgpO1xuXG4gICAgICAgICAgICBpZiAoJCgnZm9ybS5mb3JtLWNvbnRhY3QtdXMgLmZhdGFsLWVycm9yJykubGVuZ3RoKVxuICAgICAgICAgICAgICAgICQoJ2Zvcm0uZm9ybS1jb250YWN0LXVzIC5mYXRhbC1lcnJvcicpLmh0bWwoXCIgXCIpLmhpZGUoKTtcblxuICAgICAgICAgICAgaWYgKCQoJ2Zvcm0uZm9ybS1jb250YWN0LXVzIGxhYmVsLmVycm9yLCBmb3JtLmZvcm0tY29udGFjdC11cyBsYWJlbC5pbnZhbGlkJykubGVuZ3RoKVxuICAgICAgICAgICAgICAgICQoJ2Zvcm0uZm9ybS1jb250YWN0LXVzIGxhYmVsLmVycm9yLCBmb3JtLmZvcm0tY29udGFjdC11cyBsYWJlbC5pbnZhbGlkJykucmVtb3ZlKCk7XG4gICAgICAgIH0sXG4gICAgICAgIC8vINGD0L/RgNCw0LLQu9C10L3QuNC1INC+0YjQuNCx0LrQsNC80LhcbiAgICAgICAgc2hvd0Vycm9yczogZnVuY3Rpb24gKGVycm9yTWFwLCBlcnJvckxpc3QpIHtcbiAgICAgICAgICAgIHZhciBfZm9ybSA9ICQoJ2Zvcm0uZm9ybS1jb250YWN0LXVzJyk7XG4gICAgICAgICAgICB2YXIgbXNnID0gbnVsbDtcblxuICAgICAgICAgICAgJC5lYWNoKGVycm9yTGlzdCwgZnVuY3Rpb24gKGtleSwgdmFsdWUpIHtcbiAgICAgICAgICAgICAgICBpZiAodmFsdWUuZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICB2YXIgbmFtZSA9IF9mb3JtLmZpbmQodmFsdWUuZWxlbWVudCkuYXR0cignbmFtZScpO1xuICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyggbmFtZSApO1xuICAgICAgICAgICAgICAgICAgICBfZm9ybS5maW5kKHZhbHVlLmVsZW1lbnQpLmFmdGVyKCc8bGFiZWwgaWQ9XCInICsgbmFtZSArICctZXJyb3JcIiBmb3I9XCInICsgbmFtZSArICdcIiBjbGFzcz1cImludmFsaWRcIj4nICsgdmFsdWUubWVzc2FnZSArICc8L2xhYmVsPicpO1xuICAgICAgICAgICAgICAgICAgICBfZm9ybS5maW5kKHZhbHVlLmVsZW1lbnQpLm5leHQoKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0sXG4gICAgICAgIHN1Ym1pdEhhbmRsZXI6IGZ1bmN0aW9uIChmb3JtKSB7XG4gICAgICAgICAgICBpZiAoJCgnZm9ybS5mb3JtLWNvbnRhY3QtdXMgc3Bhbi5pbmZvJykubGVuZ3RoKVxuICAgICAgICAgICAgICAgICQoJ2Zvcm0uZm9ybS1jb250YWN0LXVzIHNwYW4uaW5mbycpLmh0bWwoXCIgXCIpLmhpZGUoKTtcblxuICAgICAgICAgICAgaWYgKCQoJ2Zvcm0uZm9ybS1jb250YWN0LXVzIC5mYXRhbC1lcnJvcicpLmxlbmd0aClcbiAgICAgICAgICAgICAgICAkKCdmb3JtLmZvcm0tY29udGFjdC11cyAuZmF0YWwtZXJyb3InKS5odG1sKFwiIFwiKS5oaWRlKCk7XG5cbiAgICAgICAgICAgIGlmICgkKCdmb3JtLmZvcm0tY29udGFjdC11cyBsYWJlbC5lcnJvciwgZm9ybS5mb3JtLWNvbnRhY3QtdXMgbGFiZWwuaW52YWxpZCcpLmxlbmd0aClcbiAgICAgICAgICAgICAgICAkKCdmb3JtLmZvcm0tY29udGFjdC11cyBsYWJlbC5lcnJvciwgZm9ybS5mb3JtLWNvbnRhY3QtdXMgbGFiZWwuaW52YWxpZCcpLnJlbW92ZSgpO1xuXG4gICAgICAgICAgICB2YXIgJGZvcm0gPSAkKGZvcm0pO1xuICAgICAgICAgICAgdmFyIF9wYXJhbXMgPSBwYXJzZVF1ZXJ5KCRmb3JtLnNlcmlhbGl6ZUFycmF5KCkpO1xuXG5cbiAgICAgICAgICAgIHZhciBfcmVzcG9uc2UgPSBnZXRBamF4Rm9ybSgnL2NvbnRhY3RfdXNfc2VuZC5odG1sJywgX3BhcmFtcyk7XG4gICAgICAgICAgICBpZiAoX3Jlc3BvbnNlLnJlc3VsdCkge1xuXG4gICAgICAgICAgICAgICAgdmFyIF9yZXMgPSBfcmVzcG9uc2UucmVzdWx0O1xuICAgICAgICAgICAgICAgIGlmIChfcmVzLmVycm9yKSB7XG5cbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBfcmVzLmVycm9yID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKF9yZXMuZXJyb3IsIGZ1bmN0aW9uIChuYW1lLCB0ZXh0KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIF9vYmogPSAkZm9ybS5maW5kKCdpbnB1dFtuYW1lPVwiJyArIG5hbWUgKyAnXCJdJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9vYmoubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfb2JqLm5leHQoJ2xhYmVsJykubGVuZ3RoKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX29iai5uZXh0KCkuaHRtbCh0ZXh0KS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2VcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJzxsYWJlbCBpZD1cIicgKyBuYW1lICsgJy1lcnJvclwiIGZvcj1cIicgKyBuYW1lICsgJ1wiIGNsYXNzPVwiaW52YWxpZFwiPicgKyB0ZXh0ICsgJzwvbGFiZWw+JykuaW5zZXJ0QWZ0ZXIoX29iaik7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCdmb3JtLmZvcm0tY29udGFjdC11cyAuZmF0YWwtZXJyb3InKS5odG1sKF9yZXMuZXJyb3IpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgcmVsb2FkQ2FwdGNoYSgkZm9ybS5maW5kKCcuYm94LWNhcHRjaGEgPiBpbWcnKSwgdHJ1ZSk7IC8vIHJlbG9hZCBjYXB0Y2hhXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKF9yZXMuc3VjY2Vzcykge1xuXG4gICAgICAgICAgICAgICAgICAgICQoJ2Zvcm0uZm9ybS1jb250YWN0LXVzIHNwYW4uaW5mbycpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmh0bWwoX3Jlcy5zdWNjZXNzKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jc3MoeydkaXNwbGF5JzogJ2lubGluZS1ibG9jayd9KTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBzY3JvbGxUbyBibG9jayBpbmZvXG4gICAgICAgICAgICAgICAgICAgIHZhciB0YXJnZXRfdG9wID0gJCgnZm9ybS5mb3JtLWNvbnRhY3QtdXMgc3Bhbi5pbmZvJykub2Zmc2V0KCkudG9wO1xuICAgICAgICAgICAgICAgICAgICAkKCdodG1sLCBib2R5JykuYW5pbWF0ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgICBzY3JvbGxUb3A6IE1hdGguY2VpbCgodGFyZ2V0X3RvcCAqICQod2luZG93KS5vdXRlckhlaWdodCh0cnVlKSkgLyAkKCdodG1sLCBib2R5JykuaGVpZ2h0KCkpXG4gICAgICAgICAgICAgICAgICAgIH0sICdsaW5lYXInKTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBnb29nbGUgYW5hbGl0eWNzXG4gICAgICAgICAgICAgICAgICAgIGdhKCdzZW5kJywgJ2V2ZW50JywgJ2Zvcm0nLCAnc3VibWl0JywgJ2NvbnRhY3QtcmVxdWVzdC1zdWNjZXNzJyk7XG5cbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkKCdmb3JtLmZvcm0tY29udGFjdC11cyAuZmF0YWwtZXJyb3InKS5odG1sKCdZb3VyIGVtYWlsIHdhcyBub3Qgc2VudCcpO1xuICAgICAgICAgICAgICAgICAgICByZWxvYWRDYXB0Y2hhKCRmb3JtLmZpbmQoJy5ib3gtY2FwdGNoYSA+IGltZycpLCB0cnVlKTsgLy8gcmVsb2FkIGNhcHRjaGFcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKCdmb3JtLmZvcm0tY29udGFjdC11cyAuZmF0YWwtZXJyb3InKS5odG1sKCdZb3VyIGVtYWlsIHdhcyBub3Qgc2VudCcpO1xuICAgICAgICAgICAgICAgIHJlbG9hZENhcHRjaGEoJGZvcm0uZmluZCgnLmJveC1jYXB0Y2hhID4gaW1nJyksIHRydWUpOyAvLyByZWxvYWQgY2FwdGNoYVxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmVsb2FkQ2FwdGNoYSgkZm9ybS5maW5kKCcuYm94LWNhcHRjaGEgPiBpbWcnKSk7IC8vIHJlbG9hZCBjYXB0Y2hhXG4gICAgICAgICAgICAkZm9ybS50cmlnZ2VyKFwicmVzZXRcIik7XG4gICAgICAgIH1cbiAgICB9KTtcblxuLy8gICAgJCgnZm9ybS5mb3JtLWNvbnRhY3QtdXNcIl0nKS5vbignc3VibWl0JywgZnVuY3Rpb24oKSB7XG4vLyAgICAgICBhbGVydCgnb2shJyk7XG4vLyAgICAgICAgcmV0dXJuIGZhbHNlO1xuLy8gICAgfSk7XG5cbiAgICAkKCdmb3JtLmZvcm0tY29udGFjdC11cyBpbnB1dCwgZm9ybS5mb3JtLWNvbnRhY3QtdXMgdGV4dGFyZWEnKS5mb2N1cyhmdW5jdGlvbiAoKSB7XG4vLyAgICAgICAgaWYoJCgnZm9ybS5mb3JtLWNvbnRhY3QtdXMgc3Bhbi5pbmZvJykubGVuZ3RoKVxuLy8gICAgICAgICAgICAkKCdmb3JtLmZvcm0tY29udGFjdC11cyBzcGFuLmluZm8nKS5odG1sKCBcIiBcIiApLmhpZGUoKTtcbi8vICAgICAgICBpZigkKCdmb3JtLmZvcm0tY29udGFjdC11cyAuZmF0YWwtZXJyb3InKS5sZW5ndGgpXG4vLyAgICAgICAgICAgICQoJ2Zvcm0uZm9ybS1jb250YWN0LXVzIC5mYXRhbC1lcnJvcicpLmh0bWwoIFwiIFwiICkuaGlkZSgpO1xuLy8gICAgICAgIGlmKCQoJ2Zvcm0uZm9ybS1jb250YWN0LXVzIGxhYmVsLmVycm9yLCBmb3JtLmZvcm0tY29udGFjdC11cyBsYWJlbC5pbnZhbGlkJykubGVuZ3RoKVxuLy8gICAgICAgICAgICAkKCdmb3JtLmZvcm0tY29udGFjdC11cyBsYWJlbC5lcnJvciwgZm9ybS5mb3JtLWNvbnRhY3QtdXMgbGFiZWwuaW52YWxpZCcpLnJlbW92ZSgpO1xuICAgIH0pO1xuXG4gICAgLyogdmFsaWRhdGUgZmFxIGZvcm0gKi9cbiAgICAkKCdmb3JtLmZvcm0tZmFxIHNlbGVjdCcpXG4gICAgICAgICAgICAuY2hhbmdlKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB2YXIgX3NlbGVjdGVkID0gZmFsc2U7XG4gICAgICAgICAgICAgICAgJCgnZm9ybS5mb3JtLWZhcSAjd29zJykudmFsKCcnKTtcbiAgICAgICAgICAgICAgICAkKHRoaXMpLmZpbmQoXCJvcHRpb246c2VsZWN0ZWRcIikuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIF9zZWxlY3RlZCA9ICQodGhpcykudmFsKCk7XG4gICAgICAgICAgICAgICAgfSk7XG5cbiAgICAgICAgICAgICAgICBpZiAoX3NlbGVjdGVkICYmIF9zZWxlY3RlZCAhPSAnMCcpIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnZm9ybS5mb3JtLWZhcSAjd29zJykudmFsKF9zZWxlY3RlZCkudmFsaWQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgLy8gJCh0aGlzKS5zZWxlY3RwaWNrZXIoJ2hpZGUnKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2hhbmdlKCk7XG5cblxuICAgIHZhciB2YWxpZGF0b3JfY29udGFjdF91cyA9ICQoJ2Zvcm0uZm9ybS1mYXEnKS52YWxpZGF0ZSh7XG4gICAgICAgIG9uZm9jdXNvdXQ6IGZhbHNlLFxuICAgICAgICBvbmtleXVwOiBmYWxzZSxcbiAgICAgICAgb25jbGljazogdHJ1ZSxcbiAgICAgICAgb25zdWJtaXQ6IHRydWUsXG4gICAgICAgIGZvY3VzSW52YWxpZDogZmFsc2UsXG4gICAgICAgIGZvY3VzQ2xlYW51cDogZmFsc2UsXG4gICAgICAgIGRlYnVnOiBmYWxzZSxcbiAgICAgICAgaWdub3JlOiBcIm5vdDpoaWRkZW5cIixcbiAgICAgICAgJ25hbWUnOiB7XG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICAnZGVzY3JpcHRpb24nOiB7XG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZVxuICAgICAgICB9LFxuICAgICAgICB3b3M6IHtcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIGVtYWlsOiB7XG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICAgIGVtYWlsOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgICdjYXB0Y2hhJzoge1xuICAgICAgICAgICAgcmVxdWlyZWQ6IHRydWUsXG4gICAgICAgIH0sXG4gICAgICAgIG1lc3NhZ2VzOiB7XG4gICAgICAgICAgICAnY2FwdGNoYSc6IFwiSW52YWxpZCBDQVBUQ0hBLlwiLCAvLyBUaGUgQ0FQVENIQSBmaWVsZCBpcyBlbXB0eS5cbiAgICAgICAgICAgIG5hbWU6IFwiVGhlIE5hbWUgZmllbGQgaXMgZW1wdHlcIixcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiAnVGhlIFF1ZXN0aW9uIGZpZWxkIGlzIGVtcHR5JyxcbiAgICAgICAgICAgIHdvczogJ1RoZSBmaWVsZCBDaG9vc2UgeW91ciBPUyBpcyBlbXB0eScsXG4gICAgICAgICAgICBlbWFpbDoge1xuICAgICAgICAgICAgICAgIHJlcXVpcmVkOiBcIlRoZSBFbWFpbCBmaWVsZCBpcyBlbXB0eVwiLFxuICAgICAgICAgICAgICAgIGVtYWlsOiBcIkludmFsaWQgZW1haWwgZm9ybWF0XCJcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0sXG4gICAgICAgIGVycm9yQ2xhc3M6IFwiaW52YWxpZFwiLFxuICAgICAgICB2YWxpZENsYXNzOiBcInN1Y2Nlc3NcIixcbiAgICAgICAgaW52YWxpZEhhbmRsZXI6IGZ1bmN0aW9uIChldmVudCwgdmFsaWRhdG9yKSB7XG4gICAgICAgICAgICBpZiAoJCgnZm9ybS5mb3JtLWZhcSBzcGFuLmluZm8nKS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgJCgnZm9ybS5mb3JtLWZhcSBzcGFuLmluZm8nKS5odG1sKFwiIFwiKS5oaWRlKCk7XG5cbiAgICAgICAgICAgIGlmICgkKCdmb3JtLmZvcm0tZmFxIC5mYXRhbC1lcnJvcicpLmxlbmd0aClcbiAgICAgICAgICAgICAgICAkKCdmb3JtLmZvcm0tZmFxIC5mYXRhbC1lcnJvcicpLmh0bWwoXCIgXCIpLmhpZGUoKTtcblxuICAgICAgICAgICAgaWYgKCQoJ2Zvcm0uZm9ybS1mYXEgbGFiZWwuZXJyb3IsIGZvcm0uZm9ybS1mYXEgbGFiZWwuaW52YWxpZCcpLmxlbmd0aClcbiAgICAgICAgICAgICAgICAkKCdmb3JtLmZvcm0tZmFxIGxhYmVsLmVycm9yLCBmb3JtLmZvcm0tZmFxIGxhYmVsLmludmFsaWQnKS5yZW1vdmUoKTtcbiAgICAgICAgfSxcbiAgICAgICAgLy8g0YPQv9GA0LDQstC70LXQvdC40LUg0L7RiNC40LHQutCw0LzQuFxuICAgICAgICBzaG93RXJyb3JzOiBmdW5jdGlvbiAoZXJyb3JNYXAsIGVycm9yTGlzdCkge1xuICAgICAgICAgICAgdmFyIF9mb3JtID0gJCgnZm9ybS5mb3JtLWZhcScpO1xuICAgICAgICAgICAgdmFyIG1zZyA9IG51bGw7XG5cbiAgICAgICAgICAgICQuZWFjaChlcnJvckxpc3QsIGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHZhbHVlLmVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5hbWUgPSBfZm9ybS5maW5kKHZhbHVlLmVsZW1lbnQpLmF0dHIoJ25hbWUnKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coIG5hbWUgKTtcbiAgICAgICAgICAgICAgICAgICAgX2Zvcm0uZmluZCh2YWx1ZS5lbGVtZW50KS5hZnRlcignPGxhYmVsIGlkPVwiJyArIG5hbWUgKyAnLWVycm9yXCIgZm9yPVwiJyArIG5hbWUgKyAnXCIgY2xhc3M9XCJpbnZhbGlkXCI+JyArIHZhbHVlLm1lc3NhZ2UgKyAnPC9sYWJlbD4nKTtcbiAgICAgICAgICAgICAgICAgICAgX2Zvcm0uZmluZCh2YWx1ZS5lbGVtZW50KS5uZXh0KCkuc2hvdygpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9LFxuICAgICAgICBzdWJtaXRIYW5kbGVyOiBmdW5jdGlvbiAoZm9ybSkge1xuICAgICAgICAgICAgaWYgKCQoJ2Zvcm0uZm9ybS1mYXEgc3Bhbi5pbmZvJykubGVuZ3RoKVxuICAgICAgICAgICAgICAgICQoJ2Zvcm0uZm9ybS1mYXEgc3Bhbi5pbmZvJykuaHRtbChcIiBcIikuaGlkZSgpO1xuXG4gICAgICAgICAgICBpZiAoJCgnZm9ybS5mb3JtLWZhcSAuZmF0YWwtZXJyb3InKS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgJCgnZm9ybS5mb3JtLWZhcSAuZmF0YWwtZXJyb3InKS5odG1sKFwiIFwiKS5oaWRlKCk7XG5cbiAgICAgICAgICAgIGlmICgkKCdmb3JtLmZvcm0tZmFxIGxhYmVsLmVycm9yLCBmb3JtLmZvcm0tZmFxIGxhYmVsLmludmFsaWQnKS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgJCgnZm9ybS5mb3JtLWZhcSBsYWJlbC5lcnJvciwgZm9ybS5mb3JtLWZhcSBsYWJlbC5pbnZhbGlkJykucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgIHZhciAkZm9ybSA9ICQoZm9ybSk7XG4gICAgICAgICAgICB2YXIgX3BhcmFtcyA9IHBhcnNlUXVlcnkoJGZvcm0uc2VyaWFsaXplQXJyYXkoKSk7XG5cblxuICAgICAgICAgICAgdmFyIF9yZXNwb25zZSA9IGdldEFqYXhGb3JtKCcvZmFxLmh0bWwnLCBfcGFyYW1zKTtcbiAgICAgICAgICAgIGlmIChfcmVzcG9uc2UucmVzdWx0KSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgX3JlcyA9IF9yZXNwb25zZS5yZXN1bHQ7XG4gICAgICAgICAgICAgICAgaWYgKF9yZXMuZXJyb3IpIHtcblxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZW9mIF9yZXMuZXJyb3IgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkLmVhY2goX3Jlcy5lcnJvciwgZnVuY3Rpb24gKG5hbWUsIHRleHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgX29iaiA9ICRmb3JtLmZpbmQoJ2lucHV0W25hbWU9XCInICsgbmFtZSArICdcIl0nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoX29iai5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKF9vYmoubmV4dCgnbGFiZWwnKS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfb2JqLm5leHQoKS5odG1sKHRleHQpLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnPGxhYmVsIGlkPVwiJyArIG5hbWUgKyAnLWVycm9yXCIgZm9yPVwiJyArIG5hbWUgKyAnXCIgY2xhc3M9XCJpbnZhbGlkXCI+JyArIHRleHQgKyAnPC9sYWJlbD4nKS5pbnNlcnRBZnRlcihfb2JqKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJ2Zvcm0uZm9ybS1mYXEgLmZhdGFsLWVycm9yJykuaHRtbChfcmVzLmVycm9yKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIHJlbG9hZENhcHRjaGEoJGZvcm0uZmluZCgnLmJveC1jYXB0Y2hhID4gaW1nJyksIHRydWUpOyAvLyByZWxvYWQgY2FwdGNoYVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfSBlbHNlIGlmIChfcmVzLnN1Y2Nlc3MpIHtcblxuICAgICAgICAgICAgICAgICAgICAkKCdmb3JtLmZvcm0tZmFxIHNwYW4uaW5mbycpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmh0bWwoX3Jlcy5zdWNjZXNzKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5jc3MoeydkaXNwbGF5JzogJ2lubGluZS1ibG9jayd9KTtcblxuICAgICAgICAgICAgICAgICAgICAvLyBzY3JvbGxUbyBibG9jayBpbmZvXG4gICAgICAgICAgICAgICAgICAgIHZhciB0YXJnZXRfdG9wID0gJCgnZm9ybS5mb3JtLWZhcSBzcGFuLmluZm8nKS5vZmZzZXQoKS50b3A7XG4gICAgICAgICAgICAgICAgICAgICQoJ2h0bWwsIGJvZHknKS5hbmltYXRlKHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbFRvcDogTWF0aC5jZWlsKCh0YXJnZXRfdG9wICogJCh3aW5kb3cpLm91dGVySGVpZ2h0KHRydWUpKSAvICQoJ2h0bWwsIGJvZHknKS5oZWlnaHQoKSlcbiAgICAgICAgICAgICAgICAgICAgfSwgJ2xpbmVhcicpO1xuXG4gICAgICAgICAgICAgICAgICAgIC8vIGdvb2dsZSBhbmFsaXR5Y3NcbiAgICAgICAgICAgICAgICAgICAgZ2EoJ3NlbmQnLCAnZXZlbnQnLCAnZm9ybScsICdzdWJtaXQnLCAnY29udGFjdC1yZXF1ZXN0LXN1Y2Nlc3MnKTtcblxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICQoJ2Zvcm0uZm9ybS1mYXEgLmZhdGFsLWVycm9yJykuaHRtbCgnWW91ciBlbWFpbCB3YXMgbm90IHNlbnQnKTtcbiAgICAgICAgICAgICAgICAgICAgcmVsb2FkQ2FwdGNoYSgkZm9ybS5maW5kKCcuYm94LWNhcHRjaGEgPiBpbWcnKSwgdHJ1ZSk7IC8vIHJlbG9hZCBjYXB0Y2hhXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgJCgnZm9ybS5mb3JtLWZhcSAuZmF0YWwtZXJyb3InKS5odG1sKCdZb3VyIGVtYWlsIHdhcyBub3Qgc2VudCcpO1xuICAgICAgICAgICAgICAgIHJlbG9hZENhcHRjaGEoJGZvcm0uZmluZCgnLmJveC1jYXB0Y2hhID4gaW1nJyksIHRydWUpOyAvLyByZWxvYWQgY2FwdGNoYVxuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmVsb2FkQ2FwdGNoYSgkZm9ybS5maW5kKCcuYm94LWNhcHRjaGEgPiBpbWcnKSk7IC8vIHJlbG9hZCBjYXB0Y2hhXG4gICAgICAgICAgICAkZm9ybS50cmlnZ2VyKFwicmVzZXRcIik7XG4gICAgICAgIH1cbiAgICB9KTtcblxuXG4gICAgLy8gdmFsaWRhdGUgZm9ybVxuICAgIC8vaWYoJChcIi5ib3gtZm9ybVwiKS5sZW5ndGgpIHtcbiAgICAvLyAgICAkKFwiLmJveC1mb3JtXCIpLnZhbGlkYXRlKCk7XG4gICAgLy8gfVxuICAgIC8qIC0tLS0tLS0gZm9ybSBsb2dpbiAtLS0tLS0gKi9cbiAgICBpZiAoJCgnZm9ybVtuYW1lPVwiZm9ybS1sb2dpblwiXScpLmxlbmd0aCkge1xuICAgICAgICAkKCdmb3JtW25hbWU9XCJmb3JtLWxvZ2luXCJdJykudmFsaWRhdGUoe1xuICAgICAgICAgICAgb25mb2N1c291dDogZmFsc2UsXG4gICAgICAgICAgICBvbmtleXVwOiBmYWxzZSxcbiAgICAgICAgICAgIG9uY2xpY2s6IHRydWUsXG4gICAgICAgICAgICBvbnN1Ym1pdDogdHJ1ZSxcbiAgICAgICAgICAgIGZvY3VzSW52YWxpZDogZmFsc2UsXG4gICAgICAgICAgICBmb2N1c0NsZWFudXA6IGZhbHNlLFxuICAgICAgICAgICAgbWVzc2FnZXM6IHtcbiAgICAgICAgICAgICAgICAncGFzc3dvcmQnOiBcIlRoZSBQYXNzd29yZCBmaWVsZCBpcyBlbXB0eS5cIixcbiAgICAgICAgICAgICAgICAnZW1haWwnOiB7XG4gICAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiBcIlRoZSBFbWFpbCBmaWVsZCBpcyBlbXB0eS5cIixcbiAgICAgICAgICAgICAgICAgICAgZW1haWw6IFwiSW52YWxpZCBlbWFpbCBmb3JtYXQuXCJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGVycm9yQ2xhc3M6IFwiZXJyb3JcIixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpbnZhbGlkSGFuZGxlcjogZnVuY3Rpb24gKGV2ZW50LCB2YWxpZGF0b3IpIHtcbiAgICAgICAgICAgICAgICBpZiAoJCgnZm9ybVtuYW1lPVwiZm9ybS1sb2dpblwiXSBsYWJlbC5lcnJvcicpLmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgJCgnZm9ybVtuYW1lPVwiZm9ybS1sb2dpblwiXSBsYWJlbC5lcnJvcicpLnJlbW92ZSgpO1xuXG4gICAgICAgICAgICAgICAgaWYgKCQoJ2Zvcm1bbmFtZT1cImZvcm0tbG9naW5cIl0gZGl2LmJveC1lcnJvcicpKSB7XG4gICAgICAgICAgICAgICAgICAgICQoJ2Zvcm1bbmFtZT1cImZvcm0tbG9naW5cIl0gZGl2LmJveC1lcnJvcicpLmFkZENsYXNzKCdoaWRlJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vINGD0L/RgNCw0LLQu9C10L3QuNC1INC+0YjQuNCx0LrQsNC80LhcbiAgICAgICAgICAgIHNob3dFcnJvcnM6IGZ1bmN0aW9uIChlcnJvck1hcCwgZXJyb3JMaXN0KSB7XG4gICAgICAgICAgICAgICAgdmFyIF9mb3JtID0gJCgnZm9ybVtuYW1lPVwiZm9ybS1sb2dpblwiXScpO1xuICAgICAgICAgICAgICAgIHZhciBtc2cgPSBudWxsO1xuXG4gICAgICAgICAgICAgICAgJC5lYWNoKGVycm9yTGlzdCwgZnVuY3Rpb24gKGtleSwgdmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9mb3JtLmZpbmQodmFsdWUuZWxlbWVudCkuYWZ0ZXIoJzxsYWJlbCBjbGFzcz1cImVycm9yXCI+JyArIHZhbHVlLm1lc3NhZ2UgKyAnPC9sYWJlbD4nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIF9mb3JtLmZpbmQodmFsdWUuZWxlbWVudCkubmV4dCgpLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSxcbiAgICAgICAgfSk7XG4gICAgfVxuXG4gICAgLyogLS0tLS0tLSBmb3JtLXJlZ2lzdHJhdGlvbiAtLS0tLS0gKi9cbiAgICBpZiAoJCgnZm9ybVtuYW1lPVwiZm9ybS1yZWdpc3RyYXRpb25cIl0nKS5sZW5ndGgpIHtcbiAgICAgICAgJCgnZm9ybVtuYW1lPVwiZm9ybS1yZWdpc3RyYXRpb25cIl0nKS52YWxpZGF0ZSh7XG4gICAgICAgICAgICBvbmZvY3Vzb3V0OiBmYWxzZSxcbiAgICAgICAgICAgIG9ua2V5dXA6IGZhbHNlLFxuICAgICAgICAgICAgb25jbGljazogdHJ1ZSxcbiAgICAgICAgICAgIG9uc3VibWl0OiB0cnVlLFxuICAgICAgICAgICAgZm9jdXNJbnZhbGlkOiBmYWxzZSxcbiAgICAgICAgICAgIGZvY3VzQ2xlYW51cDogZmFsc2UsXG4gICAgICAgICAgICBtZXNzYWdlczoge1xuICAgICAgICAgICAgICAgICdjYXB0Y2hhJzogXCJJbnZhbGlkIENBUFRDSEEuXCIsIC8vIFRoZSBDQVBUQ0hBIGZpZWxkIGlzIGVtcHR5LlxuICAgICAgICAgICAgICAgICdlbWFpbCc6IHtcbiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFwiVGhlIEVtYWlsIGZpZWxkIGlzIGVtcHR5LlwiLFxuICAgICAgICAgICAgICAgICAgICBlbWFpbDogXCJJbnZhbGlkIGVtYWlsIGZvcm1hdC5cIlxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZXJyb3JDbGFzczogXCJlcnJvclwiLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGludmFsaWRIYW5kbGVyOiBmdW5jdGlvbiAoZXZlbnQsIHZhbGlkYXRvcikge1xuICAgICAgICAgICAgICAgIGlmICgkKCdmb3JtW25hbWU9XCJmb3JtLXJlZ2lzdHJhdGlvblwiXSBsYWJlbC5lcnJvcicpLmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgJCgnZm9ybVtuYW1lPVwiZm9ybS1yZWdpc3RyYXRpb25cIl0gbGFiZWwuZXJyb3InKS5yZW1vdmUoKTtcblxuICAgICAgICAgICAgICAgIGlmICgkKCdmb3JtW25hbWU9XCJmb3JtLXJlZ2lzdHJhdGlvblwiXSBkaXYuYm94LWVycm9yJykpIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnZm9ybVtuYW1lPVwiZm9ybS1yZWdpc3RyYXRpb25cIl0gZGl2LmJveC1lcnJvcicpLmFkZENsYXNzKCdoaWRlJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vINGD0L/RgNCw0LLQu9C10L3QuNC1INC+0YjQuNCx0LrQsNC80LhcbiAgICAgICAgICAgIHNob3dFcnJvcnM6IGZ1bmN0aW9uIChlcnJvck1hcCwgZXJyb3JMaXN0KSB7XG4gICAgICAgICAgICAgICAgdmFyIF9mb3JtID0gJCgnZm9ybVtuYW1lPVwiZm9ybS1yZWdpc3RyYXRpb25cIl0nKTtcbiAgICAgICAgICAgICAgICB2YXIgbXNnID0gbnVsbDtcblxuICAgICAgICAgICAgICAgICQuZWFjaChlcnJvckxpc3QsIGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICh2YWx1ZS5lbGVtZW50KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBfZm9ybS5maW5kKHZhbHVlLmVsZW1lbnQpLmFmdGVyKCc8bGFiZWwgY2xhc3M9XCJlcnJvclwiPicgKyB2YWx1ZS5tZXNzYWdlICsgJzwvbGFiZWw+Jyk7XG4gICAgICAgICAgICAgICAgICAgICAgICBfZm9ybS5maW5kKHZhbHVlLmVsZW1lbnQpLm5leHQoKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0sXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8qIC0tLS0tLS0gZm9ybS1mcmVlLXRyaWFsLXJlZ2lzdHJhdGlvbiAtLS0tLS0gKi9cbiAgICBpZiAoJCgnZm9ybVtuYW1lPVwiZnJlZV90cmlhbF9yZWdpc3RyYXRpb25cIl0nKS5sZW5ndGgpIHtcbiAgICAgICAgJCgnZm9ybVtuYW1lPVwiZnJlZV90cmlhbF9yZWdpc3RyYXRpb25cIl0nKS52YWxpZGF0ZSh7XG4gICAgICAgICAgICBvbmZvY3Vzb3V0OiBmYWxzZSxcbiAgICAgICAgICAgIG9ua2V5dXA6IGZhbHNlLFxuICAgICAgICAgICAgb25jbGljazogdHJ1ZSxcbiAgICAgICAgICAgIG9uc3VibWl0OiB0cnVlLFxuICAgICAgICAgICAgZm9jdXNJbnZhbGlkOiBmYWxzZSxcbiAgICAgICAgICAgIGZvY3VzQ2xlYW51cDogZmFsc2UsXG4gICAgICAgICAgICBtZXNzYWdlczoge1xuICAgICAgICAgICAgICAgICdjYXB0Y2hhJzogXCJJbnZhbGlkIENBUFRDSEEuXCIsIC8vIFRoZSBDQVBUQ0hBIGZpZWxkIGlzIGVtcHR5LlxuICAgICAgICAgICAgICAgICduYW1lJzoge1xuICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogXCJUaGUgTmFtZSBmaWVsZCBpcyBlbXB0eS5cIixcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICdlbWFpbCc6IHtcbiAgICAgICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFwiVGhlIEVtYWlsIGZpZWxkIGlzIGVtcHR5LlwiLFxuICAgICAgICAgICAgICAgICAgICBlbWFpbDogXCJJbnZhbGlkIGVtYWlsIGZvcm1hdC5cIlxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgZXJyb3JDbGFzczogXCJlcnJvclwiLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIGludmFsaWRIYW5kbGVyOiBmdW5jdGlvbiAoZXZlbnQsIHZhbGlkYXRvcikge1xuICAgICAgICAgICAgICAgIGlmICgkKCdmb3JtW25hbWU9XCJmcmVlX3RyaWFsX3JlZ2lzdHJhdGlvblwiXSAjYmxvY2stZmllbGRzIGxhYmVsLmVycm9yJykubGVuZ3RoKVxuICAgICAgICAgICAgICAgICAgICAkKCdmb3JtW25hbWU9XCJmcmVlX3RyaWFsX3JlZ2lzdHJhdGlvblwiXSAjYmxvY2stZmllbGRzIGxhYmVsLmVycm9yJykucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoJCgnZm9ybVtuYW1lPVwiZnJlZV90cmlhbF9yZWdpc3RyYXRpb25cIl0gZGl2LmJveC1lcnJvcicpKSB7XG4gICAgICAgICAgICAgICAgICAgICQoJ2Zvcm1bbmFtZT1cImZyZWVfdHJpYWxfcmVnaXN0cmF0aW9uXCJdIGRpdi5ib3gtZXJyb3InKS5hZGRDbGFzcygnaGlkZScpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvLyDRg9C/0YDQsNCy0LvQtdC90LjQtSDQvtGI0LjQsdC60LDQvNC4XG4gICAgICAgICAgICBzaG93RXJyb3JzOiBmdW5jdGlvbiAoZXJyb3JNYXAsIGVycm9yTGlzdCkge1xuICAgICAgICAgICAgICAgIHZhciBmaWxlZHMgPSAkKCdmb3JtW25hbWU9XCJmcmVlX3RyaWFsX3JlZ2lzdHJhdGlvblwiXSAjYmxvY2stZmllbGRzJyk7XG4gICAgICAgICAgICAgICAgdmFyIG1zZyA9IG51bGw7XG5cbiAgICAgICAgICAgICAgICAkLmVhY2goZXJyb3JMaXN0LCBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhrZXksIHZhbHVlKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGZpbGVkcy5maW5kKHZhbHVlLmVsZW1lbnQpLmFmdGVyKCc8bGFiZWwgY2xhc3M9XCJlcnJvclwiPicgKyB2YWx1ZS5tZXNzYWdlICsgJzwvbGFiZWw+Jykuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKiAtLS0tLS0tIGZvcm0tcmVzdG9yZSAtLS0tLS0gKi9cbiAgICBpZiAoJCgnZm9ybVtuYW1lPVwiZm9ybS1yZXN0b3JlXCJdJykubGVuZ3RoKSB7XG4gICAgICAgICQoJ2Zvcm1bbmFtZT1cImZvcm0tcmVzdG9yZVwiXScpLnZhbGlkYXRlKHtcbiAgICAgICAgICAgIG9uZm9jdXNvdXQ6IGZhbHNlLFxuICAgICAgICAgICAgb25rZXl1cDogZmFsc2UsXG4gICAgICAgICAgICBvbmNsaWNrOiB0cnVlLFxuICAgICAgICAgICAgb25zdWJtaXQ6IHRydWUsXG4gICAgICAgICAgICBmb2N1c0ludmFsaWQ6IGZhbHNlLFxuICAgICAgICAgICAgZm9jdXNDbGVhbnVwOiBmYWxzZSxcbiAgICAgICAgICAgIGRlYnVnOiBmYWxzZSxcbiAgICAgICAgICAgIG1lc3NhZ2VzOiB7XG4gICAgICAgICAgICAgICAgJ2VtYWlsJzoge1xuICAgICAgICAgICAgICAgICAgICByZXF1aXJlZDogXCJUaGUgRW1haWwgZmllbGQgaXMgZW1wdHkuXCIsXG4gICAgICAgICAgICAgICAgICAgIGVtYWlsOiBcIkludmFsaWQgZW1haWwgZm9ybWF0LlwiXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICBlcnJvckNsYXNzOiBcImVycm9yXCIsXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgaW52YWxpZEhhbmRsZXI6IGZ1bmN0aW9uIChldmVudCwgdmFsaWRhdG9yKSB7XG4gICAgICAgICAgICAgICAgaWYgKCQoJ2Zvcm1bbmFtZT1cImZvcm0tcmVzdG9yZVwiXSBsYWJlbC5lcnJvcicpLmxlbmd0aClcbiAgICAgICAgICAgICAgICAgICAgJCgnZm9ybVtuYW1lPVwiZm9ybS1yZXN0b3JlXCJdIGxhYmVsLmVycm9yJykucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoJCgnZm9ybVtuYW1lPVwiZm9ybS1yZXN0b3JlXCJdIGRpdi5ib3gtZXJyb3InKSkge1xuICAgICAgICAgICAgICAgICAgICAkKCdmb3JtW25hbWU9XCJmb3JtLXJlc3RvcmVcIl0gZGl2LmJveC1lcnJvcicpLmFkZENsYXNzKCdoaWRlJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIC8vINGD0L/RgNCw0LLQu9C10L3QuNC1INC+0YjQuNCx0LrQsNC80LhcbiAgICAgICAgICAgIHNob3dFcnJvcnM6IGZ1bmN0aW9uIChlcnJvck1hcCwgZXJyb3JMaXN0KSB7XG4gICAgICAgICAgICAgICAgdmFyIF9mb3JtID0gJCgnZm9ybVtuYW1lPVwiZm9ybS1yZXN0b3JlXCJdJyk7XG4gICAgICAgICAgICAgICAgdmFyIG1zZyA9IG51bGw7XG5cbiAgICAgICAgICAgICAgICAkLmVhY2goZXJyb3JMaXN0LCBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUuZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX2Zvcm0uZmluZCh2YWx1ZS5lbGVtZW50KS5hZnRlcignPGxhYmVsIGNsYXNzPVwiZXJyb3JcIj4nICsgdmFsdWUubWVzc2FnZSArICc8L2xhYmVsPicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgX2Zvcm0uZmluZCh2YWx1ZS5lbGVtZW50KS5uZXh0KCkuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKiAtLS0tLSBmb3JtIGRpc2NvdW50IC0tLS0tICovXG4gICAgaWYgKCQoJyNmb3JtLWRpc2NvdW50JykubGVuZ3RoKSB7XG4gICAgICAgICQoJyNmb3JtLWRpc2NvdW50JykudmFsaWRhdGUoe1xuICAgICAgICAgICAgb25mb2N1c291dDogZmFsc2UsXG4gICAgICAgICAgICBvbmtleXVwOiBmYWxzZSxcbiAgICAgICAgICAgIG9uY2xpY2s6IHRydWUsXG4gICAgICAgICAgICBvbnN1Ym1pdDogdHJ1ZSxcbiAgICAgICAgICAgIGZvY3VzSW52YWxpZDogZmFsc2UsXG4gICAgICAgICAgICBmb2N1c0NsZWFudXA6IGZhbHNlLFxuICAgICAgICAgICAgbWVzc2FnZXM6IHtcbiAgICAgICAgICAgICAgICAnY2FwdGNoYSc6IFwiSW52YWxpZCBDQVBUQ0hBLlwiLCAvLyBUaGUgQ0FQVENIQSBmaWVsZCBpcyBlbXB0eS5cbiAgICAgICAgICAgICAgICAnZGlzY291bnRbbmFtZV0nOiBcIlRoZSBOYW1lIGZpZWxkIGlzIGVtcHR5LlwiLFxuICAgICAgICAgICAgICAgICdkaXNjb3VudFtlbWFpbF0nOiB7XG4gICAgICAgICAgICAgICAgICAgIHJlcXVpcmVkOiBcIlRoZSBQYXNzd29yZCBmaWVsZCBpcyBlbXB0eS5cIixcbiAgICAgICAgICAgICAgICAgICAgZW1haWw6IFwiSW52YWxpZCBlbWFpbCBmb3JtYXQuXCJcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgIGVycm9yQ2xhc3M6IFwiZXJyb3JcIixcbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICBpbnZhbGlkSGFuZGxlcjogZnVuY3Rpb24gKGV2ZW50LCB2YWxpZGF0b3IpIHtcbiAgICAgICAgICAgICAgICBpZiAoJCgnI2Zvcm0tZGlzY291bnQgbGFiZWwuZXJyb3InKS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgICAgICQoJyNmb3JtLWRpc2NvdW50IGxhYmVsLmVycm9yJykucmVtb3ZlKCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoJCgnI2Zvcm0tZGlzY291bnQgZGl2LmJveC1lcnJvcicpKSB7XG4gICAgICAgICAgICAgICAgICAgICQoJyNmb3JtLWRpc2NvdW50IGRpdi5ib3gtZXJyb3InKS5hZGRDbGFzcygnaGlkZScpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAvLyDRg9C/0YDQsNCy0LvQtdC90LjQtSDQvtGI0LjQsdC60LDQvNC4XG4gICAgICAgICAgICBzaG93RXJyb3JzOiBmdW5jdGlvbiAoZXJyb3JNYXAsIGVycm9yTGlzdCkge1xuICAgICAgICAgICAgICAgIHZhciBfZm9ybSA9ICQoJyNmb3JtLWRpc2NvdW50Jyk7XG4gICAgICAgICAgICAgICAgdmFyIG1zZyA9IG51bGw7XG5cbiAgICAgICAgICAgICAgICAkLmVhY2goZXJyb3JMaXN0LCBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICBpZiAodmFsdWUuZWxlbWVudCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgX2Zvcm0uZmluZCh2YWx1ZS5lbGVtZW50KS5hZnRlcignPGxhYmVsIGNsYXNzPVwiZXJyb3JcIj4nICsgdmFsdWUubWVzc2FnZSArICc8L2xhYmVsPicpO1xuICAgICAgICAgICAgICAgICAgICAgICAgX2Zvcm0uZmluZCh2YWx1ZS5lbGVtZW50KS5uZXh0KCkuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9LFxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvKipcbiAgICAgKiBDQVBBQ0hBXG4gICAgICovXG4gICAgaWYgKCQoJy5ib3gtY2FwdGNoYScpLmxlbmd0aCkge1xuICAgICAgICAkKCcudXBkYXRlLWNhcHRjaGEsIC5hLXVwZGF0ZS1jYXB0Y2hhJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgcmVsb2FkQ2FwdGNoYSgkKHRoaXMpLCB0cnVlKTtcbi8vICAgICAgICAgICB2YXIgX3NyYyA9ICcvY2FwdGNoYS5odG1sPycrTWF0aC5yYW5kb20oKTtcbi8vICAgICAgICAgICBpZigkKHRoaXMpLmF0dHIoJ2F0dHItd2lkdGgnKSAmJiAkKHRoaXMpLmF0dHIoJ2F0dHItaGVpZ2h0JykpIHtcbi8vICAgICAgICAgICAgICAgX3NyYyA9ICcvY2FwdGNoYS5odG1sP3dpZHRoPScrJCh0aGlzKS5hdHRyKCdhdHRyLXdpZHRoJykrJyZoZWlnaHQ9JyskKHRoaXMpLmF0dHIoJ2F0dHItaGVpZ2h0JykrJyYnK01hdGgucmFuZG9tKCk7XG4vLyAgICAgICAgICAgfVxuLy9cbi8vICAgICAgICAgICAkKCcuYm94LWNhcHRjaGEnKS5maW5kKCcjaW1nLWNhcHRjaGEnKS5hdHRyKCdzcmMnLCBfc3JjKTtcbi8vICAgICAgICAgICAkKCdmb3JtW25hbWU9XCJmb3JtLXJlZ2lzdHJhdGlvblwiXSwgZm9ybVtuYW1lPVwiZnJlZV90cmlhbF9yZWdpc3RyYXRpb25cIl0nKS5maW5kKCdpbnB1dFtuYW1lPVwiY2FwdGNoYVwiXScpLmZvY3VzKCk7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIFxuICAgIC8vIHN3aXRjaCBmZWF0dXJlcyBBbmRyb2lkIGJhc2ljXG4gICAgJCgnLnNob3dfYmFzaWNfZmVhdHVyZXMuX2FuZHJvaWQtZiBhJykudG9nZ2xlKFxuICAgICAgICAgICAgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgICAgICAgICAkKCcuYmFzaWNfZmUuX2FuZHJvaWQtZicpLmNzcyhcIm1hcmdpbi10b3BcIiwgXCIxMHB4XCIpO1xuICAgICAgICAgICAgICAgICQoJy5iYXNpY19mZS5fYW5kcm9pZC1mJykuc2hvdygpO1xuICAgICAgICAgICAgICAgICQoJy5iYXNpY193ciAuc2hvdy1mLl9hbmRyb2lkLWYnKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgJCgnLmJhc2ljX3dyIC5oaWRlLWYuX2FuZHJvaWQtZicpLnNob3coKTtcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAkKCcuYmFzaWNfZmUuX2FuZHJvaWQtZicpLmNzcyhcIm1hcmdpbi10b3BcIiwgXCI5MHB4XCIpO1xuICAgICAgICAkKCcuYmFzaWNfZmUuX2FuZHJvaWQtZicpLmhpZGUoKTtcblx0XHRcdFx0JCgnLmJhc2ljX3dyIC5zaG93LWYuX2FuZHJvaWQtZicpLnNob3coKTtcblx0XHRcdFx0JCgnLmJhc2ljX3dyIC5oaWRlLWYuX2FuZHJvaWQtZicpLmhpZGUoKTtcblx0XHRcdFx0fSk7XG5cdFxuICAgIC8vIHN3aXRjaCBmZWF0dXJlcyBBbmRyb2lkIHByZW1pdW1cbiAgICAkKCcuc2hvd19wcmVtaXVtX2ZlYXR1cmVzLl9hbmRyb2lkLWYgYScpLnRvZ2dsZShcbiAgICAgICAgICAgIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgICAgICAgJCgnLnByZW1pdW1fZmUuX2FuZHJvaWQtZicpLmNzcyhcIm1hcmdpbi10b3BcIiwgXCIxMHB4XCIpO1xuICAgICAgICAgICAgICAgICQoJy5wcmVtaXVtX2ZlLl9hbmRyb2lkLWYnKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgJCgnLnByZW1pdW1fd3IgLnNob3ctZi5fYW5kcm9pZC1mJykuaGlkZSgpO1xuICAgICAgICAgICAgICAgICQoJy5wcmVtaXVtX3dyIC5oaWRlLWYuX2FuZHJvaWQtZicpLnNob3coKTtcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAkKCcucHJlbWl1bV9mZS5fYW5kcm9pZC1mJykuY3NzKFwibWFyZ2luLXRvcFwiLCBcIjkwcHhcIik7XG4gICAgICAgICQoJy5wcmVtaXVtX2ZlLl9hbmRyb2lkLWYnKS5oaWRlKCk7XG5cdFx0XHRcdCQoJy5wcmVtaXVtX3dyIC5zaG93LWYuX2FuZHJvaWQtZicpLnNob3coKTtcblx0XHRcdFx0JCgnLnByZW1pdW1fd3IgLmhpZGUtZi5fYW5kcm9pZC1mJykuaGlkZSgpO1xuXHRcdFx0XHR9KTtcblx0XG5cdFx0Ly8gc3dpdGNoIGZlYXR1cmVzIGlPU1xuICAgICQoJy5zaG93X3ByZW1pdW1fZmVhdHVyZXMuX2ljbG91ZC1mIGEnKS50b2dnbGUoXG4gICAgICAgICAgICBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICQoJy5wcmVtaXVtX2ZlLl9pY2xvdWQtZicpLmNzcyhcIm1hcmdpbi10b3BcIiwgXCIxMHB4XCIpO1xuICAgICAgICAgICAgICAgICQoJy5wcmVtaXVtX2ZlLl9pY2xvdWQtZicpLnNob3coKTtcbiAgICAgICAgICAgICAgICAkKCcuc2hvdy1mLl9pY2xvdWQtZicpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAkKCcuaGlkZS1mLl9pY2xvdWQtZicpLnNob3coKTtcbiAgICAgICAgICAgICAgICAkKCcucHJvZC1pY2xvdWQucHJvZC0yJykuc2hvdygpO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICQoJy5wcmVtaXVtX2ZlLl9pY2xvdWQtZicpLmNzcyhcIm1hcmdpbi10b3BcIiwgXCI5MHB4XCIpO1xuICAgICAgICAkKCcucHJlbWl1bV9mZS5faWNsb3VkLWYnKS5oaWRlKCk7XG4gICAgICAgICQoJy5zaG93LWYuX2ljbG91ZC1mJykuc2hvdygpO1xuICAgICAgICAkKCcuaGlkZS1mLl9pY2xvdWQtZicpLmhpZGUoKTtcbiAgICAgICAgJCgnLnByb2QtaWNsb3VkLnByb2QtMicpLmhpZGUoKTtcbiAgICAgICAgfVxuICAgICk7XG5cdFx0Ly8gc3dpdGNoIGZlYXR1cmVzIEphaWxicmVha1xuICAgICQoJy5zaG93X3ByZW1pdW1fZmVhdHVyZXMuX2phaWxicmVhay1mIGEnKS50b2dnbGUoXG4gICAgICAgICAgICBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgICAgICQoJy5wcmVtaXVtX2ZlLl9qYWlsYnJlYWstZicpLmNzcyhcIm1hcmdpbi10b3BcIiwgXCIxMHB4XCIpO1xuICAgICAgICAgICAgICAgICQoJy5wcmVtaXVtX2ZlLl9qYWlsYnJlYWstZicpLnNob3coKTtcbiAgICAgICAgICAgICAgICAkKCcuc2hvdy1mLl9qYWlsYnJlYWstZicpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAkKCcuaGlkZS1mLl9qYWlsYnJlYWstZicpLnNob3coKTtcbiAgICAgICAgICAgICAgICAkKCcuX3Byb2QtaWNsb3VkLnByb2QtMi5famFpbGJyZWFrLWYnKS5zaG93KCk7XG4gICAgICAgICAgICB9LCBmdW5jdGlvbiAoZXZlbnQpIHtcbiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgJCgnLnByZW1pdW1fZmUuX2phaWxicmVhay1mJykuY3NzKFwibWFyZ2luLXRvcFwiLCBcIjkwcHhcIik7XG4gICAgICAgICQoJy5wcmVtaXVtX2ZlLl9qYWlsYnJlYWstZicpLmhpZGUoKTtcbiAgICAgICAgJCgnLnNob3ctZi5famFpbGJyZWFrLWYnKS5zaG93KCk7XG4gICAgICAgICQoJy5oaWRlLWYuX2phaWxicmVhay1mJykuaGlkZSgpO1xuICAgICAgICAkKCcucHJvZC1pY2xvdWQucHJvZC0yLl9qYWlsYnJlYWstZicpLmhpZGUoKTtcbiAgICAgICAgfVxuICAgICk7XG4gICAgJChcImlucHV0W25hbWU9J29wdGlvbnNSYWRpb3MnXVwiKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy9jb25zb2xlLmxvZyh0aGlzLmdldEF0dHJpYnV0ZShcImNoZWNrZWRcIikpO1xuICAgICAgICBpZiAodGhpcy5nZXRBdHRyaWJ1dGUoXCJjaGVja2VkXCIpKSB7XG4gICAgICAgICAgICAvLyBhbGVydCgkKHRoaXMpLnZhbCgpKTtcblxuICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoJy5sYWJlbF9yYWRpbycpLmFkZENsYXNzKCdyX29uJyk7XG4gICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgnLmxhYmVsX3JhZGlvJykucmVtb3ZlQ2xhc3MoJ3Jfb2ZmJyk7XG4gICAgICAgICAgICAkKHRoaXMpLnBhcmVudHMoJ2Zvcm0nKS5jaGlsZHJlbignLnByb2R1Y3RfcHJpY2UnKS52YWwoJCh0aGlzKS52YWwoKSk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBcbiAgICAvLyBmdW5jdGlvbiBzdGlja3lIZWFkZXIoaGVhZGVyLCBjdXJyZW50UG9zKSB7XG4gICAgLy8gICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCBmdW5jdGlvbiAoZSkge1xuICAgIC8vICAgICAgICAgdmFyIGRpc3RhbmNlWSA9IHdpbmRvdy5wYWdlWU9mZnNldCB8fCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuc2Nyb2xsVG9wO1xuICAgIC8vXG4gICAgLy8gICAgICAgICBpZiAoZGlzdGFuY2VZID4gY3VycmVudFBvcykge1xuICAgIC8vICAgICAgICAgICAgIGhlYWRlci5hZGRDbGFzcyhcInN0aWNreVwiKTtcbiAgICAvLyAgICAgICAgIH1cbiAgICAvLyAgICAgICAgIGVsc2Uge1xuICAgIC8vICAgICAgICAgICAgIGhlYWRlci5yZW1vdmVDbGFzcyhcInN0aWNreVwiKTtcbiAgICAvLyAgICAgICAgIH1cbiAgICAvLyAgICAgfSk7XG4gICAgLy8gfVxuICAgIC8vXG4gICAgLy8gdmFyIG15aGVhZGVyID0gJChcIiNzYXZlXzFcIik7XG4gICAgLy8gY29uc29sZS5sb2cobXloZWFkZXIpXG4gICAgLy8gc3RpY2t5SGVhZGVyKG15aGVhZGVyLCBteWhlYWRlci5vZmZzZXQudG9wKCkpO1xuICAgIC8qJChcImlucHV0W25hbWU9J29wdGlvbnNSYWRpb3MnXVwiKS5maWx0ZXIoJzpjaGVja2VkJykuZWFjaChmdW5jdGlvbigpe1xuXG4gICAgIHZhciBjdXJyICA9ICQodGhpcyk7XG5cblxuXG4gICAgIGN1cnIucGFyZW50KCcubGFiZWxfcmFkaW8nKS5yZW1vdmVDbGFzcygncl9vZmYnKTtcbiAgICAgY3Vyci5wYXJlbnQoJy5sYWJlbF9yYWRpbycpLmFkZENsYXNzKCdyX29uJyk7XG5cbiAgICAgY3Vyci5wYXJlbnRzKCdmb3JtJykuY2hpbGRyZW4oJy5wcm9kdWN0X3ByaWNlJykudmFsKGN1cnIudmFsKCkpO1xuXG4gICAgIH0pOyAgICovXG4gICAgLyogaGFzaGNoYW5nZV9BZnRlckluaXQgKi9cblxuICAgIGhhc2hjaGFuZ2VfQWZ0ZXJJbml0KCk7XG5cbiAgICAvKiBmaXggZmVhdHVyZXMgZGVzaW5lIGNocm9tZSAqL1xuICAgIGlmICgkKCcjdmliZXItd2hhdHNhcHAtc2t5cGUnKS5sZW5ndGgpIHtcbiAgICAgICAgaWYgKCQuYnJvd3Nlci53ZWJraXQpIHtcbiAgICAgICAgICAgICQoJyN2aWJlci13aGF0c2FwcC1za3lwZScpLnJlbW92ZUNsYXNzKCd3MzBwJykuYWRkQ2xhc3MoJ3cxNnAnKTtcbiAgICAgICAgICAgIC8vIGFsZXJ0KCBcIlRoaXMgaXMgV2ViS2l0IVwiICk7XG4gICAgICAgIH0gZWxzZVxuICAgICAgICAgICAgJCgnI3ZpYmVyLXdoYXRzYXBwLXNreXBlJykucmVtb3ZlQ2xhc3MoJ3cxNnAnKS5hZGRDbGFzcygndzMwcCcpO1xuICAgIH1cblxuLy8gZ2EgY2xpY2tcbi8vIGZhcVxuICAgICQoJ2Zvcm1bbmFtZT1cImZvcm0tZmFxXCJdIGJ1dHRvbi5ldmVudC1zdWJtaXQnKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIGdhKCdzZW5kJywgJ2V2ZW50JywgJ2Zvcm0nLCAnc3VibWl0JywgJ2ZhcS1yZXF1ZXN0Jyk7XG4gICAgfSk7XG5cbi8vIGxvZ2luXG4gICAgJCgnZm9ybVtuYW1lPVwiZm9ybS1sb2dpblwiXSAuYnV0dG9uLXN1bWJpdCBidXR0b24nKS5jbGljayhmdW5jdGlvbiAoKSB7XG4gICAgICAgIGdhKCdzZW5kJywgJ2V2ZW50JywgJ2Zvcm0nLCAnc3VibWl0JywgJ2xvZ2luJyk7XG4gICAgfSk7XG5cbi8vIHJlc3RvcmVcbiAgICAkKCdmb3JtW25hbWU9XCJmb3JtLXJlc3RvcmVcIl0gLmJ1dHRvbi1zdW1iaXQgYnV0dG9uJykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICBnYSgnc2VuZCcsICdldmVudCcsICdmb3JtJywgJ3N1Ym1pdCcsICdyZXN0b3JlJyk7XG4gICAgfSk7XG5cbi8vIHJlZ2lzdHJhdGlvblxuICAgICQoJ2Zvcm1bbmFtZT1cImZvcm0tcmVnaXN0cmF0aW9uXCJdIC5idXR0b24tc3VtYml0IGJ1dHRvbicpLmNsaWNrKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZ2EoJ3NlbmQnLCAnZXZlbnQnLCAnZm9ybScsICdzdWJtaXQnLCAncmVnaXN0cmF0aW9uJyk7XG4gICAgfSk7XG5cbi8vIGNvbnRhY3QtdXNcbiAgICAkKCdmb3JtW25hbWU9XCJzZW5kLW1haWwtY29udGFjdC11c1wiXSBidXR0b24uZXZlbnQtc3VibWl0JykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICBnYSgnc2VuZCcsICdldmVudCcsICdmb3JtJywgJ3N1Ym1pdCcsICdjb250YWN0LXJlcXVlc3QnKTtcbiAgICB9KTtcblxuLy8gY29tcGF0aWJpbGl0eVxuICAgICQoJ2Zvcm1bbmFtZT1cInNlbmRfZmluZF9waG9uZVwiXSBidXR0b24uZXZlbnQtc3VibWl0JykuY2xpY2soZnVuY3Rpb24gKCkge1xuICAgICAgICBnYSgnc2VuZCcsICdldmVudCcsICdmb3JtJywgJ3N1Ym1pdCcsICdjb21wYXRpYmlsaXR5LXJlcXVlc3QnKTtcbiAgICB9KTtcblxuXG5cbiAgICAvLyBzY3JvbGwgKGZseS1ib3gpXG4gICAgaWYgKCQoJy5mbHktYm94JykubGVuZ3RoKSB7XG4gICAgICAgICQoJy5mbHktYm94Jykuc2Nyb2xsUHVtcGljKHtcbiAgICAgICAgICAgICdzdGFydCc6IDEwMDAsXG4gICAgICAgICAgICAnc3RvcCc6IDAsXG4gICAgICAgICAgICAnYW5pbWF0ZSc6IHtcbiAgICAgICAgICAgICAgICAndHlwZSc6ICd2aXNpYmxlJywgLy8gZmFkZSwgdmlzaWJsZSwgYmxpbmtpbmdcbiAgICAgICAgICAgICAgICAndGltZVNob3cnOiA1MCxcbiAgICAgICAgICAgICAgICAndGltZUhpZGUnOiA1MFxuICAgICAgICAgICAgfVxuICAgICAgICB9KTsgLy9cImNvZWZmXCI6MS4xNVxuICAgIH1cblxuICAgIC8vIGZseSBibG9ja1xuICAgIGlmICgkKCcuZmx5LWJveC1idXR0b25zJykubGVuZ3RoKSB7XG4gICAgICAgICQod2luZG93KS5vbignbG9hZCByZXNpemUnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgJG9mZmNldFRvcCA9IE1hdGgucm91bmQoJCgnLmZseS1wb3NpdGlvbicpLm9mZnNldCgpLnRvcCk7XG4gICAgICAgICAgICBpZiAodHlwZW9mICQuZGF0YShkb2N1bWVudCwgJ19zY3JvbGxCdXR0b25zXycgKyAkKHRoaXMpLndpZHRoKCkpID09IFwidW5kZWZpbmVkXCJcbiAgICAgICAgICAgICAgICAgICAgfHwgJC5kYXRhKGRvY3VtZW50LCAnX3Njcm9sbEJ1dHRvbnNfJyArICQodGhpcykud2lkdGgoKSkgIT0gJG9mZmNldFRvcCkge1xuICAgICAgICAgICAgICAgICQuZGF0YShkb2N1bWVudCwgJ19zY3JvbGxCdXR0b25zXycgKyAkKHRoaXMpLndpZHRoKCksICRvZmZjZXRUb3ApO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyggJG9mZmNldFRvcCwgJC5kYXRhKGRvY3VtZW50LCAnX3Njcm9sbEJ1dHRvbnNfJyskKHRoaXMpLndpZHRoKCkpICk7XG5cbiAgICAgICAgICAgIGlmICgkLmRhdGEoZG9jdW1lbnQsICdfc2Nyb2xsQnV0dG9uc18nICsgJCh0aGlzKS53aWR0aCgpKSkge1xuICAgICAgICAgICAgICAgICQoJy5mbHktYm94LWJ1dHRvbnMnKS5zY3JvbGxQdW1waWMoe1xuICAgICAgICAgICAgICAgICAgICAnX29iakZseSc6ICcuYmxvY2stZmx5JyxcbiAgICAgICAgICAgICAgICAgICAgJ3N0YXJ0JzogJC5kYXRhKGRvY3VtZW50LCAnX3Njcm9sbEJ1dHRvbnNfJyArICQodGhpcykud2lkdGgoKSksXG4gICAgICAgICAgICAgICAgICAgICdzdG9wJzogMCxcbiAgICAgICAgICAgICAgICAgICAgJ3JpZ2h0JzogMzAwLFxuICAgICAgICAgICAgICAgICAgICAnX3NldHRpbmdzJzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ19yZXNwb25jZSc6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ192YWxpZGF0ZSc6IGZhbHNlXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICdhbmltYXRlJzoge1xuICAgICAgICAgICAgICAgICAgICAgICAgJ3R5cGUnOiAnYmxpbmtpbmcnLCAvLyBmYWRlLCB2aXNpYmxlLCBibGlua2luZ1xuICAgICAgICAgICAgICAgICAgICAgICAgJ3RpbWVTaG93JzogMzAsXG4gICAgICAgICAgICAgICAgICAgICAgICAndGltZUhpZGUnOiA1MFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSk7IC8vXCJjb2VmZlwiOjEuMTVcbiAgICAgICAgICAgIH1cblxuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAvLyB0YWJzIGNvbXBhdGliaWxpdHlcbiAgICAkKCcjdGVtcC0xIC5iYy10YWJzIC5pdGVtLXRhYiBhLCAjdGVtcC0xIC5iYy10YWJzIC5pdGVtLXRhYiBzcGFuLCAjdGVtcC0yID4gdWwgPiBsaSA+IGEsICN0ZW1wLTIgPiB1bCA+IGxpID4gc3BhbicpLm9uKCdjbGljaycsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgLy8gY2xlYXIgYWxsIGFjdGl2ZVxuICAgICAgICB2YXIgX2l0YWIgPSAkKHRoaXMpLnBhcmVudCgpLFxuICAgICAgICAgICAgICAgIF90aGlzID0gJCh0aGlzKSxcbiAgICAgICAgICAgICAgICBfZGF0YV9jYXRfaWQgPSBfaXRhYi5hdHRyKCdkYXRhLWNhdC1pZCcpO1xuICAgICAgICAkLmVhY2goJCgnI3RlbXAtMSAuYmMtdGFicyAuaXRlbS10YWIsICN0ZW1wLTIgPiB1bCA+IGxpLCAjdGVtcC0xICN0YWItY29udGVudCA+IGRpdicpLCBmdW5jdGlvbiAoa2V5LCB2YWwpIHtcbiAgICAgICAgICAgIGlmICgkKHZhbCkuaGFzQ2xhc3MoJ2FjdGl2ZScpKVxuICAgICAgICAgICAgICAgICQodmFsKS5yZW1vdmVDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGlmICghX2l0YWIuaGFzQ2xhc3MoJ2FjdGl2ZScpKSB7XG4gICAgICAgICAgICAkKCcjdGVtcC0xIC5iYy10YWJzIHNlY3Rpb24gPiBkaXZbZGF0YS1jYXQtaWQ9XCInICsgX2RhdGFfY2F0X2lkICsgJ1wiXSwgI3RlbXAtMiA+IHVsID4gbGlbZGF0YS1jYXQtaWQ9XCInICsgX2RhdGFfY2F0X2lkICsgJ1wiXScpLmFkZENsYXNzKCdhY3RpdmUnKTtcbiAgICAgICAgICAgICQoJyN0ZW1wLTEgI3RhYi1jb250ZW50ID4gZGl2W2RhdGEtY2F0LWlkPVwiJyArIF9kYXRhX2NhdF9pZCArICdcIl0nKS5hZGRDbGFzcygnYWN0aXZlJyk7XG4gICAgICAgIH1cblxuICAgICAgICAvLyBjbGVhciBhbGwgaXRlbXNcbi8vICAgICAgICAgICAgJC5lYWNoKCQoJyN0ZW1wLTIgPiB1bCA+IGxpIHVsJyksIGZ1bmN0aW9uKGtleSwgdmFsdWUpIHtcbi8vICAgICAgICAgICAgICAgICQodmFsdWUpLnNsaWRlVXAoKTtcbi8vICAgICAgICAgICAgfSk7XG5cbi8vICAgICAgaWYoJCgnI3RlbXAtMiA+IHVsID4gbGkgdWwnKS5pcygnOnZpc2libGUnKSkge1xuLy8gICAgICAgICAgJCgnI3RlbXAtMiA+IHVsID4gbGkgdWwnKS5zbGlkZVVwKCdzbG93Jyk7XG4vLyAgICAgIH1cblxuICAgICAgICBpZiAoX2l0YWIuY2hpbGRyZW4oJ3VsJykuaXMoJzpub3QodmlzaWJsZSknKSkge1xuICAgICAgICAgICAgX2l0YWIuY2hpbGRyZW4oJ3VsJykuc2xpZGVEb3duKCdzbG93JywgZnVuY3Rpb24gKCkge1xuXG4gICAgICAgICAgICAgICAgJC5lYWNoKCQoJyN0ZW1wLTIgPiB1bCA+IGxpJykubm90KCc6ZXEoJyArICQodGhpcykucGFyZW50KCkuaW5kZXgoKSArICcpJykuY2hpbGRyZW4oJ3VsJyksIGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7XG4gICAgICAgICAgICAgICAgICAgICQodmFsdWUpLnNsaWRlVXAoKTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIC8vIHNjcm9sbCB0byBhY3RpdmVcbiAgICAgICAgICAgICAgICAkKCdodG1sLCBib2R5Jykuc3RvcCgpLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgICAgICBzY3JvbGxUb3A6IF90aGlzLm9mZnNldCgpLnRvcFxuICAgICAgICAgICAgICAgIH0sIDEwMDApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cblxuXG5cbiAgICB9KTtcblxuXG4gICAgLy8gbW9iaWxlIG9wZXJhdG9yc1xuICAgIGlmICgkKCcudG9nZ2xlLW1vYmlsZS1vcGVyYXRvcnMnKS5sZW5ndGgpIHtcbiAgICAgICAgJCgnLnRvZ2dsZS1tb2JpbGUtb3BlcmF0b3JzJykub24oJ2NsaWNrJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICAgICAgJC5lYWNoKCQoJyNtb2JpbGUtb3BlcmF0b3JzIC5pdGVtLW9wZXJhdG9ycycpLCBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkge1xuICAgICAgICAgICAgICAgIGlmICgkKHZhbHVlKS5oYXNDbGFzcygnaGlkZScpKSB7XG4gICAgICAgICAgICAgICAgICAgICQodmFsdWUpLnJlbW92ZUNsYXNzKCdoaWRlJykuYWRkQ2xhc3MoJ3Nob3cnKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICQodGhpcykucGFyZW50KCkuaGlkZSgpO1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9KTtcbiAgICB9XG5cblxuXG4gICAgLy8gaG92ZXJzXG4gICAgJCgnLmJveC12aWRlby1jb25zdHJ1Y3RvcnMgLmJsb2NrLXZpZGVvLWJ1dHRvbiA+IC5ib3gtaG92ZXInKS5ob3ZlcihcbiAgICAgICAgICAgIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZyggJHJzX3dpZHRoICk7XG4gICAgICAgICAgICAgICAgaWYgKCRyc193aWR0aCA+IDk5MikgLy8gISRyc193aWR0aCB8fFxuICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmZpbmQoJy5ob3Zlci12aWRlby1idXR0b25zJykuc2hvdygpO1xuICAgICAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoJHJzX3dpZHRoID4gOTkyKSAvLyAhJHJzX3dpZHRoIHx8XG4gICAgICAgICAgICAkKHRoaXMpLmZpbmQoJy5ob3Zlci12aWRlby1idXR0b25zJykuaGlkZSgpO1xuICAgIH1cbiAgICApO1xuXG5cbiAgICAvLyBib290c3RyYXAgY2xpYyBwb3BVcFxuICAgIGlmICgkKFwiLnlvdXR1YmVcIikubGVuZ3RoKSB7XG4gICAgICAgICQoXCIueW91dHViZVwiKS5Zb3VUdWJlTW9kYWwoe1xuICAgICAgICAgICAgYXV0b3BsYXk6IDEsXG4gICAgICAgICAgICBhdXRvaGlkZTogMSxcbiAgICAgICAgICAgIHdpZHRoOiA4MjAsXG4gICAgICAgICAgICBoZWlnaHQ6IDUyMCxcbiAgICAgICAgICAgIHRoZW1lOiAnZGFyY2snXG4gICAgICAgIH0pO1xuICAgIH1cblxuICAgIC8vIHN0aWNreVxuICAgIGlmICgkKCcuc3RpY2t5JykubGVuZ3RoKSB7XG5cbiAgICAgICAgJCh3aW5kb3cpLm9uKCdzY3JvbGwnLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgd2luZG93VG9wID0gJCh3aW5kb3cpLnNjcm9sbFRvcCgpO1xuICAgICAgICAgICAgaWYgKHdpbmRvd1RvcCA+IDY4KSB7XG4gICAgICAgICAgICAgICAgJCgnLnN0aWNreScpLmFkZENsYXNzKCdmaXhlZCcpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKCcuc3RpY2t5JykucmVtb3ZlQ2xhc3MoJ2ZpeGVkJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuXG5cbi8vICAgICAgICB2YXIgc3RpY2t5ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnN0aWNreScpO1xuLy8gICAgICAgIHZhciBvcmlnT2Zmc2V0WSA9ICghc3RpY2t5Lm9mZnNldFRvcCkgPyA2OCA6IHN0aWNreS5vZmZzZXRUb3A7XG4vL1xuLy8gICAgICAgIGZ1bmN0aW9uIG9uU2Nyb2xsKGUpIHtcbi8vICAgICAgICAgICAgd2luZG93LnNjcm9sbFkgPj0gb3JpZ09mZnNldFkgPyBzdGlja3kuY2xhc3NMaXN0LmFkZCgnZml4ZWQnKSA6XG4vLyAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0aWNreS5jbGFzc0xpc3QucmVtb3ZlKCdmaXhlZCcpO1xuLy9cbi8vICAgICAgICAgICAgY29uc29sZS5sb2cod2luZG93LnNjcm9sbFkrJyA9ICcrIG9yaWdPZmZzZXRZKTtcbi8vICAgICAgICB9XG4vL1xuLy8gICAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ3Njcm9sbCcsIG9uU2Nyb2xsKTtcbiAgICB9XG4gICAgLyokKFwiLmJsb2Nrcy1zdGlja3lcIikuYXV0b2ZpeF9hbnl0aGluZyh7XG4gICAgIGN1c3RvbU9mZnNldDogZmFsc2UsIC8vIFlvdSBjYW4gZGVmaW5lIGN1c3RvbSBvZmZzZXQgZm9yIHdoZW4geW91IHdhbnQgdGhlIGNvbnRhaW5lciB0byBiZSBmaXhlZC4gVGhpcyBvcHRpb24gdGFrZXMgdGhlIG51bWJlciBvZiBwaXhlbHMgZnJvbSB0aGUgdG9wIG9mIHRoZSBwYWdlLiBUaGUgZGVmYXVsdCB2YWx1ZSBpcyBmYWxzZSB3aGljaCB0aGUgcGx1Z2luIHdpbGwgYXV0b21hdGljYWxseSBmaXggdGhlIGNvbnRhaW5lciB3aGVuIHRoZSBpdCBpcyBpbiB0aGUgdmlld3BvcnRcbiAgICAgbWFudWFsOiBmYWxzZSwgLy8gVG9nZ2xlIHRoaXMgdG8gdHJ1ZSBpZiB5b3Ugd2lzaCB0byBtYW51YWxseSBmaXggY29udGFpbmVycyB3aXRoIHRoZSBwdWJsaWMgbWV0aG9kLiBEZWZhdWx0IHZhbHVlIGlzIGZhbHNlXG4gICAgIG9ubHlJbkNvbnRhaW5lcjogdHJ1ZSAvLyBTZXQgdGhpcyB0byBmYWxzZSBpZiB5b3UgZG9uJ3Qgd2FudCB0aGUgZml4ZWQgY29udGFpbmVyIHRvIGxpbWl0IGl0c2VsZiB0byB0aGUgcGFyZW50J3MgY29udGFpbmVyLlxuICAgICB9KTtcbiAgICAgKi9cblxuICAgIC8qXG4gICAgIGlmKCQoXCIucGhvbmUtc3RpY2t5XCIpLmxlbmd0aCkge1xuXG4gICAgIGlmKCQoXCIucGhvbmUtc3RpY2t5XCIpLmlzKCc6dmlzaWJsZScpKSB7XG5cbiAgICAgJCh3aW5kb3cpLm9uKCdzY3JvbGwnLCBmdW5jdGlvbigpIHtcbiAgICAgdmFyIHdpbmRvd1RvcCA9ICQod2luZG93KS5zY3JvbGxUb3AoKTtcbiAgICAgaWYod2luZG93VG9wID4gNjgpIHtcbiAgICAgJChcIi5waG9uZS1zdGlja3lcIikuY3NzKHsncG9zaXRpb24nOiAnZml4ZWQnfSk7XG4gICAgIH0gZWxzZSB7XG4gICAgICQoXCIucGhvbmUtc3RpY2t5XCIpLmNzcyh7J3Bvc2l0aW9uJzogJ3N0YXRpYyd9KTtcbiAgICAgfVxuICAgICB9KTtcblxuICAgICB9XG5cbiAgICAgfVxuICAgICAqL1xuXG4gICAgLypcbiAgICAgJCgnYSNvcGVuQnRuVmlkZW8nKS5jbGljayhmdW5jdGlvbihlKXtcbiAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICB2YXIgc3JjID0gJCh0aGlzKS5hdHRyKCdkYXRhLXNyYycpO1xuICAgICB2YXIgaGVpZ2h0ID0gJCh0aGlzKS5hdHRyKCdkYXRhLWhlaWdodCcpIHx8IDUyMDtcbiAgICAgdmFyIHdpZHRoID0gJCh0aGlzKS5hdHRyKCdkYXRhLXdpZHRoJykgfHwgODIwO1xuXG4gICAgIHZhciBwX3cgPSBwYXJzZUludCggd2lkdGggKSArIDE1O1xuICAgICB2YXIgcF9oID0gcGFyc2VJbnQoIGhlaWdodCApICsgMjU7XG5cbiAgICAgLy8gJChcIiNteU1vZGFsIC5tb2RhbC1kaWFsb2dcIikuY3NzKHsnbWF4LXdpZHRoJzogcF93KydweCd9KTsgLy8gJ2hlaWdodCc6IHBfaCsncHgnXG4gICAgICQoXCIjbXlNb2RhbCAubW9kYWwtYm9keVwiKS5jc3MoeydtYXgtd2lkdGgnOiB3aWR0aCsncHgnLCAnaGVpZ2h0JzogaGVpZ2h0KydweCd9KTtcblxuICAgICAkKFwiI215TW9kYWwgaWZyYW1lXCIpLmF0dHIoeyAnaGVpZ2h0JzogaGVpZ2h0LFxuICAgICAnd2lkdGgnOiB3aWR0aH0pO1xuXG4gICAgICQoJyNteU1vZGFsJykub24oJ3Nob3duLmJzLm1vZGFsJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgJChcIiNteU1vZGFsIGlmcmFtZVwiKS5hdHRyKHsnc3JjJzpzcmN9KTtcbiAgICAgfSk7XG5cbiAgICAgJCgnI215TW9kYWwnKS5vbignaGlkZGVuLmJzLm1vZGFsJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgJChcIiNteU1vZGFsIGlmcmFtZVwiKS5hdHRyKHsnc3JjJzogJyMnfSk7XG4gICAgIH0pO1xuXG4gICAgICQoJyNteU1vZGFsJykubW9kYWwoe3Nob3c6dHJ1ZX0pO1xuICAgICByZXR1cm4gZmFsc2U7XG4gICAgIH0pO1xuXG4gICAgICQoJyNteU1vZGFsJykub24oJ3Nob3duLmJzLm1vZGFsJywgZnVuY3Rpb24gKGUpIHtcbiAgICAgfSk7XG4gICAgICQoJyNteU1vZGFsJykub24oJ2hpZGRlbi5icy5tb2RhbCcsIGZ1bmN0aW9uIChlKSB7XG4gICAgIH0pO1xuICAgICAqL1xuXG5cbi8vICAgICQoJ2Ejb3BlbkJ0blZpZGVvJykub24oJ2NsaWNrJywgZnVuY3Rpb24oZSkge1xuLy8gICAgICAgIHZhciBzcmMgPSAkKHRoaXMpLmF0dHIoJ2RhdGEtc3JjJyk7XG4vLyAgICAgICAgdmFyIGhlaWdodCA9ICQodGhpcykuYXR0cignZGF0YS1oZWlnaHQnKSB8fCA1MjA7XG4vLyAgICAgICAgdmFyIHdpZHRoID0gJCh0aGlzKS5hdHRyKCdkYXRhLXdpZHRoJykgfHwgODIwO1xuLy9cbi8vICAgICAgICB2YXIgcF93ID0gcGFyc2VJbnQoIHdpZHRoICkgKyAxNTtcbi8vICAgICAgICB2YXIgcF9oID0gcGFyc2VJbnQoIGhlaWdodCApICsgMjU7XG4vL1xuLy8gICAgICAgICQoXCIjbXlNb2RhbCAubW9kYWwtZGlhbG9nXCIpLmNzcyh7J3dpZHRoJzogcF93KydweCcsICdoZWlnaHQnOiBwX2grJ3B4J30pO1xuLy8gICAgICAgICQoXCIjbXlNb2RhbCAubW9kYWwtYm9keVwiKS5jc3Moeyd3aWR0aCc6IHdpZHRoKydweCcsICdoZWlnaHQnOiBoZWlnaHQrJ3B4J30pO1xuLy8gICAgICAgICQoXCIjbXlNb2RhbCBpZnJhbWVcIikuYXR0cih7J3NyYyc6c3JjLFxuLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2hlaWdodCc6IGhlaWdodCxcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd3aWR0aCc6IHdpZHRofSk7XG4vLyAgICB9KTtcblxuXG5cbi8vICAgICQod2luZG93KS5vbignbG9hZCByZXNpemUnLCBmdW5jdGlvbigpIHtcbi8vICAgICAgICAgY29uc29sZS5sb2coJCh0aGlzKS53aWR0aCgpKTtcbi8vICAgIH0pO1xuXG5cbiAgICAvLyBjb3VudHJpZXNcbiAgICAkKFwiI2MtZmVhdHVyZXMgLnJvdy1saXN0ID4gbGksIC5iLWhvdy1pdC13b3JrIGgzLndlaWdodC1ub3JtYWwsICNibG9jay1jb21wYXRpYmlsaXR5LXRhYmxlIC50YWJsZS1ib2R5ID4gZGl2ID4gcFwiKS5tYXRjaEhlaWdodCgpO1xuXG4gICAgaWYgKCQoJy5tYXRjaC1oZWlnaHQnKS5sZW5ndGgpXG4gICAgICAgICQoJy5tYXRjaC1oZWlnaHQnKS5tYXRjaEhlaWdodCgpO1xuXG4vLyAgICBpZigkKCcjYi1yZWNvbW1lbmRlZC1ieSAubWFpbi1ibG9jayA+IC5iLWl0ZW0nKS5sZW5ndGgpXG4vLyAgICAgICAgJCgnI2ItcmVjb21tZW5kZWQtYnkgLm1haW4tYmxvY2sgPiAuYi1pdGVtJykubWF0Y2hIZWlnaHQoKTtcblxuICAgICQuZm4ubWF0Y2hIZWlnaHQuX2JlZm9yZVVwZGF0ZSA9IGZ1bmN0aW9uIChldmVudCwgZ3JvdXBzKSB7XG5cbiAgICAgICAgLy8gZG8gc29tZXRoaW5nIGJlZm9yZSBhbnkgdXBkYXRlcyBhcmUgYXBwbGllZFxuICAgIH1cblxuICAgICQuZm4ubWF0Y2hIZWlnaHQuX2FmdGVyVXBkYXRlID0gZnVuY3Rpb24gKGV2ZW50LCBncm91cHMpIHtcbiAgICAgICAgLypcbiAgICAgICAgIGlmKCQoJyNiLXJlY29tbWVuZGVkLWJ5IC5tYWluLWJsb2NrID4gLmItaXRlbScpLmxlbmd0aClcbiAgICAgICAgICQoJyNiLXJlY29tbWVuZGVkLWJ5IC5tYWluLWJsb2NrID4gLmItaXRlbScpLmZpbmQoJ2xhYmxlLnRpdGxlJykuY3NzKHsnbGluZS1oZWlnaHQnOiAkKCcjYi1yZWNvbW1lbmRlZC1ieSAubWFpbi1ibG9jayA+IC5iLWl0ZW0nKS5oZWlnaHQoKSsncHgnfSk7XG4gICAgICAgICAqL1xuICAgICAgICAvLyBkbyBzb21ldGhpbmcgYWZ0ZXIgYWxsIHVwZGF0ZXMgYXJlIGFwcGxpZWRcbiAgICB9XG5cbiAgICBpZiAoJCgnLmJveF9jYXRlZ29yeSAubWludXMsIC5ib3hfY2F0ZWdvcnkgLnBsdXMnKS5sZW5ndGgpIHtcbiAgICAgICAgJCgnLmJveF9jYXRlZ29yeSAubWludXMsIC5ib3hfY2F0ZWdvcnkgLnBsdXMnKS5vbignY2xpY2snLCBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgnZGl2JykuZmluZCgnLmNvbGxhcHNlJykuY29sbGFwc2UoJ3RvZ2dsZScpO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICAkKCcuY29sbGFwc2UnKS5vbignc2hvd24uYnMuY29sbGFwc2UnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICBjb25zb2xlLmxvZygnU2hvdycpO1xuICAgICAgICBpZiAoJCh0aGlzKS5wYXJlbnQoJ2RpdicpLmZpbmQoJ2kucGx1cycpKSB7XG4gICAgICAgICAgICAkKHRoaXMpLnBhcmVudCgnZGl2JykuZmluZCgnaS5wbHVzJykucmVtb3ZlQ2xhc3MoJ3BsdXMnKS5hZGRDbGFzcygnbWludXMnKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgICQoJy5jb2xsYXBzZScpLm9uKCdoaWRkZW4uYnMuY29sbGFwc2UnLCBmdW5jdGlvbiAoZSkge1xuICAgICAgICBpZiAoJCh0aGlzKS5wYXJlbnQoJ2RpdicpLmZpbmQoJ2kubWludXMnKSkge1xuICAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoJ2RpdicpLmZpbmQoJ2kubWludXMnKS5yZW1vdmVDbGFzcygnbWludXMnKS5hZGRDbGFzcygncGx1cycpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbi8vICAgICQoZG9jdW1lbnQpLm9uKCdjbGljay5icy5jb2xsYXBzZS5kYXRhLWFwaScsICdbZGF0YS10b2dnbGU9XCJjb2xsYXBzZVwiXScsIGZ1bmN0aW9uKGUpIHtcbi8vICAgICAgIHZhciBfY2xhc3MgPSAkKHRoaXMpLnBhcmVudCgpLmF0dHIoJ2NsYXNzJyk7XG4vLyAgICAgICBpZihfY2xhc3MgPT0gJ3BsdXMnKSB7XG4vLyAgICAgICAgICAgJCh0aGlzKS5wYXJlbnQoJ2Rpdi5wbHVzJykuYXR0cignY2xhc3MnLCAnbWludXMnKTsgLy8gcmVtb3ZlQ2xhc3MoJ3BsdXMnKS5hZGRDbGFzcygnbWludXMnKTtcbi8vICAgICAgIH0gZWxzZSBpZihfY2xhc3MgPT0gJ21pbnVzJykge1xuLy8gICAgICAgICAgICQodGhpcykucGFyZW50KCdkaXYubWludXMnKS5hdHRyKCdjbGFzcycsICdwbHVzJyk7IC8vLnJlbW92ZUNsYXNzKCdtaW51cycpLmFkZENsYXNzKCdwbHVzJyk7XG4vLyAgICAgICB9XG4vL1xuLy8gICAgfSk7XG5cbiAgICBpZiAoJCgnLmJsb2NrLWNoaWxkLWxvY2F0aW9uLXRyYWNraW5nIC5mZWF0dXJlJykubGVuZ3RoKSB7XG4gICAgICAgICQod2luZG93KS5vbihcImxvYWQgcmVzaXplIG9yaWVudGF0aW9uY2hhbmdlXCIsIGZ1bmN0aW9uIChhKSB7XG4gICAgICAgICAgICBpZiAoJCh0aGlzKS53aWR0aCgpID4gOTkyKSB7XG4gICAgICAgICAgICAgICAgJCgnLmJsb2NrLWNoaWxkLWxvY2F0aW9uLXRyYWNraW5nIC5mZWF0dXJlJykuZWFjaChmdW5jdGlvbiAoa2V5LCBpdGVtKSB7XG4gICAgICAgICAgICAgICAgICAgICQoaXRlbSkuY3NzKHtcImRpc3BsYXlcIjogXCJpbmxpbmUtYmxvY2tcIiwgJ3dpZHRoJzogJ2F1dG8nfSk7XG4gICAgICAgICAgICAgICAgICAgICQoaXRlbSkuY3NzKHtcIndpZHRoXCI6ICgkKGl0ZW0pLndpZHRoKCkgKyA4MSkgKyBcInB4XCJ9KTtcbiAgICAgICAgICAgICAgICAgICAgJChpdGVtKS5jc3Moe1wiZGlzcGxheVwiOiBcImJsb2NrXCIsICdtYXJnaW4nOiAnMCBhdXRvJ30pO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKCcuYmxvY2stY2hpbGQtbG9jYXRpb24tdHJhY2tpbmcgLmZlYXR1cmUnKS5lYWNoKGZ1bmN0aW9uIChrZXksIGl0ZW0pIHtcbiAgICAgICAgICAgICAgICAgICAgJChpdGVtKS5jc3Moe1wiZGlzcGxheVwiOiBcImJsb2NrXCIsICdtYXJnaW4nOiAnMCBhdXRvJywgJ3dpZHRoJzogJ2F1dG8nfSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cblxuXG4gICAgLy8g0Y/QutC+0YDQuCDQtNC70Y8g0LvQuNC/0LrQvtCz0L4g0LzQtdC90Y5cbiAgICAkKCdhLmFuY2hvci1tZW51LWZseScpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGUpIHtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB2YXIgYW5jaG9yID0gJCh0aGlzKS5hdHRyKCdocmVmJykuc3BsaXQoJyMnKTtcbiAgICAgICAgaWYgKGFuY2hvci5sZW5ndGggPiAxKSB7XG4gICAgICAgICAgICB2YXIgX3RvcCA9ICQoJyMnICsgYW5jaG9yWzFdKS5vZmZzZXQoKS50b3AgLSAkKCcjYmxvY2stc3RpY2t5YmFyJykuaGVpZ2h0KCk7XG4gICAgICAgICAgICAkKCdodG1sLCBib2R5Jykuc3RvcCgpLmFuaW1hdGUoe1xuICAgICAgICAgICAgICAgIHNjcm9sbFRvcDogX3RvcCArICdweCdcbiAgICAgICAgICAgIH0sIDEwMDApO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH0pO1xuXG4gICAgaWYgKCQoJy5idXktZm9ybS13aXRoLW9mZmVyJykuc2l6ZSgpKSB7XG4gICAgICAgIHZhciBzeW1ib2xzID0ge3VzZDogJyQnLCBldXI6ICfigqwnLCBnYnA6ICfCoycsIGNhZDogJyQnLCBhdWQ6ICckJ307XG5cbiAgICAgICAgdmFyIHVwZGF0ZVJhZGlvID0gZnVuY3Rpb24gKGlucHV0KSB7XG4gICAgICAgICAgICB2YXIgJGZvcm0gPSAkKGlucHV0KS5jbG9zZXN0KCdmb3JtJyk7XG5cbiAgICAgICAgICAgIHZhciBkYXRhID0gJChpbnB1dCkuZGF0YSgpO1xuXG4gICAgICAgICAgICB2YXIgb2ZmZXJFbmFibGVkID0gJGZvcm0uZmluZCgnaW5wdXRbdHlwZT1jaGVja2JveF1bbmFtZT1hbmRyb2lkLTQwb2ZmXVtkYXRhLWdyb3VwPScgKyBkYXRhLmdyb3VwICsgJ10nKS5pcygnOmNoZWNrZWQnKTtcbiAgICAgICAgICAgIHZhciAkb3B0aW9ucyA9ICQoJy5idXktZm9ybS13aXRoLW9mZmVyJykuZmluZCgnaW5wdXRbdHlwZT1yYWRpb11bZGF0YS1ncm91cD0nICsgZGF0YS5ncm91cCArICddW2RhdGEtcGVyaW9kPScgKyBkYXRhLnBlcmlvZCArICddJyk7XG5cbiAgICAgICAgICAgICRvcHRpb25zLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIHZhciBvcHRpb25EYXRhID0gJCh0aGlzKS5kYXRhKCk7XG5cbiAgICAgICAgICAgICAgICAkcHJvZHVjdEZpZWxkID0gJCh0aGlzKS5jbG9zZXN0KCdmb3JtJykuZmluZCgnaW5wdXQucHJvZHVjdF9wcmljZScpO1xuXG4gICAgICAgICAgICAgICAgaWYgKG9mZmVyRW5hYmxlZCkge1xuICAgICAgICAgICAgICAgICAgICAkcHJvZHVjdEZpZWxkLnZhbChvcHRpb25EYXRhLm9mZmVyUHJvZHVjdCk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgJHByb2R1Y3RGaWVsZC52YWwob3B0aW9uRGF0YS5wcm9kdWN0KTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAkKHRoaXMpLmNsb3Nlc3QoJ3VsJykuZmluZCgnbGFiZWwnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnJlbW92ZUNsYXNzKCdyX29uJylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcygncl9vZmYnKTtcblxuICAgICAgICAgICAgICAgICQodGhpcykuY2xvc2VzdCgnbGFiZWwnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmFkZENsYXNzKCdyX29uJylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcygncl9vZmYnKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZiAodHlwZW9mIGRhdGEudGFyZ2V0ICE9ICd1bmRlZmluZWQnKSB7XG5cbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudFZhbHVlID0gJChpbnB1dCkuYXR0cignZGF0YS1wcmljZS0nICsgZGF0YS5jdXIpIC8gTnVtYmVyKGRhdGEucGVyaW9kKTtcblxuICAgICAgICAgICAgICAgIGlmIChvZmZlckVuYWJsZWQpIHtcbiAgICAgICAgICAgICAgICAgICAgY3VycmVudFZhbHVlID0gJChpbnB1dCkuYXR0cignZGF0YS1vZmZlci1wcmljZS0nICsgZGF0YS5jdXIpIC8gTnVtYmVyKGRhdGEucGVyaW9kKTtcbiAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICB2YXIgZGlzcGxheVZhbHVlID0gKE1hdGguZmxvb3IoY3VycmVudFZhbHVlICogMTAwKSAvIDEwMCkudG9GaXhlZCgyKTtcblxuICAgICAgICAgICAgICAgICQoZGF0YS50YXJnZXQpLmh0bWwoZGlzcGxheVZhbHVlKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnByZXYoJ2Rpdi5zeW1ib2wnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmh0bWwoc3ltYm9sc1tkYXRhLmN1cl0gPyBzeW1ib2xzW2RhdGEuY3VyXSA6ICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICB2YXIgdXBkYXRlQ2hlY2tib3ggPSBmdW5jdGlvbiAoaW5wdXQpIHtcbiAgICAgICAgICAgIHZhciBkYXRhID0gJChpbnB1dCkuZGF0YSgpO1xuXG4gICAgICAgICAgICB2YXIgb2ZmZXJFbmFibGVkID0gJChpbnB1dCkuaXMoXCI6Y2hlY2tlZFwiKTtcblxuICAgICAgICAgICAgdmFyICRjaGVja2JveGVzID0gJCgnLmJ1eS1mb3JtLXdpdGgtb2ZmZXInKS5maW5kKCdpbnB1dFt0eXBlPWNoZWNrYm94XVtkYXRhLWdyb3VwPScgKyBkYXRhLmdyb3VwICsgJ10nKTtcblxuICAgICAgICAgICAgJGNoZWNrYm94ZXMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgdmFyICRmb3JtID0gJCh0aGlzKS5jbG9zZXN0KCdmb3JtJyk7XG5cbiAgICAgICAgICAgICAgICBpZiAob2ZmZXJFbmFibGVkKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmICghJCh0aGlzKS5pcyhcIjpjaGVja2VkXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnByb3AoJ2NoZWNrZWQnLCBvZmZlckVuYWJsZWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgJCgnLndyX3BhY2tfJyArIGRhdGEuZ3JvdXApLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgJCgnLndyX3BhY2tfZG91YmxlXycgKyBkYXRhLmdyb3VwKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgICRmb3JtLmZpbmQoJy5vZmZlcl9vbGRfcHJpY2UnKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgICRmb3JtLmZpbmQoJy5wYWNrYWdlX3ByaWNlJykuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAkZm9ybS5maW5kKCcucGFja2FnZV9vZmZlcl9wcmljZScpLnNob3coKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpZiAoJCh0aGlzKS5pcyhcIjpjaGVja2VkXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnByb3AoJ2NoZWNrZWQnLCBvZmZlckVuYWJsZWQpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgJCgnLndyX3BhY2tfZG91YmxlXycgKyBkYXRhLmdyb3VwKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICQoJy53cl9wYWNrXycgKyBkYXRhLmdyb3VwKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgICRmb3JtLmZpbmQoJy5vZmZlcl9vbGRfcHJpY2UnKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICRmb3JtLmZpbmQoJy5wYWNrYWdlX29mZmVyX3ByaWNlJykuaGlkZSgpO1xuICAgICAgICAgICAgICAgICAgICAkZm9ybS5maW5kKCcucGFja2FnZV9wcmljZScpLnNob3coKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgJChpbnB1dCkuY2xvc2VzdCgnZm9ybScpLmZpbmQoJ2lucHV0W3R5cGU9cmFkaW9dOmNoZWNrZWQnKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICB1cGRhdGVSYWRpbyh0aGlzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuXG4gICAgICAgICQoJy5idXktZm9ybS13aXRoLW9mZmVyIGlucHV0W3R5cGU9cmFkaW9dOmNoZWNrZWQnKS5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHVwZGF0ZVJhZGlvKHRoaXMpO1xuICAgICAgICB9KTtcblxuICAgICAgICAkKCcuYnV5LWZvcm0td2l0aC1vZmZlciBsYWJlbCcpLmhhcygnaW5wdXRbdHlwZT1yYWRpb10nKS5jbGljayhmdW5jdGlvbiAoZSkge1xuICAgICAgICAgICAgaWYgKGUudGFyZ2V0LnRhZ05hbWUgIT0gJ0lOUFVUJykge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgJGlucHV0ID0gJCh0aGlzKS5maW5kKCdpbnB1dDpmaXJzdCcpO1xuICAgICAgICAgICAgdXBkYXRlUmFkaW8oJGlucHV0KTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgJCgnLmJ1eS1mb3JtLXdpdGgtb2ZmZXIgaW5wdXRbdHlwZT1jaGVja2JveF0nKS5jaGFuZ2UoZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIHVwZGF0ZUNoZWNrYm94KHRoaXMpO1xuICAgICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKCQoJy5idXktZm9ybScpLnNpemUoKSkge1xuICAgICAgICB2YXIgc3ltYm9scyA9IHt1c2Q6ICckJywgZXVyOiAn4oKsJywgZ2JwOiAnwqMnLCBjYWQ6ICckJywgYXVkOiAnJCd9O1xuXG4gICAgICAgIHZhciB1cGRhdGVSYWRpbyA9IGZ1bmN0aW9uIChpbnB1dCkge1xuICAgICAgICAgICAgdmFyIGRhdGEgPSAkKGlucHV0KS5kYXRhKCk7XG5cbiAgICAgICAgICAgIHZhciAkaW5wdXRzID0gJCgnLmJ1eS1mb3JtJykuZmluZCgnaW5wdXRbZGF0YS1wZXJpb2Q9JyArIGRhdGEucGVyaW9kICsgJ11bZGF0YS1ncm91cD0nICsgZGF0YS5ncm91cCArICddJyk7XG5cbiAgICAgICAgICAgICRpbnB1dHMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgJHByb2R1Y3RGaWVsZCA9ICQodGhpcykuY2xvc2VzdCgnZm9ybScpLmZpbmQoJ2lucHV0LnByb2R1Y3RfcHJpY2UnKTtcblxuICAgICAgICAgICAgICAgICRwcm9kdWN0RmllbGQudmFsKCQodGhpcykudmFsKCkpO1xuXG4gICAgICAgICAgICAgICAgJCh0aGlzKS5jbG9zZXN0KCd1bCcpLmZpbmQoJ2xhYmVsJylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5yZW1vdmVDbGFzcygncl9vbicpXG4gICAgICAgICAgICAgICAgICAgICAgICAuYWRkQ2xhc3MoJ3Jfb2ZmJyk7XG5cbiAgICAgICAgICAgICAgICAkKHRoaXMpLmNsb3Nlc3QoJ2xhYmVsJylcbiAgICAgICAgICAgICAgICAgICAgICAgIC5hZGRDbGFzcygncl9vbicpXG4gICAgICAgICAgICAgICAgICAgICAgICAucmVtb3ZlQ2xhc3MoJ3Jfb2ZmJyk7XG4gICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgaWYgKHR5cGVvZiBkYXRhLnRhcmdldCAhPSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIHZhciBjdXJyZW50VmFsdWUgPSAkKGlucHV0KS5hdHRyKCdkYXRhLXByaWNlLScgKyBkYXRhLmN1cikgLyBOdW1iZXIoZGF0YS5wZXJpb2QpO1xuXG4gICAgICAgICAgICAgICAgY3VycmVudFZhbHVlID0gKE1hdGguZmxvb3IoY3VycmVudFZhbHVlICogMTAwKSAvIDEwMCkudG9GaXhlZCgyKTtcblxuICAgICAgICAgICAgICAgICQoZGF0YS50YXJnZXQpLmh0bWwoY3VycmVudFZhbHVlKVxuICAgICAgICAgICAgICAgICAgICAgICAgLnByZXYoJ2Rpdi5zeW1ib2wnKVxuICAgICAgICAgICAgICAgICAgICAgICAgLmh0bWwoc3ltYm9sc1tkYXRhLmN1cl0gPyBzeW1ib2xzW2RhdGEuY3VyXSA6ICcnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICAkKCcuYnV5LWZvcm0gaW5wdXQ6Y2hlY2tlZCcpLmVhY2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdXBkYXRlUmFkaW8odGhpcyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgICQoJy5idXktZm9ybSBsYWJlbCcpLmNsaWNrKGZ1bmN0aW9uIChlKSB7XG4gICAgICAgICAgICBpZiAoZS50YXJnZXQudGFnTmFtZSAhPSAnSU5QVVQnKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICB1cGRhdGVSYWRpbygkKHRoaXMpLmZpbmQoJ2lucHV0OmZpcnN0JykpO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgJChcImlucHV0W2RhdGEtY2hlY2tib3hlcz1hbmRyb2lkLTQwb2ZmLW1haW5dXCIpLmNsaWNrKGZ1bmN0aW9uKCl7XG4gICAgICAgICQoJ2lucHV0W25hbWU9YW5kcm9pZC00MG9mZl0nKS5hdHRyKCdjaGVja2VkJywgdGhpcy5jaGVja2VkKTtcbiAgICAgICAgLy8gaWYoJChcImlucHV0W25hbWU9YW5kcm9pZC00MG9mZl1cIikubGVuZ3RoID09ICQoXCJpbnB1dFtuYW1lPWFuZHJvaWQtNDBvZmZdOmNoZWNrZWRcIikubGVuZ3RoKSB7XG4gICAgICAgIC8vICAgICAkKFwiaW5wdXRbbmFtZT1hbmRyb2lkLTQwb2ZmXVwiKS5hdHRyKFwiY2hlY2tlZFwiLCBcImNoZWNrZWRcIik7XG4gICAgICAgIC8vIH0gZWxzZSB7XG4gICAgICAgIC8vICAgICAkKFwiaW5wdXRbbmFtZT1hbmRyb2lkLTQwb2ZmXVwiKS5yZW1vdmVBdHRyKFwiY2hlY2tlZFwiKTtcbiAgICAgICAgLy8gfVxuICAgICAgICB2YXIgJGlucHV0cyA9ICQoXCJpbnB1dFtuYW1lPWFuZHJvaWQtNDBvZmZdXCIpXG4gICAgICAgIC8vY29uc29sZS5sb2coJGlucHV0cylcbiAgICAgICAgJC5lYWNoKCRpbnB1dHMsIGZ1bmN0aW9uKCkge3VwZGF0ZUNoZWNrYm94KHRoaXMpfSlcbiAgICB9KTtcblx0XG5cdC8vc3RpY2t5IGhlYWRlclxuXG59KTtcbiIsIi8qXG4gKiBqUXVlcnkgaGFzaGNoYW5nZSBldmVudCAtIHYxLjMgLSA3LzIxLzIwMTBcbiAqIGh0dHA6Ly9iZW5hbG1hbi5jb20vcHJvamVjdHMvanF1ZXJ5LWhhc2hjaGFuZ2UtcGx1Z2luL1xuICogXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTAgXCJDb3dib3lcIiBCZW4gQWxtYW5cbiAqIER1YWwgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBhbmQgR1BMIGxpY2Vuc2VzLlxuICogaHR0cDovL2JlbmFsbWFuLmNvbS9hYm91dC9saWNlbnNlL1xuICovXG4oZnVuY3Rpb24oJCxlLGIpe3ZhciBjPVwiaGFzaGNoYW5nZVwiLGg9ZG9jdW1lbnQsZixnPSQuZXZlbnQuc3BlY2lhbCxpPWguZG9jdW1lbnRNb2RlLGQ9XCJvblwiK2MgaW4gZSYmKGk9PT1ifHxpPjcpO2Z1bmN0aW9uIGEoail7aj1qfHxsb2NhdGlvbi5ocmVmO3JldHVyblwiI1wiK2oucmVwbGFjZSgvXlteI10qIz8oLiopJC8sXCIkMVwiKX0kLmZuW2NdPWZ1bmN0aW9uKGope3JldHVybiBqP3RoaXMuYmluZChjLGopOnRoaXMudHJpZ2dlcihjKX07JC5mbltjXS5kZWxheT01MDtnW2NdPSQuZXh0ZW5kKGdbY10se3NldHVwOmZ1bmN0aW9uKCl7aWYoZCl7cmV0dXJuIGZhbHNlfSQoZi5zdGFydCl9LHRlYXJkb3duOmZ1bmN0aW9uKCl7aWYoZCl7cmV0dXJuIGZhbHNlfSQoZi5zdG9wKX19KTtmPShmdW5jdGlvbigpe3ZhciBqPXt9LHAsbT1hKCksaz1mdW5jdGlvbihxKXtyZXR1cm4gcX0sbD1rLG89aztqLnN0YXJ0PWZ1bmN0aW9uKCl7cHx8bigpfTtqLnN0b3A9ZnVuY3Rpb24oKXtwJiZjbGVhclRpbWVvdXQocCk7cD1ifTtmdW5jdGlvbiBuKCl7dmFyIHI9YSgpLHE9byhtKTtpZihyIT09bSl7bChtPXIscSk7JChlKS50cmlnZ2VyKGMpfWVsc2V7aWYocSE9PW0pe2xvY2F0aW9uLmhyZWY9bG9jYXRpb24uaHJlZi5yZXBsYWNlKC8jLiovLFwiXCIpK3F9fXA9c2V0VGltZW91dChuLCQuZm5bY10uZGVsYXkpfSQuc3VwcG9ydC5tc2llJiYhZCYmKGZ1bmN0aW9uKCl7dmFyIHEscjtqLnN0YXJ0PWZ1bmN0aW9uKCl7aWYoIXEpe3I9JC5mbltjXS5zcmM7cj1yJiZyK2EoKTtxPSQoJzxpZnJhbWUgdGFiaW5kZXg9XCItMVwiIHRpdGxlPVwiZW1wdHlcIi8+JykuaGlkZSgpLm9uZShcImxvYWRcIixmdW5jdGlvbigpe3J8fGwoYSgpKTtuKCl9KS5hdHRyKFwic3JjXCIscnx8XCJqYXZhc2NyaXB0OjBcIikuaW5zZXJ0QWZ0ZXIoXCJib2R5XCIpWzBdLmNvbnRlbnRXaW5kb3c7aC5vbnByb3BlcnR5Y2hhbmdlPWZ1bmN0aW9uKCl7dHJ5e2lmKGV2ZW50LnByb3BlcnR5TmFtZT09PVwidGl0bGVcIil7cS5kb2N1bWVudC50aXRsZT1oLnRpdGxlfX1jYXRjaChzKXt9fX19O2ouc3RvcD1rO289ZnVuY3Rpb24oKXtyZXR1cm4gYShxLmxvY2F0aW9uLmhyZWYpfTtsPWZ1bmN0aW9uKHYscyl7dmFyIHU9cS5kb2N1bWVudCx0PSQuZm5bY10uZG9tYWluO2lmKHYhPT1zKXt1LnRpdGxlPWgudGl0bGU7dS5vcGVuKCk7dCYmdS53cml0ZSgnPHNjcmlwdD5kb2N1bWVudC5kb21haW49XCInK3QrJ1wiPFxcL3NjcmlwdD4nKTt1LmNsb3NlKCk7cS5sb2NhdGlvbi5oYXNoPXZ9fX0pKCk7cmV0dXJuIGp9KSgpfSkoalF1ZXJ5LHRoaXMpOyIsIi8qIVxuICogalF1ZXJ5IENvb2tpZSBQbHVnaW4gdjEuMy4xXG4gKiBodHRwczovL2dpdGh1Yi5jb20vY2FyaGFydGwvanF1ZXJ5LWNvb2tpZVxuICpcbiAqIENvcHlyaWdodCAyMDEzIEtsYXVzIEhhcnRsXG4gKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2VcbiAqL1xuKGZ1bmN0aW9uIChmYWN0b3J5KSB7XG5cdGlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHtcblx0XHQvLyBBTUQuIFJlZ2lzdGVyIGFzIGFub255bW91cyBtb2R1bGUuXG5cdFx0ZGVmaW5lKFsnanF1ZXJ5J10sIGZhY3RvcnkpO1xuXHR9IGVsc2Uge1xuXHRcdC8vIEJyb3dzZXIgZ2xvYmFscy5cblx0XHRmYWN0b3J5KGpRdWVyeSk7XG5cdH1cbn0oZnVuY3Rpb24gKCQpIHtcblxuXHR2YXIgcGx1c2VzID0gL1xcKy9nO1xuXG5cdGZ1bmN0aW9uIHJhdyhzKSB7XG5cdFx0cmV0dXJuIHM7XG5cdH1cblxuXHRmdW5jdGlvbiBkZWNvZGVkKHMpIHtcblx0XHRyZXR1cm4gZGVjb2RlVVJJQ29tcG9uZW50KHMucmVwbGFjZShwbHVzZXMsICcgJykpO1xuXHR9XG5cblx0ZnVuY3Rpb24gY29udmVydGVkKHMpIHtcblx0XHRpZiAocy5pbmRleE9mKCdcIicpID09PSAwKSB7XG5cdFx0XHQvLyBUaGlzIGlzIGEgcXVvdGVkIGNvb2tpZSBhcyBhY2NvcmRpbmcgdG8gUkZDMjA2OCwgdW5lc2NhcGVcblx0XHRcdHMgPSBzLnNsaWNlKDEsIC0xKS5yZXBsYWNlKC9cXFxcXCIvZywgJ1wiJykucmVwbGFjZSgvXFxcXFxcXFwvZywgJ1xcXFwnKTtcblx0XHR9XG5cdFx0dHJ5IHtcblx0XHRcdHJldHVybiBjb25maWcuanNvbiA/IEpTT04ucGFyc2UocykgOiBzO1xuXHRcdH0gY2F0Y2goZXIpIHt9XG5cdH1cblxuXHR2YXIgY29uZmlnID0gJC5jb29raWUgPSBmdW5jdGlvbiAoa2V5LCB2YWx1ZSwgb3B0aW9ucykge1xuXG5cdFx0Ly8gd3JpdGVcblx0XHRpZiAodmFsdWUgIT09IHVuZGVmaW5lZCkge1xuXHRcdFx0b3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBjb25maWcuZGVmYXVsdHMsIG9wdGlvbnMpO1xuXG5cdFx0XHRpZiAodHlwZW9mIG9wdGlvbnMuZXhwaXJlcyA9PT0gJ251bWJlcicpIHtcblx0XHRcdFx0dmFyIGRheXMgPSBvcHRpb25zLmV4cGlyZXMsIHQgPSBvcHRpb25zLmV4cGlyZXMgPSBuZXcgRGF0ZSgpO1xuXHRcdFx0XHR0LnNldERhdGUodC5nZXREYXRlKCkgKyBkYXlzKTtcblx0XHRcdH1cblxuXHRcdFx0dmFsdWUgPSBjb25maWcuanNvbiA/IEpTT04uc3RyaW5naWZ5KHZhbHVlKSA6IFN0cmluZyh2YWx1ZSk7XG5cblx0XHRcdHJldHVybiAoZG9jdW1lbnQuY29va2llID0gW1xuXHRcdFx0XHRjb25maWcucmF3ID8ga2V5IDogZW5jb2RlVVJJQ29tcG9uZW50KGtleSksXG5cdFx0XHRcdCc9Jyxcblx0XHRcdFx0Y29uZmlnLnJhdyA/IHZhbHVlIDogZW5jb2RlVVJJQ29tcG9uZW50KHZhbHVlKSxcblx0XHRcdFx0b3B0aW9ucy5leHBpcmVzID8gJzsgZXhwaXJlcz0nICsgb3B0aW9ucy5leHBpcmVzLnRvVVRDU3RyaW5nKCkgOiAnJywgLy8gdXNlIGV4cGlyZXMgYXR0cmlidXRlLCBtYXgtYWdlIGlzIG5vdCBzdXBwb3J0ZWQgYnkgSUVcblx0XHRcdFx0b3B0aW9ucy5wYXRoICAgID8gJzsgcGF0aD0nICsgb3B0aW9ucy5wYXRoIDogJycsXG5cdFx0XHRcdG9wdGlvbnMuZG9tYWluICA/ICc7IGRvbWFpbj0nICsgb3B0aW9ucy5kb21haW4gOiAnJyxcblx0XHRcdFx0b3B0aW9ucy5zZWN1cmUgID8gJzsgc2VjdXJlJyA6ICcnXG5cdFx0XHRdLmpvaW4oJycpKTtcblx0XHR9XG5cblx0XHQvLyByZWFkXG5cdFx0dmFyIGRlY29kZSA9IGNvbmZpZy5yYXcgPyByYXcgOiBkZWNvZGVkO1xuXHRcdHZhciBjb29raWVzID0gZG9jdW1lbnQuY29va2llLnNwbGl0KCc7ICcpO1xuXHRcdHZhciByZXN1bHQgPSBrZXkgPyB1bmRlZmluZWQgOiB7fTtcblx0XHRmb3IgKHZhciBpID0gMCwgbCA9IGNvb2tpZXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG5cdFx0XHR2YXIgcGFydHMgPSBjb29raWVzW2ldLnNwbGl0KCc9Jyk7XG5cdFx0XHR2YXIgbmFtZSA9IGRlY29kZShwYXJ0cy5zaGlmdCgpKTtcblx0XHRcdHZhciBjb29raWUgPSBkZWNvZGUocGFydHMuam9pbignPScpKTtcblxuXHRcdFx0aWYgKGtleSAmJiBrZXkgPT09IG5hbWUpIHtcblx0XHRcdFx0cmVzdWx0ID0gY29udmVydGVkKGNvb2tpZSk7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0fVxuXG5cdFx0XHRpZiAoIWtleSkge1xuXHRcdFx0XHRyZXN1bHRbbmFtZV0gPSBjb252ZXJ0ZWQoY29va2llKTtcblx0XHRcdH1cblx0XHR9XG5cblx0XHRyZXR1cm4gcmVzdWx0O1xuXHR9O1xuXG5cdGNvbmZpZy5kZWZhdWx0cyA9IHt9O1xuXG5cdCQucmVtb3ZlQ29va2llID0gZnVuY3Rpb24gKGtleSwgb3B0aW9ucykge1xuXHRcdGlmICgkLmNvb2tpZShrZXkpICE9PSB1bmRlZmluZWQpIHtcblx0XHRcdC8vIE11c3Qgbm90IGFsdGVyIG9wdGlvbnMsIHRodXMgZXh0ZW5kaW5nIGEgZnJlc2ggb2JqZWN0Li4uXG5cdFx0XHQkLmNvb2tpZShrZXksICcnLCAkLmV4dGVuZCh7fSwgb3B0aW9ucywgeyBleHBpcmVzOiAtMSB9KSk7XG5cdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHR9XG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9O1xuXG59KSk7XG4iLCIvL2h0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTIyMTQ2NTQvanF1ZXJ5LTEtOC1maW5kLWV2ZW50LWhhbmRsZXJzXG4vL2h0dHA6Ly9qYW1lcy5wYWRvbHNleS5jb20vamF2YXNjcmlwdC9kZWJ1Zy1qcXVlcnktZXZlbnRzLXdpdGgtbGlzdGhhbmRsZXJzL1xuLy8gJCgnKicpLmxpc3RIYW5kbGVycygnKicpO1xuLy8gJCgnYScpLmxpc3RIYW5kbGVycygnb25jbGljaycpO1xuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKXtcbiAgICAkLmZuLmxpc3RIYW5kbGVycyA9IGZ1bmN0aW9uKGV2ZW50cykge1xuICAgICAgICB0aGlzLmVhY2goZnVuY3Rpb24oaSl7XG4gICAgICAgICAgICB2YXIgZWxlbSA9IHRoaXMsXG4gICAgICAgICAgICAvLyBkRXZlbnRzID0gJCh0aGlzKS5kYXRhKCdldmVudHMnKTtcbiAgICAgICAgICAgIGRFdmVudHMgPSAkLl9kYXRhKCQodGhpcykuZ2V0KDApLCBcImV2ZW50c1wiKTtcbiAgICAgICAgICAgIGlmICghZEV2ZW50cykge3JldHVybjt9XG4gICAgICAgICAgICAkLmVhY2goZEV2ZW50cywgZnVuY3Rpb24obmFtZSwgaGFuZGxlcil7XG4gICAgICAgICAgICAgICAgaWYoKG5ldyBSZWdFeHAoJ14oJyArIChldmVudHMgPT09ICcqJyA/ICcuKycgOiBldmVudHMucmVwbGFjZSgnLCcsJ3wnKS5yZXBsYWNlKC9eb24vaSwnJykpICsgJykkJyAsJ2knKSkudGVzdChuYW1lKSkge1xuICAgICAgICAgICAgICAgICAgICAkLmVhY2goaGFuZGxlcixcbiAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKGksaGFuZGxlcil7XG4gICAgICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUuaW5mbyhlbGVtKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhlbGVtLCAnXFxuJyArIGkgKyAnOiBbJyArIG5hbWUgKyAnXSA6ICcgKyBoYW5kbGVyLmhhbmRsZXIgKTtcbiAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSk7XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgXG4gICAgJC5mbi5oYXNIYW5kbGVycyA9IGZ1bmN0aW9uKGV2ZW50cyxzZWxlY3Rvcikge1xuICAgICAgICB2YXIgcmVzdWx0PWZhbHNlO1xuICAgICAgICB0aGlzLmVhY2goZnVuY3Rpb24oaSl7XG4gICAgICAgICAgICB2YXIgZWxlbSA9IHRoaXM7XG4gICAgICAgICAgICBkRXZlbnRzID0gJC5fZGF0YSgkKHRoaXMpLmdldCgwKSwgXCJldmVudHNcIik7XG4gICAgICAgICAgICBpZiAoIWRFdmVudHMpIHtyZXR1cm4gZmFsc2U7fVxuICAgICAgICAgICAgJC5lYWNoKGRFdmVudHMsIGZ1bmN0aW9uKG5hbWUsIGhhbmRsZXIpe1xuICAgICAgICAgICAgICAgIGlmKChuZXcgUmVnRXhwKCdeKCcgKyAoZXZlbnRzID09PSAnKicgPyAnLisnIDogZXZlbnRzLnJlcGxhY2UoJywnLCd8JykucmVwbGFjZSgvXm9uL2ksJycpKSArICcpJCcgLCdpJykpLnRlc3QobmFtZSkpIHtcbiAgICAgICAgICAgICAgICAkLmVhY2goaGFuZGxlcixcbiAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24oaSxoYW5kbGVyKXtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChoYW5kbGVyLnNlbGVjdG9yPT09c2VsZWN0b3IpXG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQ9dHJ1ZTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcbiAgICB9O1xufSk7ICIsIi8qKlxuKiBqcXVlcnkubWF0Y2hIZWlnaHQtbWluLmpzIG1hc3RlclxuKiBodHRwOi8vYnJtLmlvL2pxdWVyeS1tYXRjaC1oZWlnaHQvXG4qIExpY2Vuc2U6IE1JVFxuKi9cbihmdW5jdGlvbihjKXt2YXIgbj0tMSxmPS0xLGc9ZnVuY3Rpb24oYSl7cmV0dXJuIHBhcnNlRmxvYXQoYSl8fDB9LHI9ZnVuY3Rpb24oYSl7dmFyIGI9bnVsbCxkPVtdO2MoYSkuZWFjaChmdW5jdGlvbigpe3ZhciBhPWModGhpcyksaz1hLm9mZnNldCgpLnRvcC1nKGEuY3NzKFwibWFyZ2luLXRvcFwiKSksbD0wPGQubGVuZ3RoP2RbZC5sZW5ndGgtMV06bnVsbDtudWxsPT09bD9kLnB1c2goYSk6MT49TWF0aC5mbG9vcihNYXRoLmFicyhiLWspKT9kW2QubGVuZ3RoLTFdPWwuYWRkKGEpOmQucHVzaChhKTtiPWt9KTtyZXR1cm4gZH0scD1mdW5jdGlvbihhKXt2YXIgYj17YnlSb3c6ITAscHJvcGVydHk6XCJoZWlnaHRcIix0YXJnZXQ6bnVsbCxyZW1vdmU6ITF9O2lmKFwib2JqZWN0XCI9PT10eXBlb2YgYSlyZXR1cm4gYy5leHRlbmQoYixhKTtcImJvb2xlYW5cIj09PXR5cGVvZiBhP2IuYnlSb3c9YTpcInJlbW92ZVwiPT09YSYmKGIucmVtb3ZlPSEwKTtyZXR1cm4gYn0sYj1jLmZuLm1hdGNoSGVpZ2h0PVxuZnVuY3Rpb24oYSl7YT1wKGEpO2lmKGEucmVtb3ZlKXt2YXIgZT10aGlzO3RoaXMuY3NzKGEucHJvcGVydHksXCJcIik7Yy5lYWNoKGIuX2dyb3VwcyxmdW5jdGlvbihhLGIpe2IuZWxlbWVudHM9Yi5lbGVtZW50cy5ub3QoZSl9KTtyZXR1cm4gdGhpc31pZigxPj10aGlzLmxlbmd0aCYmIWEudGFyZ2V0KXJldHVybiB0aGlzO2IuX2dyb3Vwcy5wdXNoKHtlbGVtZW50czp0aGlzLG9wdGlvbnM6YX0pO2IuX2FwcGx5KHRoaXMsYSk7cmV0dXJuIHRoaXN9O2IuX2dyb3Vwcz1bXTtiLl90aHJvdHRsZT04MDtiLl9tYWludGFpblNjcm9sbD0hMTtiLl9iZWZvcmVVcGRhdGU9bnVsbDtiLl9hZnRlclVwZGF0ZT1udWxsO2IuX2FwcGx5PWZ1bmN0aW9uKGEsZSl7dmFyIGQ9cChlKSxoPWMoYSksaz1baF0sbD1jKHdpbmRvdykuc2Nyb2xsVG9wKCksZj1jKFwiaHRtbFwiKS5vdXRlckhlaWdodCghMCksbT1oLnBhcmVudHMoKS5maWx0ZXIoXCI6aGlkZGVuXCIpO20uZWFjaChmdW5jdGlvbigpe3ZhciBhPWModGhpcyk7XG5hLmRhdGEoXCJzdHlsZS1jYWNoZVwiLGEuYXR0cihcInN0eWxlXCIpKX0pO20uY3NzKFwiZGlzcGxheVwiLFwiYmxvY2tcIik7ZC5ieVJvdyYmIWQudGFyZ2V0JiYoaC5lYWNoKGZ1bmN0aW9uKCl7dmFyIGE9Yyh0aGlzKSxiPWEuY3NzKFwiZGlzcGxheVwiKTtcImlubGluZS1ibG9ja1wiIT09YiYmXCJpbmxpbmUtZmxleFwiIT09YiYmKGI9XCJibG9ja1wiKTthLmRhdGEoXCJzdHlsZS1jYWNoZVwiLGEuYXR0cihcInN0eWxlXCIpKTthLmNzcyh7ZGlzcGxheTpiLFwicGFkZGluZy10b3BcIjpcIjBcIixcInBhZGRpbmctYm90dG9tXCI6XCIwXCIsXCJtYXJnaW4tdG9wXCI6XCIwXCIsXCJtYXJnaW4tYm90dG9tXCI6XCIwXCIsXCJib3JkZXItdG9wLXdpZHRoXCI6XCIwXCIsXCJib3JkZXItYm90dG9tLXdpZHRoXCI6XCIwXCIsaGVpZ2h0OlwiMTAwcHhcIn0pfSksaz1yKGgpLGguZWFjaChmdW5jdGlvbigpe3ZhciBhPWModGhpcyk7YS5hdHRyKFwic3R5bGVcIixhLmRhdGEoXCJzdHlsZS1jYWNoZVwiKXx8XCJcIil9KSk7Yy5lYWNoKGssZnVuY3Rpb24oYSxiKXt2YXIgZT1jKGIpLFxuZj0wO2lmKGQudGFyZ2V0KWY9ZC50YXJnZXQub3V0ZXJIZWlnaHQoITEpO2Vsc2V7aWYoZC5ieVJvdyYmMT49ZS5sZW5ndGgpe2UuY3NzKGQucHJvcGVydHksXCJcIik7cmV0dXJufWUuZWFjaChmdW5jdGlvbigpe3ZhciBhPWModGhpcyksYj1hLmNzcyhcImRpc3BsYXlcIik7XCJpbmxpbmUtYmxvY2tcIiE9PWImJlwiaW5saW5lLWZsZXhcIiE9PWImJihiPVwiYmxvY2tcIik7Yj17ZGlzcGxheTpifTtiW2QucHJvcGVydHldPVwiXCI7YS5jc3MoYik7YS5vdXRlckhlaWdodCghMSk+ZiYmKGY9YS5vdXRlckhlaWdodCghMSkpO2EuY3NzKFwiZGlzcGxheVwiLFwiXCIpfSl9ZS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGE9Yyh0aGlzKSxiPTA7ZC50YXJnZXQmJmEuaXMoZC50YXJnZXQpfHwoXCJib3JkZXItYm94XCIhPT1hLmNzcyhcImJveC1zaXppbmdcIikmJihiKz1nKGEuY3NzKFwiYm9yZGVyLXRvcC13aWR0aFwiKSkrZyhhLmNzcyhcImJvcmRlci1ib3R0b20td2lkdGhcIikpLGIrPWcoYS5jc3MoXCJwYWRkaW5nLXRvcFwiKSkrZyhhLmNzcyhcInBhZGRpbmctYm90dG9tXCIpKSksXG5hLmNzcyhkLnByb3BlcnR5LGYtYitcInB4XCIpKX0pfSk7bS5lYWNoKGZ1bmN0aW9uKCl7dmFyIGE9Yyh0aGlzKTthLmF0dHIoXCJzdHlsZVwiLGEuZGF0YShcInN0eWxlLWNhY2hlXCIpfHxudWxsKX0pO2IuX21haW50YWluU2Nyb2xsJiZjKHdpbmRvdykuc2Nyb2xsVG9wKGwvZipjKFwiaHRtbFwiKS5vdXRlckhlaWdodCghMCkpO3JldHVybiB0aGlzfTtiLl9hcHBseURhdGFBcGk9ZnVuY3Rpb24oKXt2YXIgYT17fTtjKFwiW2RhdGEtbWF0Y2gtaGVpZ2h0XSwgW2RhdGEtbWhdXCIpLmVhY2goZnVuY3Rpb24oKXt2YXIgYj1jKHRoaXMpLGQ9Yi5hdHRyKFwiZGF0YS1taFwiKXx8Yi5hdHRyKFwiZGF0YS1tYXRjaC1oZWlnaHRcIik7YVtkXT1kIGluIGE/YVtkXS5hZGQoYik6Yn0pO2MuZWFjaChhLGZ1bmN0aW9uKCl7dGhpcy5tYXRjaEhlaWdodCghMCl9KX07dmFyIHE9ZnVuY3Rpb24oYSl7Yi5fYmVmb3JlVXBkYXRlJiZiLl9iZWZvcmVVcGRhdGUoYSxiLl9ncm91cHMpO2MuZWFjaChiLl9ncm91cHMsZnVuY3Rpb24oKXtiLl9hcHBseSh0aGlzLmVsZW1lbnRzLFxudGhpcy5vcHRpb25zKX0pO2IuX2FmdGVyVXBkYXRlJiZiLl9hZnRlclVwZGF0ZShhLGIuX2dyb3Vwcyl9O2IuX3VwZGF0ZT1mdW5jdGlvbihhLGUpe2lmKGUmJlwicmVzaXplXCI9PT1lLnR5cGUpe3ZhciBkPWMod2luZG93KS53aWR0aCgpO2lmKGQ9PT1uKXJldHVybjtuPWR9YT8tMT09PWYmJihmPXNldFRpbWVvdXQoZnVuY3Rpb24oKXtxKGUpO2Y9LTF9LGIuX3Rocm90dGxlKSk6cShlKX07YyhiLl9hcHBseURhdGFBcGkpO2Mod2luZG93KS5iaW5kKFwibG9hZFwiLGZ1bmN0aW9uKGEpe2IuX3VwZGF0ZSghMSxhKX0pO2Mod2luZG93KS5iaW5kKFwicmVzaXplIG9yaWVudGF0aW9uY2hhbmdlXCIsZnVuY3Rpb24oYSl7Yi5fdXBkYXRlKCEwLGEpfSl9KShqUXVlcnkpOyIsIi8qKlxuKiBzaW1wbGVQYWdpbmF0aW9uLmpzIHYxLjZcbiogQSBzaW1wbGUgalF1ZXJ5IHBhZ2luYXRpb24gcGx1Z2luLlxuKiBodHRwOi8vZmxhdml1c21hdGlzLmdpdGh1Yi5jb20vc2ltcGxlUGFnaW5hdGlvbi5qcy9cbipcbiogQ29weXJpZ2h0IDIwMTIsIEZsYXZpdXMgTWF0aXNcbiogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlLlxuKiBodHRwOi8vZmxhdml1c21hdGlzLmdpdGh1Yi5jb20vbGljZW5zZS5odG1sXG4qL1xuXG4oZnVuY3Rpb24oJCl7XG5cblx0dmFyIG1ldGhvZHMgPSB7XG5cdFx0aW5pdDogZnVuY3Rpb24ob3B0aW9ucykge1xuXHRcdFx0dmFyIG8gPSAkLmV4dGVuZCh7XG5cdFx0XHRcdGl0ZW1zOiAxLFxuXHRcdFx0XHRpdGVtc09uUGFnZTogMSxcblx0XHRcdFx0cGFnZXM6IDAsXG5cdFx0XHRcdGRpc3BsYXllZFBhZ2VzOiA1LFxuXHRcdFx0XHRlZGdlczogMixcblx0XHRcdFx0Y3VycmVudFBhZ2U6IDAsXG5cdFx0XHRcdGhyZWZUZXh0UHJlZml4OiAnI3BhZ2U9Jyxcblx0XHRcdFx0aHJlZlRleHRTdWZmaXg6ICcnLFxuXHRcdFx0XHRwcmV2VGV4dDogJ1ByZXYnLFxuXHRcdFx0XHRuZXh0VGV4dDogJ05leHQnLFxuXHRcdFx0XHRlbGxpcHNlVGV4dDogJyZoZWxsaXA7Jyxcblx0XHRcdFx0Y3NzU3R5bGU6ICdsaWdodC10aGVtZScsXG5cdFx0XHRcdGxhYmVsTWFwOiBbXSxcblx0XHRcdFx0c2VsZWN0T25DbGljazogdHJ1ZSxcblx0XHRcdFx0bmV4dEF0RnJvbnQ6IGZhbHNlLFxuXHRcdFx0XHRpbnZlcnRQYWdlT3JkZXI6IGZhbHNlLFxuXHRcdFx0XHR1c2VTdGFydEVkZ2UgOiB0cnVlLFxuXHRcdFx0XHR1c2VFbmRFZGdlIDogdHJ1ZSxcblx0XHRcdFx0b25QYWdlQ2xpY2s6IGZ1bmN0aW9uKHBhZ2VOdW1iZXIsIGV2ZW50KSB7XG5cdFx0XHRcdFx0Ly8gQ2FsbGJhY2sgdHJpZ2dlcmVkIHdoZW4gYSBwYWdlIGlzIGNsaWNrZWRcblx0XHRcdFx0XHQvLyBQYWdlIG51bWJlciBpcyBnaXZlbiBhcyBhbiBvcHRpb25hbCBwYXJhbWV0ZXJcblx0XHRcdFx0fSxcblx0XHRcdFx0b25Jbml0OiBmdW5jdGlvbigpIHtcblx0XHRcdFx0XHQvLyBDYWxsYmFjayB0cmlnZ2VyZWQgaW1tZWRpYXRlbHkgYWZ0ZXIgaW5pdGlhbGl6YXRpb25cblx0XHRcdFx0fVxuXHRcdFx0fSwgb3B0aW9ucyB8fCB7fSk7XG5cblx0XHRcdHZhciBzZWxmID0gdGhpcztcblxuXHRcdFx0by5wYWdlcyA9IG8ucGFnZXMgPyBvLnBhZ2VzIDogTWF0aC5jZWlsKG8uaXRlbXMgLyBvLml0ZW1zT25QYWdlKSA/IE1hdGguY2VpbChvLml0ZW1zIC8gby5pdGVtc09uUGFnZSkgOiAxO1xuXHRcdFx0aWYgKG8uY3VycmVudFBhZ2UpXG5cdFx0XHRcdG8uY3VycmVudFBhZ2UgPSBvLmN1cnJlbnRQYWdlIC0gMTtcblx0XHRcdGVsc2Vcblx0XHRcdFx0by5jdXJyZW50UGFnZSA9ICFvLmludmVydFBhZ2VPcmRlciA/IDAgOiBvLnBhZ2VzIC0gMTtcblx0XHRcdG8uaGFsZkRpc3BsYXllZCA9IG8uZGlzcGxheWVkUGFnZXMgLyAyO1xuXG5cdFx0XHR0aGlzLmVhY2goZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHNlbGYuYWRkQ2xhc3Moby5jc3NTdHlsZSArICcgc2ltcGxlLXBhZ2luYXRpb24nKS5kYXRhKCdwYWdpbmF0aW9uJywgbyk7XG5cdFx0XHRcdG1ldGhvZHMuX2RyYXcuY2FsbChzZWxmKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRvLm9uSW5pdCgpO1xuXG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXG5cdFx0c2VsZWN0UGFnZTogZnVuY3Rpb24ocGFnZSkge1xuXHRcdFx0bWV0aG9kcy5fc2VsZWN0UGFnZS5jYWxsKHRoaXMsIHBhZ2UgLSAxKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cblx0XHRwcmV2UGFnZTogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgbyA9IHRoaXMuZGF0YSgncGFnaW5hdGlvbicpO1xuXHRcdFx0aWYgKCFvLmludmVydFBhZ2VPcmRlcikge1xuXHRcdFx0XHRpZiAoby5jdXJyZW50UGFnZSA+IDApIHtcblx0XHRcdFx0XHRtZXRob2RzLl9zZWxlY3RQYWdlLmNhbGwodGhpcywgby5jdXJyZW50UGFnZSAtIDEpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpZiAoby5jdXJyZW50UGFnZSA8IG8ucGFnZXMgLSAxKSB7XG5cdFx0XHRcdFx0bWV0aG9kcy5fc2VsZWN0UGFnZS5jYWxsKHRoaXMsIG8uY3VycmVudFBhZ2UgKyAxKTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblxuXHRcdG5leHRQYWdlOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBvID0gdGhpcy5kYXRhKCdwYWdpbmF0aW9uJyk7XG5cdFx0XHRpZiAoIW8uaW52ZXJ0UGFnZU9yZGVyKSB7XG5cdFx0XHRcdGlmIChvLmN1cnJlbnRQYWdlIDwgby5wYWdlcyAtIDEpIHtcblx0XHRcdFx0XHRtZXRob2RzLl9zZWxlY3RQYWdlLmNhbGwodGhpcywgby5jdXJyZW50UGFnZSArIDEpO1xuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpZiAoby5jdXJyZW50UGFnZSA+IDApIHtcblx0XHRcdFx0XHRtZXRob2RzLl9zZWxlY3RQYWdlLmNhbGwodGhpcywgby5jdXJyZW50UGFnZSAtIDEpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXG5cdFx0Z2V0UGFnZXNDb3VudDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5kYXRhKCdwYWdpbmF0aW9uJykucGFnZXM7XG5cdFx0fSxcblxuXHRcdGdldEN1cnJlbnRQYWdlOiBmdW5jdGlvbiAoKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5kYXRhKCdwYWdpbmF0aW9uJykuY3VycmVudFBhZ2UgKyAxO1xuXHRcdH0sXG5cblx0XHRkZXN0cm95OiBmdW5jdGlvbigpe1xuXHRcdFx0dGhpcy5lbXB0eSgpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblxuXHRcdGRyYXdQYWdlOiBmdW5jdGlvbiAocGFnZSkge1xuXHRcdFx0dmFyIG8gPSB0aGlzLmRhdGEoJ3BhZ2luYXRpb24nKTtcblx0XHRcdG8uY3VycmVudFBhZ2UgPSBwYWdlIC0gMTtcblx0XHRcdHRoaXMuZGF0YSgncGFnaW5hdGlvbicsIG8pO1xuXHRcdFx0bWV0aG9kcy5fZHJhdy5jYWxsKHRoaXMpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblxuXHRcdHJlZHJhdzogZnVuY3Rpb24oKXtcblx0XHRcdG1ldGhvZHMuX2RyYXcuY2FsbCh0aGlzKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cblx0XHRkaXNhYmxlOiBmdW5jdGlvbigpe1xuXHRcdFx0dmFyIG8gPSB0aGlzLmRhdGEoJ3BhZ2luYXRpb24nKTtcblx0XHRcdG8uZGlzYWJsZWQgPSB0cnVlO1xuXHRcdFx0dGhpcy5kYXRhKCdwYWdpbmF0aW9uJywgbyk7XG5cdFx0XHRtZXRob2RzLl9kcmF3LmNhbGwodGhpcyk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXG5cdFx0ZW5hYmxlOiBmdW5jdGlvbigpe1xuXHRcdFx0dmFyIG8gPSB0aGlzLmRhdGEoJ3BhZ2luYXRpb24nKTtcblx0XHRcdG8uZGlzYWJsZWQgPSBmYWxzZTtcblx0XHRcdHRoaXMuZGF0YSgncGFnaW5hdGlvbicsIG8pO1xuXHRcdFx0bWV0aG9kcy5fZHJhdy5jYWxsKHRoaXMpO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblxuXHRcdHVwZGF0ZUl0ZW1zOiBmdW5jdGlvbiAobmV3SXRlbXMpIHtcblx0XHRcdHZhciBvID0gdGhpcy5kYXRhKCdwYWdpbmF0aW9uJyk7XG5cdFx0XHRvLml0ZW1zID0gbmV3SXRlbXM7XG5cdFx0XHRvLnBhZ2VzID0gbWV0aG9kcy5fZ2V0UGFnZXMobyk7XG5cdFx0XHR0aGlzLmRhdGEoJ3BhZ2luYXRpb24nLCBvKTtcblx0XHRcdG1ldGhvZHMuX2RyYXcuY2FsbCh0aGlzKTtcblx0XHR9LFxuXG5cdFx0dXBkYXRlSXRlbXNPblBhZ2U6IGZ1bmN0aW9uIChpdGVtc09uUGFnZSkge1xuXHRcdFx0dmFyIG8gPSB0aGlzLmRhdGEoJ3BhZ2luYXRpb24nKTtcblx0XHRcdG8uaXRlbXNPblBhZ2UgPSBpdGVtc09uUGFnZTtcblx0XHRcdG8ucGFnZXMgPSBtZXRob2RzLl9nZXRQYWdlcyhvKTtcblx0XHRcdHRoaXMuZGF0YSgncGFnaW5hdGlvbicsIG8pO1xuXHRcdFx0bWV0aG9kcy5fc2VsZWN0UGFnZS5jYWxsKHRoaXMsIDApO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblxuXHRcdF9kcmF3OiBmdW5jdGlvbigpIHtcblx0XHRcdHZhclx0byA9IHRoaXMuZGF0YSgncGFnaW5hdGlvbicpLFxuXHRcdFx0XHRpbnRlcnZhbCA9IG1ldGhvZHMuX2dldEludGVydmFsKG8pLFxuXHRcdFx0XHRpLFxuXHRcdFx0XHR0YWdOYW1lO1xuXG5cdFx0XHRtZXRob2RzLmRlc3Ryb3kuY2FsbCh0aGlzKTtcblx0XHRcdFxuXHRcdFx0dGFnTmFtZSA9ICh0eXBlb2YgdGhpcy5wcm9wID09PSAnZnVuY3Rpb24nKSA/IHRoaXMucHJvcCgndGFnTmFtZScpIDogdGhpcy5hdHRyKCd0YWdOYW1lJyk7XG5cblx0XHRcdHZhciAkcGFuZWwgPSB0YWdOYW1lID09PSAnVUwnID8gdGhpcyA6ICQoJzx1bCBjbGFzcz1cInBhZ2luYXRpb25cIj48L3VsPicpLmFwcGVuZFRvKHRoaXMpO1xuXG5cdFx0XHQvLyBHZW5lcmF0ZSBQcmV2IGxpbmtcblx0XHRcdGlmIChvLnByZXZUZXh0KSB7XG5cdFx0XHRcdG1ldGhvZHMuX2FwcGVuZEl0ZW0uY2FsbCh0aGlzLCAhby5pbnZlcnRQYWdlT3JkZXIgPyBvLmN1cnJlbnRQYWdlIC0gMSA6IG8uY3VycmVudFBhZ2UgKyAxLCB7dGV4dDogby5wcmV2VGV4dCwgY2xhc3NlczogJ3ByZXYnfSk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIEdlbmVyYXRlIE5leHQgbGluayAoaWYgb3B0aW9uIHNldCBmb3IgYXQgZnJvbnQpXG5cdFx0XHRpZiAoby5uZXh0VGV4dCAmJiBvLm5leHRBdEZyb250KSB7XG5cdFx0XHRcdG1ldGhvZHMuX2FwcGVuZEl0ZW0uY2FsbCh0aGlzLCAhby5pbnZlcnRQYWdlT3JkZXIgPyBvLmN1cnJlbnRQYWdlICsgMSA6IG8uY3VycmVudFBhZ2UgLSAxLCB7dGV4dDogby5uZXh0VGV4dCwgY2xhc3NlczogJ25leHQnfSk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIEdlbmVyYXRlIHN0YXJ0IGVkZ2VzXG5cdFx0XHRpZiAoIW8uaW52ZXJ0UGFnZU9yZGVyKSB7XG5cdFx0XHRcdGlmIChpbnRlcnZhbC5zdGFydCA+IDAgJiYgby5lZGdlcyA+IDApIHtcblx0XHRcdFx0XHRpZihvLnVzZVN0YXJ0RWRnZSkge1xuXHRcdFx0XHRcdFx0dmFyIGVuZCA9IE1hdGgubWluKG8uZWRnZXMsIGludGVydmFsLnN0YXJ0KTtcblx0XHRcdFx0XHRcdGZvciAoaSA9IDA7IGkgPCBlbmQ7IGkrKykge1xuXHRcdFx0XHRcdFx0XHRtZXRob2RzLl9hcHBlbmRJdGVtLmNhbGwodGhpcywgaSk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdGlmIChvLmVkZ2VzIDwgaW50ZXJ2YWwuc3RhcnQgJiYgKGludGVydmFsLnN0YXJ0IC0gby5lZGdlcyAhPSAxKSkge1xuXHRcdFx0XHRcdFx0JHBhbmVsLmFwcGVuZCgnPGxpIGNsYXNzPVwiZGlzYWJsZWRcIj48c3BhbiBjbGFzcz1cImVsbGlwc2VcIj4nICsgby5lbGxpcHNlVGV4dCArICc8L3NwYW4+PC9saT4nKTtcblx0XHRcdFx0XHR9IGVsc2UgaWYgKGludGVydmFsLnN0YXJ0IC0gby5lZGdlcyA9PSAxKSB7XG5cdFx0XHRcdFx0XHRtZXRob2RzLl9hcHBlbmRJdGVtLmNhbGwodGhpcywgby5lZGdlcyk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRpZiAoaW50ZXJ2YWwuZW5kIDwgby5wYWdlcyAmJiBvLmVkZ2VzID4gMCkge1xuXHRcdFx0XHRcdGlmKG8udXNlU3RhcnRFZGdlKSB7XG5cdFx0XHRcdFx0XHR2YXIgYmVnaW4gPSBNYXRoLm1heChvLnBhZ2VzIC0gby5lZGdlcywgaW50ZXJ2YWwuZW5kKTtcblx0XHRcdFx0XHRcdGZvciAoaSA9IG8ucGFnZXMgLSAxOyBpID49IGJlZ2luOyBpLS0pIHtcblx0XHRcdFx0XHRcdFx0bWV0aG9kcy5fYXBwZW5kSXRlbS5jYWxsKHRoaXMsIGkpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmIChvLnBhZ2VzIC0gby5lZGdlcyA+IGludGVydmFsLmVuZCAmJiAoby5wYWdlcyAtIG8uZWRnZXMgLSBpbnRlcnZhbC5lbmQgIT0gMSkpIHtcblx0XHRcdFx0XHRcdCRwYW5lbC5hcHBlbmQoJzxsaSBjbGFzcz1cImRpc2FibGVkXCI+PHNwYW4gY2xhc3M9XCJlbGxpcHNlXCI+JyArIG8uZWxsaXBzZVRleHQgKyAnPC9zcGFuPjwvbGk+Jyk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmIChvLnBhZ2VzIC0gby5lZGdlcyAtIGludGVydmFsLmVuZCA9PSAxKSB7XG5cdFx0XHRcdFx0XHRtZXRob2RzLl9hcHBlbmRJdGVtLmNhbGwodGhpcywgaW50ZXJ2YWwuZW5kKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly8gR2VuZXJhdGUgaW50ZXJ2YWwgbGlua3Ncblx0XHRcdGlmICghby5pbnZlcnRQYWdlT3JkZXIpIHtcblx0XHRcdFx0Zm9yIChpID0gaW50ZXJ2YWwuc3RhcnQ7IGkgPCBpbnRlcnZhbC5lbmQ7IGkrKykge1xuXHRcdFx0XHRcdG1ldGhvZHMuX2FwcGVuZEl0ZW0uY2FsbCh0aGlzLCBpKTtcblx0XHRcdFx0fVxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Zm9yIChpID0gaW50ZXJ2YWwuZW5kIC0gMTsgaSA+PSBpbnRlcnZhbC5zdGFydDsgaS0tKSB7XG5cdFx0XHRcdFx0bWV0aG9kcy5fYXBwZW5kSXRlbS5jYWxsKHRoaXMsIGkpO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vIEdlbmVyYXRlIGVuZCBlZGdlc1xuXHRcdFx0aWYgKCFvLmludmVydFBhZ2VPcmRlcikge1xuXHRcdFx0XHRpZiAoaW50ZXJ2YWwuZW5kIDwgby5wYWdlcyAmJiBvLmVkZ2VzID4gMCkge1xuXHRcdFx0XHRcdGlmIChvLnBhZ2VzIC0gby5lZGdlcyA+IGludGVydmFsLmVuZCAmJiAoby5wYWdlcyAtIG8uZWRnZXMgLSBpbnRlcnZhbC5lbmQgIT0gMSkpIHtcblx0XHRcdFx0XHRcdCRwYW5lbC5hcHBlbmQoJzxsaSBjbGFzcz1cImRpc2FibGVkXCI+PHNwYW4gY2xhc3M9XCJlbGxpcHNlXCI+JyArIG8uZWxsaXBzZVRleHQgKyAnPC9zcGFuPjwvbGk+Jyk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmIChvLnBhZ2VzIC0gby5lZGdlcyAtIGludGVydmFsLmVuZCA9PSAxKSB7XG5cdFx0XHRcdFx0XHRtZXRob2RzLl9hcHBlbmRJdGVtLmNhbGwodGhpcywgaW50ZXJ2YWwuZW5kKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0aWYoby51c2VFbmRFZGdlKSB7XG5cdFx0XHRcdFx0XHR2YXIgYmVnaW4gPSBNYXRoLm1heChvLnBhZ2VzIC0gby5lZGdlcywgaW50ZXJ2YWwuZW5kKTtcblx0XHRcdFx0XHRcdGZvciAoaSA9IGJlZ2luOyBpIDwgby5wYWdlczsgaSsrKSB7XG5cdFx0XHRcdFx0XHRcdG1ldGhvZHMuX2FwcGVuZEl0ZW0uY2FsbCh0aGlzLCBpKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdGlmIChpbnRlcnZhbC5zdGFydCA+IDAgJiYgby5lZGdlcyA+IDApIHtcblx0XHRcdFx0XHRpZiAoby5lZGdlcyA8IGludGVydmFsLnN0YXJ0ICYmIChpbnRlcnZhbC5zdGFydCAtIG8uZWRnZXMgIT0gMSkpIHtcblx0XHRcdFx0XHRcdCRwYW5lbC5hcHBlbmQoJzxsaSBjbGFzcz1cImRpc2FibGVkXCI+PHNwYW4gY2xhc3M9XCJlbGxpcHNlXCI+JyArIG8uZWxsaXBzZVRleHQgKyAnPC9zcGFuPjwvbGk+Jyk7XG5cdFx0XHRcdFx0fSBlbHNlIGlmIChpbnRlcnZhbC5zdGFydCAtIG8uZWRnZXMgPT0gMSkge1xuXHRcdFx0XHRcdFx0bWV0aG9kcy5fYXBwZW5kSXRlbS5jYWxsKHRoaXMsIG8uZWRnZXMpO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmKG8udXNlRW5kRWRnZSkge1xuXHRcdFx0XHRcdFx0dmFyIGVuZCA9IE1hdGgubWluKG8uZWRnZXMsIGludGVydmFsLnN0YXJ0KTtcblx0XHRcdFx0XHRcdGZvciAoaSA9IGVuZCAtIDE7IGkgPj0gMDsgaS0tKSB7XG5cdFx0XHRcdFx0XHRcdG1ldGhvZHMuX2FwcGVuZEl0ZW0uY2FsbCh0aGlzLCBpKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly8gR2VuZXJhdGUgTmV4dCBsaW5rICh1bmxlc3Mgb3B0aW9uIGlzIHNldCBmb3IgYXQgZnJvbnQpXG5cdFx0XHRpZiAoby5uZXh0VGV4dCAmJiAhby5uZXh0QXRGcm9udCkge1xuXHRcdFx0XHRtZXRob2RzLl9hcHBlbmRJdGVtLmNhbGwodGhpcywgIW8uaW52ZXJ0UGFnZU9yZGVyID8gby5jdXJyZW50UGFnZSArIDEgOiBvLmN1cnJlbnRQYWdlIC0gMSwge3RleHQ6IG8ubmV4dFRleHQsIGNsYXNzZXM6ICduZXh0J30pO1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHRfZ2V0UGFnZXM6IGZ1bmN0aW9uKG8pIHtcblx0XHRcdHZhciBwYWdlcyA9IE1hdGguY2VpbChvLml0ZW1zIC8gby5pdGVtc09uUGFnZSk7XG5cdFx0XHRyZXR1cm4gcGFnZXMgfHwgMTtcblx0XHR9LFxuXG5cdFx0X2dldEludGVydmFsOiBmdW5jdGlvbihvKSB7XG5cdFx0XHRyZXR1cm4ge1xuXHRcdFx0XHRzdGFydDogTWF0aC5jZWlsKG8uY3VycmVudFBhZ2UgPiBvLmhhbGZEaXNwbGF5ZWQgPyBNYXRoLm1heChNYXRoLm1pbihvLmN1cnJlbnRQYWdlIC0gby5oYWxmRGlzcGxheWVkLCAoby5wYWdlcyAtIG8uZGlzcGxheWVkUGFnZXMpKSwgMCkgOiAwKSxcblx0XHRcdFx0ZW5kOiBNYXRoLmNlaWwoby5jdXJyZW50UGFnZSA+IG8uaGFsZkRpc3BsYXllZCA/IE1hdGgubWluKG8uY3VycmVudFBhZ2UgKyBvLmhhbGZEaXNwbGF5ZWQsIG8ucGFnZXMpIDogTWF0aC5taW4oby5kaXNwbGF5ZWRQYWdlcywgby5wYWdlcykpXG5cdFx0XHR9O1xuXHRcdH0sXG5cblx0XHRfYXBwZW5kSXRlbTogZnVuY3Rpb24ocGFnZUluZGV4LCBvcHRzKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXMsIG9wdGlvbnMsICRsaW5rLCBvID0gc2VsZi5kYXRhKCdwYWdpbmF0aW9uJyksICRsaW5rV3JhcHBlciA9ICQoJzxsaT48L2xpPicpLCAkdWwgPSBzZWxmLmZpbmQoJ3VsJyk7XG5cblx0XHRcdHBhZ2VJbmRleCA9IHBhZ2VJbmRleCA8IDAgPyAwIDogKHBhZ2VJbmRleCA8IG8ucGFnZXMgPyBwYWdlSW5kZXggOiBvLnBhZ2VzIC0gMSk7XG5cblx0XHRcdG9wdGlvbnMgPSB7XG5cdFx0XHRcdHRleHQ6IHBhZ2VJbmRleCArIDEsXG5cdFx0XHRcdGNsYXNzZXM6ICcnXG5cdFx0XHR9O1xuXG5cdFx0XHRpZiAoby5sYWJlbE1hcC5sZW5ndGggJiYgby5sYWJlbE1hcFtwYWdlSW5kZXhdKSB7XG5cdFx0XHRcdG9wdGlvbnMudGV4dCA9IG8ubGFiZWxNYXBbcGFnZUluZGV4XTtcblx0XHRcdH1cblxuXHRcdFx0b3B0aW9ucyA9ICQuZXh0ZW5kKG9wdGlvbnMsIG9wdHMgfHwge30pO1xuXG5cdFx0XHRpZiAocGFnZUluZGV4ID09IG8uY3VycmVudFBhZ2UgfHwgby5kaXNhYmxlZCkge1xuXHRcdFx0XHRpZiAoby5kaXNhYmxlZCkge1xuXHRcdFx0XHRcdCRsaW5rV3JhcHBlci5hZGRDbGFzcygnZGlzYWJsZWQnKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHQkbGlua1dyYXBwZXIuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdCRsaW5rID0gJCgnPHNwYW4gY2xhc3M9XCJjdXJyZW50XCI+JyArIChvcHRpb25zLnRleHQpICsgJzwvc3Bhbj4nKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCRsaW5rID0gJCgnPGEgaHJlZj1cIicgKyBvLmhyZWZUZXh0UHJlZml4ICsgKHBhZ2VJbmRleCArIDEpICsgby5ocmVmVGV4dFN1ZmZpeCArICdcIiBjbGFzcz1cInBhZ2UtbGlua1wiPicgKyAob3B0aW9ucy50ZXh0KSArICc8L2E+Jyk7XG5cdFx0XHRcdCRsaW5rLmNsaWNrKGZ1bmN0aW9uKGV2ZW50KXtcblx0XHRcdFx0XHRyZXR1cm4gbWV0aG9kcy5fc2VsZWN0UGFnZS5jYWxsKHNlbGYsIHBhZ2VJbmRleCwgZXZlbnQpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKG9wdGlvbnMuY2xhc3Nlcykge1xuXHRcdFx0XHQkbGluay5hZGRDbGFzcyhvcHRpb25zLmNsYXNzZXMpO1xuXHRcdFx0fVxuXG5cdFx0XHQkbGlua1dyYXBwZXIuYXBwZW5kKCRsaW5rKTtcblxuXHRcdFx0aWYgKCR1bC5sZW5ndGgpIHtcblx0XHRcdFx0JHVsLmFwcGVuZCgkbGlua1dyYXBwZXIpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0c2VsZi5hcHBlbmQoJGxpbmtXcmFwcGVyKTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0X3NlbGVjdFBhZ2U6IGZ1bmN0aW9uKHBhZ2VJbmRleCwgZXZlbnQpIHtcblx0XHRcdHZhciBvID0gdGhpcy5kYXRhKCdwYWdpbmF0aW9uJyk7XG5cdFx0XHRvLmN1cnJlbnRQYWdlID0gcGFnZUluZGV4O1xuXHRcdFx0aWYgKG8uc2VsZWN0T25DbGljaykge1xuXHRcdFx0XHRtZXRob2RzLl9kcmF3LmNhbGwodGhpcyk7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gby5vblBhZ2VDbGljayhwYWdlSW5kZXggKyAxLCBldmVudCk7XG5cdFx0fVxuXG5cdH07XG5cblx0JC5mbi5wYWdpbmF0aW9uID0gZnVuY3Rpb24obWV0aG9kKSB7XG5cblx0XHQvLyBNZXRob2QgY2FsbGluZyBsb2dpY1xuXHRcdGlmIChtZXRob2RzW21ldGhvZF0gJiYgbWV0aG9kLmNoYXJBdCgwKSAhPSAnXycpIHtcblx0XHRcdHJldHVybiBtZXRob2RzW21ldGhvZF0uYXBwbHkodGhpcywgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSk7XG5cdFx0fSBlbHNlIGlmICh0eXBlb2YgbWV0aG9kID09PSAnb2JqZWN0JyB8fCAhbWV0aG9kKSB7XG5cdFx0XHRyZXR1cm4gbWV0aG9kcy5pbml0LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdCQuZXJyb3IoJ01ldGhvZCAnICsgIG1ldGhvZCArICcgZG9lcyBub3QgZXhpc3Qgb24galF1ZXJ5LnBhZ2luYXRpb24nKTtcblx0XHR9XG5cblx0fTtcblxufSkoalF1ZXJ5KTtcbiIsIi8qXG4gKiBUb3RhbFN0b3JhZ2VcbiAqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTIgSmFyZWQgTm92YWNrICYgVXBzdGF0ZW1lbnQgKHVwc3RhdGVtZW50LmNvbSlcbiAqIER1YWwgbGljZW5zZWQgdW5kZXIgdGhlIE1JVCBhbmQgR1BMIGxpY2Vuc2VzOlxuICogaHR0cDovL3d3dy5vcGVuc291cmNlLm9yZy9saWNlbnNlcy9taXQtbGljZW5zZS5waHBcbiAqIGh0dHA6Ly93d3cuZ251Lm9yZy9saWNlbnNlcy9ncGwuaHRtbFxuICpcbiAqIFRvdGFsIFN0b3JhZ2UgaXMgdGhlIGNvbmNlcHR1YWwgdGhlIGxvdmUgY2hpbGQgb2YgalN0b3JhZ2UgYnkgQW5kcmlzIFJlaW5tYW4sIFxuICogYW5kIENvb2tpZSBieSBLbGF1cyBIYXJ0bCAtLSB0aG91Z2ggdGhpcyBpcyBub3QgY29ubmVjdGVkIHRvIGVpdGhlciBwcm9qZWN0LlxuICpcbiAqIEBuYW1lICQudG90YWxTdG9yYWdlXG4gKiBAY2F0IFBsdWdpbnMvQ29va2llXG4gKiBAYXV0aG9yIEphcmVkIE5vdmFjay9qYXJlZEB1cHN0YXRlbWVudC5jb21cbiAqIEB2ZXJzaW9uIDEuMS4yXG4gKiBAdXJsIGh0dHA6Ly91cHN0YXRlbWVudC5jb20vYmxvZy8yMDEyLzAxL2pxdWVyeS1sb2NhbC1zdG9yYWdlLWRvbmUtcmlnaHQtYW5kLWVhc3kvXG4gKi9cblxuKGZ1bmN0aW9uKGMpe3ZhciBlPXdpbmRvdy5sb2NhbFN0b3JhZ2UsZjtmPVwidW5kZWZpbmVkXCI9PXR5cGVvZiBlfHxcInVuZGVmaW5lZFwiPT10eXBlb2Ygd2luZG93LkpTT04/ITE6ITA7Yy50b3RhbFN0b3JhZ2U9ZnVuY3Rpb24oYixhKXtyZXR1cm4gYy50b3RhbFN0b3JhZ2UuaW1wbC5pbml0KGIsYSl9O2MudG90YWxTdG9yYWdlLnNldEl0ZW09ZnVuY3Rpb24oYixhKXtyZXR1cm4gYy50b3RhbFN0b3JhZ2UuaW1wbC5zZXRJdGVtKGIsYSl9O2MudG90YWxTdG9yYWdlLmdldEl0ZW09ZnVuY3Rpb24oYil7cmV0dXJuIGMudG90YWxTdG9yYWdlLmltcGwuZ2V0SXRlbShiKX07Yy50b3RhbFN0b3JhZ2UuZ2V0QWxsPWZ1bmN0aW9uKCl7cmV0dXJuIGMudG90YWxTdG9yYWdlLmltcGwuZ2V0QWxsKCl9O2MudG90YWxTdG9yYWdlLmRlbGV0ZUl0ZW09ZnVuY3Rpb24oYil7cmV0dXJuIGMudG90YWxTdG9yYWdlLmltcGwuZGVsZXRlSXRlbShiKX07Yy50b3RhbFN0b3JhZ2UuaW1wbD17aW5pdDpmdW5jdGlvbihiLCBhKXtyZXR1cm5cInVuZGVmaW5lZFwiIT10eXBlb2YgYT90aGlzLnNldEl0ZW0oYixhKTp0aGlzLmdldEl0ZW0oYil9LHNldEl0ZW06ZnVuY3Rpb24oYixhKXtpZighZil0cnl7cmV0dXJuIGMuY29va2llKGIsYSksYX1jYXRjaChkKXtjb25zb2xlLmxvZyhcIkxvY2FsIFN0b3JhZ2Ugbm90IHN1cHBvcnRlZCBieSB0aGlzIGJyb3dzZXIuIEluc3RhbGwgdGhlIGNvb2tpZSBwbHVnaW4gb24geW91ciBzaXRlIHRvIHRha2UgYWR2YW50YWdlIG9mIHRoZSBzYW1lIGZ1bmN0aW9uYWxpdHkuIFlvdSBjYW4gZ2V0IGl0IGF0IGh0dHBzOi8vZ2l0aHViLmNvbS9jYXJoYXJ0bC9qcXVlcnktY29va2llXCIpfXZhciBnPUpTT04uc3RyaW5naWZ5KGEpO2Uuc2V0SXRlbShiLGcpO3JldHVybiB0aGlzLnBhcnNlUmVzdWx0KGcpfSxnZXRJdGVtOmZ1bmN0aW9uKGIpe2lmKCFmKXRyeXtyZXR1cm4gdGhpcy5wYXJzZVJlc3VsdChjLmNvb2tpZShiKSl9Y2F0Y2goYSl7cmV0dXJuIG51bGx9cmV0dXJuIHRoaXMucGFyc2VSZXN1bHQoZS5nZXRJdGVtKGIpKX0sIGRlbGV0ZUl0ZW06ZnVuY3Rpb24oYil7aWYoIWYpdHJ5e3JldHVybiBjLmNvb2tpZShiLG51bGwpLCEwfWNhdGNoKGEpe3JldHVybiExfWUucmVtb3ZlSXRlbShiKTtyZXR1cm4hMH0sZ2V0QWxsOmZ1bmN0aW9uKCl7dmFyIGI9W107aWYoZilmb3IoZCBpbiBlKWQubGVuZ3RoJiZiLnB1c2goe2tleTpkLHZhbHVlOnRoaXMucGFyc2VSZXN1bHQoZS5nZXRJdGVtKGQpKX0pO2Vsc2UgdHJ5e2Zvcih2YXIgYT1kb2N1bWVudC5jb29raWUuc3BsaXQoXCI7XCIpLGQ9MDtkPGEubGVuZ3RoO2QrKyl7dmFyIGc9YVtkXS5zcGxpdChcIj1cIilbMF07Yi5wdXNoKHtrZXk6Zyx2YWx1ZTp0aGlzLnBhcnNlUmVzdWx0KGMuY29va2llKGcpKX0pfX1jYXRjaChoKXtyZXR1cm4gbnVsbH1yZXR1cm4gYn0scGFyc2VSZXN1bHQ6ZnVuY3Rpb24oYil7dmFyIGE7dHJ5e2E9SlNPTi5wYXJzZShiKSxcInRydWVcIj09YSYmKGE9ITApLFwiZmFsc2VcIj09YSYmKGE9ITEpLHBhcnNlRmxvYXQoYSk9PWEmJlwib2JqZWN0XCIhPXR5cGVvZiBhJiYgKGE9cGFyc2VGbG9hdChhKSl9Y2F0Y2goYyl7fXJldHVybiBhfX19KShqUXVlcnkpOyIsIi8qIVxuICogalF1ZXJ5IFZhbGlkYXRpb24gUGx1Z2luIHYxLjEzLjFcbiAqXG4gKiBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvXG4gKlxuICogQ29weXJpZ2h0IChjKSAyMDE0IErDtnJuIFphZWZmZXJlclxuICogUmVsZWFzZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlXG4gKi9cbihmdW5jdGlvbiggZmFjdG9yeSApIHtcblx0aWYgKCB0eXBlb2YgZGVmaW5lID09PSBcImZ1bmN0aW9uXCIgJiYgZGVmaW5lLmFtZCApIHtcblx0XHRkZWZpbmUoIFtcImpxdWVyeVwiXSwgZmFjdG9yeSApO1xuXHR9IGVsc2Uge1xuXHRcdGZhY3RvcnkoIGpRdWVyeSApO1xuXHR9XG59KGZ1bmN0aW9uKCAkICkge1xuXG4kLmV4dGVuZCgkLmZuLCB7XG5cdC8vIGh0dHA6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy92YWxpZGF0ZS9cblx0dmFsaWRhdGU6IGZ1bmN0aW9uKCBvcHRpb25zICkge1xuXG5cdFx0Ly8gaWYgbm90aGluZyBpcyBzZWxlY3RlZCwgcmV0dXJuIG5vdGhpbmc7IGNhbid0IGNoYWluIGFueXdheVxuXHRcdGlmICggIXRoaXMubGVuZ3RoICkge1xuXHRcdFx0aWYgKCBvcHRpb25zICYmIG9wdGlvbnMuZGVidWcgJiYgd2luZG93LmNvbnNvbGUgKSB7XG5cdFx0XHRcdGNvbnNvbGUud2FybiggXCJOb3RoaW5nIHNlbGVjdGVkLCBjYW4ndCB2YWxpZGF0ZSwgcmV0dXJuaW5nIG5vdGhpbmcuXCIgKTtcblx0XHRcdH1cblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHQvLyBjaGVjayBpZiBhIHZhbGlkYXRvciBmb3IgdGhpcyBmb3JtIHdhcyBhbHJlYWR5IGNyZWF0ZWRcblx0XHR2YXIgdmFsaWRhdG9yID0gJC5kYXRhKCB0aGlzWyAwIF0sIFwidmFsaWRhdG9yXCIgKTtcblx0XHRpZiAoIHZhbGlkYXRvciApIHtcblx0XHRcdHJldHVybiB2YWxpZGF0b3I7XG5cdFx0fVxuXG5cdFx0Ly8gQWRkIG5vdmFsaWRhdGUgdGFnIGlmIEhUTUw1LlxuXHRcdHRoaXMuYXR0ciggXCJub3ZhbGlkYXRlXCIsIFwibm92YWxpZGF0ZVwiICk7XG5cblx0XHR2YWxpZGF0b3IgPSBuZXcgJC52YWxpZGF0b3IoIG9wdGlvbnMsIHRoaXNbIDAgXSApO1xuXHRcdCQuZGF0YSggdGhpc1sgMCBdLCBcInZhbGlkYXRvclwiLCB2YWxpZGF0b3IgKTtcblxuXHRcdGlmICggdmFsaWRhdG9yLnNldHRpbmdzLm9uc3VibWl0ICkge1xuXG5cdFx0XHR0aGlzLnZhbGlkYXRlRGVsZWdhdGUoIFwiOnN1Ym1pdFwiLCBcImNsaWNrXCIsIGZ1bmN0aW9uKCBldmVudCApIHtcblx0XHRcdFx0aWYgKCB2YWxpZGF0b3Iuc2V0dGluZ3Muc3VibWl0SGFuZGxlciApIHtcblx0XHRcdFx0XHR2YWxpZGF0b3Iuc3VibWl0QnV0dG9uID0gZXZlbnQudGFyZ2V0O1xuXHRcdFx0XHR9XG5cdFx0XHRcdC8vIGFsbG93IHN1cHByZXNzaW5nIHZhbGlkYXRpb24gYnkgYWRkaW5nIGEgY2FuY2VsIGNsYXNzIHRvIHRoZSBzdWJtaXQgYnV0dG9uXG5cdFx0XHRcdGlmICggJCggZXZlbnQudGFyZ2V0ICkuaGFzQ2xhc3MoIFwiY2FuY2VsXCIgKSApIHtcblx0XHRcdFx0XHR2YWxpZGF0b3IuY2FuY2VsU3VibWl0ID0gdHJ1ZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIGFsbG93IHN1cHByZXNzaW5nIHZhbGlkYXRpb24gYnkgYWRkaW5nIHRoZSBodG1sNSBmb3Jtbm92YWxpZGF0ZSBhdHRyaWJ1dGUgdG8gdGhlIHN1Ym1pdCBidXR0b25cblx0XHRcdFx0aWYgKCAkKCBldmVudC50YXJnZXQgKS5hdHRyKCBcImZvcm1ub3ZhbGlkYXRlXCIgKSAhPT0gdW5kZWZpbmVkICkge1xuXHRcdFx0XHRcdHZhbGlkYXRvci5jYW5jZWxTdWJtaXQgPSB0cnVlO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblxuXHRcdFx0Ly8gdmFsaWRhdGUgdGhlIGZvcm0gb24gc3VibWl0XG5cdFx0XHR0aGlzLnN1Ym1pdCggZnVuY3Rpb24oIGV2ZW50ICkge1xuXHRcdFx0XHRpZiAoIHZhbGlkYXRvci5zZXR0aW5ncy5kZWJ1ZyApIHtcblx0XHRcdFx0XHQvLyBwcmV2ZW50IGZvcm0gc3VibWl0IHRvIGJlIGFibGUgdG8gc2VlIGNvbnNvbGUgb3V0cHV0XG5cdFx0XHRcdFx0ZXZlbnQucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRmdW5jdGlvbiBoYW5kbGUoKSB7XG5cdFx0XHRcdFx0dmFyIGhpZGRlbiwgcmVzdWx0O1xuXHRcdFx0XHRcdGlmICggdmFsaWRhdG9yLnNldHRpbmdzLnN1Ym1pdEhhbmRsZXIgKSB7XG5cdFx0XHRcdFx0XHRpZiAoIHZhbGlkYXRvci5zdWJtaXRCdXR0b24gKSB7XG5cdFx0XHRcdFx0XHRcdC8vIGluc2VydCBhIGhpZGRlbiBpbnB1dCBhcyBhIHJlcGxhY2VtZW50IGZvciB0aGUgbWlzc2luZyBzdWJtaXQgYnV0dG9uXG5cdFx0XHRcdFx0XHRcdGhpZGRlbiA9ICQoIFwiPGlucHV0IHR5cGU9J2hpZGRlbicvPlwiIClcblx0XHRcdFx0XHRcdFx0XHQuYXR0ciggXCJuYW1lXCIsIHZhbGlkYXRvci5zdWJtaXRCdXR0b24ubmFtZSApXG5cdFx0XHRcdFx0XHRcdFx0LnZhbCggJCggdmFsaWRhdG9yLnN1Ym1pdEJ1dHRvbiApLnZhbCgpIClcblx0XHRcdFx0XHRcdFx0XHQuYXBwZW5kVG8oIHZhbGlkYXRvci5jdXJyZW50Rm9ybSApO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmVzdWx0ID0gdmFsaWRhdG9yLnNldHRpbmdzLnN1Ym1pdEhhbmRsZXIuY2FsbCggdmFsaWRhdG9yLCB2YWxpZGF0b3IuY3VycmVudEZvcm0sIGV2ZW50ICk7XG5cdFx0XHRcdFx0XHRpZiAoIHZhbGlkYXRvci5zdWJtaXRCdXR0b24gKSB7XG5cdFx0XHRcdFx0XHRcdC8vIGFuZCBjbGVhbiB1cCBhZnRlcndhcmRzOyB0aGFua3MgdG8gbm8tYmxvY2stc2NvcGUsIGhpZGRlbiBjYW4gYmUgcmVmZXJlbmNlZFxuXHRcdFx0XHRcdFx0XHRoaWRkZW4ucmVtb3ZlKCk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHRpZiAoIHJlc3VsdCAhPT0gdW5kZWZpbmVkICkge1xuXHRcdFx0XHRcdFx0XHRyZXR1cm4gcmVzdWx0O1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdC8vIHByZXZlbnQgc3VibWl0IGZvciBpbnZhbGlkIGZvcm1zIG9yIGN1c3RvbSBzdWJtaXQgaGFuZGxlcnNcblx0XHRcdFx0aWYgKCB2YWxpZGF0b3IuY2FuY2VsU3VibWl0ICkge1xuXHRcdFx0XHRcdHZhbGlkYXRvci5jYW5jZWxTdWJtaXQgPSBmYWxzZTtcblx0XHRcdFx0XHRyZXR1cm4gaGFuZGxlKCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0aWYgKCB2YWxpZGF0b3IuZm9ybSgpICkge1xuXHRcdFx0XHRcdGlmICggdmFsaWRhdG9yLnBlbmRpbmdSZXF1ZXN0ICkge1xuXHRcdFx0XHRcdFx0dmFsaWRhdG9yLmZvcm1TdWJtaXR0ZWQgPSB0cnVlO1xuXHRcdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHRyZXR1cm4gaGFuZGxlKCk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dmFsaWRhdG9yLmZvY3VzSW52YWxpZCgpO1xuXHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fVxuXG5cdFx0cmV0dXJuIHZhbGlkYXRvcjtcblx0fSxcblx0Ly8gaHR0cDovL2pxdWVyeXZhbGlkYXRpb24ub3JnL3ZhbGlkL1xuXHR2YWxpZDogZnVuY3Rpb24oKSB7XG5cdFx0dmFyIHZhbGlkLCB2YWxpZGF0b3I7XG5cblx0XHRpZiAoICQoIHRoaXNbIDAgXSApLmlzKCBcImZvcm1cIiApICkge1xuXHRcdFx0dmFsaWQgPSB0aGlzLnZhbGlkYXRlKCkuZm9ybSgpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR2YWxpZCA9IHRydWU7XG5cdFx0XHR2YWxpZGF0b3IgPSAkKCB0aGlzWyAwIF0uZm9ybSApLnZhbGlkYXRlKCk7XG5cdFx0XHR0aGlzLmVhY2goIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHR2YWxpZCA9IHZhbGlkYXRvci5lbGVtZW50KCB0aGlzICkgJiYgdmFsaWQ7XG5cdFx0XHR9KTtcblx0XHR9XG5cdFx0cmV0dXJuIHZhbGlkO1xuXHR9LFxuXHQvLyBhdHRyaWJ1dGVzOiBzcGFjZSBzZXBhcmF0ZWQgbGlzdCBvZiBhdHRyaWJ1dGVzIHRvIHJldHJpZXZlIGFuZCByZW1vdmVcblx0cmVtb3ZlQXR0cnM6IGZ1bmN0aW9uKCBhdHRyaWJ1dGVzICkge1xuXHRcdHZhciByZXN1bHQgPSB7fSxcblx0XHRcdCRlbGVtZW50ID0gdGhpcztcblx0XHQkLmVhY2goIGF0dHJpYnV0ZXMuc3BsaXQoIC9cXHMvICksIGZ1bmN0aW9uKCBpbmRleCwgdmFsdWUgKSB7XG5cdFx0XHRyZXN1bHRbIHZhbHVlIF0gPSAkZWxlbWVudC5hdHRyKCB2YWx1ZSApO1xuXHRcdFx0JGVsZW1lbnQucmVtb3ZlQXR0ciggdmFsdWUgKTtcblx0XHR9KTtcblx0XHRyZXR1cm4gcmVzdWx0O1xuXHR9LFxuXHQvLyBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvcnVsZXMvXG5cdHJ1bGVzOiBmdW5jdGlvbiggY29tbWFuZCwgYXJndW1lbnQgKSB7XG5cdFx0dmFyIGVsZW1lbnQgPSB0aGlzWyAwIF0sXG5cdFx0XHRzZXR0aW5ncywgc3RhdGljUnVsZXMsIGV4aXN0aW5nUnVsZXMsIGRhdGEsIHBhcmFtLCBmaWx0ZXJlZDtcblxuXHRcdGlmICggY29tbWFuZCApIHtcblx0XHRcdHNldHRpbmdzID0gJC5kYXRhKCBlbGVtZW50LmZvcm0sIFwidmFsaWRhdG9yXCIgKS5zZXR0aW5ncztcblx0XHRcdHN0YXRpY1J1bGVzID0gc2V0dGluZ3MucnVsZXM7XG5cdFx0XHRleGlzdGluZ1J1bGVzID0gJC52YWxpZGF0b3Iuc3RhdGljUnVsZXMoIGVsZW1lbnQgKTtcblx0XHRcdHN3aXRjaCAoIGNvbW1hbmQgKSB7XG5cdFx0XHRjYXNlIFwiYWRkXCI6XG5cdFx0XHRcdCQuZXh0ZW5kKCBleGlzdGluZ1J1bGVzLCAkLnZhbGlkYXRvci5ub3JtYWxpemVSdWxlKCBhcmd1bWVudCApICk7XG5cdFx0XHRcdC8vIHJlbW92ZSBtZXNzYWdlcyBmcm9tIHJ1bGVzLCBidXQgYWxsb3cgdGhlbSB0byBiZSBzZXQgc2VwYXJhdGVseVxuXHRcdFx0XHRkZWxldGUgZXhpc3RpbmdSdWxlcy5tZXNzYWdlcztcblx0XHRcdFx0c3RhdGljUnVsZXNbIGVsZW1lbnQubmFtZSBdID0gZXhpc3RpbmdSdWxlcztcblx0XHRcdFx0aWYgKCBhcmd1bWVudC5tZXNzYWdlcyApIHtcblx0XHRcdFx0XHRzZXR0aW5ncy5tZXNzYWdlc1sgZWxlbWVudC5uYW1lIF0gPSAkLmV4dGVuZCggc2V0dGluZ3MubWVzc2FnZXNbIGVsZW1lbnQubmFtZSBdLCBhcmd1bWVudC5tZXNzYWdlcyApO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGJyZWFrO1xuXHRcdFx0Y2FzZSBcInJlbW92ZVwiOlxuXHRcdFx0XHRpZiAoICFhcmd1bWVudCApIHtcblx0XHRcdFx0XHRkZWxldGUgc3RhdGljUnVsZXNbIGVsZW1lbnQubmFtZSBdO1xuXHRcdFx0XHRcdHJldHVybiBleGlzdGluZ1J1bGVzO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGZpbHRlcmVkID0ge307XG5cdFx0XHRcdCQuZWFjaCggYXJndW1lbnQuc3BsaXQoIC9cXHMvICksIGZ1bmN0aW9uKCBpbmRleCwgbWV0aG9kICkge1xuXHRcdFx0XHRcdGZpbHRlcmVkWyBtZXRob2QgXSA9IGV4aXN0aW5nUnVsZXNbIG1ldGhvZCBdO1xuXHRcdFx0XHRcdGRlbGV0ZSBleGlzdGluZ1J1bGVzWyBtZXRob2QgXTtcblx0XHRcdFx0XHRpZiAoIG1ldGhvZCA9PT0gXCJyZXF1aXJlZFwiICkge1xuXHRcdFx0XHRcdFx0JCggZWxlbWVudCApLnJlbW92ZUF0dHIoIFwiYXJpYS1yZXF1aXJlZFwiICk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9KTtcblx0XHRcdFx0cmV0dXJuIGZpbHRlcmVkO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGRhdGEgPSAkLnZhbGlkYXRvci5ub3JtYWxpemVSdWxlcyhcblx0XHQkLmV4dGVuZChcblx0XHRcdHt9LFxuXHRcdFx0JC52YWxpZGF0b3IuY2xhc3NSdWxlcyggZWxlbWVudCApLFxuXHRcdFx0JC52YWxpZGF0b3IuYXR0cmlidXRlUnVsZXMoIGVsZW1lbnQgKSxcblx0XHRcdCQudmFsaWRhdG9yLmRhdGFSdWxlcyggZWxlbWVudCApLFxuXHRcdFx0JC52YWxpZGF0b3Iuc3RhdGljUnVsZXMoIGVsZW1lbnQgKVxuXHRcdCksIGVsZW1lbnQgKTtcblxuXHRcdC8vIG1ha2Ugc3VyZSByZXF1aXJlZCBpcyBhdCBmcm9udFxuXHRcdGlmICggZGF0YS5yZXF1aXJlZCApIHtcblx0XHRcdHBhcmFtID0gZGF0YS5yZXF1aXJlZDtcblx0XHRcdGRlbGV0ZSBkYXRhLnJlcXVpcmVkO1xuXHRcdFx0ZGF0YSA9ICQuZXh0ZW5kKCB7IHJlcXVpcmVkOiBwYXJhbSB9LCBkYXRhICk7XG5cdFx0XHQkKCBlbGVtZW50ICkuYXR0ciggXCJhcmlhLXJlcXVpcmVkXCIsIFwidHJ1ZVwiICk7XG5cdFx0fVxuXG5cdFx0Ly8gbWFrZSBzdXJlIHJlbW90ZSBpcyBhdCBiYWNrXG5cdFx0aWYgKCBkYXRhLnJlbW90ZSApIHtcblx0XHRcdHBhcmFtID0gZGF0YS5yZW1vdGU7XG5cdFx0XHRkZWxldGUgZGF0YS5yZW1vdGU7XG5cdFx0XHRkYXRhID0gJC5leHRlbmQoIGRhdGEsIHsgcmVtb3RlOiBwYXJhbSB9KTtcblx0XHR9XG5cblx0XHRyZXR1cm4gZGF0YTtcblx0fVxufSk7XG5cbi8vIEN1c3RvbSBzZWxlY3RvcnNcbiQuZXh0ZW5kKCAkLmV4cHJbIFwiOlwiIF0sIHtcblx0Ly8gaHR0cDovL2pxdWVyeXZhbGlkYXRpb24ub3JnL2JsYW5rLXNlbGVjdG9yL1xuXHRibGFuazogZnVuY3Rpb24oIGEgKSB7XG5cdFx0cmV0dXJuICEkLnRyaW0oIFwiXCIgKyAkKCBhICkudmFsKCkgKTtcblx0fSxcblx0Ly8gaHR0cDovL2pxdWVyeXZhbGlkYXRpb24ub3JnL2ZpbGxlZC1zZWxlY3Rvci9cblx0ZmlsbGVkOiBmdW5jdGlvbiggYSApIHtcblx0XHRyZXR1cm4gISEkLnRyaW0oIFwiXCIgKyAkKCBhICkudmFsKCkgKTtcblx0fSxcblx0Ly8gaHR0cDovL2pxdWVyeXZhbGlkYXRpb24ub3JnL3VuY2hlY2tlZC1zZWxlY3Rvci9cblx0dW5jaGVja2VkOiBmdW5jdGlvbiggYSApIHtcblx0XHRyZXR1cm4gISQoIGEgKS5wcm9wKCBcImNoZWNrZWRcIiApO1xuXHR9XG59KTtcblxuLy8gY29uc3RydWN0b3IgZm9yIHZhbGlkYXRvclxuJC52YWxpZGF0b3IgPSBmdW5jdGlvbiggb3B0aW9ucywgZm9ybSApIHtcblx0dGhpcy5zZXR0aW5ncyA9ICQuZXh0ZW5kKCB0cnVlLCB7fSwgJC52YWxpZGF0b3IuZGVmYXVsdHMsIG9wdGlvbnMgKTtcblx0dGhpcy5jdXJyZW50Rm9ybSA9IGZvcm07XG5cdHRoaXMuaW5pdCgpO1xufTtcblxuLy8gaHR0cDovL2pxdWVyeXZhbGlkYXRpb24ub3JnL2pRdWVyeS52YWxpZGF0b3IuZm9ybWF0L1xuJC52YWxpZGF0b3IuZm9ybWF0ID0gZnVuY3Rpb24oIHNvdXJjZSwgcGFyYW1zICkge1xuXHRpZiAoIGFyZ3VtZW50cy5sZW5ndGggPT09IDEgKSB7XG5cdFx0cmV0dXJuIGZ1bmN0aW9uKCkge1xuXHRcdFx0dmFyIGFyZ3MgPSAkLm1ha2VBcnJheSggYXJndW1lbnRzICk7XG5cdFx0XHRhcmdzLnVuc2hpZnQoIHNvdXJjZSApO1xuXHRcdFx0cmV0dXJuICQudmFsaWRhdG9yLmZvcm1hdC5hcHBseSggdGhpcywgYXJncyApO1xuXHRcdH07XG5cdH1cblx0aWYgKCBhcmd1bWVudHMubGVuZ3RoID4gMiAmJiBwYXJhbXMuY29uc3RydWN0b3IgIT09IEFycmF5ICApIHtcblx0XHRwYXJhbXMgPSAkLm1ha2VBcnJheSggYXJndW1lbnRzICkuc2xpY2UoIDEgKTtcblx0fVxuXHRpZiAoIHBhcmFtcy5jb25zdHJ1Y3RvciAhPT0gQXJyYXkgKSB7XG5cdFx0cGFyYW1zID0gWyBwYXJhbXMgXTtcblx0fVxuXHQkLmVhY2goIHBhcmFtcywgZnVuY3Rpb24oIGksIG4gKSB7XG5cdFx0c291cmNlID0gc291cmNlLnJlcGxhY2UoIG5ldyBSZWdFeHAoIFwiXFxcXHtcIiArIGkgKyBcIlxcXFx9XCIsIFwiZ1wiICksIGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIG47XG5cdFx0fSk7XG5cdH0pO1xuXHRyZXR1cm4gc291cmNlO1xufTtcblxuJC5leHRlbmQoICQudmFsaWRhdG9yLCB7XG5cblx0ZGVmYXVsdHM6IHtcblx0XHRtZXNzYWdlczoge30sXG5cdFx0Z3JvdXBzOiB7fSxcblx0XHRydWxlczoge30sXG5cdFx0ZXJyb3JDbGFzczogXCJlcnJvclwiLFxuXHRcdHZhbGlkQ2xhc3M6IFwidmFsaWRcIixcblx0XHRlcnJvckVsZW1lbnQ6IFwibGFiZWxcIixcblx0XHRmb2N1c0NsZWFudXA6IGZhbHNlLFxuXHRcdGZvY3VzSW52YWxpZDogdHJ1ZSxcblx0XHRlcnJvckNvbnRhaW5lcjogJCggW10gKSxcblx0XHRlcnJvckxhYmVsQ29udGFpbmVyOiAkKCBbXSApLFxuXHRcdG9uc3VibWl0OiB0cnVlLFxuXHRcdGlnbm9yZTogXCI6aGlkZGVuXCIsXG5cdFx0aWdub3JlVGl0bGU6IGZhbHNlLFxuXHRcdG9uZm9jdXNpbjogZnVuY3Rpb24oIGVsZW1lbnQgKSB7XG5cdFx0XHR0aGlzLmxhc3RBY3RpdmUgPSBlbGVtZW50O1xuXG5cdFx0XHQvLyBIaWRlIGVycm9yIGxhYmVsIGFuZCByZW1vdmUgZXJyb3IgY2xhc3Mgb24gZm9jdXMgaWYgZW5hYmxlZFxuXHRcdFx0aWYgKCB0aGlzLnNldHRpbmdzLmZvY3VzQ2xlYW51cCApIHtcblx0XHRcdFx0aWYgKCB0aGlzLnNldHRpbmdzLnVuaGlnaGxpZ2h0ICkge1xuXHRcdFx0XHRcdHRoaXMuc2V0dGluZ3MudW5oaWdobGlnaHQuY2FsbCggdGhpcywgZWxlbWVudCwgdGhpcy5zZXR0aW5ncy5lcnJvckNsYXNzLCB0aGlzLnNldHRpbmdzLnZhbGlkQ2xhc3MgKTtcblx0XHRcdFx0fVxuXHRcdFx0XHR0aGlzLmhpZGVUaGVzZSggdGhpcy5lcnJvcnNGb3IoIGVsZW1lbnQgKSApO1xuXHRcdFx0fVxuXHRcdH0sXG5cdFx0b25mb2N1c291dDogZnVuY3Rpb24oIGVsZW1lbnQgKSB7XG5cdFx0XHRpZiAoICF0aGlzLmNoZWNrYWJsZSggZWxlbWVudCApICYmICggZWxlbWVudC5uYW1lIGluIHRoaXMuc3VibWl0dGVkIHx8ICF0aGlzLm9wdGlvbmFsKCBlbGVtZW50ICkgKSApIHtcblx0XHRcdFx0dGhpcy5lbGVtZW50KCBlbGVtZW50ICk7XG5cdFx0XHR9XG5cdFx0fSxcblx0XHRvbmtleXVwOiBmdW5jdGlvbiggZWxlbWVudCwgZXZlbnQgKSB7XG5cdFx0XHRpZiAoIGV2ZW50LndoaWNoID09PSA5ICYmIHRoaXMuZWxlbWVudFZhbHVlKCBlbGVtZW50ICkgPT09IFwiXCIgKSB7XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH0gZWxzZSBpZiAoIGVsZW1lbnQubmFtZSBpbiB0aGlzLnN1Ym1pdHRlZCB8fCBlbGVtZW50ID09PSB0aGlzLmxhc3RFbGVtZW50ICkge1xuXHRcdFx0XHR0aGlzLmVsZW1lbnQoIGVsZW1lbnQgKTtcblx0XHRcdH1cblx0XHR9LFxuXHRcdG9uY2xpY2s6IGZ1bmN0aW9uKCBlbGVtZW50ICkge1xuXHRcdFx0Ly8gY2xpY2sgb24gc2VsZWN0cywgcmFkaW9idXR0b25zIGFuZCBjaGVja2JveGVzXG5cdFx0XHRpZiAoIGVsZW1lbnQubmFtZSBpbiB0aGlzLnN1Ym1pdHRlZCApIHtcblx0XHRcdFx0dGhpcy5lbGVtZW50KCBlbGVtZW50ICk7XG5cblx0XHRcdC8vIG9yIG9wdGlvbiBlbGVtZW50cywgY2hlY2sgcGFyZW50IHNlbGVjdCBpbiB0aGF0IGNhc2Vcblx0XHRcdH0gZWxzZSBpZiAoIGVsZW1lbnQucGFyZW50Tm9kZS5uYW1lIGluIHRoaXMuc3VibWl0dGVkICkge1xuXHRcdFx0XHR0aGlzLmVsZW1lbnQoIGVsZW1lbnQucGFyZW50Tm9kZSApO1xuXHRcdFx0fVxuXHRcdH0sXG5cdFx0aGlnaGxpZ2h0OiBmdW5jdGlvbiggZWxlbWVudCwgZXJyb3JDbGFzcywgdmFsaWRDbGFzcyApIHtcblx0XHRcdGlmICggZWxlbWVudC50eXBlID09PSBcInJhZGlvXCIgKSB7XG5cdFx0XHRcdHRoaXMuZmluZEJ5TmFtZSggZWxlbWVudC5uYW1lICkuYWRkQ2xhc3MoIGVycm9yQ2xhc3MgKS5yZW1vdmVDbGFzcyggdmFsaWRDbGFzcyApO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0JCggZWxlbWVudCApLmFkZENsYXNzKCBlcnJvckNsYXNzICkucmVtb3ZlQ2xhc3MoIHZhbGlkQ2xhc3MgKTtcblx0XHRcdH1cblx0XHR9LFxuXHRcdHVuaGlnaGxpZ2h0OiBmdW5jdGlvbiggZWxlbWVudCwgZXJyb3JDbGFzcywgdmFsaWRDbGFzcyApIHtcblx0XHRcdGlmICggZWxlbWVudC50eXBlID09PSBcInJhZGlvXCIgKSB7XG5cdFx0XHRcdHRoaXMuZmluZEJ5TmFtZSggZWxlbWVudC5uYW1lICkucmVtb3ZlQ2xhc3MoIGVycm9yQ2xhc3MgKS5hZGRDbGFzcyggdmFsaWRDbGFzcyApO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0JCggZWxlbWVudCApLnJlbW92ZUNsYXNzKCBlcnJvckNsYXNzICkuYWRkQ2xhc3MoIHZhbGlkQ2xhc3MgKTtcblx0XHRcdH1cblx0XHR9XG5cdH0sXG5cblx0Ly8gaHR0cDovL2pxdWVyeXZhbGlkYXRpb24ub3JnL2pRdWVyeS52YWxpZGF0b3Iuc2V0RGVmYXVsdHMvXG5cdHNldERlZmF1bHRzOiBmdW5jdGlvbiggc2V0dGluZ3MgKSB7XG5cdFx0JC5leHRlbmQoICQudmFsaWRhdG9yLmRlZmF1bHRzLCBzZXR0aW5ncyApO1xuXHR9LFxuXG5cdG1lc3NhZ2VzOiB7XG5cdFx0cmVxdWlyZWQ6IFwiVGhpcyBmaWVsZCBpcyByZXF1aXJlZC5cIixcblx0XHRyZW1vdGU6IFwiUGxlYXNlIGZpeCB0aGlzIGZpZWxkLlwiLFxuXHRcdGVtYWlsOiBcIlBsZWFzZSBlbnRlciBhIHZhbGlkIGVtYWlsIGFkZHJlc3MuXCIsXG5cdFx0dXJsOiBcIlBsZWFzZSBlbnRlciBhIHZhbGlkIFVSTC5cIixcblx0XHRkYXRlOiBcIlBsZWFzZSBlbnRlciBhIHZhbGlkIGRhdGUuXCIsXG5cdFx0ZGF0ZUlTTzogXCJQbGVhc2UgZW50ZXIgYSB2YWxpZCBkYXRlICggSVNPICkuXCIsXG5cdFx0bnVtYmVyOiBcIlBsZWFzZSBlbnRlciBhIHZhbGlkIG51bWJlci5cIixcblx0XHRkaWdpdHM6IFwiUGxlYXNlIGVudGVyIG9ubHkgZGlnaXRzLlwiLFxuXHRcdGNyZWRpdGNhcmQ6IFwiUGxlYXNlIGVudGVyIGEgdmFsaWQgY3JlZGl0IGNhcmQgbnVtYmVyLlwiLFxuXHRcdGVxdWFsVG86IFwiUGxlYXNlIGVudGVyIHRoZSBzYW1lIHZhbHVlIGFnYWluLlwiLFxuXHRcdG1heGxlbmd0aDogJC52YWxpZGF0b3IuZm9ybWF0KCBcIlBsZWFzZSBlbnRlciBubyBtb3JlIHRoYW4gezB9IGNoYXJhY3RlcnMuXCIgKSxcblx0XHRtaW5sZW5ndGg6ICQudmFsaWRhdG9yLmZvcm1hdCggXCJQbGVhc2UgZW50ZXIgYXQgbGVhc3QgezB9IGNoYXJhY3RlcnMuXCIgKSxcblx0XHRyYW5nZWxlbmd0aDogJC52YWxpZGF0b3IuZm9ybWF0KCBcIlBsZWFzZSBlbnRlciBhIHZhbHVlIGJldHdlZW4gezB9IGFuZCB7MX0gY2hhcmFjdGVycyBsb25nLlwiICksXG5cdFx0cmFuZ2U6ICQudmFsaWRhdG9yLmZvcm1hdCggXCJQbGVhc2UgZW50ZXIgYSB2YWx1ZSBiZXR3ZWVuIHswfSBhbmQgezF9LlwiICksXG5cdFx0bWF4OiAkLnZhbGlkYXRvci5mb3JtYXQoIFwiUGxlYXNlIGVudGVyIGEgdmFsdWUgbGVzcyB0aGFuIG9yIGVxdWFsIHRvIHswfS5cIiApLFxuXHRcdG1pbjogJC52YWxpZGF0b3IuZm9ybWF0KCBcIlBsZWFzZSBlbnRlciBhIHZhbHVlIGdyZWF0ZXIgdGhhbiBvciBlcXVhbCB0byB7MH0uXCIgKVxuXHR9LFxuXG5cdGF1dG9DcmVhdGVSYW5nZXM6IGZhbHNlLFxuXG5cdHByb3RvdHlwZToge1xuXG5cdFx0aW5pdDogZnVuY3Rpb24oKSB7XG5cdFx0XHR0aGlzLmxhYmVsQ29udGFpbmVyID0gJCggdGhpcy5zZXR0aW5ncy5lcnJvckxhYmVsQ29udGFpbmVyICk7XG5cdFx0XHR0aGlzLmVycm9yQ29udGV4dCA9IHRoaXMubGFiZWxDb250YWluZXIubGVuZ3RoICYmIHRoaXMubGFiZWxDb250YWluZXIgfHwgJCggdGhpcy5jdXJyZW50Rm9ybSApO1xuXHRcdFx0dGhpcy5jb250YWluZXJzID0gJCggdGhpcy5zZXR0aW5ncy5lcnJvckNvbnRhaW5lciApLmFkZCggdGhpcy5zZXR0aW5ncy5lcnJvckxhYmVsQ29udGFpbmVyICk7XG5cdFx0XHR0aGlzLnN1Ym1pdHRlZCA9IHt9O1xuXHRcdFx0dGhpcy52YWx1ZUNhY2hlID0ge307XG5cdFx0XHR0aGlzLnBlbmRpbmdSZXF1ZXN0ID0gMDtcblx0XHRcdHRoaXMucGVuZGluZyA9IHt9O1xuXHRcdFx0dGhpcy5pbnZhbGlkID0ge307XG5cdFx0XHR0aGlzLnJlc2V0KCk7XG5cblx0XHRcdHZhciBncm91cHMgPSAoIHRoaXMuZ3JvdXBzID0ge30gKSxcblx0XHRcdFx0cnVsZXM7XG5cdFx0XHQkLmVhY2goIHRoaXMuc2V0dGluZ3MuZ3JvdXBzLCBmdW5jdGlvbigga2V5LCB2YWx1ZSApIHtcblx0XHRcdFx0aWYgKCB0eXBlb2YgdmFsdWUgPT09IFwic3RyaW5nXCIgKSB7XG5cdFx0XHRcdFx0dmFsdWUgPSB2YWx1ZS5zcGxpdCggL1xccy8gKTtcblx0XHRcdFx0fVxuXHRcdFx0XHQkLmVhY2goIHZhbHVlLCBmdW5jdGlvbiggaW5kZXgsIG5hbWUgKSB7XG5cdFx0XHRcdFx0Z3JvdXBzWyBuYW1lIF0gPSBrZXk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fSk7XG5cdFx0XHRydWxlcyA9IHRoaXMuc2V0dGluZ3MucnVsZXM7XG5cdFx0XHQkLmVhY2goIHJ1bGVzLCBmdW5jdGlvbigga2V5LCB2YWx1ZSApIHtcblx0XHRcdFx0cnVsZXNbIGtleSBdID0gJC52YWxpZGF0b3Iubm9ybWFsaXplUnVsZSggdmFsdWUgKTtcblx0XHRcdH0pO1xuXG5cdFx0XHRmdW5jdGlvbiBkZWxlZ2F0ZSggZXZlbnQgKSB7XG5cdFx0XHRcdHZhciB2YWxpZGF0b3IgPSAkLmRhdGEoIHRoaXNbIDAgXS5mb3JtLCBcInZhbGlkYXRvclwiICksXG5cdFx0XHRcdFx0ZXZlbnRUeXBlID0gXCJvblwiICsgZXZlbnQudHlwZS5yZXBsYWNlKCAvXnZhbGlkYXRlLywgXCJcIiApLFxuXHRcdFx0XHRcdHNldHRpbmdzID0gdmFsaWRhdG9yLnNldHRpbmdzO1xuXHRcdFx0XHRpZiAoIHNldHRpbmdzWyBldmVudFR5cGUgXSAmJiAhdGhpcy5pcyggc2V0dGluZ3MuaWdub3JlICkgKSB7XG5cdFx0XHRcdFx0c2V0dGluZ3NbIGV2ZW50VHlwZSBdLmNhbGwoIHZhbGlkYXRvciwgdGhpc1sgMCBdLCBldmVudCApO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHQkKCB0aGlzLmN1cnJlbnRGb3JtIClcblx0XHRcdFx0LnZhbGlkYXRlRGVsZWdhdGUoIFwiOnRleHQsIFt0eXBlPSdwYXNzd29yZCddLCBbdHlwZT0nZmlsZSddLCBzZWxlY3QsIHRleHRhcmVhLCBcIiArXG5cdFx0XHRcdFx0XCJbdHlwZT0nbnVtYmVyJ10sIFt0eXBlPSdzZWFyY2gnXSAsW3R5cGU9J3RlbCddLCBbdHlwZT0ndXJsJ10sIFwiICtcblx0XHRcdFx0XHRcIlt0eXBlPSdlbWFpbCddLCBbdHlwZT0nZGF0ZXRpbWUnXSwgW3R5cGU9J2RhdGUnXSwgW3R5cGU9J21vbnRoJ10sIFwiICtcblx0XHRcdFx0XHRcIlt0eXBlPSd3ZWVrJ10sIFt0eXBlPSd0aW1lJ10sIFt0eXBlPSdkYXRldGltZS1sb2NhbCddLCBcIiArXG5cdFx0XHRcdFx0XCJbdHlwZT0ncmFuZ2UnXSwgW3R5cGU9J2NvbG9yJ10sIFt0eXBlPSdyYWRpbyddLCBbdHlwZT0nY2hlY2tib3gnXVwiLFxuXHRcdFx0XHRcdFwiZm9jdXNpbiBmb2N1c291dCBrZXl1cFwiLCBkZWxlZ2F0ZSlcblx0XHRcdFx0Ly8gU3VwcG9ydDogQ2hyb21lLCBvbGRJRVxuXHRcdFx0XHQvLyBcInNlbGVjdFwiIGlzIHByb3ZpZGVkIGFzIGV2ZW50LnRhcmdldCB3aGVuIGNsaWNraW5nIGEgb3B0aW9uXG5cdFx0XHRcdC52YWxpZGF0ZURlbGVnYXRlKFwic2VsZWN0LCBvcHRpb24sIFt0eXBlPSdyYWRpbyddLCBbdHlwZT0nY2hlY2tib3gnXVwiLCBcImNsaWNrXCIsIGRlbGVnYXRlKTtcblxuXHRcdFx0aWYgKCB0aGlzLnNldHRpbmdzLmludmFsaWRIYW5kbGVyICkge1xuXHRcdFx0XHQkKCB0aGlzLmN1cnJlbnRGb3JtICkuYmluZCggXCJpbnZhbGlkLWZvcm0udmFsaWRhdGVcIiwgdGhpcy5zZXR0aW5ncy5pbnZhbGlkSGFuZGxlciApO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBBZGQgYXJpYS1yZXF1aXJlZCB0byBhbnkgU3RhdGljL0RhdGEvQ2xhc3MgcmVxdWlyZWQgZmllbGRzIGJlZm9yZSBmaXJzdCB2YWxpZGF0aW9uXG5cdFx0XHQvLyBTY3JlZW4gcmVhZGVycyByZXF1aXJlIHRoaXMgYXR0cmlidXRlIHRvIGJlIHByZXNlbnQgYmVmb3JlIHRoZSBpbml0aWFsIHN1Ym1pc3Npb24gaHR0cDovL3d3dy53My5vcmcvVFIvV0NBRy1URUNIUy9BUklBMi5odG1sXG5cdFx0XHQkKCB0aGlzLmN1cnJlbnRGb3JtICkuZmluZCggXCJbcmVxdWlyZWRdLCBbZGF0YS1ydWxlLXJlcXVpcmVkXSwgLnJlcXVpcmVkXCIgKS5hdHRyKCBcImFyaWEtcmVxdWlyZWRcIiwgXCJ0cnVlXCIgKTtcblx0XHR9LFxuXG5cdFx0Ly8gaHR0cDovL2pxdWVyeXZhbGlkYXRpb24ub3JnL1ZhbGlkYXRvci5mb3JtL1xuXHRcdGZvcm06IGZ1bmN0aW9uKCkge1xuXHRcdFx0dGhpcy5jaGVja0Zvcm0oKTtcblx0XHRcdCQuZXh0ZW5kKCB0aGlzLnN1Ym1pdHRlZCwgdGhpcy5lcnJvck1hcCApO1xuXHRcdFx0dGhpcy5pbnZhbGlkID0gJC5leHRlbmQoe30sIHRoaXMuZXJyb3JNYXAgKTtcblx0XHRcdGlmICggIXRoaXMudmFsaWQoKSApIHtcblx0XHRcdFx0JCggdGhpcy5jdXJyZW50Rm9ybSApLnRyaWdnZXJIYW5kbGVyKCBcImludmFsaWQtZm9ybVwiLCBbIHRoaXMgXSk7XG5cdFx0XHR9XG5cdFx0XHR0aGlzLnNob3dFcnJvcnMoKTtcblx0XHRcdHJldHVybiB0aGlzLnZhbGlkKCk7XG5cdFx0fSxcblxuXHRcdGNoZWNrRm9ybTogZnVuY3Rpb24oKSB7XG5cdFx0XHR0aGlzLnByZXBhcmVGb3JtKCk7XG5cdFx0XHRmb3IgKCB2YXIgaSA9IDAsIGVsZW1lbnRzID0gKCB0aGlzLmN1cnJlbnRFbGVtZW50cyA9IHRoaXMuZWxlbWVudHMoKSApOyBlbGVtZW50c1sgaSBdOyBpKysgKSB7XG5cdFx0XHRcdHRoaXMuY2hlY2soIGVsZW1lbnRzWyBpIF0gKTtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0aGlzLnZhbGlkKCk7XG5cdFx0fSxcblxuXHRcdC8vIGh0dHA6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9WYWxpZGF0b3IuZWxlbWVudC9cblx0XHRlbGVtZW50OiBmdW5jdGlvbiggZWxlbWVudCApIHtcblx0XHRcdHZhciBjbGVhbkVsZW1lbnQgPSB0aGlzLmNsZWFuKCBlbGVtZW50ICksXG5cdFx0XHRcdGNoZWNrRWxlbWVudCA9IHRoaXMudmFsaWRhdGlvblRhcmdldEZvciggY2xlYW5FbGVtZW50ICksXG5cdFx0XHRcdHJlc3VsdCA9IHRydWU7XG5cblx0XHRcdHRoaXMubGFzdEVsZW1lbnQgPSBjaGVja0VsZW1lbnQ7XG5cblx0XHRcdGlmICggY2hlY2tFbGVtZW50ID09PSB1bmRlZmluZWQgKSB7XG5cdFx0XHRcdGRlbGV0ZSB0aGlzLmludmFsaWRbIGNsZWFuRWxlbWVudC5uYW1lIF07XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHR0aGlzLnByZXBhcmVFbGVtZW50KCBjaGVja0VsZW1lbnQgKTtcblx0XHRcdFx0dGhpcy5jdXJyZW50RWxlbWVudHMgPSAkKCBjaGVja0VsZW1lbnQgKTtcblxuXHRcdFx0XHRyZXN1bHQgPSB0aGlzLmNoZWNrKCBjaGVja0VsZW1lbnQgKSAhPT0gZmFsc2U7XG5cdFx0XHRcdGlmICggcmVzdWx0ICkge1xuXHRcdFx0XHRcdGRlbGV0ZSB0aGlzLmludmFsaWRbIGNoZWNrRWxlbWVudC5uYW1lIF07XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5pbnZhbGlkWyBjaGVja0VsZW1lbnQubmFtZSBdID0gdHJ1ZTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0Ly8gQWRkIGFyaWEtaW52YWxpZCBzdGF0dXMgZm9yIHNjcmVlbiByZWFkZXJzXG5cdFx0XHQkKCBlbGVtZW50ICkuYXR0ciggXCJhcmlhLWludmFsaWRcIiwgIXJlc3VsdCApO1xuXG5cdFx0XHRpZiAoICF0aGlzLm51bWJlck9mSW52YWxpZHMoKSApIHtcblx0XHRcdFx0Ly8gSGlkZSBlcnJvciBjb250YWluZXJzIG9uIGxhc3QgZXJyb3Jcblx0XHRcdFx0dGhpcy50b0hpZGUgPSB0aGlzLnRvSGlkZS5hZGQoIHRoaXMuY29udGFpbmVycyApO1xuXHRcdFx0fVxuXHRcdFx0dGhpcy5zaG93RXJyb3JzKCk7XG5cdFx0XHRyZXR1cm4gcmVzdWx0O1xuXHRcdH0sXG5cblx0XHQvLyBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvVmFsaWRhdG9yLnNob3dFcnJvcnMvXG5cdFx0c2hvd0Vycm9yczogZnVuY3Rpb24oIGVycm9ycyApIHtcblx0XHRcdGlmICggZXJyb3JzICkge1xuXHRcdFx0XHQvLyBhZGQgaXRlbXMgdG8gZXJyb3IgbGlzdCBhbmQgbWFwXG5cdFx0XHRcdCQuZXh0ZW5kKCB0aGlzLmVycm9yTWFwLCBlcnJvcnMgKTtcblx0XHRcdFx0dGhpcy5lcnJvckxpc3QgPSBbXTtcblx0XHRcdFx0Zm9yICggdmFyIG5hbWUgaW4gZXJyb3JzICkge1xuXHRcdFx0XHRcdHRoaXMuZXJyb3JMaXN0LnB1c2goe1xuXHRcdFx0XHRcdFx0bWVzc2FnZTogZXJyb3JzWyBuYW1lIF0sXG5cdFx0XHRcdFx0XHRlbGVtZW50OiB0aGlzLmZpbmRCeU5hbWUoIG5hbWUgKVsgMCBdXG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdFx0Ly8gcmVtb3ZlIGl0ZW1zIGZyb20gc3VjY2VzcyBsaXN0XG5cdFx0XHRcdHRoaXMuc3VjY2Vzc0xpc3QgPSAkLmdyZXAoIHRoaXMuc3VjY2Vzc0xpc3QsIGZ1bmN0aW9uKCBlbGVtZW50ICkge1xuXHRcdFx0XHRcdHJldHVybiAhKCBlbGVtZW50Lm5hbWUgaW4gZXJyb3JzICk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdFx0aWYgKCB0aGlzLnNldHRpbmdzLnNob3dFcnJvcnMgKSB7XG5cdFx0XHRcdHRoaXMuc2V0dGluZ3Muc2hvd0Vycm9ycy5jYWxsKCB0aGlzLCB0aGlzLmVycm9yTWFwLCB0aGlzLmVycm9yTGlzdCApO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5kZWZhdWx0U2hvd0Vycm9ycygpO1xuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHQvLyBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvVmFsaWRhdG9yLnJlc2V0Rm9ybS9cblx0XHRyZXNldEZvcm06IGZ1bmN0aW9uKCkge1xuXHRcdFx0aWYgKCAkLmZuLnJlc2V0Rm9ybSApIHtcblx0XHRcdFx0JCggdGhpcy5jdXJyZW50Rm9ybSApLnJlc2V0Rm9ybSgpO1xuXHRcdFx0fVxuXHRcdFx0dGhpcy5zdWJtaXR0ZWQgPSB7fTtcblx0XHRcdHRoaXMubGFzdEVsZW1lbnQgPSBudWxsO1xuXHRcdFx0dGhpcy5wcmVwYXJlRm9ybSgpO1xuXHRcdFx0dGhpcy5oaWRlRXJyb3JzKCk7XG5cdFx0XHR0aGlzLmVsZW1lbnRzKClcblx0XHRcdFx0XHQucmVtb3ZlQ2xhc3MoIHRoaXMuc2V0dGluZ3MuZXJyb3JDbGFzcyApXG5cdFx0XHRcdFx0LnJlbW92ZURhdGEoIFwicHJldmlvdXNWYWx1ZVwiIClcblx0XHRcdFx0XHQucmVtb3ZlQXR0ciggXCJhcmlhLWludmFsaWRcIiApO1xuXHRcdH0sXG5cblx0XHRudW1iZXJPZkludmFsaWRzOiBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLm9iamVjdExlbmd0aCggdGhpcy5pbnZhbGlkICk7XG5cdFx0fSxcblxuXHRcdG9iamVjdExlbmd0aDogZnVuY3Rpb24oIG9iaiApIHtcblx0XHRcdC8qIGpzaGludCB1bnVzZWQ6IGZhbHNlICovXG5cdFx0XHR2YXIgY291bnQgPSAwLFxuXHRcdFx0XHRpO1xuXHRcdFx0Zm9yICggaSBpbiBvYmogKSB7XG5cdFx0XHRcdGNvdW50Kys7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gY291bnQ7XG5cdFx0fSxcblxuXHRcdGhpZGVFcnJvcnM6IGZ1bmN0aW9uKCkge1xuXHRcdFx0dGhpcy5oaWRlVGhlc2UoIHRoaXMudG9IaWRlICk7XG5cdFx0fSxcblxuXHRcdGhpZGVUaGVzZTogZnVuY3Rpb24oIGVycm9ycyApIHtcblx0XHRcdGVycm9ycy5ub3QoIHRoaXMuY29udGFpbmVycyApLnRleHQoIFwiXCIgKTtcblx0XHRcdHRoaXMuYWRkV3JhcHBlciggZXJyb3JzICkuaGlkZSgpO1xuXHRcdH0sXG5cblx0XHR2YWxpZDogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5zaXplKCkgPT09IDA7XG5cdFx0fSxcblxuXHRcdHNpemU6IGZ1bmN0aW9uKCkge1xuXHRcdFx0cmV0dXJuIHRoaXMuZXJyb3JMaXN0Lmxlbmd0aDtcblx0XHR9LFxuXG5cdFx0Zm9jdXNJbnZhbGlkOiBmdW5jdGlvbigpIHtcblx0XHRcdGlmICggdGhpcy5zZXR0aW5ncy5mb2N1c0ludmFsaWQgKSB7XG5cdFx0XHRcdHRyeSB7XG5cdFx0XHRcdFx0JCggdGhpcy5maW5kTGFzdEFjdGl2ZSgpIHx8IHRoaXMuZXJyb3JMaXN0Lmxlbmd0aCAmJiB0aGlzLmVycm9yTGlzdFsgMCBdLmVsZW1lbnQgfHwgW10pXG5cdFx0XHRcdFx0LmZpbHRlciggXCI6dmlzaWJsZVwiIClcblx0XHRcdFx0XHQuZm9jdXMoKVxuXHRcdFx0XHRcdC8vIG1hbnVhbGx5IHRyaWdnZXIgZm9jdXNpbiBldmVudDsgd2l0aG91dCBpdCwgZm9jdXNpbiBoYW5kbGVyIGlzbid0IGNhbGxlZCwgZmluZExhc3RBY3RpdmUgd29uJ3QgaGF2ZSBhbnl0aGluZyB0byBmaW5kXG5cdFx0XHRcdFx0LnRyaWdnZXIoIFwiZm9jdXNpblwiICk7XG5cdFx0XHRcdH0gY2F0Y2ggKCBlICkge1xuXHRcdFx0XHRcdC8vIGlnbm9yZSBJRSB0aHJvd2luZyBlcnJvcnMgd2hlbiBmb2N1c2luZyBoaWRkZW4gZWxlbWVudHNcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0sXG5cblx0XHRmaW5kTGFzdEFjdGl2ZTogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgbGFzdEFjdGl2ZSA9IHRoaXMubGFzdEFjdGl2ZTtcblx0XHRcdHJldHVybiBsYXN0QWN0aXZlICYmICQuZ3JlcCggdGhpcy5lcnJvckxpc3QsIGZ1bmN0aW9uKCBuICkge1xuXHRcdFx0XHRyZXR1cm4gbi5lbGVtZW50Lm5hbWUgPT09IGxhc3RBY3RpdmUubmFtZTtcblx0XHRcdH0pLmxlbmd0aCA9PT0gMSAmJiBsYXN0QWN0aXZlO1xuXHRcdH0sXG5cblx0XHRlbGVtZW50czogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgdmFsaWRhdG9yID0gdGhpcyxcblx0XHRcdFx0cnVsZXNDYWNoZSA9IHt9O1xuXG5cdFx0XHQvLyBzZWxlY3QgYWxsIHZhbGlkIGlucHV0cyBpbnNpZGUgdGhlIGZvcm0gKG5vIHN1Ym1pdCBvciByZXNldCBidXR0b25zKVxuXHRcdFx0cmV0dXJuICQoIHRoaXMuY3VycmVudEZvcm0gKVxuXHRcdFx0LmZpbmQoIFwiaW5wdXQsIHNlbGVjdCwgdGV4dGFyZWFcIiApXG5cdFx0XHQubm90KCBcIjpzdWJtaXQsIDpyZXNldCwgOmltYWdlLCBbZGlzYWJsZWRdLCBbcmVhZG9ubHldXCIgKVxuXHRcdFx0Lm5vdCggdGhpcy5zZXR0aW5ncy5pZ25vcmUgKVxuXHRcdFx0LmZpbHRlciggZnVuY3Rpb24oKSB7XG5cdFx0XHRcdGlmICggIXRoaXMubmFtZSAmJiB2YWxpZGF0b3Iuc2V0dGluZ3MuZGVidWcgJiYgd2luZG93LmNvbnNvbGUgKSB7XG5cdFx0XHRcdFx0Y29uc29sZS5lcnJvciggXCIlbyBoYXMgbm8gbmFtZSBhc3NpZ25lZFwiLCB0aGlzICk7XG5cdFx0XHRcdH1cblxuXHRcdFx0XHQvLyBzZWxlY3Qgb25seSB0aGUgZmlyc3QgZWxlbWVudCBmb3IgZWFjaCBuYW1lLCBhbmQgb25seSB0aG9zZSB3aXRoIHJ1bGVzIHNwZWNpZmllZFxuXHRcdFx0XHRpZiAoIHRoaXMubmFtZSBpbiBydWxlc0NhY2hlIHx8ICF2YWxpZGF0b3Iub2JqZWN0TGVuZ3RoKCAkKCB0aGlzICkucnVsZXMoKSApICkge1xuXHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdHJ1bGVzQ2FjaGVbIHRoaXMubmFtZSBdID0gdHJ1ZTtcblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9KTtcblx0XHR9LFxuXG5cdFx0Y2xlYW46IGZ1bmN0aW9uKCBzZWxlY3RvciApIHtcblx0XHRcdHJldHVybiAkKCBzZWxlY3RvciApWyAwIF07XG5cdFx0fSxcblxuXHRcdGVycm9yczogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgZXJyb3JDbGFzcyA9IHRoaXMuc2V0dGluZ3MuZXJyb3JDbGFzcy5zcGxpdCggXCIgXCIgKS5qb2luKCBcIi5cIiApO1xuXHRcdFx0cmV0dXJuICQoIHRoaXMuc2V0dGluZ3MuZXJyb3JFbGVtZW50ICsgXCIuXCIgKyBlcnJvckNsYXNzLCB0aGlzLmVycm9yQ29udGV4dCApO1xuXHRcdH0sXG5cblx0XHRyZXNldDogZnVuY3Rpb24oKSB7XG5cdFx0XHR0aGlzLnN1Y2Nlc3NMaXN0ID0gW107XG5cdFx0XHR0aGlzLmVycm9yTGlzdCA9IFtdO1xuXHRcdFx0dGhpcy5lcnJvck1hcCA9IHt9O1xuXHRcdFx0dGhpcy50b1Nob3cgPSAkKCBbXSApO1xuXHRcdFx0dGhpcy50b0hpZGUgPSAkKCBbXSApO1xuXHRcdFx0dGhpcy5jdXJyZW50RWxlbWVudHMgPSAkKCBbXSApO1xuXHRcdH0sXG5cblx0XHRwcmVwYXJlRm9ybTogZnVuY3Rpb24oKSB7XG5cdFx0XHR0aGlzLnJlc2V0KCk7XG5cdFx0XHR0aGlzLnRvSGlkZSA9IHRoaXMuZXJyb3JzKCkuYWRkKCB0aGlzLmNvbnRhaW5lcnMgKTtcblx0XHR9LFxuXG5cdFx0cHJlcGFyZUVsZW1lbnQ6IGZ1bmN0aW9uKCBlbGVtZW50ICkge1xuXHRcdFx0dGhpcy5yZXNldCgpO1xuXHRcdFx0dGhpcy50b0hpZGUgPSB0aGlzLmVycm9yc0ZvciggZWxlbWVudCApO1xuXHRcdH0sXG5cblx0XHRlbGVtZW50VmFsdWU6IGZ1bmN0aW9uKCBlbGVtZW50ICkge1xuXHRcdFx0dmFyIHZhbCxcblx0XHRcdFx0JGVsZW1lbnQgPSAkKCBlbGVtZW50ICksXG5cdFx0XHRcdHR5cGUgPSBlbGVtZW50LnR5cGU7XG5cblx0XHRcdGlmICggdHlwZSA9PT0gXCJyYWRpb1wiIHx8IHR5cGUgPT09IFwiY2hlY2tib3hcIiApIHtcblx0XHRcdFx0cmV0dXJuICQoIFwiaW5wdXRbbmFtZT0nXCIgKyBlbGVtZW50Lm5hbWUgKyBcIiddOmNoZWNrZWRcIiApLnZhbCgpO1xuXHRcdFx0fSBlbHNlIGlmICggdHlwZSA9PT0gXCJudW1iZXJcIiAmJiB0eXBlb2YgZWxlbWVudC52YWxpZGl0eSAhPT0gXCJ1bmRlZmluZWRcIiApIHtcblx0XHRcdFx0cmV0dXJuIGVsZW1lbnQudmFsaWRpdHkuYmFkSW5wdXQgPyBmYWxzZSA6ICRlbGVtZW50LnZhbCgpO1xuXHRcdFx0fVxuXG5cdFx0XHR2YWwgPSAkZWxlbWVudC52YWwoKTtcblx0XHRcdGlmICggdHlwZW9mIHZhbCA9PT0gXCJzdHJpbmdcIiApIHtcblx0XHRcdFx0cmV0dXJuIHZhbC5yZXBsYWNlKC9cXHIvZywgXCJcIiApO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHZhbDtcblx0XHR9LFxuXG5cdFx0Y2hlY2s6IGZ1bmN0aW9uKCBlbGVtZW50ICkge1xuXHRcdFx0ZWxlbWVudCA9IHRoaXMudmFsaWRhdGlvblRhcmdldEZvciggdGhpcy5jbGVhbiggZWxlbWVudCApICk7XG5cblx0XHRcdHZhciBydWxlcyA9ICQoIGVsZW1lbnQgKS5ydWxlcygpLFxuXHRcdFx0XHRydWxlc0NvdW50ID0gJC5tYXAoIHJ1bGVzLCBmdW5jdGlvbiggbiwgaSApIHtcblx0XHRcdFx0XHRyZXR1cm4gaTtcblx0XHRcdFx0fSkubGVuZ3RoLFxuXHRcdFx0XHRkZXBlbmRlbmN5TWlzbWF0Y2ggPSBmYWxzZSxcblx0XHRcdFx0dmFsID0gdGhpcy5lbGVtZW50VmFsdWUoIGVsZW1lbnQgKSxcblx0XHRcdFx0cmVzdWx0LCBtZXRob2QsIHJ1bGU7XG5cblx0XHRcdGZvciAoIG1ldGhvZCBpbiBydWxlcyApIHtcblx0XHRcdFx0cnVsZSA9IHsgbWV0aG9kOiBtZXRob2QsIHBhcmFtZXRlcnM6IHJ1bGVzWyBtZXRob2QgXSB9O1xuXHRcdFx0XHR0cnkge1xuXG5cdFx0XHRcdFx0cmVzdWx0ID0gJC52YWxpZGF0b3IubWV0aG9kc1sgbWV0aG9kIF0uY2FsbCggdGhpcywgdmFsLCBlbGVtZW50LCBydWxlLnBhcmFtZXRlcnMgKTtcblxuXHRcdFx0XHRcdC8vIGlmIGEgbWV0aG9kIGluZGljYXRlcyB0aGF0IHRoZSBmaWVsZCBpcyBvcHRpb25hbCBhbmQgdGhlcmVmb3JlIHZhbGlkLFxuXHRcdFx0XHRcdC8vIGRvbid0IG1hcmsgaXQgYXMgdmFsaWQgd2hlbiB0aGVyZSBhcmUgbm8gb3RoZXIgcnVsZXNcblx0XHRcdFx0XHRpZiAoIHJlc3VsdCA9PT0gXCJkZXBlbmRlbmN5LW1pc21hdGNoXCIgJiYgcnVsZXNDb3VudCA9PT0gMSApIHtcblx0XHRcdFx0XHRcdGRlcGVuZGVuY3lNaXNtYXRjaCA9IHRydWU7XG5cdFx0XHRcdFx0XHRjb250aW51ZTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0ZGVwZW5kZW5jeU1pc21hdGNoID0gZmFsc2U7XG5cblx0XHRcdFx0XHRpZiAoIHJlc3VsdCA9PT0gXCJwZW5kaW5nXCIgKSB7XG5cdFx0XHRcdFx0XHR0aGlzLnRvSGlkZSA9IHRoaXMudG9IaWRlLm5vdCggdGhpcy5lcnJvcnNGb3IoIGVsZW1lbnQgKSApO1xuXHRcdFx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0XHRcdH1cblxuXHRcdFx0XHRcdGlmICggIXJlc3VsdCApIHtcblx0XHRcdFx0XHRcdHRoaXMuZm9ybWF0QW5kQWRkKCBlbGVtZW50LCBydWxlICk7XG5cdFx0XHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9IGNhdGNoICggZSApIHtcblx0XHRcdFx0XHRpZiAoIHRoaXMuc2V0dGluZ3MuZGVidWcgJiYgd2luZG93LmNvbnNvbGUgKSB7XG5cdFx0XHRcdFx0XHRjb25zb2xlLmxvZyggXCJFeGNlcHRpb24gb2NjdXJyZWQgd2hlbiBjaGVja2luZyBlbGVtZW50IFwiICsgZWxlbWVudC5pZCArIFwiLCBjaGVjayB0aGUgJ1wiICsgcnVsZS5tZXRob2QgKyBcIicgbWV0aG9kLlwiLCBlICk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHRocm93IGU7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdGlmICggZGVwZW5kZW5jeU1pc21hdGNoICkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0XHRpZiAoIHRoaXMub2JqZWN0TGVuZ3RoKCBydWxlcyApICkge1xuXHRcdFx0XHR0aGlzLnN1Y2Nlc3NMaXN0LnB1c2goIGVsZW1lbnQgKTtcblx0XHRcdH1cblx0XHRcdHJldHVybiB0cnVlO1xuXHRcdH0sXG5cblx0XHQvLyByZXR1cm4gdGhlIGN1c3RvbSBtZXNzYWdlIGZvciB0aGUgZ2l2ZW4gZWxlbWVudCBhbmQgdmFsaWRhdGlvbiBtZXRob2Rcblx0XHQvLyBzcGVjaWZpZWQgaW4gdGhlIGVsZW1lbnQncyBIVE1MNSBkYXRhIGF0dHJpYnV0ZVxuXHRcdC8vIHJldHVybiB0aGUgZ2VuZXJpYyBtZXNzYWdlIGlmIHByZXNlbnQgYW5kIG5vIG1ldGhvZCBzcGVjaWZpYyBtZXNzYWdlIGlzIHByZXNlbnRcblx0XHRjdXN0b21EYXRhTWVzc2FnZTogZnVuY3Rpb24oIGVsZW1lbnQsIG1ldGhvZCApIHtcblx0XHRcdHJldHVybiAkKCBlbGVtZW50ICkuZGF0YSggXCJtc2dcIiArIG1ldGhvZC5jaGFyQXQoIDAgKS50b1VwcGVyQ2FzZSgpICtcblx0XHRcdFx0bWV0aG9kLnN1YnN0cmluZyggMSApLnRvTG93ZXJDYXNlKCkgKSB8fCAkKCBlbGVtZW50ICkuZGF0YSggXCJtc2dcIiApO1xuXHRcdH0sXG5cblx0XHQvLyByZXR1cm4gdGhlIGN1c3RvbSBtZXNzYWdlIGZvciB0aGUgZ2l2ZW4gZWxlbWVudCBuYW1lIGFuZCB2YWxpZGF0aW9uIG1ldGhvZFxuXHRcdGN1c3RvbU1lc3NhZ2U6IGZ1bmN0aW9uKCBuYW1lLCBtZXRob2QgKSB7XG5cdFx0XHR2YXIgbSA9IHRoaXMuc2V0dGluZ3MubWVzc2FnZXNbIG5hbWUgXTtcblx0XHRcdHJldHVybiBtICYmICggbS5jb25zdHJ1Y3RvciA9PT0gU3RyaW5nID8gbSA6IG1bIG1ldGhvZCBdKTtcblx0XHR9LFxuXG5cdFx0Ly8gcmV0dXJuIHRoZSBmaXJzdCBkZWZpbmVkIGFyZ3VtZW50LCBhbGxvd2luZyBlbXB0eSBzdHJpbmdzXG5cdFx0ZmluZERlZmluZWQ6IGZ1bmN0aW9uKCkge1xuXHRcdFx0Zm9yICggdmFyIGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSsrKSB7XG5cdFx0XHRcdGlmICggYXJndW1lbnRzWyBpIF0gIT09IHVuZGVmaW5lZCApIHtcblx0XHRcdFx0XHRyZXR1cm4gYXJndW1lbnRzWyBpIF07XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdHJldHVybiB1bmRlZmluZWQ7XG5cdFx0fSxcblxuXHRcdGRlZmF1bHRNZXNzYWdlOiBmdW5jdGlvbiggZWxlbWVudCwgbWV0aG9kICkge1xuXHRcdFx0cmV0dXJuIHRoaXMuZmluZERlZmluZWQoXG5cdFx0XHRcdHRoaXMuY3VzdG9tTWVzc2FnZSggZWxlbWVudC5uYW1lLCBtZXRob2QgKSxcblx0XHRcdFx0dGhpcy5jdXN0b21EYXRhTWVzc2FnZSggZWxlbWVudCwgbWV0aG9kICksXG5cdFx0XHRcdC8vIHRpdGxlIGlzIG5ldmVyIHVuZGVmaW5lZCwgc28gaGFuZGxlIGVtcHR5IHN0cmluZyBhcyB1bmRlZmluZWRcblx0XHRcdFx0IXRoaXMuc2V0dGluZ3MuaWdub3JlVGl0bGUgJiYgZWxlbWVudC50aXRsZSB8fCB1bmRlZmluZWQsXG5cdFx0XHRcdCQudmFsaWRhdG9yLm1lc3NhZ2VzWyBtZXRob2QgXSxcblx0XHRcdFx0XCI8c3Ryb25nPldhcm5pbmc6IE5vIG1lc3NhZ2UgZGVmaW5lZCBmb3IgXCIgKyBlbGVtZW50Lm5hbWUgKyBcIjwvc3Ryb25nPlwiXG5cdFx0XHQpO1xuXHRcdH0sXG5cblx0XHRmb3JtYXRBbmRBZGQ6IGZ1bmN0aW9uKCBlbGVtZW50LCBydWxlICkge1xuXHRcdFx0dmFyIG1lc3NhZ2UgPSB0aGlzLmRlZmF1bHRNZXNzYWdlKCBlbGVtZW50LCBydWxlLm1ldGhvZCApLFxuXHRcdFx0XHR0aGVyZWdleCA9IC9cXCQ/XFx7KFxcZCspXFx9L2c7XG5cdFx0XHRpZiAoIHR5cGVvZiBtZXNzYWdlID09PSBcImZ1bmN0aW9uXCIgKSB7XG5cdFx0XHRcdG1lc3NhZ2UgPSBtZXNzYWdlLmNhbGwoIHRoaXMsIHJ1bGUucGFyYW1ldGVycywgZWxlbWVudCApO1xuXHRcdFx0fSBlbHNlIGlmICggdGhlcmVnZXgudGVzdCggbWVzc2FnZSApICkge1xuXHRcdFx0XHRtZXNzYWdlID0gJC52YWxpZGF0b3IuZm9ybWF0KCBtZXNzYWdlLnJlcGxhY2UoIHRoZXJlZ2V4LCBcInskMX1cIiApLCBydWxlLnBhcmFtZXRlcnMgKTtcblx0XHRcdH1cblx0XHRcdHRoaXMuZXJyb3JMaXN0LnB1c2goe1xuXHRcdFx0XHRtZXNzYWdlOiBtZXNzYWdlLFxuXHRcdFx0XHRlbGVtZW50OiBlbGVtZW50LFxuXHRcdFx0XHRtZXRob2Q6IHJ1bGUubWV0aG9kXG5cdFx0XHR9KTtcblxuXHRcdFx0dGhpcy5lcnJvck1hcFsgZWxlbWVudC5uYW1lIF0gPSBtZXNzYWdlO1xuXHRcdFx0dGhpcy5zdWJtaXR0ZWRbIGVsZW1lbnQubmFtZSBdID0gbWVzc2FnZTtcblx0XHR9LFxuXG5cdFx0YWRkV3JhcHBlcjogZnVuY3Rpb24oIHRvVG9nZ2xlICkge1xuXHRcdFx0aWYgKCB0aGlzLnNldHRpbmdzLndyYXBwZXIgKSB7XG5cdFx0XHRcdHRvVG9nZ2xlID0gdG9Ub2dnbGUuYWRkKCB0b1RvZ2dsZS5wYXJlbnQoIHRoaXMuc2V0dGluZ3Mud3JhcHBlciApICk7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdG9Ub2dnbGU7XG5cdFx0fSxcblxuXHRcdGRlZmF1bHRTaG93RXJyb3JzOiBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBpLCBlbGVtZW50cywgZXJyb3I7XG5cdFx0XHRmb3IgKCBpID0gMDsgdGhpcy5lcnJvckxpc3RbIGkgXTsgaSsrICkge1xuXHRcdFx0XHRlcnJvciA9IHRoaXMuZXJyb3JMaXN0WyBpIF07XG5cdFx0XHRcdGlmICggdGhpcy5zZXR0aW5ncy5oaWdobGlnaHQgKSB7XG5cdFx0XHRcdFx0dGhpcy5zZXR0aW5ncy5oaWdobGlnaHQuY2FsbCggdGhpcywgZXJyb3IuZWxlbWVudCwgdGhpcy5zZXR0aW5ncy5lcnJvckNsYXNzLCB0aGlzLnNldHRpbmdzLnZhbGlkQ2xhc3MgKTtcblx0XHRcdFx0fVxuXHRcdFx0XHR0aGlzLnNob3dMYWJlbCggZXJyb3IuZWxlbWVudCwgZXJyb3IubWVzc2FnZSApO1xuXHRcdFx0fVxuXHRcdFx0aWYgKCB0aGlzLmVycm9yTGlzdC5sZW5ndGggKSB7XG5cdFx0XHRcdHRoaXMudG9TaG93ID0gdGhpcy50b1Nob3cuYWRkKCB0aGlzLmNvbnRhaW5lcnMgKTtcblx0XHRcdH1cblx0XHRcdGlmICggdGhpcy5zZXR0aW5ncy5zdWNjZXNzICkge1xuXHRcdFx0XHRmb3IgKCBpID0gMDsgdGhpcy5zdWNjZXNzTGlzdFsgaSBdOyBpKysgKSB7XG5cdFx0XHRcdFx0dGhpcy5zaG93TGFiZWwoIHRoaXMuc3VjY2Vzc0xpc3RbIGkgXSApO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRpZiAoIHRoaXMuc2V0dGluZ3MudW5oaWdobGlnaHQgKSB7XG5cdFx0XHRcdGZvciAoIGkgPSAwLCBlbGVtZW50cyA9IHRoaXMudmFsaWRFbGVtZW50cygpOyBlbGVtZW50c1sgaSBdOyBpKysgKSB7XG5cdFx0XHRcdFx0dGhpcy5zZXR0aW5ncy51bmhpZ2hsaWdodC5jYWxsKCB0aGlzLCBlbGVtZW50c1sgaSBdLCB0aGlzLnNldHRpbmdzLmVycm9yQ2xhc3MsIHRoaXMuc2V0dGluZ3MudmFsaWRDbGFzcyApO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHR0aGlzLnRvSGlkZSA9IHRoaXMudG9IaWRlLm5vdCggdGhpcy50b1Nob3cgKTtcblx0XHRcdHRoaXMuaGlkZUVycm9ycygpO1xuXHRcdFx0dGhpcy5hZGRXcmFwcGVyKCB0aGlzLnRvU2hvdyApLnNob3coKTtcblx0XHR9LFxuXG5cdFx0dmFsaWRFbGVtZW50czogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5jdXJyZW50RWxlbWVudHMubm90KCB0aGlzLmludmFsaWRFbGVtZW50cygpICk7XG5cdFx0fSxcblxuXHRcdGludmFsaWRFbGVtZW50czogZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gJCggdGhpcy5lcnJvckxpc3QgKS5tYXAoZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHJldHVybiB0aGlzLmVsZW1lbnQ7XG5cdFx0XHR9KTtcblx0XHR9LFxuXG5cdFx0c2hvd0xhYmVsOiBmdW5jdGlvbiggZWxlbWVudCwgbWVzc2FnZSApIHtcblx0XHRcdHZhciBwbGFjZSwgZ3JvdXAsIGVycm9ySUQsXG5cdFx0XHRcdGVycm9yID0gdGhpcy5lcnJvcnNGb3IoIGVsZW1lbnQgKSxcblx0XHRcdFx0ZWxlbWVudElEID0gdGhpcy5pZE9yTmFtZSggZWxlbWVudCApLFxuXHRcdFx0XHRkZXNjcmliZWRCeSA9ICQoIGVsZW1lbnQgKS5hdHRyKCBcImFyaWEtZGVzY3JpYmVkYnlcIiApO1xuXHRcdFx0aWYgKCBlcnJvci5sZW5ndGggKSB7XG5cdFx0XHRcdC8vIHJlZnJlc2ggZXJyb3Ivc3VjY2VzcyBjbGFzc1xuXHRcdFx0XHRlcnJvci5yZW1vdmVDbGFzcyggdGhpcy5zZXR0aW5ncy52YWxpZENsYXNzICkuYWRkQ2xhc3MoIHRoaXMuc2V0dGluZ3MuZXJyb3JDbGFzcyApO1xuXHRcdFx0XHQvLyByZXBsYWNlIG1lc3NhZ2Ugb24gZXhpc3RpbmcgbGFiZWxcblx0XHRcdFx0ZXJyb3IuaHRtbCggbWVzc2FnZSApO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0Ly8gY3JlYXRlIGVycm9yIGVsZW1lbnRcblx0XHRcdFx0ZXJyb3IgPSAkKCBcIjxcIiArIHRoaXMuc2V0dGluZ3MuZXJyb3JFbGVtZW50ICsgXCI+XCIgKVxuXHRcdFx0XHRcdC5hdHRyKCBcImlkXCIsIGVsZW1lbnRJRCArIFwiLWVycm9yXCIgKVxuXHRcdFx0XHRcdC5hZGRDbGFzcyggdGhpcy5zZXR0aW5ncy5lcnJvckNsYXNzIClcblx0XHRcdFx0XHQuaHRtbCggbWVzc2FnZSB8fCBcIlwiICk7XG5cblx0XHRcdFx0Ly8gTWFpbnRhaW4gcmVmZXJlbmNlIHRvIHRoZSBlbGVtZW50IHRvIGJlIHBsYWNlZCBpbnRvIHRoZSBET01cblx0XHRcdFx0cGxhY2UgPSBlcnJvcjtcblx0XHRcdFx0aWYgKCB0aGlzLnNldHRpbmdzLndyYXBwZXIgKSB7XG5cdFx0XHRcdFx0Ly8gbWFrZSBzdXJlIHRoZSBlbGVtZW50IGlzIHZpc2libGUsIGV2ZW4gaW4gSUVcblx0XHRcdFx0XHQvLyBhY3R1YWxseSBzaG93aW5nIHRoZSB3cmFwcGVkIGVsZW1lbnQgaXMgaGFuZGxlZCBlbHNld2hlcmVcblx0XHRcdFx0XHRwbGFjZSA9IGVycm9yLmhpZGUoKS5zaG93KCkud3JhcCggXCI8XCIgKyB0aGlzLnNldHRpbmdzLndyYXBwZXIgKyBcIi8+XCIgKS5wYXJlbnQoKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRpZiAoIHRoaXMubGFiZWxDb250YWluZXIubGVuZ3RoICkge1xuXHRcdFx0XHRcdHRoaXMubGFiZWxDb250YWluZXIuYXBwZW5kKCBwbGFjZSApO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCB0aGlzLnNldHRpbmdzLmVycm9yUGxhY2VtZW50ICkge1xuXHRcdFx0XHRcdHRoaXMuc2V0dGluZ3MuZXJyb3JQbGFjZW1lbnQoIHBsYWNlLCAkKCBlbGVtZW50ICkgKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRwbGFjZS5pbnNlcnRBZnRlciggZWxlbWVudCApO1xuXHRcdFx0XHR9XG5cblx0XHRcdFx0Ly8gTGluayBlcnJvciBiYWNrIHRvIHRoZSBlbGVtZW50XG5cdFx0XHRcdGlmICggZXJyb3IuaXMoIFwibGFiZWxcIiApICkge1xuXHRcdFx0XHRcdC8vIElmIHRoZSBlcnJvciBpcyBhIGxhYmVsLCB0aGVuIGFzc29jaWF0ZSB1c2luZyAnZm9yJ1xuXHRcdFx0XHRcdGVycm9yLmF0dHIoIFwiZm9yXCIsIGVsZW1lbnRJRCApO1xuXHRcdFx0XHR9IGVsc2UgaWYgKCBlcnJvci5wYXJlbnRzKCBcImxhYmVsW2Zvcj0nXCIgKyBlbGVtZW50SUQgKyBcIiddXCIgKS5sZW5ndGggPT09IDAgKSB7XG5cdFx0XHRcdFx0Ly8gSWYgdGhlIGVsZW1lbnQgaXMgbm90IGEgY2hpbGQgb2YgYW4gYXNzb2NpYXRlZCBsYWJlbCwgdGhlbiBpdCdzIG5lY2Vzc2FyeVxuXHRcdFx0XHRcdC8vIHRvIGV4cGxpY2l0bHkgYXBwbHkgYXJpYS1kZXNjcmliZWRieVxuXG5cdFx0XHRcdFx0ZXJyb3JJRCA9IGVycm9yLmF0dHIoIFwiaWRcIiApLnJlcGxhY2UoIC8oOnxcXC58XFxbfFxcXSkvZywgXCJcXFxcJDFcIik7XG5cdFx0XHRcdFx0Ly8gUmVzcGVjdCBleGlzdGluZyBub24tZXJyb3IgYXJpYS1kZXNjcmliZWRieVxuXHRcdFx0XHRcdGlmICggIWRlc2NyaWJlZEJ5ICkge1xuXHRcdFx0XHRcdFx0ZGVzY3JpYmVkQnkgPSBlcnJvcklEO1xuXHRcdFx0XHRcdH0gZWxzZSBpZiAoICFkZXNjcmliZWRCeS5tYXRjaCggbmV3IFJlZ0V4cCggXCJcXFxcYlwiICsgZXJyb3JJRCArIFwiXFxcXGJcIiApICkgKSB7XG5cdFx0XHRcdFx0XHQvLyBBZGQgdG8gZW5kIG9mIGxpc3QgaWYgbm90IGFscmVhZHkgcHJlc2VudFxuXHRcdFx0XHRcdFx0ZGVzY3JpYmVkQnkgKz0gXCIgXCIgKyBlcnJvcklEO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHQkKCBlbGVtZW50ICkuYXR0ciggXCJhcmlhLWRlc2NyaWJlZGJ5XCIsIGRlc2NyaWJlZEJ5ICk7XG5cblx0XHRcdFx0XHQvLyBJZiB0aGlzIGVsZW1lbnQgaXMgZ3JvdXBlZCwgdGhlbiBhc3NpZ24gdG8gYWxsIGVsZW1lbnRzIGluIHRoZSBzYW1lIGdyb3VwXG5cdFx0XHRcdFx0Z3JvdXAgPSB0aGlzLmdyb3Vwc1sgZWxlbWVudC5uYW1lIF07XG5cdFx0XHRcdFx0aWYgKCBncm91cCApIHtcblx0XHRcdFx0XHRcdCQuZWFjaCggdGhpcy5ncm91cHMsIGZ1bmN0aW9uKCBuYW1lLCB0ZXN0Z3JvdXAgKSB7XG5cdFx0XHRcdFx0XHRcdGlmICggdGVzdGdyb3VwID09PSBncm91cCApIHtcblx0XHRcdFx0XHRcdFx0XHQkKCBcIltuYW1lPSdcIiArIG5hbWUgKyBcIiddXCIsIHRoaXMuY3VycmVudEZvcm0gKVxuXHRcdFx0XHRcdFx0XHRcdFx0LmF0dHIoIFwiYXJpYS1kZXNjcmliZWRieVwiLCBlcnJvci5hdHRyKCBcImlkXCIgKSApO1xuXHRcdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdGlmICggIW1lc3NhZ2UgJiYgdGhpcy5zZXR0aW5ncy5zdWNjZXNzICkge1xuXHRcdFx0XHRlcnJvci50ZXh0KCBcIlwiICk7XG5cdFx0XHRcdGlmICggdHlwZW9mIHRoaXMuc2V0dGluZ3Muc3VjY2VzcyA9PT0gXCJzdHJpbmdcIiApIHtcblx0XHRcdFx0XHRlcnJvci5hZGRDbGFzcyggdGhpcy5zZXR0aW5ncy5zdWNjZXNzICk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0dGhpcy5zZXR0aW5ncy5zdWNjZXNzKCBlcnJvciwgZWxlbWVudCApO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHR0aGlzLnRvU2hvdyA9IHRoaXMudG9TaG93LmFkZCggZXJyb3IgKTtcblx0XHR9LFxuXG5cdFx0ZXJyb3JzRm9yOiBmdW5jdGlvbiggZWxlbWVudCApIHtcblx0XHRcdHZhciBuYW1lID0gdGhpcy5pZE9yTmFtZSggZWxlbWVudCApLFxuXHRcdFx0XHRkZXNjcmliZXIgPSAkKCBlbGVtZW50ICkuYXR0ciggXCJhcmlhLWRlc2NyaWJlZGJ5XCIgKSxcblx0XHRcdFx0c2VsZWN0b3IgPSBcImxhYmVsW2Zvcj0nXCIgKyBuYW1lICsgXCInXSwgbGFiZWxbZm9yPSdcIiArIG5hbWUgKyBcIiddICpcIjtcblxuXHRcdFx0Ly8gYXJpYS1kZXNjcmliZWRieSBzaG91bGQgZGlyZWN0bHkgcmVmZXJlbmNlIHRoZSBlcnJvciBlbGVtZW50XG5cdFx0XHRpZiAoIGRlc2NyaWJlciApIHtcblx0XHRcdFx0c2VsZWN0b3IgPSBzZWxlY3RvciArIFwiLCAjXCIgKyBkZXNjcmliZXIucmVwbGFjZSggL1xccysvZywgXCIsICNcIiApO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXNcblx0XHRcdFx0LmVycm9ycygpXG5cdFx0XHRcdC5maWx0ZXIoIHNlbGVjdG9yICk7XG5cdFx0fSxcblxuXHRcdGlkT3JOYW1lOiBmdW5jdGlvbiggZWxlbWVudCApIHtcblx0XHRcdHJldHVybiB0aGlzLmdyb3Vwc1sgZWxlbWVudC5uYW1lIF0gfHwgKCB0aGlzLmNoZWNrYWJsZSggZWxlbWVudCApID8gZWxlbWVudC5uYW1lIDogZWxlbWVudC5pZCB8fCBlbGVtZW50Lm5hbWUgKTtcblx0XHR9LFxuXG5cdFx0dmFsaWRhdGlvblRhcmdldEZvcjogZnVuY3Rpb24oIGVsZW1lbnQgKSB7XG5cblx0XHRcdC8vIElmIHJhZGlvL2NoZWNrYm94LCB2YWxpZGF0ZSBmaXJzdCBlbGVtZW50IGluIGdyb3VwIGluc3RlYWRcblx0XHRcdGlmICggdGhpcy5jaGVja2FibGUoIGVsZW1lbnQgKSApIHtcblx0XHRcdFx0ZWxlbWVudCA9IHRoaXMuZmluZEJ5TmFtZSggZWxlbWVudC5uYW1lICk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIEFsd2F5cyBhcHBseSBpZ25vcmUgZmlsdGVyXG5cdFx0XHRyZXR1cm4gJCggZWxlbWVudCApLm5vdCggdGhpcy5zZXR0aW5ncy5pZ25vcmUgKVsgMCBdO1xuXHRcdH0sXG5cblx0XHRjaGVja2FibGU6IGZ1bmN0aW9uKCBlbGVtZW50ICkge1xuXHRcdFx0cmV0dXJuICggL3JhZGlvfGNoZWNrYm94L2kgKS50ZXN0KCBlbGVtZW50LnR5cGUgKTtcblx0XHR9LFxuXG5cdFx0ZmluZEJ5TmFtZTogZnVuY3Rpb24oIG5hbWUgKSB7XG5cdFx0XHRyZXR1cm4gJCggdGhpcy5jdXJyZW50Rm9ybSApLmZpbmQoIFwiW25hbWU9J1wiICsgbmFtZSArIFwiJ11cIiApO1xuXHRcdH0sXG5cblx0XHRnZXRMZW5ndGg6IGZ1bmN0aW9uKCB2YWx1ZSwgZWxlbWVudCApIHtcblx0XHRcdHN3aXRjaCAoIGVsZW1lbnQubm9kZU5hbWUudG9Mb3dlckNhc2UoKSApIHtcblx0XHRcdGNhc2UgXCJzZWxlY3RcIjpcblx0XHRcdFx0cmV0dXJuICQoIFwib3B0aW9uOnNlbGVjdGVkXCIsIGVsZW1lbnQgKS5sZW5ndGg7XG5cdFx0XHRjYXNlIFwiaW5wdXRcIjpcblx0XHRcdFx0aWYgKCB0aGlzLmNoZWNrYWJsZSggZWxlbWVudCApICkge1xuXHRcdFx0XHRcdHJldHVybiB0aGlzLmZpbmRCeU5hbWUoIGVsZW1lbnQubmFtZSApLmZpbHRlciggXCI6Y2hlY2tlZFwiICkubGVuZ3RoO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdmFsdWUubGVuZ3RoO1xuXHRcdH0sXG5cblx0XHRkZXBlbmQ6IGZ1bmN0aW9uKCBwYXJhbSwgZWxlbWVudCApIHtcblx0XHRcdHJldHVybiB0aGlzLmRlcGVuZFR5cGVzW3R5cGVvZiBwYXJhbV0gPyB0aGlzLmRlcGVuZFR5cGVzW3R5cGVvZiBwYXJhbV0oIHBhcmFtLCBlbGVtZW50ICkgOiB0cnVlO1xuXHRcdH0sXG5cblx0XHRkZXBlbmRUeXBlczoge1xuXHRcdFx0XCJib29sZWFuXCI6IGZ1bmN0aW9uKCBwYXJhbSApIHtcblx0XHRcdFx0cmV0dXJuIHBhcmFtO1xuXHRcdFx0fSxcblx0XHRcdFwic3RyaW5nXCI6IGZ1bmN0aW9uKCBwYXJhbSwgZWxlbWVudCApIHtcblx0XHRcdFx0cmV0dXJuICEhJCggcGFyYW0sIGVsZW1lbnQuZm9ybSApLmxlbmd0aDtcblx0XHRcdH0sXG5cdFx0XHRcImZ1bmN0aW9uXCI6IGZ1bmN0aW9uKCBwYXJhbSwgZWxlbWVudCApIHtcblx0XHRcdFx0cmV0dXJuIHBhcmFtKCBlbGVtZW50ICk7XG5cdFx0XHR9XG5cdFx0fSxcblxuXHRcdG9wdGlvbmFsOiBmdW5jdGlvbiggZWxlbWVudCApIHtcblx0XHRcdHZhciB2YWwgPSB0aGlzLmVsZW1lbnRWYWx1ZSggZWxlbWVudCApO1xuXHRcdFx0cmV0dXJuICEkLnZhbGlkYXRvci5tZXRob2RzLnJlcXVpcmVkLmNhbGwoIHRoaXMsIHZhbCwgZWxlbWVudCApICYmIFwiZGVwZW5kZW5jeS1taXNtYXRjaFwiO1xuXHRcdH0sXG5cblx0XHRzdGFydFJlcXVlc3Q6IGZ1bmN0aW9uKCBlbGVtZW50ICkge1xuXHRcdFx0aWYgKCAhdGhpcy5wZW5kaW5nWyBlbGVtZW50Lm5hbWUgXSApIHtcblx0XHRcdFx0dGhpcy5wZW5kaW5nUmVxdWVzdCsrO1xuXHRcdFx0XHR0aGlzLnBlbmRpbmdbIGVsZW1lbnQubmFtZSBdID0gdHJ1ZTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0c3RvcFJlcXVlc3Q6IGZ1bmN0aW9uKCBlbGVtZW50LCB2YWxpZCApIHtcblx0XHRcdHRoaXMucGVuZGluZ1JlcXVlc3QtLTtcblx0XHRcdC8vIHNvbWV0aW1lcyBzeW5jaHJvbml6YXRpb24gZmFpbHMsIG1ha2Ugc3VyZSBwZW5kaW5nUmVxdWVzdCBpcyBuZXZlciA8IDBcblx0XHRcdGlmICggdGhpcy5wZW5kaW5nUmVxdWVzdCA8IDAgKSB7XG5cdFx0XHRcdHRoaXMucGVuZGluZ1JlcXVlc3QgPSAwO1xuXHRcdFx0fVxuXHRcdFx0ZGVsZXRlIHRoaXMucGVuZGluZ1sgZWxlbWVudC5uYW1lIF07XG5cdFx0XHRpZiAoIHZhbGlkICYmIHRoaXMucGVuZGluZ1JlcXVlc3QgPT09IDAgJiYgdGhpcy5mb3JtU3VibWl0dGVkICYmIHRoaXMuZm9ybSgpICkge1xuXHRcdFx0XHQkKCB0aGlzLmN1cnJlbnRGb3JtICkuc3VibWl0KCk7XG5cdFx0XHRcdHRoaXMuZm9ybVN1Ym1pdHRlZCA9IGZhbHNlO1xuXHRcdFx0fSBlbHNlIGlmICghdmFsaWQgJiYgdGhpcy5wZW5kaW5nUmVxdWVzdCA9PT0gMCAmJiB0aGlzLmZvcm1TdWJtaXR0ZWQgKSB7XG5cdFx0XHRcdCQoIHRoaXMuY3VycmVudEZvcm0gKS50cmlnZ2VySGFuZGxlciggXCJpbnZhbGlkLWZvcm1cIiwgWyB0aGlzIF0pO1xuXHRcdFx0XHR0aGlzLmZvcm1TdWJtaXR0ZWQgPSBmYWxzZTtcblx0XHRcdH1cblx0XHR9LFxuXG5cdFx0cHJldmlvdXNWYWx1ZTogZnVuY3Rpb24oIGVsZW1lbnQgKSB7XG5cdFx0XHRyZXR1cm4gJC5kYXRhKCBlbGVtZW50LCBcInByZXZpb3VzVmFsdWVcIiApIHx8ICQuZGF0YSggZWxlbWVudCwgXCJwcmV2aW91c1ZhbHVlXCIsIHtcblx0XHRcdFx0b2xkOiBudWxsLFxuXHRcdFx0XHR2YWxpZDogdHJ1ZSxcblx0XHRcdFx0bWVzc2FnZTogdGhpcy5kZWZhdWx0TWVzc2FnZSggZWxlbWVudCwgXCJyZW1vdGVcIiApXG5cdFx0XHR9KTtcblx0XHR9XG5cblx0fSxcblxuXHRjbGFzc1J1bGVTZXR0aW5nczoge1xuXHRcdHJlcXVpcmVkOiB7IHJlcXVpcmVkOiB0cnVlIH0sXG5cdFx0ZW1haWw6IHsgZW1haWw6IHRydWUgfSxcblx0XHR1cmw6IHsgdXJsOiB0cnVlIH0sXG5cdFx0ZGF0ZTogeyBkYXRlOiB0cnVlIH0sXG5cdFx0ZGF0ZUlTTzogeyBkYXRlSVNPOiB0cnVlIH0sXG5cdFx0bnVtYmVyOiB7IG51bWJlcjogdHJ1ZSB9LFxuXHRcdGRpZ2l0czogeyBkaWdpdHM6IHRydWUgfSxcblx0XHRjcmVkaXRjYXJkOiB7IGNyZWRpdGNhcmQ6IHRydWUgfVxuXHR9LFxuXG5cdGFkZENsYXNzUnVsZXM6IGZ1bmN0aW9uKCBjbGFzc05hbWUsIHJ1bGVzICkge1xuXHRcdGlmICggY2xhc3NOYW1lLmNvbnN0cnVjdG9yID09PSBTdHJpbmcgKSB7XG5cdFx0XHR0aGlzLmNsYXNzUnVsZVNldHRpbmdzWyBjbGFzc05hbWUgXSA9IHJ1bGVzO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHQkLmV4dGVuZCggdGhpcy5jbGFzc1J1bGVTZXR0aW5ncywgY2xhc3NOYW1lICk7XG5cdFx0fVxuXHR9LFxuXG5cdGNsYXNzUnVsZXM6IGZ1bmN0aW9uKCBlbGVtZW50ICkge1xuXHRcdHZhciBydWxlcyA9IHt9LFxuXHRcdFx0Y2xhc3NlcyA9ICQoIGVsZW1lbnQgKS5hdHRyKCBcImNsYXNzXCIgKTtcblxuXHRcdGlmICggY2xhc3NlcyApIHtcblx0XHRcdCQuZWFjaCggY2xhc3Nlcy5zcGxpdCggXCIgXCIgKSwgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdGlmICggdGhpcyBpbiAkLnZhbGlkYXRvci5jbGFzc1J1bGVTZXR0aW5ncyApIHtcblx0XHRcdFx0XHQkLmV4dGVuZCggcnVsZXMsICQudmFsaWRhdG9yLmNsYXNzUnVsZVNldHRpbmdzWyB0aGlzIF0pO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHR9XG5cdFx0cmV0dXJuIHJ1bGVzO1xuXHR9LFxuXG5cdGF0dHJpYnV0ZVJ1bGVzOiBmdW5jdGlvbiggZWxlbWVudCApIHtcblx0XHR2YXIgcnVsZXMgPSB7fSxcblx0XHRcdCRlbGVtZW50ID0gJCggZWxlbWVudCApLFxuXHRcdFx0dHlwZSA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCBcInR5cGVcIiApLFxuXHRcdFx0bWV0aG9kLCB2YWx1ZTtcblxuXHRcdGZvciAoIG1ldGhvZCBpbiAkLnZhbGlkYXRvci5tZXRob2RzICkge1xuXG5cdFx0XHQvLyBzdXBwb3J0IGZvciA8aW5wdXQgcmVxdWlyZWQ+IGluIGJvdGggaHRtbDUgYW5kIG9sZGVyIGJyb3dzZXJzXG5cdFx0XHRpZiAoIG1ldGhvZCA9PT0gXCJyZXF1aXJlZFwiICkge1xuXHRcdFx0XHR2YWx1ZSA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKCBtZXRob2QgKTtcblx0XHRcdFx0Ly8gU29tZSBicm93c2VycyByZXR1cm4gYW4gZW1wdHkgc3RyaW5nIGZvciB0aGUgcmVxdWlyZWQgYXR0cmlidXRlXG5cdFx0XHRcdC8vIGFuZCBub24tSFRNTDUgYnJvd3NlcnMgbWlnaHQgaGF2ZSByZXF1aXJlZD1cIlwiIG1hcmt1cFxuXHRcdFx0XHRpZiAoIHZhbHVlID09PSBcIlwiICkge1xuXHRcdFx0XHRcdHZhbHVlID0gdHJ1ZTtcblx0XHRcdFx0fVxuXHRcdFx0XHQvLyBmb3JjZSBub24tSFRNTDUgYnJvd3NlcnMgdG8gcmV0dXJuIGJvb2xcblx0XHRcdFx0dmFsdWUgPSAhIXZhbHVlO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dmFsdWUgPSAkZWxlbWVudC5hdHRyKCBtZXRob2QgKTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gY29udmVydCB0aGUgdmFsdWUgdG8gYSBudW1iZXIgZm9yIG51bWJlciBpbnB1dHMsIGFuZCBmb3IgdGV4dCBmb3IgYmFja3dhcmRzIGNvbXBhYmlsaXR5XG5cdFx0XHQvLyBhbGxvd3MgdHlwZT1cImRhdGVcIiBhbmQgb3RoZXJzIHRvIGJlIGNvbXBhcmVkIGFzIHN0cmluZ3Ncblx0XHRcdGlmICggL21pbnxtYXgvLnRlc3QoIG1ldGhvZCApICYmICggdHlwZSA9PT0gbnVsbCB8fCAvbnVtYmVyfHJhbmdlfHRleHQvLnRlc3QoIHR5cGUgKSApICkge1xuXHRcdFx0XHR2YWx1ZSA9IE51bWJlciggdmFsdWUgKTtcblx0XHRcdH1cblxuXHRcdFx0aWYgKCB2YWx1ZSB8fCB2YWx1ZSA9PT0gMCApIHtcblx0XHRcdFx0cnVsZXNbIG1ldGhvZCBdID0gdmFsdWU7XG5cdFx0XHR9IGVsc2UgaWYgKCB0eXBlID09PSBtZXRob2QgJiYgdHlwZSAhPT0gXCJyYW5nZVwiICkge1xuXHRcdFx0XHQvLyBleGNlcHRpb246IHRoZSBqcXVlcnkgdmFsaWRhdGUgJ3JhbmdlJyBtZXRob2Rcblx0XHRcdFx0Ly8gZG9lcyBub3QgdGVzdCBmb3IgdGhlIGh0bWw1ICdyYW5nZScgdHlwZVxuXHRcdFx0XHRydWxlc1sgbWV0aG9kIF0gPSB0cnVlO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8vIG1heGxlbmd0aCBtYXkgYmUgcmV0dXJuZWQgYXMgLTEsIDIxNDc0ODM2NDcgKCBJRSApIGFuZCA1MjQyODggKCBzYWZhcmkgKSBmb3IgdGV4dCBpbnB1dHNcblx0XHRpZiAoIHJ1bGVzLm1heGxlbmd0aCAmJiAvLTF8MjE0NzQ4MzY0N3w1MjQyODgvLnRlc3QoIHJ1bGVzLm1heGxlbmd0aCApICkge1xuXHRcdFx0ZGVsZXRlIHJ1bGVzLm1heGxlbmd0aDtcblx0XHR9XG5cblx0XHRyZXR1cm4gcnVsZXM7XG5cdH0sXG5cblx0ZGF0YVJ1bGVzOiBmdW5jdGlvbiggZWxlbWVudCApIHtcblx0XHR2YXIgbWV0aG9kLCB2YWx1ZSxcblx0XHRcdHJ1bGVzID0ge30sICRlbGVtZW50ID0gJCggZWxlbWVudCApO1xuXHRcdGZvciAoIG1ldGhvZCBpbiAkLnZhbGlkYXRvci5tZXRob2RzICkge1xuXHRcdFx0dmFsdWUgPSAkZWxlbWVudC5kYXRhKCBcInJ1bGVcIiArIG1ldGhvZC5jaGFyQXQoIDAgKS50b1VwcGVyQ2FzZSgpICsgbWV0aG9kLnN1YnN0cmluZyggMSApLnRvTG93ZXJDYXNlKCkgKTtcblx0XHRcdGlmICggdmFsdWUgIT09IHVuZGVmaW5lZCApIHtcblx0XHRcdFx0cnVsZXNbIG1ldGhvZCBdID0gdmFsdWU7XG5cdFx0XHR9XG5cdFx0fVxuXHRcdHJldHVybiBydWxlcztcblx0fSxcblxuXHRzdGF0aWNSdWxlczogZnVuY3Rpb24oIGVsZW1lbnQgKSB7XG5cdFx0dmFyIHJ1bGVzID0ge30sXG5cdFx0XHR2YWxpZGF0b3IgPSAkLmRhdGEoIGVsZW1lbnQuZm9ybSwgXCJ2YWxpZGF0b3JcIiApO1xuXG5cdFx0aWYgKCB2YWxpZGF0b3Iuc2V0dGluZ3MucnVsZXMgKSB7XG5cdFx0XHRydWxlcyA9ICQudmFsaWRhdG9yLm5vcm1hbGl6ZVJ1bGUoIHZhbGlkYXRvci5zZXR0aW5ncy5ydWxlc1sgZWxlbWVudC5uYW1lIF0gKSB8fCB7fTtcblx0XHR9XG5cdFx0cmV0dXJuIHJ1bGVzO1xuXHR9LFxuXG5cdG5vcm1hbGl6ZVJ1bGVzOiBmdW5jdGlvbiggcnVsZXMsIGVsZW1lbnQgKSB7XG5cdFx0Ly8gaGFuZGxlIGRlcGVuZGVuY3kgY2hlY2tcblx0XHQkLmVhY2goIHJ1bGVzLCBmdW5jdGlvbiggcHJvcCwgdmFsICkge1xuXHRcdFx0Ly8gaWdub3JlIHJ1bGUgd2hlbiBwYXJhbSBpcyBleHBsaWNpdGx5IGZhbHNlLCBlZy4gcmVxdWlyZWQ6ZmFsc2Vcblx0XHRcdGlmICggdmFsID09PSBmYWxzZSApIHtcblx0XHRcdFx0ZGVsZXRlIHJ1bGVzWyBwcm9wIF07XG5cdFx0XHRcdHJldHVybjtcblx0XHRcdH1cblx0XHRcdGlmICggdmFsLnBhcmFtIHx8IHZhbC5kZXBlbmRzICkge1xuXHRcdFx0XHR2YXIga2VlcFJ1bGUgPSB0cnVlO1xuXHRcdFx0XHRzd2l0Y2ggKCB0eXBlb2YgdmFsLmRlcGVuZHMgKSB7XG5cdFx0XHRcdGNhc2UgXCJzdHJpbmdcIjpcblx0XHRcdFx0XHRrZWVwUnVsZSA9ICEhJCggdmFsLmRlcGVuZHMsIGVsZW1lbnQuZm9ybSApLmxlbmd0aDtcblx0XHRcdFx0XHRicmVhaztcblx0XHRcdFx0Y2FzZSBcImZ1bmN0aW9uXCI6XG5cdFx0XHRcdFx0a2VlcFJ1bGUgPSB2YWwuZGVwZW5kcy5jYWxsKCBlbGVtZW50LCBlbGVtZW50ICk7XG5cdFx0XHRcdFx0YnJlYWs7XG5cdFx0XHRcdH1cblx0XHRcdFx0aWYgKCBrZWVwUnVsZSApIHtcblx0XHRcdFx0XHRydWxlc1sgcHJvcCBdID0gdmFsLnBhcmFtICE9PSB1bmRlZmluZWQgPyB2YWwucGFyYW0gOiB0cnVlO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGRlbGV0ZSBydWxlc1sgcHJvcCBdO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fSk7XG5cblx0XHQvLyBldmFsdWF0ZSBwYXJhbWV0ZXJzXG5cdFx0JC5lYWNoKCBydWxlcywgZnVuY3Rpb24oIHJ1bGUsIHBhcmFtZXRlciApIHtcblx0XHRcdHJ1bGVzWyBydWxlIF0gPSAkLmlzRnVuY3Rpb24oIHBhcmFtZXRlciApID8gcGFyYW1ldGVyKCBlbGVtZW50ICkgOiBwYXJhbWV0ZXI7XG5cdFx0fSk7XG5cblx0XHQvLyBjbGVhbiBudW1iZXIgcGFyYW1ldGVyc1xuXHRcdCQuZWFjaChbIFwibWlubGVuZ3RoXCIsIFwibWF4bGVuZ3RoXCIgXSwgZnVuY3Rpb24oKSB7XG5cdFx0XHRpZiAoIHJ1bGVzWyB0aGlzIF0gKSB7XG5cdFx0XHRcdHJ1bGVzWyB0aGlzIF0gPSBOdW1iZXIoIHJ1bGVzWyB0aGlzIF0gKTtcblx0XHRcdH1cblx0XHR9KTtcblx0XHQkLmVhY2goWyBcInJhbmdlbGVuZ3RoXCIsIFwicmFuZ2VcIiBdLCBmdW5jdGlvbigpIHtcblx0XHRcdHZhciBwYXJ0cztcblx0XHRcdGlmICggcnVsZXNbIHRoaXMgXSApIHtcblx0XHRcdFx0aWYgKCAkLmlzQXJyYXkoIHJ1bGVzWyB0aGlzIF0gKSApIHtcblx0XHRcdFx0XHRydWxlc1sgdGhpcyBdID0gWyBOdW1iZXIoIHJ1bGVzWyB0aGlzIF1bIDAgXSksIE51bWJlciggcnVsZXNbIHRoaXMgXVsgMSBdICkgXTtcblx0XHRcdFx0fSBlbHNlIGlmICggdHlwZW9mIHJ1bGVzWyB0aGlzIF0gPT09IFwic3RyaW5nXCIgKSB7XG5cdFx0XHRcdFx0cGFydHMgPSBydWxlc1sgdGhpcyBdLnJlcGxhY2UoL1tcXFtcXF1dL2csIFwiXCIgKS5zcGxpdCggL1tcXHMsXSsvICk7XG5cdFx0XHRcdFx0cnVsZXNbIHRoaXMgXSA9IFsgTnVtYmVyKCBwYXJ0c1sgMCBdKSwgTnVtYmVyKCBwYXJ0c1sgMSBdICkgXTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH0pO1xuXG5cdFx0aWYgKCAkLnZhbGlkYXRvci5hdXRvQ3JlYXRlUmFuZ2VzICkge1xuXHRcdFx0Ly8gYXV0by1jcmVhdGUgcmFuZ2VzXG5cdFx0XHRpZiAoIHJ1bGVzLm1pbiAhPSBudWxsICYmIHJ1bGVzLm1heCAhPSBudWxsICkge1xuXHRcdFx0XHRydWxlcy5yYW5nZSA9IFsgcnVsZXMubWluLCBydWxlcy5tYXggXTtcblx0XHRcdFx0ZGVsZXRlIHJ1bGVzLm1pbjtcblx0XHRcdFx0ZGVsZXRlIHJ1bGVzLm1heDtcblx0XHRcdH1cblx0XHRcdGlmICggcnVsZXMubWlubGVuZ3RoICE9IG51bGwgJiYgcnVsZXMubWF4bGVuZ3RoICE9IG51bGwgKSB7XG5cdFx0XHRcdHJ1bGVzLnJhbmdlbGVuZ3RoID0gWyBydWxlcy5taW5sZW5ndGgsIHJ1bGVzLm1heGxlbmd0aCBdO1xuXHRcdFx0XHRkZWxldGUgcnVsZXMubWlubGVuZ3RoO1xuXHRcdFx0XHRkZWxldGUgcnVsZXMubWF4bGVuZ3RoO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdHJldHVybiBydWxlcztcblx0fSxcblxuXHQvLyBDb252ZXJ0cyBhIHNpbXBsZSBzdHJpbmcgdG8gYSB7c3RyaW5nOiB0cnVlfSBydWxlLCBlLmcuLCBcInJlcXVpcmVkXCIgdG8ge3JlcXVpcmVkOnRydWV9XG5cdG5vcm1hbGl6ZVJ1bGU6IGZ1bmN0aW9uKCBkYXRhICkge1xuXHRcdGlmICggdHlwZW9mIGRhdGEgPT09IFwic3RyaW5nXCIgKSB7XG5cdFx0XHR2YXIgdHJhbnNmb3JtZWQgPSB7fTtcblx0XHRcdCQuZWFjaCggZGF0YS5zcGxpdCggL1xccy8gKSwgZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRyYW5zZm9ybWVkWyB0aGlzIF0gPSB0cnVlO1xuXHRcdFx0fSk7XG5cdFx0XHRkYXRhID0gdHJhbnNmb3JtZWQ7XG5cdFx0fVxuXHRcdHJldHVybiBkYXRhO1xuXHR9LFxuXG5cdC8vIGh0dHA6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9qUXVlcnkudmFsaWRhdG9yLmFkZE1ldGhvZC9cblx0YWRkTWV0aG9kOiBmdW5jdGlvbiggbmFtZSwgbWV0aG9kLCBtZXNzYWdlICkge1xuXHRcdCQudmFsaWRhdG9yLm1ldGhvZHNbIG5hbWUgXSA9IG1ldGhvZDtcblx0XHQkLnZhbGlkYXRvci5tZXNzYWdlc1sgbmFtZSBdID0gbWVzc2FnZSAhPT0gdW5kZWZpbmVkID8gbWVzc2FnZSA6ICQudmFsaWRhdG9yLm1lc3NhZ2VzWyBuYW1lIF07XG5cdFx0aWYgKCBtZXRob2QubGVuZ3RoIDwgMyApIHtcblx0XHRcdCQudmFsaWRhdG9yLmFkZENsYXNzUnVsZXMoIG5hbWUsICQudmFsaWRhdG9yLm5vcm1hbGl6ZVJ1bGUoIG5hbWUgKSApO1xuXHRcdH1cblx0fSxcblxuXHRtZXRob2RzOiB7XG5cblx0XHQvLyBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvcmVxdWlyZWQtbWV0aG9kL1xuXHRcdHJlcXVpcmVkOiBmdW5jdGlvbiggdmFsdWUsIGVsZW1lbnQsIHBhcmFtICkge1xuXHRcdFx0Ly8gY2hlY2sgaWYgZGVwZW5kZW5jeSBpcyBtZXRcblx0XHRcdGlmICggIXRoaXMuZGVwZW5kKCBwYXJhbSwgZWxlbWVudCApICkge1xuXHRcdFx0XHRyZXR1cm4gXCJkZXBlbmRlbmN5LW1pc21hdGNoXCI7XG5cdFx0XHR9XG5cdFx0XHRpZiAoIGVsZW1lbnQubm9kZU5hbWUudG9Mb3dlckNhc2UoKSA9PT0gXCJzZWxlY3RcIiApIHtcblx0XHRcdFx0Ly8gY291bGQgYmUgYW4gYXJyYXkgZm9yIHNlbGVjdC1tdWx0aXBsZSBvciBhIHN0cmluZywgYm90aCBhcmUgZmluZSB0aGlzIHdheVxuXHRcdFx0XHR2YXIgdmFsID0gJCggZWxlbWVudCApLnZhbCgpO1xuXHRcdFx0XHRyZXR1cm4gdmFsICYmIHZhbC5sZW5ndGggPiAwO1xuXHRcdFx0fVxuXHRcdFx0aWYgKCB0aGlzLmNoZWNrYWJsZSggZWxlbWVudCApICkge1xuXHRcdFx0XHRyZXR1cm4gdGhpcy5nZXRMZW5ndGgoIHZhbHVlLCBlbGVtZW50ICkgPiAwO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuICQudHJpbSggdmFsdWUgKS5sZW5ndGggPiAwO1xuXHRcdH0sXG5cblx0XHQvLyBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvZW1haWwtbWV0aG9kL1xuXHRcdGVtYWlsOiBmdW5jdGlvbiggdmFsdWUsIGVsZW1lbnQgKSB7XG5cdFx0XHQvLyBGcm9tIGh0dHA6Ly93d3cud2hhdHdnLm9yZy9zcGVjcy93ZWItYXBwcy9jdXJyZW50LXdvcmsvbXVsdGlwYWdlL3N0YXRlcy1vZi10aGUtdHlwZS1hdHRyaWJ1dGUuaHRtbCNlLW1haWwtc3RhdGUtJTI4dHlwZT1lbWFpbCUyOVxuXHRcdFx0Ly8gUmV0cmlldmVkIDIwMTQtMDEtMTRcblx0XHRcdC8vIElmIHlvdSBoYXZlIGEgcHJvYmxlbSB3aXRoIHRoaXMgaW1wbGVtZW50YXRpb24sIHJlcG9ydCBhIGJ1ZyBhZ2FpbnN0IHRoZSBhYm92ZSBzcGVjXG5cdFx0XHQvLyBPciB1c2UgY3VzdG9tIG1ldGhvZHMgdG8gaW1wbGVtZW50IHlvdXIgb3duIGVtYWlsIHZhbGlkYXRpb25cblx0XHRcdHJldHVybiB0aGlzLm9wdGlvbmFsKCBlbGVtZW50ICkgfHwgL15bYS16QS1aMC05LiEjJCUmJyorXFwvPT9eX2B7fH1+LV0rQFthLXpBLVowLTldKD86W2EtekEtWjAtOS1dezAsNjF9W2EtekEtWjAtOV0pPyg/OlxcLlthLXpBLVowLTldKD86W2EtekEtWjAtOS1dezAsNjF9W2EtekEtWjAtOV0pPykqJC8udGVzdCggdmFsdWUgKTtcblx0XHR9LFxuXG5cdFx0Ly8gaHR0cDovL2pxdWVyeXZhbGlkYXRpb24ub3JnL3VybC1tZXRob2QvXG5cdFx0dXJsOiBmdW5jdGlvbiggdmFsdWUsIGVsZW1lbnQgKSB7XG5cdFx0XHQvLyBjb250cmlidXRlZCBieSBTY290dCBHb256YWxlejogaHR0cDovL3Byb2plY3RzLnNjb3R0c3BsYXlncm91bmQuY29tL2lyaS9cblx0XHRcdHJldHVybiB0aGlzLm9wdGlvbmFsKCBlbGVtZW50ICkgfHwgL14oaHR0cHM/fHM/ZnRwKTpcXC9cXC8oKCgoW2Etel18XFxkfC18XFwufF98fnxbXFx1MDBBMC1cXHVEN0ZGXFx1RjkwMC1cXHVGRENGXFx1RkRGMC1cXHVGRkVGXSl8KCVbXFxkYS1mXXsyfSl8WyFcXCQmJ1xcKFxcKVxcKlxcKyw7PV18OikqQCk/KCgoXFxkfFsxLTldXFxkfDFcXGRcXGR8MlswLTRdXFxkfDI1WzAtNV0pXFwuKFxcZHxbMS05XVxcZHwxXFxkXFxkfDJbMC00XVxcZHwyNVswLTVdKVxcLihcXGR8WzEtOV1cXGR8MVxcZFxcZHwyWzAtNF1cXGR8MjVbMC01XSlcXC4oXFxkfFsxLTldXFxkfDFcXGRcXGR8MlswLTRdXFxkfDI1WzAtNV0pKXwoKChbYS16XXxcXGR8W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pfCgoW2Etel18XFxkfFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKShbYS16XXxcXGR8LXxcXC58X3x+fFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKSooW2Etel18XFxkfFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKSkpXFwuKSsoKFthLXpdfFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKXwoKFthLXpdfFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKShbYS16XXxcXGR8LXxcXC58X3x+fFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKSooW2Etel18W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pKSlcXC4/KSg6XFxkKik/KShcXC8oKChbYS16XXxcXGR8LXxcXC58X3x+fFtcXHUwMEEwLVxcdUQ3RkZcXHVGOTAwLVxcdUZEQ0ZcXHVGREYwLVxcdUZGRUZdKXwoJVtcXGRhLWZdezJ9KXxbIVxcJCYnXFwoXFwpXFwqXFwrLDs9XXw6fEApKyhcXC8oKFthLXpdfFxcZHwtfFxcLnxffH58W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pfCglW1xcZGEtZl17Mn0pfFshXFwkJidcXChcXClcXCpcXCssOz1dfDp8QCkqKSopPyk/KFxcPygoKFthLXpdfFxcZHwtfFxcLnxffH58W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pfCglW1xcZGEtZl17Mn0pfFshXFwkJidcXChcXClcXCpcXCssOz1dfDp8QCl8W1xcdUUwMDAtXFx1RjhGRl18XFwvfFxcPykqKT8oIygoKFthLXpdfFxcZHwtfFxcLnxffH58W1xcdTAwQTAtXFx1RDdGRlxcdUY5MDAtXFx1RkRDRlxcdUZERjAtXFx1RkZFRl0pfCglW1xcZGEtZl17Mn0pfFshXFwkJidcXChcXClcXCpcXCssOz1dfDp8QCl8XFwvfFxcPykqKT8kL2kudGVzdCggdmFsdWUgKTtcblx0XHR9LFxuXG5cdFx0Ly8gaHR0cDovL2pxdWVyeXZhbGlkYXRpb24ub3JnL2RhdGUtbWV0aG9kL1xuXHRcdGRhdGU6IGZ1bmN0aW9uKCB2YWx1ZSwgZWxlbWVudCApIHtcblx0XHRcdHJldHVybiB0aGlzLm9wdGlvbmFsKCBlbGVtZW50ICkgfHwgIS9JbnZhbGlkfE5hTi8udGVzdCggbmV3IERhdGUoIHZhbHVlICkudG9TdHJpbmcoKSApO1xuXHRcdH0sXG5cblx0XHQvLyBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvZGF0ZUlTTy1tZXRob2QvXG5cdFx0ZGF0ZUlTTzogZnVuY3Rpb24oIHZhbHVlLCBlbGVtZW50ICkge1xuXHRcdFx0cmV0dXJuIHRoaXMub3B0aW9uYWwoIGVsZW1lbnQgKSB8fCAvXlxcZHs0fVtcXC9cXC1dKDA/WzEtOV18MVswMTJdKVtcXC9cXC1dKDA/WzEtOV18WzEyXVswLTldfDNbMDFdKSQvLnRlc3QoIHZhbHVlICk7XG5cdFx0fSxcblxuXHRcdC8vIGh0dHA6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9udW1iZXItbWV0aG9kL1xuXHRcdG51bWJlcjogZnVuY3Rpb24oIHZhbHVlLCBlbGVtZW50ICkge1xuXHRcdFx0cmV0dXJuIHRoaXMub3B0aW9uYWwoIGVsZW1lbnQgKSB8fCAvXi0/KD86XFxkK3xcXGR7MSwzfSg/OixcXGR7M30pKyk/KD86XFwuXFxkKyk/JC8udGVzdCggdmFsdWUgKTtcblx0XHR9LFxuXG5cdFx0Ly8gaHR0cDovL2pxdWVyeXZhbGlkYXRpb24ub3JnL2RpZ2l0cy1tZXRob2QvXG5cdFx0ZGlnaXRzOiBmdW5jdGlvbiggdmFsdWUsIGVsZW1lbnQgKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5vcHRpb25hbCggZWxlbWVudCApIHx8IC9eXFxkKyQvLnRlc3QoIHZhbHVlICk7XG5cdFx0fSxcblxuXHRcdC8vIGh0dHA6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9jcmVkaXRjYXJkLW1ldGhvZC9cblx0XHQvLyBiYXNlZCBvbiBodHRwOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0x1aG4vXG5cdFx0Y3JlZGl0Y2FyZDogZnVuY3Rpb24oIHZhbHVlLCBlbGVtZW50ICkge1xuXHRcdFx0aWYgKCB0aGlzLm9wdGlvbmFsKCBlbGVtZW50ICkgKSB7XG5cdFx0XHRcdHJldHVybiBcImRlcGVuZGVuY3ktbWlzbWF0Y2hcIjtcblx0XHRcdH1cblx0XHRcdC8vIGFjY2VwdCBvbmx5IHNwYWNlcywgZGlnaXRzIGFuZCBkYXNoZXNcblx0XHRcdGlmICggL1teMC05IFxcLV0rLy50ZXN0KCB2YWx1ZSApICkge1xuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9XG5cdFx0XHR2YXIgbkNoZWNrID0gMCxcblx0XHRcdFx0bkRpZ2l0ID0gMCxcblx0XHRcdFx0YkV2ZW4gPSBmYWxzZSxcblx0XHRcdFx0biwgY0RpZ2l0O1xuXG5cdFx0XHR2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoIC9cXEQvZywgXCJcIiApO1xuXG5cdFx0XHQvLyBCYXNpbmcgbWluIGFuZCBtYXggbGVuZ3RoIG9uXG5cdFx0XHQvLyBodHRwOi8vZGV2ZWxvcGVyLmVhbi5jb20vZ2VuZXJhbF9pbmZvL1ZhbGlkX0NyZWRpdF9DYXJkX1R5cGVzXG5cdFx0XHRpZiAoIHZhbHVlLmxlbmd0aCA8IDEzIHx8IHZhbHVlLmxlbmd0aCA+IDE5ICkge1xuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9XG5cblx0XHRcdGZvciAoIG4gPSB2YWx1ZS5sZW5ndGggLSAxOyBuID49IDA7IG4tLSkge1xuXHRcdFx0XHRjRGlnaXQgPSB2YWx1ZS5jaGFyQXQoIG4gKTtcblx0XHRcdFx0bkRpZ2l0ID0gcGFyc2VJbnQoIGNEaWdpdCwgMTAgKTtcblx0XHRcdFx0aWYgKCBiRXZlbiApIHtcblx0XHRcdFx0XHRpZiAoICggbkRpZ2l0ICo9IDIgKSA+IDkgKSB7XG5cdFx0XHRcdFx0XHRuRGlnaXQgLT0gOTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdFx0bkNoZWNrICs9IG5EaWdpdDtcblx0XHRcdFx0YkV2ZW4gPSAhYkV2ZW47XG5cdFx0XHR9XG5cblx0XHRcdHJldHVybiAoIG5DaGVjayAlIDEwICkgPT09IDA7XG5cdFx0fSxcblxuXHRcdC8vIGh0dHA6Ly9qcXVlcnl2YWxpZGF0aW9uLm9yZy9taW5sZW5ndGgtbWV0aG9kL1xuXHRcdG1pbmxlbmd0aDogZnVuY3Rpb24oIHZhbHVlLCBlbGVtZW50LCBwYXJhbSApIHtcblx0XHRcdHZhciBsZW5ndGggPSAkLmlzQXJyYXkoIHZhbHVlICkgPyB2YWx1ZS5sZW5ndGggOiB0aGlzLmdldExlbmd0aCggdmFsdWUsIGVsZW1lbnQgKTtcblx0XHRcdHJldHVybiB0aGlzLm9wdGlvbmFsKCBlbGVtZW50ICkgfHwgbGVuZ3RoID49IHBhcmFtO1xuXHRcdH0sXG5cblx0XHQvLyBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvbWF4bGVuZ3RoLW1ldGhvZC9cblx0XHRtYXhsZW5ndGg6IGZ1bmN0aW9uKCB2YWx1ZSwgZWxlbWVudCwgcGFyYW0gKSB7XG5cdFx0XHR2YXIgbGVuZ3RoID0gJC5pc0FycmF5KCB2YWx1ZSApID8gdmFsdWUubGVuZ3RoIDogdGhpcy5nZXRMZW5ndGgoIHZhbHVlLCBlbGVtZW50ICk7XG5cdFx0XHRyZXR1cm4gdGhpcy5vcHRpb25hbCggZWxlbWVudCApIHx8IGxlbmd0aCA8PSBwYXJhbTtcblx0XHR9LFxuXG5cdFx0Ly8gaHR0cDovL2pxdWVyeXZhbGlkYXRpb24ub3JnL3JhbmdlbGVuZ3RoLW1ldGhvZC9cblx0XHRyYW5nZWxlbmd0aDogZnVuY3Rpb24oIHZhbHVlLCBlbGVtZW50LCBwYXJhbSApIHtcblx0XHRcdHZhciBsZW5ndGggPSAkLmlzQXJyYXkoIHZhbHVlICkgPyB2YWx1ZS5sZW5ndGggOiB0aGlzLmdldExlbmd0aCggdmFsdWUsIGVsZW1lbnQgKTtcblx0XHRcdHJldHVybiB0aGlzLm9wdGlvbmFsKCBlbGVtZW50ICkgfHwgKCBsZW5ndGggPj0gcGFyYW1bIDAgXSAmJiBsZW5ndGggPD0gcGFyYW1bIDEgXSApO1xuXHRcdH0sXG5cblx0XHQvLyBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvbWluLW1ldGhvZC9cblx0XHRtaW46IGZ1bmN0aW9uKCB2YWx1ZSwgZWxlbWVudCwgcGFyYW0gKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5vcHRpb25hbCggZWxlbWVudCApIHx8IHZhbHVlID49IHBhcmFtO1xuXHRcdH0sXG5cblx0XHQvLyBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvbWF4LW1ldGhvZC9cblx0XHRtYXg6IGZ1bmN0aW9uKCB2YWx1ZSwgZWxlbWVudCwgcGFyYW0gKSB7XG5cdFx0XHRyZXR1cm4gdGhpcy5vcHRpb25hbCggZWxlbWVudCApIHx8IHZhbHVlIDw9IHBhcmFtO1xuXHRcdH0sXG5cblx0XHQvLyBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvcmFuZ2UtbWV0aG9kL1xuXHRcdHJhbmdlOiBmdW5jdGlvbiggdmFsdWUsIGVsZW1lbnQsIHBhcmFtICkge1xuXHRcdFx0cmV0dXJuIHRoaXMub3B0aW9uYWwoIGVsZW1lbnQgKSB8fCAoIHZhbHVlID49IHBhcmFtWyAwIF0gJiYgdmFsdWUgPD0gcGFyYW1bIDEgXSApO1xuXHRcdH0sXG5cblx0XHQvLyBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvZXF1YWxUby1tZXRob2QvXG5cdFx0ZXF1YWxUbzogZnVuY3Rpb24oIHZhbHVlLCBlbGVtZW50LCBwYXJhbSApIHtcblx0XHRcdC8vIGJpbmQgdG8gdGhlIGJsdXIgZXZlbnQgb2YgdGhlIHRhcmdldCBpbiBvcmRlciB0byByZXZhbGlkYXRlIHdoZW5ldmVyIHRoZSB0YXJnZXQgZmllbGQgaXMgdXBkYXRlZFxuXHRcdFx0Ly8gVE9ETyBmaW5kIGEgd2F5IHRvIGJpbmQgdGhlIGV2ZW50IGp1c3Qgb25jZSwgYXZvaWRpbmcgdGhlIHVuYmluZC1yZWJpbmQgb3ZlcmhlYWRcblx0XHRcdHZhciB0YXJnZXQgPSAkKCBwYXJhbSApO1xuXHRcdFx0aWYgKCB0aGlzLnNldHRpbmdzLm9uZm9jdXNvdXQgKSB7XG5cdFx0XHRcdHRhcmdldC51bmJpbmQoIFwiLnZhbGlkYXRlLWVxdWFsVG9cIiApLmJpbmQoIFwiYmx1ci52YWxpZGF0ZS1lcXVhbFRvXCIsIGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdCQoIGVsZW1lbnQgKS52YWxpZCgpO1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHRcdHJldHVybiB2YWx1ZSA9PT0gdGFyZ2V0LnZhbCgpO1xuXHRcdH0sXG5cblx0XHQvLyBodHRwOi8vanF1ZXJ5dmFsaWRhdGlvbi5vcmcvcmVtb3RlLW1ldGhvZC9cblx0XHRyZW1vdGU6IGZ1bmN0aW9uKCB2YWx1ZSwgZWxlbWVudCwgcGFyYW0gKSB7XG5cdFx0XHRpZiAoIHRoaXMub3B0aW9uYWwoIGVsZW1lbnQgKSApIHtcblx0XHRcdFx0cmV0dXJuIFwiZGVwZW5kZW5jeS1taXNtYXRjaFwiO1xuXHRcdFx0fVxuXG5cdFx0XHR2YXIgcHJldmlvdXMgPSB0aGlzLnByZXZpb3VzVmFsdWUoIGVsZW1lbnQgKSxcblx0XHRcdFx0dmFsaWRhdG9yLCBkYXRhO1xuXG5cdFx0XHRpZiAoIXRoaXMuc2V0dGluZ3MubWVzc2FnZXNbIGVsZW1lbnQubmFtZSBdICkge1xuXHRcdFx0XHR0aGlzLnNldHRpbmdzLm1lc3NhZ2VzWyBlbGVtZW50Lm5hbWUgXSA9IHt9O1xuXHRcdFx0fVxuXHRcdFx0cHJldmlvdXMub3JpZ2luYWxNZXNzYWdlID0gdGhpcy5zZXR0aW5ncy5tZXNzYWdlc1sgZWxlbWVudC5uYW1lIF0ucmVtb3RlO1xuXHRcdFx0dGhpcy5zZXR0aW5ncy5tZXNzYWdlc1sgZWxlbWVudC5uYW1lIF0ucmVtb3RlID0gcHJldmlvdXMubWVzc2FnZTtcblxuXHRcdFx0cGFyYW0gPSB0eXBlb2YgcGFyYW0gPT09IFwic3RyaW5nXCIgJiYgeyB1cmw6IHBhcmFtIH0gfHwgcGFyYW07XG5cblx0XHRcdGlmICggcHJldmlvdXMub2xkID09PSB2YWx1ZSApIHtcblx0XHRcdFx0cmV0dXJuIHByZXZpb3VzLnZhbGlkO1xuXHRcdFx0fVxuXG5cdFx0XHRwcmV2aW91cy5vbGQgPSB2YWx1ZTtcblx0XHRcdHZhbGlkYXRvciA9IHRoaXM7XG5cdFx0XHR0aGlzLnN0YXJ0UmVxdWVzdCggZWxlbWVudCApO1xuXHRcdFx0ZGF0YSA9IHt9O1xuXHRcdFx0ZGF0YVsgZWxlbWVudC5uYW1lIF0gPSB2YWx1ZTtcblx0XHRcdCQuYWpheCggJC5leHRlbmQoIHRydWUsIHtcblx0XHRcdFx0dXJsOiBwYXJhbSxcblx0XHRcdFx0bW9kZTogXCJhYm9ydFwiLFxuXHRcdFx0XHRwb3J0OiBcInZhbGlkYXRlXCIgKyBlbGVtZW50Lm5hbWUsXG5cdFx0XHRcdGRhdGFUeXBlOiBcImpzb25cIixcblx0XHRcdFx0ZGF0YTogZGF0YSxcblx0XHRcdFx0Y29udGV4dDogdmFsaWRhdG9yLmN1cnJlbnRGb3JtLFxuXHRcdFx0XHRzdWNjZXNzOiBmdW5jdGlvbiggcmVzcG9uc2UgKSB7XG5cdFx0XHRcdFx0dmFyIHZhbGlkID0gcmVzcG9uc2UgPT09IHRydWUgfHwgcmVzcG9uc2UgPT09IFwidHJ1ZVwiLFxuXHRcdFx0XHRcdFx0ZXJyb3JzLCBtZXNzYWdlLCBzdWJtaXR0ZWQ7XG5cblx0XHRcdFx0XHR2YWxpZGF0b3Iuc2V0dGluZ3MubWVzc2FnZXNbIGVsZW1lbnQubmFtZSBdLnJlbW90ZSA9IHByZXZpb3VzLm9yaWdpbmFsTWVzc2FnZTtcblx0XHRcdFx0XHRpZiAoIHZhbGlkICkge1xuXHRcdFx0XHRcdFx0c3VibWl0dGVkID0gdmFsaWRhdG9yLmZvcm1TdWJtaXR0ZWQ7XG5cdFx0XHRcdFx0XHR2YWxpZGF0b3IucHJlcGFyZUVsZW1lbnQoIGVsZW1lbnQgKTtcblx0XHRcdFx0XHRcdHZhbGlkYXRvci5mb3JtU3VibWl0dGVkID0gc3VibWl0dGVkO1xuXHRcdFx0XHRcdFx0dmFsaWRhdG9yLnN1Y2Nlc3NMaXN0LnB1c2goIGVsZW1lbnQgKTtcblx0XHRcdFx0XHRcdGRlbGV0ZSB2YWxpZGF0b3IuaW52YWxpZFsgZWxlbWVudC5uYW1lIF07XG5cdFx0XHRcdFx0XHR2YWxpZGF0b3Iuc2hvd0Vycm9ycygpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRlcnJvcnMgPSB7fTtcblx0XHRcdFx0XHRcdG1lc3NhZ2UgPSByZXNwb25zZSB8fCB2YWxpZGF0b3IuZGVmYXVsdE1lc3NhZ2UoIGVsZW1lbnQsIFwicmVtb3RlXCIgKTtcblx0XHRcdFx0XHRcdGVycm9yc1sgZWxlbWVudC5uYW1lIF0gPSBwcmV2aW91cy5tZXNzYWdlID0gJC5pc0Z1bmN0aW9uKCBtZXNzYWdlICkgPyBtZXNzYWdlKCB2YWx1ZSApIDogbWVzc2FnZTtcblx0XHRcdFx0XHRcdHZhbGlkYXRvci5pbnZhbGlkWyBlbGVtZW50Lm5hbWUgXSA9IHRydWU7XG5cdFx0XHRcdFx0XHR2YWxpZGF0b3Iuc2hvd0Vycm9ycyggZXJyb3JzICk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdHByZXZpb3VzLnZhbGlkID0gdmFsaWQ7XG5cdFx0XHRcdFx0dmFsaWRhdG9yLnN0b3BSZXF1ZXN0KCBlbGVtZW50LCB2YWxpZCApO1xuXHRcdFx0XHR9XG5cdFx0XHR9LCBwYXJhbSApICk7XG5cdFx0XHRyZXR1cm4gXCJwZW5kaW5nXCI7XG5cdFx0fVxuXG5cdH1cblxufSk7XG5cbiQuZm9ybWF0ID0gZnVuY3Rpb24gZGVwcmVjYXRlZCgpIHtcblx0dGhyb3cgXCIkLmZvcm1hdCBoYXMgYmVlbiBkZXByZWNhdGVkLiBQbGVhc2UgdXNlICQudmFsaWRhdG9yLmZvcm1hdCBpbnN0ZWFkLlwiO1xufTtcblxuLy8gYWpheCBtb2RlOiBhYm9ydFxuLy8gdXNhZ2U6ICQuYWpheCh7IG1vZGU6IFwiYWJvcnRcIlssIHBvcnQ6IFwidW5pcXVlcG9ydFwiXX0pO1xuLy8gaWYgbW9kZTpcImFib3J0XCIgaXMgdXNlZCwgdGhlIHByZXZpb3VzIHJlcXVlc3Qgb24gdGhhdCBwb3J0IChwb3J0IGNhbiBiZSB1bmRlZmluZWQpIGlzIGFib3J0ZWQgdmlhIFhNTEh0dHBSZXF1ZXN0LmFib3J0KClcblxudmFyIHBlbmRpbmdSZXF1ZXN0cyA9IHt9LFxuXHRhamF4O1xuLy8gVXNlIGEgcHJlZmlsdGVyIGlmIGF2YWlsYWJsZSAoMS41KylcbmlmICggJC5hamF4UHJlZmlsdGVyICkge1xuXHQkLmFqYXhQcmVmaWx0ZXIoZnVuY3Rpb24oIHNldHRpbmdzLCBfLCB4aHIgKSB7XG5cdFx0dmFyIHBvcnQgPSBzZXR0aW5ncy5wb3J0O1xuXHRcdGlmICggc2V0dGluZ3MubW9kZSA9PT0gXCJhYm9ydFwiICkge1xuXHRcdFx0aWYgKCBwZW5kaW5nUmVxdWVzdHNbcG9ydF0gKSB7XG5cdFx0XHRcdHBlbmRpbmdSZXF1ZXN0c1twb3J0XS5hYm9ydCgpO1xuXHRcdFx0fVxuXHRcdFx0cGVuZGluZ1JlcXVlc3RzW3BvcnRdID0geGhyO1xuXHRcdH1cblx0fSk7XG59IGVsc2Uge1xuXHQvLyBQcm94eSBhamF4XG5cdGFqYXggPSAkLmFqYXg7XG5cdCQuYWpheCA9IGZ1bmN0aW9uKCBzZXR0aW5ncyApIHtcblx0XHR2YXIgbW9kZSA9ICggXCJtb2RlXCIgaW4gc2V0dGluZ3MgPyBzZXR0aW5ncyA6ICQuYWpheFNldHRpbmdzICkubW9kZSxcblx0XHRcdHBvcnQgPSAoIFwicG9ydFwiIGluIHNldHRpbmdzID8gc2V0dGluZ3MgOiAkLmFqYXhTZXR0aW5ncyApLnBvcnQ7XG5cdFx0aWYgKCBtb2RlID09PSBcImFib3J0XCIgKSB7XG5cdFx0XHRpZiAoIHBlbmRpbmdSZXF1ZXN0c1twb3J0XSApIHtcblx0XHRcdFx0cGVuZGluZ1JlcXVlc3RzW3BvcnRdLmFib3J0KCk7XG5cdFx0XHR9XG5cdFx0XHRwZW5kaW5nUmVxdWVzdHNbcG9ydF0gPSBhamF4LmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG5cdFx0XHRyZXR1cm4gcGVuZGluZ1JlcXVlc3RzW3BvcnRdO1xuXHRcdH1cblx0XHRyZXR1cm4gYWpheC5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuXHR9O1xufVxuXG4vLyBwcm92aWRlcyBkZWxlZ2F0ZSh0eXBlOiBTdHJpbmcsIGRlbGVnYXRlOiBTZWxlY3RvciwgaGFuZGxlcjogQ2FsbGJhY2spIHBsdWdpbiBmb3IgZWFzaWVyIGV2ZW50IGRlbGVnYXRpb25cbi8vIGhhbmRsZXIgaXMgb25seSBjYWxsZWQgd2hlbiAkKGV2ZW50LnRhcmdldCkuaXMoZGVsZWdhdGUpLCBpbiB0aGUgc2NvcGUgb2YgdGhlIGpxdWVyeS1vYmplY3QgZm9yIGV2ZW50LnRhcmdldFxuXG4kLmV4dGVuZCgkLmZuLCB7XG5cdHZhbGlkYXRlRGVsZWdhdGU6IGZ1bmN0aW9uKCBkZWxlZ2F0ZSwgdHlwZSwgaGFuZGxlciApIHtcblx0XHRyZXR1cm4gdGhpcy5iaW5kKHR5cGUsIGZ1bmN0aW9uKCBldmVudCApIHtcblx0XHRcdHZhciB0YXJnZXQgPSAkKGV2ZW50LnRhcmdldCk7XG5cdFx0XHRpZiAoIHRhcmdldC5pcyhkZWxlZ2F0ZSkgKSB7XG5cdFx0XHRcdHJldHVybiBoYW5kbGVyLmFwcGx5KHRhcmdldCwgYXJndW1lbnRzKTtcblx0XHRcdH1cblx0XHR9KTtcblx0fVxufSk7XG5cbn0pKTsiLCIvKlxuLy8g0LDQstGC0L4t0LPRgNC40YLQuNC90LMg0YfQsNGC0LAuXG52YXIgTENfQVBJID0gTENfQVBJIHx8IHt9O1xuXG5cbmZ1bmN0aW9uIF9MQ19PUEVOKCkge1xuICAgIExDX0FQSS5vcGVuX2NoYXRfd2luZG93KCk7XG59XG5cbi8vIExDX0FQSS5vbl9hZnRlcl9sb2FkID0gZnVuY3Rpb24oKVxuTENfQVBJLm9uX2JlZm9yZV9sb2FkID0gZnVuY3Rpb24oKVxue1xuXG4gICAgdmFyIGN1c3RvbV92YXJpYWJsZXMgPSBbXG4gICAgICAgeyBuYW1lOiAndmlzaXQnLCB2YWx1ZTogJzEnIH1cbiAgICBdO1xuICAgIExDX0FQSS5zZXRfY3VzdG9tX3ZhcmlhYmxlcyhjdXN0b21fdmFyaWFibGVzKTtcblxuLy8gICAgY29uc29sZS5sb2coJ0xDX0FQSTpCRUZPUkUnKTtcbi8vICAgIGlmKCFMQ19BUEkuY2hhdF93aW5kb3dfbWF4aW1pemVkKCkpIHtcbi8vICAgICAgICBzZXRUaW1lb3V0KCBfTENfT1BFTiwgMTAwMCo2MCoxMCk7IC8vIDEwMDAgLSAxY9C10LouXG4vLyAgICB9XG5cbi8vXHRpZihMQ19BUEkuY2hhdF93aW5kb3dfbWF4aW1pemVkKCkpIHtcbi8vICAgICAgICAgICAgLy8gTENfQVBJLmhpZGVfY2hhdF93aW5kb3coKTtcbi8vICAgICAgICAgICAgTENfQVBJLm1pbmltaXplX2NoYXRfd2luZG93KCk7XG4vLyAgICAgICAgfVxufTtcblxuTENfQVBJLm9uX2FmdGVyX2xvYWQgPSBmdW5jdGlvbigpIHtcbi8vICAgIGNvbnNvbGUubG9nKCdMQ19BUEk6QUZURVInKTtcblxuICAgIGlmKExDX0FQSS5jaGF0X3dpbmRvd19tYXhpbWl6ZWQoKSkge1xuLy8gICAgICAgICAgICAvLyBMQ19BUEkuaGlkZV9jaGF0X3dpbmRvdygpO1xuICAgICAgICBMQ19BUEkubWluaW1pemVfY2hhdF93aW5kb3coKTtcbiAgICB9XG5cbiAgICAgc2V0VGltZW91dCggX0xDX09QRU4sIDEwMDAqNjAqMTApOyAvLyAxMDAwIC0gMWPQtdC6LlxufVxuKi9cblxuJChmdW5jdGlvbigpIHtcbiAgICAgICAgJCgnLnNlbGVjdF9pbnZlcnNlLCAuc2VsZWN0Jykuc2VsZWN0cGlja2VyKCk7XG5cblx0JCgnLmRib2R5ID4gLnJvdyA+IGRpdjpmaXJzdC1jaGlsZCcpLm9uKCdjbGljaycsIGZ1bmN0aW9uKGV2KSB7XG5cdFx0dmFyICR0aGlzID0gJCh0aGlzKTtcblx0XHRpZiAoJChldi50YXJnZXQpLmNsb3Nlc3QoJy5wb3BvdmVyJykubGVuZ3RoKSByZXR1cm47XG5cdFx0aWYgKCR0aGlzLmhhc0NsYXNzKCdhY3RpdmUnKSkge1xuXHRcdFx0JHRoaXMucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHQkKCcuZGJvZHkgPiAucm93ID4gZGl2JykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuXHRcdFx0JHRoaXMuYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuXHRcdH1cblx0fSk7XG5cblx0JCh3aW5kb3cpLnNjcm9sbChmdW5jdGlvbigpIHtcblx0XHRpZiAoJCh0aGlzKS5zY3JvbGxUb3AoKSA+IDEwMCkge1xuXHRcdFx0JCgnLmdvX3VwJykuZmFkZUluKCk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdCQoJy5nb191cCcpLmZhZGVPdXQoKTtcblx0XHR9XG5cdH0pO1xuXHQvLyBzY3JvbGwgYm9keSB0byAwcHggb24gY2xpY2tcblx0JCgnLmdvX3VwJykub24oXCJjbGlja1wiLCBmdW5jdGlvbigpIHtcblx0XHQkKCdib2R5LGh0bWwnKS5hbmltYXRlKHtcblx0XHRcdHNjcm9sbFRvcDogMFxuXHRcdH0sIDgwMCk7XG5cdFx0cmV0dXJuIGZhbHNlO1xuXHR9KTtcblxuXG4gICAgJCgnLmxlYXJuLWFib3V0LWxpbmsnKS5jbGljayhmdW5jdGlvbihldmVudCkge1xuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB2YXIgaHJlZj0kKHRoaXMpLmF0dHIoJ2hyZWYnKTtcbiAgICAgICAgdmFyIHRhcmdldD0kKGhyZWYpO1xuICAgICAgICB2YXIgdG9wPXRhcmdldC5vZmZzZXQoKS50b3A7XG4gICAgICAgICQoJ2h0bWwsYm9keScpLmFuaW1hdGUoe1xuICAgICAgICAgICAgc2Nyb2xsVG9wOiB0b3BcbiAgICAgICAgfSwgODAwKTtcbiAgICB9KTtcblxuICAgICAgICAvLyBzY3JvbGwgYm9keSBvbiBjbGlja1xuICAgICAgICBpZigkKCcuZ29fYmxvY2tfc2Nyb2xsJykubGVuZ3RoKSB7XG4gICAgICAgICAgICQoJy5nb19ibG9ja19zY3JvbGwnKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICB2YXIgaWQgPSAoJCh0aGlzKS5hdHRyKCdkYXRhLWdvLWJsb2NrJykpID8gJyMnLiQodGhpcykuYXR0cignZGF0YS1nby1ibG9jaycpIDogKCQodGhpcykuYXR0cignaHJlZicpKSA/ICQodGhpcykuYXR0cignaHJlZicpIDogZmFsc2U7XG4gICAgICAgICAgICAgICAgaWYoaWQgJiYgJCggaWQgKS5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgJCgnaHRtbCwgYm9keScpLmFuaW1hdGUoIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNjcm9sbFRvcDogTWF0aC5jZWlsKCAkKCBpZCApLm9mZnNldCgpLnRvcCApIC8vIE1hdGguY2VpbCgodGFyZ2V0X3RvcCAqICQod2luZG93KS5vdXRlckhlaWdodCh0cnVlKSkgLyAkKCdodG1sLCBib2R5JykuaGVpZ2h0KCkpXG4gICAgICAgICAgICAgICAgICAgIH0sJ2xpbmVhcicpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuXG4gICAgICAgIC8vIGdhIGZvcm1cbiAgICAgICAgLy8g0LLQsNGA0LjQsNC90YIgMVxuLy8gICAgICAgIGdhKGZ1bmN0aW9uKHRyYWNrZXIpIHtcbi8vICAgICAgICAgIHZhciBsaW5rZXJQYXJhbSA9IHRyYWNrZXIuZ2V0KCdsaW5rZXJQYXJhbScpO1xuLy8gICAgICAgICAgY29uc29sZS5sb2coIGxpbmtlclBhcmFtICk7XG4vLyAgICAgICAgfSk7XG5cbiAgICAgICBpZigkKCdmb3JtW25hbWU9XCJwcmljZV9wcmVtaXVtX2JvdHRvbVwiXSwgZm9ybVtuYW1lPVwicHJpY2VfYmFzaWNfYm90dG9tXCJdLCBmb3JtW25hbWU9XCJwcmljZV9wcmVtaXVtXCJdLCBmb3JtW25hbWU9XCJwcmljZV9iYXNpY1wiXScpLmxlbmd0aCkge1xuICAgICAgICAkKCdmb3JtW25hbWU9XCJwcmljZV9wcmVtaXVtX2JvdHRvbVwiXSwgZm9ybVtuYW1lPVwicHJpY2VfYmFzaWNfYm90dG9tXCJdLCBmb3JtW25hbWU9XCJwcmljZV9wcmVtaXVtXCJdLCBmb3JtW25hbWU9XCJwcmljZV9iYXNpY1wiXScpLnN1Ym1pdChmdW5jdGlvbigpe1xuICAgICAgICAgICAgZ2EoJ2xpbmtlcjpkZWNvcmF0ZScsIHRoaXMpO1xuICAgICAgICB9KTtcbiAgICAgICB9XG59KTtcbiIsIiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCl7IFxuXG4gICAgLy8gY3JlYXRlIGNvb2tpZVxuICAgIGlmKHR5cGVvZiAkLmNvb2tpZSgncG9wVXBfZW1haWwnKSA9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgICQuY29va2llKCdwb3BVcF9lbWFpbCcsIDAsIHsgIFxuICAgICAgICAgICAgZXhwaXJlczogMSAvLyDRg9GB0YLQsNC90L7QstC40YLRjCDQvdCwINGB0YPRgtC60LggIFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgLypcbiAgICAkKCdodG1sJykubW91c2VsZWF2ZShmdW5jdGlvbigpe1xuICAgICAgICAvLyBjb25zb2xlLmxvZyggJ091dCB3aW5kb3dzISAnLCAkLmNvb2tpZSgncG9wVXBfZW1haWwnKSwgdHlwZW9mKCQuY29va2llKCdwb3BVcF9lbWFpbCcpKSApO1xuICAgICAgICBpZih0eXBlb2YgJC5jb29raWUoJ3BvcFVwX2VtYWlsJykgIT09IFwidW5kZWZpbmVkXCIgXG4gICAgICAgICAgICAgICAgJiYgIXBhcnNlSW50KCAkLmNvb2tpZSgncG9wVXBfZW1haWwnKSApKSB7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIHZhciAkX3BvcFVwID0gJCgnLmJveC1wb3BVcCcpLFxuICAgICAgICAgICAgICAgICRib3hfZW1haWwgPSAkX3BvcFVwLmZpbmQoJyNib3gtZW1haWwnKTtcblxuICAgICAgICAgICAgaWYoISRib3hfZW1haWwubGVuZ3RoKSB7IFxuICAgICAgICAgICAgICAgICRib3hfZW1haWwgPSAkX3BvcFVwXG4gICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCBfaHRtbFBvcFVwLmJveF9lbWFpbCApXG4gICAgICAgICAgICAgICAgICAgICAgICAuZmluZCgnI2JveC1lbWFpbCcpOyBcbiAgICAgICAgICAgIH0gXG4gICAgICAgICAgICBcbiAgICAgICAgICAgICRib3hfZW1haWwuYlBvcHVwKHtcbiAgICAgICAgICAgICAgICAgICAgbW9kYWxDbG9zZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgYXBwZW5kaW5nOiBmYWxzZSxcbiAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMC42LFxuICAgICAgICAgICAgICAgICAgICBmb2xsb3c6IFtmYWxzZSwgZmFsc2VdLCBcbiAgICAgICAgICAgICAgICAgICAgcG9zaXRpb25TdHlsZTogJ2ZpeGVkJywgLy8nZml4ZWQnIG9yICdhYnNvbHV0ZSdcbiAgICAgICAgICAgICAgICAgICAgb25PcGVuOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBvcFVwVmFsaWRhdGUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgY2xvc2VDbGFzczogJ2Nsb3NlJyxcbiAgICAgICAgICAgICAgICAgICAgb25DbG9zZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgIH0sXG5cbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAkLmNvb2tpZSgncG9wVXBfZW1haWwnLCAxKTsgLy8gcG9wVXAgaW5vdXQgcHV0IG9uZS5cbiAgICAgICAgfVxuICAgICAgICBcbiAgICB9KTtcbiAgICAqL1xuICAgIFxuICAgIC8vIGZvcm0gcG9wVXBcbiAgICAkKCcuYmxvY2stcG9wVXAtY2xvc2UnKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIF9wb3BVcCA9ICQodGhpcykucGFyZW50cygnLnBvcFVwJyksICR0aGlzID0gJCh0aGlzKTtcbiAgICAgICAgX3BvcFVwLmJQb3B1cCgpLmNsb3NlKCk7XG4gICAgfSk7XG5cbn0pO1xuXG5mdW5jdGlvbiBwb3BVcFZhbGlkYXRlKCkge1xuICAgIFxuICAgICQoJ2Zvcm0uYmxvY2stcG9wdXAtZm9ybScpLnZhbGlkYXRlKHtcbiAgICAgICAgb25mb2N1c291dDogZmFsc2UsXG4gICAgICAgIG9ua2V5dXA6IGZhbHNlLFxuICAgICAgICBvbmNsaWNrOiB0cnVlLFxuICAgICAgICBvbnN1Ym1pdDogdHJ1ZSxcbiAgICAgICAgZm9jdXNJbnZhbGlkOiBmYWxzZSxcbiAgICAgICAgZm9jdXNDbGVhbnVwOiBmYWxzZSxcbiAgICAgICAgZW1haWw6IHtcbiAgICAgICAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgICAgICAgZW1haWw6IHRydWVcbiAgICAgICAgfSxcbiAgICAgICAgbWVzc2FnZXM6IHtcbiAgICAgICAgICAgIGVtYWlsOiB7XG4gICAgICAgICAgICAgICAgcmVxdWlyZWQ6IFwiVGhlIEVtYWlsIGZpZWxkIGlzIGVtcHR5XCIsXG4gICAgICAgICAgICAgICAgZW1haWw6IFwiUGxlYXNlIGVudGVyIGNvcnJlY3QgZW1haWxcIlxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgIFxuICAgICAgICBlcnJvckNsYXNzOiBcImVycm9yXCIsXG4gICAgICAgIHZhbGlkQ2xhc3M6IFwic3VjY2Vzc1wiLFxuICAgICAgICBpbnZhbGlkSGFuZGxlcjogZnVuY3Rpb24oZXZlbnQsIHZhbGlkYXRvcikge1xuICAgICAgICAgICAgaWYoJCgnZm9ybS5ibG9jay1wb3B1cC1mb3JtIGRpdi5lcnJvcicpLmxlbmd0aClcbiAgICAgICAgICAgICAgICAkKCdmb3JtLmJsb2NrLXBvcHVwLWZvcm0gZGl2LmVycm9yJykuaHRtbCggXCIgXCIgKS5oaWRlKCk7XG4gICAgICAgIH0sXG4gICAgICAgIC8vINGD0L/RgNCw0LLQu9C10L3QuNC1INC+0YjQuNCx0LrQsNC80LhcbiAgICAgICAgc2hvd0Vycm9yczogZnVuY3Rpb24oZXJyb3JNYXAsIGVycm9yTGlzdCkge1xuICAgICAgICAgICAgdmFyIG1zZyA9IG51bGw7XG4gICAgICAgICAgICAkLmVhY2goZXJyb3JMaXN0LCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICBtc2cgPSB0aGlzLm1lc3NhZ2UgKyAnPGJyIC8+JzsgfSk7XG4gICAgICAgICAgICAgXG4gICAgICAgICAgICBpZihtc2cgIT09IG51bGwpIFxuICAgICAgICAgICAgICAgICQoXCJmb3JtLmJsb2NrLXBvcHVwLWZvcm0gZGl2LmVycm9yXCIpLmh0bWwobXNnKS5zaG93KCk7XG4gICAgICAgIH0sXG5cbiAgICAgICAgc3VibWl0SGFuZGxlcjogZnVuY3Rpb24oIGZvcm0gKSB7IC8vIHN1Ym1pdEhhbmRsZXJcbiAgICAgICAgICAgIHZhciAkZm9ybSA9ICQoZm9ybSksIF9wYXJhbXMgPSBwYXJzZVF1ZXJ5KCRmb3JtLnNlcmlhbGl6ZUFycmF5KCkpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICBpZigkKCdmb3JtLmJsb2NrLXBvcHVwLWZvcm0gZGl2LmVycm9yJykubGVuZ3RoKVxuICAgICAgICAgICAgICAgICQoJ2Zvcm0uYmxvY2stcG9wdXAtZm9ybSBkaXYuZXJyb3InKS5odG1sKCBcIiBcIiApLmhpZGUoKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gZGlzYWJsZWQgYnV0dG9uXG4gICAgICAgICAgICAkZm9ybS5maW5kKCdidXR0b24nKS5wcm9wKCBcImRpc2FibGVkXCIsIHRydWUgKTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgXG4gICAgICAgICAgICB2YXIganFYSFIgPSBfZ2V0QUpBWCggXG4gICAgICAgICAgICAgICAgJ2h0dHA6Ly9wdW1waWMuY29tL3BvcHVwX2VtYWlsX3NlbmQuaHRtbCcsIFxuICAgICAgICAgICAgICAgIF9wYXJhbXMsIHtcbiAgICAgICAgICAgICAgICAgICAgJ2RhdGFUeXBlJzogJ2pzb25wJyxcbiAgICAgICAgICAgICAgICAgICAgJ2Nyb3NzRG9tYWluJzogdHJ1ZSxcbiAgICAgICAgICAgICAgICB9IFxuICAgICAgICAgICAgKTtcbiAgICBcbiAgICAgICAgICAgIGlmKHR5cGVvZiBqcVhIUiA9PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgIGpxWEhSXG4gICAgICAgICAgICAgICAgLmRvbmUoZnVuY3Rpb24oZGF0YSwgdGV4dFN0YXR1cywganFYSFIpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYodGV4dFN0YXR1cyA9PSAnc3VjY2VzcycpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCBkYXRhICk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihkYXRhLmVycm9yKSB7IFxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZih0eXBlb2YgZGF0YS5lcnJvciA9PT0gJ29iamVjdCcpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKGRhdGEuZXJyb3IsIGZ1bmN0aW9uKG5hbWUsIHRleHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBfb2JqID0gJGZvcm0uZmluZCgnaW5wdXRbbmFtZT1cIicrbmFtZSsnXCJdJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihfb2JqLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKF9vYmoubmV4dCgnbGFiZWwnKS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIF9vYmoubmV4dCgpLmh0bWwoIHRleHQgKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZWxzZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCdmb3JtLmJsb2NrLXBvcHVwLWZvcm0gZGl2LmVycm9yJykuaHRtbCggdGV4dCApLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8kKCc8bGFiZWwgaWQ9XCInK25hbWUrJy1lcnJvclwiIGZvcj1cIicrbmFtZSsnXCIgY2xhc3M9XCJlcnJvclwiPicrdGV4dCsnPC9sYWJlbD4nKS5pbnNlcnRBZnRlcihfb2JqKTsgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnZm9ybS5ibG9jay1wb3B1cC1mb3JtIGRpdi5lcnJvcicpLmh0bWwoIGRhdGEuZXJyb3IgKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZGlzYWJsZWQgYnV0dG9uXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGZvcm0uZmluZCgnYnV0dG9uJykucHJvcCggXCJkaXNhYmxlZFwiLCBmYWxzZSApO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZihkYXRhLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAvLyBnb29nbGUgYW5hbGl0eWNzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gZ2EoJ3NlbmQnLCAnZXZlbnQnLCAnZm9ybScsICdzdWJtaXQnLCAnY29tcGF0aWJpbGl0eS1yZXF1ZXN0LXN1Y2Nlc3MnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgJF9wb3BVcCA9ICQoJy5ib3gtcG9wVXAnKSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJGVtYWlsX3N1Y2Nlc3MgPSAkX3BvcFVwLmZpbmQoJyNib3gtZW1haWwtc3VjY2VzcycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZighJGVtYWlsX3N1Y2Nlc3MubGVuZ3RoKSB7IFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkZW1haWxfc3VjY2VzcyA9ICRfcG9wVXBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuYXBwZW5kKCBfaHRtbFBvcFVwLmVtYWlsX3N1Y2Nlc3MgKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5maW5kKCcjYm94LWVtYWlsLXN1Y2Nlc3MnKTsgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNsb3NlIHBvcFVwXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYoJCgnLmJveC1wb3BVcCA+IC5wb3BVcCcpLmlzKCc6dmlzaWJsZScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJy5ib3gtcG9wVXAgPiAucG9wVXAnKS5iUG9wdXAoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdHJhbnNpdGlvbjogJ2ZhZGVPdXQnXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmNsb3NlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJGVtYWlsX3N1Y2Nlc3MuYlBvcHVwKHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1vZGFsQ2xvc2U6IHRydWUsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3BhY2l0eTogMC42LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9sbG93OiBbZmFsc2UsIGZhbHNlXSwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvblN0eWxlOiAnZml4ZWQnLCAvLydmaXhlZCcgb3IgJ2Fic29sdXRlJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25PcGVuOiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbG9zZUNsYXNzOiAnY2xvc2UnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb25DbG9zZTogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCdmb3JtLmJsb2NrLXBvcHVwLWZvcm0gZGl2LmVycm9yJykuaHRtbCgnWW91ciBlbWFpbCB3YXMgbm90IHNlbnQnKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnU3lzdGVtIGVycm9yICcrIHRleHRTdGF0dXMgKychJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBkaXNhYmxlZCBidXR0b25cbiAgICAgICAgICAgICAgICAgICAgICAgICRmb3JtLmZpbmQoJ2J1dHRvbicpLnByb3AoIFwiZGlzYWJsZWRcIiwgZmFsc2UgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuZmFpbCAgKGZ1bmN0aW9uKGpxWEhSLCB0ZXh0U3RhdHVzLCBlcnJvclRocm93bikgeyBcbiAgICAgICAgICAgICAgICAgICAgJCgnZm9ybS5ibG9jay1wb3B1cC1mb3JtIGRpdi5lcnJvcicpLmh0bWwoJ1lvdXIgZW1haWwgd2FzIG5vdCBzZW50Jykuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1N5c3RlbSBlcnJvciAoSlNPUDpSRVFVRVNUKSEnKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gZGlzYWJsZWQgYnV0dG9uXG4gICAgICAgICAgICAgICAgICAgICRmb3JtLmZpbmQoJ2J1dHRvbicpLnByb3AoIFwiZGlzYWJsZWRcIiwgZmFsc2UgKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKCdmb3JtLmJsb2NrLXBvcHVwLWZvcm0gZGl2LmVycm9yJykuaHRtbCgnWW91ciBlbWFpbCB3YXMgbm90IHNlbnQnKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdTeXN0ZW0gZXJyb3IgKENSRUFURTpPQkpFQ1QpIScpO1xuICAgICAgICAgICAgICAgIC8vIGRpc2FibGVkIGJ1dHRvblxuICAgICAgICAgICAgICAgICRmb3JtLmZpbmQoJ2J1dHRvbicpLnByb3AoIFwiZGlzYWJsZWRcIiwgZmFsc2UgKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIC8qIGpzb25cbiAgICAgICAgICAgIHZhciBfcmVzID0gZ2V0QWpheEZvcm0oJ2h0dHA6Ly9wdW1waWMuY29tL3BvcHVwX2VtYWlsX3NlbmQuaHRtbCcsIF9wYXJhbXMsIHtcbiAgICAgICAgICAgICAgICAnZGF0YVR5cGUnOiAnanNvbicsXG4gICAgICAgICAgICAgICAgJ2Nyb3NzRG9tYWluJzogdHJ1ZSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgaWYodHlwZW9mIF9yZXMgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgICAgICAgaWYoX3Jlcy5lcnJvcikgeyBcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBfcmVzLmVycm9yID09PSAnb2JqZWN0Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgJC5lYWNoKF9yZXMuZXJyb3IsIGZ1bmN0aW9uKG5hbWUsIHRleHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgX29iaiA9ICRmb3JtLmZpbmQoJ2lucHV0W25hbWU9XCInK25hbWUrJ1wiXScpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKF9vYmoubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKF9vYmoubmV4dCgnbGFiZWwnKS5sZW5ndGgpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBfb2JqLm5leHQoKS5odG1sKCB0ZXh0ICkuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbHNlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCdmb3JtLmJsb2NrLXBvcHVwLWZvcm0gZGl2LmVycm9yJykuaHRtbCggdGV4dCApLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vJCgnPGxhYmVsIGlkPVwiJytuYW1lKyctZXJyb3JcIiBmb3I9XCInK25hbWUrJ1wiIGNsYXNzPVwiZXJyb3JcIj4nK3RleHQrJzwvbGFiZWw+JykuaW5zZXJ0QWZ0ZXIoX29iaik7IFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCdmb3JtLmJsb2NrLXBvcHVwLWZvcm0gZGl2LmVycm9yJykuaHRtbCggX3Jlcy5lcnJvciApLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgLy8gZGlzYWJsZWQgYnV0dG9uXG4gICAgICAgICAgICAgICAgICAgICRmb3JtLmZpbmQoJ2J1dHRvbicpLnByb3AoIFwiZGlzYWJsZWRcIiwgZmFsc2UgKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICAgICAgICAgIH0gZWxzZSBpZihfcmVzLnN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gZ29vZ2xlIGFuYWxpdHljc1xuICAgICAgICAgICAgICAgICAgICAvLyBnYSgnc2VuZCcsICdldmVudCcsICdmb3JtJywgJ3N1Ym1pdCcsICdjb21wYXRpYmlsaXR5LXJlcXVlc3Qtc3VjY2VzcycpO1xuXG4gICAgICAgICAgICAgICAgICAgIFxuXG4gICAgICAgICAgICAgICAgICAgIC8vIGNsb3NlIHBvcFVwXG4gICAgICAgICAgICAgICAgICAgIGlmKCQoJy5ib3gtcG9wVXAgPiAucG9wVXAnKS5pcygnOnZpc2libGUnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgJCgnLmJveC1wb3BVcCA+ICNib3gtZW1haWwnKS5iUG9wdXAoe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRyYW5zaXRpb246ICdmYWRlT3V0J1xuICAgICAgICAgICAgICAgICAgICAgICAgfSkuY2xvc2UoKTtcbiAgICAgICAgICAgICAgICAgICAgfSAgICAgICAgXG5cbiAgICAgICAgICAgICAgICAgICAgJCgnLmJveC1wb3BVcCA+ICNib3gtZW1haWwtc3VjY2VzcycpLmJQb3B1cCh7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kYWxDbG9zZTogdHJ1ZSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcHBlbmRpbmc6IGZhbHNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wYWNpdHk6IDAuNixcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb2xsb3c6IFtmYWxzZSwgZmFsc2VdLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBwb3NpdGlvblN0eWxlOiAnZml4ZWQnLCAvLydmaXhlZCcgb3IgJ2Fic29sdXRlJ1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uT3BlbjogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbG9zZUNsYXNzOiAnY2xvc2UnLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9uQ2xvc2U6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICQoJ2Zvcm0uYmxvY2stcG9wdXAtZm9ybSBkaXYuZXJyb3InKS5odG1sKCdZb3VyIGVtYWlsIHdhcyBub3Qgc2VudCcpLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1N5c3RlbSBlcnJvciEnKTtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIC8vIGRpc2FibGVkIGJ1dHRvblxuICAgICAgICAgICAgICAgICAgICAkZm9ybS5maW5kKCdidXR0b24nKS5wcm9wKCBcImRpc2FibGVkXCIsIGZhbHNlICk7XG4gICAgICAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAkKCdmb3JtLmJsb2NrLXBvcHVwLWZvcm0gZGl2LmVycm9yJykuaHRtbCgnWW91ciBlbWFpbCB3YXMgbm90IHNlbnQnKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gZGlzYWJsZWQgYnV0dG9uXG4gICAgICAgICAgICAgICAgJGZvcm0uZmluZCgnYnV0dG9uJykucHJvcCggXCJkaXNhYmxlZFwiLCBmYWxzZSApO1xuICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICovXG4gICAgICAgICAgICAkZm9ybS50cmlnZ2VyKFwicmVzZXRcIik7IFxuICAgICAgICB9XG4gICAgfSk7XG4gICAgXG59IiwiLy8gZGV0ZWN0ZWQgaW1hZ2Ugb25sb2FkXG47KGZ1bmN0aW9uICgkKSB7XG4gICAgJC5mbi5iaW5kSW1hZ2VMb2FkID0gZnVuY3Rpb24gKGNhbGxiYWNrKSB7XG4gICAgICAgIGZ1bmN0aW9uIGlzSW1hZ2VMb2FkZWQoaW1nKSB7XG4gICAgICAgICAgICAvLyDQktC+INCy0YDQtdC80Y8g0YHQvtCx0YvRgtC40Y8gbG9hZCBJRSDQuCDQtNGA0YPQs9C40LUg0LHRgNCw0YPQt9C10YDRiyDQv9GA0LDQstC40LvRjNC90L5cbiAgICAgICAgICAgIC8vINC+0L/RgNC10LTQtdC70Y/RjtGCINGB0L7RgdGC0L7Rj9C90LjQtSDQutCw0YDRgtC40L3QutC4INGH0LXRgNC10Lcg0LDRgtGA0LjQsdGD0YIgY29tcGxldGUuXG4gICAgICAgICAgICAvLyDQmNGB0LrQu9GO0YfQtdC90LjQtSDRgdC+0YHRgtCw0LLQu9GP0Y7RgiBHZWNrby1iYXNlZCDQsdGA0LDRg9C30LXRgNGLLlxuICAgICAgICAgICAgaWYgKCFpbWcuY29tcGxldGUpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyDQotC10Lwg0L3QtSDQvNC10L3QtdC1LCDRgyDQvdC40YUg0LXRgdGC0Ywg0LTQstCwINC+0YfQtdC90Ywg0L/QvtC70LXQt9C90YvRhSDRgdCy0L7QudGB0YLQstCwOiBuYXR1cmFsV2lkdGgg0LggbmF0dXJhbEhlaWdodC5cbiAgICAgICAgICAgIC8vINCe0L3QuCDQtNCw0Y7RgiDQuNGB0YLQuNC90L3Ri9C5INGA0LDQt9C80LXRgCDQuNC30L7QsdGA0LDQttC10L3QuNGPLiDQldGB0LvQuCDQutCw0LrRgNGC0LjQvdC60LAg0LXRidC1INC90LUg0LfQsNCz0YDRg9C30LjQu9Cw0YHRjCxcbiAgICAgICAgICAgIC8vINGC0L4g0L7QvdC4INC00L7Qu9C20L3RiyDQsdGL0YLRjCDRgNCw0LLQvdGLINC90YPQu9GOLlxuICAgICAgICAgICAgaWYgKHR5cGVvZiBpbWcubmF0dXJhbFdpZHRoICE9PSBcInVuZGVmaW5lZFwiICYmIGltZy5uYXR1cmFsV2lkdGggPT09IDApIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyDQmtCw0YDRgtC40L3QutCwINC30LDQs9GA0YPQttC10L3QsC5cbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG5cbiAgICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB2YXIgZWxlID0gJCh0aGlzKTtcbiAgICAgICAgICAgIGlmIChlbGUuaXMoXCJpbWdcIikgJiYgJC5pc0Z1bmN0aW9uKGNhbGxiYWNrKSkge1xuICAgICAgICAgICAgICAgIGVsZS5vbmUoXCJsb2FkXCIsIGNhbGxiYWNrKTtcbiAgICAgICAgICAgICAgICBpZiAoaXNJbWFnZUxvYWRlZCh0aGlzKSkge1xuICAgICAgICAgICAgICAgICAgICBlbGUudHJpZ2dlcihcImxvYWRcIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9O1xufSkoalF1ZXJ5KTtcblxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKXsgXG4gICAgLyogY2FwY2hhIHJlc2l6ZSAqL1xuICBpZigkKCdmb3JtIC5ib3gtY2FwdGNoYSA+IGltZycpLmxlbmd0aCkgeyBcbiAgICAgICQoJ2Zvcm0gLmJveC1jYXB0Y2hhID4gaW1nJykuYmluZEltYWdlTG9hZChmdW5jdGlvbigpIHsgXG4gICAgICAgICAgICB2YXIgX2JjYXB0Y2hhID0gJCh0aGlzKS5wYXJlbnRzKCcuYm94LWNhcHRjaGEnKSwgX2JjdyA9IF9iY2FwdGNoYS53aWR0aCgpLFxuICAgICAgICAgICAgX3dpZHRoID0gJCh0aGlzKS53aWR0aCgpLCB3aWR0aCA9ICQodGhpcykub3V0ZXJXaWR0aCh0cnVlKSxcbiAgICAgICAgICAgIF91cGRhdGUgPSBfYmNhcHRjaGEuZmluZCgnLnVwZGF0ZS1jYXB0Y2hhJyk7XG4gICAgICAgICAgICAkKHRoaXMpLmNzcyh7J3dpZHRoJzogKF9iY3cgLSA1NCkrJ3B4J30pO1xuICAgICAgICAgICAgX3VwZGF0ZS5hdHRyKCdhdHRyLXdpZHRoJywgX2JjdyAtIDU0KTtcbiAgICAgIH0pO1xuICB9ICBcbiAgICBcbiAgICAvKiBpbWFnZXMgbW9iaWxlICovXG4gIGlmKCQoJyNib3gtY29udGVudC1wb3N0IGltZywgI2Jsb2NrLWNvbnRlbnQgaW1nJykubGVuZ3RoKSB7XG4gICAgICBcbiAgICAgIFxuICAgICAgLy8kKCcjYm94LWNvbnRlbnQtcG9zdCBpbWcnKS5lYWNoKGZ1bmN0aW9uKCkge1xuICAgICAgJCgnI2JveC1jb250ZW50LXBvc3QgaW1nLCAjYmxvY2stY29udGVudCBpbWcnKS5iaW5kSW1hZ2VMb2FkKGZ1bmN0aW9uKCkgeyAgICBcbiAgICAgICAgICBcbiAgICAgICAgICB2YXIgd2lkdGggPSAkKHRoaXMpLmF0dHIoJ3dpZHRoJyksXG4gICAgICAgICAgICAgIHBhcmVudCA9ICQodGhpcykuY2xvc2VzdCgnLndwLWNhcHRpb24nKSwgXG4gICAgICAgICAgICAgIF9jYXB0aW9uX3RleHQgPSBwYXJlbnQuZmluZCgnLndwLWNhcHRpb24tdGV4dCcpLFxuICAgICAgICAgICAgICAgIF9zcmMgPSAkKHRoaXMpLmF0dHIoJ3NyYycpLFxuICAgICAgICAgICAgICAgIGhlaWdodCA9ICQodGhpcykuYXR0cignaGVpZ2h0JyksXG4gICAgICAgICAgICAgICAgb3V0ZXJfd2lkdGggPSAkKHRoaXMpLm91dGVyV2lkdGgodHJ1ZSksXG4gICAgICAgICAgICAgICAgcGFyZW50X291dGVyX3dpZHRoID0gcGFyZW50Lm91dGVyV2lkdGgodHJ1ZSk7XG4gICAgICAgICAgXG4gICAgICAgICAgJCh0aGlzKS5hdHRyKCdhdHRyLXdpZHRoJywgd2lkdGgpLnJlbW92ZUF0dHIoJ3dpZHRoJyk7XG4gICAgICAgICAgJCh0aGlzKS5hdHRyKCdhdHRyLWhlaWdodCcsIGhlaWdodCkucmVtb3ZlQXR0cignaGVpZ2h0Jyk7XG4gICAgICAgICAgLy8kKHRoaXMpLmF0dHIoJ3NyYycsICcnKTtcbiAgICAgICAgICBcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZyh3aWR0aCwgaGVpZ2h0KTtcbiAgICAgICAgICBcbiAgICAgICAgICAkKHRoaXMpLmNzcyh7XG4gICAgICAgICAgICAgIC8vJ2JhY2tncm91bmQnOiAndXJsKCBcIicrX3NyYysnXCIgKSBuby1yZXBlYXQnLFxuICAgICAgICAgICAgICAnYmFja2dyb3VuZC1zaXplJzogJ2NvbnRhaW4nLFxuICAgICAgICAgICAgICAvLydtYXgtd2lkdGgnOiB3aWR0aCsncHgnLCBcbiAgICAgICAgICAgICAgJ2hlaWdodCcgOiAnYXV0bycsXG4gICAgICAgICAgICAgICd3aWR0aCc6ICdhdXRvJyxcbiAgICAgICAgICAgICAgJ21heC1oZWlnaHQnOiBoZWlnaHQrJ3B4JyxcbiAgICAgICAgICB9KTtcbiAgICAgICAgICBcbiAgICAgICAgICBpZihwYXJlbnQubGVuZ3RoKVxuICAgICAgICAgICAgICBwYXJlbnQuY3NzKHtcbiAgICAgICAgICAgICAgICAgICdjbGVhcic6ICdib3RoJyxcbiAgICAgICAgICAgICAgICAgICd3aWR0aCc6ICdhdXRvJyxcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgXG4gICAgICAgICAgLy9jb25zb2xlLmxvZygnIC0tLS0gU3RhcnQgd2lkdGggLS0tLS0tLS0gJyk7XG4gICAgICAgICAgLy9jb25zb2xlLmxvZyhwYXJlbnRfb3V0ZXJfd2lkdGgsIG91dGVyX3dpZHRoKTtcbiAgICAgICAgICAvL2NvbnNvbGUubG9nKCAnLS0tLS0tLS0gZW5kIC0tLS0tLS0tLScgKTtcbiAgICAgICAgICBcbiAgICAgICAgICBpZihfY2FwdGlvbl90ZXh0Lmxlbmd0aCkge1xuICAgICAgICAgICAgICBpZihwYXJlbnRfb3V0ZXJfd2lkdGggPiAwKSB7XG4gICAgICAgICAgICAgICAgX2NhcHRpb25fdGV4dC5jc3Moe1xuICAgICAgICAgICAgICAgICAgJ3dpZHRoJzogJzEwMCUnLCAgXG4gICAgICAgICAgICAgICAgICAnbWF4LXdpZHRoJzogcGFyZW50X291dGVyX3dpZHRoKydweCcsXG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgIH0gZWxzZSBpZihvdXRlcl93aWR0aCA+IDApIHtcbiAgICAgICAgICAgICAgICAgX2NhcHRpb25fdGV4dC5jc3Moe1xuICAgICAgICAgICAgICAgICAgICAgJ3dpZHRoJzogJzEwMCUnLFxuICAgICAgICAgICAgICAgICAgICAnbWF4LXdpZHRoJzogb3V0ZXJfd2lkdGgrJ3B4JyxcbiAgICAgICAgICAgICAgICB9KTsgXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIFxuICAgICAgICAgIFxuICAgICAgfSk7XG4gICAgICBcbiAgICAgIFxuICB9XG59KTtcblxuLy8gLndwLWNhcHRpb25cbiQoIHdpbmRvdyApLnJlc2l6ZShmdW5jdGlvbigpIHtcbiAgICB2YXIgJF93VyA9ICQod2luZG93KS53aWR0aCgpO1xuICAgIFxuICAgIC8vIGZvcm0uc2VuZF9maW5kX3Bob25lIC5ib3gtY2FwdGNoYSBpbWdcbiAgICBpZigkKCdmb3JtIC5ib3gtY2FwdGNoYSA+IGltZycpLmxlbmd0aCkge1xuICAgICAgICAkKCdmb3JtIC5ib3gtY2FwdGNoYSA+IGltZycpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICB2YXIgX2JjYXB0Y2hhID0gJCh0aGlzKS5wYXJlbnRzKCcuYm94LWNhcHRjaGEnKSwgX2JjdyA9IF9iY2FwdGNoYS53aWR0aCgpLFxuICAgICAgICAgICAgX3dpZHRoID0gJCh0aGlzKS53aWR0aCgpLCB3aWR0aCA9ICQodGhpcykub3V0ZXJXaWR0aCh0cnVlKSxcbiAgICAgICAgICAgIF91cGRhdGUgPSBfYmNhcHRjaGEuZmluZCgnLnVwZGF0ZS1jYXB0Y2hhJyk7XG4gICAgICAgICAgICAkKHRoaXMpLmNzcyh7J3dpZHRoJzogKF9iY3cgLSA1NCkrJ3B4J30pO1xuICAgICAgICAgICAgX3VwZGF0ZS5hdHRyKCdhdHRyLXdpZHRoJywgX2JjdyAtIDU0KTtcbiAgICAgICAgICAgIFxuICAgICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgXG4gICAgLy8gYm94LWNvbnRlbnQtcG9zdFxuICAgIGlmKCQoJyNib3gtY29udGVudC1wb3N0IGltZywgI2Jsb2NrLWNvbnRlbnQgaW1nJykubGVuZ3RoKSB7XG4gICAgICAkKCcjYm94LWNvbnRlbnQtcG9zdCBpbWcsICNibG9jay1jb250ZW50IGltZycpLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgdmFyIF9jYXB0aW9uID0gJCh0aGlzKS5wYXJlbnRzKCcud3AtY2FwdGlvbicpLCBcbiAgICAgICAgICAgICAgICB3aWR0aCA9ICQodGhpcykub3V0ZXJXaWR0aCh0cnVlKSxcbiAgICAgICAgICAgICAgICBfYXR0YWNobWVudFcgPSAkKHRoaXMpLmNsb3Nlc3QoJyNhdHRhY2htZW50Jykub3V0ZXJXaWR0aCh0cnVlKSxcbiAgICAgICAgICAgICAgICBfd2lkdGggPSAkKHRoaXMpLndpZHRoKCksXG4gICAgICAgICAgICAgICAgX2F0dHJXID0gJCh0aGlzKS5hdHRyKCdhdHRyLXdpZHRoJyk7XG5cbiAgICAgICAgICBpZihfY2FwdGlvbi5maW5kKCcud3AtY2FwdGlvbi10ZXh0JykubGVuZ3RoKVxuICAgICAgICAgICAgX2NhcHRpb24uZmluZCgnLndwLWNhcHRpb24tdGV4dCcpLmNzcyh7XG4gICAgICAgICAgICAgICAgJ3dpZHRoJzogd2lkdGgrJ3B4JyxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgXG4gICAgICB9KTtcbiAgICB9ICBcbn0pOyIsIiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCl7IFxuLy8gICAgdmFyICRidGggPSAkKFwiI2Jsb2NrLXRlY2hub2xvZ2ljYWwtaGVhZGVyIC5ib3gtaGVkYWVyLWJvZHlcIiksXG4vLyAgICAgICAgX2JpVyA9ICRidGguZmluZCgnLmJsb2NrLWltYWdlcycpLndpZHRoKHRydWUpLFxuLy8gICAgICAgIF9iaUggPSAkYnRoLmZpbmQoJy5ibG9jay1pbWFnZXMnKS5oZWlnaHQodHJ1ZSk7XG4vLyAgICAgICAgXG4vLyAgICBpZigkKFwiI2JveC1pbWctbGluZXNcIikuaXMoJzp2aXNpYmxlJykpICAgIFxuLy8gICAgICAgICQoXCIjYm94LWltZy1saW5lcyBpbWdcIikuY3NzKHsnd2lkdGgnOiBfYmlXICsncHgnLCAnbWFyZ2luLWxlZnQnOiAnLScrKF9iaVcgLyAyICkrJ3B4J30pO1xuXG59KTtcblxuLy8vLyAud3AtY2FwdGlvblxuJCggd2luZG93ICkucmVzaXplKGZ1bmN0aW9uKCkge1xuLy8gICAgdmFyICRfd1cgPSAkKHdpbmRvdykud2lkdGgoKSxcbi8vICAgICAgICAkX2hIID0gJCh3aW5kb3cpLmhlaWdodCgpLFxuLy8gICAgICAgICRidGggPSAkKFwiI2Jsb2NrLXRlY2hub2xvZ2ljYWwtaGVhZGVyIC5ib3gtaGVkYWVyLWJvZHlcIiksXG4vLyAgICAgICAgX2JpVyA9ICRidGguZmluZCgnLmJsb2NrLWltYWdlcycpLm91dGVyV2lkdGgodHJ1ZSksXG4vLyAgICAgICAgX2JpSCA9ICRidGguZmluZCgnLmJsb2NrLWltYWdlcycpLm91dGVySGVpZ2h0KHRydWUpLFxuLy8gICAgICAgIFxuLy8gICAgICAgIF9iaUlXID0gZmFsc2UsIF9iaUlIID0gZmFsc2UsXG4vLyAgICAgICAgXG4vLyAgICAgICAgX21sID0gKDQyIC8gX2JpVykgKiAxMDAsXG4vLyAgICAgICAgX210ID0gKDE2IC8gX2JpSCkgKiAxMDA7XG4vLyAgICBcbi8vICAgICAgICBpZigkKFwiI2JveC1pbWctbGluZXNcIikuaXMoJzp2aXNpYmxlJykpXG4vLyAgICAgICAgICAgICQoXCIjYm94LWltZy1saW5lcyBpbWdcIikuY3NzKHsnd2lkdGgnOiAoX2JpVyAtIDMwKSArJ3B4JywgJ21hcmdpbi1sZWZ0JzogJy0nKyhfYmlXIC8gMiApKydweCd9KTtcbiAgICBcbi8vICAgIGNvbnNvbGUubG9nKCAnV3cgPSAnKyRfd1crJyBoSCA9ICcrICRfaEggKycgX2JpVyA9ICcrIF9iaVcgKyAnIF9iaUggPSAnKyBfYmlIICsnIF9iaUlXID0gJysgX2JpSVcgKyAnIF9iaUlIID0gJysgX2JpSUggKTtcbi8vICAgIFxuLy8gICAgaWYoJGJ0aC5maW5kKCcjYm94LWltYWdlLWVsZW1lbnQgLmJveC1pbWctbWlkZGxlJykuaXMoJzp2aXNpYmxlJykpIHtcbi8vICAgICAgX2JpSVcgPSAkYnRoLmZpbmQoJyNib3gtaW1hZ2UtZWxlbWVudCAuYm94LWltZy1taWRkbGUgaW1nJykub3V0ZXJXaWR0aCh0cnVlKTtcbi8vICAgICAgX2JpSUggPSAkYnRoLmZpbmQoJyNib3gtaW1hZ2UtZWxlbWVudCAuYm94LWltZy1taWRkbGUgaW1nJykub3V0ZXJIZWlnaHQodHJ1ZSk7XG4vLyAgICAgIFxuLy8gICAgICAkYnRoLmZpbmQoJyNib3gtaW1hZ2UtZWxlbWVudCAuYm94LWltZy1taWRkbGUgaW1nJykuY3NzKHtcbi8vICAgICAgICAgICdtYXJnaW4tbGVmdCc6IF9tbCsnJScsXG4vLyAgICAgICAgICAnbWFyZ2luLXRvcCc6IF9tdCsnJSdcbi8vICAgICAgfSk7XG4vLyAgICAgIFxuLy8gICAgfSBlbHNlIGlmKCRidGguZmluZCgnI2JveC1pbWFnZS1lbGVtZW50IC5ib3gtaW1nLWJpZycpLmlzKCc6dmlzaWJsZScpKSB7XG4vLyAgICAgIF9iaUlXID0gJGJ0aC5maW5kKCcjYm94LWltYWdlLWVsZW1lbnQgLmJveC1pbWctYmlnIGltZycpLm91dGVyV2lkdGgodHJ1ZSk7IFxuLy8gICAgICBfYmlJSCA9ICRidGguZmluZCgnI2JveC1pbWFnZS1lbGVtZW50IC5ib3gtaW1nLWJpZyBpbWcnKS5vdXRlckhlaWdodCh0cnVlKTtcbi8vICAgIH0gXG4gICAgXG4gICAgXG4gICAgXG4gICAgXG59KTsiLCIvLyBUaGUgcGx1Z2luIGNvZGVcbihmdW5jdGlvbigkKXtcbiAgICAkLmZuLnNjcm9sbFB1bXBpYyA9IGZ1bmN0aW9uKG9wdGlvbnMpe1xuICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpO1xuICAgICAgICAgICAgb2Zmc2V0ID0gJHRoaXMub2Zmc2V0KCk7XG4gICAgICAgIHZhciBfc3RvcCA9IGZhbHNlLCBcbiAgICAgICAgICAgIF9vYmpGbHkgPSBmYWxzZSwgXG4gICAgICAgICAgICBkZWR1ZyA9IGZhbHNlOyAvLyBkZWJ1Z2luZyBjb2RlXG4gICAgICAgIFxuICAgICAgICB2YXIgZGVmYXVsdHMgPSB7XG4gICAgICAgICAgICBcInN0YXJ0XCI6IDAsXG4gICAgICAgICAgICBcInN0b3BcIjogb2Zmc2V0LnRvcCArICR0aGlzLmhlaWdodCgpLFxuICAgICAgICAgICAgXCJfb2JqRmx5XCI6ICcuYm94LWZseS1kaXNjb3VudCcsXG4gICAgICAgICAgICBcInJpZ2h0XCI6IDAsXG4gICAgICAgICAgICBcIl9zaG93XCI6IHRydWUsXG4gICAgICAgICAgICBcIl9zZXR0aW5nc1wiIDoge1xuICAgICAgICAgICAgICAgICdfcmVzcG9uY2UnOiB0cnVlLFxuICAgICAgICAgICAgICAgICdfdmFsaWRhdGUnOiB0cnVlLFxuICAgICAgICAgICAgICAgICdfdmFsaWRhdGVPYmonOiBcIiNmb3JtLWRpc2NvdW50LWZseVwiXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgXCJhbmltYXRlXCI6IHtcbiAgICAgICAgICAgICAgICAndHlwZSc6ICcnLCAvLyBmYWRlLCB2aXNpYmxlLCBibGlua2luZ1xuICAgICAgICAgICAgICAgICd0aW1lU2hvdyc6IDIwMCxcbiAgICAgICAgICAgICAgICAndGltZUhpZGUnOiAxMDBcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vXCJjb2VmZlwiOiAwLjk1XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICBpZihkZWR1ZylcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSAvLyBJTklUIFBMVUdJTiBTQ1JPTEwgLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLScgKTtcbiAgICAgICAgXG4gICAgICAgIHZhciBvcHRzID0gJC5leHRlbmQoZGVmYXVsdHMsIG9wdGlvbnMpO1xuICAgICAgICAgICAgX29iakZseSA9IChvcHRzLl9vYmpGbHkpID8gb3B0cy5fb2JqRmx5IDogZmFsc2U7XG4gICAgICAgIFxuLy8gICAgICAgICQod2luZG93KS5vbigncmVzaXplJywgZnVuY3Rpb24oKSB7IFxuLy8gICAgICAgICAgIGlmKCQodGhpcykud2lkdGgoKSA+IDgwMCkge1xuLy8gICAgICAgICAgICAgICAgJHRoaXMuZmluZCggX29iakZseSApLmNzcyh7J21hcmdpbi1yaWdodCc6IG9wdHMucmlnaHQrJ3B4J30pO1xuLy8gICAgICAgICAgICB9IGVsc2Uge1xuLy8gICAgICAgICAgICAgICAgJHRoaXMuZmluZCggX29iakZseSApLmNzcyh7J21hcmdpbi1yaWdodCc6ICcwcHgnfSk7XG4vLyAgICAgICAgICAgIH1cbi8vICAgICAgICB9KTsgXG5cbiAgICAgICAgaWYoZGVkdWcpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCAnU0NST0xMIFNFVFRJTkdTOiAnLCBvcHRzICk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyggJ3N0YXJ0ID0gJytvcHRzLnN0YXJ0LCAnc3RvcCA9ICcrb3B0cy5zdG9wICk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIFxuICAgICAgICB2YXIgX2FuaW1hdGUgPSB7XG4gICAgICAgICAgICBpbml0OiBmdW5jdGlvbiggc2hvdyApIHtcbiAgICAgICAgICAgICAgICBpZihzaG93KSB7XG4gICAgICAgICAgICAgICAgICAgICR0aGlzLmZpbmQoIF9vYmpGbHkgKS5hZGRDbGFzcygnZml4ZWQnKTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAkdGhpcy5maW5kKCBfb2JqRmx5ICkucmVtb3ZlQ2xhc3MoJ2ZpeGVkJyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHN3aXRjaCAoIG9wdHMuYW5pbWF0ZS50eXBlICkge1xuICAgICAgICAgICAgICAgICAgICAvLyBmYWRlSW4vT3V0XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgIFwiZmFkZVwiOlxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoZGVkdWcpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIHNob3cgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgaWYoc2hvdyAmJiAkdGhpcy5ub3QoJzp2aXNpYmxlJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5zdG9wKHRydWUpLnF1ZXVlKCdmeCcsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuZmFkZUluKCBvcHRzLmFuaW1hdGUudGltZVNob3cgKS5kZXF1ZXVlKCdmeCcpO1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihvcHRzLl9zZXR0aW5ncy5fdmFsaWRhdGUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCBvcHRzLl9zZXR0aW5ncy5fdmFsaWRhdGVPYmogKS52YWxpZGF0ZSgpOyAvLyBpbml0IHZhbGlkYXRlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2UgaWYoIXNob3cgJiYgJHRoaXMuaXMoJzp2aXNpYmxlJykpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5zdG9wKHRydWUpLnF1ZXVlKCdmeCcsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuZmFkZU91dCggb3B0cy5hbmltYXRlLnRpbWVIaWRlICkuZGVxdWV1ZSgnZngnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAvLyBzaG93L2hpZGVcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAgXCJ2aXNpYmxlXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGRlZHVnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCBzaG93ICk7XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKHNob3cgJiYgJHRoaXMubm90KCc6dmlzaWJsZScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMuc3RvcCh0cnVlKS5xdWV1ZSgnZngnLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLnNob3coIG9wdHMuYW5pbWF0ZS50aW1lU2hvdyApLmRlcXVldWUoJ2Z4Jyk7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmKG9wdHMuX3NldHRpbmdzLl92YWxpZGF0ZSlcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoIG9wdHMuX3NldHRpbmdzLl92YWxpZGF0ZU9iaiApLnZhbGlkYXRlKCk7IC8vIGluaXQgdmFsaWRhdGVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZighc2hvdyAmJiAkdGhpcy5pcygnOnZpc2libGUnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLnN0b3AodHJ1ZSkucXVldWUoJ2Z4JywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5oaWRlKCBvcHRzLmFuaW1hdGUudGltZUhpZGUgKS5kZXF1ZXVlKCdmeCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgLy8gb3BhY2l0eVxuICAgICAgICAgICAgICAgICAgICBjYXNlICBcImJsaW5raW5nXCI6XG4gICAgICAgICAgICAgICAgICAgICAgICBpZihkZWR1ZylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggc2hvdyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihzaG93ICYmICR0aGlzLm5vdCgnOnZpc2libGUnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLnN0b3AodHJ1ZSkucXVldWUoJ2Z4JywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5hbmltYXRlKHtvcGFjaXR5OiAxfSwgb3B0cy5hbmltYXRlLnRpbWVTaG93ICkuZGVxdWV1ZSgnZngnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYob3B0cy5fc2V0dGluZ3MuX3ZhbGlkYXRlKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCggb3B0cy5fc2V0dGluZ3MuX3ZhbGlkYXRlT2JqICkudmFsaWRhdGUoKTsgLy8gaW5pdCB2YWxpZGF0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmKCFzaG93ICYmICR0aGlzLmlzKCc6dmlzaWJsZScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMuc3RvcCh0cnVlKS5xdWV1ZSgnZngnLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmFuaW1hdGUoe29wYWNpdHk6IDB9LCBvcHRzLmFuaW1hdGUudGltZUhpZGUgKS5kZXF1ZXVlKCdmeCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBkZWZhdWx0OlxuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihkZWR1ZylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggc2hvdyApO1xuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICBpZihzaG93ICYmICR0aGlzLm5vdCgnOnZpc2libGUnKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLnN0b3AodHJ1ZSkucXVldWUoJ2Z4JywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5hbmltYXRlKHtvcGFjaXR5OiAxfSwgb3B0cy5hbmltYXRlLnRpbWVTaG93ICkuZGVxdWV1ZSgnZngnKTtcblxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYob3B0cy5fc2V0dGluZ3MuX3ZhbGlkYXRlKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJCggb3B0cy5fc2V0dGluZ3MuX3ZhbGlkYXRlT2JqICkudmFsaWRhdGUoKTsgLy8gaW5pdCB2YWxpZGF0ZVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmKCFzaG93ICYmICR0aGlzLmlzKCc6dmlzaWJsZScpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMuc3RvcCh0cnVlKS5xdWV1ZSgnZngnLCBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmFuaW1hdGUoe29wYWNpdHk6IDB9LCBvcHRzLmFuaW1hdGUudGltZUhpZGUgKS5kZXF1ZXVlKCdmeCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrOyAgICBcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG4gICAgICAgIFxuICAgICAgICAvLyBjbGVhciBjYWNoZVxuICAgICAgICBpZigkKHdpbmRvdykuaGFzSGFuZGxlcnMoJ3Njcm9sbCcpKSBcbiAgICAgICAgICAgICQod2luZG93KS5vZmYoJ3Njcm9sbCcpO1xuICAgICAgICBcbiAgICAgICAgJCh3aW5kb3cpLm9uKCdzY3JvbGwnLCBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHdpbmRvd1RvcCA9ICQod2luZG93KS5zY3JvbGxUb3AoKTtcbiAgICAgICAgICAgIF9zdG9wID0gKG9wdHMuc3RvcCkgPyAod2luZG93VG9wIDw9IG9wdHMuc3RvcCkgPyB0cnVlIDogZmFsc2UgOiBmYWxzZTtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgaWYoZGVkdWcpXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3dpbmRvd1RvcCA9ICcrIHdpbmRvd1RvcCwgJ19zdG9wID0gJytfc3RvcCsnIG9wdHMuc3RhcnQgPSAnK29wdHMuc3RhcnQpO1xuICAgICAgICAgICAgXG4gICAgICAgICAgICAgaWYoKHdpbmRvd1RvcCA+PSBvcHRzLnN0YXJ0KSAmJiAhX3N0b3ApIHtcbiAgICAgICAgICAgICAgICAgLy9uZXdDb29yZCA9IHdpbmRvd1RvcCAqIG9wdHMuY29lZmY7XG4gICAgICAgICAgICAgICAgIC8vIGJveCByaWdodFxuICAgICAgICAgICAgICAgIGlmKG9wdHMucmlnaHQgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmKCQod2luZG93KS53aWR0aCgpID4gODAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5maW5kKCBfb2JqRmx5ICkuY3NzKHsnbWFyZ2luLXJpZ2h0Jzogb3B0cy5yaWdodCsncHgnfSk7XG4gICAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5maW5kKCBfb2JqRmx5ICkuY3NzKHsnbWFyZ2luLXJpZ2h0JzogJzBweCd9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIC8vIHJ1biBhbmltYXRlXG4gICAgICAgICAgICAgICAgb3B0cy5fc2hvdyA9IHRydWU7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgfSBlbHNlIGlmKCh3aW5kb3dUb3AgPCBvcHRzLnN0YXJ0KSB8fCBfc3RvcCkgeyBcbiAgICAgICAgICAgICAgICAgLy8gcnVuIGFuaW1hdGVcbiAgICAgICAgICAgICAgICAgb3B0cy5fc2hvdyA9IGZhbHNlOyAgIFxuICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICBcbiAgICAgICAgICAgICBfYW5pbWF0ZS5pbml0KCBvcHRzLl9zaG93ICk7IC8vIGFuaW1hdGVcbiAgICAgICAgICAgIFxuICAgICAgICB9KTtcbiAgICAgICAgXG4gICAgICAgIFxuICAgICAgICAvKlxuICAgICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgICQod2luZG93KS5vbignc2Nyb2xsJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coIG9wdHMuc3RhcnQgKTtcbiAgICAgICAgICAgICAgICBpZihvcHRzLl9zZXR0aW5ncy5fcmVzcG9uY2UpIHtcbiAgICAgICAgICAgICAgICAgICAgaWYoJCh3aW5kb3cpLndpZHRoKCkgPD0gNDgwKSAge1xuICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMuZmluZCggX29iakZseSApLnJlbW92ZUNsYXNzKCdmaXhlZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMuaGlkZSg1MDApO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIHdpbmRvd1RvcCA9ICQod2luZG93KS5zY3JvbGxUb3AoKTtcbiAgICAgICAgICAgICAgICBfc3RvcCA9IChvcHRzLnN0b3ApID8gKHdpbmRvd1RvcCA8PSBvcHRzLnN0b3ApID8gdHJ1ZSA6IGZhbHNlIDogZmFsc2U7IFxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGlmKCh3aW5kb3dUb3AgPj0gb3B0cy5zdGFydCkgJiYgIV9zdG9wKSB7XG4gICAgICAgICAgICAgICAgICAgIC8vbmV3Q29vcmQgPSB3aW5kb3dUb3AgKiBvcHRzLmNvZWZmO1xuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgLy8gYm94IHJpZ2h0XG4gICAgICAgICAgICAgICAgICAgIGlmKG9wdHMucmlnaHQgPiAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKCQod2luZG93KS53aWR0aCgpID4gODAwKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMuZmluZCggX29iakZseSApLmNzcyh7J21hcmdpbi1yaWdodCc6IG9wdHMucmlnaHQrJ3B4J30pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5maW5kKCBfb2JqRmx5ICkuY3NzKHsnbWFyZ2luLXJpZ2h0JzogJzBweCd9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgaWYob3B0cy5fc2hvdykge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYoZGVkdWcpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coIG9wdHMuX3Nob3cgKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLmZpbmQoIF9vYmpGbHkgKS5hZGRDbGFzcygnZml4ZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLnN0b3AodHJ1ZSkucXVldWUoJ2Z4JywgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKHRoaXMpLmFuaW1hdGUoe29wYWNpdHk6IDF9LCAyMDAgKS5kZXF1ZXVlKCdmeCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZihvcHRzLl9zZXR0aW5ncy5fdmFsaWRhdGUpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoIG9wdHMuX3NldHRpbmdzLl92YWxpZGF0ZU9iaiApLnZhbGlkYXRlKCk7IC8vIGluaXQgdmFsaWRhdGVcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgIG9wdHMuX3Nob3cgPSBmYWxzZTsgIFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIH0gZWxzZSBpZigod2luZG93VG9wIDwgb3B0cy5zdGFydCkgfHwgX3N0b3ApIHtcbiAgICAgICAgICAgICAgICAgICAgaWYoIW9wdHMuX3Nob3cpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGRlZHVnKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCBvcHRzLl9zaG93ICk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5maW5kKCBfb2JqRmx5ICkucmVtb3ZlQ2xhc3MoJ2ZpeGVkJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5zdG9wKHRydWUpLnF1ZXVlKCdmeCcsIGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCh0aGlzKS5hbmltYXRlKHtvcGFjaXR5OiAwfSwgMTAwICkuZGVxdWV1ZSgnZngnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgb3B0cy5fc2hvdyA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIGlmKGRlZHVnKVxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyggJ3dpZG93X3dpZHRoID0gJyskKHdpbmRvdykud2lkdGgoKSsnIHdpbmRvd1RvcCA9Jysgd2luZG93VG9wKycgc3RhcnQgPSAnK29wdHMuc3RhcnQgKTtcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICBcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIFxuICAgICAgICAqL1xuICAgICAgICBcbiAgICAgICAgXG4gICAgfTtcbn0pKGpRdWVyeSk7IiwiXG4kKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHtcblx0dmFyIHByb2RzID0geyBpb3M6ICdpb3MnLCBhbmRyb2lkOiAnYW5kcm9pZCcsIGlvc0piOiAnaW9zLWpiJ30sXG5cdFx0XHQkaW9zQnRuID0gJCgnI2ZpbHRlci0nICsgcHJvZHMuaW9zKSxcblx0XHRcdCRhbmRyQnRuID0gJCgnI2ZpbHRlci0nICsgcHJvZHMuYW5kcm9pZCksXG5cdFx0XHQkaW9zSmJCdG4gPSAkKCcjZmlsdGVyLScgKyBwcm9kcy5pb3NKYik7XG5cdHZhciBwcm9kTGlzdCA9IHtcblx0XHRpb3M6ICcjcHJvZC1saXN0LScgKyBwcm9kcy5pb3MsXG5cdFx0YW5kcm9pZDogJyNwcm9kLWxpc3QtJyArIHByb2RzLmFuZHJvaWQsXG5cdFx0aW9zSmI6ICcjcHJvZC1saXN0LScgKyBwcm9kcy5pb3NKYlxuXHR9O1xuXHRcblx0ZnVuY3Rpb24gdG9nZ2xlUHJvZExpc3QocHJvZExpc3QpIHtcblx0XHR2YXIgJHByb2RMaXN0ID0gJChwcm9kTGlzdClcblx0XHQkcHJvZExpc3Quc2libGluZ3MoKS5mYWRlT3V0KDEyMCkucHJvbWlzZSgpLmRvbmUoZnVuY3Rpb24gKCkge1xuXHRcdFx0JHByb2RMaXN0LmZhZGVJbigxMjApXG5cdFx0fSlcblx0fVxuXHRcblx0JCgnLmZpbHRlcl9saXN0Jykub24oJ2NsaWNrJywgJ2xpJywgZnVuY3Rpb24oKSB7XG5cdFx0JCgnLmZpbHRlcl9saXN0IGxpLmZpbHRlci1hY3RpdmUnKS5yZW1vdmVDbGFzcygnZmlsdGVyLWFjdGl2ZScpO1xuXHRcdCQodGhpcykuYWRkQ2xhc3MoJ2ZpbHRlci1hY3RpdmUnKTtcblx0XHQvLyAkKCdpbnB1dFt0eXBlPWNoZWNrYm94XVtuYW1lPWFuZHJvaWQtNDBvZmZdJykucHJvcCgnY2hlY2tlZCcsIGZhbHNlKVxuXHR9KTtcblx0XG5cdCRpb3NCdG4uY2xpY2soZnVuY3Rpb24oKSB7XG5cdFx0dmFyIGlvc0Jsb2NrID0gJCgndGgnKS5maW5kKCdbZGF0YS1pbmZvLWJsb2NrPScrIHByb2RzLmlvcyArJ10nKVxuXHRcdGlmICghJCh0aGlzKS5oYXNDbGFzcygnZmlsdGVyLWFjdGl2ZScpKSB7XG5cdFx0XHR0b2dnbGVQcm9kTGlzdChwcm9kTGlzdC5pb3MpO1xuXHRcdFx0dG9nZ2xlUHJvZExpc3QoaW9zQmxvY2spO1xuXHRcdH1cblx0fSk7XG5cdFxuXHQkaW9zSmJCdG4uY2xpY2soZnVuY3Rpb24oKSB7XG5cdFx0dmFyIGlvc0piQmxvY2sgPSAkKCd0aCcpLmZpbmQoJ1tkYXRhLWluZm8tYmxvY2s9JysgcHJvZHMuaW9zSmIgKyddJylcblx0XHRpZiAoISQodGhpcykuaGFzQ2xhc3MoJ2ZpbHRlci1hY3RpdmUnKSkge1xuXHRcdFx0dG9nZ2xlUHJvZExpc3QocHJvZExpc3QuaW9zSmIpO1xuXHRcdFx0dG9nZ2xlUHJvZExpc3QoaW9zSmJCbG9jayk7XG5cdFx0fVxuXHR9KTtcblx0XG5cdCRhbmRyQnRuLmNsaWNrKGZ1bmN0aW9uKCkge1xuXHRcdHZhciBhbmRyb2lkQmxvY2sgPSAkKCd0aCcpLmZpbmQoJ1tkYXRhLWluZm8tYmxvY2s9JysgcHJvZHMuYW5kcm9pZCArJ10nKVxuXHRcdGlmICghJCh0aGlzKS5oYXNDbGFzcygnZmlsdGVyLWFjdGl2ZScpKSB7XG5cdFx0XHR0b2dnbGVQcm9kTGlzdChwcm9kTGlzdC5hbmRyb2lkKTtcblx0XHRcdHRvZ2dsZVByb2RMaXN0KGFuZHJvaWRCbG9jayk7XG5cdFx0fVxuXHR9KTtcblx0XG59KTsiLCJ2YXIgbW9iaWxlX3NsaWRlciA9IFwiPGRpdiBjbGFzcz1cXFwic2xpZGVcXFwiPlwiO1xuICAgICAgICBtb2JpbGVfc2xpZGVyICs9IFwiPGRpdiBjbGFzcz1cXFwiY29sLXNtLTEyIGNvbC1tZC00IGNvbC1sZy00IGNvbC14cy0xMlxcXCI+XCI7XG4gICAgICAgIG1vYmlsZV9zbGlkZXIgKz0gICAgXCI8aW1nIHNyYz1cXFwie2ltZ19zcmN9XFxcIiBjbGFzcz1cXFwidGVzdGltb25pYWwtcGhvdG9cXFwiPlwiO1xuICAgICAgICBtb2JpbGVfc2xpZGVyICs9ICAgIFwiPGRpdiBjbGFzcz1cXFwidGVzdGltb25pYWwtdGV4dFxcXCI+e3RleHR9PC9kaXY+XCI7XG4gICAgICAgIG1vYmlsZV9zbGlkZXIgKz0gXCI8L2Rpdj5cIjtcbiAgICBtb2JpbGVfc2xpZGVyICs9IFwiPC9kaXY+XCI7XG4gICAgXG52YXIgb2JqU2xpZGVyTW9iaWxlID0gJCgnLmJ4U2xpZGVyTW9iaWxlJyk7XG52YXIgYnhTbGlkZXJzID0gZmFsc2U7XG52YXIgYnhTbGlkZXJzTW9iaWxlID0gZmFsc2U7XG52YXIgYnhTbGlkZXJzUEMgPSBmYWxzZTtcbiAgICBcbiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCl7IFxuICAgIC8vIC5yZXBsYWNlXG4gICAgXG4gICAgXG4gICAgXG4gICAgaWYoJCgnLmJ4U2xpZGVycycpLmxlbmd0aCkge1xuICAgIFxuLy8gICAgICAgIGlmKCQoJy5ieFNsaWRlcnMnKS5ub3QoJy5vbmx5LW1vYmlsZSwgLm9ubHktcGMnKSkge1xuLy8gICAgICAgICAgICBieFNsaWRlcnMgPSBydW5TbGlkZXJzKCAkKCcuYnhTbGlkZXJzJykubm90KCcub25seS1tb2JpbGUsIC5vbmx5LXBjJykgKTtcbi8vICAgICAgICB9XG4vL1xuLy8gICAgICAgIGlmKCQoJy5ieFNsaWRlcnMub25seS1tb2JpbGUnKS5sZW5ndGgpXG4vLyAgICAgICAgICAgIGJ4U2xpZGVyc01vYmlsZSA9IHJ1blNsaWRlcnMoICQoJy5ieFNsaWRlcnMub25seS1tb2JpbGUnKSApOyAvLyA6dmlzaWJsZVxuICAgICAgICBcbiAgICAgICAgaWYoIWJ4U2xpZGVyc1BDICYmICQoJy5ieFNsaWRlcnMub25seS1wYycpLmxlbmd0aClcbiAgICAgICAgICAgIGJ4U2xpZGVyc1BDID0gcnVuU2xpZGVycyggJCgnLmJ4U2xpZGVycy5vbmx5LXBjJykgKTsgLy8gOnZpc2libGVcblxuICAgICAgICAkKHdpbmRvdykub24oJ2xvYWQgcmVzaXplJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICBcbiAgICAgICAgICAgIGlmKCQodGhpcykud2lkdGgoKSA8IDk5Mikge1xuXG4gICAgICAgICAgICAgICAgaWYoIWJ4U2xpZGVyc01vYmlsZSAmJiAhJCgnLmJ4U2xpZGVyTW9iaWxlJykuZmluZCgnLnNsaWRlJykubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIHNsaWRlck1vYmlsZUluaXQob2JqU2xpZGVyTW9iaWxlLCAkKCcuYnhTbGlkZXJzLm9ubHktcGMnKSk7XG4gICAgICAgICAgICAgICAgICAgIGJ4U2xpZGVyc01vYmlsZSA9IHJ1blNsaWRlcnMoICQoJy5ieFNsaWRlck1vYmlsZScpICk7XG4gICAgICAgICAgICAgICAgfVxuXG4vLyAgICAgICAgICAgICAgICBpZihieFNsaWRlcnNNb2JpbGUgJiYgJCgnLmJ4U2xpZGVycy5vbmx5LW1vYmlsZScpLmxlbmd0aCkgLy8gLmlzKCc6dmlzaWJsZScpXG4vLyAgICAgICAgICAgICAgICAgICBieFNsaWRlcnNNb2JpbGUucmVsb2FkU2xpZGVyKCk7XG5cbi8vICAgICAgICAgICAgICAgIGlmKGJ4U2xpZGVyc1BDICYmICQoJy5ieFNsaWRlcnMub25seS1wYycpLmxlbmd0aCkgLy8gLm5vdCgnOnZpc2libGUnKVxuLy8gICAgICAgICAgICAgICAgICAgYnhTbGlkZXJzUEMuZGVzdHJveVNsaWRlcigpO1xuXG4gICAgICAgICAgICAgICAgaWYoYnhTbGlkZXJzUEMpIHtcbiAgICAgICAgICAgICAgICAgICBieFNsaWRlcnNQQy5kZXN0cm95U2xpZGVyKCk7XG4gICAgICAgICAgICAgICAgICAgYnhTbGlkZXJzUEMgPSBmYWxzZTtcbiAgICAgICAgICAgICAgIH0gICBcblxuICAgICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgICAgICBpZihieFNsaWRlcnNNb2JpbGUgJiYgJCgnLmJ4U2xpZGVyTW9iaWxlJykubGVuZ3RoICYmICQoJy5ieFNsaWRlck1vYmlsZScpLmZpbmQoJy5zbGlkZScpLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgYnhTbGlkZXJzTW9iaWxlLmRlc3Ryb3lTbGlkZXIoKTtcbiAgICAgICAgICAgICAgICAgICAgIGNsZWFyU2xpZGVyTW9iaWxlKCBvYmpTbGlkZXJNb2JpbGUgKTtcbiAgICAgICAgICAgICAgICAgICAgIGJ4U2xpZGVyc01vYmlsZSA9IGZhbHNlXG4gICAgICAgICAgICAgICAgIH0gICAgXG4gICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICBcblxuLy8gICAgICAgICAgICAgICBpZihieFNsaWRlcnNNb2JpbGUgJiYgJCgnLmJ4U2xpZGVycy5vbmx5LW1vYmlsZScpLmxlbmd0aCkgLy8ubm90KCc6dmlzaWJsZScpIFxuLy8gICAgICAgICAgICAgICAgICAgYnhTbGlkZXJzTW9iaWxlLmRlc3Ryb3lTbGlkZXIoKTtcblxuLy8gICAgICAgICAgICAgICAgaWYoYnhTbGlkZXJzUEMgJiYgJCgnLmJ4U2xpZGVycy5vbmx5LXBjJykubGVuZ3RoKSAvLyAuaXMoJzp2aXNpYmxlJylcbi8vICAgICAgICAgICAgICAgICAgIGJ4U2xpZGVyc1BDLnJlbG9hZFNsaWRlcigpO1xuXG4gICAgICAgICAgICAgICAgaWYoIWJ4U2xpZGVyc1BDKSB7XG4gICAgICAgICAgICAgICAgICAgYnhTbGlkZXJzUEMgPSBydW5TbGlkZXJzKCAkKCcuYnhTbGlkZXJzLm9ubHktcGMnKSApO1xuICAgICAgICAgICAgICAgfSAgIFxuXG4gICAgICAgICAgIH0gICBcbiAgICAgICAgfSk7XG4gICAgXG4gICAgfVxuICAgIFxuICAgIGlmKCQoJy5zbGlkZXItaXBhZCcpLmxlbmd0aCkge1xuICAgICAgICAkKCcuc2xpZGVyLWlwYWQnKS5ieFNsaWRlcih7XG4gICAgICAgICAgICBzbGlkZVdpZHRoOiAzODUsXG4gICAgICAgICAgICBtaW5TbGlkZXM6IDEsXG4gICAgICAgICAgICBjb250cm9sczogdHJ1ZSxcbiAgICAgICAgICAgIC8vIG1vdmVTbGlkZXM6IDEsXG4gICAgICAgICAgICAvLyBzdGFydFNsaWRlOiAyLFxuICAgICAgICAgICAgLy8gbWF4U2xpZGVzOiAxMCxcbiAgICAgICAgICAgIC8vIHNsaWRlTWFyZ2luOiAxMFxuICAgICAgICAgICAgbmV4dFNlbGVjdG9yOiAnI3NsaWRlci1uZXh0JyxcbiAgICAgICAgICAgIHByZXZTZWxlY3RvcjogJyNzbGlkZXItcHJldicsXG4gICAgICAgICAgICBuZXh0VGV4dDogJycsXG4gICAgICAgICAgICBwcmV2VGV4dDogJycsXG4gICAgICAgICAgICBcbi8vICAgICAgICAgICAgYnVpbGRQYWdlcjogbnVsbCxcbi8vICAgICAgICAgICAgcGFnZXJDdXN0b206IHRydWUsXG4gICAgICAgIH0pOyBcbiAgICB9XG59KTtcblxuZnVuY3Rpb24gc2xpZGVyTW9iaWxlSW5pdCggb2JqLCBnZXRFbGVtdHMgKSB7XG4gICAgdmFyIF9odG1sID0gJycsICRyZXMgPSBuZXcgQXJyYXk7XG4gICAgaWYoaXNzZXQob2JqKSAmJiBpc3NldChnZXRFbGVtdHMpKSB7XG4gICAgICAgIGdldEVsZW10cy5maW5kKCcuc2xpZGUnKS5lYWNoKGZ1bmN0aW9uKGssIHZhbCkge1xuICAgICAgICAgICAgdmFyIF9pdGVtID0gJCh2YWwpLmZpbmQoJy5ieEl0ZW0nKTtcbiAgICAgICAgICAgIGlmKGlzc2V0KF9pdGVtKSkge1xuICAgICAgICAgICAgICAgIF9pdGVtLmVhY2goZnVuY3Rpb24oaWssIGl2YWwpIHtcbiAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgJHJlcy5wdXNoKHtcbiAgICAgICAgICAgICAgICAgICAgICAgJ3NyYyc6ICQoaXZhbCkuZmluZCgnLnRlc3RpbW9uaWFsLXBob3RvJykuYXR0cignc3JjJyksXG4gICAgICAgICAgICAgICAgICAgICAgICd0ZXh0JzogJChpdmFsKS5maW5kKCcudGVzdGltb25pYWwtdGV4dCcpLmh0bWwoKVxuICAgICAgICAgICAgICAgICAgICB9KTsgXG4gICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgXG4gICAgaWYoJHJlcy5sZW5ndGggPiAwKSB7XG4gICAgICAgICQuZWFjaCgkcmVzLCBmdW5jdGlvbihrZXksIGl0ZW0pIHtcbiAgICAgICAgICAgIGlmKGl0ZW0uc3JjICYmIGl0ZW0udGV4dCkge1xuICAgICAgICAgICAgICAgIHZhciBfaEl0ZW0gPSAnJztcbiAgICAgICAgICAgICAgICBfaEl0ZW0gKz0gbW9iaWxlX3NsaWRlci5yZXBsYWNlKCd7aW1nX3NyY30nLCBpdGVtLnNyYyk7XG4gICAgICAgICAgICAgICAgX2h0bWwgKz0gX2hJdGVtLnJlcGxhY2UoJ3t0ZXh0fScsIGl0ZW0udGV4dCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBvYmouaHRtbCggX2h0bWwgKTtcbiAgICB9XG4gICAgXG59XG5cbmZ1bmN0aW9uIGNsZWFyU2xpZGVyTW9iaWxlKG9iaikge1xuICAgIGlmKGlzc2V0KG9iaikpIG9iai5lbXB0eSgpOyBcbn1cblxuZnVuY3Rpb24gcnVuU2xpZGVycyggb2JqICkge1xuICAgIHJldHVybiBvYmouYnhTbGlkZXIoe1xuICAgICAgICBzbGlkZVdpZHRoOiAxMTcwLFxuICAgICAgICBtaW5TbGlkZXM6IDEsXG4gICAgICAgIGNvbnRyb2xzOiBmYWxzZSxcbiAgICAgICAgXG4gICAgICAgIGluZmluaXRlTG9vcDogZmFsc2UsXG4gICAgICAgIHJlc3BvbnNpdmU6IHRydWUsXG4gICAgICAgIFxuICAgICAgICB3cmFwcGVyQ2xhc3M6ICdieC13cmFwcGVyLXRlc3RpbW9uaWFscycsXG4gICAgICAgIG9uU2xpZGVyTG9hZDogZnVuY3Rpb24oKXtcbiAgICAgICAgICAgIC8vIGFsZXJ0KCAkKCcuYngtY29udHJvbHMgLmJ4LXBhZ2VyID4gLmJ4LXBhZ2VyLWl0ZW0nKS5sZW5ndGggKTtcbiAgICAgICAgICAgIGlmKCQoJy5ieC1jb250cm9scyA+IC5ieC1wYWdlciA+IC5ieC1wYWdlci1pdGVtJykubGVuZ3RoIDwgMikgJCgnLmJ4LWNvbnRyb2xzID4gLmJ4LXBhZ2VyID4gLmJ4LXBhZ2VyLWl0ZW0nKS5oaWRlKCk7IFxuICAgICAgICB9LFxuICAgICAgICBvblNsaWRlQmVmb3JlOiBmdW5jdGlvbigpIHtcblxuICAgICAgICB9LFxuICAgICAgICBvblNsaWRlQWZ0ZXI6IGZ1bmN0aW9uKCl7XG5cbiAgICAgICAgfSxcbiAgICB9KTsgXG4gICBcbn0iLCIvKioqXG4gKiBCeFNsaWRlciB2NC4yLjMgLSBGdWxseSBsb2FkZWQsIHJlc3BvbnNpdmUgY29udGVudCBzbGlkZXJcbiAqIGh0dHA6Ly9ieHNsaWRlci5jb21cbiAqXG4gKiBDb3B5cmlnaHQgMjAxNCwgU3RldmVuIFdhbmRlcnNraSAtIGh0dHA6Ly9zdGV2ZW53YW5kZXJza2kuY29tIC0gaHR0cDovL2J4Y3JlYXRpdmUuY29tXG4gKiBXcml0dGVuIHdoaWxlIGRyaW5raW5nIEJlbGdpYW4gYWxlcyBhbmQgbGlzdGVuaW5nIHRvIGphenpcbiAqXG4gKiBSZWxlYXNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgLSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUXG4gKioqL1xuXG47KGZ1bmN0aW9uKCQpe1xuXG5cdHZhciBkZWZhdWx0cyA9IHtcblxuXHRcdC8vIEdFTkVSQUxcblx0XHRtb2RlOiAnaG9yaXpvbnRhbCcsXG5cdFx0c2xpZGVTZWxlY3RvcjogJycsXG5cdFx0aW5maW5pdGVMb29wOiB0cnVlLFxuXHRcdGhpZGVDb250cm9sT25FbmQ6IGZhbHNlLFxuXHRcdHNwZWVkOiA1MDAsXG5cdFx0ZWFzaW5nOiBudWxsLFxuXHRcdHNsaWRlTWFyZ2luOiAwLFxuXHRcdHN0YXJ0U2xpZGU6IDAsXG5cdFx0cmFuZG9tU3RhcnQ6IGZhbHNlLFxuXHRcdGNhcHRpb25zOiBmYWxzZSxcblx0XHR0aWNrZXI6IGZhbHNlLFxuXHRcdHRpY2tlckhvdmVyOiBmYWxzZSxcblx0XHRhZGFwdGl2ZUhlaWdodDogZmFsc2UsXG5cdFx0YWRhcHRpdmVIZWlnaHRTcGVlZDogNTAwLFxuXHRcdHZpZGVvOiBmYWxzZSxcblx0XHR1c2VDU1M6IHRydWUsXG5cdFx0cHJlbG9hZEltYWdlczogJ3Zpc2libGUnLFxuXHRcdHJlc3BvbnNpdmU6IHRydWUsXG5cdFx0c2xpZGVaSW5kZXg6IDUwLFxuXHRcdHdyYXBwZXJDbGFzczogJ2J4LXdyYXBwZXInLFxuXG5cdFx0Ly8gVE9VQ0hcblx0XHR0b3VjaEVuYWJsZWQ6IHRydWUsXG5cdFx0c3dpcGVUaHJlc2hvbGQ6IDUwLFxuXHRcdG9uZVRvT25lVG91Y2g6IHRydWUsXG5cdFx0cHJldmVudERlZmF1bHRTd2lwZVg6IHRydWUsXG5cdFx0cHJldmVudERlZmF1bHRTd2lwZVk6IGZhbHNlLFxuXG5cdFx0Ly8gS0VZQk9BUkRcblx0XHRrZXlib2FyZEVuYWJsZWQ6IGZhbHNlLFxuXG5cdFx0Ly8gUEFHRVJcblx0XHRwYWdlcjogdHJ1ZSxcblx0XHRwYWdlclR5cGU6ICdmdWxsJyxcblx0XHRwYWdlclNob3J0U2VwYXJhdG9yOiAnIC8gJyxcblx0XHRwYWdlclNlbGVjdG9yOiBudWxsLFxuXHRcdGJ1aWxkUGFnZXI6IG51bGwsXG5cdFx0cGFnZXJDdXN0b206IG51bGwsXG5cblx0XHQvLyBDT05UUk9MU1xuXHRcdGNvbnRyb2xzOiB0cnVlLFxuXHRcdG5leHRUZXh0OiAnTmV4dCcsXG5cdFx0cHJldlRleHQ6ICdQcmV2Jyxcblx0XHRuZXh0U2VsZWN0b3I6IG51bGwsXG5cdFx0cHJldlNlbGVjdG9yOiBudWxsLFxuXHRcdGF1dG9Db250cm9sczogZmFsc2UsXG5cdFx0c3RhcnRUZXh0OiAnU3RhcnQnLFxuXHRcdHN0b3BUZXh0OiAnU3RvcCcsXG5cdFx0YXV0b0NvbnRyb2xzQ29tYmluZTogZmFsc2UsXG5cdFx0YXV0b0NvbnRyb2xzU2VsZWN0b3I6IG51bGwsXG5cblx0XHQvLyBBVVRPXG5cdFx0YXV0bzogZmFsc2UsXG5cdFx0cGF1c2U6IDQwMDAsXG5cdFx0YXV0b1N0YXJ0OiB0cnVlLFxuXHRcdGF1dG9EaXJlY3Rpb246ICduZXh0Jyxcblx0XHRhdXRvSG92ZXI6IGZhbHNlLFxuXHRcdGF1dG9EZWxheTogMCxcblx0XHRhdXRvU2xpZGVGb3JPbmVQYWdlOiBmYWxzZSxcblxuXHRcdC8vIENBUk9VU0VMXG5cdFx0bWluU2xpZGVzOiAxLFxuXHRcdG1heFNsaWRlczogMSxcblx0XHRtb3ZlU2xpZGVzOiAwLFxuXHRcdHNsaWRlV2lkdGg6IDAsXG5cblx0XHQvLyBDQUxMQkFDS1Ncblx0XHRvblNsaWRlckxvYWQ6IGZ1bmN0aW9uKCl7IHJldHVybiB0cnVlIH0sXG5cdFx0b25TbGlkZUJlZm9yZTogZnVuY3Rpb24oKXsgcmV0dXJuIHRydWUgfSxcblx0XHRvblNsaWRlQWZ0ZXI6IGZ1bmN0aW9uKCl7IHJldHVybiB0cnVlIH0sXG5cdFx0b25TbGlkZU5leHQ6IGZ1bmN0aW9uKCl7IHJldHVybiB0cnVlIH0sXG5cdFx0b25TbGlkZVByZXY6IGZ1bmN0aW9uKCl7IHJldHVybiB0cnVlIH0sXG5cdFx0b25TbGlkZXJSZXNpemU6IGZ1bmN0aW9uKCl7IHJldHVybiB0cnVlIH1cblx0fTtcblxuXHQkLmZuLmJ4U2xpZGVyID0gZnVuY3Rpb24ob3B0aW9ucyl7XG5cblx0XHRpZih0aGlzLmxlbmd0aCA9PT0gMCl7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9IFxuXG5cdFx0Ly8gc3VwcG9ydCBtdWx0aXBsZSBlbGVtZW50c1xuXHRcdGlmKHRoaXMubGVuZ3RoID4gMSl7XG5cdFx0XHR0aGlzLmVhY2goZnVuY3Rpb24oKXtcblx0XHRcdFx0JCh0aGlzKS5ieFNsaWRlcihvcHRpb25zKTtcblx0XHRcdH0pO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXG5cdFx0Ly8gY3JlYXRlIGEgbmFtZXNwYWNlIHRvIGJlIHVzZWQgdGhyb3VnaG91dCB0aGUgcGx1Z2luXG5cdFx0dmFyIHNsaWRlciA9IHt9O1xuXHRcdC8vIHNldCBhIHJlZmVyZW5jZSB0byBvdXIgc2xpZGVyIGVsZW1lbnRcblx0XHR2YXIgZWwgPSB0aGlzO1xuXG5cdFx0LyoqXG5cdFx0ICogTWFrZXMgc2xpZGVzaG93IHJlc3BvbnNpdmVcblx0XHQgKi9cblx0XHQvLyBmaXJzdCBnZXQgdGhlIG9yaWdpbmFsIHdpbmRvdyBkaW1lbnMgKHRoYW5rcyBhIGxvdCBJRSlcblx0XHR2YXIgd2luZG93V2lkdGggPSAkKHdpbmRvdykud2lkdGgoKTtcblx0XHR2YXIgd2luZG93SGVpZ2h0ID0gJCh3aW5kb3cpLmhlaWdodCgpO1xuXG5cblxuXHRcdC8qKlxuXHRcdCAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cdFx0ICogPSBQUklWQVRFIEZVTkNUSU9OU1xuXHRcdCAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cdFx0ICovXG5cblx0XHQvKipcblx0XHQgKiBJbml0aWFsaXplcyBuYW1lc3BhY2Ugc2V0dGluZ3MgdG8gYmUgdXNlZCB0aHJvdWdob3V0IHBsdWdpblxuXHRcdCAqL1xuXHRcdHZhciBpbml0ID0gZnVuY3Rpb24oKXtcblx0XHRcdC8vIG1lcmdlIHVzZXItc3VwcGxpZWQgb3B0aW9ucyB3aXRoIHRoZSBkZWZhdWx0c1xuXHRcdFx0c2xpZGVyLnNldHRpbmdzID0gJC5leHRlbmQoe30sIGRlZmF1bHRzLCBvcHRpb25zKTtcblx0XHRcdC8vIHBhcnNlIHNsaWRlV2lkdGggc2V0dGluZ1xuXHRcdFx0c2xpZGVyLnNldHRpbmdzLnNsaWRlV2lkdGggPSBwYXJzZUludChzbGlkZXIuc2V0dGluZ3Muc2xpZGVXaWR0aCk7XG5cdFx0XHQvLyBzdG9yZSB0aGUgb3JpZ2luYWwgY2hpbGRyZW5cblx0XHRcdHNsaWRlci5jaGlsZHJlbiA9IGVsLmNoaWxkcmVuKHNsaWRlci5zZXR0aW5ncy5zbGlkZVNlbGVjdG9yKTtcblx0XHRcdC8vIGNoZWNrIGlmIGFjdHVhbCBudW1iZXIgb2Ygc2xpZGVzIGlzIGxlc3MgdGhhbiBtaW5TbGlkZXMgLyBtYXhTbGlkZXNcblx0XHRcdGlmKHNsaWRlci5jaGlsZHJlbi5sZW5ndGggPCBzbGlkZXIuc2V0dGluZ3MubWluU2xpZGVzKXsgc2xpZGVyLnNldHRpbmdzLm1pblNsaWRlcyA9IHNsaWRlci5jaGlsZHJlbi5sZW5ndGg7IH0gXG5cdFx0XHRpZihzbGlkZXIuY2hpbGRyZW4ubGVuZ3RoIDwgc2xpZGVyLnNldHRpbmdzLm1heFNsaWRlcyl7IHNsaWRlci5zZXR0aW5ncy5tYXhTbGlkZXMgPSBzbGlkZXIuY2hpbGRyZW4ubGVuZ3RoOyB9XG5cdFx0XHQvLyBpZiByYW5kb20gc3RhcnQsIHNldCB0aGUgc3RhcnRTbGlkZSBzZXR0aW5nIHRvIHJhbmRvbSBudW1iZXJcblx0XHRcdGlmKHNsaWRlci5zZXR0aW5ncy5yYW5kb21TdGFydCl7IHNsaWRlci5zZXR0aW5ncy5zdGFydFNsaWRlID0gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogc2xpZGVyLmNoaWxkcmVuLmxlbmd0aCk7IH1cblx0XHRcdC8vIHN0b3JlIGFjdGl2ZSBzbGlkZSBpbmZvcm1hdGlvblxuXHRcdFx0c2xpZGVyLmFjdGl2ZSA9IHsgaW5kZXg6IHNsaWRlci5zZXR0aW5ncy5zdGFydFNsaWRlIH07XG5cdFx0XHQvLyBzdG9yZSBpZiB0aGUgc2xpZGVyIGlzIGluIGNhcm91c2VsIG1vZGUgKGRpc3BsYXlpbmcgLyBtb3ZpbmcgbXVsdGlwbGUgc2xpZGVzKVxuXHRcdFx0c2xpZGVyLmNhcm91c2VsID0gc2xpZGVyLnNldHRpbmdzLm1pblNsaWRlcyA+IDEgfHwgc2xpZGVyLnNldHRpbmdzLm1heFNsaWRlcyA+IDEgPyB0cnVlIDogZmFsc2U7XG5cdFx0XHQvLyBpZiBjYXJvdXNlbCwgZm9yY2UgcHJlbG9hZEltYWdlcyA9ICdhbGwnXG5cdFx0XHRpZihzbGlkZXIuY2Fyb3VzZWwpeyBzbGlkZXIuc2V0dGluZ3MucHJlbG9hZEltYWdlcyA9ICdhbGwnOyB9XG5cdFx0XHQvLyBjYWxjdWxhdGUgdGhlIG1pbiAvIG1heCB3aWR0aCB0aHJlc2hvbGRzIGJhc2VkIG9uIG1pbiAvIG1heCBudW1iZXIgb2Ygc2xpZGVzXG5cdFx0XHQvLyB1c2VkIHRvIHNldHVwIGFuZCB1cGRhdGUgY2Fyb3VzZWwgc2xpZGVzIGRpbWVuc2lvbnNcblx0XHRcdHNsaWRlci5taW5UaHJlc2hvbGQgPSAoc2xpZGVyLnNldHRpbmdzLm1pblNsaWRlcyAqIHNsaWRlci5zZXR0aW5ncy5zbGlkZVdpZHRoKSArICgoc2xpZGVyLnNldHRpbmdzLm1pblNsaWRlcyAtIDEpICogc2xpZGVyLnNldHRpbmdzLnNsaWRlTWFyZ2luKTtcblx0XHRcdHNsaWRlci5tYXhUaHJlc2hvbGQgPSAoc2xpZGVyLnNldHRpbmdzLm1heFNsaWRlcyAqIHNsaWRlci5zZXR0aW5ncy5zbGlkZVdpZHRoKSArICgoc2xpZGVyLnNldHRpbmdzLm1heFNsaWRlcyAtIDEpICogc2xpZGVyLnNldHRpbmdzLnNsaWRlTWFyZ2luKTtcblx0XHRcdC8vIHN0b3JlIHRoZSBjdXJyZW50IHN0YXRlIG9mIHRoZSBzbGlkZXIgKGlmIGN1cnJlbnRseSBhbmltYXRpbmcsIHdvcmtpbmcgaXMgdHJ1ZSlcblx0XHRcdHNsaWRlci53b3JraW5nID0gZmFsc2U7XG5cdFx0XHQvLyBpbml0aWFsaXplIHRoZSBjb250cm9scyBvYmplY3Rcblx0XHRcdHNsaWRlci5jb250cm9scyA9IHt9O1xuXHRcdFx0Ly8gaW5pdGlhbGl6ZSBhbiBhdXRvIGludGVydmFsXG5cdFx0XHRzbGlkZXIuaW50ZXJ2YWwgPSBudWxsO1xuXHRcdFx0Ly8gZGV0ZXJtaW5lIHdoaWNoIHByb3BlcnR5IHRvIHVzZSBmb3IgdHJhbnNpdGlvbnNcblx0XHRcdHNsaWRlci5hbmltUHJvcCA9IHNsaWRlci5zZXR0aW5ncy5tb2RlID09PSAndmVydGljYWwnID8gJ3RvcCcgOiAnbGVmdCc7XG5cdFx0XHQvLyBkZXRlcm1pbmUgaWYgaGFyZHdhcmUgYWNjZWxlcmF0aW9uIGNhbiBiZSB1c2VkXG5cdFx0XHRzbGlkZXIudXNpbmdDU1MgPSBzbGlkZXIuc2V0dGluZ3MudXNlQ1NTICYmIHNsaWRlci5zZXR0aW5ncy5tb2RlICE9PSAnZmFkZScgJiYgKGZ1bmN0aW9uKCl7XG5cdFx0XHRcdC8vIGNyZWF0ZSBvdXIgdGVzdCBkaXYgZWxlbWVudFxuXHRcdFx0XHR2YXIgZGl2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG5cdFx0XHRcdC8vIGNzcyB0cmFuc2l0aW9uIHByb3BlcnRpZXNcblx0XHRcdFx0dmFyIHByb3BzID0gWydXZWJraXRQZXJzcGVjdGl2ZScsICdNb3pQZXJzcGVjdGl2ZScsICdPUGVyc3BlY3RpdmUnLCAnbXNQZXJzcGVjdGl2ZSddO1xuXHRcdFx0XHQvLyB0ZXN0IGZvciBlYWNoIHByb3BlcnR5XG5cdFx0XHRcdGZvcih2YXIgaSBpbiBwcm9wcyl7XG5cdFx0XHRcdFx0aWYoZGl2LnN0eWxlW3Byb3BzW2ldXSAhPT0gdW5kZWZpbmVkKXtcblx0XHRcdFx0XHRcdHNsaWRlci5jc3NQcmVmaXggPSBwcm9wc1tpXS5yZXBsYWNlKCdQZXJzcGVjdGl2ZScsICcnKS50b0xvd2VyQ2FzZSgpO1xuXHRcdFx0XHRcdFx0c2xpZGVyLmFuaW1Qcm9wID0gJy0nICsgc2xpZGVyLmNzc1ByZWZpeCArICctdHJhbnNmb3JtJztcblx0XHRcdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gZmFsc2U7XG5cdFx0XHR9KCkpO1xuXHRcdFx0Ly8gaWYgdmVydGljYWwgbW9kZSBhbHdheXMgbWFrZSBtYXhTbGlkZXMgYW5kIG1pblNsaWRlcyBlcXVhbFxuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLm1vZGUgPT09ICd2ZXJ0aWNhbCcpeyBzbGlkZXIuc2V0dGluZ3MubWF4U2xpZGVzID0gc2xpZGVyLnNldHRpbmdzLm1pblNsaWRlczsgfVxuXHRcdFx0Ly8gc2F2ZSBvcmlnaW5hbCBzdHlsZSBkYXRhXG5cdFx0XHRlbC5kYXRhKFwib3JpZ1N0eWxlXCIsIGVsLmF0dHIoXCJzdHlsZVwiKSk7XG5cdFx0XHRlbC5jaGlsZHJlbihzbGlkZXIuc2V0dGluZ3Muc2xpZGVTZWxlY3RvcikuZWFjaChmdW5jdGlvbigpe1xuXHRcdFx0ICAkKHRoaXMpLmRhdGEoXCJvcmlnU3R5bGVcIiwgJCh0aGlzKS5hdHRyKFwic3R5bGVcIikpO1xuXHRcdFx0fSk7XG5cdFx0XHQvLyBwZXJmb3JtIGFsbCBET00gLyBDU1MgbW9kaWZpY2F0aW9uc1xuXHRcdFx0c2V0dXAoKTtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogUGVyZm9ybXMgYWxsIERPTSBhbmQgQ1NTIG1vZGlmaWNhdGlvbnNcblx0XHQgKi9cblx0XHR2YXIgc2V0dXAgPSBmdW5jdGlvbigpe1xuXHRcdFx0Ly8gd3JhcCBlbCBpbiBhIHdyYXBwZXJcblx0XHRcdGVsLndyYXAoJzxkaXYgY2xhc3M9XCInICsgc2xpZGVyLnNldHRpbmdzLndyYXBwZXJDbGFzcyArICdcIj48ZGl2IGNsYXNzPVwiYngtdmlld3BvcnRcIj48L2Rpdj48L2Rpdj4nKTtcblx0XHRcdC8vIHN0b3JlIGEgbmFtZXNwYWNlIHJlZmVyZW5jZSB0byAuYngtdmlld3BvcnRcblx0XHRcdHNsaWRlci52aWV3cG9ydCA9IGVsLnBhcmVudCgpO1xuXHRcdFx0Ly8gYWRkIGEgbG9hZGluZyBkaXYgdG8gZGlzcGxheSB3aGlsZSBpbWFnZXMgYXJlIGxvYWRpbmdcblx0XHRcdHNsaWRlci5sb2FkZXIgPSAkKCc8ZGl2IGNsYXNzPVwiYngtbG9hZGluZ1wiIC8+Jyk7XG5cdFx0XHRzbGlkZXIudmlld3BvcnQucHJlcGVuZChzbGlkZXIubG9hZGVyKTtcblx0XHRcdC8vIHNldCBlbCB0byBhIG1hc3NpdmUgd2lkdGgsIHRvIGhvbGQgYW55IG5lZWRlZCBzbGlkZXNcblx0XHRcdC8vIGFsc28gc3RyaXAgYW55IG1hcmdpbiBhbmQgcGFkZGluZyBmcm9tIGVsXG5cdFx0XHRlbC5jc3Moe1xuXHRcdFx0XHR3aWR0aDogc2xpZGVyLnNldHRpbmdzLm1vZGUgPT09ICdob3Jpem9udGFsJyA/IChzbGlkZXIuY2hpbGRyZW4ubGVuZ3RoICogMTAwMCArIDIxNSkgKyAnJScgOiAnYXV0bycsXG5cdFx0XHRcdHBvc2l0aW9uOiAnYWJzb2x1dGUnXG5cdFx0XHR9KTtcblx0XHRcdC8vIGlmIHVzaW5nIENTUywgYWRkIHRoZSBlYXNpbmcgcHJvcGVydHlcblx0XHRcdGlmKHNsaWRlci51c2luZ0NTUyAmJiBzbGlkZXIuc2V0dGluZ3MuZWFzaW5nKXtcblx0XHRcdFx0ZWwuY3NzKCctJyArIHNsaWRlci5jc3NQcmVmaXggKyAnLXRyYW5zaXRpb24tdGltaW5nLWZ1bmN0aW9uJywgc2xpZGVyLnNldHRpbmdzLmVhc2luZyk7XG5cdFx0XHQvLyBpZiBub3QgdXNpbmcgQ1NTIGFuZCBubyBlYXNpbmcgdmFsdWUgd2FzIHN1cHBsaWVkLCB1c2UgdGhlIGRlZmF1bHQgSlMgYW5pbWF0aW9uIGVhc2luZyAoc3dpbmcpXG5cdFx0XHR9ZWxzZSBpZighc2xpZGVyLnNldHRpbmdzLmVhc2luZyl7XG5cdFx0XHRcdHNsaWRlci5zZXR0aW5ncy5lYXNpbmcgPSAnc3dpbmcnO1xuXHRcdFx0fVxuXHRcdFx0dmFyIHNsaWRlc1Nob3dpbmcgPSBnZXROdW1iZXJTbGlkZXNTaG93aW5nKCk7XG5cdFx0XHQvLyBtYWtlIG1vZGlmaWNhdGlvbnMgdG8gdGhlIHZpZXdwb3J0ICguYngtdmlld3BvcnQpXG5cdFx0XHRzbGlkZXIudmlld3BvcnQuY3NzKHtcblx0XHRcdFx0d2lkdGg6ICcxMDAlJyxcblx0XHRcdFx0b3ZlcmZsb3c6ICdoaWRkZW4nLFxuXHRcdFx0XHRwb3NpdGlvbjogJ3JlbGF0aXZlJ1xuXHRcdFx0fSk7XG5cdFx0XHRzbGlkZXIudmlld3BvcnQucGFyZW50KCkuY3NzKHtcblx0XHRcdFx0bWF4V2lkdGg6IGdldFZpZXdwb3J0TWF4V2lkdGgoKVxuXHRcdFx0fSk7XG5cdFx0XHQvLyBtYWtlIG1vZGlmaWNhdGlvbiB0byB0aGUgd3JhcHBlciAoLmJ4LXdyYXBwZXIpXG5cdFx0XHRpZighc2xpZGVyLnNldHRpbmdzLnBhZ2VyICYmICFzbGlkZXIuc2V0dGluZ3MuY29udHJvbHMpe1xuXHRcdFx0XHRzbGlkZXIudmlld3BvcnQucGFyZW50KCkuY3NzKHtcblx0XHRcdFx0XHRtYXJnaW46ICcwIGF1dG8gMHB4J1xuXHRcdFx0XHR9KTtcblx0XHRcdH1cblx0XHRcdC8vIGFwcGx5IGNzcyB0byBhbGwgc2xpZGVyIGNoaWxkcmVuXG5cdFx0XHRzbGlkZXIuY2hpbGRyZW4uY3NzKHtcblx0XHRcdFx0J2Zsb2F0Jzogc2xpZGVyLnNldHRpbmdzLm1vZGUgPT09ICdob3Jpem9udGFsJyA/ICdsZWZ0JyA6ICdub25lJyxcblx0XHRcdFx0bGlzdFN0eWxlOiAnbm9uZScsXG5cdFx0XHRcdHBvc2l0aW9uOiAncmVsYXRpdmUnXG5cdFx0XHR9KTtcblx0XHRcdC8vIGFwcGx5IHRoZSBjYWxjdWxhdGVkIHdpZHRoIGFmdGVyIHRoZSBmbG9hdCBpcyBhcHBsaWVkIHRvIHByZXZlbnQgc2Nyb2xsYmFyIGludGVyZmVyZW5jZVxuXHRcdFx0c2xpZGVyLmNoaWxkcmVuLmNzcygnd2lkdGgnLCBnZXRTbGlkZVdpZHRoKCkpO1xuXHRcdFx0Ly8gaWYgc2xpZGVNYXJnaW4gaXMgc3VwcGxpZWQsIGFkZCB0aGUgY3NzXG5cdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MubW9kZSA9PT0gJ2hvcml6b250YWwnICYmIHNsaWRlci5zZXR0aW5ncy5zbGlkZU1hcmdpbiA+IDApeyBzbGlkZXIuY2hpbGRyZW4uY3NzKCdtYXJnaW5SaWdodCcsIHNsaWRlci5zZXR0aW5ncy5zbGlkZU1hcmdpbik7IH1cblx0XHRcdGlmKHNsaWRlci5zZXR0aW5ncy5tb2RlID09PSAndmVydGljYWwnICYmIHNsaWRlci5zZXR0aW5ncy5zbGlkZU1hcmdpbiA+IDApeyBzbGlkZXIuY2hpbGRyZW4uY3NzKCdtYXJnaW5Cb3R0b20nLCBzbGlkZXIuc2V0dGluZ3Muc2xpZGVNYXJnaW4pOyB9XG5cdFx0XHQvLyBpZiBcImZhZGVcIiBtb2RlLCBhZGQgcG9zaXRpb25pbmcgYW5kIHotaW5kZXggQ1NTXG5cdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MubW9kZSA9PT0gJ2ZhZGUnKXtcblx0XHRcdFx0c2xpZGVyLmNoaWxkcmVuLmNzcyh7XG5cdFx0XHRcdFx0cG9zaXRpb246ICdhYnNvbHV0ZScsXG5cdFx0XHRcdFx0ekluZGV4OiAwLFxuXHRcdFx0XHRcdGRpc3BsYXk6ICdub25lJ1xuXHRcdFx0XHR9KTtcblx0XHRcdFx0Ly8gcHJlcGFyZSB0aGUgei1pbmRleCBvbiB0aGUgc2hvd2luZyBlbGVtZW50XG5cdFx0XHRcdHNsaWRlci5jaGlsZHJlbi5lcShzbGlkZXIuc2V0dGluZ3Muc3RhcnRTbGlkZSkuY3NzKHt6SW5kZXg6IHNsaWRlci5zZXR0aW5ncy5zbGlkZVpJbmRleCwgZGlzcGxheTogJ2Jsb2NrJ30pO1xuXHRcdFx0fVxuXHRcdFx0Ly8gY3JlYXRlIGFuIGVsZW1lbnQgdG8gY29udGFpbiBhbGwgc2xpZGVyIGNvbnRyb2xzIChwYWdlciwgc3RhcnQgLyBzdG9wLCBldGMpXG5cdFx0XHRzbGlkZXIuY29udHJvbHMuZWwgPSAkKCc8ZGl2IGNsYXNzPVwiYngtY29udHJvbHNcIiAvPicpO1xuXHRcdFx0Ly8gaWYgY2FwdGlvbnMgYXJlIHJlcXVlc3RlZCwgYWRkIHRoZW1cblx0XHRcdGlmKHNsaWRlci5zZXR0aW5ncy5jYXB0aW9ucyl7IGFwcGVuZENhcHRpb25zKCk7IH1cblx0XHRcdC8vIGNoZWNrIGlmIHN0YXJ0U2xpZGUgaXMgbGFzdCBzbGlkZVxuXHRcdFx0c2xpZGVyLmFjdGl2ZS5sYXN0ID0gc2xpZGVyLnNldHRpbmdzLnN0YXJ0U2xpZGUgPT09IGdldFBhZ2VyUXR5KCkgLSAxO1xuXHRcdFx0Ly8gaWYgdmlkZW8gaXMgdHJ1ZSwgc2V0IHVwIHRoZSBmaXRWaWRzIHBsdWdpblxuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLnZpZGVvKXsgZWwuZml0VmlkcygpOyB9XG5cdFx0XHQvLyBzZXQgdGhlIGRlZmF1bHQgcHJlbG9hZCBzZWxlY3RvciAodmlzaWJsZSlcblx0XHRcdHZhciBwcmVsb2FkU2VsZWN0b3IgPSBzbGlkZXIuY2hpbGRyZW4uZXEoc2xpZGVyLnNldHRpbmdzLnN0YXJ0U2xpZGUpO1xuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLnByZWxvYWRJbWFnZXMgPT09IFwiYWxsXCIgfHwgc2xpZGVyLnNldHRpbmdzLnRpY2tlcil7IHByZWxvYWRTZWxlY3RvciA9IHNsaWRlci5jaGlsZHJlbjsgfVxuXHRcdFx0Ly8gb25seSBjaGVjayBmb3IgY29udHJvbCBhZGRpdGlvbiBpZiBub3QgaW4gXCJ0aWNrZXJcIiBtb2RlXG5cdFx0XHRpZighc2xpZGVyLnNldHRpbmdzLnRpY2tlcil7XG5cdFx0XHRcdC8vIGlmIGNvbnRyb2xzIGFyZSByZXF1ZXN0ZWQsIGFkZCB0aGVtXG5cdFx0XHRcdGlmKHNsaWRlci5zZXR0aW5ncy5jb250cm9scyl7IGFwcGVuZENvbnRyb2xzKCk7IH1cblx0XHRcdFx0Ly8gaWYgYXV0byBpcyB0cnVlLCBhbmQgYXV0byBjb250cm9scyBhcmUgcmVxdWVzdGVkLCBhZGQgdGhlbVxuXHRcdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MuYXV0byAmJiBzbGlkZXIuc2V0dGluZ3MuYXV0b0NvbnRyb2xzKXsgYXBwZW5kQ29udHJvbHNBdXRvKCk7IH1cblx0XHRcdFx0Ly8gaWYgcGFnZXIgaXMgcmVxdWVzdGVkLCBhZGQgaXRcblx0XHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLnBhZ2VyKXsgYXBwZW5kUGFnZXIoKTsgfVxuXHRcdFx0XHQvLyBpZiBhbnkgY29udHJvbCBvcHRpb24gaXMgcmVxdWVzdGVkLCBhZGQgdGhlIGNvbnRyb2xzIHdyYXBwZXJcblx0XHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLmNvbnRyb2xzIHx8IHNsaWRlci5zZXR0aW5ncy5hdXRvQ29udHJvbHMgfHwgc2xpZGVyLnNldHRpbmdzLnBhZ2VyKXsgc2xpZGVyLnZpZXdwb3J0LmFmdGVyKHNsaWRlci5jb250cm9scy5lbCk7IH1cblx0XHRcdC8vIGlmIHRpY2tlciBtb2RlLCBkbyBub3QgYWxsb3cgYSBwYWdlclxuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0c2xpZGVyLnNldHRpbmdzLnBhZ2VyID0gZmFsc2U7XG5cdFx0XHR9XG5cdFx0XHRsb2FkRWxlbWVudHMocHJlbG9hZFNlbGVjdG9yLCBzdGFydCk7XG5cdFx0fTtcblxuXHRcdHZhciBsb2FkRWxlbWVudHMgPSBmdW5jdGlvbihzZWxlY3RvciwgY2FsbGJhY2spe1xuXHRcdFx0dmFyIHRvdGFsID0gc2VsZWN0b3IuZmluZCgnaW1nOm5vdChbc3JjPVwiXCJdKSwgaWZyYW1lJykubGVuZ3RoO1xuXHRcdFx0aWYodG90YWwgPT09IDApe1xuXHRcdFx0XHRjYWxsYmFjaygpO1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0XHR2YXIgY291bnQgPSAwO1xuXHRcdFx0c2VsZWN0b3IuZmluZCgnaW1nOm5vdChbc3JjPVwiXCJdKSwgaWZyYW1lJykuZWFjaChmdW5jdGlvbigpe1xuXHRcdFx0XHQkKHRoaXMpLm9uZSgnbG9hZCBlcnJvcicsIGZ1bmN0aW9uKCl7XG5cdFx0XHRcdCAgaWYoKytjb3VudCA9PT0gdG90YWwpeyBjYWxsYmFjaygpOyB9XG5cdFx0XHRcdH0pLmVhY2goZnVuY3Rpb24oKXtcblx0XHRcdFx0ICBpZih0aGlzLmNvbXBsZXRlKXsgJCh0aGlzKS5sb2FkKCk7IH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9KTtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogU3RhcnQgdGhlIHNsaWRlclxuXHRcdCAqL1xuXHRcdHZhciBzdGFydCA9IGZ1bmN0aW9uKCl7XG5cdFx0XHQvLyBpZiBpbmZpbml0ZSBsb29wLCBwcmVwYXJlIGFkZGl0aW9uYWwgc2xpZGVzXG5cdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MuaW5maW5pdGVMb29wICYmIHNsaWRlci5zZXR0aW5ncy5tb2RlICE9PSAnZmFkZScgJiYgIXNsaWRlci5zZXR0aW5ncy50aWNrZXIpe1xuXHRcdFx0XHR2YXIgc2xpY2UgPSBzbGlkZXIuc2V0dGluZ3MubW9kZSA9PT0gJ3ZlcnRpY2FsJyA/IHNsaWRlci5zZXR0aW5ncy5taW5TbGlkZXMgOiBzbGlkZXIuc2V0dGluZ3MubWF4U2xpZGVzO1xuXHRcdFx0XHR2YXIgc2xpY2VBcHBlbmQgPSBzbGlkZXIuY2hpbGRyZW4uc2xpY2UoMCwgc2xpY2UpLmNsb25lKHRydWUpLmFkZENsYXNzKCdieC1jbG9uZScpO1xuXHRcdFx0XHR2YXIgc2xpY2VQcmVwZW5kID0gc2xpZGVyLmNoaWxkcmVuLnNsaWNlKC1zbGljZSkuY2xvbmUodHJ1ZSkuYWRkQ2xhc3MoJ2J4LWNsb25lJyk7XG5cdFx0XHRcdGVsLmFwcGVuZChzbGljZUFwcGVuZCkucHJlcGVuZChzbGljZVByZXBlbmQpO1xuXHRcdFx0fVxuXHRcdFx0Ly8gcmVtb3ZlIHRoZSBsb2FkaW5nIERPTSBlbGVtZW50XG5cdFx0XHRzbGlkZXIubG9hZGVyLnJlbW92ZSgpO1xuXHRcdFx0Ly8gc2V0IHRoZSBsZWZ0IC8gdG9wIHBvc2l0aW9uIG9mIFwiZWxcIlxuXHRcdFx0c2V0U2xpZGVQb3NpdGlvbigpO1xuXHRcdFx0Ly8gaWYgXCJ2ZXJ0aWNhbFwiIG1vZGUsIGFsd2F5cyB1c2UgYWRhcHRpdmVIZWlnaHQgdG8gcHJldmVudCBvZGQgYmVoYXZpb3Jcblx0XHRcdGlmKHNsaWRlci5zZXR0aW5ncy5tb2RlID09PSAndmVydGljYWwnKXsgc2xpZGVyLnNldHRpbmdzLmFkYXB0aXZlSGVpZ2h0ID0gdHJ1ZTsgfVxuXHRcdFx0Ly8gc2V0IHRoZSB2aWV3cG9ydCBoZWlnaHRcblx0XHRcdHNsaWRlci52aWV3cG9ydC5oZWlnaHQoZ2V0Vmlld3BvcnRIZWlnaHQoKSk7XG5cdFx0XHQvLyBtYWtlIHN1cmUgZXZlcnl0aGluZyBpcyBwb3NpdGlvbmVkIGp1c3QgcmlnaHQgKHNhbWUgYXMgYSB3aW5kb3cgcmVzaXplKVxuXHRcdFx0ZWwucmVkcmF3U2xpZGVyKCk7XG5cdFx0XHQvLyBvblNsaWRlckxvYWQgY2FsbGJhY2tcblx0XHRcdHNsaWRlci5zZXR0aW5ncy5vblNsaWRlckxvYWQoc2xpZGVyLHNsaWRlci5hY3RpdmUuaW5kZXgpO1xuXHRcdFx0Ly8gc2xpZGVyIGhhcyBiZWVuIGZ1bGx5IGluaXRpYWxpemVkXG5cdFx0XHRzbGlkZXIuaW5pdGlhbGl6ZWQgPSB0cnVlO1xuXHRcdFx0Ly8gYmluZCB0aGUgcmVzaXplIGNhbGwgdG8gdGhlIHdpbmRvd1xuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLnJlc3BvbnNpdmUpeyAkKHdpbmRvdykuYmluZCgncmVzaXplJywgcmVzaXplV2luZG93KTsgfVxuXHRcdFx0Ly8gaWYgYXV0byBpcyB0cnVlIGFuZCBoYXMgbW9yZSB0aGFuIDEgcGFnZSwgc3RhcnQgdGhlIHNob3dcblx0XHRcdGlmKHNsaWRlci5zZXR0aW5ncy5hdXRvICYmIHNsaWRlci5zZXR0aW5ncy5hdXRvU3RhcnQgJiYgKGdldFBhZ2VyUXR5KCkgPiAxIHx8IHNsaWRlci5zZXR0aW5ncy5hdXRvU2xpZGVGb3JPbmVQYWdlKSl7IGluaXRBdXRvKCk7IH1cblx0XHRcdC8vIGlmIHRpY2tlciBpcyB0cnVlLCBzdGFydCB0aGUgdGlja2VyXG5cdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MudGlja2VyKXsgaW5pdFRpY2tlcigpOyB9XG5cdFx0XHQvLyBpZiBwYWdlciBpcyByZXF1ZXN0ZWQsIG1ha2UgdGhlIGFwcHJvcHJpYXRlIHBhZ2VyIGxpbmsgYWN0aXZlXG5cdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MucGFnZXIpeyB1cGRhdGVQYWdlckFjdGl2ZShzbGlkZXIuc2V0dGluZ3Muc3RhcnRTbGlkZSk7IH1cblx0XHRcdC8vIGNoZWNrIGZvciBhbnkgdXBkYXRlcyB0byB0aGUgY29udHJvbHMgKGxpa2UgaGlkZUNvbnRyb2xPbkVuZCB1cGRhdGVzKVxuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLmNvbnRyb2xzKXsgdXBkYXRlRGlyZWN0aW9uQ29udHJvbHMoKTsgfVxuXHRcdFx0Ly8gaWYgdG91Y2hFbmFibGVkIGlzIHRydWUsIHNldHVwIHRoZSB0b3VjaCBldmVudHNcblx0XHRcdGlmKHNsaWRlci5zZXR0aW5ncy50b3VjaEVuYWJsZWQgJiYgIXNsaWRlci5zZXR0aW5ncy50aWNrZXIpeyBpbml0VG91Y2goKTsgfVxuXHRcdFx0Ly8gaWYga2V5Ym9hcmRFbmFibGVkIGlzIHRydWUsIHNldHVwIHRoZSBrZXlib2FyZCBldmVudHNcblx0XHRcdGlmIChzbGlkZXIuc2V0dGluZ3Mua2V5Ym9hcmRFbmFibGVkICYmICFzbGlkZXIuc2V0dGluZ3MudGlja2VyKSB7IFxuXHRcdFx0XHQkKGRvY3VtZW50KS5rZXlkb3duKGtleVByZXNzKTtcblx0XHRcdH1cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0aGUgY2FsY3VsYXRlZCBoZWlnaHQgb2YgdGhlIHZpZXdwb3J0LCB1c2VkIHRvIGRldGVybWluZSBlaXRoZXIgYWRhcHRpdmVIZWlnaHQgb3IgdGhlIG1heEhlaWdodCB2YWx1ZVxuXHRcdCAqL1xuXHRcdHZhciBnZXRWaWV3cG9ydEhlaWdodCA9IGZ1bmN0aW9uKCl7XG5cdFx0XHR2YXIgaGVpZ2h0ID0gMDtcblx0XHRcdC8vIGZpcnN0IGRldGVybWluZSB3aGljaCBjaGlsZHJlbiAoc2xpZGVzKSBzaG91bGQgYmUgdXNlZCBpbiBvdXIgaGVpZ2h0IGNhbGN1bGF0aW9uXG5cdFx0XHR2YXIgY2hpbGRyZW4gPSAkKCk7XG5cdFx0XHQvLyBpZiBtb2RlIGlzIG5vdCBcInZlcnRpY2FsXCIgYW5kIGFkYXB0aXZlSGVpZ2h0IGlzIGZhbHNlLCBpbmNsdWRlIGFsbCBjaGlsZHJlblxuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLm1vZGUgIT09ICd2ZXJ0aWNhbCcgJiYgIXNsaWRlci5zZXR0aW5ncy5hZGFwdGl2ZUhlaWdodCl7XG5cdFx0XHRcdGNoaWxkcmVuID0gc2xpZGVyLmNoaWxkcmVuO1xuXHRcdFx0fWVsc2V7XG5cdFx0XHRcdC8vIGlmIG5vdCBjYXJvdXNlbCwgcmV0dXJuIHRoZSBzaW5nbGUgYWN0aXZlIGNoaWxkXG5cdFx0XHRcdGlmKCFzbGlkZXIuY2Fyb3VzZWwpe1xuXHRcdFx0XHRcdGNoaWxkcmVuID0gc2xpZGVyLmNoaWxkcmVuLmVxKHNsaWRlci5hY3RpdmUuaW5kZXgpO1xuXHRcdFx0XHQvLyBpZiBjYXJvdXNlbCwgcmV0dXJuIGEgc2xpY2Ugb2YgY2hpbGRyZW5cblx0XHRcdFx0fWVsc2V7XG5cdFx0XHRcdFx0Ly8gZ2V0IHRoZSBpbmRpdmlkdWFsIHNsaWRlIGluZGV4XG5cdFx0XHRcdFx0dmFyIGN1cnJlbnRJbmRleCA9IHNsaWRlci5zZXR0aW5ncy5tb3ZlU2xpZGVzID09PSAxID8gc2xpZGVyLmFjdGl2ZS5pbmRleCA6IHNsaWRlci5hY3RpdmUuaW5kZXggKiBnZXRNb3ZlQnkoKTtcblx0XHRcdFx0XHQvLyBhZGQgdGhlIGN1cnJlbnQgc2xpZGUgdG8gdGhlIGNoaWxkcmVuXG5cdFx0XHRcdFx0Y2hpbGRyZW4gPSBzbGlkZXIuY2hpbGRyZW4uZXEoY3VycmVudEluZGV4KTtcblx0XHRcdFx0XHQvLyBjeWNsZSB0aHJvdWdoIHRoZSByZW1haW5pbmcgXCJzaG93aW5nXCIgc2xpZGVzXG5cdFx0XHRcdFx0Zm9yIChpID0gMTsgaSA8PSBzbGlkZXIuc2V0dGluZ3MubWF4U2xpZGVzIC0gMTsgaSsrKXtcblx0XHRcdFx0XHRcdC8vIGlmIGxvb3BlZCBiYWNrIHRvIHRoZSBzdGFydFxuXHRcdFx0XHRcdFx0aWYoY3VycmVudEluZGV4ICsgaSA+PSBzbGlkZXIuY2hpbGRyZW4ubGVuZ3RoKXtcblx0XHRcdFx0XHRcdFx0Y2hpbGRyZW4gPSBjaGlsZHJlbi5hZGQoc2xpZGVyLmNoaWxkcmVuLmVxKGkgLSAxKSk7XG5cdFx0XHRcdFx0XHR9ZWxzZXtcblx0XHRcdFx0XHRcdFx0Y2hpbGRyZW4gPSBjaGlsZHJlbi5hZGQoc2xpZGVyLmNoaWxkcmVuLmVxKGN1cnJlbnRJbmRleCArIGkpKTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdC8vIGlmIFwidmVydGljYWxcIiBtb2RlLCBjYWxjdWxhdGUgdGhlIHN1bSBvZiB0aGUgaGVpZ2h0cyBvZiB0aGUgY2hpbGRyZW5cblx0XHRcdGlmKHNsaWRlci5zZXR0aW5ncy5tb2RlID09PSAndmVydGljYWwnKXtcblx0XHRcdFx0Y2hpbGRyZW4uZWFjaChmdW5jdGlvbihpbmRleCl7XG5cdFx0XHRcdCAgaGVpZ2h0ICs9ICQodGhpcykub3V0ZXJIZWlnaHQoKTtcblx0XHRcdFx0fSk7XG5cdFx0XHRcdC8vIGFkZCB1c2VyLXN1cHBsaWVkIG1hcmdpbnNcblx0XHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLnNsaWRlTWFyZ2luID4gMCl7XG5cdFx0XHRcdFx0aGVpZ2h0ICs9IHNsaWRlci5zZXR0aW5ncy5zbGlkZU1hcmdpbiAqIChzbGlkZXIuc2V0dGluZ3MubWluU2xpZGVzIC0gMSk7XG5cdFx0XHRcdH1cblx0XHRcdC8vIGlmIG5vdCBcInZlcnRpY2FsXCIgbW9kZSwgY2FsY3VsYXRlIHRoZSBtYXggaGVpZ2h0IG9mIHRoZSBjaGlsZHJlblxuXHRcdFx0fWVsc2V7XG5cdFx0XHRcdGhlaWdodCA9IE1hdGgubWF4LmFwcGx5KE1hdGgsIGNoaWxkcmVuLm1hcChmdW5jdGlvbigpe1xuXHRcdFx0XHRcdHJldHVybiAkKHRoaXMpLm91dGVySGVpZ2h0KGZhbHNlKTtcblx0XHRcdFx0fSkuZ2V0KCkpO1xuXHRcdFx0fVxuXG5cdFx0XHRpZihzbGlkZXIudmlld3BvcnQuY3NzKCdib3gtc2l6aW5nJykgPT09ICdib3JkZXItYm94Jyl7XG5cdFx0XHRcdGhlaWdodCArPVx0cGFyc2VGbG9hdChzbGlkZXIudmlld3BvcnQuY3NzKCdwYWRkaW5nLXRvcCcpKSArIHBhcnNlRmxvYXQoc2xpZGVyLnZpZXdwb3J0LmNzcygncGFkZGluZy1ib3R0b20nKSkgK1xuXHRcdFx0XHRcdFx0XHRwYXJzZUZsb2F0KHNsaWRlci52aWV3cG9ydC5jc3MoJ2JvcmRlci10b3Atd2lkdGgnKSkgKyBwYXJzZUZsb2F0KHNsaWRlci52aWV3cG9ydC5jc3MoJ2JvcmRlci1ib3R0b20td2lkdGgnKSk7XG5cdFx0XHR9ZWxzZSBpZihzbGlkZXIudmlld3BvcnQuY3NzKCdib3gtc2l6aW5nJykgPT09ICdwYWRkaW5nLWJveCcpe1xuXHRcdFx0XHRoZWlnaHQgKz1cdHBhcnNlRmxvYXQoc2xpZGVyLnZpZXdwb3J0LmNzcygncGFkZGluZy10b3AnKSkgKyBwYXJzZUZsb2F0KHNsaWRlci52aWV3cG9ydC5jc3MoJ3BhZGRpbmctYm90dG9tJykpO1xuXHRcdFx0fVxuXG5cdFx0XHRyZXR1cm4gaGVpZ2h0O1xuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIHRoZSBjYWxjdWxhdGVkIHdpZHRoIHRvIGJlIHVzZWQgZm9yIHRoZSBvdXRlciB3cmFwcGVyIC8gdmlld3BvcnRcblx0XHQgKi9cblx0XHR2YXIgZ2V0Vmlld3BvcnRNYXhXaWR0aCA9IGZ1bmN0aW9uKCl7XG5cdFx0XHR2YXIgd2lkdGggPSAnMTAwJSc7XG5cdFx0XHRpZihzbGlkZXIuc2V0dGluZ3Muc2xpZGVXaWR0aCA+IDApe1xuXHRcdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MubW9kZSA9PT0gJ2hvcml6b250YWwnKXtcblx0XHRcdFx0XHR3aWR0aCA9IChzbGlkZXIuc2V0dGluZ3MubWF4U2xpZGVzICogc2xpZGVyLnNldHRpbmdzLnNsaWRlV2lkdGgpICsgKChzbGlkZXIuc2V0dGluZ3MubWF4U2xpZGVzIC0gMSkgKiBzbGlkZXIuc2V0dGluZ3Muc2xpZGVNYXJnaW4pO1xuXHRcdFx0XHR9ZWxzZXtcblx0XHRcdFx0XHR3aWR0aCA9IHNsaWRlci5zZXR0aW5ncy5zbGlkZVdpZHRoO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gd2lkdGg7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgdGhlIGNhbGN1bGF0ZWQgd2lkdGggdG8gYmUgYXBwbGllZCB0byBlYWNoIHNsaWRlXG5cdFx0ICovXG5cdFx0dmFyIGdldFNsaWRlV2lkdGggPSBmdW5jdGlvbigpe1xuXHRcdFx0Ly8gc3RhcnQgd2l0aCBhbnkgdXNlci1zdXBwbGllZCBzbGlkZSB3aWR0aFxuXHRcdFx0dmFyIG5ld0VsV2lkdGggPSBzbGlkZXIuc2V0dGluZ3Muc2xpZGVXaWR0aDtcblx0XHRcdC8vIGdldCB0aGUgY3VycmVudCB2aWV3cG9ydCB3aWR0aFxuXHRcdFx0dmFyIHdyYXBXaWR0aCA9IHNsaWRlci52aWV3cG9ydC53aWR0aCgpO1xuXHRcdFx0Ly8gaWYgc2xpZGUgd2lkdGggd2FzIG5vdCBzdXBwbGllZCwgb3IgaXMgbGFyZ2VyIHRoYW4gdGhlIHZpZXdwb3J0IHVzZSB0aGUgdmlld3BvcnQgd2lkdGhcblx0XHRcdGlmKHNsaWRlci5zZXR0aW5ncy5zbGlkZVdpZHRoID09PSAwIHx8XG5cdFx0XHRcdChzbGlkZXIuc2V0dGluZ3Muc2xpZGVXaWR0aCA+IHdyYXBXaWR0aCAmJiAhc2xpZGVyLmNhcm91c2VsKSB8fFxuXHRcdFx0XHRzbGlkZXIuc2V0dGluZ3MubW9kZSA9PT0gJ3ZlcnRpY2FsJyl7XG5cdFx0XHRcdG5ld0VsV2lkdGggPSB3cmFwV2lkdGg7XG5cdFx0XHQvLyBpZiBjYXJvdXNlbCwgdXNlIHRoZSB0aHJlc2hvbGRzIHRvIGRldGVybWluZSB0aGUgd2lkdGhcblx0XHRcdH1lbHNlIGlmKHNsaWRlci5zZXR0aW5ncy5tYXhTbGlkZXMgPiAxICYmIHNsaWRlci5zZXR0aW5ncy5tb2RlID09PSAnaG9yaXpvbnRhbCcpe1xuXHRcdFx0XHRpZih3cmFwV2lkdGggPiBzbGlkZXIubWF4VGhyZXNob2xkKXtcblx0XHRcdFx0XHQvLyBuZXdFbFdpZHRoID0gKHdyYXBXaWR0aCAtIChzbGlkZXIuc2V0dGluZ3Muc2xpZGVNYXJnaW4gKiAoc2xpZGVyLnNldHRpbmdzLm1heFNsaWRlcyAtIDEpKSkgLyBzbGlkZXIuc2V0dGluZ3MubWF4U2xpZGVzO1xuXHRcdFx0XHR9ZWxzZSBpZih3cmFwV2lkdGggPCBzbGlkZXIubWluVGhyZXNob2xkKXtcblx0XHRcdFx0XHRuZXdFbFdpZHRoID0gKHdyYXBXaWR0aCAtIChzbGlkZXIuc2V0dGluZ3Muc2xpZGVNYXJnaW4gKiAoc2xpZGVyLnNldHRpbmdzLm1pblNsaWRlcyAtIDEpKSkgLyBzbGlkZXIuc2V0dGluZ3MubWluU2xpZGVzO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gbmV3RWxXaWR0aDtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyB0aGUgbnVtYmVyIG9mIHNsaWRlcyBjdXJyZW50bHkgdmlzaWJsZSBpbiB0aGUgdmlld3BvcnQgKGluY2x1ZGVzIHBhcnRpYWxseSB2aXNpYmxlIHNsaWRlcylcblx0XHQgKi9cblx0XHR2YXIgZ2V0TnVtYmVyU2xpZGVzU2hvd2luZyA9IGZ1bmN0aW9uKCl7XG5cdFx0XHR2YXIgc2xpZGVzU2hvd2luZyA9IDE7XG5cdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MubW9kZSA9PT0gJ2hvcml6b250YWwnICYmIHNsaWRlci5zZXR0aW5ncy5zbGlkZVdpZHRoID4gMCl7XG5cdFx0XHRcdC8vIGlmIHZpZXdwb3J0IGlzIHNtYWxsZXIgdGhhbiBtaW5UaHJlc2hvbGQsIHJldHVybiBtaW5TbGlkZXNcblx0XHRcdFx0aWYoc2xpZGVyLnZpZXdwb3J0LndpZHRoKCkgPCBzbGlkZXIubWluVGhyZXNob2xkKXtcblx0XHRcdFx0XHRzbGlkZXNTaG93aW5nID0gc2xpZGVyLnNldHRpbmdzLm1pblNsaWRlcztcblx0XHRcdFx0Ly8gaWYgdmlld3BvcnQgaXMgbGFyZ2VyIHRoYW4gbWF4VGhyZXNob2xkLCByZXR1cm4gbWF4U2xpZGVzXG5cdFx0XHRcdH1lbHNlIGlmKHNsaWRlci52aWV3cG9ydC53aWR0aCgpID4gc2xpZGVyLm1heFRocmVzaG9sZCl7XG5cdFx0XHRcdFx0c2xpZGVzU2hvd2luZyA9IHNsaWRlci5zZXR0aW5ncy5tYXhTbGlkZXM7XG5cdFx0XHRcdC8vIGlmIHZpZXdwb3J0IGlzIGJldHdlZW4gbWluIC8gbWF4IHRocmVzaG9sZHMsIGRpdmlkZSB2aWV3cG9ydCB3aWR0aCBieSBmaXJzdCBjaGlsZCB3aWR0aFxuXHRcdFx0XHR9ZWxzZXtcblx0XHRcdFx0XHR2YXIgY2hpbGRXaWR0aCA9IHNsaWRlci5jaGlsZHJlbi5maXJzdCgpLndpZHRoKCkgKyBzbGlkZXIuc2V0dGluZ3Muc2xpZGVNYXJnaW47XG5cdFx0XHRcdFx0c2xpZGVzU2hvd2luZyA9IE1hdGguZmxvb3IoKHNsaWRlci52aWV3cG9ydC53aWR0aCgpICtcblx0XHRcdFx0XHRcdHNsaWRlci5zZXR0aW5ncy5zbGlkZU1hcmdpbikgLyBjaGlsZFdpZHRoKTtcblx0XHRcdFx0fVxuXHRcdFx0Ly8gaWYgXCJ2ZXJ0aWNhbFwiIG1vZGUsIHNsaWRlcyBzaG93aW5nIHdpbGwgYWx3YXlzIGJlIG1pblNsaWRlc1xuXHRcdFx0fWVsc2UgaWYoc2xpZGVyLnNldHRpbmdzLm1vZGUgPT09ICd2ZXJ0aWNhbCcpe1xuXHRcdFx0XHRzbGlkZXNTaG93aW5nID0gc2xpZGVyLnNldHRpbmdzLm1pblNsaWRlcztcblx0XHRcdH1cblx0XHRcdHJldHVybiBzbGlkZXNTaG93aW5nO1xuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgcGFnZXMgKG9uZSBmdWxsIHZpZXdwb3J0IG9mIHNsaWRlcyBpcyBvbmUgXCJwYWdlXCIpXG5cdFx0ICovXG5cdFx0dmFyIGdldFBhZ2VyUXR5ID0gZnVuY3Rpb24oKXtcblx0XHRcdHZhciBwYWdlclF0eSA9IDA7XG5cdFx0XHQvLyBpZiBtb3ZlU2xpZGVzIGlzIHNwZWNpZmllZCBieSB0aGUgdXNlclxuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLm1vdmVTbGlkZXMgPiAwKXtcblx0XHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLmluZmluaXRlTG9vcCl7XG5cdFx0XHRcdFx0cGFnZXJRdHkgPSBNYXRoLmNlaWwoc2xpZGVyLmNoaWxkcmVuLmxlbmd0aCAvIGdldE1vdmVCeSgpKTtcblx0XHRcdFx0fWVsc2V7XG5cdFx0XHRcdFx0Ly8gdXNlIGEgd2hpbGUgbG9vcCB0byBkZXRlcm1pbmUgcGFnZXNcblx0XHRcdFx0XHR2YXIgYnJlYWtQb2ludCA9IDA7XG5cdFx0XHRcdFx0dmFyIGNvdW50ZXIgPSAwO1xuXHRcdFx0XHRcdC8vIHdoZW4gYnJlYWtwb2ludCBnb2VzIGFib3ZlIGNoaWxkcmVuIGxlbmd0aCwgY291bnRlciBpcyB0aGUgbnVtYmVyIG9mIHBhZ2VzXG5cdFx0XHRcdFx0d2hpbGUgKGJyZWFrUG9pbnQgPCBzbGlkZXIuY2hpbGRyZW4ubGVuZ3RoKXtcblx0XHRcdFx0XHRcdCsrcGFnZXJRdHk7XG5cdFx0XHRcdFx0XHRicmVha1BvaW50ID0gY291bnRlciArIGdldE51bWJlclNsaWRlc1Nob3dpbmcoKTtcblx0XHRcdFx0XHRcdGNvdW50ZXIgKz0gc2xpZGVyLnNldHRpbmdzLm1vdmVTbGlkZXMgPD0gZ2V0TnVtYmVyU2xpZGVzU2hvd2luZygpID8gc2xpZGVyLnNldHRpbmdzLm1vdmVTbGlkZXMgOiBnZXROdW1iZXJTbGlkZXNTaG93aW5nKCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9XG5cdFx0XHQvLyBpZiBtb3ZlU2xpZGVzIGlzIDAgKGF1dG8pIGRpdmlkZSBjaGlsZHJlbiBsZW5ndGggYnkgc2lkZXMgc2hvd2luZywgdGhlbiByb3VuZCB1cFxuXHRcdFx0fWVsc2V7XG5cdFx0XHRcdHBhZ2VyUXR5ID0gTWF0aC5jZWlsKHNsaWRlci5jaGlsZHJlbi5sZW5ndGggLyBnZXROdW1iZXJTbGlkZXNTaG93aW5nKCkpO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHBhZ2VyUXR5O1xuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBSZXR1cm5zIHRoZSBudW1iZXIgb2YgaW5kaXZpZHVhbCBzbGlkZXMgYnkgd2hpY2ggdG8gc2hpZnQgdGhlIHNsaWRlclxuXHRcdCAqL1xuXHRcdHZhciBnZXRNb3ZlQnkgPSBmdW5jdGlvbigpe1xuXHRcdFx0Ly8gaWYgbW92ZVNsaWRlcyB3YXMgc2V0IGJ5IHRoZSB1c2VyIGFuZCBtb3ZlU2xpZGVzIGlzIGxlc3MgdGhhbiBudW1iZXIgb2Ygc2xpZGVzIHNob3dpbmdcblx0XHRcdGlmKHNsaWRlci5zZXR0aW5ncy5tb3ZlU2xpZGVzID4gMCAmJiBzbGlkZXIuc2V0dGluZ3MubW92ZVNsaWRlcyA8PSBnZXROdW1iZXJTbGlkZXNTaG93aW5nKCkpe1xuXHRcdFx0XHRyZXR1cm4gc2xpZGVyLnNldHRpbmdzLm1vdmVTbGlkZXM7XG5cdFx0XHR9XG5cdFx0XHQvLyBpZiBtb3ZlU2xpZGVzIGlzIDAgKGF1dG8pXG5cdFx0XHRyZXR1cm4gZ2V0TnVtYmVyU2xpZGVzU2hvd2luZygpO1xuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBTZXRzIHRoZSBzbGlkZXIncyAoZWwpIGxlZnQgb3IgdG9wIHBvc2l0aW9uXG5cdFx0ICovXG5cdFx0dmFyIHNldFNsaWRlUG9zaXRpb24gPSBmdW5jdGlvbigpe1xuXHRcdFx0dmFyIHBvc2l0aW9uO1xuXHRcdFx0Ly8gaWYgbGFzdCBzbGlkZSwgbm90IGluZmluaXRlIGxvb3AsIGFuZCBudW1iZXIgb2YgY2hpbGRyZW4gaXMgbGFyZ2VyIHRoYW4gc3BlY2lmaWVkIG1heFNsaWRlc1xuXHRcdFx0aWYoc2xpZGVyLmNoaWxkcmVuLmxlbmd0aCA+IHNsaWRlci5zZXR0aW5ncy5tYXhTbGlkZXMgJiYgc2xpZGVyLmFjdGl2ZS5sYXN0ICYmICFzbGlkZXIuc2V0dGluZ3MuaW5maW5pdGVMb29wKXtcblx0XHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLm1vZGUgPT09ICdob3Jpem9udGFsJyl7XG5cdFx0XHRcdFx0Ly8gZ2V0IHRoZSBsYXN0IGNoaWxkJ3MgcG9zaXRpb25cblx0XHRcdFx0XHR2YXIgbGFzdENoaWxkID0gc2xpZGVyLmNoaWxkcmVuLmxhc3QoKTtcblx0XHRcdFx0XHRwb3NpdGlvbiA9IGxhc3RDaGlsZC5wb3NpdGlvbigpO1xuXHRcdFx0XHRcdC8vIHNldCB0aGUgbGVmdCBwb3NpdGlvblxuXHRcdFx0XHRcdHNldFBvc2l0aW9uUHJvcGVydHkoLShwb3NpdGlvbi5sZWZ0IC0gKHNsaWRlci52aWV3cG9ydC53aWR0aCgpIC0gbGFzdENoaWxkLm91dGVyV2lkdGgoKSkpLCAncmVzZXQnLCAwKTtcblx0XHRcdFx0fWVsc2UgaWYoc2xpZGVyLnNldHRpbmdzLm1vZGUgPT09ICd2ZXJ0aWNhbCcpe1xuXHRcdFx0XHRcdC8vIGdldCB0aGUgbGFzdCBzaG93aW5nIGluZGV4J3MgcG9zaXRpb25cblx0XHRcdFx0XHR2YXIgbGFzdFNob3dpbmdJbmRleCA9IHNsaWRlci5jaGlsZHJlbi5sZW5ndGggLSBzbGlkZXIuc2V0dGluZ3MubWluU2xpZGVzO1xuXHRcdFx0XHRcdHBvc2l0aW9uID0gc2xpZGVyLmNoaWxkcmVuLmVxKGxhc3RTaG93aW5nSW5kZXgpLnBvc2l0aW9uKCk7XG5cdFx0XHRcdFx0Ly8gc2V0IHRoZSB0b3AgcG9zaXRpb25cblx0XHRcdFx0XHRzZXRQb3NpdGlvblByb3BlcnR5KC1wb3NpdGlvbi50b3AsICdyZXNldCcsIDApO1xuXHRcdFx0XHR9XG5cdFx0XHQvLyBpZiBub3QgbGFzdCBzbGlkZVxuXHRcdFx0fWVsc2V7XG5cdFx0XHRcdC8vIGdldCB0aGUgcG9zaXRpb24gb2YgdGhlIGZpcnN0IHNob3dpbmcgc2xpZGVcblx0XHRcdFx0cG9zaXRpb24gPSBzbGlkZXIuY2hpbGRyZW4uZXEoc2xpZGVyLmFjdGl2ZS5pbmRleCAqIGdldE1vdmVCeSgpKS5wb3NpdGlvbigpO1xuXHRcdFx0XHQvLyBjaGVjayBmb3IgbGFzdCBzbGlkZVxuXHRcdFx0XHRpZihzbGlkZXIuYWN0aXZlLmluZGV4ID09PSBnZXRQYWdlclF0eSgpIC0gMSl7IHNsaWRlci5hY3RpdmUubGFzdCA9IHRydWU7IH1cblx0XHRcdFx0Ly8gc2V0IHRoZSByZXNwZWN0aXZlIHBvc2l0aW9uXG5cdFx0XHRcdGlmKHBvc2l0aW9uICE9PSB1bmRlZmluZWQpe1xuXHRcdFx0XHRcdGlmKHNsaWRlci5zZXR0aW5ncy5tb2RlID09PSAnaG9yaXpvbnRhbCcpeyBzZXRQb3NpdGlvblByb3BlcnR5KC1wb3NpdGlvbi5sZWZ0LCAncmVzZXQnLCAwKTsgfVxuXHRcdFx0XHRcdGVsc2UgaWYoc2xpZGVyLnNldHRpbmdzLm1vZGUgPT09ICd2ZXJ0aWNhbCcpeyBzZXRQb3NpdGlvblByb3BlcnR5KC1wb3NpdGlvbi50b3AsICdyZXNldCcsIDApOyB9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogU2V0cyB0aGUgZWwncyBhbmltYXRpbmcgcHJvcGVydHkgcG9zaXRpb24gKHdoaWNoIGluIHR1cm4gd2lsbCBzb21ldGltZXMgYW5pbWF0ZSBlbCkuXG5cdFx0ICogSWYgdXNpbmcgQ1NTLCBzZXRzIHRoZSB0cmFuc2Zvcm0gcHJvcGVydHkuIElmIG5vdCB1c2luZyBDU1MsIHNldHMgdGhlIHRvcCAvIGxlZnQgcHJvcGVydHkuXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0gdmFsdWUgKGludClcblx0XHQgKiAgLSB0aGUgYW5pbWF0aW5nIHByb3BlcnR5J3MgdmFsdWVcblx0XHQgKlxuXHRcdCAqIEBwYXJhbSB0eXBlIChzdHJpbmcpICdzbGlkZScsICdyZXNldCcsICd0aWNrZXInXG5cdFx0ICogIC0gdGhlIHR5cGUgb2YgaW5zdGFuY2UgZm9yIHdoaWNoIHRoZSBmdW5jdGlvbiBpcyBiZWluZ1xuXHRcdCAqXG5cdFx0ICogQHBhcmFtIGR1cmF0aW9uIChpbnQpXG5cdFx0ICogIC0gdGhlIGFtb3VudCBvZiB0aW1lIChpbiBtcykgdGhlIHRyYW5zaXRpb24gc2hvdWxkIG9jY3VweVxuXHRcdCAqXG5cdFx0ICogQHBhcmFtIHBhcmFtcyAoYXJyYXkpIG9wdGlvbmFsXG5cdFx0ICogIC0gYW4gb3B0aW9uYWwgcGFyYW1ldGVyIGNvbnRhaW5pbmcgYW55IHZhcmlhYmxlcyB0aGF0IG5lZWQgdG8gYmUgcGFzc2VkIGluXG5cdFx0ICovXG5cdFx0dmFyIHNldFBvc2l0aW9uUHJvcGVydHkgPSBmdW5jdGlvbih2YWx1ZSwgdHlwZSwgZHVyYXRpb24sIHBhcmFtcyl7XG5cdFx0XHQvLyB1c2UgQ1NTIHRyYW5zZm9ybVxuXHRcdFx0aWYoc2xpZGVyLnVzaW5nQ1NTKXtcblx0XHRcdFx0Ly8gZGV0ZXJtaW5lIHRoZSB0cmFuc2xhdGUzZCB2YWx1ZVxuXHRcdFx0XHR2YXIgcHJvcFZhbHVlID0gc2xpZGVyLnNldHRpbmdzLm1vZGUgPT09ICd2ZXJ0aWNhbCcgPyAndHJhbnNsYXRlM2QoMCwgJyArIHZhbHVlICsgJ3B4LCAwKScgOiAndHJhbnNsYXRlM2QoJyArIHZhbHVlICsgJ3B4LCAwLCAwKSc7XG5cdFx0XHRcdC8vIGFkZCB0aGUgQ1NTIHRyYW5zaXRpb24tZHVyYXRpb25cblx0XHRcdFx0ZWwuY3NzKCctJyArIHNsaWRlci5jc3NQcmVmaXggKyAnLXRyYW5zaXRpb24tZHVyYXRpb24nLCBkdXJhdGlvbiAvIDEwMDAgKyAncycpO1xuXHRcdFx0XHRpZih0eXBlID09PSAnc2xpZGUnKXtcblx0XHRcdFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0Ly8gc2V0IHRoZSBwcm9wZXJ0eSB2YWx1ZVxuXHRcdFx0XHRcdFx0ZWwuY3NzKHNsaWRlci5hbmltUHJvcCwgcHJvcFZhbHVlKTtcblx0XHRcdFx0XHRcdC8vIGlmIHZhbHVlIDAsIGp1c3QgdXBkYXRlXG5cdFx0XHRcdFx0XHRpZih2YWx1ZSA9PT0gMCkge1xuXHRcdFx0XHRcdFx0XHR1cGRhdGVBZnRlclNsaWRlVHJhbnNpdGlvbigpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0Ly8gYmluZCBhIGNhbGxiYWNrIG1ldGhvZCAtIGV4ZWN1dGVzIHdoZW4gQ1NTIHRyYW5zaXRpb24gY29tcGxldGVzXG5cdFx0XHRcdFx0XHRcdGVsLmJpbmQoJ3RyYW5zaXRpb25lbmQgd2Via2l0VHJhbnNpdGlvbkVuZCBvVHJhbnNpdGlvbkVuZCBNU1RyYW5zaXRpb25FbmQnLCBmdW5jdGlvbigpe1xuXHRcdFx0XHRcdFx0XHRcdC8vIHVuYmluZCB0aGUgY2FsbGJhY2tcblx0XHRcdFx0XHRcdFx0XHRlbC51bmJpbmQoJ3RyYW5zaXRpb25lbmQgd2Via2l0VHJhbnNpdGlvbkVuZCBvVHJhbnNpdGlvbkVuZCBNU1RyYW5zaXRpb25FbmQnKTtcblx0XHRcdFx0XHRcdFx0XHR1cGRhdGVBZnRlclNsaWRlVHJhbnNpdGlvbigpO1xuXHRcdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHRcdH1cblx0XHRcdFx0XHR9LCAwKTtcblx0XHRcdFx0fWVsc2UgaWYodHlwZSA9PT0gJ3Jlc2V0Jyl7XG5cdFx0XHRcdFx0ZWwuY3NzKHNsaWRlci5hbmltUHJvcCwgcHJvcFZhbHVlKTtcblx0XHRcdFx0fWVsc2UgaWYodHlwZSA9PT0gJ3RpY2tlcicpe1xuXHRcdFx0XHRcdC8vIG1ha2UgdGhlIHRyYW5zaXRpb24gdXNlICdsaW5lYXInXG5cdFx0XHRcdFx0ZWwuY3NzKCctJyArIHNsaWRlci5jc3NQcmVmaXggKyAnLXRyYW5zaXRpb24tdGltaW5nLWZ1bmN0aW9uJywgJ2xpbmVhcicpO1xuXHRcdFx0XHRcdGVsLmNzcyhzbGlkZXIuYW5pbVByb3AsIHByb3BWYWx1ZSk7XG5cdFx0XHRcdFx0Ly8gYmluZCBhIGNhbGxiYWNrIG1ldGhvZCAtIGV4ZWN1dGVzIHdoZW4gQ1NTIHRyYW5zaXRpb24gY29tcGxldGVzXG5cdFx0XHRcdFx0ZWwuYmluZCgndHJhbnNpdGlvbmVuZCB3ZWJraXRUcmFuc2l0aW9uRW5kIG9UcmFuc2l0aW9uRW5kIE1TVHJhbnNpdGlvbkVuZCcsIGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0XHQvLyB1bmJpbmQgdGhlIGNhbGxiYWNrXG5cdFx0XHRcdFx0XHRlbC51bmJpbmQoJ3RyYW5zaXRpb25lbmQgd2Via2l0VHJhbnNpdGlvbkVuZCBvVHJhbnNpdGlvbkVuZCBNU1RyYW5zaXRpb25FbmQnKTtcblx0XHRcdFx0XHRcdC8vIHJlc2V0IHRoZSBwb3NpdGlvblxuXHRcdFx0XHRcdFx0c2V0UG9zaXRpb25Qcm9wZXJ0eShwYXJhbXMucmVzZXRWYWx1ZSwgJ3Jlc2V0JywgMCk7XG5cdFx0XHRcdFx0XHQvLyBzdGFydCB0aGUgbG9vcCBhZ2FpblxuXHRcdFx0XHRcdFx0dGlja2VyTG9vcCgpO1xuXHRcdFx0XHRcdH0pO1xuXHRcdFx0XHR9XG5cdFx0XHQvLyB1c2UgSlMgYW5pbWF0ZVxuXHRcdFx0fWVsc2V7XG5cdFx0XHRcdHZhciBhbmltYXRlT2JqID0ge307XG5cdFx0XHRcdGFuaW1hdGVPYmpbc2xpZGVyLmFuaW1Qcm9wXSA9IHZhbHVlO1xuXHRcdFx0XHRpZih0eXBlID09PSAnc2xpZGUnKXtcblx0XHRcdFx0XHRlbC5hbmltYXRlKGFuaW1hdGVPYmosIGR1cmF0aW9uLCBzbGlkZXIuc2V0dGluZ3MuZWFzaW5nLCBmdW5jdGlvbigpe1xuXHRcdFx0XHRcdFx0dXBkYXRlQWZ0ZXJTbGlkZVRyYW5zaXRpb24oKTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fWVsc2UgaWYodHlwZSA9PT0gJ3Jlc2V0Jyl7XG5cdFx0XHRcdFx0ZWwuY3NzKHNsaWRlci5hbmltUHJvcCwgdmFsdWUpO1xuXHRcdFx0XHR9ZWxzZSBpZih0eXBlID09PSAndGlja2VyJyl7XG5cdFx0XHRcdFx0ZWwuYW5pbWF0ZShhbmltYXRlT2JqLCBzcGVlZCwgJ2xpbmVhcicsIGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0XHRzZXRQb3NpdGlvblByb3BlcnR5KHBhcmFtcy5yZXNldFZhbHVlLCAncmVzZXQnLCAwKTtcblx0XHRcdFx0XHRcdC8vIHJ1biB0aGUgcmVjdXJzaXZlIGxvb3AgYWZ0ZXIgYW5pbWF0aW9uXG5cdFx0XHRcdFx0XHR0aWNrZXJMb29wKCk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogUG9wdWxhdGVzIHRoZSBwYWdlciB3aXRoIHByb3BlciBhbW91bnQgb2YgcGFnZXNcblx0XHQgKi9cblx0XHR2YXIgcG9wdWxhdGVQYWdlciA9IGZ1bmN0aW9uKCl7XG5cdFx0XHR2YXIgcGFnZXJIdG1sID0gJyc7XG5cdFx0XHR2YXIgcGFnZXJRdHkgPSBnZXRQYWdlclF0eSgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJ3BhZ2VyUXR5ID0gJysgcGFnZXJRdHkpO1xuXHRcdFx0Ly8gbG9vcCB0aHJvdWdoIGVhY2ggcGFnZXIgaXRlbVxuXHRcdFx0Zm9yKHZhciBpPTA7IGkgPCBwYWdlclF0eTsgaSsrKXtcblx0XHRcdFx0dmFyIGxpbmtDb250ZW50ID0gJyc7XG5cdFx0XHRcdC8vIGlmIGEgYnVpbGRQYWdlciBmdW5jdGlvbiBpcyBzdXBwbGllZCwgdXNlIGl0IHRvIGdldCBwYWdlciBsaW5rIHZhbHVlLCBlbHNlIHVzZSBpbmRleCArIDFcblx0XHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLmJ1aWxkUGFnZXIgJiYgJC5pc0Z1bmN0aW9uKHNsaWRlci5zZXR0aW5ncy5idWlsZFBhZ2VyKSB8fCBzbGlkZXIuc2V0dGluZ3MucGFnZXJDdXN0b20pe1xuXHRcdFx0XHRcdGxpbmtDb250ZW50ID0gc2xpZGVyLnNldHRpbmdzLmJ1aWxkUGFnZXIoaSk7XG5cdFx0XHRcdFx0c2xpZGVyLnBhZ2VyRWwuYWRkQ2xhc3MoJ2J4LWN1c3RvbS1wYWdlcicpO1xuXHRcdFx0XHR9ZWxzZXtcblx0XHRcdFx0XHRsaW5rQ29udGVudCA9IGkgKyAxO1xuXHRcdFx0XHRcdHNsaWRlci5wYWdlckVsLmFkZENsYXNzKCdieC1kZWZhdWx0LXBhZ2VyJyk7XG5cdFx0XHRcdH1cblx0XHRcdFx0Ly8gdmFyIGxpbmtDb250ZW50ID0gc2xpZGVyLnNldHRpbmdzLmJ1aWxkUGFnZXIgJiYgJC5pc0Z1bmN0aW9uKHNsaWRlci5zZXR0aW5ncy5idWlsZFBhZ2VyKSA/IHNsaWRlci5zZXR0aW5ncy5idWlsZFBhZ2VyKGkpIDogaSArIDE7XG5cdFx0XHRcdC8vIGFkZCB0aGUgbWFya3VwIHRvIHRoZSBzdHJpbmdcblx0XHRcdFx0cGFnZXJIdG1sICs9ICc8ZGl2IGNsYXNzPVwiYngtcGFnZXItaXRlbVwiPjxhIGhyZWY9XCJcIiBkYXRhLXNsaWRlLWluZGV4PVwiJyArIGkgKyAnXCIgY2xhc3M9XCJieC1wYWdlci1saW5rXCI+JyArIGxpbmtDb250ZW50ICsgJzwvYT48L2Rpdj4nO1xuXHRcdFx0fVxuXHRcdFx0Ly8gcG9wdWxhdGUgdGhlIHBhZ2VyIGVsZW1lbnQgd2l0aCBwYWdlciBsaW5rc1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYocGFnZXJRdHkgPiAxKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNsaWRlci5wYWdlckVsLmh0bWwocGFnZXJIdG1sKTtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogQXBwZW5kcyB0aGUgcGFnZXIgdG8gdGhlIGNvbnRyb2xzIGVsZW1lbnRcblx0XHQgKi9cblx0XHR2YXIgYXBwZW5kUGFnZXIgPSBmdW5jdGlvbigpe1xuXHRcdFx0aWYoIXNsaWRlci5zZXR0aW5ncy5wYWdlckN1c3RvbSl7XG5cdFx0XHRcdC8vIGNyZWF0ZSB0aGUgcGFnZXIgRE9NIGVsZW1lbnRcblx0XHRcdFx0c2xpZGVyLnBhZ2VyRWwgPSAkKCc8ZGl2IGNsYXNzPVwiYngtcGFnZXJcIiAvPicpO1xuXHRcdFx0XHQvLyBpZiBhIHBhZ2VyIHNlbGVjdG9yIHdhcyBzdXBwbGllZCwgcG9wdWxhdGUgaXQgd2l0aCB0aGUgcGFnZXJcblx0XHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLnBhZ2VyU2VsZWN0b3Ipe1xuXHRcdFx0XHRcdCQoc2xpZGVyLnNldHRpbmdzLnBhZ2VyU2VsZWN0b3IpLmh0bWwoc2xpZGVyLnBhZ2VyRWwpO1xuXHRcdFx0XHQvLyBpZiBubyBwYWdlciBzZWxlY3RvciB3YXMgc3VwcGxpZWQsIGFkZCBpdCBhZnRlciB0aGUgd3JhcHBlclxuXHRcdFx0XHR9ZWxzZXtcblx0XHRcdFx0XHRzbGlkZXIuY29udHJvbHMuZWwuYWRkQ2xhc3MoJ2J4LWhhcy1wYWdlcicpLmFwcGVuZChzbGlkZXIucGFnZXJFbCk7XG5cdFx0XHRcdH1cblx0XHRcdFx0Ly8gcG9wdWxhdGUgdGhlIHBhZ2VyXG5cdFx0XHRcdHBvcHVsYXRlUGFnZXIoKTtcblx0XHRcdH1lbHNle1xuXHRcdFx0XHRzbGlkZXIucGFnZXJFbCA9ICQoc2xpZGVyLnNldHRpbmdzLnBhZ2VyQ3VzdG9tKTtcblx0XHRcdH1cblx0XHRcdC8vIGFzc2lnbiB0aGUgcGFnZXIgY2xpY2sgYmluZGluZ1xuXHRcdFx0c2xpZGVyLnBhZ2VyRWwub24oJ2NsaWNrIHRvdWNoZW5kJywgJ2EnLCBjbGlja1BhZ2VyQmluZCk7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIEFwcGVuZHMgcHJldiAvIG5leHQgY29udHJvbHMgdG8gdGhlIGNvbnRyb2xzIGVsZW1lbnRcblx0XHQgKi9cblx0XHR2YXIgYXBwZW5kQ29udHJvbHMgPSBmdW5jdGlvbigpe1xuXHRcdFx0c2xpZGVyLmNvbnRyb2xzLm5leHQgPSAkKCc8YSBjbGFzcz1cImJ4LW5leHRcIiBocmVmPVwiXCI+JyArIHNsaWRlci5zZXR0aW5ncy5uZXh0VGV4dCArICc8L2E+Jyk7XG5cdFx0XHRzbGlkZXIuY29udHJvbHMucHJldiA9ICQoJzxhIGNsYXNzPVwiYngtcHJldlwiIGhyZWY9XCJcIj4nICsgc2xpZGVyLnNldHRpbmdzLnByZXZUZXh0ICsgJzwvYT4nKTtcblx0XHRcdC8vIGJpbmQgY2xpY2sgYWN0aW9ucyB0byB0aGUgY29udHJvbHNcblx0XHRcdHNsaWRlci5jb250cm9scy5uZXh0LmJpbmQoJ2NsaWNrIHRvdWNoZW5kJywgY2xpY2tOZXh0QmluZCk7XG5cdFx0XHRzbGlkZXIuY29udHJvbHMucHJldi5iaW5kKCdjbGljayB0b3VjaGVuZCcsIGNsaWNrUHJldkJpbmQpO1xuXHRcdFx0Ly8gaWYgbmV4dFNlbGVjdG9yIHdhcyBzdXBwbGllZCwgcG9wdWxhdGUgaXRcblx0XHRcdGlmKHNsaWRlci5zZXR0aW5ncy5uZXh0U2VsZWN0b3Ipe1xuXHRcdFx0XHQkKHNsaWRlci5zZXR0aW5ncy5uZXh0U2VsZWN0b3IpLmFwcGVuZChzbGlkZXIuY29udHJvbHMubmV4dCk7XG5cdFx0XHR9XG5cdFx0XHQvLyBpZiBwcmV2U2VsZWN0b3Igd2FzIHN1cHBsaWVkLCBwb3B1bGF0ZSBpdFxuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLnByZXZTZWxlY3Rvcil7XG5cdFx0XHRcdCQoc2xpZGVyLnNldHRpbmdzLnByZXZTZWxlY3RvcikuYXBwZW5kKHNsaWRlci5jb250cm9scy5wcmV2KTtcblx0XHRcdH1cblx0XHRcdC8vIGlmIG5vIGN1c3RvbSBzZWxlY3RvcnMgd2VyZSBzdXBwbGllZFxuXHRcdFx0aWYoIXNsaWRlci5zZXR0aW5ncy5uZXh0U2VsZWN0b3IgJiYgIXNsaWRlci5zZXR0aW5ncy5wcmV2U2VsZWN0b3Ipe1xuXHRcdFx0XHQvLyBhZGQgdGhlIGNvbnRyb2xzIHRvIHRoZSBET01cblx0XHRcdFx0c2xpZGVyLmNvbnRyb2xzLmRpcmVjdGlvbkVsID0gJCgnPGRpdiBjbGFzcz1cImJ4LWNvbnRyb2xzLWRpcmVjdGlvblwiIC8+Jyk7XG5cdFx0XHRcdC8vIGFkZCB0aGUgY29udHJvbCBlbGVtZW50cyB0byB0aGUgZGlyZWN0aW9uRWxcblx0XHRcdFx0c2xpZGVyLmNvbnRyb2xzLmRpcmVjdGlvbkVsLmFwcGVuZChzbGlkZXIuY29udHJvbHMucHJldikuYXBwZW5kKHNsaWRlci5jb250cm9scy5uZXh0KTtcblx0XHRcdFx0Ly8gc2xpZGVyLnZpZXdwb3J0LmFwcGVuZChzbGlkZXIuY29udHJvbHMuZGlyZWN0aW9uRWwpO1xuXHRcdFx0XHRzbGlkZXIuY29udHJvbHMuZWwuYWRkQ2xhc3MoJ2J4LWhhcy1jb250cm9scy1kaXJlY3Rpb24nKS5hcHBlbmQoc2xpZGVyLmNvbnRyb2xzLmRpcmVjdGlvbkVsKTtcblx0XHRcdH1cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogQXBwZW5kcyBzdGFydCAvIHN0b3AgYXV0byBjb250cm9scyB0byB0aGUgY29udHJvbHMgZWxlbWVudFxuXHRcdCAqL1xuXHRcdHZhciBhcHBlbmRDb250cm9sc0F1dG8gPSBmdW5jdGlvbigpe1xuXHRcdFx0c2xpZGVyLmNvbnRyb2xzLnN0YXJ0ID0gJCgnPGRpdiBjbGFzcz1cImJ4LWNvbnRyb2xzLWF1dG8taXRlbVwiPjxhIGNsYXNzPVwiYngtc3RhcnRcIiBocmVmPVwiXCI+JyArIHNsaWRlci5zZXR0aW5ncy5zdGFydFRleHQgKyAnPC9hPjwvZGl2PicpO1xuXHRcdFx0c2xpZGVyLmNvbnRyb2xzLnN0b3AgPSAkKCc8ZGl2IGNsYXNzPVwiYngtY29udHJvbHMtYXV0by1pdGVtXCI+PGEgY2xhc3M9XCJieC1zdG9wXCIgaHJlZj1cIlwiPicgKyBzbGlkZXIuc2V0dGluZ3Muc3RvcFRleHQgKyAnPC9hPjwvZGl2PicpO1xuXHRcdFx0Ly8gYWRkIHRoZSBjb250cm9scyB0byB0aGUgRE9NXG5cdFx0XHRzbGlkZXIuY29udHJvbHMuYXV0b0VsID0gJCgnPGRpdiBjbGFzcz1cImJ4LWNvbnRyb2xzLWF1dG9cIiAvPicpO1xuXHRcdFx0Ly8gYmluZCBjbGljayBhY3Rpb25zIHRvIHRoZSBjb250cm9sc1xuXHRcdFx0c2xpZGVyLmNvbnRyb2xzLmF1dG9FbC5vbignY2xpY2snLCAnLmJ4LXN0YXJ0JywgY2xpY2tTdGFydEJpbmQpO1xuXHRcdFx0c2xpZGVyLmNvbnRyb2xzLmF1dG9FbC5vbignY2xpY2snLCAnLmJ4LXN0b3AnLCBjbGlja1N0b3BCaW5kKTtcblx0XHRcdC8vIGlmIGF1dG9Db250cm9sc0NvbWJpbmUsIGluc2VydCBvbmx5IHRoZSBcInN0YXJ0XCIgY29udHJvbFxuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLmF1dG9Db250cm9sc0NvbWJpbmUpe1xuXHRcdFx0XHRzbGlkZXIuY29udHJvbHMuYXV0b0VsLmFwcGVuZChzbGlkZXIuY29udHJvbHMuc3RhcnQpO1xuXHRcdFx0Ly8gaWYgYXV0b0NvbnRyb2xzQ29tYmluZSBpcyBmYWxzZSwgaW5zZXJ0IGJvdGggY29udHJvbHNcblx0XHRcdH1lbHNle1xuXHRcdFx0XHRzbGlkZXIuY29udHJvbHMuYXV0b0VsLmFwcGVuZChzbGlkZXIuY29udHJvbHMuc3RhcnQpLmFwcGVuZChzbGlkZXIuY29udHJvbHMuc3RvcCk7XG5cdFx0XHR9XG5cdFx0XHQvLyBpZiBhdXRvIGNvbnRyb2xzIHNlbGVjdG9yIHdhcyBzdXBwbGllZCwgcG9wdWxhdGUgaXQgd2l0aCB0aGUgY29udHJvbHNcblx0XHRcdGlmKHNsaWRlci5zZXR0aW5ncy5hdXRvQ29udHJvbHNTZWxlY3Rvcil7XG5cdFx0XHRcdCQoc2xpZGVyLnNldHRpbmdzLmF1dG9Db250cm9sc1NlbGVjdG9yKS5odG1sKHNsaWRlci5jb250cm9scy5hdXRvRWwpO1xuXHRcdFx0Ly8gaWYgYXV0byBjb250cm9scyBzZWxlY3RvciB3YXMgbm90IHN1cHBsaWVkLCBhZGQgaXQgYWZ0ZXIgdGhlIHdyYXBwZXJcblx0XHRcdH1lbHNle1xuXHRcdFx0XHRzbGlkZXIuY29udHJvbHMuZWwuYWRkQ2xhc3MoJ2J4LWhhcy1jb250cm9scy1hdXRvJykuYXBwZW5kKHNsaWRlci5jb250cm9scy5hdXRvRWwpO1xuXHRcdFx0fVxuXHRcdFx0Ly8gdXBkYXRlIHRoZSBhdXRvIGNvbnRyb2xzXG5cdFx0XHR1cGRhdGVBdXRvQ29udHJvbHMoc2xpZGVyLnNldHRpbmdzLmF1dG9TdGFydCA/ICdzdG9wJyA6ICdzdGFydCcpO1xuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBBcHBlbmRzIGltYWdlIGNhcHRpb25zIHRvIHRoZSBET01cblx0XHQgKi9cblx0XHR2YXIgYXBwZW5kQ2FwdGlvbnMgPSBmdW5jdGlvbigpe1xuXHRcdFx0Ly8gY3ljbGUgdGhyb3VnaCBlYWNoIGNoaWxkXG5cdFx0XHRzbGlkZXIuY2hpbGRyZW4uZWFjaChmdW5jdGlvbihpbmRleCl7XG5cdFx0XHRcdC8vIGdldCB0aGUgaW1hZ2UgdGl0bGUgYXR0cmlidXRlXG5cdFx0XHRcdHZhciB0aXRsZSA9ICQodGhpcykuZmluZCgnaW1nOmZpcnN0JykuYXR0cigndGl0bGUnKTtcblx0XHRcdFx0Ly8gYXBwZW5kIHRoZSBjYXB0aW9uXG5cdFx0XHRcdGlmKHRpdGxlICE9PSB1bmRlZmluZWQgJiYgKCcnICsgdGl0bGUpLmxlbmd0aCl7XG5cdFx0XHRcdFx0JCh0aGlzKS5hcHBlbmQoJzxkaXYgY2xhc3M9XCJieC1jYXB0aW9uXCI+PHNwYW4+JyArIHRpdGxlICsgJzwvc3Bhbj48L2Rpdj4nKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIENsaWNrIG5leHQgYmluZGluZ1xuXHRcdCAqXG5cdFx0ICogQHBhcmFtIGUgKGV2ZW50KVxuXHRcdCAqICAtIERPTSBldmVudCBvYmplY3Rcblx0XHQgKi9cblx0XHR2YXIgY2xpY2tOZXh0QmluZCA9IGZ1bmN0aW9uKGUpe1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0aWYgKHNsaWRlci5jb250cm9scy5lbC5oYXNDbGFzcygnZGlzYWJsZWQnKSkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0XHQvLyBpZiBhdXRvIHNob3cgaXMgcnVubmluZywgc3RvcCBpdFxuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLmF1dG8peyBlbC5zdG9wQXV0bygpOyB9XG5cdFx0XHRlbC5nb1RvTmV4dFNsaWRlKCk7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIENsaWNrIHByZXYgYmluZGluZ1xuXHRcdCAqXG5cdFx0ICogQHBhcmFtIGUgKGV2ZW50KVxuXHRcdCAqICAtIERPTSBldmVudCBvYmplY3Rcblx0XHQgKi9cblx0XHR2YXIgY2xpY2tQcmV2QmluZCA9IGZ1bmN0aW9uKGUpe1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0aWYgKHNsaWRlci5jb250cm9scy5lbC5oYXNDbGFzcygnZGlzYWJsZWQnKSkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0XHQvLyBpZiBhdXRvIHNob3cgaXMgcnVubmluZywgc3RvcCBpdFxuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLmF1dG8peyBlbC5zdG9wQXV0bygpOyB9XG5cdFx0XHRlbC5nb1RvUHJldlNsaWRlKCk7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIENsaWNrIHN0YXJ0IGJpbmRpbmdcblx0XHQgKlxuXHRcdCAqIEBwYXJhbSBlIChldmVudClcblx0XHQgKiAgLSBET00gZXZlbnQgb2JqZWN0XG5cdFx0ICovXG5cdFx0dmFyIGNsaWNrU3RhcnRCaW5kID0gZnVuY3Rpb24oZSl7XG5cdFx0XHRlbC5zdGFydEF1dG8oKTtcblx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogQ2xpY2sgc3RvcCBiaW5kaW5nXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0gZSAoZXZlbnQpXG5cdFx0ICogIC0gRE9NIGV2ZW50IG9iamVjdFxuXHRcdCAqL1xuXHRcdHZhciBjbGlja1N0b3BCaW5kID0gZnVuY3Rpb24oZSl7XG5cdFx0XHRlbC5zdG9wQXV0bygpO1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBDbGljayBwYWdlciBiaW5kaW5nXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0gZSAoZXZlbnQpXG5cdFx0ICogIC0gRE9NIGV2ZW50IG9iamVjdFxuXHRcdCAqL1xuXHRcdHZhciBjbGlja1BhZ2VyQmluZCA9IGZ1bmN0aW9uKGUpe1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0aWYgKHNsaWRlci5jb250cm9scy5lbC5oYXNDbGFzcygnZGlzYWJsZWQnKSkge1xuXHRcdFx0XHRyZXR1cm47XG5cdFx0XHR9XG5cdFx0XHQvLyBpZiBhdXRvIHNob3cgaXMgcnVubmluZywgc3RvcCBpdFxuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLmF1dG8peyBlbC5zdG9wQXV0bygpOyB9XG5cdFx0XHR2YXIgcGFnZXJMaW5rID0gJChlLmN1cnJlbnRUYXJnZXQpO1xuXHRcdFx0aWYocGFnZXJMaW5rLmF0dHIoJ2RhdGEtc2xpZGUtaW5kZXgnKSAhPT0gdW5kZWZpbmVkKXtcblx0XHRcdFx0dmFyIHBhZ2VySW5kZXggPSBwYXJzZUludChwYWdlckxpbmsuYXR0cignZGF0YS1zbGlkZS1pbmRleCcpKTtcblx0XHRcdFx0Ly8gaWYgY2xpY2tlZCBwYWdlciBsaW5rIGlzIG5vdCBhY3RpdmUsIGNvbnRpbnVlIHdpdGggdGhlIGdvVG9TbGlkZSBjYWxsXG5cdFx0XHRcdGlmKHBhZ2VySW5kZXggIT09IHNsaWRlci5hY3RpdmUuaW5kZXgpeyBlbC5nb1RvU2xpZGUocGFnZXJJbmRleCk7IH1cblx0XHRcdH1cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogVXBkYXRlcyB0aGUgcGFnZXIgbGlua3Mgd2l0aCBhbiBhY3RpdmUgY2xhc3Ncblx0XHQgKlxuXHRcdCAqIEBwYXJhbSBzbGlkZUluZGV4IChpbnQpXG5cdFx0ICogIC0gaW5kZXggb2Ygc2xpZGUgdG8gbWFrZSBhY3RpdmVcblx0XHQgKi9cblx0XHR2YXIgdXBkYXRlUGFnZXJBY3RpdmUgPSBmdW5jdGlvbihzbGlkZUluZGV4KXtcblx0XHRcdC8vIGlmIFwic2hvcnRcIiBwYWdlciB0eXBlXG5cdFx0XHR2YXIgbGVuID0gc2xpZGVyLmNoaWxkcmVuLmxlbmd0aDsgLy8gbmIgb2YgY2hpbGRyZW5cblx0XHRcdGlmKHNsaWRlci5zZXR0aW5ncy5wYWdlclR5cGUgPT09ICdzaG9ydCcpe1xuXHRcdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MubWF4U2xpZGVzID4gMSl7XG5cdFx0XHRcdFx0bGVuID0gTWF0aC5jZWlsKHNsaWRlci5jaGlsZHJlbi5sZW5ndGgvc2xpZGVyLnNldHRpbmdzLm1heFNsaWRlcyk7XG5cdFx0XHRcdH1cblx0XHRcdFx0c2xpZGVyLnBhZ2VyRWwuaHRtbCggKHNsaWRlSW5kZXggKyAxKSArIHNsaWRlci5zZXR0aW5ncy5wYWdlclNob3J0U2VwYXJhdG9yICsgbGVuKTtcblx0XHRcdFx0cmV0dXJuO1xuXHRcdFx0fVxuXHRcdFx0Ly8gcmVtb3ZlIGFsbCBwYWdlciBhY3RpdmUgY2xhc3Nlc1xuXHRcdFx0c2xpZGVyLnBhZ2VyRWwuZmluZCgnYScpLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcblx0XHRcdC8vIGFwcGx5IHRoZSBhY3RpdmUgY2xhc3MgZm9yIGFsbCBwYWdlcnNcblx0XHRcdHNsaWRlci5wYWdlckVsLmVhY2goZnVuY3Rpb24oaSwgZWwpeyAkKGVsKS5maW5kKCdhJykuZXEoc2xpZGVJbmRleCkuYWRkQ2xhc3MoJ2FjdGl2ZScpOyB9KTtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogUGVyZm9ybXMgbmVlZGVkIGFjdGlvbnMgYWZ0ZXIgYSBzbGlkZSB0cmFuc2l0aW9uXG5cdFx0ICovXG5cdFx0dmFyIHVwZGF0ZUFmdGVyU2xpZGVUcmFuc2l0aW9uID0gZnVuY3Rpb24oKXtcblx0XHRcdC8vIGlmIGluZmluaXRlIGxvb3AgaXMgdHJ1ZVxuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLmluZmluaXRlTG9vcCl7XG5cdFx0XHRcdHZhciBwb3NpdGlvbiA9ICcnO1xuXHRcdFx0XHQvLyBmaXJzdCBzbGlkZVxuXHRcdFx0XHRpZihzbGlkZXIuYWN0aXZlLmluZGV4ID09PSAwKXtcblx0XHRcdFx0XHQvLyBzZXQgdGhlIG5ldyBwb3NpdGlvblxuXHRcdFx0XHRcdHBvc2l0aW9uID0gc2xpZGVyLmNoaWxkcmVuLmVxKDApLnBvc2l0aW9uKCk7XG5cdFx0XHRcdC8vIGNhcm91c2VsLCBsYXN0IHNsaWRlXG5cdFx0XHRcdH1lbHNlIGlmKHNsaWRlci5hY3RpdmUuaW5kZXggPT09IGdldFBhZ2VyUXR5KCkgLSAxICYmIHNsaWRlci5jYXJvdXNlbCl7XG5cdFx0XHRcdFx0cG9zaXRpb24gPSBzbGlkZXIuY2hpbGRyZW4uZXEoKGdldFBhZ2VyUXR5KCkgLSAxKSAqIGdldE1vdmVCeSgpKS5wb3NpdGlvbigpO1xuXHRcdFx0XHQvLyBsYXN0IHNsaWRlXG5cdFx0XHRcdH1lbHNlIGlmKHNsaWRlci5hY3RpdmUuaW5kZXggPT09IHNsaWRlci5jaGlsZHJlbi5sZW5ndGggLSAxKXtcblx0XHRcdFx0XHRwb3NpdGlvbiA9IHNsaWRlci5jaGlsZHJlbi5lcShzbGlkZXIuY2hpbGRyZW4ubGVuZ3RoIC0gMSkucG9zaXRpb24oKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRpZihwb3NpdGlvbil7XG5cdFx0XHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLm1vZGUgPT09ICdob3Jpem9udGFsJyl7IHNldFBvc2l0aW9uUHJvcGVydHkoLXBvc2l0aW9uLmxlZnQsICdyZXNldCcsIDApOyB9XG5cdFx0XHRcdFx0ZWxzZSBpZihzbGlkZXIuc2V0dGluZ3MubW9kZSA9PT0gJ3ZlcnRpY2FsJyl7IHNldFBvc2l0aW9uUHJvcGVydHkoLXBvc2l0aW9uLnRvcCwgJ3Jlc2V0JywgMCk7IH1cblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdFx0Ly8gZGVjbGFyZSB0aGF0IHRoZSB0cmFuc2l0aW9uIGlzIGNvbXBsZXRlXG5cdFx0XHRzbGlkZXIud29ya2luZyA9IGZhbHNlO1xuXHRcdFx0Ly8gb25TbGlkZUFmdGVyIGNhbGxiYWNrXG5cdFx0XHRzbGlkZXIuc2V0dGluZ3Mub25TbGlkZUFmdGVyKHNsaWRlci5jaGlsZHJlbi5lcShzbGlkZXIuYWN0aXZlLmluZGV4KSwgc2xpZGVyLm9sZEluZGV4LCBzbGlkZXIuYWN0aXZlLmluZGV4KTtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogVXBkYXRlcyB0aGUgYXV0byBjb250cm9scyBzdGF0ZSAoZWl0aGVyIGFjdGl2ZSwgb3IgY29tYmluZWQgc3dpdGNoKVxuXHRcdCAqXG5cdFx0ICogQHBhcmFtIHN0YXRlIChzdHJpbmcpIFwic3RhcnRcIiwgXCJzdG9wXCJcblx0XHQgKiAgLSB0aGUgbmV3IHN0YXRlIG9mIHRoZSBhdXRvIHNob3dcblx0XHQgKi9cblx0XHR2YXIgdXBkYXRlQXV0b0NvbnRyb2xzID0gZnVuY3Rpb24oc3RhdGUpe1xuXHRcdFx0Ly8gaWYgYXV0b0NvbnRyb2xzQ29tYmluZSBpcyB0cnVlLCByZXBsYWNlIHRoZSBjdXJyZW50IGNvbnRyb2wgd2l0aCB0aGUgbmV3IHN0YXRlXG5cdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MuYXV0b0NvbnRyb2xzQ29tYmluZSl7XG5cdFx0XHRcdHNsaWRlci5jb250cm9scy5hdXRvRWwuaHRtbChzbGlkZXIuY29udHJvbHNbc3RhdGVdKTtcblx0XHRcdC8vIGlmIGF1dG9Db250cm9sc0NvbWJpbmUgaXMgZmFsc2UsIGFwcGx5IHRoZSBcImFjdGl2ZVwiIGNsYXNzIHRvIHRoZSBhcHByb3ByaWF0ZSBjb250cm9sXG5cdFx0XHR9ZWxzZXtcblx0XHRcdFx0c2xpZGVyLmNvbnRyb2xzLmF1dG9FbC5maW5kKCdhJykucmVtb3ZlQ2xhc3MoJ2FjdGl2ZScpO1xuXHRcdFx0XHRzbGlkZXIuY29udHJvbHMuYXV0b0VsLmZpbmQoJ2E6bm90KC5ieC0nICsgc3RhdGUgKyAnKScpLmFkZENsYXNzKCdhY3RpdmUnKTtcblx0XHRcdH1cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogVXBkYXRlcyB0aGUgZGlyZWN0aW9uIGNvbnRyb2xzIChjaGVja3MgaWYgZWl0aGVyIHNob3VsZCBiZSBoaWRkZW4pXG5cdFx0ICovXG5cdFx0dmFyIHVwZGF0ZURpcmVjdGlvbkNvbnRyb2xzID0gZnVuY3Rpb24oKXtcblx0XHRcdGlmKGdldFBhZ2VyUXR5KCkgPT09IDEpe1xuXHRcdFx0XHRzbGlkZXIuY29udHJvbHMucHJldi5hZGRDbGFzcygnZGlzYWJsZWQnKTtcblx0XHRcdFx0c2xpZGVyLmNvbnRyb2xzLm5leHQuYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdFx0XHR9ZWxzZSBpZighc2xpZGVyLnNldHRpbmdzLmluZmluaXRlTG9vcCAmJiBzbGlkZXIuc2V0dGluZ3MuaGlkZUNvbnRyb2xPbkVuZCl7XG5cdFx0XHRcdC8vIGlmIGZpcnN0IHNsaWRlXG5cdFx0XHRcdGlmKHNsaWRlci5hY3RpdmUuaW5kZXggPT09IDApe1xuXHRcdFx0XHRcdHNsaWRlci5jb250cm9scy5wcmV2LmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuXHRcdFx0XHRcdHNsaWRlci5jb250cm9scy5uZXh0LnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpO1xuXHRcdFx0XHQvLyBpZiBsYXN0IHNsaWRlXG5cdFx0XHRcdH1lbHNlIGlmKHNsaWRlci5hY3RpdmUuaW5kZXggPT09IGdldFBhZ2VyUXR5KCkgLSAxKXtcblx0XHRcdFx0XHRzbGlkZXIuY29udHJvbHMubmV4dC5hZGRDbGFzcygnZGlzYWJsZWQnKTtcblx0XHRcdFx0XHRzbGlkZXIuY29udHJvbHMucHJldi5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtcblx0XHRcdFx0Ly8gaWYgYW55IHNsaWRlIGluIHRoZSBtaWRkbGVcblx0XHRcdFx0fWVsc2V7XG5cdFx0XHRcdFx0c2xpZGVyLmNvbnRyb2xzLnByZXYucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdFx0XHRcdFx0c2xpZGVyLmNvbnRyb2xzLm5leHQucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogSW5pdGlhbGl6ZXMgdGhlIGF1dG8gcHJvY2Vzc1xuXHRcdCAqL1xuXHRcdHZhciBpbml0QXV0byA9IGZ1bmN0aW9uKCl7XG5cdFx0XHQvLyBpZiBhdXRvRGVsYXkgd2FzIHN1cHBsaWVkLCBsYXVuY2ggdGhlIGF1dG8gc2hvdyB1c2luZyBhIHNldFRpbWVvdXQoKSBjYWxsXG5cdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MuYXV0b0RlbGF5ID4gMCl7XG5cdFx0XHRcdHZhciB0aW1lb3V0ID0gc2V0VGltZW91dChlbC5zdGFydEF1dG8sIHNsaWRlci5zZXR0aW5ncy5hdXRvRGVsYXkpO1xuXHRcdFx0Ly8gaWYgYXV0b0RlbGF5IHdhcyBub3Qgc3VwcGxpZWQsIHN0YXJ0IHRoZSBhdXRvIHNob3cgbm9ybWFsbHlcblx0XHRcdH1lbHNle1xuXHRcdFx0XHRlbC5zdGFydEF1dG8oKTtcblxuXHRcdFx0XHQvL2FkZCBmb2N1cyBhbmQgYmx1ciBldmVudHMgdG8gZW5zdXJlIGl0cyBydW5uaW5nIGlmIHRpbWVvdXQgZ2V0cyBwYXVzZWRcblx0XHRcdFx0JCh3aW5kb3cpLmZvY3VzKGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdGVsLnN0YXJ0QXV0bygpO1xuXHRcdFx0XHR9KS5ibHVyKGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdGVsLnN0b3BBdXRvKCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0XHRcblxuXHRcdFx0fVxuXHRcdFx0Ly8gaWYgYXV0b0hvdmVyIGlzIHJlcXVlc3RlZFxuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLmF1dG9Ib3Zlcil7XG5cdFx0XHRcdC8vIG9uIGVsIGhvdmVyXG5cdFx0XHRcdGVsLmhvdmVyKGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0Ly8gaWYgdGhlIGF1dG8gc2hvdyBpcyBjdXJyZW50bHkgcGxheWluZyAoaGFzIGFuIGFjdGl2ZSBpbnRlcnZhbClcblx0XHRcdFx0XHRpZihzbGlkZXIuaW50ZXJ2YWwpe1xuXHRcdFx0XHRcdFx0Ly8gc3RvcCB0aGUgYXV0byBzaG93IGFuZCBwYXNzIHRydWUgYXJndW1lbnQgd2hpY2ggd2lsbCBwcmV2ZW50IGNvbnRyb2wgdXBkYXRlXG5cdFx0XHRcdFx0XHRlbC5zdG9wQXV0byh0cnVlKTtcblx0XHRcdFx0XHRcdC8vIGNyZWF0ZSBhIG5ldyBhdXRvUGF1c2VkIHZhbHVlIHdoaWNoIHdpbGwgYmUgdXNlZCBieSB0aGUgcmVsYXRpdmUgXCJtb3VzZW91dFwiIGV2ZW50XG5cdFx0XHRcdFx0XHRzbGlkZXIuYXV0b1BhdXNlZCA9IHRydWU7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHR9LCBmdW5jdGlvbigpe1xuXHRcdFx0XHRcdC8vIGlmIHRoZSBhdXRvUGF1c2VkIHZhbHVlIHdhcyBjcmVhdGVkIGJlIHRoZSBwcmlvciBcIm1vdXNlb3ZlclwiIGV2ZW50XG5cdFx0XHRcdFx0aWYoc2xpZGVyLmF1dG9QYXVzZWQpe1xuXHRcdFx0XHRcdFx0Ly8gc3RhcnQgdGhlIGF1dG8gc2hvdyBhbmQgcGFzcyB0cnVlIGFyZ3VtZW50IHdoaWNoIHdpbGwgcHJldmVudCBjb250cm9sIHVwZGF0ZVxuXHRcdFx0XHRcdFx0ZWwuc3RhcnRBdXRvKHRydWUpO1xuXHRcdFx0XHRcdFx0Ly8gcmVzZXQgdGhlIGF1dG9QYXVzZWQgdmFsdWVcblx0XHRcdFx0XHRcdHNsaWRlci5hdXRvUGF1c2VkID0gbnVsbDtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH0pO1xuXHRcdFx0fVxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBJbml0aWFsaXplcyB0aGUgdGlja2VyIHByb2Nlc3Ncblx0XHQgKi9cblx0XHR2YXIgaW5pdFRpY2tlciA9IGZ1bmN0aW9uKCl7XG5cdFx0XHR2YXIgc3RhcnRQb3NpdGlvbiA9IDA7XG5cdFx0XHQvLyBpZiBhdXRvRGlyZWN0aW9uIGlzIFwibmV4dFwiLCBhcHBlbmQgYSBjbG9uZSBvZiB0aGUgZW50aXJlIHNsaWRlclxuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLmF1dG9EaXJlY3Rpb24gPT09ICduZXh0Jyl7XG5cdFx0XHRcdGVsLmFwcGVuZChzbGlkZXIuY2hpbGRyZW4uY2xvbmUoKS5hZGRDbGFzcygnYngtY2xvbmUnKSk7XG5cdFx0XHQvLyBpZiBhdXRvRGlyZWN0aW9uIGlzIFwicHJldlwiLCBwcmVwZW5kIGEgY2xvbmUgb2YgdGhlIGVudGlyZSBzbGlkZXIsIGFuZCBzZXQgdGhlIGxlZnQgcG9zaXRpb25cblx0XHRcdH1lbHNle1xuXHRcdFx0XHRlbC5wcmVwZW5kKHNsaWRlci5jaGlsZHJlbi5jbG9uZSgpLmFkZENsYXNzKCdieC1jbG9uZScpKTtcblx0XHRcdFx0dmFyIHBvc2l0aW9uID0gc2xpZGVyLmNoaWxkcmVuLmZpcnN0KCkucG9zaXRpb24oKTtcblx0XHRcdFx0c3RhcnRQb3NpdGlvbiA9IHNsaWRlci5zZXR0aW5ncy5tb2RlID09PSAnaG9yaXpvbnRhbCcgPyAtcG9zaXRpb24ubGVmdCA6IC1wb3NpdGlvbi50b3A7XG5cdFx0XHR9XG5cdFx0XHRzZXRQb3NpdGlvblByb3BlcnR5KHN0YXJ0UG9zaXRpb24sICdyZXNldCcsIDApO1xuXHRcdFx0Ly8gZG8gbm90IGFsbG93IGNvbnRyb2xzIGluIHRpY2tlciBtb2RlXG5cdFx0XHRzbGlkZXIuc2V0dGluZ3MucGFnZXIgPSBmYWxzZTtcblx0XHRcdHNsaWRlci5zZXR0aW5ncy5jb250cm9scyA9IGZhbHNlO1xuXHRcdFx0c2xpZGVyLnNldHRpbmdzLmF1dG9Db250cm9scyA9IGZhbHNlO1xuXHRcdFx0Ly8gaWYgYXV0b0hvdmVyIGlzIHJlcXVlc3RlZFxuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLnRpY2tlckhvdmVyKXtcblx0XHRcdFx0aWYoc2xpZGVyLnVzaW5nQ1NTKXtcblx0XHRcdFx0XHR2YXIgdmFsdWU7XG5cdFx0XHRcdFx0dmFyIGlkeCA9IHNsaWRlci5zZXR0aW5ncy5tb2RlID09ICdob3Jpem9udGFsJyA/IDQgOiA1O1xuXHRcdFx0XHRcdHNsaWRlci52aWV3cG9ydC5ob3ZlcihmdW5jdGlvbigpe1xuXHRcdFx0XHRcdFx0dmFyIHRyYW5zZm9ybSA9IGVsLmNzcygnLScgKyBzbGlkZXIuY3NzUHJlZml4ICsgJy10cmFuc2Zvcm0nKTtcblx0XHRcdFx0XHRcdHZhbHVlID0gcGFyc2VGbG9hdCh0cmFuc2Zvcm0uc3BsaXQoJywnKVtpZHhdKTtcblx0XHRcdFx0XHRcdHNldFBvc2l0aW9uUHJvcGVydHkodmFsdWUsICdyZXNldCcsIDApO1xuXHRcdFx0XHRcdH0sIGZ1bmN0aW9uKCl7XG5cdFx0XHRcdFx0XHR2YXIgdG90YWxEaW1lbnMgPSAwO1xuXHRcdFx0XHRcdFx0c2xpZGVyLmNoaWxkcmVuLmVhY2goZnVuY3Rpb24oaW5kZXgpe1xuXHRcdFx0XHRcdFx0ICB0b3RhbERpbWVucyArPSBzbGlkZXIuc2V0dGluZ3MubW9kZSA9PSAnaG9yaXpvbnRhbCcgPyAkKHRoaXMpLm91dGVyV2lkdGgodHJ1ZSkgOiAkKHRoaXMpLm91dGVySGVpZ2h0KHRydWUpO1xuXHRcdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0XHQvLyBjYWxjdWxhdGUgdGhlIHNwZWVkIHJhdGlvICh1c2VkIHRvIGRldGVybWluZSB0aGUgbmV3IHNwZWVkIHRvIGZpbmlzaCB0aGUgcGF1c2VkIGFuaW1hdGlvbilcblx0XHRcdFx0XHRcdHZhciByYXRpbyA9IHNsaWRlci5zZXR0aW5ncy5zcGVlZCAvIHRvdGFsRGltZW5zO1xuXHRcdFx0XHRcdFx0Ly8gZGV0ZXJtaW5lIHdoaWNoIHByb3BlcnR5IHRvIHVzZVxuXHRcdFx0XHRcdFx0dmFyIHByb3BlcnR5ID0gc2xpZGVyLnNldHRpbmdzLm1vZGUgPT0gJ2hvcml6b250YWwnID8gJ2xlZnQnIDogJ3RvcCc7XG5cdFx0XHRcdFx0XHQvLyBjYWxjdWxhdGUgdGhlIG5ldyBzcGVlZFxuXHRcdFx0XHRcdFx0dmFyIG5ld1NwZWVkID0gcmF0aW8gKiAodG90YWxEaW1lbnMgLSAoTWF0aC5hYnMocGFyc2VJbnQodmFsdWUpKSkpO1xuXHRcdFx0XHRcdFx0dGlja2VyTG9vcChuZXdTcGVlZCk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0Ly8gb24gZWwgaG92ZXJcblx0XHRcdFx0XHRzbGlkZXIudmlld3BvcnQuaG92ZXIoZnVuY3Rpb24oKXtcblx0XHRcdFx0XHRcdGVsLnN0b3AoKTtcblx0XHRcdFx0XHR9LCBmdW5jdGlvbigpe1xuXHRcdFx0XHRcdFx0Ly8gY2FsY3VsYXRlIHRoZSB0b3RhbCB3aWR0aCBvZiBjaGlsZHJlbiAodXNlZCB0byBjYWxjdWxhdGUgdGhlIHNwZWVkIHJhdGlvKVxuXHRcdFx0XHRcdFx0dmFyIHRvdGFsRGltZW5zID0gMDtcblx0XHRcdFx0XHRcdHNsaWRlci5jaGlsZHJlbi5lYWNoKGZ1bmN0aW9uKGluZGV4KXtcblx0XHRcdFx0XHRcdCAgdG90YWxEaW1lbnMgKz0gc2xpZGVyLnNldHRpbmdzLm1vZGUgPT0gJ2hvcml6b250YWwnID8gJCh0aGlzKS5vdXRlcldpZHRoKHRydWUpIDogJCh0aGlzKS5vdXRlckhlaWdodCh0cnVlKTtcblx0XHRcdFx0XHRcdH0pO1xuXHRcdFx0XHRcdFx0Ly8gY2FsY3VsYXRlIHRoZSBzcGVlZCByYXRpbyAodXNlZCB0byBkZXRlcm1pbmUgdGhlIG5ldyBzcGVlZCB0byBmaW5pc2ggdGhlIHBhdXNlZCBhbmltYXRpb24pXG5cdFx0XHRcdFx0XHR2YXIgcmF0aW8gPSBzbGlkZXIuc2V0dGluZ3Muc3BlZWQgLyB0b3RhbERpbWVucztcblx0XHRcdFx0XHRcdC8vIGRldGVybWluZSB3aGljaCBwcm9wZXJ0eSB0byB1c2Vcblx0XHRcdFx0XHRcdHZhciBwcm9wZXJ0eSA9IHNsaWRlci5zZXR0aW5ncy5tb2RlID09ICdob3Jpem9udGFsJyA/ICdsZWZ0JyA6ICd0b3AnO1xuXHRcdFx0XHRcdFx0Ly8gY2FsY3VsYXRlIHRoZSBuZXcgc3BlZWRcblx0XHRcdFx0XHRcdHZhciBuZXdTcGVlZCA9IHJhdGlvICogKHRvdGFsRGltZW5zIC0gKE1hdGguYWJzKHBhcnNlSW50KGVsLmNzcyhwcm9wZXJ0eSkpKSkpO1xuXHRcdFx0XHRcdFx0dGlja2VyTG9vcChuZXdTcGVlZCk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdC8vIHN0YXJ0IHRoZSB0aWNrZXIgbG9vcFxuXHRcdFx0dGlja2VyTG9vcCgpO1xuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBSdW5zIGEgY29udGludW91cyBsb29wLCBuZXdzIHRpY2tlci1zdHlsZVxuXHRcdCAqL1xuXHRcdHZhciB0aWNrZXJMb29wID0gZnVuY3Rpb24ocmVzdW1lU3BlZWQpe1xuXHRcdFx0c3BlZWQgPSByZXN1bWVTcGVlZCA/IHJlc3VtZVNwZWVkIDogc2xpZGVyLnNldHRpbmdzLnNwZWVkO1xuXHRcdFx0dmFyIHBvc2l0aW9uID0ge2xlZnQ6IDAsIHRvcDogMH07XG5cdFx0XHR2YXIgcmVzZXQgPSB7bGVmdDogMCwgdG9wOiAwfTtcblx0XHRcdC8vIGlmIFwibmV4dFwiIGFuaW1hdGUgbGVmdCBwb3NpdGlvbiB0byBsYXN0IGNoaWxkLCB0aGVuIHJlc2V0IGxlZnQgdG8gMFxuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLmF1dG9EaXJlY3Rpb24gPT09ICduZXh0Jyl7XG5cdFx0XHRcdHBvc2l0aW9uID0gZWwuZmluZCgnLmJ4LWNsb25lJykuZmlyc3QoKS5wb3NpdGlvbigpO1xuXHRcdFx0Ly8gaWYgXCJwcmV2XCIgYW5pbWF0ZSBsZWZ0IHBvc2l0aW9uIHRvIDAsIHRoZW4gcmVzZXQgbGVmdCB0byBmaXJzdCBub24tY2xvbmUgY2hpbGRcblx0XHRcdH1lbHNle1xuXHRcdFx0XHRyZXNldCA9IHNsaWRlci5jaGlsZHJlbi5maXJzdCgpLnBvc2l0aW9uKCk7XG5cdFx0XHR9XG5cdFx0XHR2YXIgYW5pbWF0ZVByb3BlcnR5ID0gc2xpZGVyLnNldHRpbmdzLm1vZGUgPT09ICdob3Jpem9udGFsJyA/IC1wb3NpdGlvbi5sZWZ0IDogLXBvc2l0aW9uLnRvcDtcblx0XHRcdHZhciByZXNldFZhbHVlID0gc2xpZGVyLnNldHRpbmdzLm1vZGUgPT09ICdob3Jpem9udGFsJyA/IC1yZXNldC5sZWZ0IDogLXJlc2V0LnRvcDtcblx0XHRcdHZhciBwYXJhbXMgPSB7cmVzZXRWYWx1ZTogcmVzZXRWYWx1ZX07XG5cdFx0XHRzZXRQb3NpdGlvblByb3BlcnR5KGFuaW1hdGVQcm9wZXJ0eSwgJ3RpY2tlcicsIHNwZWVkLCBwYXJhbXMpO1xuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBDaGVjayBpZiBlbCBpcyBvbiBzY3JlZW5cblx0XHQgKi9cblx0XHR2YXIgaXNPblNjcmVlbiA9IGZ1bmN0aW9uKGVsKXtcblx0XHRcdHZhciB3aW4gPSAkKHdpbmRvdyk7XG5cdFx0XHR2YXIgdmlld3BvcnQgPSB7XG5cdFx0XHRcdHRvcCA6IHdpbi5zY3JvbGxUb3AoKSxcblx0XHRcdFx0bGVmdCA6IHdpbi5zY3JvbGxMZWZ0KClcblx0XHRcdH07XG5cdFx0XHR2aWV3cG9ydC5yaWdodCA9IHZpZXdwb3J0LmxlZnQgKyB3aW4ud2lkdGgoKTtcblx0XHRcdHZpZXdwb3J0LmJvdHRvbSA9IHZpZXdwb3J0LnRvcCArIHdpbi5oZWlnaHQoKTtcblxuXHRcdFx0dmFyIGJvdW5kcyA9IGVsLm9mZnNldCgpO1xuXHRcdFx0Ym91bmRzLnJpZ2h0ID0gYm91bmRzLmxlZnQgKyBlbC5vdXRlcldpZHRoKCk7XG5cdFx0XHRib3VuZHMuYm90dG9tID0gYm91bmRzLnRvcCArIGVsLm91dGVySGVpZ2h0KCk7XG5cblx0XHRcdHJldHVybiAoISh2aWV3cG9ydC5yaWdodCA8IGJvdW5kcy5sZWZ0IHx8IHZpZXdwb3J0LmxlZnQgPiBib3VuZHMucmlnaHQgfHwgdmlld3BvcnQuYm90dG9tIDwgYm91bmRzLnRvcCB8fCB2aWV3cG9ydC50b3AgPiBib3VuZHMuYm90dG9tKSk7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIEluaXRpYWxpemVzIGtleWJvYXJkIGV2ZW50c1xuXHRcdCAqL1xuXHRcdHZhciBrZXlQcmVzcyA9IGZ1bmN0aW9uKGUpe1xuXHRcdFx0dmFyIGFjdGl2ZUVsZW1lbnRUYWcgPSBkb2N1bWVudC5hY3RpdmVFbGVtZW50LnRhZ05hbWUudG9Mb3dlckNhc2UoKTtcblx0XHRcdHZhciB0YWdGaWx0ZXJzPSdpbnB1dHx0ZXh0YXJlYSc7XG5cdFx0XHR2YXIgcCA9IG5ldyBSZWdFeHAoYWN0aXZlRWxlbWVudFRhZyxbXCJpXCJdKTtcblx0XHRcdHZhciByZXN1bHQgPSBwLmV4ZWModGFnRmlsdGVycyk7XG5cdFx0XHRpZiAocmVzdWx0ID09IG51bGwgJiYgaXNPblNjcmVlbihlbCkpIHtcblx0XHRcdFx0aWYgKGUua2V5Q29kZSA9PSAzOSkge1xuXHRcdFx0XHRcdGNsaWNrTmV4dEJpbmQoZSk7XG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHR9XG5cdFx0XHRcdGVsc2UgaWYgKGUua2V5Q29kZSA9PSAzNykge1xuXHRcdFx0XHRcdGNsaWNrUHJldkJpbmQoZSk7XG5cdFx0XHRcdFx0cmV0dXJuIGZhbHNlO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIEluaXRpYWxpemVzIHRvdWNoIGV2ZW50c1xuXHRcdCAqL1xuXHRcdHZhciBpbml0VG91Y2ggPSBmdW5jdGlvbigpe1xuXHRcdFx0Ly8gaW5pdGlhbGl6ZSBvYmplY3QgdG8gY29udGFpbiBhbGwgdG91Y2ggdmFsdWVzXG5cdFx0XHRzbGlkZXIudG91Y2ggPSB7XG5cdFx0XHRcdHN0YXJ0OiB7eDogMCwgeTogMH0sXG5cdFx0XHRcdGVuZDoge3g6IDAsIHk6IDB9XG5cdFx0XHR9O1xuXHRcdFx0c2xpZGVyLnZpZXdwb3J0LmJpbmQoJ3RvdWNoc3RhcnQgTVNQb2ludGVyRG93biBwb2ludGVyZG93bicsIG9uVG91Y2hTdGFydCk7XG5cdFx0XHRcblx0XHRcdC8vZm9yIGJyb3dzZXJzIHRoYXQgaGF2ZSBpbXBsZW1lbnRlZCBwb2ludGVyIGV2ZW50cyBhbmQgZmlyZSBhIGNsaWNrIGFmdGVyXG5cdFx0XHQvL2V2ZXJ5IHBvaW50ZXJ1cCByZWdhcmRsZXNzIG9mIHdoZXRoZXIgcG9pbnRlcnVwIGlzIG9uIHNhbWUgc2NyZWVuIGxvY2F0aW9uIGFzIHBvaW50ZXJkb3duIG9yIG5vdFxuXHRcdFx0c2xpZGVyLnZpZXdwb3J0Lm9uKCdjbGljaycsICcuYnhzbGlkZXIgYScsIGZ1bmN0aW9uKGUpIHtcblx0XHRcdFx0aWYgKHNsaWRlci52aWV3cG9ydC5oYXNDbGFzcygnY2xpY2stZGlzYWJsZWQnKSkge1xuXHRcdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0XHRzbGlkZXIudmlld3BvcnQucmVtb3ZlQ2xhc3MoJ2NsaWNrLWRpc2FibGVkJyk7XG5cdFx0XHRcdH1cblx0XHRcdH0pO1xuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBFdmVudCBoYW5kbGVyIGZvciBcInRvdWNoc3RhcnRcIlxuXHRcdCAqXG5cdFx0ICogQHBhcmFtIGUgKGV2ZW50KVxuXHRcdCAqICAtIERPTSBldmVudCBvYmplY3Rcblx0XHQgKi9cblx0XHR2YXIgb25Ub3VjaFN0YXJ0ID0gZnVuY3Rpb24oZSl7XG5cdFx0XHQvL2Rpc2FibGUgc2xpZGVyIGNvbnRyb2xzIHdoaWxlIHVzZXIgaXMgaW50ZXJhY3Rpbmcgd2l0aCBzbGlkZXMgdG8gYXZvaWQgc2xpZGVyIGZyZWV6ZSB0aGF0IGhhcHBlbnMgb24gdG91Y2ggZGV2aWNlcyB3aGVuIGEgc2xpZGUgc3dpcGUgaGFwcGVucyBpbW1lZGlhdGVseSBhZnRlciBpbnRlcmFjdGluZyB3aXRoIHNsaWRlciBjb250cm9sc1xuXHRcdFx0c2xpZGVyLmNvbnRyb2xzLmVsLmFkZENsYXNzKCdkaXNhYmxlZCcpO1xuXG5cdFx0XHRpZihzbGlkZXIud29ya2luZyl7XG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0c2xpZGVyLmNvbnRyb2xzLmVsLnJlbW92ZUNsYXNzKCdkaXNhYmxlZCcpO1xuXHRcdFx0fWVsc2V7XG5cdFx0XHRcdC8vIHJlY29yZCB0aGUgb3JpZ2luYWwgcG9zaXRpb24gd2hlbiB0b3VjaCBzdGFydHNcblx0XHRcdFx0c2xpZGVyLnRvdWNoLm9yaWdpbmFsUG9zID0gZWwucG9zaXRpb24oKTtcblx0XHRcdFx0dmFyIG9yaWcgPSBlLm9yaWdpbmFsRXZlbnQ7XG5cdFx0XHRcdHZhciB0b3VjaFBvaW50cyA9ICh0eXBlb2Ygb3JpZy5jaGFuZ2VkVG91Y2hlcyAhPSAndW5kZWZpbmVkJykgPyBvcmlnLmNoYW5nZWRUb3VjaGVzIDogW29yaWddO1xuXHRcdFx0XHQvLyByZWNvcmQgdGhlIHN0YXJ0aW5nIHRvdWNoIHgsIHkgY29vcmRpbmF0ZXNcblx0XHRcdFx0c2xpZGVyLnRvdWNoLnN0YXJ0LnggPSB0b3VjaFBvaW50c1swXS5wYWdlWDtcblx0XHRcdFx0c2xpZGVyLnRvdWNoLnN0YXJ0LnkgPSB0b3VjaFBvaW50c1swXS5wYWdlWTtcblxuXHRcdFx0XHRpZiAoc2xpZGVyLnZpZXdwb3J0LmdldCgwKS5zZXRQb2ludGVyQ2FwdHVyZSkge1xuXHRcdFx0XHRcdHNsaWRlci5wb2ludGVySWQgPSBvcmlnLnBvaW50ZXJJZDtcblx0XHRcdFx0XHRzbGlkZXIudmlld3BvcnQuZ2V0KDApLnNldFBvaW50ZXJDYXB0dXJlKHNsaWRlci5wb2ludGVySWQpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdC8vIGJpbmQgYSBcInRvdWNobW92ZVwiIGV2ZW50IHRvIHRoZSB2aWV3cG9ydFxuXHRcdFx0XHRzbGlkZXIudmlld3BvcnQuYmluZCgndG91Y2htb3ZlIE1TUG9pbnRlck1vdmUgcG9pbnRlcm1vdmUnLCBvblRvdWNoTW92ZSk7XG5cdFx0XHRcdC8vIGJpbmQgYSBcInRvdWNoZW5kXCIgZXZlbnQgdG8gdGhlIHZpZXdwb3J0XG5cdFx0XHRcdHNsaWRlci52aWV3cG9ydC5iaW5kKCd0b3VjaGVuZCBNU1BvaW50ZXJVcCBwb2ludGVydXAnLCBvblRvdWNoRW5kKTtcblx0XHRcdFx0c2xpZGVyLnZpZXdwb3J0LmJpbmQoJ01TUG9pbnRlckNhbmNlbCBwb2ludGVyY2FuY2VsJywgb25Qb2ludGVyQ2FuY2VsKTtcblx0XHRcdH1cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogQ2FuY2VsIFBvaW50ZXIgZm9yIFdpbmRvd3MgUGhvbmVcblx0XHQgKlxuXHRcdCAqIEBwYXJhbSBlIChldmVudClcblx0XHQgKiAgLSBET00gZXZlbnQgb2JqZWN0XG5cdFx0ICovXG5cdFx0dmFyIG9uUG9pbnRlckNhbmNlbCA9IGZ1bmN0aW9uKGUpIHtcblx0XHQvKiBvblBvaW50ZXJDYW5jZWwgaGFuZGxlciBpcyBuZWVkZWQgdG8gZGVhbCB3aXRoIHNpdHVhdGlvbnMgd2hlbiBhIHRvdWNoZW5kXG5cdFx0ZG9lc24ndCBmaXJlIGFmdGVyIGEgdG91Y2hzdGFydCAodGhpcyBoYXBwZW5zIG9uIHdpbmRvd3MgcGhvbmVzIG9ubHkpICovXG5cdFx0XHRzZXRQb3NpdGlvblByb3BlcnR5KHNsaWRlci50b3VjaC5vcmlnaW5hbFBvcy5sZWZ0LCAncmVzZXQnLCAwKTtcblxuXHRcdFx0Ly9yZW1vdmUgaGFuZGxlcnNcblx0XHRcdHNsaWRlci5jb250cm9scy5lbC5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtcblx0XHRcdHNsaWRlci52aWV3cG9ydC51bmJpbmQoJ01TUG9pbnRlckNhbmNlbCBwb2ludGVyY2FuY2VsJywgb25Qb2ludGVyQ2FuY2VsKTtcblx0XHRcdHNsaWRlci52aWV3cG9ydC51bmJpbmQoJ3RvdWNobW92ZSBNU1BvaW50ZXJNb3ZlIHBvaW50ZXJtb3ZlJywgb25Ub3VjaE1vdmUpO1xuXHRcdFx0c2xpZGVyLnZpZXdwb3J0LnVuYmluZCgndG91Y2hlbmQgTVNQb2ludGVyVXAgcG9pbnRlcnVwJywgb25Ub3VjaEVuZCk7XG5cdFx0XHRpZiAoc2xpZGVyLnZpZXdwb3J0LmdldCgwKS5yZWxlYXNlUG9pbnRlckNhcHR1cmUpIHtcblx0XHRcdFx0c2xpZGVyLnZpZXdwb3J0LmdldCgwKS5yZWxlYXNlUG9pbnRlckNhcHR1cmUoc2xpZGVyLnBvaW50ZXJJZCk7XG4gXHRcdFx0fVxuXHRcdH1cblxuXHRcdC8qKlxuXHRcdCAqIEV2ZW50IGhhbmRsZXIgZm9yIFwidG91Y2htb3ZlXCJcblx0XHQgKlxuXHRcdCAqIEBwYXJhbSBlIChldmVudClcblx0XHQgKiAgLSBET00gZXZlbnQgb2JqZWN0XG5cdFx0ICovXG5cdFx0dmFyIG9uVG91Y2hNb3ZlID0gZnVuY3Rpb24oZSl7XG5cdFx0XHR2YXIgb3JpZyA9IGUub3JpZ2luYWxFdmVudDtcblx0XHRcdHZhciB0b3VjaFBvaW50cyA9ICh0eXBlb2Ygb3JpZy5jaGFuZ2VkVG91Y2hlcyAhPSAndW5kZWZpbmVkJykgPyBvcmlnLmNoYW5nZWRUb3VjaGVzIDogW29yaWddO1xuXHRcdFx0Ly8gaWYgc2Nyb2xsaW5nIG9uIHkgYXhpcywgZG8gbm90IHByZXZlbnQgZGVmYXVsdFxuXHRcdFx0dmFyIHhNb3ZlbWVudCA9IE1hdGguYWJzKHRvdWNoUG9pbnRzWzBdLnBhZ2VYIC0gc2xpZGVyLnRvdWNoLnN0YXJ0LngpO1xuXHRcdFx0dmFyIHlNb3ZlbWVudCA9IE1hdGguYWJzKHRvdWNoUG9pbnRzWzBdLnBhZ2VZIC0gc2xpZGVyLnRvdWNoLnN0YXJ0LnkpO1xuXHRcdFx0Ly8geCBheGlzIHN3aXBlXG5cdFx0XHRpZigoeE1vdmVtZW50ICogMykgPiB5TW92ZW1lbnQgJiYgc2xpZGVyLnNldHRpbmdzLnByZXZlbnREZWZhdWx0U3dpcGVYKXtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0Ly8geSBheGlzIHN3aXBlXG5cdFx0XHR9ZWxzZSBpZigoeU1vdmVtZW50ICogMykgPiB4TW92ZW1lbnQgJiYgc2xpZGVyLnNldHRpbmdzLnByZXZlbnREZWZhdWx0U3dpcGVZKXtcblx0XHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0fVxuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLm1vZGUgIT09ICdmYWRlJyAmJiBzbGlkZXIuc2V0dGluZ3Mub25lVG9PbmVUb3VjaCl7XG5cdFx0XHRcdHZhciB2YWx1ZSA9IDAsIGNoYW5nZSA9IDA7XG5cdFx0XHRcdC8vIGlmIGhvcml6b250YWwsIGRyYWcgYWxvbmcgeCBheGlzXG5cdFx0XHRcdGlmKHNsaWRlci5zZXR0aW5ncy5tb2RlID09PSAnaG9yaXpvbnRhbCcpe1xuXHRcdFx0XHRcdGNoYW5nZSA9IHRvdWNoUG9pbnRzWzBdLnBhZ2VYIC0gc2xpZGVyLnRvdWNoLnN0YXJ0Lng7XG5cdFx0XHRcdFx0dmFsdWUgPSBzbGlkZXIudG91Y2gub3JpZ2luYWxQb3MubGVmdCArIGNoYW5nZTtcblx0XHRcdFx0Ly8gaWYgdmVydGljYWwsIGRyYWcgYWxvbmcgeSBheGlzXG5cdFx0XHRcdH1lbHNle1xuXHRcdFx0XHRcdGNoYW5nZSA9IHRvdWNoUG9pbnRzWzBdLnBhZ2VZIC0gc2xpZGVyLnRvdWNoLnN0YXJ0Lnk7XG5cdFx0XHRcdFx0dmFsdWUgPSBzbGlkZXIudG91Y2gub3JpZ2luYWxQb3MudG9wICsgY2hhbmdlO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHNldFBvc2l0aW9uUHJvcGVydHkodmFsdWUsICdyZXNldCcsIDApO1xuXHRcdFx0fVxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBFdmVudCBoYW5kbGVyIGZvciBcInRvdWNoZW5kXCJcblx0XHQgKlxuXHRcdCAqIEBwYXJhbSBlIChldmVudClcblx0XHQgKiAgLSBET00gZXZlbnQgb2JqZWN0XG5cdFx0ICovXG5cdFx0dmFyIG9uVG91Y2hFbmQgPSBmdW5jdGlvbihlKXtcblx0XHRcdHNsaWRlci52aWV3cG9ydC51bmJpbmQoJ3RvdWNobW92ZSBNU1BvaW50ZXJNb3ZlIHBvaW50ZXJtb3ZlJywgb25Ub3VjaE1vdmUpO1xuXHRcdFx0Ly9lbmFibGUgc2xpZGVyIGNvbnRyb2xzIGFzIHNvb24gYXMgdXNlciBzdG9wcyBpbnRlcmFjaW5nIHdpdGggc2xpZGVzXG5cdFx0XHRzbGlkZXIuY29udHJvbHMuZWwucmVtb3ZlQ2xhc3MoJ2Rpc2FibGVkJyk7XG5cdFx0XHR2YXIgb3JpZyA9IGUub3JpZ2luYWxFdmVudDtcblx0XHRcdHZhciB0b3VjaFBvaW50cyA9ICh0eXBlb2Ygb3JpZy5jaGFuZ2VkVG91Y2hlcyAhPSAndW5kZWZpbmVkJykgPyBvcmlnLmNoYW5nZWRUb3VjaGVzIDogW29yaWddO1xuXHRcdFx0dmFyIHZhbHVlID0gMDtcblx0XHRcdHZhciBkaXN0YW5jZSA9IDA7XG5cdFx0XHQvLyByZWNvcmQgZW5kIHgsIHkgcG9zaXRpb25zXG5cdFx0XHRzbGlkZXIudG91Y2guZW5kLnggPSB0b3VjaFBvaW50c1swXS5wYWdlWDtcblx0XHRcdHNsaWRlci50b3VjaC5lbmQueSA9IHRvdWNoUG9pbnRzWzBdLnBhZ2VZO1xuXHRcdFx0Ly8gaWYgZmFkZSBtb2RlLCBjaGVjayBpZiBhYnNvbHV0ZSB4IGRpc3RhbmNlIGNsZWFycyB0aGUgdGhyZXNob2xkXG5cdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MubW9kZSA9PT0gJ2ZhZGUnKXtcblx0XHRcdFx0ZGlzdGFuY2UgPSBNYXRoLmFicyhzbGlkZXIudG91Y2guc3RhcnQueCAtIHNsaWRlci50b3VjaC5lbmQueCk7XG5cdFx0XHRcdGlmKGRpc3RhbmNlID49IHNsaWRlci5zZXR0aW5ncy5zd2lwZVRocmVzaG9sZCl7XG5cdFx0XHRcdFx0aWYoc2xpZGVyLnRvdWNoLnN0YXJ0LnggPiBzbGlkZXIudG91Y2guZW5kLngpe1xuXHRcdFx0XHRcdFx0ZWwuZ29Ub05leHRTbGlkZSgpO1xuXHRcdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0XHRlbC5nb1RvUHJldlNsaWRlKCk7XG5cdFx0XHRcdFx0fSBcblx0XHRcdFx0XHRlbC5zdG9wQXV0bygpO1xuXHRcdFx0XHR9XG5cdFx0XHQvLyBub3QgZmFkZSBtb2RlXG5cdFx0XHR9ZWxzZXtcblx0XHRcdFx0Ly8gY2FsY3VsYXRlIGRpc3RhbmNlIGFuZCBlbCdzIGFuaW1hdGUgcHJvcGVydHlcblx0XHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLm1vZGUgPT09ICdob3Jpem9udGFsJyl7XG5cdFx0XHRcdFx0ZGlzdGFuY2UgPSBzbGlkZXIudG91Y2guZW5kLnggLSBzbGlkZXIudG91Y2guc3RhcnQueDtcblx0XHRcdFx0XHR2YWx1ZSA9IHNsaWRlci50b3VjaC5vcmlnaW5hbFBvcy5sZWZ0O1xuXHRcdFx0XHR9ZWxzZXtcblx0XHRcdFx0XHRkaXN0YW5jZSA9IHNsaWRlci50b3VjaC5lbmQueSAtIHNsaWRlci50b3VjaC5zdGFydC55O1xuXHRcdFx0XHRcdHZhbHVlID0gc2xpZGVyLnRvdWNoLm9yaWdpbmFsUG9zLnRvcDtcblx0XHRcdFx0fVxuXHRcdFx0XHQvLyBpZiBub3QgaW5maW5pdGUgbG9vcCBhbmQgZmlyc3QgLyBsYXN0IHNsaWRlLCBkbyBub3QgYXR0ZW1wdCBhIHNsaWRlIHRyYW5zaXRpb25cblx0XHRcdFx0aWYoIXNsaWRlci5zZXR0aW5ncy5pbmZpbml0ZUxvb3AgJiYgKChzbGlkZXIuYWN0aXZlLmluZGV4ID09PSAwICYmIGRpc3RhbmNlID4gMCkgfHwgKHNsaWRlci5hY3RpdmUubGFzdCAmJiBkaXN0YW5jZSA8IDApKSl7XG5cdFx0XHRcdFx0c2V0UG9zaXRpb25Qcm9wZXJ0eSh2YWx1ZSwgJ3Jlc2V0JywgMjAwKTtcblx0XHRcdFx0fWVsc2V7XG5cdFx0XHRcdFx0Ly8gY2hlY2sgaWYgZGlzdGFuY2UgY2xlYXJzIHRocmVzaG9sZFxuXHRcdFx0XHRcdGlmKE1hdGguYWJzKGRpc3RhbmNlKSA+PSBzbGlkZXIuc2V0dGluZ3Muc3dpcGVUaHJlc2hvbGQpe1xuXHRcdFx0XHRcdFx0aWYoZGlzdGFuY2UgPCAwKXtcblx0XHRcdFx0XHRcdFx0ZWwuZ29Ub05leHRTbGlkZSgpO1xuXHRcdFx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHRcdFx0ZWwuZ29Ub1ByZXZTbGlkZSgpO1xuXHRcdFx0XHRcdFx0fSBcblx0XHRcdFx0XHRcdGVsLnN0b3BBdXRvKCk7XG5cdFx0XHRcdFx0fWVsc2V7XG5cdFx0XHRcdFx0XHQvLyBlbC5hbmltYXRlKHByb3BlcnR5LCAyMDApO1xuXHRcdFx0XHRcdFx0c2V0UG9zaXRpb25Qcm9wZXJ0eSh2YWx1ZSwgJ3Jlc2V0JywgMjAwKTtcblx0XHRcdFx0XHR9XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHRcdHNsaWRlci52aWV3cG9ydC51bmJpbmQoJ3RvdWNoZW5kIE1TUG9pbnRlclVwIHBvaW50ZXJ1cCcsIG9uVG91Y2hFbmQpO1xuXHRcdFx0aWYgKHNsaWRlci52aWV3cG9ydC5nZXQoMCkucmVsZWFzZVBvaW50ZXJDYXB0dXJlKSB7XG5cdFx0XHRcdHNsaWRlci52aWV3cG9ydC5nZXQoMCkucmVsZWFzZVBvaW50ZXJDYXB0dXJlKHNsaWRlci5wb2ludGVySWQpO1xuXHRcdFx0fVxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiBXaW5kb3cgcmVzaXplIGV2ZW50IGNhbGxiYWNrXG5cdFx0ICovXG5cdFx0dmFyIHJlc2l6ZVdpbmRvdyA9IGZ1bmN0aW9uKGUpe1xuXHRcdFx0Ly8gZG9uJ3QgZG8gYW55dGhpbmcgaWYgc2xpZGVyIGlzbid0IGluaXRpYWxpemVkLlxuXHRcdFx0aWYoIXNsaWRlci5pbml0aWFsaXplZCl7IHJldHVybjsgfVxuXHRcdFx0Ly8gRGVsYXkgaWYgc2xpZGVyIHdvcmtpbmcuXG5cdFx0XHRpZiAoc2xpZGVyLndvcmtpbmcpIHtcblx0XHRcdFx0d2luZG93LnNldFRpbWVvdXQocmVzaXplV2luZG93LCAxMCk7XG5cdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHQvLyBnZXQgdGhlIG5ldyB3aW5kb3cgZGltZW5zIChhZ2FpbiwgdGhhbmsgeW91IElFKVxuXHRcdFx0XHR2YXIgd2luZG93V2lkdGhOZXcgPSAkKHdpbmRvdykud2lkdGgoKTtcblx0XHRcdFx0dmFyIHdpbmRvd0hlaWdodE5ldyA9ICQod2luZG93KS5oZWlnaHQoKTtcblx0XHRcdFx0Ly8gbWFrZSBzdXJlIHRoYXQgaXQgaXMgYSB0cnVlIHdpbmRvdyByZXNpemVcblx0XHRcdFx0Ly8gKndlIG11c3QgY2hlY2sgdGhpcyBiZWNhdXNlIG91ciBkaW5vc2F1ciBmcmllbmQgSUUgZmlyZXMgYSB3aW5kb3cgcmVzaXplIGV2ZW50IHdoZW4gY2VydGFpbiBET00gZWxlbWVudHNcblx0XHRcdFx0Ly8gYXJlIHJlc2l6ZWQuIENhbiB5b3UganVzdCBkaWUgYWxyZWFkeT8qXG5cdFx0XHRcdGlmKHdpbmRvd1dpZHRoICE9PSB3aW5kb3dXaWR0aE5ldyB8fCB3aW5kb3dIZWlnaHQgIT09IHdpbmRvd0hlaWdodE5ldyl7XG5cdFx0XHRcdFx0Ly8gc2V0IHRoZSBuZXcgd2luZG93IGRpbWVuc1xuXHRcdFx0XHRcdHdpbmRvd1dpZHRoID0gd2luZG93V2lkdGhOZXc7XG5cdFx0XHRcdFx0d2luZG93SGVpZ2h0ID0gd2luZG93SGVpZ2h0TmV3O1xuXHRcdFx0XHRcdC8vIHVwZGF0ZSBhbGwgZHluYW1pYyBlbGVtZW50c1xuXHRcdFx0XHRcdGVsLnJlZHJhd1NsaWRlcigpO1xuXHRcdFx0XHRcdC8vIENhbGwgdXNlciByZXNpemUgaGFuZGxlclxuXHRcdFx0XHRcdHNsaWRlci5zZXR0aW5ncy5vblNsaWRlclJlc2l6ZS5jYWxsKGVsLCBzbGlkZXIuYWN0aXZlLmluZGV4KTtcblx0XHRcdFx0fVxuXHRcdFx0fVxuXHRcdH07XG5cblx0XHQvKipcblx0XHQgKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXHRcdCAqID0gUFVCTElDIEZVTkNUSU9OU1xuXHRcdCAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cdFx0ICovXG5cblx0XHQvKipcblx0XHQgKiBQZXJmb3JtcyBzbGlkZSB0cmFuc2l0aW9uIHRvIHRoZSBzcGVjaWZpZWQgc2xpZGVcblx0XHQgKlxuXHRcdCAqIEBwYXJhbSBzbGlkZUluZGV4IChpbnQpXG5cdFx0ICogIC0gdGhlIGRlc3RpbmF0aW9uIHNsaWRlJ3MgaW5kZXggKHplcm8tYmFzZWQpXG5cdFx0ICpcblx0XHQgKiBAcGFyYW0gZGlyZWN0aW9uIChzdHJpbmcpXG5cdFx0ICogIC0gSU5URVJOQUwgVVNFIE9OTFkgLSB0aGUgZGlyZWN0aW9uIG9mIHRyYXZlbCAoXCJwcmV2XCIgLyBcIm5leHRcIilcblx0XHQgKi9cblx0XHRlbC5nb1RvU2xpZGUgPSBmdW5jdGlvbihzbGlkZUluZGV4LCBkaXJlY3Rpb24pe1xuXHRcdFx0Ly8gaWYgcGx1Z2luIGlzIGN1cnJlbnRseSBpbiBtb3Rpb24sIGlnbm9yZSByZXF1ZXN0XG5cdFx0XHRpZihzbGlkZXIud29ya2luZyB8fCBzbGlkZXIuYWN0aXZlLmluZGV4ID09PSBzbGlkZUluZGV4KXsgcmV0dXJuOyB9XG5cdFx0XHQvLyBkZWNsYXJlIHRoYXQgcGx1Z2luIGlzIGluIG1vdGlvblxuXHRcdFx0c2xpZGVyLndvcmtpbmcgPSB0cnVlO1xuXHRcdFx0Ly8gc3RvcmUgdGhlIG9sZCBpbmRleFxuXHRcdFx0c2xpZGVyLm9sZEluZGV4ID0gc2xpZGVyLmFjdGl2ZS5pbmRleDtcblx0XHRcdC8vIGlmIHNsaWRlSW5kZXggaXMgbGVzcyB0aGFuIHplcm8sIHNldCBhY3RpdmUgaW5kZXggdG8gbGFzdCBjaGlsZCAodGhpcyBoYXBwZW5zIGR1cmluZyBpbmZpbml0ZSBsb29wKVxuXHRcdFx0aWYoc2xpZGVJbmRleCA8IDApe1xuXHRcdFx0XHRzbGlkZXIuYWN0aXZlLmluZGV4ID0gZ2V0UGFnZXJRdHkoKSAtIDE7XG5cdFx0XHQvLyBpZiBzbGlkZUluZGV4IGlzIGdyZWF0ZXIgdGhhbiBjaGlsZHJlbiBsZW5ndGgsIHNldCBhY3RpdmUgaW5kZXggdG8gMCAodGhpcyBoYXBwZW5zIGR1cmluZyBpbmZpbml0ZSBsb29wKVxuXHRcdFx0fWVsc2UgaWYoc2xpZGVJbmRleCA+PSBnZXRQYWdlclF0eSgpKXtcblx0XHRcdFx0c2xpZGVyLmFjdGl2ZS5pbmRleCA9IDA7XG5cdFx0XHQvLyBzZXQgYWN0aXZlIGluZGV4IHRvIHJlcXVlc3RlZCBzbGlkZVxuXHRcdFx0fWVsc2V7XG5cdFx0XHRcdHNsaWRlci5hY3RpdmUuaW5kZXggPSBzbGlkZUluZGV4O1xuXHRcdFx0fVxuXHRcdFx0Ly8gb25TbGlkZUJlZm9yZSwgb25TbGlkZU5leHQsIG9uU2xpZGVQcmV2IGNhbGxiYWNrc1xuXHRcdFx0Ly8gQWxsb3cgdHJhbnNpdGlvbiBjYW5jZWxpbmcgYmFzZWQgb24gcmV0dXJuZWQgdmFsdWVcblx0XHRcdHZhciBwZXJmb3JtVHJhbnNpdGlvbiA9IHRydWU7XG5cblx0XHRcdHBlcmZvcm1UcmFuc2l0aW9uID0gc2xpZGVyLnNldHRpbmdzLm9uU2xpZGVCZWZvcmUoc2xpZGVyLmNoaWxkcmVuLmVxKHNsaWRlci5hY3RpdmUuaW5kZXgpLCBzbGlkZXIub2xkSW5kZXgsIHNsaWRlci5hY3RpdmUuaW5kZXgpO1xuXHRcdFx0XG5cdFx0XHRpZiAoIHR5cGVvZihwZXJmb3JtVHJhbnNpdGlvbikgIT09IFwidW5kZWZpbmVkXCIgJiYgIXBlcmZvcm1UcmFuc2l0aW9uICkge1xuXHRcdFx0XHRzbGlkZXIuYWN0aXZlLmluZGV4ID0gc2xpZGVyLm9sZEluZGV4OyAvLyByZXN0b3JlIG9sZCBpbmRleFxuXHRcdFx0XHRzbGlkZXIud29ya2luZyA9IGZhbHNlOyAvLyBpcyBub3QgaW4gbW90aW9uXG5cdFx0XHRcdHJldHVybjtcdFxuXHRcdFx0fVxuXHRcdFx0aWYoZGlyZWN0aW9uID09PSAnbmV4dCcpe1xuXHRcdFx0XHQvLyBQcmV2ZW50IGNhbmNlbGluZyBpbiBmdXR1cmUgZnVuY3Rpb25zIG9yIGxhY2sgdGhlcmUtb2YgZnJvbSBuZWdhdGluZyBwcmV2aW91cyBjb21tYW5kcyB0byBjYW5jZWxcblx0XHRcdFx0aWYoIXNsaWRlci5zZXR0aW5ncy5vblNsaWRlTmV4dChzbGlkZXIuY2hpbGRyZW4uZXEoc2xpZGVyLmFjdGl2ZS5pbmRleCksIHNsaWRlci5vbGRJbmRleCwgc2xpZGVyLmFjdGl2ZS5pbmRleCkpe1xuXHRcdFx0XHRcdHBlcmZvcm1UcmFuc2l0aW9uID0gZmFsc2U7XG5cdFx0XHRcdH1cblx0XHRcdH1lbHNlIGlmKGRpcmVjdGlvbiA9PT0gJ3ByZXYnKXtcblx0XHRcdFx0Ly8gUHJldmVudCBjYW5jZWxpbmcgaW4gZnV0dXJlIGZ1bmN0aW9ucyBvciBsYWNrIHRoZXJlLW9mIGZyb20gbmVnYXRpbmcgcHJldmlvdXMgY29tbWFuZHMgdG8gY2FuY2VsXG5cdFx0XHRcdGlmKCFzbGlkZXIuc2V0dGluZ3Mub25TbGlkZVByZXYoc2xpZGVyLmNoaWxkcmVuLmVxKHNsaWRlci5hY3RpdmUuaW5kZXgpLCBzbGlkZXIub2xkSW5kZXgsIHNsaWRlci5hY3RpdmUuaW5kZXgpKXtcblx0XHRcdFx0XHRwZXJmb3JtVHJhbnNpdGlvbiA9IGZhbHNlO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vIElmIHRyYW5zaXRpb25zIGNhbmNlbGVkLCByZXNldCBhbmQgcmV0dXJuXG5cdFx0XHRpZiAoIHR5cGVvZihwZXJmb3JtVHJhbnNpdGlvbikgIT09IFwidW5kZWZpbmVkXCIgJiYgIXBlcmZvcm1UcmFuc2l0aW9uICkge1xuXHRcdFx0XHRzbGlkZXIuYWN0aXZlLmluZGV4ID0gc2xpZGVyLm9sZEluZGV4OyAvLyByZXN0b3JlIG9sZCBpbmRleFxuXHRcdFx0XHRzbGlkZXIud29ya2luZyA9IGZhbHNlOyAvLyBpcyBub3QgaW4gbW90aW9uXG5cdFx0XHRcdHJldHVybjtcdFxuXHRcdFx0fVxuXG5cdFx0XHQvLyBjaGVjayBpZiBsYXN0IHNsaWRlXG5cdFx0XHRzbGlkZXIuYWN0aXZlLmxhc3QgPSBzbGlkZXIuYWN0aXZlLmluZGV4ID49IGdldFBhZ2VyUXR5KCkgLSAxO1xuXHRcdFx0Ly8gdXBkYXRlIHRoZSBwYWdlciB3aXRoIGFjdGl2ZSBjbGFzc1xuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLnBhZ2VyIHx8IHNsaWRlci5zZXR0aW5ncy5wYWdlckN1c3RvbSl7IHVwZGF0ZVBhZ2VyQWN0aXZlKHNsaWRlci5hY3RpdmUuaW5kZXgpOyB9XG5cdFx0XHQvLyAvLyBjaGVjayBmb3IgZGlyZWN0aW9uIGNvbnRyb2wgdXBkYXRlXG5cdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MuY29udHJvbHMpeyB1cGRhdGVEaXJlY3Rpb25Db250cm9scygpOyB9XG5cdFx0XHQvLyBpZiBzbGlkZXIgaXMgc2V0IHRvIG1vZGU6IFwiZmFkZVwiXG5cdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MubW9kZSA9PT0gJ2ZhZGUnKXtcblx0XHRcdFx0Ly8gaWYgYWRhcHRpdmVIZWlnaHQgaXMgdHJ1ZSBhbmQgbmV4dCBoZWlnaHQgaXMgZGlmZmVyZW50IGZyb20gY3VycmVudCBoZWlnaHQsIGFuaW1hdGUgdG8gdGhlIG5ldyBoZWlnaHRcblx0XHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLmFkYXB0aXZlSGVpZ2h0ICYmIHNsaWRlci52aWV3cG9ydC5oZWlnaHQoKSAhPT0gZ2V0Vmlld3BvcnRIZWlnaHQoKSl7XG5cdFx0XHRcdFx0c2xpZGVyLnZpZXdwb3J0LmFuaW1hdGUoe2hlaWdodDogZ2V0Vmlld3BvcnRIZWlnaHQoKX0sIHNsaWRlci5zZXR0aW5ncy5hZGFwdGl2ZUhlaWdodFNwZWVkKTtcblx0XHRcdFx0fVxuXHRcdFx0XHQvLyBmYWRlIG91dCB0aGUgdmlzaWJsZSBjaGlsZCBhbmQgcmVzZXQgaXRzIHotaW5kZXggdmFsdWVcblx0XHRcdFx0c2xpZGVyLmNoaWxkcmVuLmZpbHRlcignOnZpc2libGUnKS5mYWRlT3V0KHNsaWRlci5zZXR0aW5ncy5zcGVlZCkuY3NzKHt6SW5kZXg6IDB9KTtcblx0XHRcdFx0Ly8gZmFkZSBpbiB0aGUgbmV3bHkgcmVxdWVzdGVkIHNsaWRlXG5cdFx0XHRcdHNsaWRlci5jaGlsZHJlbi5lcShzbGlkZXIuYWN0aXZlLmluZGV4KS5jc3MoJ3pJbmRleCcsIHNsaWRlci5zZXR0aW5ncy5zbGlkZVpJbmRleCsxKS5mYWRlSW4oc2xpZGVyLnNldHRpbmdzLnNwZWVkLCBmdW5jdGlvbigpe1xuXHRcdFx0XHRcdCQodGhpcykuY3NzKCd6SW5kZXgnLCBzbGlkZXIuc2V0dGluZ3Muc2xpZGVaSW5kZXgpO1xuXHRcdFx0XHRcdHVwZGF0ZUFmdGVyU2xpZGVUcmFuc2l0aW9uKCk7XG5cdFx0XHRcdH0pO1xuXHRcdFx0Ly8gc2xpZGVyIG1vZGUgaXMgbm90IFwiZmFkZVwiXG5cdFx0XHR9ZWxzZXtcblx0XHRcdFx0Ly8gaWYgYWRhcHRpdmVIZWlnaHQgaXMgdHJ1ZSBhbmQgbmV4dCBoZWlnaHQgaXMgZGlmZmVyZW50IGZyb20gY3VycmVudCBoZWlnaHQsIGFuaW1hdGUgdG8gdGhlIG5ldyBoZWlnaHRcblx0XHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLmFkYXB0aXZlSGVpZ2h0ICYmIHNsaWRlci52aWV3cG9ydC5oZWlnaHQoKSAhPT0gZ2V0Vmlld3BvcnRIZWlnaHQoKSl7XG5cdFx0XHRcdFx0c2xpZGVyLnZpZXdwb3J0LmFuaW1hdGUoe2hlaWdodDogZ2V0Vmlld3BvcnRIZWlnaHQoKX0sIHNsaWRlci5zZXR0aW5ncy5hZGFwdGl2ZUhlaWdodFNwZWVkKTtcblx0XHRcdFx0fVxuXHRcdFx0XHR2YXIgbW92ZUJ5ID0gMDtcblx0XHRcdFx0dmFyIHBvc2l0aW9uID0ge2xlZnQ6IDAsIHRvcDogMH07XG5cdFx0XHRcdHZhciBsYXN0Q2hpbGQgPSBudWxsO1xuXHRcdFx0XHQvLyBpZiBjYXJvdXNlbCBhbmQgbm90IGluZmluaXRlIGxvb3Bcblx0XHRcdFx0aWYoIXNsaWRlci5zZXR0aW5ncy5pbmZpbml0ZUxvb3AgJiYgc2xpZGVyLmNhcm91c2VsICYmIHNsaWRlci5hY3RpdmUubGFzdCl7XG5cdFx0XHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLm1vZGUgPT09ICdob3Jpem9udGFsJyl7XG5cdFx0XHRcdFx0XHQvLyBnZXQgdGhlIGxhc3QgY2hpbGQgcG9zaXRpb25cblx0XHRcdFx0XHRcdGxhc3RDaGlsZCA9IHNsaWRlci5jaGlsZHJlbi5lcShzbGlkZXIuY2hpbGRyZW4ubGVuZ3RoIC0gMSk7XG5cdFx0XHRcdFx0XHRwb3NpdGlvbiA9IGxhc3RDaGlsZC5wb3NpdGlvbigpO1xuXHRcdFx0XHRcdFx0Ly8gY2FsY3VsYXRlIHRoZSBwb3NpdGlvbiBvZiB0aGUgbGFzdCBzbGlkZVxuXHRcdFx0XHRcdFx0bW92ZUJ5ID0gc2xpZGVyLnZpZXdwb3J0LndpZHRoKCkgLSBsYXN0Q2hpbGQub3V0ZXJXaWR0aCgpO1xuXHRcdFx0XHRcdH1lbHNle1xuXHRcdFx0XHRcdFx0Ly8gZ2V0IGxhc3Qgc2hvd2luZyBpbmRleCBwb3NpdGlvblxuXHRcdFx0XHRcdFx0dmFyIGxhc3RTaG93aW5nSW5kZXggPSBzbGlkZXIuY2hpbGRyZW4ubGVuZ3RoIC0gc2xpZGVyLnNldHRpbmdzLm1pblNsaWRlcztcblx0XHRcdFx0XHRcdHBvc2l0aW9uID0gc2xpZGVyLmNoaWxkcmVuLmVxKGxhc3RTaG93aW5nSW5kZXgpLnBvc2l0aW9uKCk7XG5cdFx0XHRcdFx0fVxuXHRcdFx0XHRcdC8vIGhvcml6b250YWwgY2Fyb3VzZWwsIGdvaW5nIHByZXZpb3VzIHdoaWxlIG9uIGZpcnN0IHNsaWRlIChpbmZpbml0ZUxvb3AgbW9kZSlcblx0XHRcdFx0fWVsc2UgaWYoc2xpZGVyLmNhcm91c2VsICYmIHNsaWRlci5hY3RpdmUubGFzdCAmJiBkaXJlY3Rpb24gPT09ICdwcmV2Jyl7XG5cdFx0XHRcdFx0Ly8gZ2V0IHRoZSBsYXN0IGNoaWxkIHBvc2l0aW9uXG5cdFx0XHRcdFx0dmFyIGVxID0gc2xpZGVyLnNldHRpbmdzLm1vdmVTbGlkZXMgPT09IDEgPyBzbGlkZXIuc2V0dGluZ3MubWF4U2xpZGVzIC0gZ2V0TW92ZUJ5KCkgOiAoKGdldFBhZ2VyUXR5KCkgLSAxKSAqIGdldE1vdmVCeSgpKSAtIChzbGlkZXIuY2hpbGRyZW4ubGVuZ3RoIC0gc2xpZGVyLnNldHRpbmdzLm1heFNsaWRlcyk7XG5cdFx0XHRcdFx0bGFzdENoaWxkID0gZWwuY2hpbGRyZW4oJy5ieC1jbG9uZScpLmVxKGVxKTtcblx0XHRcdFx0XHRwb3NpdGlvbiA9IGxhc3RDaGlsZC5wb3NpdGlvbigpO1xuXHRcdFx0XHQvLyBpZiBpbmZpbml0ZSBsb29wIGFuZCBcIk5leHRcIiBpcyBjbGlja2VkIG9uIHRoZSBsYXN0IHNsaWRlXG5cdFx0XHRcdH1lbHNlIGlmKGRpcmVjdGlvbiA9PT0gJ25leHQnICYmIHNsaWRlci5hY3RpdmUuaW5kZXggPT09IDApe1xuXHRcdFx0XHRcdC8vIGdldCB0aGUgbGFzdCBjbG9uZSBwb3NpdGlvblxuXHRcdFx0XHRcdHBvc2l0aW9uID0gZWwuZmluZCgnPiAuYngtY2xvbmUnKS5lcShzbGlkZXIuc2V0dGluZ3MubWF4U2xpZGVzKS5wb3NpdGlvbigpO1xuXHRcdFx0XHRcdHNsaWRlci5hY3RpdmUubGFzdCA9IGZhbHNlO1xuXHRcdFx0XHQvLyBub3JtYWwgbm9uLXplcm8gcmVxdWVzdHNcblx0XHRcdFx0fWVsc2UgaWYoc2xpZGVJbmRleCA+PSAwKXtcblx0XHRcdFx0XHR2YXIgcmVxdWVzdEVsID0gc2xpZGVJbmRleCAqIGdldE1vdmVCeSgpO1xuXHRcdFx0XHRcdHBvc2l0aW9uID0gc2xpZGVyLmNoaWxkcmVuLmVxKHJlcXVlc3RFbCkucG9zaXRpb24oKTtcblx0XHRcdFx0fVxuXG5cdFx0XHRcdFxuXHRcdFx0XHQvKiBJZiB0aGUgcG9zaXRpb24gZG9lc24ndCBleGlzdFxuXHRcdFx0XHQgKiAoZS5nLiBpZiB5b3UgZGVzdHJveSB0aGUgc2xpZGVyIG9uIGEgbmV4dCBjbGljayksXG5cdFx0XHRcdCAqIGl0IGRvZXNuJ3QgdGhyb3cgYW4gZXJyb3IuXG5cdFx0XHRcdCAqL1xuXHRcdFx0XHRpZihcInVuZGVmaW5lZFwiICE9PSB0eXBlb2YocG9zaXRpb24pKXtcblx0XHRcdFx0XHR2YXIgdmFsdWUgPSBzbGlkZXIuc2V0dGluZ3MubW9kZSA9PT0gJ2hvcml6b250YWwnID8gLShwb3NpdGlvbi5sZWZ0IC0gbW92ZUJ5KSA6IC1wb3NpdGlvbi50b3A7XG5cdFx0XHRcdFx0Ly8gcGx1Z2luIHZhbHVlcyB0byBiZSBhbmltYXRlZFxuXHRcdFx0XHRcdHNldFBvc2l0aW9uUHJvcGVydHkodmFsdWUsICdzbGlkZScsIHNsaWRlci5zZXR0aW5ncy5zcGVlZCk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogVHJhbnNpdGlvbnMgdG8gdGhlIG5leHQgc2xpZGUgaW4gdGhlIHNob3dcblx0XHQgKi9cblx0XHRlbC5nb1RvTmV4dFNsaWRlID0gZnVuY3Rpb24oKXtcblx0XHRcdC8vIGlmIGluZmluaXRlTG9vcCBpcyBmYWxzZSBhbmQgbGFzdCBwYWdlIGlzIHNob3dpbmcsIGRpc3JlZ2FyZCBjYWxsXG5cdFx0XHRpZighc2xpZGVyLnNldHRpbmdzLmluZmluaXRlTG9vcCAmJiBzbGlkZXIuYWN0aXZlLmxhc3QpeyByZXR1cm47IH1cblx0XHRcdHZhciBwYWdlckluZGV4ID0gcGFyc2VJbnQoc2xpZGVyLmFjdGl2ZS5pbmRleCkgKyAxO1xuXHRcdFx0ZWwuZ29Ub1NsaWRlKHBhZ2VySW5kZXgsICduZXh0Jyk7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIFRyYW5zaXRpb25zIHRvIHRoZSBwcmV2IHNsaWRlIGluIHRoZSBzaG93XG5cdFx0ICovXG5cdFx0ZWwuZ29Ub1ByZXZTbGlkZSA9IGZ1bmN0aW9uKCl7XG5cdFx0XHQvLyBpZiBpbmZpbml0ZUxvb3AgaXMgZmFsc2UgYW5kIGxhc3QgcGFnZSBpcyBzaG93aW5nLCBkaXNyZWdhcmQgY2FsbFxuXHRcdFx0aWYoIXNsaWRlci5zZXR0aW5ncy5pbmZpbml0ZUxvb3AgJiYgc2xpZGVyLmFjdGl2ZS5pbmRleCA9PT0gMCl7IHJldHVybjsgfVxuXHRcdFx0dmFyIHBhZ2VySW5kZXggPSBwYXJzZUludChzbGlkZXIuYWN0aXZlLmluZGV4KSAtIDE7XG5cdFx0XHRlbC5nb1RvU2xpZGUocGFnZXJJbmRleCwgJ3ByZXYnKTtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogU3RhcnRzIHRoZSBhdXRvIHNob3dcblx0XHQgKlxuXHRcdCAqIEBwYXJhbSBwcmV2ZW50Q29udHJvbFVwZGF0ZSAoYm9vbGVhbilcblx0XHQgKiAgLSBpZiB0cnVlLCBhdXRvIGNvbnRyb2xzIHN0YXRlIHdpbGwgbm90IGJlIHVwZGF0ZWRcblx0XHQgKi9cblx0XHRlbC5zdGFydEF1dG8gPSBmdW5jdGlvbihwcmV2ZW50Q29udHJvbFVwZGF0ZSl7XG5cdFx0XHQvLyBpZiBhbiBpbnRlcnZhbCBhbHJlYWR5IGV4aXN0cywgZGlzcmVnYXJkIGNhbGxcblx0XHRcdGlmKHNsaWRlci5pbnRlcnZhbCl7IHJldHVybjsgfVxuXHRcdFx0Ly8gY3JlYXRlIGFuIGludGVydmFsXG5cdFx0XHRzbGlkZXIuaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbChmdW5jdGlvbigpe1xuXHRcdFx0XHRpZihzbGlkZXIuc2V0dGluZ3MuYXV0b0RpcmVjdGlvbiA9PT0gJ25leHQnKXsgXG5cdFx0XHRcdFx0ZWwuZ29Ub05leHRTbGlkZSgpOyBcblx0XHRcdFx0fWVsc2V7XG5cdFx0XHRcdFx0ZWwuZ29Ub1ByZXZTbGlkZSgpO1xuXHRcdFx0XHR9XG5cdFx0XHR9LCBzbGlkZXIuc2V0dGluZ3MucGF1c2UpO1xuXHRcdFx0Ly8gaWYgYXV0byBjb250cm9scyBhcmUgZGlzcGxheWVkIGFuZCBwcmV2ZW50Q29udHJvbFVwZGF0ZSBpcyBub3QgdHJ1ZVxuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLmF1dG9Db250cm9scyAmJiBwcmV2ZW50Q29udHJvbFVwZGF0ZSAhPT0gdHJ1ZSl7IHVwZGF0ZUF1dG9Db250cm9scygnc3RvcCcpOyB9XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIFN0b3BzIHRoZSBhdXRvIHNob3dcblx0XHQgKlxuXHRcdCAqIEBwYXJhbSBwcmV2ZW50Q29udHJvbFVwZGF0ZSAoYm9vbGVhbilcblx0XHQgKiAgLSBpZiB0cnVlLCBhdXRvIGNvbnRyb2xzIHN0YXRlIHdpbGwgbm90IGJlIHVwZGF0ZWRcblx0XHQgKi9cblx0XHRlbC5zdG9wQXV0byA9IGZ1bmN0aW9uKHByZXZlbnRDb250cm9sVXBkYXRlKXtcblx0XHRcdC8vIGlmIG5vIGludGVydmFsIGV4aXN0cywgZGlzcmVnYXJkIGNhbGxcblx0XHRcdGlmKCFzbGlkZXIuaW50ZXJ2YWwpeyByZXR1cm47IH1cblx0XHRcdC8vIGNsZWFyIHRoZSBpbnRlcnZhbFxuXHRcdFx0Y2xlYXJJbnRlcnZhbChzbGlkZXIuaW50ZXJ2YWwpO1xuXHRcdFx0c2xpZGVyLmludGVydmFsID0gbnVsbDtcblx0XHRcdC8vIGlmIGF1dG8gY29udHJvbHMgYXJlIGRpc3BsYXllZCBhbmQgcHJldmVudENvbnRyb2xVcGRhdGUgaXMgbm90IHRydWVcblx0XHRcdGlmKHNsaWRlci5zZXR0aW5ncy5hdXRvQ29udHJvbHMgJiYgcHJldmVudENvbnRyb2xVcGRhdGUgIT09IHRydWUpeyB1cGRhdGVBdXRvQ29udHJvbHMoJ3N0YXJ0Jyk7IH1cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyBjdXJyZW50IHNsaWRlIGluZGV4ICh6ZXJvLWJhc2VkKVxuXHRcdCAqL1xuXHRcdGVsLmdldEN1cnJlbnRTbGlkZSA9IGZ1bmN0aW9uKCl7XG5cdFx0XHRyZXR1cm4gc2xpZGVyLmFjdGl2ZS5pbmRleDtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJucyBjdXJyZW50IHNsaWRlIGVsZW1lbnRcblx0XHQgKi9cblx0XHRlbC5nZXRDdXJyZW50U2xpZGVFbGVtZW50ID0gZnVuY3Rpb24oKXtcblx0XHRcdHJldHVybiBzbGlkZXIuY2hpbGRyZW4uZXEoc2xpZGVyLmFjdGl2ZS5pbmRleCk7XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIFJldHVybnMgbnVtYmVyIG9mIHNsaWRlcyBpbiBzaG93XG5cdFx0ICovXG5cdFx0ZWwuZ2V0U2xpZGVDb3VudCA9IGZ1bmN0aW9uKCl7XG5cdFx0XHRyZXR1cm4gc2xpZGVyLmNoaWxkcmVuLmxlbmd0aDtcblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogUmV0dXJuIHNsaWRlci53b3JraW5nIHZhcmlhYmxlXG5cdFx0ICovXG5cdFx0ZWwuaXNXb3JraW5nID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRyZXR1cm4gc2xpZGVyLndvcmtpbmc7XG5cdFx0fVxuXG5cdFx0LyoqXG5cdFx0ICogVXBkYXRlIGFsbCBkeW5hbWljIHNsaWRlciBlbGVtZW50c1xuXHRcdCAqL1xuXHRcdGVsLnJlZHJhd1NsaWRlciA9IGZ1bmN0aW9uKCl7XG5cdFx0XHQvLyByZXNpemUgYWxsIGNoaWxkcmVuIGluIHJhdGlvIHRvIG5ldyBzY3JlZW4gc2l6ZVxuXHRcdFx0c2xpZGVyLmNoaWxkcmVuLmFkZChlbC5maW5kKCcuYngtY2xvbmUnKSkub3V0ZXJXaWR0aChnZXRTbGlkZVdpZHRoKCkpO1xuXHRcdFx0Ly8gYWRqdXN0IHRoZSBoZWlnaHRcblx0XHRcdHNsaWRlci52aWV3cG9ydC5jc3MoJ2hlaWdodCcsIGdldFZpZXdwb3J0SGVpZ2h0KCkpO1xuXHRcdFx0Ly8gdXBkYXRlIHRoZSBzbGlkZSBwb3NpdGlvblxuXHRcdFx0aWYoIXNsaWRlci5zZXR0aW5ncy50aWNrZXIpIHsgc2V0U2xpZGVQb3NpdGlvbigpOyB9ICAgICAgICAgICAgICAgICBcblx0XHRcdC8vIGlmIGFjdGl2ZS5sYXN0IHdhcyB0cnVlIGJlZm9yZSB0aGUgc2NyZWVuIHJlc2l6ZSwgd2Ugd2FudFxuXHRcdFx0Ly8gdG8ga2VlcCBpdCBsYXN0IG5vIG1hdHRlciB3aGF0IHNjcmVlbiBzaXplIHdlIGVuZCBvblxuXHRcdFx0aWYgKHNsaWRlci5hY3RpdmUubGFzdCkgeyBzbGlkZXIuYWN0aXZlLmluZGV4ID0gZ2V0UGFnZXJRdHkoKSAtIDE7IH1cblx0XHRcdC8vIGlmIHRoZSBhY3RpdmUgaW5kZXggKHBhZ2UpIG5vIGxvbmdlciBleGlzdHMgZHVlIHRvIHRoZSByZXNpemUsIHNpbXBseSBzZXQgdGhlIGluZGV4IGFzIGxhc3Rcblx0XHRcdGlmIChzbGlkZXIuYWN0aXZlLmluZGV4ID49IGdldFBhZ2VyUXR5KCkpIHsgc2xpZGVyLmFjdGl2ZS5sYXN0ID0gdHJ1ZTsgfVxuXHRcdFx0Ly8gaWYgYSBwYWdlciBpcyBiZWluZyBkaXNwbGF5ZWQgYW5kIGEgY3VzdG9tIHBhZ2VyIGlzIG5vdCBiZWluZyB1c2VkLCB1cGRhdGUgaXRcblx0XHRcdGlmKHNsaWRlci5zZXR0aW5ncy5wYWdlciAmJiAhc2xpZGVyLnNldHRpbmdzLnBhZ2VyQ3VzdG9tKXtcblx0XHRcdFx0cG9wdWxhdGVQYWdlcigpO1xuXHRcdFx0XHR1cGRhdGVQYWdlckFjdGl2ZShzbGlkZXIuYWN0aXZlLmluZGV4KTtcblx0XHRcdH1cblx0XHR9O1xuXG5cdFx0LyoqXG5cdFx0ICogRGVzdHJveSB0aGUgY3VycmVudCBpbnN0YW5jZSBvZiB0aGUgc2xpZGVyIChyZXZlcnQgZXZlcnl0aGluZyBiYWNrIHRvIG9yaWdpbmFsIHN0YXRlKVxuXHRcdCAqL1xuXHRcdGVsLmRlc3Ryb3lTbGlkZXIgPSBmdW5jdGlvbigpe1xuXHRcdFx0Ly8gZG9uJ3QgZG8gYW55dGhpbmcgaWYgc2xpZGVyIGhhcyBhbHJlYWR5IGJlZW4gZGVzdHJveWVkXG5cdFx0XHRpZighc2xpZGVyLmluaXRpYWxpemVkKXsgcmV0dXJuOyB9XG5cdFx0XHRzbGlkZXIuaW5pdGlhbGl6ZWQgPSBmYWxzZTtcblx0XHRcdCQoJy5ieC1jbG9uZScsIHRoaXMpLnJlbW92ZSgpO1xuXHRcdFx0c2xpZGVyLmNoaWxkcmVuLmVhY2goZnVuY3Rpb24oKXtcblx0XHRcdFx0aWYoJCh0aGlzKS5kYXRhKFwib3JpZ1N0eWxlXCIpICE9PSB1bmRlZmluZWQpe1xuXHRcdFx0XHRcdCQodGhpcykuYXR0cihcInN0eWxlXCIsICQodGhpcykuZGF0YShcIm9yaWdTdHlsZVwiKSk7XG5cdFx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdFx0JCh0aGlzKS5yZW1vdmVBdHRyKCdzdHlsZScpO1xuXHRcdFx0XHR9XG5cdFx0XHR9KTtcblx0XHRcdGlmKCQodGhpcykuZGF0YShcIm9yaWdTdHlsZVwiKSAhPT0gdW5kZWZpbmVkKXtcblx0XHRcdFx0dGhpcy5hdHRyKFwic3R5bGVcIiwgJCh0aGlzKS5kYXRhKFwib3JpZ1N0eWxlXCIpKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCQodGhpcykucmVtb3ZlQXR0cignc3R5bGUnKTtcblx0XHRcdH1cblx0XHRcdCQodGhpcykudW53cmFwKCkudW53cmFwKCk7XG5cdFx0XHRpZihzbGlkZXIuY29udHJvbHMuZWwpeyBzbGlkZXIuY29udHJvbHMuZWwucmVtb3ZlKCk7IH1cblx0XHRcdGlmKHNsaWRlci5jb250cm9scy5uZXh0KXsgc2xpZGVyLmNvbnRyb2xzLm5leHQucmVtb3ZlKCk7IH1cblx0XHRcdGlmKHNsaWRlci5jb250cm9scy5wcmV2KXsgc2xpZGVyLmNvbnRyb2xzLnByZXYucmVtb3ZlKCk7IH1cblx0XHRcdGlmKHNsaWRlci5wYWdlckVsICYmIHNsaWRlci5zZXR0aW5ncy5jb250cm9scyAmJiAhc2xpZGVyLnNldHRpbmdzLnBhZ2VyQ3VzdG9tKXsgc2xpZGVyLnBhZ2VyRWwucmVtb3ZlKCk7IH1cblx0XHRcdCQoJy5ieC1jYXB0aW9uJywgdGhpcykucmVtb3ZlKCk7XG5cdFx0XHRpZihzbGlkZXIuY29udHJvbHMuYXV0b0VsKXsgc2xpZGVyLmNvbnRyb2xzLmF1dG9FbC5yZW1vdmUoKTsgfVxuXHRcdFx0Y2xlYXJJbnRlcnZhbChzbGlkZXIuaW50ZXJ2YWwpO1xuXHRcdFx0aWYoc2xpZGVyLnNldHRpbmdzLnJlc3BvbnNpdmUpeyAkKHdpbmRvdykudW5iaW5kKCdyZXNpemUnLCByZXNpemVXaW5kb3cpOyB9XG5cdFx0XHRpZihzbGlkZXIuc2V0dGluZ3Mua2V5Ym9hcmRFbmFibGVkKXsgJChkb2N1bWVudCkudW5iaW5kKCdrZXlkb3duJywga2V5UHJlc3MpOyB9XG5cdFx0fTtcblxuXHRcdC8qKlxuXHRcdCAqIFJlbG9hZCB0aGUgc2xpZGVyIChyZXZlcnQgYWxsIERPTSBjaGFuZ2VzLCBhbmQgcmUtaW5pdGlhbGl6ZSlcblx0XHQgKi9cblx0XHRlbC5yZWxvYWRTbGlkZXIgPSBmdW5jdGlvbihzZXR0aW5ncyl7XG5cdFx0XHRpZihzZXR0aW5ncyAhPT0gdW5kZWZpbmVkKXsgb3B0aW9ucyA9IHNldHRpbmdzOyB9XG5cdFx0XHRlbC5kZXN0cm95U2xpZGVyKCk7XG5cdFx0XHRpbml0KCk7XG5cdFx0fTtcblxuXHRcdGluaXQoKTtcblxuXHRcdC8vIHJldHVybnMgdGhlIGN1cnJlbnQgalF1ZXJ5IG9iamVjdFxuXHRcdHJldHVybiB0aGlzO1xuXHR9O1xuXG59KShqUXVlcnkpO1xuIiwiKGZ1bmN0aW9uKGUpe2UuZm4uZGRzbGljaz1mdW5jdGlvbihsKXtpZihjW2xdKXtyZXR1cm4gY1tsXS5hcHBseSh0aGlzLEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKGFyZ3VtZW50cywxKSl9ZWxzZXtpZih0eXBlb2YgbD09PVwib2JqZWN0XCJ8fCFsKXtyZXR1cm4gYy5pbml0LmFwcGx5KHRoaXMsYXJndW1lbnRzKX1lbHNle2UuZXJyb3IoXCJNZXRob2QgXCIrbCtcIiBkb2VzIG5vdCBleGlzdHMuXCIpfX19O3ZhciBjPXt9LGQ9e2RhdGE6W10sa2VlcEpTT05JdGVtc09uVG9wOmZhbHNlLHdpZHRoOjI2MCxoZWlnaHQ6bnVsbCxiYWNrZ3JvdW5kOlwiI2VlZVwiLHNlbGVjdFRleHQ6XCJcIixkZWZhdWx0U2VsZWN0ZWRJbmRleDpudWxsLHRydW5jYXRlRGVzY3JpcHRpb246dHJ1ZSxpbWFnZVBvc2l0aW9uOlwibGVmdFwiLHNob3dTZWxlY3RlZEhUTUw6dHJ1ZSxjbGlja09mZlRvQ2xvc2U6dHJ1ZSxlbWJlZENTUzp0cnVlLG9uU2VsZWN0ZWQ6ZnVuY3Rpb24oKXt9fSxpPSc8ZGl2IGNsYXNzPVwiZGQtc2VsZWN0XCI+PGlucHV0IGNsYXNzPVwiZGQtc2VsZWN0ZWQtdmFsdWVcIiB0eXBlPVwiaGlkZGVuXCIgLz48YSBjbGFzcz1cImRkLXNlbGVjdGVkXCI+PC9hPjxzcGFuIGNsYXNzPVwiZGQtcG9pbnRlciBkZC1wb2ludGVyLWRvd25cIj48L3NwYW4+PC9kaXY+JyxhPSc8dWwgY2xhc3M9XCJkZC1vcHRpb25zXCI+PC91bD4nLGI9JzxzdHlsZSBpZD1cImNzcy1kZHNsaWNrXCIgdHlwZT1cInRleHQvY3NzXCI+LmRkLXNlbGVjdHsgYm9yZGVyLXJhZGl1czoycHg7IGJvcmRlcjpzb2xpZCAxcHggI2NjYzsgcG9zaXRpb246cmVsYXRpdmU7IGN1cnNvcjpwb2ludGVyO30uZGQtZGVzYyB7IGNvbG9yOiNhYWE7IGRpc3BsYXk6YmxvY2s7IG92ZXJmbG93OiBoaWRkZW47IGZvbnQtd2VpZ2h0Om5vcm1hbDsgbGluZS1oZWlnaHQ6IDEuNGVtOyB9LmRkLXNlbGVjdGVkeyBvdmVyZmxvdzpoaWRkZW47IGRpc3BsYXk6YmxvY2s7IHBhZGRpbmc6MTBweDsgZm9udC13ZWlnaHQ6Ym9sZDt9LmRkLXBvaW50ZXJ7IHdpZHRoOjA7IGhlaWdodDowOyBwb3NpdGlvbjphYnNvbHV0ZTsgcmlnaHQ6MTBweDsgdG9wOjUwJTsgbWFyZ2luLXRvcDotM3B4O30uZGQtcG9pbnRlci1kb3dueyBib3JkZXI6c29saWQgNXB4IHRyYW5zcGFyZW50OyBib3JkZXItdG9wOnNvbGlkIDVweCAjMDAwOyB9LmRkLXBvaW50ZXItdXB7Ym9yZGVyOnNvbGlkIDVweCB0cmFuc3BhcmVudCAhaW1wb3J0YW50OyBib3JkZXItYm90dG9tOnNvbGlkIDVweCAjMDAwICFpbXBvcnRhbnQ7IG1hcmdpbi10b3A6LThweDt9LmRkLW9wdGlvbnN7IGJvcmRlcjpzb2xpZCAxcHggI2NjYzsgYm9yZGVyLXRvcDpub25lOyBsaXN0LXN0eWxlOm5vbmU7IGJveC1zaGFkb3c6MHB4IDFweCA1cHggI2RkZDsgZGlzcGxheTpub25lOyBwb3NpdGlvbjphYnNvbHV0ZTsgei1pbmRleDoyMDAwOyBtYXJnaW46MDsgcGFkZGluZzowO2JhY2tncm91bmQ6I2ZmZjsgb3ZlcmZsb3c6YXV0bzt9LmRkLW9wdGlvbnsgcGFkZGluZzoxMHB4OyBkaXNwbGF5OmJsb2NrOyBib3JkZXItYm90dG9tOnNvbGlkIDFweCAjZGRkOyBvdmVyZmxvdzpoaWRkZW47IHRleHQtZGVjb3JhdGlvbjpub25lOyBjb2xvcjojMzMzOyBjdXJzb3I6cG9pbnRlcjstd2Via2l0LXRyYW5zaXRpb246IGFsbCAwLjI1cyBlYXNlLWluLW91dDsgLW1vei10cmFuc2l0aW9uOiBhbGwgMC4yNXMgZWFzZS1pbi1vdXQ7LW8tdHJhbnNpdGlvbjogYWxsIDAuMjVzIGVhc2UtaW4tb3V0Oy1tcy10cmFuc2l0aW9uOiBhbGwgMC4yNXMgZWFzZS1pbi1vdXQ7IH0uZGQtb3B0aW9ucyA+IGxpOmxhc3QtY2hpbGQgPiAuZGQtb3B0aW9ueyBib3JkZXItYm90dG9tOm5vbmU7fS5kZC1vcHRpb246aG92ZXJ7IGJhY2tncm91bmQ6I2YzZjNmMzsgY29sb3I6IzAwMDt9LmRkLXNlbGVjdGVkLWRlc2NyaXB0aW9uLXRydW5jYXRlZCB7IHRleHQtb3ZlcmZsb3c6IGVsbGlwc2lzOyB3aGl0ZS1zcGFjZTpub3dyYXA7IH0uZGQtb3B0aW9uLXNlbGVjdGVkIHsgYmFja2dyb3VuZDojZjZmNmY2OyB9LmRkLW9wdGlvbi1pbWFnZSwgLmRkLXNlbGVjdGVkLWltYWdlIHsgdmVydGljYWwtYWxpZ246bWlkZGxlOyBmbG9hdDpsZWZ0OyBtYXJnaW4tcmlnaHQ6NXB4OyBtYXgtd2lkdGg6NjRweDt9LmRkLWltYWdlLXJpZ2h0IHsgZmxvYXQ6cmlnaHQ7IG1hcmdpbi1yaWdodDoxNXB4OyBtYXJnaW4tbGVmdDo1cHg7fS5kZC1jb250YWluZXJ7IHBvc2l0aW9uOnJlbGF0aXZlO33igIsgLmRkLXNlbGVjdGVkLXRleHQgeyBmb250LXdlaWdodDpib2xkfeKAizwvc3R5bGU+JztjLmluaXQ9ZnVuY3Rpb24obCl7dmFyIGw9ZS5leHRlbmQoe30sZCxsKTtpZihlKFwiI2Nzcy1kZHNsaWNrXCIpLmxlbmd0aDw9MCYmbC5lbWJlZENTUyl7ZShiKS5hcHBlbmRUbyhcImhlYWRcIil9cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBwPWUodGhpcykscT1wLmRhdGEoXCJkZHNsaWNrXCIpO2lmKCFxKXt2YXIgbj1bXSxvPWwuZGF0YTtwLmZpbmQoXCJvcHRpb25cIikuZWFjaChmdW5jdGlvbigpe3ZhciB3PWUodGhpcyksdj13LmRhdGEoKTtuLnB1c2goe3RleHQ6ZS50cmltKHcudGV4dCgpKSx2YWx1ZTp3LnZhbCgpLHNlbGVjdGVkOncuaXMoXCI6c2VsZWN0ZWRcIiksZGVzY3JpcHRpb246di5kZXNjcmlwdGlvbixpbWFnZVNyYzp2LmltYWdlc3JjfSl9KTtpZihsLmtlZXBKU09OSXRlbXNPblRvcCl7ZS5tZXJnZShsLmRhdGEsbil9ZWxzZXtsLmRhdGE9ZS5tZXJnZShuLGwuZGF0YSl9dmFyIG09cCxzPWUoJzxkaXYgaWQ9XCInK3AuYXR0cihcImlkXCIpKydcIj48L2Rpdj4nKTtwLnJlcGxhY2VXaXRoKHMpO3A9cztwLmFkZENsYXNzKFwiZGQtY29udGFpbmVyXCIpLmFwcGVuZChpKS5hcHBlbmQoYSk7dmFyIG49cC5maW5kKFwiLmRkLXNlbGVjdFwiKSx1PXAuZmluZChcIi5kZC1vcHRpb25zXCIpO3UuY3NzKHt3aWR0aDpsLndpZHRofSk7bi5jc3Moe3dpZHRoOmwud2lkdGgsYmFja2dyb3VuZDpsLmJhY2tncm91bmR9KTtwLmNzcyh7d2lkdGg6bC53aWR0aH0pO2lmKGwuaGVpZ2h0IT1udWxsKXt1LmNzcyh7aGVpZ2h0OmwuaGVpZ2h0LG92ZXJmbG93OlwiYXV0b1wifSl9ZS5lYWNoKGwuZGF0YSxmdW5jdGlvbih2LHcpe2lmKHcuc2VsZWN0ZWQpe2wuZGVmYXVsdFNlbGVjdGVkSW5kZXg9dn11LmFwcGVuZCgnPGxpPjxhIGNsYXNzPVwiZGQtb3B0aW9uXCI+Jysody52YWx1ZT8nIDxpbnB1dCBjbGFzcz1cImRkLW9wdGlvbi12YWx1ZVwiIHR5cGU9XCJoaWRkZW5cIiB2YWx1ZT1cIicrdy52YWx1ZSsnXCIgLz4nOlwiXCIpKyh3LmltYWdlU3JjPycgPGltZyBjbGFzcz1cImRkLW9wdGlvbi1pbWFnZScrKGwuaW1hZ2VQb3NpdGlvbj09XCJyaWdodFwiP1wiIGRkLWltYWdlLXJpZ2h0XCI6XCJcIikrJ1wiIHNyYz1cIicrdy5pbWFnZVNyYysnXCIgLz4nOlwiXCIpKyh3LnRleHQ/JyA8bGFiZWwgY2xhc3M9XCJkZC1vcHRpb24tdGV4dFwiPicrdy50ZXh0K1wiPC9sYWJlbD5cIjpcIlwiKSsody5kZXNjcmlwdGlvbj8nIDxzbWFsbCBjbGFzcz1cImRkLW9wdGlvbi1kZXNjcmlwdGlvbiBkZC1kZXNjXCI+Jyt3LmRlc2NyaXB0aW9uK1wiPC9zbWFsbD5cIjpcIlwiKStcIjwvYT48L2xpPlwiKX0pO3ZhciB0PXtzZXR0aW5nczpsLG9yaWdpbmFsOm0sc2VsZWN0ZWRJbmRleDotMSxzZWxlY3RlZEl0ZW06bnVsbCxzZWxlY3RlZERhdGE6bnVsbH07cC5kYXRhKFwiZGRzbGlja1wiLHQpO2lmKGwuc2VsZWN0VGV4dC5sZW5ndGg+MCYmbC5kZWZhdWx0U2VsZWN0ZWRJbmRleD09bnVsbCl7cC5maW5kKFwiLmRkLXNlbGVjdGVkXCIpLmh0bWwobC5zZWxlY3RUZXh0KX1lbHNle3ZhciByPShsLmRlZmF1bHRTZWxlY3RlZEluZGV4IT1udWxsJiZsLmRlZmF1bHRTZWxlY3RlZEluZGV4Pj0wJiZsLmRlZmF1bHRTZWxlY3RlZEluZGV4PGwuZGF0YS5sZW5ndGgpP2wuZGVmYXVsdFNlbGVjdGVkSW5kZXg6MDtqKHAscil9cC5maW5kKFwiLmRkLXNlbGVjdFwiKS5vbihcImNsaWNrLmRkc2xpY2tcIixmdW5jdGlvbigpe2YocCl9KTtwLmZpbmQoXCIuZGQtb3B0aW9uXCIpLm9uKFwiY2xpY2suZGRzbGlja1wiLGZ1bmN0aW9uKCl7aihwLGUodGhpcykuY2xvc2VzdChcImxpXCIpLmluZGV4KCkpfSk7aWYobC5jbGlja09mZlRvQ2xvc2Upe3UuYWRkQ2xhc3MoXCJkZC1jbGljay1vZmYtY2xvc2VcIik7cC5vbihcImNsaWNrLmRkc2xpY2tcIixmdW5jdGlvbih2KXt2LnN0b3BQcm9wYWdhdGlvbigpfSk7ZShcImJvZHlcIikub24oXCJjbGlja1wiLGZ1bmN0aW9uKCl7ZShcIi5kZC1jbGljay1vZmYtY2xvc2VcIikuc2xpZGVVcCg1MCkuc2libGluZ3MoXCIuZGQtc2VsZWN0XCIpLmZpbmQoXCIuZGQtcG9pbnRlclwiKS5yZW1vdmVDbGFzcyhcImRkLXBvaW50ZXItdXBcIil9KX19fSl9O2Muc2VsZWN0PWZ1bmN0aW9uKGwpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXtpZihsLmluZGV4IT09dW5kZWZpbmVkKXtqKGUodGhpcyksbC5pbmRleCl9fSl9O2Mub3Blbj1mdW5jdGlvbigpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgbT1lKHRoaXMpLGw9bS5kYXRhKFwiZGRzbGlja1wiKTtpZihsKXtmKG0pfX0pfTtjLmNsb3NlPWZ1bmN0aW9uKCl7cmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbigpe3ZhciBtPWUodGhpcyksbD1tLmRhdGEoXCJkZHNsaWNrXCIpO2lmKGwpe2sobSl9fSl9O2MuZGVzdHJveT1mdW5jdGlvbigpe3JldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKXt2YXIgbj1lKHRoaXMpLG09bi5kYXRhKFwiZGRzbGlja1wiKTtpZihtKXt2YXIgbD1tLm9yaWdpbmFsO24ucmVtb3ZlRGF0YShcImRkc2xpY2tcIikudW5iaW5kKFwiLmRkc2xpY2tcIikucmVwbGFjZVdpdGgobCl9fSl9O2Z1bmN0aW9uIGoocSxzKXt2YXIgdT1xLmRhdGEoXCJkZHNsaWNrXCIpO3ZhciByPXEuZmluZChcIi5kZC1zZWxlY3RlZFwiKSxuPXIuc2libGluZ3MoXCIuZGQtc2VsZWN0ZWQtdmFsdWVcIiksdj1xLmZpbmQoXCIuZGQtb3B0aW9uc1wiKSxsPXIuc2libGluZ3MoXCIuZGQtcG9pbnRlclwiKSxwPXEuZmluZChcIi5kZC1vcHRpb25cIikuZXEocyksbT1wLmNsb3Nlc3QoXCJsaVwiKSxvPXUuc2V0dGluZ3MsdD11LnNldHRpbmdzLmRhdGFbc107cS5maW5kKFwiLmRkLW9wdGlvblwiKS5yZW1vdmVDbGFzcyhcImRkLW9wdGlvbi1zZWxlY3RlZFwiKTtwLmFkZENsYXNzKFwiZGQtb3B0aW9uLXNlbGVjdGVkXCIpO3Uuc2VsZWN0ZWRJbmRleD1zO3Uuc2VsZWN0ZWRJdGVtPW07dS5zZWxlY3RlZERhdGE9dDtpZihvLnNob3dTZWxlY3RlZEhUTUwpe3IuaHRtbCgodC5pbWFnZVNyYz8nPGltZyBjbGFzcz1cImRkLXNlbGVjdGVkLWltYWdlJysoby5pbWFnZVBvc2l0aW9uPT1cInJpZ2h0XCI/XCIgZGQtaW1hZ2UtcmlnaHRcIjpcIlwiKSsnXCIgc3JjPVwiJyt0LmltYWdlU3JjKydcIiAvPic6XCJcIikrKHQudGV4dD8nPGxhYmVsIGNsYXNzPVwiZGQtc2VsZWN0ZWQtdGV4dFwiPicrdC50ZXh0K1wiPC9sYWJlbD5cIjpcIlwiKSsodC5kZXNjcmlwdGlvbj8nPHNtYWxsIGNsYXNzPVwiZGQtc2VsZWN0ZWQtZGVzY3JpcHRpb24gZGQtZGVzYycrKG8udHJ1bmNhdGVEZXNjcmlwdGlvbj9cIiBkZC1zZWxlY3RlZC1kZXNjcmlwdGlvbi10cnVuY2F0ZWRcIjpcIlwiKSsnXCIgPicrdC5kZXNjcmlwdGlvbitcIjwvc21hbGw+XCI6XCJcIikpfWVsc2V7ci5odG1sKHQudGV4dCl9bi52YWwodC52YWx1ZSk7dS5vcmlnaW5hbC52YWwodC52YWx1ZSk7cS5kYXRhKFwiZGRzbGlja1wiLHUpO2socSk7ZyhxKTtpZih0eXBlb2Ygby5vblNlbGVjdGVkPT1cImZ1bmN0aW9uXCIpe28ub25TZWxlY3RlZC5jYWxsKHRoaXMsdSl9fWZ1bmN0aW9uIGYocCl7dmFyIG89cC5maW5kKFwiLmRkLXNlbGVjdFwiKSxtPW8uc2libGluZ3MoXCIuZGQtb3B0aW9uc1wiKSxsPW8uZmluZChcIi5kZC1wb2ludGVyXCIpLG49bS5pcyhcIjp2aXNpYmxlXCIpO2UoXCIuZGQtY2xpY2stb2ZmLWNsb3NlXCIpLm5vdChtKS5zbGlkZVVwKDUwKTtlKFwiLmRkLXBvaW50ZXJcIikucmVtb3ZlQ2xhc3MoXCJkZC1wb2ludGVyLXVwXCIpO2lmKG4pe20uc2xpZGVVcChcImZhc3RcIik7bC5yZW1vdmVDbGFzcyhcImRkLXBvaW50ZXItdXBcIil9ZWxzZXttLnNsaWRlRG93bihcImZhc3RcIik7bC5hZGRDbGFzcyhcImRkLXBvaW50ZXItdXBcIil9aChwKX1mdW5jdGlvbiBrKGwpe2wuZmluZChcIi5kZC1vcHRpb25zXCIpLnNsaWRlVXAoNTApO2wuZmluZChcIi5kZC1wb2ludGVyXCIpLnJlbW92ZUNsYXNzKFwiZGQtcG9pbnRlci11cFwiKS5yZW1vdmVDbGFzcyhcImRkLXBvaW50ZXItdXBcIil9ZnVuY3Rpb24gZyhvKXt2YXIgbj1vLmZpbmQoXCIuZGQtc2VsZWN0XCIpLmNzcyhcImhlaWdodFwiKTt2YXIgbT1vLmZpbmQoXCIuZGQtc2VsZWN0ZWQtZGVzY3JpcHRpb25cIik7dmFyIGw9by5maW5kKFwiLmRkLXNlbGVjdGVkLWltYWdlXCIpO2lmKG0ubGVuZ3RoPD0wJiZsLmxlbmd0aD4wKXtvLmZpbmQoXCIuZGQtc2VsZWN0ZWQtdGV4dFwiKS5jc3MoXCJsaW5lSGVpZ2h0XCIsbil9fWZ1bmN0aW9uIGgobCl7bC5maW5kKFwiLmRkLW9wdGlvblwiKS5lYWNoKGZ1bmN0aW9uKCl7dmFyIHA9ZSh0aGlzKTt2YXIgbj1wLmNzcyhcImhlaWdodFwiKTt2YXIgbz1wLmZpbmQoXCIuZGQtb3B0aW9uLWRlc2NyaXB0aW9uXCIpO3ZhciBtPWwuZmluZChcIi5kZC1vcHRpb24taW1hZ2VcIik7aWYoby5sZW5ndGg8PTAmJm0ubGVuZ3RoPjApe3AuZmluZChcIi5kZC1vcHRpb24tdGV4dFwiKS5jc3MoXCJsaW5lSGVpZ2h0XCIsbil9fSl9fSkoalF1ZXJ5KTtcbiIsIi8qKlxuICogTGlnaHRib3ggdjIuNy4xXG4gKiBieSBMb2tlc2ggRGhha2FyIC0gaHR0cDovL2xva2VzaGRoYWthci5jb20vcHJvamVjdHMvbGlnaHRib3gyL1xuICpcbiAqIEBsaWNlbnNlIGh0dHA6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LzIuNS9cbiAqIC0gRnJlZSBmb3IgdXNlIGluIGJvdGggcGVyc29uYWwgYW5kIGNvbW1lcmNpYWwgcHJvamVjdHNcbiAqIC0gQXR0cmlidXRpb24gcmVxdWlyZXMgbGVhdmluZyBhdXRob3IgbmFtZSwgYXV0aG9yIGxpbmssIGFuZCB0aGUgbGljZW5zZSBpbmZvIGludGFjdFxuICovXG5cbihmdW5jdGlvbigpIHtcbiAgLy8gVXNlIGxvY2FsIGFsaWFzXG4gIHZhciAkID0galF1ZXJ5O1xuXG4gIHZhciBMaWdodGJveE9wdGlvbnMgPSAoZnVuY3Rpb24oKSB7XG4gICAgZnVuY3Rpb24gTGlnaHRib3hPcHRpb25zKCkge1xuICAgICAgdGhpcy5mYWRlRHVyYXRpb24gICAgICAgICAgICAgICAgPSA1MDA7XG4gICAgICB0aGlzLmZpdEltYWdlc0luVmlld3BvcnQgICAgICAgICA9IHRydWU7XG4gICAgICB0aGlzLnJlc2l6ZUR1cmF0aW9uICAgICAgICAgICAgICA9IDcwMDtcbiAgICAgIHRoaXMucG9zaXRpb25Gcm9tVG9wICAgICAgICAgICAgID0gNTA7XG4gICAgICB0aGlzLnNob3dJbWFnZU51bWJlckxhYmVsICAgICAgICA9IHRydWU7XG4gICAgICB0aGlzLmFsd2F5c1Nob3dOYXZPblRvdWNoRGV2aWNlcyA9IGZhbHNlO1xuICAgICAgdGhpcy53cmFwQXJvdW5kICAgICAgICAgICAgICAgICAgPSBmYWxzZTtcbiAgICB9XG4gICAgXG4gICAgLy8gQ2hhbmdlIHRvIGxvY2FsaXplIHRvIG5vbi1lbmdsaXNoIGxhbmd1YWdlXG4gICAgTGlnaHRib3hPcHRpb25zLnByb3RvdHlwZS5hbGJ1bUxhYmVsID0gZnVuY3Rpb24oY3VySW1hZ2VOdW0sIGFsYnVtU2l6ZSkge1xuICAgICAgcmV0dXJuIFwiSW1hZ2UgXCIgKyBjdXJJbWFnZU51bSArIFwiIG9mIFwiICsgYWxidW1TaXplO1xuICAgIH07XG5cbiAgICByZXR1cm4gTGlnaHRib3hPcHRpb25zO1xuICB9KSgpO1xuXG5cbiAgdmFyIExpZ2h0Ym94ID0gKGZ1bmN0aW9uKCkge1xuICAgIGZ1bmN0aW9uIExpZ2h0Ym94KG9wdGlvbnMpIHtcbiAgICAgIHRoaXMub3B0aW9ucyAgICAgICAgICAgPSBvcHRpb25zO1xuICAgICAgdGhpcy5hbGJ1bSAgICAgICAgICAgICA9IFtdO1xuICAgICAgdGhpcy5jdXJyZW50SW1hZ2VJbmRleCA9IHZvaWQgMDtcbiAgICAgIHRoaXMuaW5pdCgpO1xuICAgIH1cblxuICAgIExpZ2h0Ym94LnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLmVuYWJsZSgpO1xuICAgICAgdGhpcy5idWlsZCgpO1xuICAgIH07XG5cbiAgICAvLyBMb29wIHRocm91Z2ggYW5jaG9ycyBhbmQgYXJlYW1hcHMgbG9va2luZyBmb3IgZWl0aGVyIGRhdGEtbGlnaHRib3ggYXR0cmlidXRlcyBvciByZWwgYXR0cmlidXRlc1xuICAgIC8vIHRoYXQgY29udGFpbiAnbGlnaHRib3gnLiBXaGVuIHRoZXNlIGFyZSBjbGlja2VkLCBzdGFydCBsaWdodGJveC5cbiAgICBMaWdodGJveC5wcm90b3R5cGUuZW5hYmxlID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAkKCdib2R5Jykub24oJ2NsaWNrJywgJ2FbcmVsXj1saWdodGJveF0sIGFyZWFbcmVsXj1saWdodGJveF0sIGFbZGF0YS1saWdodGJveF0sIGFyZWFbZGF0YS1saWdodGJveF0nLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICBzZWxmLnN0YXJ0KCQoZXZlbnQuY3VycmVudFRhcmdldCkpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgLy8gQnVpbGQgaHRtbCBmb3IgdGhlIGxpZ2h0Ym94IGFuZCB0aGUgb3ZlcmxheS5cbiAgICAvLyBBdHRhY2ggZXZlbnQgaGFuZGxlcnMgdG8gdGhlIG5ldyBET00gZWxlbWVudHMuIGNsaWNrIGNsaWNrIGNsaWNrXG4gICAgTGlnaHRib3gucHJvdG90eXBlLmJ1aWxkID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXM7XG4gICAgICAkKFwiPGRpdiBpZD0nbGlnaHRib3hPdmVybGF5JyBjbGFzcz0nbGlnaHRib3hPdmVybGF5Jz48L2Rpdj48ZGl2IGlkPSdsaWdodGJveCcgY2xhc3M9J2xpZ2h0Ym94Jz48ZGl2IGNsYXNzPSdsYi1vdXRlckNvbnRhaW5lcic+PGRpdiBjbGFzcz0nbGItY29udGFpbmVyJz48aW1nIGNsYXNzPSdsYi1pbWFnZScgc3JjPScnIC8+PGRpdiBjbGFzcz0nbGItbmF2Jz48YSBjbGFzcz0nbGItcHJldicgaHJlZj0nJyA+PC9hPjxhIGNsYXNzPSdsYi1uZXh0JyBocmVmPScnID48L2E+PC9kaXY+PGRpdiBjbGFzcz0nbGItbG9hZGVyJz48YSBjbGFzcz0nbGItY2FuY2VsJz48L2E+PC9kaXY+PC9kaXY+PC9kaXY+PGRpdiBjbGFzcz0nbGItZGF0YUNvbnRhaW5lcic+PGRpdiBjbGFzcz0nbGItZGF0YSc+PGRpdiBjbGFzcz0nbGItZGV0YWlscyc+PHNwYW4gY2xhc3M9J2xiLWNhcHRpb24nPjwvc3Bhbj48c3BhbiBjbGFzcz0nbGItbnVtYmVyJz48L3NwYW4+PC9kaXY+PGRpdiBjbGFzcz0nbGItY2xvc2VDb250YWluZXInPjxhIGNsYXNzPSdsYi1jbG9zZSc+PC9hPjwvZGl2PjwvZGl2PjwvZGl2PjwvZGl2PlwiKS5hcHBlbmRUbygkKCdib2R5JykpO1xuICAgICAgXG4gICAgICAvLyBDYWNoZSBqUXVlcnkgb2JqZWN0c1xuICAgICAgdGhpcy4kbGlnaHRib3ggICAgICAgPSAkKCcjbGlnaHRib3gnKTtcbiAgICAgIHRoaXMuJG92ZXJsYXkgICAgICAgID0gJCgnI2xpZ2h0Ym94T3ZlcmxheScpO1xuICAgICAgdGhpcy4kb3V0ZXJDb250YWluZXIgPSB0aGlzLiRsaWdodGJveC5maW5kKCcubGItb3V0ZXJDb250YWluZXInKTtcbiAgICAgIHRoaXMuJGNvbnRhaW5lciAgICAgID0gdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLWNvbnRhaW5lcicpO1xuXG4gICAgICAvLyBTdG9yZSBjc3MgdmFsdWVzIGZvciBmdXR1cmUgbG9va3VwXG4gICAgICB0aGlzLmNvbnRhaW5lclRvcFBhZGRpbmcgPSBwYXJzZUludCh0aGlzLiRjb250YWluZXIuY3NzKCdwYWRkaW5nLXRvcCcpLCAxMCk7XG4gICAgICB0aGlzLmNvbnRhaW5lclJpZ2h0UGFkZGluZyA9IHBhcnNlSW50KHRoaXMuJGNvbnRhaW5lci5jc3MoJ3BhZGRpbmctcmlnaHQnKSwgMTApO1xuICAgICAgdGhpcy5jb250YWluZXJCb3R0b21QYWRkaW5nID0gcGFyc2VJbnQodGhpcy4kY29udGFpbmVyLmNzcygncGFkZGluZy1ib3R0b20nKSwgMTApO1xuICAgICAgdGhpcy5jb250YWluZXJMZWZ0UGFkZGluZyA9IHBhcnNlSW50KHRoaXMuJGNvbnRhaW5lci5jc3MoJ3BhZGRpbmctbGVmdCcpLCAxMCk7XG4gICAgICBcbiAgICAgIC8vIEF0dGFjaCBldmVudCBoYW5kbGVycyB0byB0aGUgbmV3bHkgbWludGVkIERPTSBlbGVtZW50c1xuICAgICAgdGhpcy4kb3ZlcmxheS5oaWRlKCkub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIHNlbGYuZW5kKCk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLiRsaWdodGJveC5oaWRlKCkub24oJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgaWYgKCQoZXZlbnQudGFyZ2V0KS5hdHRyKCdpZCcpID09PSAnbGlnaHRib3gnKSB7XG4gICAgICAgICAgc2VsZi5lbmQoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9KTtcblxuICAgICAgdGhpcy4kb3V0ZXJDb250YWluZXIub24oJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgaWYgKCQoZXZlbnQudGFyZ2V0KS5hdHRyKCdpZCcpID09PSAnbGlnaHRib3gnKSB7XG4gICAgICAgICAgc2VsZi5lbmQoKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9KTtcblxuICAgICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLXByZXYnKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgaWYgKHNlbGYuY3VycmVudEltYWdlSW5kZXggPT09IDApIHtcbiAgICAgICAgICBzZWxmLmNoYW5nZUltYWdlKHNlbGYuYWxidW0ubGVuZ3RoIC0gMSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgc2VsZi5jaGFuZ2VJbWFnZShzZWxmLmN1cnJlbnRJbWFnZUluZGV4IC0gMSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuJGxpZ2h0Ym94LmZpbmQoJy5sYi1uZXh0Jykub24oJ2NsaWNrJywgZnVuY3Rpb24oKSB7XG4gICAgICAgIGlmIChzZWxmLmN1cnJlbnRJbWFnZUluZGV4ID09PSBzZWxmLmFsYnVtLmxlbmd0aCAtIDEpIHtcbiAgICAgICAgICBzZWxmLmNoYW5nZUltYWdlKDApO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNlbGYuY2hhbmdlSW1hZ2Uoc2VsZi5jdXJyZW50SW1hZ2VJbmRleCArIDEpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0pO1xuXG4gICAgICB0aGlzLiRsaWdodGJveC5maW5kKCcubGItbG9hZGVyLCAubGItY2xvc2UnKS5vbignY2xpY2snLCBmdW5jdGlvbigpIHtcbiAgICAgICAgc2VsZi5lbmQoKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSk7XG4gICAgfTtcblxuICAgIC8vIFNob3cgb3ZlcmxheSBhbmQgbGlnaHRib3guIElmIHRoZSBpbWFnZSBpcyBwYXJ0IG9mIGEgc2V0LCBhZGQgc2libGluZ3MgdG8gYWxidW0gYXJyYXkuXG4gICAgTGlnaHRib3gucHJvdG90eXBlLnN0YXJ0ID0gZnVuY3Rpb24oJGxpbmspIHtcbiAgICAgIHZhciBzZWxmICAgID0gdGhpcztcbiAgICAgIHZhciAkd2luZG93ID0gJCh3aW5kb3cpO1xuXG4gICAgICAkd2luZG93Lm9uKCdyZXNpemUnLCAkLnByb3h5KHRoaXMuc2l6ZU92ZXJsYXksIHRoaXMpKTtcblxuICAgICAgJCgnc2VsZWN0LCBvYmplY3QsIGVtYmVkJykuY3NzKHtcbiAgICAgICAgdmlzaWJpbGl0eTogXCJoaWRkZW5cIlxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuc2l6ZU92ZXJsYXkoKTtcblxuICAgICAgdGhpcy5hbGJ1bSA9IFtdO1xuICAgICAgdmFyIGltYWdlTnVtYmVyID0gMDtcblxuICAgICAgZnVuY3Rpb24gYWRkVG9BbGJ1bSgkbGluaykge1xuICAgICAgICBzZWxmLmFsYnVtLnB1c2goe1xuICAgICAgICAgIGxpbms6ICRsaW5rLmF0dHIoJ2hyZWYnKSxcbiAgICAgICAgICB0aXRsZTogJGxpbmsuYXR0cignZGF0YS10aXRsZScpIHx8ICRsaW5rLmF0dHIoJ3RpdGxlJylcbiAgICAgICAgfSk7XG4gICAgICB9XG5cbiAgICAgIC8vIFN1cHBvcnQgYm90aCBkYXRhLWxpZ2h0Ym94IGF0dHJpYnV0ZSBhbmQgcmVsIGF0dHJpYnV0ZSBpbXBsZW1lbnRhdGlvbnNcbiAgICAgIHZhciBkYXRhTGlnaHRib3hWYWx1ZSA9ICRsaW5rLmF0dHIoJ2RhdGEtbGlnaHRib3gnKTtcbiAgICAgIHZhciAkbGlua3M7XG5cbiAgICAgIGlmIChkYXRhTGlnaHRib3hWYWx1ZSkge1xuICAgICAgICAkbGlua3MgPSAkKCRsaW5rLnByb3AoXCJ0YWdOYW1lXCIpICsgJ1tkYXRhLWxpZ2h0Ym94PVwiJyArIGRhdGFMaWdodGJveFZhbHVlICsgJ1wiXScpO1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8ICRsaW5rcy5sZW5ndGg7IGkgPSArK2kpIHtcbiAgICAgICAgICBhZGRUb0FsYnVtKCQoJGxpbmtzW2ldKSk7XG4gICAgICAgICAgaWYgKCRsaW5rc1tpXSA9PT0gJGxpbmtbMF0pIHtcbiAgICAgICAgICAgIGltYWdlTnVtYmVyID0gaTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmICgkbGluay5hdHRyKCdyZWwnKSA9PT0gJ2xpZ2h0Ym94Jykge1xuICAgICAgICAgIC8vIElmIGltYWdlIGlzIG5vdCBwYXJ0IG9mIGEgc2V0XG4gICAgICAgICAgYWRkVG9BbGJ1bSgkbGluayk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gSWYgaW1hZ2UgaXMgcGFydCBvZiBhIHNldFxuICAgICAgICAgICRsaW5rcyA9ICQoJGxpbmsucHJvcChcInRhZ05hbWVcIikgKyAnW3JlbD1cIicgKyAkbGluay5hdHRyKCdyZWwnKSArICdcIl0nKTtcbiAgICAgICAgICBmb3IgKHZhciBqID0gMDsgaiA8ICRsaW5rcy5sZW5ndGg7IGogPSArK2opIHtcbiAgICAgICAgICAgIGFkZFRvQWxidW0oJCgkbGlua3Nbal0pKTtcbiAgICAgICAgICAgIGlmICgkbGlua3Nbal0gPT09ICRsaW5rWzBdKSB7XG4gICAgICAgICAgICAgIGltYWdlTnVtYmVyID0gajtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gUG9zaXRpb24gTGlnaHRib3hcbiAgICAgIHZhciB0b3AgID0gJHdpbmRvdy5zY3JvbGxUb3AoKSArIHRoaXMub3B0aW9ucy5wb3NpdGlvbkZyb21Ub3A7XG4gICAgICB2YXIgbGVmdCA9ICR3aW5kb3cuc2Nyb2xsTGVmdCgpO1xuICAgICAgdGhpcy4kbGlnaHRib3guY3NzKHtcbiAgICAgICAgdG9wOiB0b3AgKyAncHgnLFxuICAgICAgICBsZWZ0OiBsZWZ0ICsgJ3B4J1xuICAgICAgfSkuZmFkZUluKHRoaXMub3B0aW9ucy5mYWRlRHVyYXRpb24pO1xuXG4gICAgICB0aGlzLmNoYW5nZUltYWdlKGltYWdlTnVtYmVyKTtcbiAgICB9O1xuXG4gICAgLy8gSGlkZSBtb3N0IFVJIGVsZW1lbnRzIGluIHByZXBhcmF0aW9uIGZvciB0aGUgYW5pbWF0ZWQgcmVzaXppbmcgb2YgdGhlIGxpZ2h0Ym94LlxuICAgIExpZ2h0Ym94LnByb3RvdHlwZS5jaGFuZ2VJbWFnZSA9IGZ1bmN0aW9uKGltYWdlTnVtYmVyKSB7XG4gICAgICB2YXIgc2VsZiA9IHRoaXM7XG5cbiAgICAgIHRoaXMuZGlzYWJsZUtleWJvYXJkTmF2KCk7XG4gICAgICB2YXIgJGltYWdlID0gdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLWltYWdlJyk7XG5cbiAgICAgIHRoaXMuJG92ZXJsYXkuZmFkZUluKHRoaXMub3B0aW9ucy5mYWRlRHVyYXRpb24pO1xuXG4gICAgICAkKCcubGItbG9hZGVyJykuZmFkZUluKCdzbG93Jyk7XG4gICAgICB0aGlzLiRsaWdodGJveC5maW5kKCcubGItaW1hZ2UsIC5sYi1uYXYsIC5sYi1wcmV2LCAubGItbmV4dCwgLmxiLWRhdGFDb250YWluZXIsIC5sYi1udW1iZXJzLCAubGItY2FwdGlvbicpLmhpZGUoKTtcblxuICAgICAgdGhpcy4kb3V0ZXJDb250YWluZXIuYWRkQ2xhc3MoJ2FuaW1hdGluZycpO1xuXG4gICAgICAvLyBXaGVuIGltYWdlIHRvIHNob3cgaXMgcHJlbG9hZGVkLCB3ZSBzZW5kIHRoZSB3aWR0aCBhbmQgaGVpZ2h0IHRvIHNpemVDb250YWluZXIoKVxuICAgICAgdmFyIHByZWxvYWRlciA9IG5ldyBJbWFnZSgpO1xuICAgICAgcHJlbG9hZGVyLm9ubG9hZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgJHByZWxvYWRlciwgaW1hZ2VIZWlnaHQsIGltYWdlV2lkdGgsIG1heEltYWdlSGVpZ2h0LCBtYXhJbWFnZVdpZHRoLCB3aW5kb3dIZWlnaHQsIHdpbmRvd1dpZHRoO1xuICAgICAgICAkaW1hZ2UuYXR0cignc3JjJywgc2VsZi5hbGJ1bVtpbWFnZU51bWJlcl0ubGluayk7XG5cbiAgICAgICAgJHByZWxvYWRlciA9ICQocHJlbG9hZGVyKTtcblxuICAgICAgICAkaW1hZ2Uud2lkdGgocHJlbG9hZGVyLndpZHRoKTtcbiAgICAgICAgJGltYWdlLmhlaWdodChwcmVsb2FkZXIuaGVpZ2h0KTtcbiAgICAgICAgXG4gICAgICAgIGlmIChzZWxmLm9wdGlvbnMuZml0SW1hZ2VzSW5WaWV3cG9ydCkge1xuICAgICAgICAgIC8vIEZpdCBpbWFnZSBpbnNpZGUgdGhlIHZpZXdwb3J0LlxuICAgICAgICAgIC8vIFRha2UgaW50byBhY2NvdW50IHRoZSBib3JkZXIgYXJvdW5kIHRoZSBpbWFnZSBhbmQgYW4gYWRkaXRpb25hbCAxMHB4IGd1dHRlciBvbiBlYWNoIHNpZGUuXG5cbiAgICAgICAgICB3aW5kb3dXaWR0aCAgICA9ICQod2luZG93KS53aWR0aCgpO1xuICAgICAgICAgIHdpbmRvd0hlaWdodCAgID0gJCh3aW5kb3cpLmhlaWdodCgpO1xuICAgICAgICAgIG1heEltYWdlV2lkdGggID0gd2luZG93V2lkdGggLSBzZWxmLmNvbnRhaW5lckxlZnRQYWRkaW5nIC0gc2VsZi5jb250YWluZXJSaWdodFBhZGRpbmcgLSAyMDtcbiAgICAgICAgICBtYXhJbWFnZUhlaWdodCA9IHdpbmRvd0hlaWdodCAtIHNlbGYuY29udGFpbmVyVG9wUGFkZGluZyAtIHNlbGYuY29udGFpbmVyQm90dG9tUGFkZGluZyAtIDEyMDtcblxuICAgICAgICAgIC8vIElzIHRoZXJlIGEgZml0dGluZyBpc3N1ZT9cbiAgICAgICAgICBpZiAoKHByZWxvYWRlci53aWR0aCA+IG1heEltYWdlV2lkdGgpIHx8IChwcmVsb2FkZXIuaGVpZ2h0ID4gbWF4SW1hZ2VIZWlnaHQpKSB7XG4gICAgICAgICAgICBpZiAoKHByZWxvYWRlci53aWR0aCAvIG1heEltYWdlV2lkdGgpID4gKHByZWxvYWRlci5oZWlnaHQgLyBtYXhJbWFnZUhlaWdodCkpIHtcbiAgICAgICAgICAgICAgaW1hZ2VXaWR0aCAgPSBtYXhJbWFnZVdpZHRoO1xuICAgICAgICAgICAgICBpbWFnZUhlaWdodCA9IHBhcnNlSW50KHByZWxvYWRlci5oZWlnaHQgLyAocHJlbG9hZGVyLndpZHRoIC8gaW1hZ2VXaWR0aCksIDEwKTtcbiAgICAgICAgICAgICAgJGltYWdlLndpZHRoKGltYWdlV2lkdGgpO1xuICAgICAgICAgICAgICAkaW1hZ2UuaGVpZ2h0KGltYWdlSGVpZ2h0KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGltYWdlSGVpZ2h0ID0gbWF4SW1hZ2VIZWlnaHQ7XG4gICAgICAgICAgICAgIGltYWdlV2lkdGggPSBwYXJzZUludChwcmVsb2FkZXIud2lkdGggLyAocHJlbG9hZGVyLmhlaWdodCAvIGltYWdlSGVpZ2h0KSwgMTApO1xuICAgICAgICAgICAgICAkaW1hZ2Uud2lkdGgoaW1hZ2VXaWR0aCk7XG4gICAgICAgICAgICAgICRpbWFnZS5oZWlnaHQoaW1hZ2VIZWlnaHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBzZWxmLnNpemVDb250YWluZXIoJGltYWdlLndpZHRoKCksICRpbWFnZS5oZWlnaHQoKSk7XG4gICAgICB9O1xuXG4gICAgICBwcmVsb2FkZXIuc3JjICAgICAgICAgID0gdGhpcy5hbGJ1bVtpbWFnZU51bWJlcl0ubGluaztcbiAgICAgIHRoaXMuY3VycmVudEltYWdlSW5kZXggPSBpbWFnZU51bWJlcjtcbiAgICB9O1xuXG4gICAgLy8gU3RyZXRjaCBvdmVybGF5IHRvIGZpdCB0aGUgdmlld3BvcnRcbiAgICBMaWdodGJveC5wcm90b3R5cGUuc2l6ZU92ZXJsYXkgPSBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuJG92ZXJsYXlcbiAgICAgICAgLndpZHRoKCQod2luZG93KS53aWR0aCgpKVxuICAgICAgICAuaGVpZ2h0KCQoZG9jdW1lbnQpLmhlaWdodCgpKTtcbiAgICB9O1xuXG4gICAgLy8gQW5pbWF0ZSB0aGUgc2l6ZSBvZiB0aGUgbGlnaHRib3ggdG8gZml0IHRoZSBpbWFnZSB3ZSBhcmUgc2hvd2luZ1xuICAgIExpZ2h0Ym94LnByb3RvdHlwZS5zaXplQ29udGFpbmVyID0gZnVuY3Rpb24oaW1hZ2VXaWR0aCwgaW1hZ2VIZWlnaHQpIHtcbiAgICAgIHZhciBzZWxmID0gdGhpcztcbiAgICAgIFxuICAgICAgdmFyIG9sZFdpZHRoICA9IHRoaXMuJG91dGVyQ29udGFpbmVyLm91dGVyV2lkdGgoKTtcbiAgICAgIHZhciBvbGRIZWlnaHQgPSB0aGlzLiRvdXRlckNvbnRhaW5lci5vdXRlckhlaWdodCgpO1xuICAgICAgdmFyIG5ld1dpZHRoICA9IGltYWdlV2lkdGggKyB0aGlzLmNvbnRhaW5lckxlZnRQYWRkaW5nICsgdGhpcy5jb250YWluZXJSaWdodFBhZGRpbmc7XG4gICAgICB2YXIgbmV3SGVpZ2h0ID0gaW1hZ2VIZWlnaHQgKyB0aGlzLmNvbnRhaW5lclRvcFBhZGRpbmcgKyB0aGlzLmNvbnRhaW5lckJvdHRvbVBhZGRpbmc7XG4gICAgICBcbiAgICAgIGZ1bmN0aW9uIHBvc3RSZXNpemUoKSB7XG4gICAgICAgIHNlbGYuJGxpZ2h0Ym94LmZpbmQoJy5sYi1kYXRhQ29udGFpbmVyJykud2lkdGgobmV3V2lkdGgpO1xuICAgICAgICBzZWxmLiRsaWdodGJveC5maW5kKCcubGItcHJldkxpbmsnKS5oZWlnaHQobmV3SGVpZ2h0KTtcbiAgICAgICAgc2VsZi4kbGlnaHRib3guZmluZCgnLmxiLW5leHRMaW5rJykuaGVpZ2h0KG5ld0hlaWdodCk7XG4gICAgICAgIHNlbGYuc2hvd0ltYWdlKCk7XG4gICAgICB9XG5cbiAgICAgIGlmIChvbGRXaWR0aCAhPT0gbmV3V2lkdGggfHwgb2xkSGVpZ2h0ICE9PSBuZXdIZWlnaHQpIHtcbiAgICAgICAgdGhpcy4kb3V0ZXJDb250YWluZXIuYW5pbWF0ZSh7XG4gICAgICAgICAgd2lkdGg6IG5ld1dpZHRoLFxuICAgICAgICAgIGhlaWdodDogbmV3SGVpZ2h0XG4gICAgICAgIH0sIHRoaXMub3B0aW9ucy5yZXNpemVEdXJhdGlvbiwgJ3N3aW5nJywgZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcG9zdFJlc2l6ZSgpO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHBvc3RSZXNpemUoKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLy8gRGlzcGxheSB0aGUgaW1hZ2UgYW5kIGl0J3MgZGV0YWlscyBhbmQgYmVnaW4gcHJlbG9hZCBuZWlnaGJvcmluZyBpbWFnZXMuXG4gICAgTGlnaHRib3gucHJvdG90eXBlLnNob3dJbWFnZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLWxvYWRlcicpLmhpZGUoKTtcbiAgICAgIHRoaXMuJGxpZ2h0Ym94LmZpbmQoJy5sYi1pbWFnZScpLmZhZGVJbignc2xvdycpO1xuICAgIFxuICAgICAgdGhpcy51cGRhdGVOYXYoKTtcbiAgICAgIHRoaXMudXBkYXRlRGV0YWlscygpO1xuICAgICAgdGhpcy5wcmVsb2FkTmVpZ2hib3JpbmdJbWFnZXMoKTtcbiAgICAgIHRoaXMuZW5hYmxlS2V5Ym9hcmROYXYoKTtcbiAgICB9O1xuXG4gICAgLy8gRGlzcGxheSBwcmV2aW91cyBhbmQgbmV4dCBuYXZpZ2F0aW9uIGlmIGFwcHJvcHJpYXRlLlxuICAgIExpZ2h0Ym94LnByb3RvdHlwZS51cGRhdGVOYXYgPSBmdW5jdGlvbigpIHtcbiAgICAgIC8vIENoZWNrIHRvIHNlZSBpZiB0aGUgYnJvd3NlciBzdXBwb3J0cyB0b3VjaCBldmVudHMuIElmIHNvLCB3ZSB0YWtlIHRoZSBjb25zZXJ2YXRpdmUgYXBwcm9hY2hcbiAgICAgIC8vIGFuZCBhc3N1bWUgdGhhdCBtb3VzZSBob3ZlciBldmVudHMgYXJlIG5vdCBzdXBwb3J0ZWQgYW5kIGFsd2F5cyBzaG93IHByZXYvbmV4dCBuYXZpZ2F0aW9uXG4gICAgICAvLyBhcnJvd3MgaW4gaW1hZ2Ugc2V0cy5cbiAgICAgIHZhciBhbHdheXNTaG93TmF2ID0gZmFsc2U7XG4gICAgICB0cnkge1xuICAgICAgICBkb2N1bWVudC5jcmVhdGVFdmVudChcIlRvdWNoRXZlbnRcIik7XG4gICAgICAgIGFsd2F5c1Nob3dOYXYgPSAodGhpcy5vcHRpb25zLmFsd2F5c1Nob3dOYXZPblRvdWNoRGV2aWNlcyk/IHRydWU6IGZhbHNlO1xuICAgICAgfSBjYXRjaCAoZSkge31cblxuICAgICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLW5hdicpLnNob3coKTtcblxuICAgICAgaWYgKHRoaXMuYWxidW0ubGVuZ3RoID4gMSkge1xuICAgICAgICBpZiAodGhpcy5vcHRpb25zLndyYXBBcm91bmQpIHtcbiAgICAgICAgICBpZiAoYWx3YXlzU2hvd05hdikge1xuICAgICAgICAgICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLXByZXYsIC5sYi1uZXh0JykuY3NzKCdvcGFjaXR5JywgJzEnKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLXByZXYsIC5sYi1uZXh0Jykuc2hvdygpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRJbWFnZUluZGV4ID4gMCkge1xuICAgICAgICAgICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLXByZXYnKS5zaG93KCk7XG4gICAgICAgICAgICBpZiAoYWx3YXlzU2hvd05hdikge1xuICAgICAgICAgICAgICB0aGlzLiRsaWdodGJveC5maW5kKCcubGItcHJldicpLmNzcygnb3BhY2l0eScsICcxJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmICh0aGlzLmN1cnJlbnRJbWFnZUluZGV4IDwgdGhpcy5hbGJ1bS5sZW5ndGggLSAxKSB7XG4gICAgICAgICAgICB0aGlzLiRsaWdodGJveC5maW5kKCcubGItbmV4dCcpLnNob3coKTtcbiAgICAgICAgICAgIGlmIChhbHdheXNTaG93TmF2KSB7XG4gICAgICAgICAgICAgIHRoaXMuJGxpZ2h0Ym94LmZpbmQoJy5sYi1uZXh0JykuY3NzKCdvcGFjaXR5JywgJzEnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLy8gRGlzcGxheSBjYXB0aW9uLCBpbWFnZSBudW1iZXIsIGFuZCBjbG9zaW5nIGJ1dHRvbi5cbiAgICBMaWdodGJveC5wcm90b3R5cGUudXBkYXRlRGV0YWlscyA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHNlbGYgPSB0aGlzO1xuXG4gICAgICAvLyBFbmFibGUgYW5jaG9yIGNsaWNrcyBpbiB0aGUgaW5qZWN0ZWQgY2FwdGlvbiBodG1sLlxuICAgICAgLy8gVGhhbmtzIE5hdGUgV3JpZ2h0IGZvciB0aGUgZml4LiBAaHR0cHM6Ly9naXRodWIuY29tL05hdGVXclxuICAgICAgaWYgKHR5cGVvZiB0aGlzLmFsYnVtW3RoaXMuY3VycmVudEltYWdlSW5kZXhdLnRpdGxlICE9PSAndW5kZWZpbmVkJyAmJiB0aGlzLmFsYnVtW3RoaXMuY3VycmVudEltYWdlSW5kZXhdLnRpdGxlICE9PSBcIlwiKSB7XG4gICAgICAgIHRoaXMuJGxpZ2h0Ym94LmZpbmQoJy5sYi1jYXB0aW9uJylcbiAgICAgICAgICAuaHRtbCh0aGlzLmFsYnVtW3RoaXMuY3VycmVudEltYWdlSW5kZXhdLnRpdGxlKVxuICAgICAgICAgIC5mYWRlSW4oJ2Zhc3QnKVxuICAgICAgICAgIC5maW5kKCdhJykub24oJ2NsaWNrJywgZnVuY3Rpb24oZXZlbnQpe1xuICAgICAgICAgICAgbG9jYXRpb24uaHJlZiA9ICQodGhpcykuYXR0cignaHJlZicpO1xuICAgICAgICAgIH0pO1xuICAgICAgfVxuICAgIFxuICAgICAgaWYgKHRoaXMuYWxidW0ubGVuZ3RoID4gMSAmJiB0aGlzLm9wdGlvbnMuc2hvd0ltYWdlTnVtYmVyTGFiZWwpIHtcbiAgICAgICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLW51bWJlcicpLnRleHQodGhpcy5vcHRpb25zLmFsYnVtTGFiZWwodGhpcy5jdXJyZW50SW1hZ2VJbmRleCArIDEsIHRoaXMuYWxidW0ubGVuZ3RoKSkuZmFkZUluKCdmYXN0Jyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLiRsaWdodGJveC5maW5kKCcubGItbnVtYmVyJykuaGlkZSgpO1xuICAgICAgfVxuICAgIFxuICAgICAgdGhpcy4kb3V0ZXJDb250YWluZXIucmVtb3ZlQ2xhc3MoJ2FuaW1hdGluZycpO1xuICAgIFxuICAgICAgdGhpcy4kbGlnaHRib3guZmluZCgnLmxiLWRhdGFDb250YWluZXInKS5mYWRlSW4odGhpcy5vcHRpb25zLnJlc2l6ZUR1cmF0aW9uLCBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIHNlbGYuc2l6ZU92ZXJsYXkoKTtcbiAgICAgIH0pO1xuICAgIH07XG5cbiAgICAvLyBQcmVsb2FkIHByZXZpb3VzIGFuZCBuZXh0IGltYWdlcyBpbiBzZXQuXG4gICAgTGlnaHRib3gucHJvdG90eXBlLnByZWxvYWROZWlnaGJvcmluZ0ltYWdlcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKHRoaXMuYWxidW0ubGVuZ3RoID4gdGhpcy5jdXJyZW50SW1hZ2VJbmRleCArIDEpIHtcbiAgICAgICAgdmFyIHByZWxvYWROZXh0ID0gbmV3IEltYWdlKCk7XG4gICAgICAgIHByZWxvYWROZXh0LnNyYyA9IHRoaXMuYWxidW1bdGhpcy5jdXJyZW50SW1hZ2VJbmRleCArIDFdLmxpbms7XG4gICAgICB9XG4gICAgICBpZiAodGhpcy5jdXJyZW50SW1hZ2VJbmRleCA+IDApIHtcbiAgICAgICAgdmFyIHByZWxvYWRQcmV2ID0gbmV3IEltYWdlKCk7XG4gICAgICAgIHByZWxvYWRQcmV2LnNyYyA9IHRoaXMuYWxidW1bdGhpcy5jdXJyZW50SW1hZ2VJbmRleCAtIDFdLmxpbms7XG4gICAgICB9XG4gICAgfTtcblxuICAgIExpZ2h0Ym94LnByb3RvdHlwZS5lbmFibGVLZXlib2FyZE5hdiA9IGZ1bmN0aW9uKCkge1xuICAgICAgJChkb2N1bWVudCkub24oJ2tleXVwLmtleWJvYXJkJywgJC5wcm94eSh0aGlzLmtleWJvYXJkQWN0aW9uLCB0aGlzKSk7XG4gICAgfTtcblxuICAgIExpZ2h0Ym94LnByb3RvdHlwZS5kaXNhYmxlS2V5Ym9hcmROYXYgPSBmdW5jdGlvbigpIHtcbiAgICAgICQoZG9jdW1lbnQpLm9mZignLmtleWJvYXJkJyk7XG4gICAgfTtcblxuICAgIExpZ2h0Ym94LnByb3RvdHlwZS5rZXlib2FyZEFjdGlvbiA9IGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICB2YXIgS0VZQ09ERV9FU0MgICAgICAgID0gMjc7XG4gICAgICB2YXIgS0VZQ09ERV9MRUZUQVJST1cgID0gMzc7XG4gICAgICB2YXIgS0VZQ09ERV9SSUdIVEFSUk9XID0gMzk7XG5cbiAgICAgIHZhciBrZXljb2RlID0gZXZlbnQua2V5Q29kZTtcbiAgICAgIHZhciBrZXkgICAgID0gU3RyaW5nLmZyb21DaGFyQ29kZShrZXljb2RlKS50b0xvd2VyQ2FzZSgpO1xuICAgICAgaWYgKGtleWNvZGUgPT09IEtFWUNPREVfRVNDIHx8IGtleS5tYXRjaCgveHxvfGMvKSkge1xuICAgICAgICB0aGlzLmVuZCgpO1xuICAgICAgfSBlbHNlIGlmIChrZXkgPT09ICdwJyB8fCBrZXljb2RlID09PSBLRVlDT0RFX0xFRlRBUlJPVykge1xuICAgICAgICBpZiAodGhpcy5jdXJyZW50SW1hZ2VJbmRleCAhPT0gMCkge1xuICAgICAgICAgIHRoaXMuY2hhbmdlSW1hZ2UodGhpcy5jdXJyZW50SW1hZ2VJbmRleCAtIDEpO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMub3B0aW9ucy53cmFwQXJvdW5kICYmIHRoaXMuYWxidW0ubGVuZ3RoID4gMSkge1xuICAgICAgICAgIHRoaXMuY2hhbmdlSW1hZ2UodGhpcy5hbGJ1bS5sZW5ndGggLSAxKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIGlmIChrZXkgPT09ICduJyB8fCBrZXljb2RlID09PSBLRVlDT0RFX1JJR0hUQVJST1cpIHtcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudEltYWdlSW5kZXggIT09IHRoaXMuYWxidW0ubGVuZ3RoIC0gMSkge1xuICAgICAgICAgIHRoaXMuY2hhbmdlSW1hZ2UodGhpcy5jdXJyZW50SW1hZ2VJbmRleCArIDEpO1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMub3B0aW9ucy53cmFwQXJvdW5kICYmIHRoaXMuYWxidW0ubGVuZ3RoID4gMSkge1xuICAgICAgICAgIHRoaXMuY2hhbmdlSW1hZ2UoMCk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9O1xuXG4gICAgLy8gQ2xvc2luZyB0aW1lLiA6LShcbiAgICBMaWdodGJveC5wcm90b3R5cGUuZW5kID0gZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLmRpc2FibGVLZXlib2FyZE5hdigpO1xuICAgICAgJCh3aW5kb3cpLm9mZihcInJlc2l6ZVwiLCB0aGlzLnNpemVPdmVybGF5KTtcbiAgICAgIHRoaXMuJGxpZ2h0Ym94LmZhZGVPdXQodGhpcy5vcHRpb25zLmZhZGVEdXJhdGlvbik7XG4gICAgICB0aGlzLiRvdmVybGF5LmZhZGVPdXQodGhpcy5vcHRpb25zLmZhZGVEdXJhdGlvbik7XG4gICAgICAkKCdzZWxlY3QsIG9iamVjdCwgZW1iZWQnKS5jc3Moe1xuICAgICAgICB2aXNpYmlsaXR5OiBcInZpc2libGVcIlxuICAgICAgfSk7XG4gICAgfTtcblxuICAgIHJldHVybiBMaWdodGJveDtcblxuICB9KSgpO1xuXG4gICQoZnVuY3Rpb24oKSB7XG4gICAgdmFyIG9wdGlvbnMgID0gbmV3IExpZ2h0Ym94T3B0aW9ucygpO1xuICAgIHZhciBsaWdodGJveCA9IG5ldyBMaWdodGJveChvcHRpb25zKTtcbiAgfSk7XG5cbn0pLmNhbGwodGhpcyk7XG4iLCIvKiFcbiAqIG1vbmV5LmpzIC8gZngoKSB2MC4yXG4gKiBDb3B5cmlnaHQgMjAxNCBPcGVuIEV4Y2hhbmdlIFJhdGVzXG4gKlxuICogSmF2YVNjcmlwdCBsaWJyYXJ5IGZvciByZWFsdGltZSBjdXJyZW5jeSBjb252ZXJzaW9uIGFuZCBleGNoYW5nZSByYXRlIGNhbGN1bGF0aW9uLlxuICpcbiAqIEZyZWVseSBkaXN0cmlidXRhYmxlIHVuZGVyIHRoZSBNSVQgbGljZW5zZS5cbiAqIFBvcnRpb25zIG9mIG1vbmV5LmpzIGFyZSBpbnNwaXJlZCBieSBvciBib3Jyb3dlZCBmcm9tIHVuZGVyc2NvcmUuanNcbiAqXG4gKiBGb3IgZGV0YWlscywgZXhhbXBsZXMgYW5kIGRvY3VtZW50YXRpb246XG4gKiBodHRwOi8vb3BlbmV4Y2hhbmdlcmF0ZXMuZ2l0aHViLmlvL21vbmV5LmpzL1xuICovXG4oZnVuY3Rpb24ocm9vdCwgdW5kZWZpbmVkKSB7XG5cblx0Ly8gQ3JlYXRlIGEgc2FmZSByZWZlcmVuY2UgdG8gdGhlIG1vbmV5LmpzIG9iamVjdCBmb3IgdXNlIGJlbG93LlxuXHR2YXIgZnggPSBmdW5jdGlvbihvYmopIHtcblx0XHRyZXR1cm4gbmV3IGZ4V3JhcHBlcihvYmopO1xuXHR9O1xuXG5cdC8vIEN1cnJlbnQgdmVyc2lvbi5cblx0ZngudmVyc2lvbiA9ICcwLjInO1xuXG5cblx0LyogLS0tIFNldHVwIC0tLSAqL1xuXG5cdC8vIGZ4U2V0dXAgY2FuIGJlIGRlZmluZWQgYmVmb3JlIGxvYWRpbmcgbW9uZXkuanMsIHRvIHNldCB0aGUgZXhjaGFuZ2UgcmF0ZXMgYW5kIHRoZSBiYXNlXG5cdC8vIChhbmQgZGVmYXVsdCBmcm9tL3RvKSBjdXJyZW5jaWVzIC0gb3IgdGhlIHJhdGVzIGNhbiBiZSBsb2FkZWQgaW4gbGF0ZXIgaWYgbmVlZGVkLlxuXHR2YXIgZnhTZXR1cCA9IHJvb3QuZnhTZXR1cCB8fCB7XG5cdFx0cmF0ZXMgOiB7fSxcblx0XHRiYXNlIDogXCJcIlxuXHR9O1xuXG5cdC8vIE9iamVjdCBjb250YWluaW5nIGV4Y2hhbmdlIHJhdGVzIHJlbGF0aXZlIHRvIHRoZSBmeC5iYXNlIGN1cnJlbmN5LCBlZyB7IFwiR0JQXCIgOiBcIjAuNjRcIiB9XG5cdGZ4LnJhdGVzID0gZnhTZXR1cC5yYXRlcztcblxuXHQvLyBEZWZhdWx0IGV4Y2hhbmdlIHJhdGUgYmFzZSBjdXJyZW5jeSAoZWcgXCJVU0RcIiksIHdoaWNoIGFsbCB0aGUgZXhjaGFuZ2UgcmF0ZXMgYXJlIHJlbGF0aXZlIHRvXG5cdGZ4LmJhc2UgPSBmeFNldHVwLmJhc2U7XG5cblx0Ly8gRGVmYXVsdCBmcm9tIC8gdG8gY3VycmVuY2llcyBmb3IgY29udmVyc2lvbiB2aWEgZnguY29udmVydCgpOlxuXHRmeC5zZXR0aW5ncyA9IHtcblx0XHRmcm9tIDogZnhTZXR1cC5mcm9tIHx8IGZ4LmJhc2UsXG5cdFx0dG8gOiBmeFNldHVwLnRvIHx8IGZ4LmJhc2Vcblx0fTtcblxuXG5cdC8qIC0tLSBDb252ZXJzaW9uIC0tLSAqL1xuXG5cdC8vIFRoZSBiYXNlIGZ1bmN0aW9uIG9mIHRoZSBsaWJyYXJ5OiBjb252ZXJ0cyBhIHZhbHVlIGZyb20gb25lIGN1cnJlbmN5IHRvIGFub3RoZXJcblx0dmFyIGNvbnZlcnQgPSBmeC5jb252ZXJ0ID0gZnVuY3Rpb24odmFsLCBvcHRzKSB7XG5cdFx0Ly8gQ29udmVydCBhcnJheXMgcmVjdXJzaXZlbHlcblx0XHRpZiAodHlwZW9mIHZhbCA9PT0gJ29iamVjdCcgJiYgdmFsLmxlbmd0aCkge1xuXHRcdFx0Zm9yICh2YXIgaSA9IDA7IGk8IHZhbC5sZW5ndGg7IGkrKyApIHtcblx0XHRcdFx0dmFsW2ldID0gY29udmVydCh2YWxbaV0sIG9wdHMpO1xuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHZhbDtcblx0XHR9XG5cblx0XHQvLyBNYWtlIHN1cmUgd2UgZ290cyBzb21lIG9wdHNcblx0XHRvcHRzID0gb3B0cyB8fCB7fTtcblxuXHRcdC8vIFdlIG5lZWQgdG8ga25vdyB0aGUgYGZyb21gIGFuZCBgdG9gIGN1cnJlbmNpZXNcblx0XHRpZiggIW9wdHMuZnJvbSApIG9wdHMuZnJvbSA9IGZ4LnNldHRpbmdzLmZyb207XG5cdFx0aWYoICFvcHRzLnRvICkgb3B0cy50byA9IGZ4LnNldHRpbmdzLnRvO1xuXG5cdFx0Ly8gTXVsdGlwbGUgdGhlIHZhbHVlIGJ5IHRoZSBleGNoYW5nZSByYXRlXG5cdFx0cmV0dXJuIHZhbCAqIGdldFJhdGUoIG9wdHMudG8sIG9wdHMuZnJvbSApO1xuXHR9O1xuXG5cdC8vIFJldHVybnMgdGhlIGV4Y2hhbmdlIHJhdGUgdG8gYHRhcmdldGAgY3VycmVuY3kgZnJvbSBgYmFzZWAgY3VycmVuY3lcblx0dmFyIGdldFJhdGUgPSBmdW5jdGlvbih0bywgZnJvbSkge1xuXHRcdC8vIFNhdmUgYnl0ZXMgaW4gbWluaWZpZWQgdmVyc2lvblxuXHRcdHZhciByYXRlcyA9IGZ4LnJhdGVzO1xuXG5cdFx0Ly8gTWFrZSBzdXJlIHRoZSBiYXNlIHJhdGUgaXMgaW4gdGhlIHJhdGVzIG9iamVjdDpcblx0XHRyYXRlc1tmeC5iYXNlXSA9IDE7XG5cblx0XHQvLyBUaHJvdyBhbiBlcnJvciBpZiBlaXRoZXIgcmF0ZSBpc24ndCBpbiB0aGUgcmF0ZXMgYXJyYXlcblx0XHRpZiAoICFyYXRlc1t0b10gfHwgIXJhdGVzW2Zyb21dICkgdGhyb3cgXCJmeCBlcnJvclwiO1xuXG5cdFx0Ly8gSWYgYGZyb21gIGN1cnJlbmN5ID09PSBmeC5iYXNlLCByZXR1cm4gdGhlIGJhc2ljIGV4Y2hhbmdlIHJhdGUgZm9yIHRoZSBgdG9gIGN1cnJlbmN5XG5cdFx0aWYgKCBmcm9tID09PSBmeC5iYXNlICkge1xuXHRcdFx0cmV0dXJuIHJhdGVzW3RvXTtcblx0XHR9XG5cblx0XHQvLyBJZiBgdG9gIGN1cnJlbmN5ID09PSBmeC5iYXNlLCByZXR1cm4gdGhlIGJhc2ljIGludmVyc2UgcmF0ZSBvZiB0aGUgYGZyb21gIGN1cnJlbmN5XG5cdFx0aWYgKCB0byA9PT0gZnguYmFzZSApIHtcblx0XHRcdHJldHVybiAxIC8gcmF0ZXNbZnJvbV07XG5cdFx0fVxuXG5cdFx0Ly8gT3RoZXJ3aXNlLCByZXR1cm4gdGhlIGB0b2AgcmF0ZSBtdWx0aXBsZWQgYnkgdGhlIGludmVyc2Ugb2YgdGhlIGBmcm9tYCByYXRlIHRvIGdldCB0aGVcblx0XHQvLyByZWxhdGl2ZSBleGNoYW5nZSByYXRlIGJldHdlZW4gdGhlIHR3byBjdXJyZW5jaWVzXG5cdFx0cmV0dXJuIHJhdGVzW3RvXSAqICgxIC8gcmF0ZXNbZnJvbV0pO1xuXHR9O1xuXG5cblx0LyogLS0tIE9PUCB3cmFwcGVyIGFuZCBjaGFpbmluZyAtLS0gKi9cblxuXHQvLyBJZiBmeCh2YWwpIGlzIGNhbGxlZCBhcyBhIGZ1bmN0aW9uLCBpdCByZXR1cm5zIGEgd3JhcHBlZCBvYmplY3QgdGhhdCBjYW4gYmUgdXNlZCBPTy1zdHlsZVxuXHR2YXIgZnhXcmFwcGVyID0gZnVuY3Rpb24odmFsKSB7XG5cdFx0Ly8gRXhwZXJpbWVudGFsOiBwYXJzZSBzdHJpbmdzIHRvIHB1bGwgb3V0IGN1cnJlbmN5IGNvZGUgYW5kIHZhbHVlOlxuXHRcdGlmICggdHlwZW9mXHR2YWwgPT09IFwic3RyaW5nXCIgKSB7XG5cdFx0XHR0aGlzLl92ID0gcGFyc2VGbG9hdCh2YWwucmVwbGFjZSgvW14wLTktLl0vZywgXCJcIikpO1xuXHRcdFx0dGhpcy5fZnggPSB2YWwucmVwbGFjZSgvKFteQS1aYS16XSkvZywgXCJcIik7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHRoaXMuX3YgPSB2YWw7XG5cdFx0fVxuXHR9O1xuXG5cdC8vIEV4cG9zZSBgd3JhcHBlci5wcm90b3R5cGVgIGFzIGBmeC5wcm90b3R5cGVgXG5cdHZhciBmeFByb3RvID0gZngucHJvdG90eXBlID0gZnhXcmFwcGVyLnByb3RvdHlwZTtcblxuXHQvLyBmeCh2YWwpLmNvbnZlcnQob3B0cykgZG9lcyB0aGUgc2FtZSB0aGluZyBhcyBmeC5jb252ZXJ0KHZhbCwgb3B0cylcblx0ZnhQcm90by5jb252ZXJ0ID0gZnVuY3Rpb24oKSB7XG5cdFx0dmFyIGFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMpO1xuXHRcdGFyZ3MudW5zaGlmdCh0aGlzLl92KTtcblx0XHRyZXR1cm4gY29udmVydC5hcHBseShmeCwgYXJncyk7XG5cdH07XG5cblx0Ly8gZngodmFsKS5mcm9tKGN1cnJlbmN5KSByZXR1cm5zIGEgd3JhcHBlZCBgZnhgIHdoZXJlIHRoZSB2YWx1ZSBoYXMgYmVlbiBjb252ZXJ0ZWQgZnJvbVxuXHQvLyBgY3VycmVuY3lgIHRvIHRoZSBgZnguYmFzZWAgY3VycmVuY3kuIFNob3VsZCBiZSBmb2xsb3dlZCBieSBgLnRvKG90aGVyQ3VycmVuY3kpYFxuXHRmeFByb3RvLmZyb20gPSBmdW5jdGlvbihjdXJyZW5jeSkge1xuXHRcdHZhciB3cmFwcGVkID0gZngoY29udmVydCh0aGlzLl92LCB7ZnJvbTogY3VycmVuY3ksIHRvOiBmeC5iYXNlfSkpO1xuXHRcdHdyYXBwZWQuX2Z4ID0gZnguYmFzZTtcblx0XHRyZXR1cm4gd3JhcHBlZDtcblx0fTtcblxuXHQvLyBmeCh2YWwpLnRvKGN1cnJlbmN5KSByZXR1cm5zIHRoZSB2YWx1ZSwgY29udmVydGVkIGZyb20gYGZ4LmJhc2VgIHRvIGBjdXJyZW5jeWBcblx0ZnhQcm90by50byA9IGZ1bmN0aW9uKGN1cnJlbmN5KSB7XG5cdFx0cmV0dXJuIGNvbnZlcnQodGhpcy5fdiwge2Zyb206IHRoaXMuX2Z4ID8gdGhpcy5fZnggOiBmeC5zZXR0aW5ncy5mcm9tLCB0bzogY3VycmVuY3l9KTtcblx0fTtcblxuXG5cdC8qIC0tLSBNb2R1bGUgRGVmaW5pdGlvbiAtLS0gKi9cblxuXHQvLyBFeHBvcnQgdGhlIGZ4IG9iamVjdCBmb3IgQ29tbW9uSlMuIElmIGJlaW5nIGxvYWRlZCBhcyBhbiBBTUQgbW9kdWxlLCBkZWZpbmUgaXQgYXMgc3VjaC5cblx0Ly8gT3RoZXJ3aXNlLCBqdXN0IGFkZCBgZnhgIHRvIHRoZSBnbG9iYWwgb2JqZWN0XG5cdGlmICh0eXBlb2YgZXhwb3J0cyAhPT0gJ3VuZGVmaW5lZCcpIHtcblx0XHRpZiAodHlwZW9mIG1vZHVsZSAhPT0gJ3VuZGVmaW5lZCcgJiYgbW9kdWxlLmV4cG9ydHMpIHtcblx0XHRcdGV4cG9ydHMgPSBtb2R1bGUuZXhwb3J0cyA9IGZ4O1xuXHRcdH1cblx0XHRleHBvcnRzLmZ4ID0gZng7XG5cdH0gZWxzZSBpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XG5cdFx0Ly8gUmV0dXJuIHRoZSBsaWJyYXJ5IGFzIGFuIEFNRCBtb2R1bGU6XG5cdFx0ZGVmaW5lKFtdLCBmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiBmeDtcblx0XHR9KTtcblx0fSBlbHNlIHtcblx0XHQvLyBVc2UgZngubm9Db25mbGljdCB0byByZXN0b3JlIGBmeGAgYmFjayB0byBpdHMgb3JpZ2luYWwgdmFsdWUgYmVmb3JlIG1vbmV5LmpzIGxvYWRlZC5cblx0XHQvLyBSZXR1cm5zIGEgcmVmZXJlbmNlIHRvIHRoZSBsaWJyYXJ5J3MgYGZ4YCBvYmplY3Q7IGUuZy4gYHZhciBtb25leSA9IGZ4Lm5vQ29uZmxpY3QoKTtgXG5cdFx0Zngubm9Db25mbGljdCA9IChmdW5jdGlvbihwcmV2aW91c0Z4KSB7XG5cdFx0XHRyZXR1cm4gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdC8vIFJlc2V0IHRoZSB2YWx1ZSBvZiB0aGUgcm9vdCdzIGBmeGAgdmFyaWFibGU6XG5cdFx0XHRcdHJvb3QuZnggPSBwcmV2aW91c0Z4O1xuXHRcdFx0XHQvLyBEZWxldGUgdGhlIG5vQ29uZmxpY3QgZnVuY3Rpb246XG5cdFx0XHRcdGZ4Lm5vQ29uZmxpY3QgPSB1bmRlZmluZWQ7XG5cdFx0XHRcdC8vIFJldHVybiByZWZlcmVuY2UgdG8gdGhlIGxpYnJhcnkgdG8gcmUtYXNzaWduIGl0OlxuXHRcdFx0XHRyZXR1cm4gZng7XG5cdFx0XHR9O1xuXHRcdH0pKHJvb3QuZngpO1xuXG5cdFx0Ly8gRGVjbGFyZSBgZnhgIG9uIHRoZSByb290IChnbG9iYWwvd2luZG93KSBvYmplY3Q6XG5cdFx0cm9vdFsnZngnXSA9IGZ4O1xuXHR9XG5cblx0Ly8gUm9vdCB3aWxsIGJlIGB3aW5kb3dgIGluIGJyb3dzZXIgb3IgYGdsb2JhbGAgb24gdGhlIHNlcnZlcjpcbn0odGhpcykpO1xuIiwiLyo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XHJcbiAqIEBuYW1lOiBiUG9wdXBcclxuICogQHR5cGU6IGpRdWVyeVxyXG4gKiBAYXV0aG9yOiAoYykgQmpvZXJuIEtsaW5nZ2FhcmQgLSBAYmtsaW5nZ2FhcmRcclxuICogQGRlbW86IGh0dHA6Ly9kaW5icm9yLmRrL2Jwb3B1cFxyXG4gKiBAdmVyc2lvbjogMC4xMC4wXHJcbiAqIEByZXF1aXJlcyBqUXVlcnkgMS40LjNcclxuICo9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0qL1xyXG47KGZ1bmN0aW9uKCQpIHtcclxuXHQndXNlIHN0cmljdCc7XHJcblx0XHJcbiAgICAkLmZuLmJQb3B1cCA9IGZ1bmN0aW9uKG9wdGlvbnMsIGNhbGxiYWNrKSB7XHJcbiAgICAgICAgXHJcbiAgICBcdGlmICgkLmlzRnVuY3Rpb24ob3B0aW9ucykpIHtcclxuICAgICAgICAgICAgY2FsbGJhY2sgXHRcdD0gb3B0aW9ucztcclxuICAgICAgICAgICAgb3B0aW9ucyBcdFx0PSBudWxsO1xyXG4gICAgICAgIH1cclxuXHJcblx0XHQvLyBPUFRJT05TXHJcbiAgICAgICAgdmFyIG8gXHRcdFx0XHQ9ICQuZXh0ZW5kKHt9LCAkLmZuLmJQb3B1cC5kZWZhdWx0cywgb3B0aW9ucyk7XHJcblx0XHRcclxuXHRcdC8vIEhJREUgU0NST0xMQkFSPyAgXHJcbiAgICAgICAgaWYgKCFvLnNjcm9sbEJhcilcclxuICAgICAgICAgICAgJCgnaHRtbCcpLmNzcygnb3ZlcmZsb3cnLCAnaGlkZGVuJyk7XHJcbiAgICAgICAgXHJcblx0XHQvLyBWQVJJQUJMRVNcdFxyXG4gICAgICAgIHZhciAkcG9wdXAgXHRcdFx0PSB0aGlzXHJcbiAgICAgICAgICAsICAkdGhpcyAgICAgICAgICAgICAgICAgICAgICAgPSAkKHRoaXMpXHJcbiAgICAgICAgICAsIGQgXHRcdFx0XHQ9ICQoZG9jdW1lbnQpXHJcbiAgICAgICAgICAsIHcgXHRcdFx0XHQ9IHdpbmRvd1xyXG5cdFx0ICAsICR3XHRcdFx0XHQ9ICQodylcclxuICAgICAgICAgICwgd0hcdFx0XHRcdD0gd2luZG93SGVpZ2h0KClcclxuXHRcdCAgLCB3V1x0XHRcdFx0PSB3aW5kb3dXaWR0aCgpXHJcbiAgICAgICAgICAsIHByZWZpeFx0XHRcdD0gJ19fYi1wb3B1cCdcclxuXHRcdCAgLCBpc0lPUzZYXHRcdFx0PSAoL09TIDYoX1xcZCkrL2kpLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCkgLy8gVXNlZCBmb3IgYSB0ZW1wb3JhcnkgZml4IGZvciBpb3M2IHRpbWVyIGJ1ZyB3aGVuIHVzaW5nIHpvb20vc2Nyb2xsIFxyXG4gICAgICAgICAgLCBidWZmZXJcdFx0XHQ9IDIwMFxyXG5cdFx0ICAsIHBvcHVwc1x0XHRcdD0gMFxyXG4gICAgICAgICAgLCBpZFxyXG4gICAgICAgICAgLCBpbnNpZGVcclxuICAgICAgICAgICwgZml4ZWRWUG9zXHJcbiAgICAgICAgICAsIGZpeGVkSFBvc1xyXG4gICAgICAgICAgLCBmaXhlZFBvc1N0eWxlXHJcblx0XHQgICwgdlBvc1xyXG4gICAgICAgICAgLCBoUG9zXHJcblx0XHQgICwgaGVpZ2h0XHJcblx0XHQgICwgd2lkdGhcclxuXHRcdCAgLCBkZWJvdW5jZVxyXG5cdFx0ICAsIGF1dG9DbG9zZVRPXHJcblx0XHQ7XHJcblxyXG4gICAgICAgIC8qIFBVQkxJQyBGVU5DVElPTiAtIGNhbGwgaXQ6ICQoZWxlbWVudCkuYlBvcHVwKCkuY2xvc2UoKTsqL1xyXG4gICAgICAgICRwb3B1cC5jbG9zZSA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBfaW5pdCgpO1xyXG4gICAgICAgICAgICBfY2xvc2UoKTtcclxuICAgICAgICB9O1xyXG5cdFx0XHJcbiAgICAgICAgJHBvcHVwLnJlcG9zaXRpb24gPSBmdW5jdGlvbihhbmltYXRlU3BlZWQpIHtcclxuICAgICAgICAgICAgcmVwb3NpdGlvbihhbmltYXRlU3BlZWQpO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiAkcG9wdXAuZWFjaChmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaWYgKCQodGhpcykuZGF0YSgnYlBvcHVwJykpIHJldHVybjsgLypQT1BVUCBhbHJlYWR5IGV4aXN0cz8qL1xyXG4gICAgICAgICAgICBpbml0KCk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIF9pbml0KCkge1xyXG4gICAgICAgICAgICB0cmlnZ2VyQ2FsbChvLm9uT3Blbik7XHJcblx0XHRcdHBvcHVwcyA9ICgkdy5kYXRhKCdiUG9wdXAnKSB8fCAwKSwgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlkID0gcHJlZml4ICsgcG9wdXBzICsgJ19fJyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgZml4ZWRWUG9zID0gby5wb3NpdGlvblsxXSAhPT0gJ2F1dG8nLCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgZml4ZWRIUG9zID0gby5wb3NpdGlvblswXSAhPT0gJ2F1dG8nLCBcclxuICAgICAgICAgICAgICAgICAgICAgICAgZml4ZWRQb3NTdHlsZSA9IG8ucG9zaXRpb25TdHlsZSA9PT0gJ2ZpeGVkJywgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGhlaWdodCA9ICRwb3B1cC5vdXRlckhlaWdodCh0cnVlKSwgXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpZHRoID0gJHBvcHVwLm91dGVyV2lkdGgodHJ1ZSk7XHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gby5sb2FkVXJsID8gY3JlYXRlQ29udGVudCgpIDogb3BlbigpO1xyXG4gICAgICAgIH07XHJcbiAgICAgICAgXHJcbiAgICAgICAgZnVuY3Rpb24gX2Nsb3NlKCkge1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gYWxlcnQoaWQsICRwb3B1cC5kYXRhKCdpZCcpLCAkcG9wdXAuZGF0YSgnYlBvcHVwJykpO1xyXG4gICAgICAgICAgICBpZiAoby5tb2RhbCkge1xyXG4gICAgICAgICAgICAgICAgJCgnLmItbW9kYWwuJytpZClcclxuXHQgICAgICAgICAgICAgICAgLmZhZGVUbyhvLnNwZWVkLCAwLCBmdW5jdGlvbigpIHtcclxuXHQgICAgICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlKCk7XHJcblx0ICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIENsZWFuIHVwXHJcbiAgICAgICAgICAgIHVuYmluZEV2ZW50cygpO1x0XHJcbiAgICAgICAgICAgIGNsZWFyVGltZW91dChhdXRvQ2xvc2VUTyk7XHJcbiAgICAgICAgICAgIC8vIENsb3NlIHRyYXNpdGlvblxyXG4gICAgICAgICAgICBkb1RyYW5zaXRpb24oKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTsgLy8gUHJldmVudCBkZWZhdWx0XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLyogSEVMUEVSIEZVTkNUSU9OUyAtIFBSSVZBVEUqL1xyXG4gICAgICAgIGZ1bmN0aW9uIGluaXQoKSB7XHJcbiAgICAgICAgICAgIHRyaWdnZXJDYWxsKG8ub25PcGVuKTtcclxuXHRcdFx0cG9wdXBzID0gKCR3LmRhdGEoJ2JQb3B1cCcpIHx8IDApICsgMSwgaWQgPSBwcmVmaXggKyBwb3B1cHMgKyAnX18nLGZpeGVkVlBvcyA9IG8ucG9zaXRpb25bMV0gIT09ICdhdXRvJywgZml4ZWRIUG9zID0gby5wb3NpdGlvblswXSAhPT0gJ2F1dG8nLCBmaXhlZFBvc1N0eWxlID0gby5wb3NpdGlvblN0eWxlID09PSAnZml4ZWQnLCBoZWlnaHQgPSAkcG9wdXAub3V0ZXJIZWlnaHQodHJ1ZSksIHdpZHRoID0gJHBvcHVwLm91dGVyV2lkdGgodHJ1ZSk7XHJcbiAgICAgICAgICAgIG8ubG9hZFVybCA/IGNyZWF0ZUNvbnRlbnQoKSA6IG9wZW4oKTtcclxuICAgICAgICB9O1xyXG5cdFx0XHJcblx0XHRmdW5jdGlvbiBjcmVhdGVDb250ZW50KCkge1xyXG4gICAgICAgICAgICBvLmNvbnRlbnRDb250YWluZXIgPSAkKG8uY29udGVudENvbnRhaW5lciB8fCAkcG9wdXApO1xyXG4gICAgICAgICAgICBzd2l0Y2ggKG8uY29udGVudCkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAoJ2lmcmFtZScpOlxyXG5cdFx0XHRcdFx0dmFyIGlmcmFtZSA9ICQoJzxpZnJhbWUgY2xhc3M9XCJiLWlmcmFtZVwiICcgKyBvLmlmcmFtZUF0dHIgKyc+PC9pZnJhbWU+Jyk7XHJcblx0XHRcdFx0XHRpZnJhbWUuYXBwZW5kVG8oby5jb250ZW50Q29udGFpbmVyKTtcclxuXHRcdFx0XHRcdGhlaWdodCA9ICRwb3B1cC5vdXRlckhlaWdodCh0cnVlKTtcclxuXHRcdFx0XHRcdHdpZHRoID0gJHBvcHVwLm91dGVyV2lkdGgodHJ1ZSk7XHJcblx0XHRcdFx0XHRvcGVuKCk7XHJcblx0XHRcdFx0XHRpZnJhbWUuYXR0cignc3JjJywgby5sb2FkVXJsKTsgLy8gc2V0dGluZyBpZnJhbWUgc3JjIGFmdGVyIG9wZW4gZHVlIElFOSBidWdcclxuXHRcdFx0XHRcdHRyaWdnZXJDYWxsKG8ubG9hZENhbGxiYWNrKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuXHRcdFx0XHRjYXNlICgnaW1hZ2UnKTpcclxuXHRcdFx0XHRcdG9wZW4oKTtcclxuXHRcdFx0XHRcdCQoJzxpbWcgLz4nKVxyXG5cdFx0XHRcdFx0XHQubG9hZChmdW5jdGlvbigpIHtcclxuXHRcdFx0XHRcdFx0ICAgIHRyaWdnZXJDYWxsKG8ubG9hZENhbGxiYWNrKTtcclxuXHRcdFx0XHRcdFx0XHRyZWNlbnRlcigkKHRoaXMpKTtcclxuXHRcdFx0XHRcdCAgICB9KS5hdHRyKCdzcmMnLCBvLmxvYWRVcmwpLmhpZGUoKS5hcHBlbmRUbyhvLmNvbnRlbnRDb250YWluZXIpO1xyXG5cdFx0XHRcdFx0YnJlYWs7XHJcbiAgICAgICAgICAgICAgICBkZWZhdWx0OlxyXG5cdFx0XHRcdFx0b3BlbigpO1xyXG5cdFx0XHRcdFx0JCgnPGRpdiBjbGFzcz1cImItYWpheC13cmFwcGVyXCI+PC9kaXY+JylcclxuICAgICAgICAgICAgICAgICAgICBcdC5sb2FkKG8ubG9hZFVybCwgby5sb2FkRGF0YSwgZnVuY3Rpb24ocmVzcG9uc2UsIHN0YXR1cywgeGhyKSB7XHJcblx0XHRcdFx0XHRcdCAgICB0cmlnZ2VyQ2FsbChvLmxvYWRDYWxsYmFjaywgc3RhdHVzKTtcclxuXHRcdFx0XHRcdFx0XHRyZWNlbnRlcigkKHRoaXMpKTtcclxuXHRcdFx0XHRcdFx0fSkuaGlkZSgpLmFwcGVuZFRvKG8uY29udGVudENvbnRhaW5lcik7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG5cclxuXHRcdGZ1bmN0aW9uIG9wZW4oKXtcclxuXHRcdFx0Ly8gTU9EQUwgT1ZFUkxBWVxyXG4gICAgICAgICAgICBpZiAoby5tb2RhbCkge1xyXG4gICAgICAgICAgICAgICAgJCgnPGRpdiBjbGFzcz1cImItbW9kYWwgJytpZCsnXCI+PC9kaXY+JylcclxuICAgICAgICAgICAgICAgIC5jc3Moe2JhY2tncm91bmRDb2xvcjogby5tb2RhbENvbG9yLCBwb3NpdGlvbjogJ2ZpeGVkJywgdG9wOiAwLCByaWdodDowLCBib3R0b206MCwgbGVmdDogMCwgb3BhY2l0eTogMCwgekluZGV4OiBvLnpJbmRleCArIHBvcHVwc30pXHJcbiAgICAgICAgICAgICAgICAuYXBwZW5kVG8oby5hcHBlbmRUbylcclxuICAgICAgICAgICAgICAgIC5mYWRlVG8oby5zcGVlZCwgby5vcGFjaXR5KTtcclxuICAgICAgICAgICAgfVxyXG5cdFx0XHRcclxuXHRcdFx0Ly8gUE9QVVBcclxuXHRcdFx0Y2FsY1Bvc2l0aW9uKCk7XHJcbiAgICAgICAgICAgICRwb3B1cFxyXG5cdFx0XHRcdC5kYXRhKCdiUG9wdXAnLCBvKS5kYXRhKCdpZCcsaWQpXHJcblx0XHRcdFx0LmNzcyh7IFxyXG5cdFx0XHRcdFx0ICAnbGVmdCc6IG8udHJhbnNpdGlvbiA9PSAnc2xpZGVJbicgfHwgby50cmFuc2l0aW9uID09ICdzbGlkZUJhY2snID8gKG8udHJhbnNpdGlvbiA9PSAnc2xpZGVCYWNrJyA/IGQuc2Nyb2xsTGVmdCgpICsgd1cgOiAoaFBvcyArIHdpZHRoKSAqLTEpIDogZ2V0TGVmdFBvcyghKCFvLmZvbGxvd1swXSAmJiBmaXhlZEhQb3MgfHwgZml4ZWRQb3NTdHlsZSkpXHJcblx0XHRcdFx0XHQsICdwb3NpdGlvbic6IG8ucG9zaXRpb25TdHlsZSB8fCAnYWJzb2x1dGUnXHJcblx0XHRcdFx0XHQsICd0b3AnOiBvLnRyYW5zaXRpb24gPT0gJ3NsaWRlRG93bicgfHwgby50cmFuc2l0aW9uID09ICdzbGlkZVVwJyA/IChvLnRyYW5zaXRpb24gPT0gJ3NsaWRlVXAnID8gZC5zY3JvbGxUb3AoKSArIHdIIDogdlBvcyArIGhlaWdodCAqIC0xKSA6IGdldFRvcFBvcyghKCFvLmZvbGxvd1sxXSAmJiBmaXhlZFZQb3MgfHwgZml4ZWRQb3NTdHlsZSkpXHJcblx0XHRcdFx0XHQsICd6LWluZGV4Jzogby56SW5kZXggKyBwb3B1cHMgKyAxIFxyXG5cdFx0XHRcdH0pLmVhY2goZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIFx0XHRpZihvLmFwcGVuZGluZykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICQodGhpcykuYXBwZW5kVG8oby5hcHBlbmRUbyk7XHJcbiAgICAgICAgICAgIFx0XHR9XHJcbiAgICAgICAgXHRcdH0pO1xyXG5cdFx0XHRkb1RyYW5zaXRpb24odHJ1ZSk7XHRcclxuXHRcdH07XHJcblx0XHRcclxuICAgICAgICBmdW5jdGlvbiBjbG9zZSgpIHtcclxuICAgICAgICAgICAgLy8gY29uc29sZS5sb2coaWQsICRwb3B1cC5kYXRhKCdpZCcpLCAkcG9wdXAuZGF0YSgnYlBvcHVwJykpO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgLy8gYWxlcnQoaWQsICRwb3B1cC5kYXRhKCdpZCcpLCAkcG9wdXAuZGF0YSgnYlBvcHVwJykpO1xyXG4gICAgICAgICAgICBpZiAoby5tb2RhbCkge1xyXG4gICAgICAgICAgICAgICAgJCgnLmItbW9kYWwuJyskcG9wdXAuZGF0YSgnaWQnKSlcclxuXHQgICAgICAgICAgICAgICAgLmZhZGVUbyhvLnNwZWVkLCAwLCBmdW5jdGlvbigpIHtcclxuXHQgICAgICAgICAgICAgICAgICAgICQodGhpcykucmVtb3ZlKCk7XHJcblx0ICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIENsZWFuIHVwXHJcbiAgICAgICAgICAgIHVuYmluZEV2ZW50cygpO1x0XHJcbiAgICAgICAgICAgIGNsZWFyVGltZW91dChhdXRvQ2xvc2VUTyk7XHJcbiAgICAgICAgICAgIC8vIENsb3NlIHRyYXNpdGlvblxyXG4gICAgICAgICAgICBkb1RyYW5zaXRpb24oKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHJldHVybiBmYWxzZTsgLy8gUHJldmVudCBkZWZhdWx0XHJcbiAgICAgICAgfTtcclxuXHRcdFxyXG5cdFx0ZnVuY3Rpb24gcmVwb3NpdGlvbihhbmltYXRlU3BlZWQpe1xyXG4gICAgICAgICAgICB3SCA9IHdpbmRvd0hlaWdodCgpO1xyXG4gIFx0XHQgICAgd1cgPSB3aW5kb3dXaWR0aCgpO1xyXG5cdFx0XHRpbnNpZGUgPSBpbnNpZGVXaW5kb3coKTtcclxuICAgICAgICAgICBcdGlmKGluc2lkZSl7XHJcblx0XHRcdFx0Y2xlYXJUaW1lb3V0KGRlYm91bmNlKTtcclxuXHRcdFx0XHRkZWJvdW5jZSA9IHNldFRpbWVvdXQoZnVuY3Rpb24oKXtcclxuXHRcdFx0XHRcdGNhbGNQb3NpdGlvbigpO1xyXG5cdFx0XHRcdFx0YW5pbWF0ZVNwZWVkID0gYW5pbWF0ZVNwZWVkIHx8IG8uZm9sbG93U3BlZWQ7XHJcblx0XHRcdFx0XHQkcG9wdXBcclxuICAgICAgICAgICAgICAgICAgICAgICBcdC5kZXF1ZXVlKClcclxuICAgICAgICAgICAgICAgICAgICAgICBcdC5lYWNoKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBcdGlmKGZpeGVkUG9zU3R5bGUpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFx0JCh0aGlzKS5jc3MoeyAnbGVmdCc6IGhQb3MsICd0b3AnOiB2UG9zIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICBcdH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgXHRlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFx0JCh0aGlzKS5hbmltYXRlKHsgJ2xlZnQnOiBvLmZvbGxvd1swXSA/IGdldExlZnRQb3ModHJ1ZSkgOiAnYXV0bycsICd0b3AnOiBvLmZvbGxvd1sxXSA/IGdldFRvcFBvcyh0cnVlKSA6ICdhdXRvJyB9LCBhbmltYXRlU3BlZWQsIG8uZm9sbG93RWFzaW5nKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgXHR9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgXHR9KTtcclxuXHRcdFx0XHR9LCA1MCk7XHRcdFx0XHRcdFxyXG4gICAgICAgICAgIFx0fVxyXG5cdFx0fTtcclxuXHRcdFxyXG5cdFx0Ly9Fa3NwZXJpbWVudGFsXHJcblx0XHRmdW5jdGlvbiByZWNlbnRlcihjb250ZW50KXtcclxuXHRcdFx0dmFyIF93aWR0aCA9IGNvbnRlbnQud2lkdGgoKSwgX2hlaWdodCA9IGNvbnRlbnQuaGVpZ2h0KCksIGNzcyA9IHt9O1xyXG5cdFx0XHRvLmNvbnRlbnRDb250YWluZXIuY3NzKHtoZWlnaHQ6X2hlaWdodCx3aWR0aDpfd2lkdGh9KTtcclxuXHRcdFx0XHJcblx0XHRcdGlmIChfaGVpZ2h0ID49ICRwb3B1cC5oZWlnaHQoKSl7XHJcblx0XHRcdFx0Y3NzLmhlaWdodCA9ICRwb3B1cC5oZWlnaHQoKTtcclxuXHRcdFx0fVxyXG5cdFx0XHRpZihfd2lkdGggPj0gJHBvcHVwLndpZHRoKCkpe1xyXG5cdFx0XHRcdGNzcy53aWR0aCA9ICRwb3B1cC53aWR0aCgpO1xyXG5cdFx0XHR9XHJcblx0XHRcdGhlaWdodCA9ICRwb3B1cC5vdXRlckhlaWdodCh0cnVlKVxyXG5cdFx0XHQsIHdpZHRoID0gJHBvcHVwLm91dGVyV2lkdGgodHJ1ZSk7XHJcblx0XHRcdFx0XHJcblx0XHRcdGNhbGNQb3NpdGlvbigpO1xyXG5cdFx0XHRvLmNvbnRlbnRDb250YWluZXIuY3NzKHtoZWlnaHQ6J2F1dG8nLHdpZHRoOidhdXRvJ30pO1x0XHRcclxuXHRcdFx0XHJcblx0XHRcdGNzcy5sZWZ0ID0gZ2V0TGVmdFBvcyghKCFvLmZvbGxvd1swXSAmJiBmaXhlZEhQb3MgfHwgZml4ZWRQb3NTdHlsZSkpLFxyXG5cdFx0XHRjc3MudG9wID0gZ2V0VG9wUG9zKCEoIW8uZm9sbG93WzFdICYmIGZpeGVkVlBvcyB8fCBmaXhlZFBvc1N0eWxlKSk7XHJcblx0XHRcdFxyXG5cdFx0XHQkcG9wdXBcclxuXHRcdFx0XHQuYW5pbWF0ZShcclxuXHRcdFx0XHRcdGNzc1xyXG5cdFx0XHRcdFx0LCAyNTBcclxuXHRcdFx0XHRcdCwgZnVuY3Rpb24oKSB7IFxyXG5cdFx0XHRcdFx0XHRjb250ZW50LnNob3coKTtcclxuXHRcdFx0XHRcdFx0aW5zaWRlID0gaW5zaWRlV2luZG93KCk7XHJcblx0XHRcdFx0XHR9XHJcblx0XHRcdFx0KTtcclxuXHRcdH07XHJcblx0XHRcclxuICAgICAgICBmdW5jdGlvbiBiaW5kRXZlbnRzKCkge1xyXG4gICAgICAgICAgICAkdy5kYXRhKCdiUG9wdXAnLCBwb3B1cHMpO1xyXG5cdFx0XHQkcG9wdXAuZGVsZWdhdGUoJy5iQ2xvc2UsIC4nICsgby5jbG9zZUNsYXNzLCAnY2xpY2suJytpZCwgY2xvc2UpOyAvLyBsZWdhY3ksIHN0aWxsIHN1cHBvcnRpbmcgdGhlIGNsb3NlIGNsYXNzIGJDbG9zZVxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgaWYgKG8ubW9kYWxDbG9zZSkge1xyXG4gICAgICAgICAgICAgICAgJCgnLmItbW9kYWwuJytpZCkuY3NzKCdjdXJzb3InLCAncG9pbnRlcicpLmJpbmQoJ2NsaWNrJywgY2xvc2UpO1xyXG4gICAgICAgICAgICB9XHJcblx0XHRcdFxyXG5cdFx0XHQvLyBUZW1wb3JhcnkgZGlzYWJsaW5nIHNjcm9sbC9yZXNpemUgZXZlbnRzIG9uIGRldmljZXMgd2l0aCBJT1M2K1xyXG5cdFx0XHQvLyBkdWUgdG8gYSBidWcgd2hlcmUgZXZlbnRzIGFyZSBkcm9wcGVkIGFmdGVyIHBpbmNoIHRvIHpvb21cclxuICAgICAgICAgICAgaWYgKCFpc0lPUzZYICYmIChvLmZvbGxvd1swXSB8fCBvLmZvbGxvd1sxXSkpIHtcclxuICAgICAgICAgICAgICAgJHcuYmluZCgnc2Nyb2xsLicraWQsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgXHRpZihpbnNpZGUpe1xyXG4gICAgICAgICAgICAgICAgICAgIFx0JHBvcHVwXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIFx0LmRlcXVldWUoKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLmFuaW1hdGUoeyAnbGVmdCc6IG8uZm9sbG93WzBdID8gZ2V0TGVmdFBvcyghZml4ZWRQb3NTdHlsZSkgOiAnYXV0bycsICd0b3AnOiBvLmZvbGxvd1sxXSA/IGdldFRvcFBvcyghZml4ZWRQb3NTdHlsZSkgOiAnYXV0bycgfSwgby5mb2xsb3dTcGVlZCwgby5mb2xsb3dFYXNpbmcpO1xyXG5cdFx0XHRcdFx0IH0gIFxyXG4gICAgICAgICAgICBcdH0pLmJpbmQoJ3Jlc2l6ZS4nK2lkLCBmdW5jdGlvbigpIHtcclxuXHRcdCAgICAgICAgICAgIHJlcG9zaXRpb24oKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChvLmVzY0Nsb3NlKSB7XHJcbiAgICAgICAgICAgICAgICBkLmJpbmQoJ2tleWRvd24uJytpZCwgZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChlLndoaWNoID09IDI3KSB7ICAvL2VzY2FwZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjbG9zZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHRcdFxyXG4gICAgICAgIGZ1bmN0aW9uIHVuYmluZEV2ZW50cygpIHtcclxuICAgICAgICAgICAgaWYgKCFvLnNjcm9sbEJhcikge1xyXG4gICAgICAgICAgICAgICAgJCgnaHRtbCcpLmNzcygnb3ZlcmZsb3cnLCAnYXV0bycpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICQoJy5iLW1vZGFsLicraWQpLnVuYmluZCgnY2xpY2snKTtcclxuICAgICAgICAgICAgZC51bmJpbmQoJ2tleWRvd24uJytpZCk7XHJcbiAgICAgICAgICAgICR3LnVuYmluZCgnLicraWQpLmRhdGEoJ2JQb3B1cCcsICgkdy5kYXRhKCdiUG9wdXAnKS0xID4gMCkgPyAkdy5kYXRhKCdiUG9wdXAnKS0xIDogbnVsbCk7XHJcbiAgICAgICAgICAgICRwb3B1cC51bmRlbGVnYXRlKCcuYkNsb3NlLCAuJyArIG8uY2xvc2VDbGFzcywgJ2NsaWNrLicraWQsIGNsb3NlKS5kYXRhKCdiUG9wdXAnLCBudWxsKTtcclxuICAgICAgICB9O1xyXG5cdFx0XHJcblx0XHRmdW5jdGlvbiBkb1RyYW5zaXRpb24ob3Blbikge1xyXG5cdFx0XHRzd2l0Y2ggKG9wZW4gPyBvLnRyYW5zaXRpb24gOiBvLnRyYW5zaXRpb25DbG9zZSB8fCBvLnRyYW5zaXRpb24pIHtcclxuXHRcdFx0ICAgY2FzZSBcInNsaWRlSW5cIjpcclxuXHRcdFx0XHQgICBcdGFuaW1hdGUoe1xyXG5cdFx0XHRcdCAgIFx0XHRsZWZ0OiBvcGVuID8gZ2V0TGVmdFBvcyghKCFvLmZvbGxvd1swXSAmJiBmaXhlZEhQb3MgfHwgZml4ZWRQb3NTdHlsZSkpIDogZC5zY3JvbGxMZWZ0KCkgLSAod2lkdGggfHwgJHBvcHVwLm91dGVyV2lkdGgodHJ1ZSkpIC0gYnVmZmVyXHJcblx0XHRcdFx0ICAgXHR9KTtcclxuXHRcdFx0ICAgICAgXHRicmVhaztcclxuXHRcdFx0ICAgY2FzZSBcInNsaWRlQmFja1wiOlxyXG5cdFx0XHRcdCAgIFx0YW5pbWF0ZSh7XHJcblx0XHRcdFx0ICAgXHRcdGxlZnQ6IG9wZW4gPyBnZXRMZWZ0UG9zKCEoIW8uZm9sbG93WzBdICYmIGZpeGVkSFBvcyB8fCBmaXhlZFBvc1N0eWxlKSkgOiBkLnNjcm9sbExlZnQoKSArIHdXICsgYnVmZmVyXHJcblx0XHRcdFx0ICAgXHR9KTtcclxuXHRcdFx0ICAgICAgXHRicmVhaztcclxuXHRcdFx0ICAgY2FzZSBcInNsaWRlRG93blwiOlxyXG5cdFx0XHRcdCAgIFx0YW5pbWF0ZSh7XHJcblx0XHRcdFx0ICAgXHRcdHRvcDogb3BlbiA/IGdldFRvcFBvcyghKCFvLmZvbGxvd1sxXSAmJiBmaXhlZFZQb3MgfHwgZml4ZWRQb3NTdHlsZSkpIDogZC5zY3JvbGxUb3AoKSAtIChoZWlnaHQgfHwgJHBvcHVwLm91dGVySGVpZ2h0KHRydWUpKSAtIGJ1ZmZlclxyXG5cdFx0XHRcdCAgIFx0fSk7XHJcblx0XHRcdCAgICAgIFx0YnJlYWs7XHJcblx0XHQgICBcdFx0Y2FzZSBcInNsaWRlVXBcIjpcclxuXHRcdFx0XHRcdGFuaW1hdGUoe1xyXG5cdFx0XHRcdFx0XHR0b3A6IG9wZW4gPyBnZXRUb3BQb3MoISghby5mb2xsb3dbMV0gJiYgZml4ZWRWUG9zIHx8IGZpeGVkUG9zU3R5bGUpKSA6IGQuc2Nyb2xsVG9wKCkgKyB3SCArIGJ1ZmZlclxyXG5cdFx0XHRcdFx0fSk7XHJcblx0XHQgICAgICBcdCAgXHRicmVhaztcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2FzZSBcImZhZGVPdXRcIjogXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMuaGlkZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICRwb3B1cC5zdG9wKCkuZmFkZU91dChvLnNwZWVkKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG5cdFx0XHQgICBkZWZhdWx0OlxyXG5cdFx0XHQgICBcdCAgXHQvL0hhcmR0eXBpbmcgMSBhbmQgMCB0byBlbnN1cmUgb3BhY2l0eSAxIGFuZCBub3QgMC45OTk5OTk4XHJcblx0XHRcdFx0ICBcdCRwb3B1cC5zdG9wKCkuZmFkZVRvKG8uc3BlZWQsIG9wZW4gPyAxIDogMCwgZnVuY3Rpb24oKXtvbkNvbXBsZXRlQ2FsbGJhY2sob3Blbik7fSk7XHJcblx0XHRcdH1cclxuXHRcdFx0XHJcblx0XHRcdGZ1bmN0aW9uIGFuaW1hdGUoY3NzKXtcclxuXHRcdFx0ICBcdCRwb3B1cFxyXG5cdFx0XHRcdFx0LmNzcyh7ZGlzcGxheTogJ2Jsb2NrJyxvcGFjaXR5OiAxfSlcclxuXHRcdFx0XHRcdC5hbmltYXRlKGNzcywgby5zcGVlZCwgby5lYXNpbmcsIGZ1bmN0aW9uKCl7IG9uQ29tcGxldGVDYWxsYmFjayhvcGVuKTsgfSk7XHJcblx0XHRcdH07XHJcblx0XHR9O1xyXG5cdFx0XHJcblx0XHRcclxuXHRcdGZ1bmN0aW9uIG9uQ29tcGxldGVDYWxsYmFjayhvcGVuKXtcclxuXHRcdFx0aWYob3Blbil7XHJcblx0XHRcdFx0YmluZEV2ZW50cygpO1xyXG5cdCAgICAgICAgICAgIHRyaWdnZXJDYWxsKGNhbGxiYWNrKTtcclxuXHRcdFx0XHRpZihvLmF1dG9DbG9zZSl7XHJcblx0XHRcdFx0XHRhdXRvQ2xvc2VUTyA9IHNldFRpbWVvdXQoY2xvc2UsIG8uYXV0b0Nsb3NlKTtcclxuXHRcdFx0XHR9XHJcblx0XHRcdH0gZWxzZSB7XHJcblx0XHRcdFx0JHBvcHVwLmhpZGUoKTtcclxuXHRcdFx0XHR0cmlnZ2VyQ2FsbChvLm9uQ2xvc2UpO1xyXG5cdFx0XHRcdGlmIChvLmxvYWRVcmwpIHtcclxuICAgICAgICAgICAgICAgICAgICBvLmNvbnRlbnRDb250YWluZXIuZW1wdHkoKTtcclxuXHRcdFx0XHRcdCRwb3B1cC5jc3Moe2hlaWdodDogJ2F1dG8nLCB3aWR0aDogJ2F1dG8nfSk7XHJcbiAgICAgICAgICAgICAgICB9XHRcdFxyXG5cdFx0XHR9XHJcblx0XHR9O1xyXG5cdFx0XHJcblx0XHRmdW5jdGlvbiBnZXRMZWZ0UG9zKGluY2x1ZGVTY3JvbGwpe1xyXG5cdFx0XHRyZXR1cm4gaW5jbHVkZVNjcm9sbCA/IGhQb3MgKyBkLnNjcm9sbExlZnQoKSA6IGhQb3M7XHJcblx0XHR9O1xyXG5cdFx0XHJcblx0XHRmdW5jdGlvbiBnZXRUb3BQb3MoaW5jbHVkZVNjcm9sbCl7XHJcblx0XHRcdHJldHVybiBpbmNsdWRlU2Nyb2xsID8gdlBvcyArIGQuc2Nyb2xsVG9wKCkgOiB2UG9zO1xyXG5cdFx0fTtcclxuXHRcdFxyXG5cdFx0ZnVuY3Rpb24gdHJpZ2dlckNhbGwoZnVuYywgYXJnKSB7XHJcblx0XHRcdCQuaXNGdW5jdGlvbihmdW5jKSAmJiBmdW5jLmNhbGwoJHBvcHVwLCBhcmcpO1xyXG5cdFx0fTtcclxuXHRcdFxyXG4gICAgICAgXHRmdW5jdGlvbiBjYWxjUG9zaXRpb24oKXtcclxuXHRcdFx0dlBvcyBcdFx0PSBmaXhlZFZQb3MgPyBvLnBvc2l0aW9uWzFdIDogTWF0aC5tYXgoMCwgKCh3SC0gJHBvcHVwLm91dGVySGVpZ2h0KHRydWUpKSAvIDIpIC0gby5hbXNsKVxyXG5cdFx0XHQsIGhQb3MgXHRcdD0gZml4ZWRIUG9zID8gby5wb3NpdGlvblswXSA6ICh3VyAtICRwb3B1cC5vdXRlcldpZHRoKHRydWUpKSAvIDJcclxuXHRcdFx0LCBpbnNpZGUgXHQ9IGluc2lkZVdpbmRvdygpO1xyXG5cdFx0fTtcclxuXHRcdFxyXG4gICAgICAgIGZ1bmN0aW9uIGluc2lkZVdpbmRvdygpe1xyXG4gICAgICAgICAgICByZXR1cm4gd0ggPiAkcG9wdXAub3V0ZXJIZWlnaHQodHJ1ZSkgJiYgd1cgPiAkcG9wdXAub3V0ZXJXaWR0aCh0cnVlKTtcclxuICAgICAgICB9O1xyXG5cdFx0XHJcblx0XHRmdW5jdGlvbiB3aW5kb3dIZWlnaHQoKXtcclxuXHRcdFx0cmV0dXJuIHcuaW5uZXJIZWlnaHQgfHwgJHcuaGVpZ2h0KCk7XHJcblx0XHR9O1xyXG5cdFx0XHJcblx0XHRmdW5jdGlvbiB3aW5kb3dXaWR0aCgpe1xyXG5cdFx0XHRyZXR1cm4gdy5pbm5lcldpZHRoIHx8ICR3LndpZHRoKCk7XHJcblx0XHR9O1xyXG4gICAgfTtcclxuXHJcblx0LyogREVGQVVMVCBWQUxVRVMgKi9cclxuICAgICQuZm4uYlBvcHVwLmRlZmF1bHRzID0ge1xyXG4gICAgICAgICAgYW1zbDogXHRcdFx0NTBcclxuICAgICAgICAsIGFwcGVuZGluZzogXHRcdHRydWVcclxuICAgICAgICAsIGFwcGVuZFRvOiBcdFx0J2JvZHknXHJcblx0XHQsIGF1dG9DbG9zZTpcdFx0ZmFsc2VcclxuICAgICAgICAsIGNsb3NlQ2xhc3M6IFx0XHQnYi1jbG9zZSdcclxuICAgICAgICAsIGNvbnRlbnQ6IFx0XHRcdCdhamF4JyAvLyBhamF4LCBpZnJhbWUgb3IgaW1hZ2VcclxuICAgICAgICAsIGNvbnRlbnRDb250YWluZXI6IGZhbHNlXHJcblx0XHQsIGVhc2luZzogXHRcdFx0J3N3aW5nJ1xyXG4gICAgICAgICwgZXNjQ2xvc2U6IFx0XHR0cnVlXHJcbiAgICAgICAgLCBmb2xsb3c6IFx0XHRcdFt0cnVlLCB0cnVlXSAvLyB4LCB5XHJcblx0XHQsIGZvbGxvd0Vhc2luZzogXHQnc3dpbmcnXHJcbiAgICAgICAgLCBmb2xsb3dTcGVlZDogXHRcdDUwMFxyXG5cdFx0LCBpZnJhbWVBdHRyOiBcdFx0J3Njcm9sbGluZz1cIm5vXCIgZnJhbWVib3JkZXI9XCIwXCInXHJcblx0XHQsIGxvYWRDYWxsYmFjazogXHRmYWxzZVxyXG5cdFx0LCBsb2FkRGF0YTogXHRcdGZhbHNlXHJcbiAgICAgICAgLCBsb2FkVXJsOiBcdFx0XHRmYWxzZVxyXG4gICAgICAgICwgbW9kYWw6IFx0XHRcdHRydWVcclxuICAgICAgICAsIG1vZGFsQ2xvc2U6IFx0XHR0cnVlXHJcbiAgICAgICAgLCBtb2RhbENvbG9yOiBcdFx0JyMwMDAnXHJcbiAgICAgICAgLCBvbkNsb3NlOiBcdFx0XHRmYWxzZVxyXG4gICAgICAgICwgb25PcGVuOiBcdFx0XHRmYWxzZVxyXG4gICAgICAgICwgb3BhY2l0eTogXHRcdFx0MC43XHJcbiAgICAgICAgLCBwb3NpdGlvbjogXHRcdFsnYXV0bycsICdhdXRvJ10gLy8geCwgeSxcclxuICAgICAgICAsIHBvc2l0aW9uU3R5bGU6IFx0J2Fic29sdXRlJy8vIGFic29sdXRlIG9yIGZpeGVkXHJcbiAgICAgICAgLCBzY3JvbGxCYXI6IFx0XHR0cnVlXHJcblx0XHQsIHNwZWVkOiBcdFx0XHQyNTAgLy8gb3BlbiAmIGNsb3NlIHNwZWVkXHJcblx0XHQsIHRyYW5zaXRpb246XHRcdCdmYWRlSW4nIC8vdHJhbnNpdGlvbnM6IGZhZGVJbiwgc2xpZGVEb3duLCBzbGlkZUluLCBzbGlkZUJhY2tcclxuXHRcdCwgdHJhbnNpdGlvbkNsb3NlOlx0ZmFsc2VcclxuICAgICAgICAsIHpJbmRleDogXHRcdFx0OTk5NyAvLyBwb3B1cCBnZXRzIHotaW5kZXggOTk5OSwgbW9kYWwgb3ZlcmxheSA5OTk4XHJcbiAgICB9O1xyXG59KShqUXVlcnkpO1xyXG4iLCIvKiA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuICoganF1ZXJ5LmF1dG9maXhfYW55dGhpbmcuanMgdjFcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gKiBDb3B5cmlnaHQgMjAxMyBQZXRlIFJvandvbmdzdXJpeWEuXG4gKiBodHRwOi8vd3d3LnRoZXBldGVkZXNpZ24uY29tXG4gKlxuICogRml4IHBvc2l0aW9uIG9mIGFueXRoaW5nIG9uIHlvdXIgd2Vic2l0ZSBhdXRvbWF0aWNhbGx5XG4gKiB3aXRoIG9uZSBqcyBjYWxsXG4gKlxuICogaHR0cHM6Ly9naXRodWIuY29tL3BlYWNoYW5hbnIvYXV0b2ZpeF9hbnl0aGluZ1xuICpcbiAqID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gKi9cblxuIWZ1bmN0aW9uKCQpe1xuICBcbiAgdmFyIGRlZmF1bHRzID0ge1xuICAgIGN1c3RvbU9mZnNldDogZmFsc2UsXG4gICAgbWFudWFsOiBmYWxzZSxcbiAgICBvbmx5SW5Db250YWluZXI6IHRydWVcblx0fTtcblxuICAkLmZuLmF1dG9maXhfYW55dGhpbmcgPSBmdW5jdGlvbihvcHRpb25zKXtcbiAgICB2YXIgc2V0dGluZ3MgPSAkLmV4dGVuZCh7fSwgZGVmYXVsdHMsIG9wdGlvbnMpLFxuICAgICAgICBlbCA9ICQodGhpcyksXG4gICAgICAgIGN1cnBvcyA9IGVsLnBvc2l0aW9uKCksXG4gICAgICAgIG9mZnNldCA9IHNldHRpbmdzLmN1c3RvbU9mZnNldCxcbiAgICAgICAgcG9zID0gZWwub2Zmc2V0KCk7XG4gICAgICAgIFxuICAgIGVsLmFkZENsYXNzKFwiYXV0b2ZpeF9zYlwiKSAgXG4gICAgXG4gICAgJC5mbi5tYW51YWxmaXggPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBlbCA9ICQodGhpcyksXG4gICAgICAgICAgcG9zID0gZWwub2Zmc2V0KCk7XG4gICAgICBpZiAoZWwuaGFzQ2xhc3MoXCJmaXhlZFwiKSkge1xuICAgICAgICBlbC5yZW1vdmVDbGFzcyhcImZpeGVkXCIpXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBlbC5hZGRDbGFzcyhcImZpeGVkXCIpLmNzcyh7XG4gICAgICAgICAgdG9wOiAwLFxuICAgICAgICAgIGxlZnQ6IHBvcy5sZWZ0LFxuICAgICAgICAgIHJpZ2h0OiBcImF1dG9cIixcbiAgICAgICAgICBib3R0b206IFwiYXV0b1wiXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgXG4gICAgfVxuICAgIFxuICAgIGZpeEFsbCA9IGZ1bmN0aW9uKGVsLCBzZXR0aW5ncywgY3VycG9zLCBwb3Mpe1xuICAgICAgaWYgKHNldHRpbmdzLmN1c3RvbU9mZnNldCA9PSBmYWxzZSkgb2Zmc2V0ID0gIGVsLnBhcmVudCgpLm9mZnNldCgpLnRvcFxuICAgICAgaWYoJChkb2N1bWVudCkuc2Nyb2xsVG9wKCkgPiBvZmZzZXQgJiYgJChkb2N1bWVudCkuc2Nyb2xsVG9wKCkgPD0gKGVsLnBhcmVudCgpLmhlaWdodCgpICsgKG9mZnNldCAtICQod2luZG93KS5oZWlnaHQoKSkpKSAge1xuICAgICAgICAgIGVsLnJlbW92ZUNsYXNzKFwiYm90dG9tXCIpLmFkZENsYXNzKFwiZml4ZWRcIikuY3NzKHtcbiAgICAgICAgICAgIHRvcDogMCxcbiAgICAgICAgICAgIGxlZnQ6IHBvcy5sZWZ0LFxuICAgICAgICAgICAgcmlnaHQ6IFwiYXV0b1wiLFxuICAgICAgICAgICAgYm90dG9tOiBcImF1dG9cIlxuICAgICAgICAgIH0pO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYoJChkb2N1bWVudCkuc2Nyb2xsVG9wKCkgPiBvZmZzZXQpIHtcbiAgICAgICAgICBpZiAoc2V0dGluZ3Mub25seUluQ29udGFpbmVyID09IHRydWUgKSB7XG4gICAgICAgICAgICBpZigkKGRvY3VtZW50KS5zY3JvbGxUb3AoKSA+IChlbC5wYXJlbnQoKS5oZWlnaHQoKSAtICQod2luZG93KS5oZWlnaHQoKSkpIHtcbiAgICAgICAgICAgICAgZWwuYWRkQ2xhc3MoXCJib3R0b20gZml4ZWRcIikucmVtb3ZlQXR0ciggJ3N0eWxlJyApLmNzcyh7XG4gICAgICAgICAgICAgICAgbGVmdDogY3VycG9zLmxlZnRcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9ZWxzZSB7XG4gICAgICAgICAgICAgIGVsLnJlbW92ZUNsYXNzKFwiYm90dG9tIGZpeGVkXCIpLnJlbW92ZUF0dHIoICdzdHlsZScgKTtcblxuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBlbC5yZW1vdmVDbGFzcyhcImJvdHRvbSBmaXhlZFwiKS5yZW1vdmVBdHRyKCAnc3R5bGUnICk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICBcbiAgICB9XG4gICAgaWYgKHNldHRpbmdzLm1hbnVhbCA9PSBmYWxzZSkge1xuICAgICAgJCh3aW5kb3cpLnNjcm9sbChmdW5jdGlvbigpIHtcbiAgICAgICAgZml4QWxsKGVsLCBzZXR0aW5ncywgY3VycG9zLCBwb3MpXG4gICAgICB9KTtcbiAgICB9XG4gICAgXG5cbiAgfVxufSh3aW5kb3cualF1ZXJ5KTtcblxuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjkuMlxuXG4vKipcbkBsaWNlbnNlIFN0aWNreS1raXQgdjEuMS4yIHwgV1RGUEwgfCBMZWFmIENvcmNvcmFuIDIwMTUgfCBodHRwOi8vbGVhZm8ubmV0XG4gKi9cbihmdW5jdGlvbigpIHtcbiAgdmFyICQsIHdpbjtcblxuICAkID0gdGhpcy5qUXVlcnkgfHwgd2luZG93LmpRdWVyeTtcblxuICB3aW4gPSAkKHdpbmRvdyk7XG5cbiAgJC5mbi5zdGlja19pbl9wYXJlbnQgPSBmdW5jdGlvbihvcHRzKSB7XG4gICAgdmFyIGRvYywgZWxtLCBlbmFibGVfYm90dG9taW5nLCBmbiwgaSwgaW5uZXJfc2Nyb2xsaW5nLCBsZW4sIG1hbnVhbF9zcGFjZXIsIG9mZnNldF90b3AsIG91dGVyX3dpZHRoLCBwYXJlbnRfc2VsZWN0b3IsIHJlY2FsY19ldmVyeSwgc3RpY2t5X2NsYXNzO1xuICAgIGlmIChvcHRzID09IG51bGwpIHtcbiAgICAgIG9wdHMgPSB7fTtcbiAgICB9XG4gICAgc3RpY2t5X2NsYXNzID0gb3B0cy5zdGlja3lfY2xhc3MsIGlubmVyX3Njcm9sbGluZyA9IG9wdHMuaW5uZXJfc2Nyb2xsaW5nLCByZWNhbGNfZXZlcnkgPSBvcHRzLnJlY2FsY19ldmVyeSwgcGFyZW50X3NlbGVjdG9yID0gb3B0cy5wYXJlbnQsIG9mZnNldF90b3AgPSBvcHRzLm9mZnNldF90b3AsIG1hbnVhbF9zcGFjZXIgPSBvcHRzLnNwYWNlciwgZW5hYmxlX2JvdHRvbWluZyA9IG9wdHMuYm90dG9taW5nO1xuICAgIGlmIChvZmZzZXRfdG9wID09IG51bGwpIHtcbiAgICAgIG9mZnNldF90b3AgPSAwO1xuICAgIH1cbiAgICBpZiAocGFyZW50X3NlbGVjdG9yID09IG51bGwpIHtcbiAgICAgIHBhcmVudF9zZWxlY3RvciA9IHZvaWQgMDtcbiAgICB9XG4gICAgaWYgKGlubmVyX3Njcm9sbGluZyA9PSBudWxsKSB7XG4gICAgICBpbm5lcl9zY3JvbGxpbmcgPSB0cnVlO1xuICAgIH1cbiAgICBpZiAoc3RpY2t5X2NsYXNzID09IG51bGwpIHtcbiAgICAgIHN0aWNreV9jbGFzcyA9IFwiaXNfc3R1Y2tcIjtcbiAgICB9XG4gICAgZG9jID0gJChkb2N1bWVudCk7XG4gICAgaWYgKGVuYWJsZV9ib3R0b21pbmcgPT0gbnVsbCkge1xuICAgICAgZW5hYmxlX2JvdHRvbWluZyA9IHRydWU7XG4gICAgfVxuICAgIG91dGVyX3dpZHRoID0gZnVuY3Rpb24oZWwpIHtcbiAgICAgIHZhciBfZWwsIGNvbXB1dGVkLCB3O1xuICAgICAgaWYgKHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKSB7XG4gICAgICAgIF9lbCA9IGVsWzBdO1xuICAgICAgICBjb21wdXRlZCA9IHdpbmRvdy5nZXRDb21wdXRlZFN0eWxlKGVsWzBdKTtcbiAgICAgICAgdyA9IHBhcnNlRmxvYXQoY29tcHV0ZWQuZ2V0UHJvcGVydHlWYWx1ZShcIndpZHRoXCIpKSArIHBhcnNlRmxvYXQoY29tcHV0ZWQuZ2V0UHJvcGVydHlWYWx1ZShcIm1hcmdpbi1sZWZ0XCIpKSArIHBhcnNlRmxvYXQoY29tcHV0ZWQuZ2V0UHJvcGVydHlWYWx1ZShcIm1hcmdpbi1yaWdodFwiKSk7XG4gICAgICAgIGlmIChjb21wdXRlZC5nZXRQcm9wZXJ0eVZhbHVlKFwiYm94LXNpemluZ1wiKSAhPT0gXCJib3JkZXItYm94XCIpIHtcbiAgICAgICAgICB3ICs9IHBhcnNlRmxvYXQoY29tcHV0ZWQuZ2V0UHJvcGVydHlWYWx1ZShcImJvcmRlci1sZWZ0LXdpZHRoXCIpKSArIHBhcnNlRmxvYXQoY29tcHV0ZWQuZ2V0UHJvcGVydHlWYWx1ZShcImJvcmRlci1yaWdodC13aWR0aFwiKSkgKyBwYXJzZUZsb2F0KGNvbXB1dGVkLmdldFByb3BlcnR5VmFsdWUoXCJwYWRkaW5nLWxlZnRcIikpICsgcGFyc2VGbG9hdChjb21wdXRlZC5nZXRQcm9wZXJ0eVZhbHVlKFwicGFkZGluZy1yaWdodFwiKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gZWwub3V0ZXJXaWR0aCh0cnVlKTtcbiAgICAgIH1cbiAgICB9O1xuICAgIGZuID0gZnVuY3Rpb24oZWxtLCBwYWRkaW5nX2JvdHRvbSwgcGFyZW50X3RvcCwgcGFyZW50X2hlaWdodCwgdG9wLCBoZWlnaHQsIGVsX2Zsb2F0LCBkZXRhY2hlZCkge1xuICAgICAgdmFyIGJvdHRvbWVkLCBkZXRhY2gsIGZpeGVkLCBsYXN0X3BvcywgbGFzdF9zY3JvbGxfaGVpZ2h0LCBvZmZzZXQsIHBhcmVudCwgcmVjYWxjLCByZWNhbGNfYW5kX3RpY2ssIHJlY2FsY19jb3VudGVyLCBzcGFjZXIsIHRpY2s7XG4gICAgICBpZiAoZWxtLmRhdGEoXCJzdGlja3lfa2l0XCIpKSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGVsbS5kYXRhKFwic3RpY2t5X2tpdFwiLCB0cnVlKTtcbiAgICAgIGxhc3Rfc2Nyb2xsX2hlaWdodCA9IGRvYy5oZWlnaHQoKTtcbiAgICAgIHBhcmVudCA9IGVsbS5wYXJlbnQoKTtcbiAgICAgIGlmIChwYXJlbnRfc2VsZWN0b3IgIT0gbnVsbCkge1xuICAgICAgICBwYXJlbnQgPSBwYXJlbnQuY2xvc2VzdChwYXJlbnRfc2VsZWN0b3IpO1xuICAgICAgfVxuICAgICAgaWYgKCFwYXJlbnQubGVuZ3RoKSB7XG4gICAgICAgIHRocm93IFwiZmFpbGVkIHRvIGZpbmQgc3RpY2sgcGFyZW50XCI7XG4gICAgICB9XG4gICAgICBmaXhlZCA9IGZhbHNlO1xuICAgICAgYm90dG9tZWQgPSBmYWxzZTtcbiAgICAgIHNwYWNlciA9IG1hbnVhbF9zcGFjZXIgIT0gbnVsbCA/IG1hbnVhbF9zcGFjZXIgJiYgZWxtLmNsb3Nlc3QobWFudWFsX3NwYWNlcikgOiAkKFwiPGRpdiAvPlwiKTtcbiAgICAgIGlmIChzcGFjZXIpIHtcbiAgICAgICAgc3BhY2VyLmNzcygncG9zaXRpb24nLCBlbG0uY3NzKCdwb3NpdGlvbicpKTtcbiAgICAgIH1cbiAgICAgIHJlY2FsYyA9IGZ1bmN0aW9uKCkge1xuICAgICAgICB2YXIgYm9yZGVyX3RvcCwgcGFkZGluZ190b3AsIHJlc3RvcmU7XG4gICAgICAgIGlmIChkZXRhY2hlZCkge1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBsYXN0X3Njcm9sbF9oZWlnaHQgPSBkb2MuaGVpZ2h0KCk7XG4gICAgICAgIGJvcmRlcl90b3AgPSBwYXJzZUludChwYXJlbnQuY3NzKFwiYm9yZGVyLXRvcC13aWR0aFwiKSwgMTApO1xuICAgICAgICBwYWRkaW5nX3RvcCA9IHBhcnNlSW50KHBhcmVudC5jc3MoXCJwYWRkaW5nLXRvcFwiKSwgMTApO1xuICAgICAgICBwYWRkaW5nX2JvdHRvbSA9IHBhcnNlSW50KHBhcmVudC5jc3MoXCJwYWRkaW5nLWJvdHRvbVwiKSwgMTApO1xuICAgICAgICBwYXJlbnRfdG9wID0gcGFyZW50Lm9mZnNldCgpLnRvcCArIGJvcmRlcl90b3AgKyBwYWRkaW5nX3RvcDtcbiAgICAgICAgcGFyZW50X2hlaWdodCA9IHBhcmVudC5oZWlnaHQoKTtcbiAgICAgICAgaWYgKGZpeGVkKSB7XG4gICAgICAgICAgZml4ZWQgPSBmYWxzZTtcbiAgICAgICAgICBib3R0b21lZCA9IGZhbHNlO1xuICAgICAgICAgIGlmIChtYW51YWxfc3BhY2VyID09IG51bGwpIHtcbiAgICAgICAgICAgIGVsbS5pbnNlcnRBZnRlcihzcGFjZXIpO1xuICAgICAgICAgICAgc3BhY2VyLmRldGFjaCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBlbG0uY3NzKHtcbiAgICAgICAgICAgIHBvc2l0aW9uOiBcIlwiLFxuICAgICAgICAgICAgdG9wOiBcIlwiLFxuICAgICAgICAgICAgd2lkdGg6IFwiXCIsXG4gICAgICAgICAgICBib3R0b206IFwiXCJcbiAgICAgICAgICB9KS5yZW1vdmVDbGFzcyhzdGlja3lfY2xhc3MpO1xuICAgICAgICAgIHJlc3RvcmUgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHRvcCA9IGVsbS5vZmZzZXQoKS50b3AgLSAocGFyc2VJbnQoZWxtLmNzcyhcIm1hcmdpbi10b3BcIiksIDEwKSB8fCAwKSAtIG9mZnNldF90b3A7XG4gICAgICAgIGhlaWdodCA9IGVsbS5vdXRlckhlaWdodCh0cnVlKTtcbiAgICAgICAgZWxfZmxvYXQgPSBlbG0uY3NzKFwiZmxvYXRcIik7XG4gICAgICAgIGlmIChzcGFjZXIpIHtcbiAgICAgICAgICBzcGFjZXIuY3NzKHtcbiAgICAgICAgICAgIHdpZHRoOiBvdXRlcl93aWR0aChlbG0pLFxuICAgICAgICAgICAgaGVpZ2h0OiBoZWlnaHQsXG4gICAgICAgICAgICBkaXNwbGF5OiBlbG0uY3NzKFwiZGlzcGxheVwiKSxcbiAgICAgICAgICAgIFwidmVydGljYWwtYWxpZ25cIjogZWxtLmNzcyhcInZlcnRpY2FsLWFsaWduXCIpLFxuICAgICAgICAgICAgXCJmbG9hdFwiOiBlbF9mbG9hdFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGlmIChyZXN0b3JlKSB7XG4gICAgICAgICAgcmV0dXJuIHRpY2soKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHJlY2FsYygpO1xuICAgICAgaWYgKGhlaWdodCA9PT0gcGFyZW50X2hlaWdodCkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBsYXN0X3BvcyA9IHZvaWQgMDtcbiAgICAgIG9mZnNldCA9IG9mZnNldF90b3A7XG4gICAgICByZWNhbGNfY291bnRlciA9IHJlY2FsY19ldmVyeTtcbiAgICAgIHRpY2sgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgdmFyIGNzcywgZGVsdGEsIHJlY2FsY2VkLCBzY3JvbGwsIHdpbGxfYm90dG9tLCB3aW5faGVpZ2h0O1xuICAgICAgICBpZiAoZGV0YWNoZWQpIHtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgcmVjYWxjZWQgPSBmYWxzZTtcbiAgICAgICAgaWYgKHJlY2FsY19jb3VudGVyICE9IG51bGwpIHtcbiAgICAgICAgICByZWNhbGNfY291bnRlciAtPSAxO1xuICAgICAgICAgIGlmIChyZWNhbGNfY291bnRlciA8PSAwKSB7XG4gICAgICAgICAgICByZWNhbGNfY291bnRlciA9IHJlY2FsY19ldmVyeTtcbiAgICAgICAgICAgIHJlY2FsYygpO1xuICAgICAgICAgICAgcmVjYWxjZWQgPSB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoIXJlY2FsY2VkICYmIGRvYy5oZWlnaHQoKSAhPT0gbGFzdF9zY3JvbGxfaGVpZ2h0KSB7XG4gICAgICAgICAgcmVjYWxjKCk7XG4gICAgICAgICAgcmVjYWxjZWQgPSB0cnVlO1xuICAgICAgICB9XG4gICAgICAgIHNjcm9sbCA9IHdpbi5zY3JvbGxUb3AoKTtcbiAgICAgICAgaWYgKGxhc3RfcG9zICE9IG51bGwpIHtcbiAgICAgICAgICBkZWx0YSA9IHNjcm9sbCAtIGxhc3RfcG9zO1xuICAgICAgICB9XG4gICAgICAgIGxhc3RfcG9zID0gc2Nyb2xsO1xuICAgICAgICBpZiAoZml4ZWQpIHtcbiAgICAgICAgICBpZiAoZW5hYmxlX2JvdHRvbWluZykge1xuICAgICAgICAgICAgd2lsbF9ib3R0b20gPSBzY3JvbGwgKyBoZWlnaHQgKyBvZmZzZXQgPiBwYXJlbnRfaGVpZ2h0ICsgcGFyZW50X3RvcDtcbiAgICAgICAgICAgIGlmIChib3R0b21lZCAmJiAhd2lsbF9ib3R0b20pIHtcbiAgICAgICAgICAgICAgYm90dG9tZWQgPSBmYWxzZTtcbiAgICAgICAgICAgICAgZWxtLmNzcyh7XG4gICAgICAgICAgICAgICAgcG9zaXRpb246IFwiZml4ZWRcIixcbiAgICAgICAgICAgICAgICBib3R0b206IFwiXCIsXG4gICAgICAgICAgICAgICAgdG9wOiBvZmZzZXRcbiAgICAgICAgICAgICAgfSkudHJpZ2dlcihcInN0aWNreV9raXQ6dW5ib3R0b21cIik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChzY3JvbGwgPCB0b3ApIHtcbiAgICAgICAgICAgIGZpeGVkID0gZmFsc2U7XG4gICAgICAgICAgICBvZmZzZXQgPSBvZmZzZXRfdG9wO1xuICAgICAgICAgICAgaWYgKG1hbnVhbF9zcGFjZXIgPT0gbnVsbCkge1xuICAgICAgICAgICAgICBpZiAoZWxfZmxvYXQgPT09IFwibGVmdFwiIHx8IGVsX2Zsb2F0ID09PSBcInJpZ2h0XCIpIHtcbiAgICAgICAgICAgICAgICBlbG0uaW5zZXJ0QWZ0ZXIoc3BhY2VyKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBzcGFjZXIuZGV0YWNoKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjc3MgPSB7XG4gICAgICAgICAgICAgIHBvc2l0aW9uOiBcIlwiLFxuICAgICAgICAgICAgICB3aWR0aDogXCJcIixcbiAgICAgICAgICAgICAgdG9wOiBcIlwiXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgZWxtLmNzcyhjc3MpLnJlbW92ZUNsYXNzKHN0aWNreV9jbGFzcykudHJpZ2dlcihcInN0aWNreV9raXQ6dW5zdGlja1wiKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgaWYgKGlubmVyX3Njcm9sbGluZykge1xuICAgICAgICAgICAgd2luX2hlaWdodCA9IHdpbi5oZWlnaHQoKTtcbiAgICAgICAgICAgIGlmIChoZWlnaHQgKyBvZmZzZXRfdG9wID4gd2luX2hlaWdodCkge1xuICAgICAgICAgICAgICBpZiAoIWJvdHRvbWVkKSB7XG4gICAgICAgICAgICAgICAgb2Zmc2V0IC09IGRlbHRhO1xuICAgICAgICAgICAgICAgIG9mZnNldCA9IE1hdGgubWF4KHdpbl9oZWlnaHQgLSBoZWlnaHQsIG9mZnNldCk7XG4gICAgICAgICAgICAgICAgb2Zmc2V0ID0gTWF0aC5taW4ob2Zmc2V0X3RvcCwgb2Zmc2V0KTtcbiAgICAgICAgICAgICAgICBpZiAoZml4ZWQpIHtcbiAgICAgICAgICAgICAgICAgIGVsbS5jc3Moe1xuICAgICAgICAgICAgICAgICAgICB0b3A6IG9mZnNldCArIFwicHhcIlxuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGlmIChzY3JvbGwgPiB0b3ApIHtcbiAgICAgICAgICAgIGZpeGVkID0gdHJ1ZTtcbiAgICAgICAgICAgIGNzcyA9IHtcbiAgICAgICAgICAgICAgcG9zaXRpb246IFwiZml4ZWRcIixcbiAgICAgICAgICAgICAgdG9wOiBvZmZzZXRcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICBjc3Mud2lkdGggPSBlbG0uY3NzKFwiYm94LXNpemluZ1wiKSA9PT0gXCJib3JkZXItYm94XCIgPyBlbG0ub3V0ZXJXaWR0aCgpICsgXCJweFwiIDogZWxtLndpZHRoKCkgKyBcInB4XCI7XG4gICAgICAgICAgICBlbG0uY3NzKGNzcykuYWRkQ2xhc3Moc3RpY2t5X2NsYXNzKTtcbiAgICAgICAgICAgIGlmIChtYW51YWxfc3BhY2VyID09IG51bGwpIHtcbiAgICAgICAgICAgICAgZWxtLmFmdGVyKHNwYWNlcik7XG4gICAgICAgICAgICAgIGlmIChlbF9mbG9hdCA9PT0gXCJsZWZ0XCIgfHwgZWxfZmxvYXQgPT09IFwicmlnaHRcIikge1xuICAgICAgICAgICAgICAgIHNwYWNlci5hcHBlbmQoZWxtKTtcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxtLnRyaWdnZXIoXCJzdGlja3lfa2l0OnN0aWNrXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBpZiAoZml4ZWQgJiYgZW5hYmxlX2JvdHRvbWluZykge1xuICAgICAgICAgIGlmICh3aWxsX2JvdHRvbSA9PSBudWxsKSB7XG4gICAgICAgICAgICB3aWxsX2JvdHRvbSA9IHNjcm9sbCArIGhlaWdodCArIG9mZnNldCA+IHBhcmVudF9oZWlnaHQgKyBwYXJlbnRfdG9wO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoIWJvdHRvbWVkICYmIHdpbGxfYm90dG9tKSB7XG4gICAgICAgICAgICBib3R0b21lZCA9IHRydWU7XG4gICAgICAgICAgICBpZiAocGFyZW50LmNzcyhcInBvc2l0aW9uXCIpID09PSBcInN0YXRpY1wiKSB7XG4gICAgICAgICAgICAgIHBhcmVudC5jc3Moe1xuICAgICAgICAgICAgICAgIHBvc2l0aW9uOiBcInJlbGF0aXZlXCJcbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gZWxtLmNzcyh7XG4gICAgICAgICAgICAgIHBvc2l0aW9uOiBcImFic29sdXRlXCIsXG4gICAgICAgICAgICAgIGJvdHRvbTogcGFkZGluZ19ib3R0b20sXG4gICAgICAgICAgICAgIHRvcDogXCJhdXRvXCJcbiAgICAgICAgICAgIH0pLnRyaWdnZXIoXCJzdGlja3lfa2l0OmJvdHRvbVwiKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICByZWNhbGNfYW5kX3RpY2sgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgcmVjYWxjKCk7XG4gICAgICAgIHJldHVybiB0aWNrKCk7XG4gICAgICB9O1xuICAgICAgZGV0YWNoID0gZnVuY3Rpb24oKSB7XG4gICAgICAgIGRldGFjaGVkID0gdHJ1ZTtcbiAgICAgICAgd2luLm9mZihcInRvdWNobW92ZVwiLCB0aWNrKTtcbiAgICAgICAgd2luLm9mZihcInNjcm9sbFwiLCB0aWNrKTtcbiAgICAgICAgd2luLm9mZihcInJlc2l6ZVwiLCByZWNhbGNfYW5kX3RpY2spO1xuICAgICAgICAkKGRvY3VtZW50LmJvZHkpLm9mZihcInN0aWNreV9raXQ6cmVjYWxjXCIsIHJlY2FsY19hbmRfdGljayk7XG4gICAgICAgIGVsbS5vZmYoXCJzdGlja3lfa2l0OmRldGFjaFwiLCBkZXRhY2gpO1xuICAgICAgICBlbG0ucmVtb3ZlRGF0YShcInN0aWNreV9raXRcIik7XG4gICAgICAgIGVsbS5jc3Moe1xuICAgICAgICAgIHBvc2l0aW9uOiBcIlwiLFxuICAgICAgICAgIGJvdHRvbTogXCJcIixcbiAgICAgICAgICB0b3A6IFwiXCIsXG4gICAgICAgICAgd2lkdGg6IFwiXCJcbiAgICAgICAgfSk7XG4gICAgICAgIHBhcmVudC5wb3NpdGlvbihcInBvc2l0aW9uXCIsIFwiXCIpO1xuICAgICAgICBpZiAoZml4ZWQpIHtcbiAgICAgICAgICBpZiAobWFudWFsX3NwYWNlciA9PSBudWxsKSB7XG4gICAgICAgICAgICBpZiAoZWxfZmxvYXQgPT09IFwibGVmdFwiIHx8IGVsX2Zsb2F0ID09PSBcInJpZ2h0XCIpIHtcbiAgICAgICAgICAgICAgZWxtLmluc2VydEFmdGVyKHNwYWNlcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzcGFjZXIucmVtb3ZlKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIHJldHVybiBlbG0ucmVtb3ZlQ2xhc3Moc3RpY2t5X2NsYXNzKTtcbiAgICAgICAgfVxuICAgICAgfTtcbiAgICAgIHdpbi5vbihcInRvdWNobW92ZVwiLCB0aWNrKTtcbiAgICAgIHdpbi5vbihcInNjcm9sbFwiLCB0aWNrKTtcbiAgICAgIHdpbi5vbihcInJlc2l6ZVwiLCByZWNhbGNfYW5kX3RpY2spO1xuICAgICAgJChkb2N1bWVudC5ib2R5KS5vbihcInN0aWNreV9raXQ6cmVjYWxjXCIsIHJlY2FsY19hbmRfdGljayk7XG4gICAgICBlbG0ub24oXCJzdGlja3lfa2l0OmRldGFjaFwiLCBkZXRhY2gpO1xuICAgICAgcmV0dXJuIHNldFRpbWVvdXQodGljaywgMCk7XG4gICAgfTtcbiAgICBmb3IgKGkgPSAwLCBsZW4gPSB0aGlzLmxlbmd0aDsgaSA8IGxlbjsgaSsrKSB7XG4gICAgICBlbG0gPSB0aGlzW2ldO1xuICAgICAgZm4oJChlbG0pKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbn0pLmNhbGwodGhpcyk7XG4iLCIvKipcbiAqIGpRdWVyeSBzeW5jVHJhbnNsaXQgcGx1Z2luXG4gKlxuICogQ29weXJpZ2h0IChjKSAyMDA5IFNuaXRrbyBSb21hblxuICogRHVhbCBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIChNSVQtTElDRU5TRS50eHQpXG4gKiBhbmQgR1BMIChHUEwtTElDRU5TRS50eHQpIGxpY2Vuc2VzLlxuICpcbiAqIEBhdXRob3IgXHRSb21hbiBTbml0a28gc25vd2NvcmUubmV0QGdtYWlsLmNvbVxuICogQGxpbmsgaHR0cDovL3Nub3djb3JlLm5ldC9cbiAqIEB2ZXJzaW9uIDAuMC43XG4gKi9cbjsoZnVuY3Rpb24oJCl7XG4gICAgJC5mbi5zeW5jVHJhbnNsaXQgPSBmdW5jdGlvbihvcHRpb25zKSB7XG4gICAgICAgIHZhciBvcHRzID0gJC5leHRlbmQoe30sICQuZm4uc3luY1RyYW5zbGl0LmRlZmF1bHRzLCBvcHRpb25zKTtcbiAgICAgICAgaWYob3B0cy5zdHJ0cikge1xuICAgICAgICAgICAgcmV0dXJuICQuZm4uc3luY1RyYW5zbGl0LnN0cnRyKCBvcHRzICk7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICAgIHJldHVybiB0aGlzLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgICAgICAgICAkdGhpcyA9ICQodGhpcyk7XG4gICAgICAgICAgICB2YXIgbyA9ICQubWV0YSA/ICQuZXh0ZW5kKHt9LCBvcHRzLCAkdGhpcy5kYXRhKCkpIDogb3B0cztcbiAgICAgICAgICAgIHZhciAkZGVzdGluYXRpb24gPSAkKCcjJyArIG9wdHMuZGVzdGluYXRpb24pO1xuICAgICAgICAgICAgby5kZXN0aW5hdGlvbk9iamVjdCA9ICRkZXN0aW5hdGlvbjtcbiAgICAgICAgICAgIFxuICAgICAgICAgICAgLy8gSUUgYWx3YXlzIHN1Y2tzIDopXG4gICAgICAgICAgICBpZiAoIUFycmF5LmluZGV4T2YpIHtcbiAgICAgICAgICAgICAgICBBcnJheS5wcm90b3R5cGUuaW5kZXhPZiA9IGZ1bmN0aW9uKG9iaikge1xuICAgICAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzW2ldID09IG9iaikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiAtMTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgICAgICR0aGlzLmtleXVwKGZ1bmN0aW9uKCl7XG4gICAgICAgICAgICBcdHZhciBzdHIgPSAkKHRoaXMpLnZhbCgpO1xuICAgICAgICAgICAgXHR2YXIgcmVzdWx0ID0gJyc7XG4gICAgICAgICAgICBcdGZvciAodmFyIGkgPSAwOyBpIDwgc3RyLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBcdFx0cmVzdWx0ICs9ICQuZm4uc3luY1RyYW5zbGl0LnRyYW5zbGl0ZXJhdGUoc3RyLmNoYXJBdChpKSwgbylcbiAgICAgICAgICAgIFx0fVxuICAgICAgICAgICAgXHR2YXIgcmVnRXhwID0gbmV3IFJlZ0V4cCgnWycgKyBvLnVybFNlcGFyYXRvciArICddezIsfScsICdnJyk7XG4gICAgICAgICAgICBcdHJlc3VsdCA9IHJlc3VsdC5yZXBsYWNlKHJlZ0V4cCwgby51cmxTZXBhcmF0b3IpO1xuICAgICAgICAgICAgXHQkZGVzdGluYXRpb24udmFsKHJlc3VsdCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICB9KTtcbiAgICB9O1xuICAgIFxuICAgIFxuICAgICQuZm4uc3luY1RyYW5zbGl0LnN0cnRyID0gZnVuY3Rpb24ob3B0cykge1xuICAgICAgICB2YXIgdGV4dCA9IChvcHRzLl90ZXh0KSA/IG9wdHMuX3RleHQgOiAnJztcblxuICAgICAgICB2YXIgcmVzdWx0ID0gJyc7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGV4dC5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIHJlc3VsdCArPSAkLmZuLnN5bmNUcmFuc2xpdC50cmFuc2xpdGVyYXRlKHRleHQuY2hhckF0KGkpLCBvcHRzKTtcbiAgICAgICAgfVxuICAgICAgICB2YXIgcmVnRXhwID0gbmV3IFJlZ0V4cCgnWycgKyBvcHRzLnVybFNlcGFyYXRvciArICddezIsfScsICdnJyk7XG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5yZXBsYWNlKHJlZ0V4cCwgb3B0cy51cmxTZXBhcmF0b3IpO1xuICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgIH1cbiAgICBcbiAgICAvKipcbiAgICAgKiBUcmFuc2xpdGVyYXRlIGNoYXJhY3RlclxuICAgICAqIEBwYXJhbSB7U3RyaW5nfSBjaGFyYWN0ZXJcbiAgICAgKiBAcGFyYW0ge09iamVjdH0gb3B0c1xuICAgICAqL1xuICAgICQuZm4uc3luY1RyYW5zbGl0LnRyYW5zbGl0ZXJhdGUgPSBmdW5jdGlvbihjaGFyLCBvcHRzKSB7XG4gICAgXHR2YXIgY2hhcklzTG93ZXJDYXNlID0gdHJ1ZSwgdHJDaGFyO1xuICAgIFx0aWYgKGNoYXIudG9Mb3dlckNhc2UoKSAhPSBjaGFyKSB7XG4gICAgXHRcdGNoYXJJc0xvd2VyQ2FzZSA9IGZhbHNlO1xuICAgIFx0fVxuICAgIFx0XG4gICAgXHRjaGFyID0gY2hhci50b0xvd2VyQ2FzZSgpO1xuICAgIFx0XG4gICAgXHR2YXIgaW5kZXggPSBvcHRzLmRpY3RPcmlnaW5hbC5pbmRleE9mKGNoYXIpO1xuICAgIFx0aWYgKGluZGV4ID09IC0xKSB7XG4gICAgXHRcdHRyQ2hhciA9IGNoYXI7XG4gICAgXHR9IGVsc2Uge1xuICAgIFx0XHR0ckNoYXIgPSBvcHRzLmRpY3RUcmFuc2xhdGVbaW5kZXhdO1xuICAgIFx0fVxuICAgIFx0XG4gICAgXHRpZiAob3B0cy50eXBlID09ICd1cmwnKSB7XG5cdCAgICBcdHZhciBjb2RlID0gdHJDaGFyLmNoYXJDb2RlQXQoMCk7XG4gICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgaWYodHJDaGFyID09ICcuJykgeyByZXR1cm4gJy4nOyB9IC8vIGZpeCDRgtC+0YfQutCwXG4gICAgICAgICAgICAgICAgXG5cdCAgICBcdGlmIChjb2RlID49IDMzICAmJiBjb2RlIDw9IDQ3ICYmIGNvZGUgIT0gNDVcblx0ICAgIFx0XHR8fCBjb2RlID49IDU4ICAmJiBjb2RlIDw9IDY0XG5cdCAgICBcdFx0fHwgY29kZSA+PSA5MSAgJiYgY29kZSA8PSA5NlxuXHQgICAgXHRcdHx8IGNvZGUgPj0gMTIzICYmIGNvZGUgPD0gMTI2XG5cdCAgICBcdFx0fHwgY29kZSA+PSAxMDcyXG5cdCAgICBcdCkge1xuXHQgICAgXHRcdHJldHVybiAnJztcblx0ICAgIFx0fVxuXHQgICAgXHRpZiAodHJDaGFyID09ICcgJyB8fCB0ckNoYXIgPT0gJy0nKSB7XG5cdCAgICBcdFx0cmV0dXJuIG9wdHMudXJsU2VwYXJhdG9yO1xuXHQgICAgXHR9XG4gICAgXHR9XG4gICAgXHRcbiAgICBcdGlmIChvcHRzLmNhc2VTdHlsZSA9PSAndXBwZXInKSB7XG4gICAgXHRcdHJldHVybiB0ckNoYXIudG9VcHBlckNhc2UoKTtcbiAgICBcdH0gZWxzZSBpZiAob3B0cy5jYXNlU3R5bGUgPT0gJ25vcm1hbCcpIHtcbiAgICBcdFx0aWYgKGNoYXJJc0xvd2VyQ2FzZSkge1xuICAgIFx0XHRcdHJldHVybiB0ckNoYXIudG9Mb3dlckNhc2UoKTtcbiAgICBcdFx0fSBlbHNlIHtcbiAgICBcdFx0XHRyZXR1cm4gdHJDaGFyLnRvVXBwZXJDYXNlKCk7XG4gICAgXHRcdH1cbiAgICBcdH1cblx0ICAgIHJldHVybiB0ckNoYXI7XG4gICAgfTtcbiAgICBcbiAgICAvKipcbiAgICAgKiBEZWZhdWx0IG9wdGlvbnNcbiAgICAgKi9cbiAgICAkLmZuLnN5bmNUcmFuc2xpdC5kZWZhdWx0cyA9IHtcbiAgICAgICAgLyoqXG4gICAgICAgICAqIERpY3Rpb25hcmllc1xuICAgICAgICAgKi9cbiAgICAgICAgZGljdE9yaWdpbmFsOiAgWyfQsCcsICfQsScsICfQsicsICfQsycsICfQtCcsICfQtScsXG4gICAgICAgICAgICAgICAgICAgICAgICAn0ZEnLCAn0LYnLCAn0LcnLCAn0LgnLCAn0LknLCAn0LonLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ9C7JywgJ9C8JywgJ9C9JywgJ9C+JywgJ9C/JywgJ9GAJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICfRgScsICfRgicsICfRgycsICfRhCcsICfRhScsICfRhicsXG4gICAgICAgICAgICAgICAgICAgICAgICAn0YcnLCAn0YgnLCAn0YknLCAn0YonLCAn0YsnLCAn0YwnLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ9GNJywgJ9GOJywgJ9GPJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICfRlicsICfRlCcsICfRlycsICfSkSdcbiAgICAgICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgIGRpY3RUcmFuc2xhdGU6IFsnYScsICdiJywgJ3YnLCAnZycsICdkJywgJ2UnLFxuICAgICAgICAgICAgICAgICAgICAgICAgJ2UnLCAnemgnLCd6JywgJ2knLCAnaicsICdrJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICdsJywgJ20nLCAnbicsICdvJywgJ3AnLCAncicsXG4gICAgICAgICAgICAgICAgICAgICAgICAncycsICd0JywgJ3UnLCAnZicsICdoJywgJ3RzJyxcbiAgICAgICAgICAgICAgICAgICAgICAgICdjaCcsJ3NoJywnc2NoJywgJycsICd5JywgJycsXG4gICAgICAgICAgICAgICAgICAgICAgICAnZScsICdqdScsICdqYScsXG4gICAgICAgICAgICAgICAgICAgICAgICAnaScsICdqZScsICdqaScsICdnJ1xuICAgICAgICAgICAgICAgICAgICAgICAgXSxcbiAgICAgICAgXG4gICAgICAgIC8qXG4gICAgICAgICAqIENhc2UgdHJhbnNmb3JtYXRpb246IG5vcm1hbCwgbG93ZXIsIHVwcGVyXG4gICAgICAgICAqL1xuICAgICAgICBjYXNlU3R5bGU6ICdsb3dlcicsXG4gICAgICAgIFxuICAgICAgICAvKlxuICAgICAgICAgKiBXb3JkcyBzZXBhcmF0b3IgaW4gdXJsXG4gICAgICAgICAqL1xuICAgICAgICB1cmxTZXBhcmF0b3I6ICctJyxcbiAgICAgICAgXG4gICAgICAgIC8qXG4gICAgICAgICAqIFRyYW5zbGl0ZXJhdGlvbiB0eXBlOiByYXcgb3IgdXJsXG4gICAgICAgICAqICAgIHVybCAtIHVzZWQgZm9yIHRyYW5zbGl0ZXJhdGluZyB0ZXh0IGludG8gdXJsIHNsdWdcbiAgICAgICAgICogICAgcmF3IC0gcmF3IHRyYW5zbGl0ZXJhdGlvbiAod2l0aCBzcGVjaWFsIGNoYXJhY3RlcnMpXG4gICAgICAgICAqL1xuICAgICAgICB0eXBlOiAndXJsJ1xuICAgIH07XG59KShqUXVlcnkpOyIsIiQoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uKCl7IFxuICAgIHZhciBfZW1haWwgPSBuZXcgU3RyaW5nKCQoXCIuYm94LWZvcm0tc3Vic2NyaWJlID4gZm9ybSBpbnB1dC5lbWFpbFwiKS5hdHRyKFwibmFtZVwiKSk7XG4gICAgJCgnLmJveC1mb3JtLXN1YnNjcmliZSA+IGZvcm0nKS52YWxpZGF0ZSh7XG4gICAgICAgIG9uZm9jdXNvdXQ6IGZhbHNlLFxuICAgICAgICBvbmtleXVwOiBmYWxzZSxcbiAgICAgICAgb25jbGljazogdHJ1ZSxcbiAgICAgICAgb25zdWJtaXQ6IHRydWUsXG4gICAgICAgIGZvY3VzSW52YWxpZDogZmFsc2UsXG4gICAgICAgIGZvY3VzQ2xlYW51cDogZmFsc2UsICAgICAgICBcbiAgICAgICAgX2VtYWlsOiB7XG4gICAgICAgICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgICAgICAgIGVtYWlsOiB0cnVlXG4gICAgICAgIH0sXG4gICAgICAgIG1lc3NhZ2VzOiB7XG4gICAgICAgICAgICBfZW1haWw6IHtcbiAgICAgICAgICAgICAgICByZXF1aXJlZDogJ1RoZSBFbWFpbCBmaWVsZCBpcyBlbXB0eScsXG4gICAgICAgICAgICAgICAgZW1haWw6ICdXZeKAmWxsIG5ldmVyIHNoYXJlIHlvdXIgZW1haWwgYWRyZXNzIGFuZCB5b3UgY2FuIG9wdCBvdXQgYXQgYW55IHRpbWUsIHdlIHByb21pc2UuJ1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuXG4gICAgICAgIGVycm9yQ2xhc3M6ICdibG9jay1lcnJvcicsXG4gICAgICAgIHZhbGlkQ2xhc3M6ICdzdWNjZXNzJyxcbiAgICAgICAgaW52YWxpZEhhbmRsZXI6IGZ1bmN0aW9uKGV2ZW50LCB2YWxpZGF0b3IpIHtcbiAgICAgICAgICAgIGlmKCQoJy5ib3gtZm9ybS1zdWJzY3JpYmUgPiBmb3JtIC5ibG9jay1lcnJvcicpLmxlbmd0aClcbiAgICAgICAgICAgICAgICAkKCcuYm94LWZvcm0tc3Vic2NyaWJlID4gZm9ybSAuYmxvY2stZXJyb3InKS5odG1sKCAnICcgKS5oaWRlKCk7XG4gICAgICAgIH0sXG4gICAgICAgIC8vINGD0L/RgNCw0LLQu9C10L3QuNC1INC+0YjQuNCx0LrQsNC80LhcbiAgICAgICAgc2hvd0Vycm9yczogZnVuY3Rpb24oZXJyb3JNYXAsIGVycm9yTGlzdCkge1xuICAgICAgICAgICAgdmFyIG1zZyA9ICcnO1xuICAgICAgICAgICAgJC5lYWNoKGVycm9yTGlzdCwgZnVuY3Rpb24oKXtcbiAgICAgICAgICAgICAgICBpZih0aGlzLm1lc3NhZ2UpIFxuICAgICAgICAgICAgICAgICAgICBtc2cgKz0gdGhpcy5tZXNzYWdlICsgJzxiciAvPic7IFxuICAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgICBpZihtc2cgIT09ICcnKSBcbiAgICAgICAgICAgICAgICAkKCcuYm94LWZvcm0tc3Vic2NyaWJlID4gZm9ybSAuYmxvY2stZXJyb3InKS5odG1sKG1zZykuc2hvdygpO1xuICAgICAgICB9LFxuICAgIH0pO1xufSk7ICAgIFxuIiwiLyogXG4gKiBUbyBjaGFuZ2UgdGhpcyBsaWNlbnNlIGhlYWRlciwgY2hvb3NlIExpY2Vuc2UgSGVhZGVycyBpbiBQcm9qZWN0IFByb3BlcnRpZXMuXG4gKiBUbyBjaGFuZ2UgdGhpcyB0ZW1wbGF0ZSBmaWxlLCBjaG9vc2UgVG9vbHMgfCBUZW1wbGF0ZXNcbiAqIGFuZCBvcGVuIHRoZSB0ZW1wbGF0ZSBpbiB0aGUgZWRpdG9yLlxuICovXG5cbmZ1bmN0aW9uIGlzc2V0KGVsZW1lbnQpIHtcbiAgICBpZih0eXBlb2YgZWxlbWVudCAhPSAndW5kZWZpbmVkJykge1xuICAgICAgICByZXR1cm4gZWxlbWVudC5sZW5ndGggPiAwO1xuICAgIH0gZWxzZVxuICAgICAgICByZXR1cm4gZmFsc2U7XG59XG5cbi8qXG4gKiBwYXJjZSB1cmxcbiAqKi9cbmZ1bmN0aW9uIHBhcnNlVXJsUXVlcnkoKSB7XG4gICAgdmFyIGRhdGEgPSB7fTtcbiAgICBpZihsb2NhdGlvbi5zZWFyY2gpIHtcbiAgICAgICAgdmFyIHBhaXIgPSAobG9jYXRpb24uc2VhcmNoLnN1YnN0cigxKSkuc3BsaXQoJyYnKTtcbiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IHBhaXIubGVuZ3RoOyBpICsrKSB7XG4gICAgICAgICAgICB2YXIgcGFyYW0gPSBwYWlyW2ldLnNwbGl0KCc9Jyk7XG4gICAgICAgICAgICBkYXRhW3BhcmFtWzBdXSA9IHBhcmFtWzFdO1xuICAgICAgICB9XG4gICAgfVxuICAgIHJldHVybiBkYXRhO1xufVxuXG4vKlxuICogcGFyY2Ugc3RyaW5nIHNlcmlsaXplXG4gKiovXG5mdW5jdGlvbiBwYXJzZVF1ZXJ5KCBzdHIgKSB7XG4gICAgdmFyIGRhdGEgPSB7fTtcbiAgICBpZih0eXBlb2Ygc3RyID09ICdzdHJpbmcnKSB7XG4gICAgICAgIHZhciBwYWlyID0gKHN0cikuc3BsaXQoJyYnKTtcbiAgICAgICAgZm9yKHZhciBpID0gMDsgaSA8IHBhaXIubGVuZ3RoOyBpICsrKSB7XG4gICAgICAgICAgICB2YXIgcGFyYW0gPSBwYWlyW2ldLnNwbGl0KCc9Jyk7XG4gICAgICAgICAgICBkYXRhW3BhcmFtWzBdXSA9IHBhcmFtWzFdO1xuICAgICAgICB9XG4gICAgfSBlbHNlIGlmKHR5cGVvZiBzdHIgPT0gJ29iamVjdCcpIHtcbiAgICAgICAgJC5lYWNoKHN0ciwgZnVuY3Rpb24oX2ssIF92YWwpIHtcbiAgICAgICAgICAgIGlmKF92YWwubmFtZSlcbiAgICAgICAgICAgICAgICBkYXRhWyBfdmFsLm5hbWUgXSA9IChfdmFsLnZhbHVlKSA/IF92YWwudmFsdWUgOiBudWxsO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgcmV0dXJuIGRhdGE7XG59XG5cbi8qXG4gKiBBamF4IGZ1bmN0aW9uLlxuICogcmV0dXJuIGpzb24gcmVzdWx0XG4gKiovXG5mdW5jdGlvbiBnZXRBamF4Rm9ybShwYXRoLCBwYXJhbXMsIG9wdGlvbnMpIHtcbiAgXG4gICAgaWYoIW9wdGlvbnMpIG9wdGlvbnMgPSB7fTtcbiAgICBcbiAgICB2YXIgc2V0dGluZ3MgPSAkLmV4dGVuZCgge1xuICAgICAgICAnZGF0YVR5cGUnOiAnanNvbicsXG4gICAgICAgICdhc3luYyc6IGZhbHNlLFxuICAgICAgICAnY3Jvc3NEb21haW4nOiBmYWxzZSxcbiAgICAgICAgJ3R5cGUnOiAnUE9TVCcsXG4gICAgICAgICdjYWNoZSc6IHRydWVcbiAgICB9LCBvcHRpb25zIHx8IHt9KTtcbiAgICBcbiAgICBjb25zb2xlLmxvZyggc2V0dGluZ3MgKTtcbiAgICBcbiAgICBpZighcGF0aCkge1xuICAgICAgICBjb25zb2xlLmxvZygnZW50ZXIgdXJsIEFKQVghJyk7XG4gICAgICAgIHJldHVybiBudWxsO1xuICAgIH1cbiAgICB2YXIgcmVzID0gJC5hamF4KHtcbiAgICAgICAgICAgICAgICAgICAgdXJsOiBwYXRoLFxuICAgICAgICAgICAgICAgICAgICBkYXRhVHlwZTogc2V0dGluZ3MuZGF0YVR5cGUsXG4gICAgICAgICAgICAgICAgICAgIGFzeW5jOiBzZXR0aW5ncy5hc3luYyxcbiAgICAgICAgICAgICAgICAgICAgY3Jvc3NEb21haW46IHNldHRpbmdzLmNyb3NzRG9tYWluLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBzZXR0aW5ncy50eXBlLFxuICAgICAgICAgICAgICAgICAgICBjYWNoZTogc2V0dGluZ3MuY2FjaGUsXG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlOiBmdW5jdGlvbigpe1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICBwYXJhbXM6IHBhcmFtcyBcbiAgICAgICAgICAgICAgICAgICAgfVxuXHRcdH0pLnJlc3BvbnNlVGV4dDtcbiAgICAgICAgICAgICAgICBcbiAgICBjb25zb2xlLmxvZyhyZXMpOyAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgIFxuICAgIHJlcyA9IGV2YWwoJ1snK3JlcysnXScpO1xuICAgIHZhciBvYmogPSByZXNbMF07XG4gICAgcmV0dXJuIG9iajtcbn1cblxuLypcbiAqIEpTT05QXG4gKiBcbiAqL1xuZnVuY3Rpb24gX2dldEFKQVgoIHBhdGgsIHBhcmFtcywgb3B0aW9ucyApIHtcbiAgIGlmKCFvcHRpb25zKSBvcHRpb25zID0ge307XG4gICAgXG4gICAgdmFyIHNldHRpbmdzID0gJC5leHRlbmQoIHtcbiAgICAgICAgJ2RhdGFUeXBlJzogJ2pzb25wJyxcbiAgICAgICAgJ2pzb25wJzogXCJjYWxsYmFja1wiLFxuICAgICAgICAnYXN5bmMnOiBmYWxzZSxcbiAgICAgICAgJ2Nyb3NzRG9tYWluJzogZmFsc2UsXG4gICAgICAgICd0eXBlJzogJ1BPU1QnLFxuICAgICAgICAnY2FjaGUnOiB0cnVlXG4gICAgfSwgb3B0aW9ucyB8fCB7fSk7XG4gICAgXG4gICAgY29uc29sZS5sb2coIHNldHRpbmdzICk7XG4gICAgXG4gICAgaWYoIXBhdGgpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2VudGVyIHVybCBBSkFYIScpO1xuICAgICAgICByZXR1cm4gbnVsbDtcbiAgICB9ICAgXG5cbiAgICByZXR1cm4gJC5hamF4KHsgXG4gICAgICAgIHR5cGU6IHNldHRpbmdzLnR5cGUsXG4gICAgICAgIGFzeW5jOiBzZXR0aW5ncy5hc3luYyxcbiAgICAgICAgdXJsOiBwYXRoLFxuICAgICAgICBkYXRhOiB7IFxuICAgICAgICAgICBwYXJhbXM6IHBhcmFtcyBcbiAgICAgICAgfSxcbiAgICAgICAgZGF0YVR5cGU6IHNldHRpbmdzLmRhdGFUeXBlLFxuICAgICAgICBqc29ucDogc2V0dGluZ3MuanNvbnAsXG4gICAgICAgIGNyb3NzRG9tYWluOiBzZXR0aW5ncy5jcm9zc0RvbWFpbixcbiAgICAgICAgY2FjaGU6IHNldHRpbmdzLmNhY2hlLFxuICAgIH0pO1xufSIsIi8qIVxuICogQm9vdHN0cmFwIFlvdVR1YmUgUG9wdXAgUGxheWVyIFBsdWdpblxuICogYXV0aG9yOiBFZGlpIFNoYWRvd1xuICovXG4oZnVuY3Rpb24gKCQpIHtcbiAgdmFyICRZb3VUdWJlTW9kYWwgPSBudWxsLFxuICAgICRZb3VUdWJlTW9kYWxEaWFsb2cgPSBudWxsLFxuICAgICRZb3VUdWJlTW9kYWxUaXRsZSA9IG51bGwsXG4gICAgJFlvdVR1YmVNb2RhbEJvZHkgPSBudWxsLFxuICAgIG1hcmdpbiA9IDUsXG4gICAgbWV0aG9kcztcblxuICAvL1BsdWdpbiBtZXRob2RzXG4gIG1ldGhvZHMgPSB7XG4gICAgLy9pbml0aWFsaXplIHBsdWdpblxuICAgIGluaXQ6IGZ1bmN0aW9uIChvcHRpb25zKSB7XG4gICAgICBvcHRpb25zID0gJC5leHRlbmQoe30sICQuZm4uWW91VHViZU1vZGFsLmRlZmF1bHRzLCBvcHRpb25zKTtcblxuICAgICAgLy8gaW5pdGlhbGl6ZSBZb3VUdWJlIFBsYXllciBNb2RhbFxuICAgICAgaWYgKCRZb3VUdWJlTW9kYWwgPT0gbnVsbCkge1xuICAgICAgICAkWW91VHViZU1vZGFsID0gJCgnPGRpdiBjbGFzcz1cIm1vZGFsICcgKyBvcHRpb25zLmNzc0NsYXNzICsgJ1wiIGlkPVwiWW91VHViZU1vZGFsXCIgcm9sZT1cImRpYWxvZ1wiIGFyaWEtaGlkZGVuPVwidHJ1ZVwiPicpOyAvLyBmYWRlXG4gICAgICAgIFxuICAgICAgICBcbiAgICAgICAgdmFyIG1vZGFsQ29udGVudCA9ICc8ZGl2IGNsYXNzPVwibW9kYWwtZGlhbG9nXCIgaWQ9XCJZb3VUdWJlTW9kYWxEaWFsb2dcIj4nICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwibW9kYWwtY29udGVudFwiIGlkPVwiWW91VHViZU1vZGFsQ29udGVudFwiPicgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJ2aWRlby13cmFwcGVyXCI+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwidmlkZW8taW5uZXJcIj4nK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxidXR0b24gdHlwZT1cImJ1dHRvblwiIGRhdGEtZGlzbWlzcz1cIm1vZGFsXCIgYXJpYS1oaWRkZW49XCJ0cnVlXCIgY2xhc3M9XCJ2aWRlby1jbG9zZSBjbG9zZVwiPjwvYnV0dG9uPicrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwibW9kYWwtYm9keVwiIGlkPVwiWW91VHViZU1vZGFsQm9keVwiPjwvZGl2PicgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvZGl2PicrIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nKyAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvZGl2Pic7XG4gICAgICAgIFxuICAgICAgICBcbi8vICAgICAgICB2YXIgbW9kYWxDb250ZW50ID0gJzxkaXYgY2xhc3M9XCJtb2RhbC1kaWFsb2dcIiBpZD1cIllvdVR1YmVNb2RhbERpYWxvZ1wiPicgK1xuLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cIm1vZGFsLWNvbnRlbnRcIiBpZD1cIllvdVR1YmVNb2RhbENvbnRlbnRcIj4nICtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cIm1vZGFsLWhlYWRlclwiPicgK1xuLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiY2xvc2VcIiBkYXRhLWRpc21pc3M9XCJtb2RhbFwiPiZ0aW1lczs8L2J1dHRvbj4nICtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8aDQgY2xhc3M9XCJtb2RhbC10aXRsZVwiIGlkPVwiWW91VHViZU1vZGFsVGl0bGVcIj48L2g0PicgK1xuLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nICtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cIm1vZGFsLWJvZHlcIiBpZD1cIllvdVR1YmVNb2RhbEJvZHlcIiBzdHlsZT1cInBhZGRpbmc6MDtcIj48L2Rpdj4nICtcbi8vICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvZGl2PicgK1xuLy8gICAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvZGl2Pic7XG4gICAgICAgICRZb3VUdWJlTW9kYWwuaHRtbChtb2RhbENvbnRlbnQpLmhpZGUoKS5hcHBlbmRUbygnYm9keScpO1xuICAgICAgICAkWW91VHViZU1vZGFsRGlhbG9nID0gJChcIiNZb3VUdWJlTW9kYWxEaWFsb2dcIik7XG4gICAgICAgICRZb3VUdWJlTW9kYWxUaXRsZSA9ICQoXCIjWW91VHViZU1vZGFsVGl0bGVcIik7XG4gICAgICAgICRZb3VUdWJlTW9kYWxCb2R5ID0gJChcIiNZb3VUdWJlTW9kYWxCb2R5XCIpO1xuICAgICAgICAkWW91VHViZU1vZGFsLm1vZGFsKHtcbiAgICAgICAgICBzaG93OiBmYWxzZVxuICAgICAgICB9KS5vbignaGlkZS5icy5tb2RhbCcsIHJlc2V0TW9kYWxCb2R5KTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBvYmogPSAkKHRoaXMpO1xuICAgICAgICB2YXIgZGF0YSA9IG9iai5kYXRhKCdZb3VUdWJlJyk7XG4gICAgICAgIGlmICghZGF0YSkgeyAvL2NoZWNrIGlmIGV2ZW50IGlzIGFscmVhZHkgYXNzaWduZWRcbiAgICAgICAgICBvYmouZGF0YSgnWW91VHViZScsIHtcbiAgICAgICAgICAgIHRhcmdldDogb2JqXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgJChvYmopLmJpbmQoJ2NsaWNrLllvdVR1YmVNb2RhbCcsIGZ1bmN0aW9uIChldmVudCkge1xuICAgICAgICAgICAgdmFyIHlvdXR1YmVJZCA9IG9wdGlvbnMueW91dHViZUlkO1xuICAgICAgICAgICAgaWYgKCQudHJpbSh5b3V0dWJlSWQpID09ICcnICYmIG9iai5pcyhcImFcIikpIHtcbiAgICAgICAgICAgICAgeW91dHViZUlkID0gZ2V0WW91VHViZUlkRnJvbVVybChvYmouYXR0cihcImhyZWZcIikpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKCQudHJpbSh5b3V0dWJlSWQpID09ICcnIHx8IHlvdXR1YmVJZCA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgICAgeW91dHViZUlkID0gb2JqLmF0dHIob3B0aW9ucy5pZEF0dHJpYnV0ZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgdmlkZW9UaXRsZSA9ICQudHJpbShvcHRpb25zLnRpdGxlKTtcbiAgICAgICAgICAgIGlmICh2aWRlb1RpdGxlID09ICcnKSB7XG4gICAgICAgICAgICAgIGlmIChvcHRpb25zLnVzZVlvdVR1YmVUaXRsZSkgc2V0WW91VHViZVRpdGxlKHlvdXR1YmVJZCk7XG4gICAgICAgICAgICAgIGVsc2UgdmlkZW9UaXRsZSA9IG9iai5hdHRyKCd0aXRsZScpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHZpZGVvVGl0bGUpIHtcbiAgICAgICAgICAgICAgc2V0TW9kYWxUaXRsZSh2aWRlb1RpdGxlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmVzaXplTW9kYWwob3B0aW9ucy53aWR0aCk7XG5cbiAgICAgICAgICAgIC8vU2V0dXAgWW91VHViZSBNb2RhbFxuICAgICAgICAgICAgdmFyIFlvdVR1YmVVUkwgPSBnZXRZb3VUdWJlVXJsKHlvdXR1YmVJZCwgb3B0aW9ucyk7XG4gICAgICAgICAgICB2YXIgWW91VHViZVBsYXllcklmcmFtZSA9IGdldFlvdVR1YmVQbGF5ZXIoWW91VHViZVVSTCwgb3B0aW9ucy53aWR0aCwgb3B0aW9ucy5oZWlnaHQpO1xuICAgICAgICAgICAgJFlvdVR1YmVNb2RhbEJvZHkuY3NzKHsnbWF4LXdpZHRoJzogb3B0aW9ucy53aWR0aCwgJ2hlaWdodCc6IG9wdGlvbnMuaGVpZ2h0fSk7XG4gICAgICAgICAgICBzZXRNb2RhbEJvZHkoWW91VHViZVBsYXllcklmcmFtZSk7XG4gICAgICAgICAgICAkWW91VHViZU1vZGFsLm1vZGFsKCdzaG93Jyk7XG5cbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0sXG4gICAgZGVzdHJveTogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICQodGhpcykudW5iaW5kKFwiLllvdVR1YmVNb2RhbFwiKS5yZW1vdmVEYXRhKCdZb3VUdWJlJyk7XG4gICAgICB9KTtcbiAgICB9XG4gIH07XG5cbiAgZnVuY3Rpb24gc2V0TW9kYWxUaXRsZSh0aXRsZSkge1xuICAgICRZb3VUdWJlTW9kYWxUaXRsZS5odG1sKCQudHJpbSh0aXRsZSkpO1xuICB9XG5cbiAgZnVuY3Rpb24gc2V0TW9kYWxCb2R5KGNvbnRlbnQpIHtcbiAgICAkWW91VHViZU1vZGFsQm9keS5odG1sKGNvbnRlbnQpO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVzZXRNb2RhbEJvZHkoKSB7XG4gICAgc2V0TW9kYWxUaXRsZSgnJyk7XG4gICAgc2V0TW9kYWxCb2R5KCcnKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlc2l6ZU1vZGFsKHcpIHtcbi8vICAgICRZb3VUdWJlTW9kYWxEaWFsb2cuY3NzKHtcbi8vICAgICAgJ21heC13aWR0aCc6IHcgKyAobWFyZ2luICogMilcbi8vICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0WW91VHViZVVybCh5b3V0dWJlSWQsIG9wdGlvbnMpIHtcbiAgICByZXR1cm4gW1wiLy93d3cueW91dHViZS5jb20vZW1iZWQvXCIsIHlvdXR1YmVJZCwgXCI/cmVsPTAmc2hvd3NlYXJjaD0wJmF1dG9oaWRlPVwiLCBvcHRpb25zLmF1dG9oaWRlLFxuICAgICAgXCImYXV0b3BsYXk9XCIsIG9wdGlvbnMuYXV0b3BsYXksIFwiJmNvbnRyb2xzPVwiLCBvcHRpb25zLmNvbnRyb2xzLCBcIiZmcz1cIiwgb3B0aW9ucy5mcywgXCImbG9vcD1cIiwgb3B0aW9ucy5sb29wLFxuICAgICAgXCImc2hvd2luZm89XCIsIG9wdGlvbnMuc2hvd2luZm8sIFwiJmNvbG9yPVwiLCBvcHRpb25zLmNvbG9yLCBcIiZ0aGVtZT1cIiwgb3B0aW9ucy50aGVtZSwgXCImd21vZGU9dHJhbnNwYXJlbnRcIlxuICAgIF0uam9pbignJyk7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRZb3VUdWJlUGxheWVyKFVSTCwgd2lkdGgsIGhlaWdodCkge1xuICAgIHJldHVybiBbJzxpZnJhbWUgdGl0bGU9XCJZb3VUdWJlIHZpZGVvIHBsYXllclwiIHdpZHRoPVwiJywgd2lkdGgsICdcIiBoZWlnaHQ9XCInLCBoZWlnaHQsICdcIiAnLFxuICAgICAgJ3N0eWxlPVwibWFyZ2luOjA7IHBhZGRpbmc6MDsgYm94LXNpemluZzpib3JkZXItYm94OyBib3JkZXI6MDsgLXdlYmtpdC1ib3JkZXItcmFkaXVzOjVweDsgLW1vei1ib3JkZXItcmFkaXVzOjVweDsgYm9yZGVyLXJhZGl1czo1cHg7IG1hcmdpbjonLCAobWFyZ2luIC0gMSksICdweDtcIiAnLFxuICAgICAgJ3NyYz1cIicsIFVSTCwgJ1wiIGZyYW1lYm9yZGVyPVwiMFwiIGFsbG93ZnVsbHNjcmVlbiBzZWFtbGVzcz48L2lmcmFtZT4nXG4gICAgXS5qb2luKCcnKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNldFlvdVR1YmVUaXRsZSh5b3V0dWJlSWQpIHtcbiAgICAkLmFqYXgoe1xuICAgICAgdXJsOiB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgKyAnLy9xdWVyeS55YWhvb2FwaXMuY29tL3YxL3B1YmxpYy95cWwnLFxuICAgICAgZGF0YToge1xuICAgICAgICBxOiBcInNlbGVjdCAqIGZyb20ganNvbiB3aGVyZSB1cmwgPSdodHRwOi8vd3d3LnlvdXR1YmUuY29tL29lbWJlZD91cmw9aHR0cDovL3d3dy55b3V0dWJlLmNvbS93YXRjaD92PVwiICsgeW91dHViZUlkICsgXCImZm9ybWF0PWpzb24nXCIsXG4gICAgICAgIGZvcm1hdDogXCJqc29uXCJcbiAgICAgIH0sXG4gICAgICBkYXRhVHlwZTogXCJqc29ucFwiLFxuICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLnF1ZXJ5ICYmIGRhdGEucXVlcnkucmVzdWx0cyAmJiBkYXRhLnF1ZXJ5LnJlc3VsdHMuanNvbikge1xuICAgICAgICAgICAgc2V0TW9kYWxUaXRsZShkYXRhLnF1ZXJ5LnJlc3VsdHMuanNvbi50aXRsZSk7XG4gICAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0WW91VHViZUlkRnJvbVVybCh5b3V0dWJlVXJsKSB7XG4gICAgdmFyIHJlZ0V4cCA9IC9eLiooeW91dHUuYmVcXC98dlxcL3x1XFwvXFx3XFwvfGVtYmVkXFwvfHdhdGNoXFw/dj0pKFteI1xcJlxcP10qKS4qLztcbiAgICB2YXIgbWF0Y2ggPSB5b3V0dWJlVXJsLm1hdGNoKHJlZ0V4cCk7XG4gICAgaWYgKG1hdGNoICYmIG1hdGNoWzJdLmxlbmd0aCA9PSAxMSkge1xuICAgICAgcmV0dXJuIG1hdGNoWzJdO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgJC5mbi5Zb3VUdWJlTW9kYWwgPSBmdW5jdGlvbiAobWV0aG9kKSB7XG4gICAgaWYgKG1ldGhvZHNbbWV0aG9kXSkge1xuICAgICAgcmV0dXJuIG1ldGhvZHNbbWV0aG9kXS5hcHBseSh0aGlzLCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBtZXRob2QgPT09ICdvYmplY3QnIHx8ICFtZXRob2QpIHtcbiAgICAgIHJldHVybiBtZXRob2RzLmluaXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJC5lcnJvcignTWV0aG9kICcgKyBtZXRob2QgKyAnIGRvZXMgbm90IGV4aXN0IG9uIEJvb3RzdHJhcC5Zb3VUdWJlTW9kYWwnKTtcbiAgICB9XG4gIH07XG5cbiAgLy9kZWZhdWx0IGNvbmZpZ3VyYXRpb25cbiAgJC5mbi5Zb3VUdWJlTW9kYWwuZGVmYXVsdHMgPSB7XG4gICAgeW91dHViZUlkOiAnJyxcbiAgICB0aXRsZTogJycsXG4gICAgdXNlWW91VHViZVRpdGxlOiB0cnVlLFxuICAgIGlkQXR0cmlidXRlOiAncmVsJyxcbiAgICBjc3NDbGFzczogJ1lvdVR1YmVNb2RhbCcsXG4gICAgd2lkdGg6IDY0MCxcbiAgICBoZWlnaHQ6IDQ4MCxcbiAgICBhdXRvaGlkZTogMixcbiAgICBhdXRvcGxheTogMSxcbiAgICBjb2xvcjogJ3JlZCcsXG4gICAgY29udHJvbHM6IDEsXG4gICAgZnM6IDEsXG4gICAgbG9vcDogMCxcbiAgICBzaG93aW5mbzogMCxcbiAgICB0aGVtZTogJ2xpZ2h0J1xuICB9O1xufSkoalF1ZXJ5KTtcbiIsIi8qIVxuICogQm9vdHN0cmFwIFlvdVR1YmUgUG9wdXAgUGxheWVyIFBsdWdpblxuICogaHR0cDovL2xhYi5hYmhpbmF5cmF0aG9yZS5jb20vYm9vdHN0cmFwLXlvdXR1YmUvXG4gKiBodHRwczovL2dpdGh1Yi5jb20vYWJoaW5heXJhdGhvcmUvQm9vdHN0cmFwLVlvdXR1YmUtUG9wdXAtUGxheWVyLVBsdWdpblxuICovXG4hZnVuY3Rpb24obyl7ZnVuY3Rpb24gdCh0KXtoLmh0bWwoby50cmltKHQpKX1mdW5jdGlvbiBlKG8pe2IuaHRtbChvKX1mdW5jdGlvbiB1KCl7dChcIlwiKSxlKFwiXCIpfWZ1bmN0aW9uIGEobyl7Yy5jc3Moe3dpZHRoOm8rMiptfSl9ZnVuY3Rpb24gaShvLHQpe3JldHVybltcIi8vd3d3LnlvdXR1YmUuY29tL2VtYmVkL1wiLG8sXCI/cmVsPTAmc2hvd3NlYXJjaD0wJmF1dG9oaWRlPVwiLHQuYXV0b2hpZGUsXCImYXV0b3BsYXk9XCIsdC5hdXRvcGxheSxcIiZjb250cm9scz1cIix0LmNvbnRyb2xzLFwiJmZzPVwiLHQuZnMsXCImbG9vcD1cIix0Lmxvb3AsXCImc2hvd2luZm89XCIsdC5zaG93aW5mbyxcIiZjb2xvcj1cIix0LmNvbG9yLFwiJnRoZW1lPVwiLHQudGhlbWUsXCImd21vZGU9dHJhbnNwYXJlbnRcIl0uam9pbihcIlwiKX1mdW5jdGlvbiBsKG8sdCxlKXtyZXR1cm5bJzxpZnJhbWUgdGl0bGU9XCJZb3VUdWJlIHZpZGVvIHBsYXllclwiIHdpZHRoPVwiJyx0LCdcIiBoZWlnaHQ9XCInLGUsJ1wiICcsJ3N0eWxlPVwibWFyZ2luOjA7IHBhZGRpbmc6MDsgYm94LXNpemluZzpib3JkZXItYm94OyBib3JkZXI6MDsgLXdlYmtpdC1ib3JkZXItcmFkaXVzOjVweDsgLW1vei1ib3JkZXItcmFkaXVzOjVweDsgYm9yZGVyLXJhZGl1czo1cHg7IG1hcmdpbjonLG0tMSwncHg7XCIgJywnc3JjPVwiJyxvLCdcIiBmcmFtZWJvcmRlcj1cIjBcIiBhbGxvd2Z1bGxzY3JlZW4gc2VhbWxlc3M+PC9pZnJhbWU+J10uam9pbihcIlwiKX1mdW5jdGlvbiBkKGUpe28uYWpheCh7dXJsOndpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCtcIi8vcXVlcnkueWFob29hcGlzLmNvbS92MS9wdWJsaWMveXFsXCIsZGF0YTp7cTpcInNlbGVjdCAqIGZyb20ganNvbiB3aGVyZSB1cmwgPSdodHRwOi8vd3d3LnlvdXR1YmUuY29tL29lbWJlZD91cmw9aHR0cDovL3d3dy55b3V0dWJlLmNvbS93YXRjaD92PVwiK2UrXCImZm9ybWF0PWpzb24nXCIsZm9ybWF0OlwianNvblwifSxkYXRhVHlwZTpcImpzb25wXCIsc3VjY2VzczpmdW5jdGlvbihvKXtvJiZvLnF1ZXJ5JiZvLnF1ZXJ5LnJlc3VsdHMmJm8ucXVlcnkucmVzdWx0cy5qc29uJiZ0KG8ucXVlcnkucmVzdWx0cy5qc29uLnRpdGxlKX19KX1mdW5jdGlvbiByKG8pe3ZhciB0PS9eLiooeW91dHUuYmVcXC98dlxcL3x1XFwvXFx3XFwvfGVtYmVkXFwvfHdhdGNoXFw/dj0pKFteI1xcJlxcP10qKS4qLyxlPW8ubWF0Y2godCk7cmV0dXJuIGUmJjExPT1lWzJdLmxlbmd0aD9lWzJdOiExfXZhciBuLHM9bnVsbCxjPW51bGwsaD1udWxsLGI9bnVsbCxtPTU7bj17aW5pdDpmdW5jdGlvbihuKXtpZihuPW8uZXh0ZW5kKHt9LG8uZm4uWW91VHViZU1vZGFsLmRlZmF1bHRzLG4pLG51bGw9PXMpe3M9bygnPGRpdiBjbGFzcz1cIm1vZGFsIGZhZGUgJytuLmNzc0NsYXNzKydcIiBpZD1cIllvdVR1YmVNb2RhbFwiIHJvbGU9XCJkaWFsb2dcIiBhcmlhLWhpZGRlbj1cInRydWVcIj4nKTt2YXIgbT0nPGRpdiBjbGFzcz1cIm1vZGFsLWRpYWxvZ1wiIGlkPVwiWW91VHViZU1vZGFsRGlhbG9nXCI+PGRpdiBjbGFzcz1cIm1vZGFsLWNvbnRlbnRcIiBpZD1cIllvdVR1YmVNb2RhbENvbnRlbnRcIj48ZGl2IGNsYXNzPVwibW9kYWwtaGVhZGVyXCI+PGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJjbG9zZVwiIGRhdGEtZGlzbWlzcz1cIm1vZGFsXCI+JnRpbWVzOzwvYnV0dG9uPjxoNCBjbGFzcz1cIm1vZGFsLXRpdGxlXCIgaWQ9XCJZb3VUdWJlTW9kYWxUaXRsZVwiPjwvaDQ+PC9kaXY+PGRpdiBjbGFzcz1cIm1vZGFsLWJvZHlcIiBpZD1cIllvdVR1YmVNb2RhbEJvZHlcIiBzdHlsZT1cInBhZGRpbmc6MDtcIj48L2Rpdj48L2Rpdj48L2Rpdj4nO3MuaHRtbChtKS5oaWRlKCkuYXBwZW5kVG8oXCJib2R5XCIpLGM9byhcIiNZb3VUdWJlTW9kYWxEaWFsb2dcIiksaD1vKFwiI1lvdVR1YmVNb2RhbFRpdGxlXCIpLGI9byhcIiNZb3VUdWJlTW9kYWxCb2R5XCIpLHMubW9kYWwoe3Nob3c6ITF9KS5vbihcImhpZGUuYnMubW9kYWxcIix1KX1yZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7dmFyIHU9byh0aGlzKSxjPXUuZGF0YShcIllvdVR1YmVcIik7Y3x8KHUuZGF0YShcIllvdVR1YmVcIix7dGFyZ2V0OnV9KSxvKHUpLmJpbmQoXCJjbGljay5Zb3VUdWJlTW9kYWxcIixmdW5jdGlvbihjKXt2YXIgaD1uLnlvdXR1YmVJZDtcIlwiPT1vLnRyaW0oaCkmJnUuaXMoXCJhXCIpJiYoaD1yKHUuYXR0cihcImhyZWZcIikpKSwoXCJcIj09by50cmltKGgpfHxoPT09ITEpJiYoaD11LmF0dHIobi5pZEF0dHJpYnV0ZSkpO3ZhciBiPW8udHJpbShuLnRpdGxlKTtcIlwiPT1iJiYobi51c2VZb3VUdWJlVGl0bGU/ZChoKTpiPXUuYXR0cihcInRpdGxlXCIpKSxiJiZ0KGIpLGEobi53aWR0aCk7dmFyIG09aShoLG4pLGY9bChtLG4ud2lkdGgsbi5oZWlnaHQpO2UoZikscy5tb2RhbChcInNob3dcIiksYy5wcmV2ZW50RGVmYXVsdCgpfSkpfSl9LGRlc3Ryb3k6ZnVuY3Rpb24oKXtyZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uKCl7byh0aGlzKS51bmJpbmQoXCIuWW91VHViZU1vZGFsXCIpLnJlbW92ZURhdGEoXCJZb3VUdWJlXCIpfSl9fSxvLmZuLllvdVR1YmVNb2RhbD1mdW5jdGlvbih0KXtyZXR1cm4gblt0XT9uW3RdLmFwcGx5KHRoaXMsQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLDEpKTpcIm9iamVjdFwiIT10eXBlb2YgdCYmdD92b2lkIG8uZXJyb3IoXCJNZXRob2QgXCIrdCtcIiBkb2VzIG5vdCBleGlzdCBvbiBCb290c3RyYXAuWW91VHViZU1vZGFsXCIpOm4uaW5pdC5hcHBseSh0aGlzLGFyZ3VtZW50cyl9LG8uZm4uWW91VHViZU1vZGFsLmRlZmF1bHRzPXt5b3V0dWJlSWQ6XCJcIix0aXRsZTpcIlwiLHVzZVlvdVR1YmVUaXRsZTohMCxpZEF0dHJpYnV0ZTpcInJlbFwiLGNzc0NsYXNzOlwiWW91VHViZU1vZGFsXCIsd2lkdGg6NjQwLGhlaWdodDo0ODAsYXV0b2hpZGU6MixhdXRvcGxheToxLGNvbG9yOlwicmVkXCIsY29udHJvbHM6MSxmczoxLGxvb3A6MCxzaG93aW5mbzowLHRoZW1lOlwibGlnaHRcIn19KGpRdWVyeSk7XG4iLCIvKiFcbiAqIEJvb3RzdHJhcCBZb3VUdWJlIFBvcHVwIFBsYXllciBQbHVnaW5cbiAqIGh0dHA6Ly9sYWIuYWJoaW5heXJhdGhvcmUuY29tL2Jvb3RzdHJhcC15b3V0dWJlL1xuICogaHR0cHM6Ly9naXRodWIuY29tL2FiaGluYXlyYXRob3JlL0Jvb3RzdHJhcC1Zb3V0dWJlLVBvcHVwLVBsYXllci1QbHVnaW5cbiAqL1xuKGZ1bmN0aW9uICgkKSB7XG4gIHZhciAkWW91VHViZU1vZGFsID0gbnVsbCxcbiAgICAkWW91VHViZU1vZGFsRGlhbG9nID0gbnVsbCxcbiAgICAkWW91VHViZU1vZGFsVGl0bGUgPSBudWxsLFxuICAgICRZb3VUdWJlTW9kYWxCb2R5ID0gbnVsbCxcbiAgICBtYXJnaW4gPSA1LFxuICAgIG1ldGhvZHM7XG5cbiAgLy9QbHVnaW4gbWV0aG9kc1xuICBtZXRob2RzID0ge1xuICAgIC8vaW5pdGlhbGl6ZSBwbHVnaW5cbiAgICBpbml0OiBmdW5jdGlvbiAob3B0aW9ucykge1xuICAgICAgb3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCAkLmZuLllvdVR1YmVNb2RhbC5kZWZhdWx0cywgb3B0aW9ucyk7XG5cbiAgICAgIC8vIGluaXRpYWxpemUgWW91VHViZSBQbGF5ZXIgTW9kYWxcbiAgICAgIGlmICgkWW91VHViZU1vZGFsID09IG51bGwpIHtcbiAgICAgICAgJFlvdVR1YmVNb2RhbCA9ICQoJzxkaXYgY2xhc3M9XCJtb2RhbCBmYWRlICcgKyBvcHRpb25zLmNzc0NsYXNzICsgJ1wiIGlkPVwiWW91VHViZU1vZGFsXCIgcm9sZT1cImRpYWxvZ1wiIGFyaWEtaGlkZGVuPVwidHJ1ZVwiPicpO1xuICAgICAgICB2YXIgbW9kYWxDb250ZW50ID0gJzxkaXYgY2xhc3M9XCJtb2RhbC1kaWFsb2dcIiBpZD1cIllvdVR1YmVNb2RhbERpYWxvZ1wiPicgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxkaXYgY2xhc3M9XCJtb2RhbC1jb250ZW50XCIgaWQ9XCJZb3VUdWJlTW9kYWxDb250ZW50XCI+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8ZGl2IGNsYXNzPVwibW9kYWwtaGVhZGVyXCI+JyArXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzxidXR0b24gdHlwZT1cImJ1dHRvblwiIGNsYXNzPVwiY2xvc2VcIiBkYXRhLWRpc21pc3M9XCJtb2RhbFwiPiZ0aW1lczs8L2J1dHRvbj4nICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGg0IGNsYXNzPVwibW9kYWwtdGl0bGVcIiBpZD1cIllvdVR1YmVNb2RhbFRpdGxlXCI+PC9oND4nICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJzwvZGl2PicgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPGRpdiBjbGFzcz1cIm1vZGFsLWJvZHlcIiBpZD1cIllvdVR1YmVNb2RhbEJvZHlcIiBzdHlsZT1cInBhZGRpbmc6MDtcIj48L2Rpdj4nICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L2Rpdj4nICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9kaXY+JztcbiAgICAgICAgJFlvdVR1YmVNb2RhbC5odG1sKG1vZGFsQ29udGVudCkuaGlkZSgpLmFwcGVuZFRvKCdib2R5Jyk7XG4gICAgICAgICRZb3VUdWJlTW9kYWxEaWFsb2cgPSAkKFwiI1lvdVR1YmVNb2RhbERpYWxvZ1wiKTtcbiAgICAgICAgJFlvdVR1YmVNb2RhbFRpdGxlID0gJChcIiNZb3VUdWJlTW9kYWxUaXRsZVwiKTtcbiAgICAgICAgJFlvdVR1YmVNb2RhbEJvZHkgPSAkKFwiI1lvdVR1YmVNb2RhbEJvZHlcIik7XG4gICAgICAgICRZb3VUdWJlTW9kYWwubW9kYWwoe1xuICAgICAgICAgIHNob3c6IGZhbHNlXG4gICAgICAgIH0pLm9uKCdoaWRlLmJzLm1vZGFsJywgcmVzZXRNb2RhbEJvZHkpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIG9iaiA9ICQodGhpcyk7XG4gICAgICAgIHZhciBkYXRhID0gb2JqLmRhdGEoJ1lvdVR1YmUnKTtcbiAgICAgICAgaWYgKCFkYXRhKSB7IC8vY2hlY2sgaWYgZXZlbnQgaXMgYWxyZWFkeSBhc3NpZ25lZFxuICAgICAgICAgIG9iai5kYXRhKCdZb3VUdWJlJywge1xuICAgICAgICAgICAgdGFyZ2V0OiBvYmpcbiAgICAgICAgICB9KTtcbiAgICAgICAgICAkKG9iaikuYmluZCgnY2xpY2suWW91VHViZU1vZGFsJywgZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICB2YXIgeW91dHViZUlkID0gb3B0aW9ucy55b3V0dWJlSWQ7XG4gICAgICAgICAgICBpZiAoJC50cmltKHlvdXR1YmVJZCkgPT0gJycgJiYgb2JqLmlzKFwiYVwiKSkge1xuICAgICAgICAgICAgICB5b3V0dWJlSWQgPSBnZXRZb3VUdWJlSWRGcm9tVXJsKG9iai5hdHRyKFwiaHJlZlwiKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoJC50cmltKHlvdXR1YmVJZCkgPT0gJycgfHwgeW91dHViZUlkID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICB5b3V0dWJlSWQgPSBvYmouYXR0cihvcHRpb25zLmlkQXR0cmlidXRlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciB2aWRlb1RpdGxlID0gJC50cmltKG9wdGlvbnMudGl0bGUpO1xuICAgICAgICAgICAgaWYgKHZpZGVvVGl0bGUgPT0gJycpIHtcbiAgICAgICAgICAgICAgaWYgKG9wdGlvbnMudXNlWW91VHViZVRpdGxlKSBzZXRZb3VUdWJlVGl0bGUoeW91dHViZUlkKTtcbiAgICAgICAgICAgICAgZWxzZSB2aWRlb1RpdGxlID0gb2JqLmF0dHIoJ3RpdGxlJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAodmlkZW9UaXRsZSkge1xuICAgICAgICAgICAgICBzZXRNb2RhbFRpdGxlKHZpZGVvVGl0bGUpO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICByZXNpemVNb2RhbChvcHRpb25zLndpZHRoKTtcblxuICAgICAgICAgICAgLy9TZXR1cCBZb3VUdWJlIE1vZGFsXG4gICAgICAgICAgICB2YXIgWW91VHViZVVSTCA9IGdldFlvdVR1YmVVcmwoeW91dHViZUlkLCBvcHRpb25zKTtcbiAgICAgICAgICAgIHZhciBZb3VUdWJlUGxheWVySWZyYW1lID0gZ2V0WW91VHViZVBsYXllcihZb3VUdWJlVVJMLCBvcHRpb25zLndpZHRoLCBvcHRpb25zLmhlaWdodCk7XG4gICAgICAgICAgICBzZXRNb2RhbEJvZHkoWW91VHViZVBsYXllcklmcmFtZSk7XG4gICAgICAgICAgICAkWW91VHViZU1vZGFsLm1vZGFsKCdzaG93Jyk7XG5cbiAgICAgICAgICAgIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0sXG4gICAgZGVzdHJveTogZnVuY3Rpb24gKCkge1xuICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICQodGhpcykudW5iaW5kKFwiLllvdVR1YmVNb2RhbFwiKS5yZW1vdmVEYXRhKCdZb3VUdWJlJyk7XG4gICAgICB9KTtcbiAgICB9XG4gIH07XG5cbiAgZnVuY3Rpb24gc2V0TW9kYWxUaXRsZSh0aXRsZSkge1xuICAgICRZb3VUdWJlTW9kYWxUaXRsZS5odG1sKCQudHJpbSh0aXRsZSkpO1xuICB9XG5cbiAgZnVuY3Rpb24gc2V0TW9kYWxCb2R5KGNvbnRlbnQpIHtcbiAgICAkWW91VHViZU1vZGFsQm9keS5odG1sKGNvbnRlbnQpO1xuICB9XG5cbiAgZnVuY3Rpb24gcmVzZXRNb2RhbEJvZHkoKSB7XG4gICAgc2V0TW9kYWxUaXRsZSgnJyk7XG4gICAgc2V0TW9kYWxCb2R5KCcnKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHJlc2l6ZU1vZGFsKHcpIHtcbiAgICAkWW91VHViZU1vZGFsRGlhbG9nLmNzcyh7XG4gICAgICB3aWR0aDogdyArIChtYXJnaW4gKiAyKVxuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0WW91VHViZVVybCh5b3V0dWJlSWQsIG9wdGlvbnMpIHtcbiAgICByZXR1cm4gW1wiLy93d3cueW91dHViZS5jb20vZW1iZWQvXCIsIHlvdXR1YmVJZCwgXCI/cmVsPTAmc2hvd3NlYXJjaD0wJmF1dG9oaWRlPVwiLCBvcHRpb25zLmF1dG9oaWRlLFxuICAgICAgXCImYXV0b3BsYXk9XCIsIG9wdGlvbnMuYXV0b3BsYXksIFwiJmNvbnRyb2xzPVwiLCBvcHRpb25zLmNvbnRyb2xzLCBcIiZmcz1cIiwgb3B0aW9ucy5mcywgXCImbG9vcD1cIiwgb3B0aW9ucy5sb29wLFxuICAgICAgXCImc2hvd2luZm89XCIsIG9wdGlvbnMuc2hvd2luZm8sIFwiJmNvbG9yPVwiLCBvcHRpb25zLmNvbG9yLCBcIiZ0aGVtZT1cIiwgb3B0aW9ucy50aGVtZSwgXCImd21vZGU9dHJhbnNwYXJlbnRcIlxuICAgIF0uam9pbignJyk7XG4gIH1cblxuICBmdW5jdGlvbiBnZXRZb3VUdWJlUGxheWVyKFVSTCwgd2lkdGgsIGhlaWdodCkge1xuICAgIHJldHVybiBbJzxpZnJhbWUgdGl0bGU9XCJZb3VUdWJlIHZpZGVvIHBsYXllclwiIHdpZHRoPVwiJywgd2lkdGgsICdcIiBoZWlnaHQ9XCInLCBoZWlnaHQsICdcIiAnLFxuICAgICAgJ3N0eWxlPVwibWFyZ2luOjA7IHBhZGRpbmc6MDsgYm94LXNpemluZzpib3JkZXItYm94OyBib3JkZXI6MDsgLXdlYmtpdC1ib3JkZXItcmFkaXVzOjVweDsgLW1vei1ib3JkZXItcmFkaXVzOjVweDsgYm9yZGVyLXJhZGl1czo1cHg7IG1hcmdpbjonLCAobWFyZ2luIC0gMSksICdweDtcIiAnLFxuICAgICAgJ3NyYz1cIicsIFVSTCwgJ1wiIGZyYW1lYm9yZGVyPVwiMFwiIGFsbG93ZnVsbHNjcmVlbiBzZWFtbGVzcz48L2lmcmFtZT4nXG4gICAgXS5qb2luKCcnKTtcbiAgfVxuXG4gIGZ1bmN0aW9uIHNldFlvdVR1YmVUaXRsZSh5b3V0dWJlSWQpIHtcbiAgICAkLmFqYXgoe1xuICAgICAgdXJsOiB3aW5kb3cubG9jYXRpb24ucHJvdG9jb2wgKyAnLy9xdWVyeS55YWhvb2FwaXMuY29tL3YxL3B1YmxpYy95cWwnLFxuICAgICAgZGF0YToge1xuICAgICAgICBxOiBcInNlbGVjdCAqIGZyb20ganNvbiB3aGVyZSB1cmwgPSdodHRwOi8vd3d3LnlvdXR1YmUuY29tL29lbWJlZD91cmw9aHR0cDovL3d3dy55b3V0dWJlLmNvbS93YXRjaD92PVwiICsgeW91dHViZUlkICsgXCImZm9ybWF0PWpzb24nXCIsXG4gICAgICAgIGZvcm1hdDogXCJqc29uXCJcbiAgICAgIH0sXG4gICAgICBkYXRhVHlwZTogXCJqc29ucFwiLFxuICAgICAgc3VjY2VzczogZnVuY3Rpb24gKGRhdGEpIHtcbiAgICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLnF1ZXJ5ICYmIGRhdGEucXVlcnkucmVzdWx0cyAmJiBkYXRhLnF1ZXJ5LnJlc3VsdHMuanNvbikge1xuICAgICAgICAgICAgc2V0TW9kYWxUaXRsZShkYXRhLnF1ZXJ5LnJlc3VsdHMuanNvbi50aXRsZSk7XG4gICAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gZ2V0WW91VHViZUlkRnJvbVVybCh5b3V0dWJlVXJsKSB7XG4gICAgdmFyIHJlZ0V4cCA9IC9eLiooeW91dHUuYmVcXC98dlxcL3x1XFwvXFx3XFwvfGVtYmVkXFwvfHdhdGNoXFw/dj0pKFteI1xcJlxcP10qKS4qLztcbiAgICB2YXIgbWF0Y2ggPSB5b3V0dWJlVXJsLm1hdGNoKHJlZ0V4cCk7XG4gICAgaWYgKG1hdGNoICYmIG1hdGNoWzJdLmxlbmd0aCA9PSAxMSkge1xuICAgICAgcmV0dXJuIG1hdGNoWzJdO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9XG5cbiAgJC5mbi5Zb3VUdWJlTW9kYWwgPSBmdW5jdGlvbiAobWV0aG9kKSB7XG4gICAgaWYgKG1ldGhvZHNbbWV0aG9kXSkge1xuICAgICAgcmV0dXJuIG1ldGhvZHNbbWV0aG9kXS5hcHBseSh0aGlzLCBBcnJheS5wcm90b3R5cGUuc2xpY2UuY2FsbChhcmd1bWVudHMsIDEpKTtcbiAgICB9IGVsc2UgaWYgKHR5cGVvZiBtZXRob2QgPT09ICdvYmplY3QnIHx8ICFtZXRob2QpIHtcbiAgICAgIHJldHVybiBtZXRob2RzLmluaXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgJC5lcnJvcignTWV0aG9kICcgKyBtZXRob2QgKyAnIGRvZXMgbm90IGV4aXN0IG9uIEJvb3RzdHJhcC5Zb3VUdWJlTW9kYWwnKTtcbiAgICB9XG4gIH07XG5cbiAgLy9kZWZhdWx0IGNvbmZpZ3VyYXRpb25cbiAgJC5mbi5Zb3VUdWJlTW9kYWwuZGVmYXVsdHMgPSB7XG4gICAgeW91dHViZUlkOiAnJyxcbiAgICB0aXRsZTogJycsXG4gICAgdXNlWW91VHViZVRpdGxlOiB0cnVlLFxuICAgIGlkQXR0cmlidXRlOiAncmVsJyxcbiAgICBjc3NDbGFzczogJ1lvdVR1YmVNb2RhbCcsXG4gICAgd2lkdGg6IDY0MCxcbiAgICBoZWlnaHQ6IDQ4MCxcbiAgICBhdXRvaGlkZTogMixcbiAgICBhdXRvcGxheTogMSxcbiAgICBjb2xvcjogJ3JlZCcsXG4gICAgY29udHJvbHM6IDEsXG4gICAgZnM6IDEsXG4gICAgbG9vcDogMCxcbiAgICBzaG93aW5mbzogMCxcbiAgICB0aGVtZTogJ2xpZ2h0J1xuICB9O1xufSkoalF1ZXJ5KTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
